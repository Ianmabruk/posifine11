import{a as Zs,b as Xs,g as et,r as a,u as ke,c as hs,R as Ts,d as H,B as st,N as Q,e as tt}from"./vendor-Ct1st1Nj.js";import{C as Ye,D as ye,T as Ie,P as Ne,S as Ls,a as Us,b as $s,c as le,d as at,e as rt,f as ms,g as ve,h as ce,i as lt,j as nt,k as it,L as re,U as xs,l as vs,m as we,E as ps,M as ws,n as fe,X as _e,o as Ze,p as Oe,q as gs,r as je,s as Ss,t as Be,B as bs,R as Fs,I as ct,u as Qe,v as Se,w as Ee,x as ks,y as Os,z as ot,A as Rs,F as Te,G as dt,H as mt,J as Re,K as xt,N as Je,O as ut,Q as us,Z as qs,V as fs,W as Ms,Y as ht,_ as pt,$ as gt,a0 as is,a1 as bt,a2 as ft,a3 as jt}from"./icons-v1oQXOoX.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))g(r);new MutationObserver(r=>{for(const t of r)if(t.type==="childList")for(const l of t.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&g(l)}).observe(document,{childList:!0,subtree:!0});function u(r){const t={};return r.integrity&&(t.integrity=r.integrity),r.referrerPolicy&&(t.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?t.credentials="include":r.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function g(r){if(r.ep)return;r.ep=!0;const t=u(r);fetch(r.href,t)}})();var cs={exports:{}},Fe={};var Cs;function yt(){if(Cs)return Fe;Cs=1;var s=Zs(),c=Symbol.for("react.element"),u=Symbol.for("react.fragment"),g=Object.prototype.hasOwnProperty,r=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,t={key:!0,ref:!0,__self:!0,__source:!0};function l(b,m,n){var f,p={},i=null,C=null;n!==void 0&&(i=""+n),m.key!==void 0&&(i=""+m.key),m.ref!==void 0&&(C=m.ref);for(f in m)g.call(m,f)&&!t.hasOwnProperty(f)&&(p[f]=m[f]);if(b&&b.defaultProps)for(f in m=b.defaultProps,m)p[f]===void 0&&(p[f]=m[f]);return{$$typeof:c,type:b,key:i,ref:C,props:p,_owner:r.current}}return Fe.Fragment=u,Fe.jsx=l,Fe.jsxs=l,Fe}var Ps;function Nt(){return Ps||(Ps=1,cs.exports=yt()),cs.exports}var e=Nt(),Ge={},As;function vt(){if(As)return Ge;As=1;var s=Xs();return Ge.createRoot=s.createRoot,Ge.hydrateRoot=s.hydrateRoot,Ge}var wt=vt();const St=et(wt),kt={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE:"http://127.0.0.1:5000/api",VITE_API_URL:"https://posifine11-backend-spu4.vercel.app"};var os={};const Ct=()=>typeof import.meta<"u"&&kt&&"http://127.0.0.1:5000/api"||typeof process<"u"&&os&&(os.VITE_API_BASE||os.REACT_APP_API_URL)||"https://posfine-backend11.onrender.com/api",Z=Ct(),Pt=()=>localStorage.getItem("token"),R=async(s,c={})=>{const u=Pt(),g=s.startsWith("/")?s:`/${s}`,r={...c,headers:{"Content-Type":"application/json",...u&&!(g.startsWith("/auth")&&g!=="/auth/me")&&!g.includes("/main-admin/auth/login")&&{Authorization:`Bearer ${u}`},...c.headers}};try{const t=await fetch(`${Z}${g}`,r);if(t.status===401){localStorage.removeItem("token"),localStorage.removeItem("user");const b=window.location.pathname||"";if(!b.includes("/login")&&!b.includes("/signup")&&!b.includes("/auth")&&!b.includes("/main.admin"))try{window.location.href="/login"}catch{}const m=new Error("Unauthorized");throw m.status=401,m}if(t.status===500)throw new Error("Server error 500 - Backend unavailable");if(t.ok)return t.status===204?{success:!0}:await t.json();const l=await t.json().catch(()=>({error:"Network error"}));throw new Error(l.error||`HTTP ${t.status}: ${t.statusText}`)}catch(t){throw t.name==="TypeError"&&t.message.includes("fetch")?(console.error("API Fetch Error:",t),console.error("Attempted URL:",`${Z}${g}`),new Error("Cannot connect to server. Please check your internet connection.")):t}},De={login:s=>R("/auth/login",{method:"POST",body:JSON.stringify(s)}),pinLogin:s=>R("/auth/pin-login",{method:"POST",body:JSON.stringify(s)}),signup:s=>R("/auth/signup",{method:"POST",body:JSON.stringify(s)}),signupWithPayment:s=>R("/signup-with-payment",{method:"POST",body:JSON.stringify(s)}),me:()=>R("/auth/me")},Ae={getAll:()=>R("/users"),create:s=>R("/users",{method:"POST",body:JSON.stringify(s)}),update:(s,c)=>R(`/users/${s}`,{method:"PUT",body:JSON.stringify(c)}),delete:s=>R(`/users/${s}`,{method:"DELETE"}),setPin:(s,c)=>R(`/users/${s}/set-pin`,{method:"POST",body:JSON.stringify({pin:c})}),lock:(s,c)=>R(`/users/${s}/lock`,{method:"POST",body:JSON.stringify({locked:c})})},ie={getAll:()=>R("/products"),create:s=>R("/products",{method:"POST",body:JSON.stringify(s)}),update:(s,c)=>R(`/products/${s}`,{method:"PUT",body:JSON.stringify(c)}),delete:s=>R(`/products/${s}`,{method:"DELETE"}),getMaxProducible:s=>R(`/products/${s}/max-producible`)},He={getAll:async()=>[{id:1,total:450,items:[{name:"Coffee",quantity:2}],createdAt:new Date().toISOString()}],create:async s=>({id:Date.now(),...s,createdAt:new Date().toISOString()})},Ds={getAll:async()=>[{id:1,description:"Office supplies",amount:150,createdAt:new Date().toISOString()}],create:async s=>({id:Date.now(),...s,createdAt:new Date().toISOString()})},_s={get:async()=>({totalSales:1500,totalExpenses:300,profit:1200,productCount:5})},Ve={getAll:()=>R("/discounts"),create:s=>R("/discounts",{method:"POST",body:JSON.stringify(s)}),update:(s,c)=>R(`/discounts/${s}`,{method:"PUT",body:JSON.stringify(c)}),delete:s=>R(`/discounts/${s}`,{method:"DELETE"})},qe={getAll:()=>R("/credit-requests"),create:s=>R("/credit-requests",{method:"POST",body:JSON.stringify(s)}),approve:s=>R(`/credit-requests/${s}/approve`,{method:"POST"}),reject:s=>R(`/credit-requests/${s}/reject`,{method:"POST"})},Me={get:async()=>({screenLockPassword:"2005",businessName:"My Business"}),update:async s=>s},Is={getAll:s=>{const c=s?`/batches?productId=${s}`:"/batches";return R(c)},create:s=>R("/batches",{method:"POST",body:JSON.stringify(s)})},be={login:s=>R("/main-admin/auth/login",{method:"POST",body:JSON.stringify(s)}),getUsers:()=>{const s=localStorage.getItem("ownerToken");return R("/main-admin/users",{headers:{Authorization:`Bearer ${s}`}})},getStats:()=>{const s=localStorage.getItem("ownerToken");return R("/main-admin/stats",{headers:{Authorization:`Bearer ${s}`}})},getActivities:()=>{const s=localStorage.getItem("ownerToken");return R("/main-admin/activities",{headers:{Authorization:`Bearer ${s}`}})},lockUser:(s,c)=>{const u=localStorage.getItem("ownerToken");return R(`/main-admin/users/${s}/lock`,{method:"POST",headers:{Authorization:`Bearer ${u}`},body:JSON.stringify({locked:c})})},changePlan:(s,c)=>{const u=localStorage.getItem("ownerToken");return R(`/main-admin/users/${s}/plan`,{method:"POST",headers:{Authorization:`Bearer ${u}`},body:JSON.stringify({plan:c})})},clearData:s=>{const c=localStorage.getItem("ownerToken");return R("/main-admin/system/clear-data",{method:"POST",headers:{Authorization:`Bearer ${c}`},body:JSON.stringify({type:s})})}},Bs=a.createContext(),he=()=>a.useContext(Bs),At=({children:s})=>{const[c,u]=a.useState(null),[g,r]=a.useState(!0),[t,l]=a.useState(!1),[b,m]=a.useState({});a.useEffect(()=>{n()},[]),a.useEffect(()=>{const k=()=>{const D=localStorage.getItem("user");if(D)try{const z=JSON.parse(D);u(z)}catch(z){console.warn("Failed to parse user from localStorage",z)}else u(null)};return window.addEventListener("storage",k),window.addEventListener("localStorageUpdated",k),()=>{window.removeEventListener("storage",k),window.removeEventListener("localStorageUpdated",k)}},[]);const n=async()=>{try{const k=localStorage.getItem("token"),D=localStorage.getItem("user");if(k)try{const z=await fetch(`${Z}/auth/me`,{headers:{Authorization:`Bearer ${k}`,"Content-Type":"application/json"}});if(z.ok){const se=await z.json();u(se),localStorage.setItem("user",JSON.stringify(se))}else throw new Error("Invalid token")}catch(z){console.warn("Auth check failed:",z),localStorage.removeItem("token"),localStorage.removeItem("user")}}catch(k){console.error("Error initializing auth:",k),localStorage.removeItem("token"),localStorage.removeItem("user"),u(null)}finally{r(!1),l(!0)}},f=async k=>{try{if(k&&k.token&&k.user)return localStorage.setItem("token",k.token),localStorage.setItem("user",JSON.stringify(k.user)),u(k.user),k;const D=await De.login(k);if(D.token&&D.user)return localStorage.setItem("token",D.token),localStorage.setItem("user",JSON.stringify(D.user)),u(D.user),D;throw new Error("Invalid response from server")}catch(D){throw console.error("Login failed:",D),D}},p=async k=>{try{const D=await De.signup(k);if(D.token&&D.user)return localStorage.setItem("token",D.token),localStorage.setItem("user",JSON.stringify(D.user)),u(D.user),D;throw new Error("Invalid response from server")}catch(D){throw console.error("Signup failed:",D),D}},i=async k=>{try{if(localStorage.setItem("user",JSON.stringify(k)),u(k),window.dispatchEvent(new Event("localStorageUpdated")),k&&k.id)try{await Ae.update(k.id,k)}catch(D){console.warn("Failed to persist updated user to backend",D)}return k}catch(D){throw console.error("updateUser failed:",D),D}},C=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),u(null),window.location.href="/login"},d=()=>!!c&&!!localStorage.getItem("token"),y=k=>c&&c.role===k,N=()=>c&&(c.role==="admin"||c.role==="main-admin"),j=()=>c&&c.role==="cashier",w=()=>c&&c.plan==="ultra",P=()=>c&&c.plan==="basic",A=()=>c&&(c.role==="admin"||c.role==="cashier"),q=()=>c&&c.role==="admin"&&c.plan==="ultra",x=()=>c&&c.role==="admin",L=()=>!0,S=()=>!0;return c?.locked?e.jsx(LockedAccount,{}):e.jsx(Bs.Provider,{value:{user:c,loading:g,isInitialized:t,appSettings:b,login:f,signup:p,updateUser:i,logout:C,isAuthenticated:d,hasRole:y,isAdmin:N,isCashier:j,isUltraPackage:w,isBasicPackage:P,canEditStock:A,canManageUsers:q,canViewAnalytics:x,isRealTimeProductSyncEnabled:L,isCashierUserManagementEnabled:S},children:s})},Dt={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE:"http://127.0.0.1:5000/api",VITE_API_URL:"https://posifine11-backend-spu4.vercel.app"};var ds={};const It=()=>{try{if(typeof import.meta<"u"&&Dt)return"http://127.0.0.1:5000/api"}catch{}return typeof process<"u"&&ds?ds.VITE_API_BASE||ds.REACT_APP_API_URL:"http://127.0.0.1:5000/api"},Et=It();let V=null;const me=new Map;function Tt(){const s=typeof window<"u"?localStorage.getItem("token"):null;return`${(Et||"http://127.0.0.1:5000/api").replace(/\/api\/?$/,"")}/api/ws/products${s?`?token=${encodeURIComponent(s)}`:""}`.replace(/^http/,"ws")}const xe={connect(){if(typeof WebSocket>"u"){console.info("WebSocket not available in this environment");return}if(V&&(V.readyState===WebSocket.OPEN||V.readyState===WebSocket.CONNECTING))return;const s=Tt();try{V=new WebSocket(s)}catch(c){console.error("WebSocket connect failed",c),V=null;return}V.onopen=()=>{console.info("WebSocket connected")},V.onmessage=c=>{let u=null;try{u=JSON.parse(c.data)}catch{return}if(u&&u.type==="initial"&&Array.isArray(u.products)){u.products.forEach(g=>{(me.get("productCreated")||[]).forEach(t=>{try{t(g)}catch{}})});return}u&&u.event&&(me.get(u.event)||[]).forEach(r=>{try{r(u.payload)}catch{}})},V.onclose=()=>{V=null,console.info("WebSocket closed")},V.onerror=c=>{console.error("WebSocket error",c)}},emit(s,c){if(!(!V||V.readyState!==WebSocket.OPEN))try{V.send(JSON.stringify({event:s,payload:c}))}catch(u){console.error("send failed",u)}},on(s,c){const u=me.get(s)||[];u.push(c),me.set(s,u)},off(s,c){if(!me.has(s))return;if(!c){me.delete(s);return}const u=me.get(s).filter(g=>g!==c);me.set(s,u)},disconnect(){try{V&&V.close()}catch(s){console.error(s)}V=null,me.clear()}},Hs=a.createContext(),Lt=({user:s,children:c})=>{const[u,g]=a.useState([]),r=async()=>{try{const t=await ie.getAll();g(t||[])}catch(t){console.error("Failed to refresh products:",t)}};return a.useEffect(()=>{if(s?.accountId)return r(),xe.connect(),xe.emit("joinAccount",s.accountId),xe.on("productCreated",t=>{g(l=>[t,...l])}),xe.on("productUpdated",t=>{g(l=>l.map(b=>b._id===t._id?t:b))}),xe.on("productDeleted",t=>{g(l=>l.filter(b=>b._id!==t))}),()=>{xe.off("productCreated"),xe.off("productUpdated"),xe.off("productDeleted"),xe.disconnect()}},[s?.accountId]),e.jsx(Hs.Provider,{value:{products:u,setProducts:g,refreshProducts:r},children:c})},Ks=()=>a.useContext(Hs);function Ut(){const[s,c]=a.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[u,g]=a.useState(!0),[r,t]=a.useState(null);a.useEffect(()=>{l()},[]);const l=async()=>{try{t(null);const[n,f]=await Promise.all([_s.get(),He.getAll()]),p={totalSales:n?.totalSales||0,totalExpenses:n?.totalExpenses||0,profit:n?.profit||0,grossProfit:n?.grossProfit||0,netProfit:n?.netProfit||0,totalCOGS:n?.totalCOGS||0,dailySales:n?.dailySales||0,weeklySales:n?.weeklySales||0,productCount:n?.productCount||0},i=Array.isArray(f)?f:[];c({stats:p,recentSales:i.slice(-10).reverse()})}catch(n){console.error("Failed to load data:",n),t(n.message),c({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{g(!1)}};if(u)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(r&&s.stats.totalSales===0&&s.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Ye,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:r}),e.jsx("button",{onClick:l,className:"btn-primary",children:"Retry"})]})});const b=[{label:"Total Sales",value:`KSH ${s.stats.totalSales?.toLocaleString()||0}`,icon:ye,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${s.stats.grossProfit?.toLocaleString()||0}`,icon:Ie,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${s.stats.totalCOGS?.toLocaleString()||0}`,icon:Ne,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${s.stats.netProfit?.toLocaleString()||0}`,icon:Ie,color:"from-purple-500 to-pink-600",change:"+15.3%"}],m=[{label:"Daily Sales",value:`KSH ${s.stats.dailySales?.toLocaleString()||0}`,icon:Ls,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${s.stats.weeklySales?.toLocaleString()||0}`,icon:Ie,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${s.stats.totalExpenses?.toLocaleString()||0}`,icon:Us,color:"bg-red-50 text-red-600"},{label:"Products",value:s.stats.productCount||0,icon:Ne,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(b||[]).map((n,f)=>{const p=n?.icon;return p?e.jsxs("div",{className:`card bg-gradient-to-br ${n.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(p,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:n.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:n.label}),e.jsx("p",{className:"text-2xl font-bold",children:n.value})]},f):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(m||[]).map((n,f)=>{const p=n?.icon;return p?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${n.color} flex items-center justify-center`,children:e.jsx(p,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:n.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:n.value})]})]})},f):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!s.recentSales||s.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ye,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(s.recentSales||[]).map(n=>n?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:n.createdAt?new Date(n.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(n.items)?n.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:n.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",n.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",n.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",n.profit?.toLocaleString()||0]})]},n.id||Math.random()):null)})]})})]})]})}function $t(){const{user:s,isUltraPackage:c,isRealTimeProductSyncEnabled:u}=he(),{products:g,refreshProducts:r}=Ks(),[t,l]=a.useState([]),[b,m]=a.useState([]),[n,f]=a.useState("all"),[p,i]=a.useState(""),[C,d]=a.useState(!1),[y,N]=a.useState(!1),[j,w]=a.useState(!1),[P,A]=a.useState(null),[q,x]=a.useState(null),[L,S]=a.useState(null),[k,D]=a.useState(!1),[z,se]=a.useState(null),[Ce,ue]=a.useState(""),[_,W]=a.useState({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),[G,ae]=a.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[O,J]=a.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0});a.useEffect(()=>{v()},[]);const v=async()=>{try{await r();const o=await Is.getAll();m(o)}catch(o){console.error("Failed to load data:",o)}};a.useEffect(()=>{g&&l(g)},[g]);const $=(o,E=!0)=>{const U=o.target.files[0];if(U){const I=new FileReader;I.onload=B=>{const te=B.target.result;ue(te),E?W({..._,image:te}):J({...O,image:te})},I.readAsDataURL(U)}},F=o=>b.filter(U=>U.productId===o&&U.quantity>0).reduce((U,I)=>U+I.quantity,0),K=o=>b.filter(E=>E.productId===o&&E.quantity>0),Y=(o,E="success")=>{S({message:o,type:E}),setTimeout(()=>S(null),5e3)},ne=async o=>{o.preventDefault();try{const E={..._,price:parseFloat(_.price),cost:parseFloat(_.cost||0),quantity:0,visibleToCashier:!_.expenseOnly&&_.visibleToCashier!==!1},U=await ie.create(E);W({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),ue(""),d(!1),await v(),Y(`âœ… Product "${U.name}" added successfully! ${U.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success")}catch(E){console.error("Failed to create product:",E),alert(`Failed to create product: ${E.message||"Unknown error"}`)}},X=async o=>{o.preventDefault();try{await Is.create({productId:P.id,quantity:parseInt(G.quantity),expiryDate:G.expiryDate,batchNumber:G.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(G.cost||P.cost||0)}),ae({quantity:"",expiryDate:"",batchNumber:"",cost:""}),w(!1),A(null),await v(),Y(`âœ… Stock added successfully for ${P.name}!`,"success")}catch(E){console.error("Failed to add stock:",E),alert("Failed to add stock")}},Xe=async o=>{o.preventDefault();try{const E=t.find(B=>B.id===O.id);if(parseFloat(O.price)<E.price){alert("You cannot lower prices, only increase.");return}const U={...O,price:parseFloat(O.price),cost:parseFloat(O.cost),quantity:parseFloat(O.quantity)},I=await ie.update(O.id,U);N(!1),await r(),u()?(D(!0),window.dispatchEvent(new CustomEvent("productUpdated",{detail:{product:I,originalProduct:E,timestamp:new Date().toISOString(),type:"update"}})),Y("ðŸ“¡ Product updated and synced to all dashboards!","success"),se(new Date),setTimeout(()=>{D(!1)},3e3)):alert("Product updated successfully!")}catch(E){console.error("Failed to update product:",E),alert(`Failed to update product: ${E.message||"Unknown error"}`)}},ee=async o=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const E=t.find(I=>I.id===o),U=await ie.delete(o);if(l(I=>I.filter(B=>B.id!==o)),u()&&E)D(!0),window.dispatchEvent(new CustomEvent("productDeleted",{detail:{product:E,timestamp:new Date().toISOString(),type:"delete"}})),Y(`ðŸ“¡ Product "${E.name}" deleted and synced to all dashboards!`,"success"),se(new Date),setTimeout(()=>{D(!1)},3e3);else{const I=U?.message||"Product deleted successfully!";alert(I)}await r()}catch(E){console.error("Failed to delete product:",E);let U="Failed to delete product";E.message.includes("Failed to execute")||E.message.includes("JSON")?U="Network error. Please check your connection and try again.":E.message.includes("401")||E.message.includes("unauthorized")?U="You are not authorized to delete this product.":E.message.includes("404")||E.message.includes("not found")?U="Product not found. It may have been deleted already.":E.message&&(U=`Failed to delete product: ${E.message}`),alert(U)}},pe=(t||[]).filter(o=>{if(!o)return!1;const E=o.name?.toLowerCase().includes(p.toLowerCase()),U=n==="all"||n==="raw"&&!o.recipe||n==="composite"&&o.recipe||n==="expense"&&o.expenseOnly||n==="low-stock"&&o.quantity<10;return E&&U}),Le=(t||[]).filter(o=>o&&!o.recipe&&!o.expenseOnly),Pe=(t||[]).filter(o=>o&&o.recipe),es=(t||[]).filter(o=>o&&o.expenseOnly),ss=o=>{if(!o||!o.recipe)return 0;let E=1/0;return(o.recipe||[]).forEach(U=>{if(!U)return;const I=(t||[]).find(B=>B&&B.id===U.productId);if(I&&I.quantity>0&&U.quantity>0){const B=Math.floor(I.quantity/U.quantity);E=Math.min(E,B)}}),E===1/0?0:E},Ue=o=>{if(!o)return 0;if(!o.recipe)return o.cost||0;let E=0;return(o.recipe||[]).forEach(U=>{if(!U)return;const I=(t||[]).find(B=>B&&B.id===U.productId);if(I&&I.quantity>0){const B=(I.cost||0)/I.quantity;E+=B*(U.quantity||0)}}),E};return e.jsxs("div",{className:"p-6 space-y-6",children:[L&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${L.type==="success"?"bg-green-50 border border-green-200 text-green-800":L.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:L.message}),e.jsx("button",{onClick:()=>S(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx($s,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:p,onChange:o=>i(o.target.value)})]}),e.jsxs("select",{value:n,onChange:o=>f(o.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>d(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:Le.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:Pe.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:es.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(pe||[]).map(o=>{if(!o)return null;const E=Ue(o),U=o.price?((o.price-E)/o.price*100).toFixed(1):0,I=ss(o),B=q===o.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[o.image?e.jsx("img",{src:o.image,alt:o.name,className:"w-12 h-12 object-cover rounded-lg",onError:te=>{te.target.style.display="none",te.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:o.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[o.recipe&&e.jsx("button",{onClick:()=>x(B?null:o.id),className:"p-1 hover:bg-gray-200 rounded",children:B?e.jsx(at,{className:"w-4 h-4"}):e.jsx(rt,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:o.name}),o.quantity<10&&!o.recipe&&e.jsx(ms,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${o.expenseOnly?"badge-warning":o.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:o.expenseOnly?"Expense":o.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",o.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",E.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${F(o.id)===0?"text-red-600":F(o.id)<10?"text-yellow-600":"text-gray-900"}`,children:[F(o.id)," ",o.unit]}),F(o.id)<10&&F(o.id)>0&&e.jsx(ms,{className:"w-4 h-4 text-yellow-500"}),F(o.id)===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600",children:[K(o.id).length," active"]}),e.jsx("button",{onClick:()=>{A(o),w(!0)},className:"p-1 hover:bg-blue-50 rounded text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(le,{className:"w-3 h-3"})})]})}),e.jsx("td",{className:"px-4 py-3",children:o.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[I," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${U>30?"text-green-600":U>15?"text-yellow-600":"text-red-600"}`,children:[U,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{J(o),N(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ee(o.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(ce,{className:"w-4 h-4"})})]})})]},o.id),B&&o.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(o.recipe||[]).map((te,ts)=>{if(!te)return null;const oe=(t||[]).find($e=>$e&&$e.id===te.productId);if(!oe)return null;const de=(oe.cost||0)/(oe.quantity||1),as=de*(te.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:oe.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[te.quantity||0," ",oe.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[oe.quantity||0," ",oe.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",de.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",as.toFixed(2)]})]},ts)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",E.toFixed(2)]})]})})]})]})})})]})})})]})})}),j&&P&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Add Stock for ",P.name]}),e.jsxs("form",{onSubmit:X,className:"space-y-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:G.quantity,onChange:o=>ae({...G,quantity:o.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:G.expiryDate,onChange:o=>ae({...G,expiryDate:o.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:G.batchNumber,onChange:o=>ae({...G,batchNumber:o.target.value})}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost per Unit",className:"input",value:G.cost,onChange:o=>ae({...G,cost:o.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{w(!1),A(null),ae({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:ne,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:_.name,onChange:o=>W({..._,name:o.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:o=>$(o,!0),className:"input"}),e.jsx(lt,{className:"w-5 h-5 text-gray-400"})]}),(Ce||_.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:Ce||_.image,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:_.price,onChange:o=>W({..._,price:o.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:_.cost,onChange:o=>W({..._,cost:o.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:_.category,onChange:o=>W({..._,category:o.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsxs("select",{className:"input",value:_.unit,onChange:o=>W({..._,unit:o.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:_.expenseOnly,onChange:o=>W({..._,expenseOnly:o.target.checked,visibleToCashier:!o.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!_.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:_.visibleToCashier,onChange:o=>W({..._,visibleToCashier:o.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{d(!1),ue(""),W({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0})},className:"btn-secondary",children:"Cancel"})]})]})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:Xe,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:O.name,onChange:o=>J({...O,name:o.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:O.image||"",onChange:o=>J({...O,image:o.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:o=>{const E=o.target.files[0];if(E){const U=new FileReader;U.onloadend=()=>{J({...O,image:U.result})},U.readAsDataURL(E)}}})]}),O.image&&e.jsx("img",{src:O.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:O.price||"",onChange:o=>J({...O,price:o.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:O.cost||"",onChange:o=>J({...O,cost:o.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:O.quantity||"",onChange:o=>J({...O,quantity:o.target.value}),required:!0}),e.jsxs("select",{className:"input",value:O.unit||"pcs",onChange:o=>J({...O,unit:o.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:O.category||"raw",onChange:o=>J({...O,category:o.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:O.expenseOnly||!1,onChange:o=>J({...O,expenseOnly:o.target.checked,visibleToCashier:!o.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!O.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:O.visibleToCashier!==!1,onChange:o=>J({...O,visibleToCashier:o.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>N(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ft(){const[s,c]=a.useState([]),[u,g]=a.useState([]),[r,t]=a.useState(!1),[l,b]=a.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});a.useEffect(()=>{m()},[]);const m=async()=>{const y=await ie.getAll();c(y),g(y.filter(N=>!N.recipe))},n=()=>{b({...l,ingredients:[...l.ingredients,{name:"",quantity:"",unit:"pcs"}]})},f=(y,N,j)=>{const w=[...l.ingredients];w[y][N]=j,b({...l,ingredients:w})},p=y=>{b({...l,ingredients:l.ingredients.filter((N,j)=>j!==y)})},i=()=>l.ingredients.reduce((y,N)=>{const j=u.find(w=>w.name.toLowerCase()===N.name.toLowerCase());if(j&&N.quantity){const w=j.cost/j.quantity;return y+w*parseFloat(N.quantity)}return y},0),C=async y=>{y.preventDefault();const N=[];for(const w of l.ingredients){if(!w.name||!w.quantity)continue;const P=u.find(A=>A.name.toLowerCase()===w.name.toLowerCase());P?N.push({productId:P.id,quantity:parseFloat(w.quantity),unit:w.unit||"pcs"}):N.push({name:w.name,quantity:parseFloat(w.quantity),unit:w.unit||"pcs"})}if(N.length===0){alert("Please add at least one ingredient");return}const j=i();try{await ie.create({name:l.name,price:parseFloat(l.price),cost:j,quantity:0,unit:"pcs",category:"composite",recipe:N,image:l.image||"",visibleToCashier:l.visibleToCashier,expenseOnly:!1}),b({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),t(!1),m(),alert("Recipe created successfully!")}catch(w){console.error("Error creating recipe:",w),alert("Failed to create recipe. Please try again.")}},d=s.filter(y=>y.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>t(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",d.length,")"]}),d.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:d.map(y=>{const N=y.recipe.reduce((w,P)=>{if(P.productId){const A=s.find(q=>q.id===P.productId);if(A){const q=A.cost/A.quantity;return w+q*P.quantity}}else if(P.name){const A=s.find(q=>q.name.toLowerCase()===P.name.toLowerCase());if(A){const q=A.cost/A.quantity;return w+q*P.quantity}}return w},0),j=((y.price-N)/y.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:y.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",y.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",N.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${j>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",j,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(ce,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:y.recipe.map((w,P)=>{let A="",q=w.unit||"pcs";if(w.productId){const x=s.find(L=>L.id===w.productId);x&&(A=x.name,q=x.unit)}else w.name&&(A=w.name,q=w.unit||"pcs");return A?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:A}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[w.quantity," ",q]})]},P):null})})]})]},y.id)})})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:l.name,onChange:y=>b({...l,name:y.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:l.price,onChange:y=>b({...l,price:y.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:l.image,onChange:y=>b({...l,image:y.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.visibleToCashier,onChange:y=>b({...l,visibleToCashier:y.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:n,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:l.ingredients.map((y,N)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:y.name,onChange:j=>f(N,"name",j.target.value),required:!0,list:`ingredients-list-${N}`}),e.jsx("datalist",{id:`ingredients-list-${N}`,children:u.map(j=>e.jsxs("option",{value:j.name,children:[j.name," (",j.quantity," ",j.unit," available)"]},j.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:y.quantity,onChange:j=>f(N,"quantity",j.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:y.unit,onChange:j=>f(N,"unit",j.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>p(N),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(ce,{className:"w-4 h-4"})})]},N))}),l.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),l.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",i().toFixed(2)]})]}),l.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(l.price)-i())/parseFloat(l.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(nt,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{t(!1),b({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ot(){const[s,c]=a.useState([]),[u,g]=a.useState("all");a.useEffect(()=>{r()},[]);const r=async()=>{const n=await He.getAll();c(n.reverse())},t=s.filter(n=>{if(u==="today")return new Date(n.createdAt).toDateString()===new Date().toDateString();if(u==="week"){const f=new Date;return f.setDate(f.getDate()-7),new Date(n.createdAt)>=f}return!0}),l=t.reduce((n,f)=>n+f.total,0),b=t.reduce((n,f)=>n+(f.cogs||0),0),m=l-b;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("select",{value:u,onChange:n=>g(n.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]})}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(it,{className:"w-4 h-4"}),"Export"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",l.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",b.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",m.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:t.map(n=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",n.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(n.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[n.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:n.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",n.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",n.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",n.profit?.toLocaleString()||0]})]},n.id))})]})})]})]})}function Rt(){const[s,c]=a.useState([]),[u,g]=a.useState(!1),[r,t]=a.useState({description:"",amount:"",category:"general"});a.useEffect(()=>{l()},[]);const l=async()=>{const p=await Ds.getAll();c(p.reverse())},b=async p=>{p.preventDefault(),await Ds.create({...r,amount:parseFloat(r.amount)}),t({description:"",amount:"",category:"general"}),g(!1),l()},m=s.reduce((p,i)=>p+i.amount,0),n=s.filter(p=>!p.automatic),f=s.filter(p=>p.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("button",{onClick:()=>g(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",m.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",n.reduce((p,i)=>p+i.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",f.reduce((p,i)=>p+i.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:s.map(p=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(p.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:p.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:p.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${p.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:p.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",p.amount?.toLocaleString()]})]},p.id))})]})})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:r.description,onChange:p=>t({...r,description:p.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:r.amount,onChange:p=>t({...r,amount:p.target.value}),required:!0}),e.jsxs("select",{className:"input",value:r.category,onChange:p=>t({...r,category:p.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function qt(){const{isCashierUserManagementEnabled:s,isCashier:c}=he(),[u,g]=a.useState([]),[r,t]=a.useState(!0),[l,b]=a.useState(!1),[m,n]=a.useState(null),[f,p]=a.useState(null),[i,C]=a.useState(null),[d,y]=a.useState(0),[N,j]=a.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),[w,P]=a.useState(!1),[A,q]=a.useState(null),[x,L]=a.useState("");a.useEffect(()=>{S()},[]),a.useEffect(()=>()=>{i?.intervalId&&clearInterval(i.intervalId)},[i]);const S=async()=>{try{t(!0);const v=await Ae.getAll();g(Array.isArray(v)?v:[])}catch(v){console.error("Error loading users:",v),g([])}finally{t(!1)}},k=()=>Math.floor(1e3+Math.random()*9e3).toString(),D=async v=>{if(v.preventDefault(),console.log("Form submitted with data:",N),!N.name?.trim()||!N.email?.trim()||!N.password?.trim()){alert("Please fill in all required fields");return}if(N.password.length<6){alert("Password must be at least 6 characters long");return}try{t(!0);const $=k(),F={name:N.name.trim(),email:N.email.trim().toLowerCase(),password:N.password.trim(),pin:$};console.log("Sending user data:",F);const K=await Ae.create(F);console.log("User creation result:",K),await S();const Y=`âœ… Cashier added successfully!

ðŸ“§ Email: ${F.email}
ðŸ”‘ Password: ${F.password}
ðŸ”¢ PIN: ${$}

ðŸ’¡ LOGIN OPTIONS:
1. Email + Password: Use email and password above
2. PIN Login: Use email + ${$}

Please share these credentials securely with the new cashier.`;alert(Y),j({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),b(!1)}catch($){console.error("Error creating cashier:",$);let F="Failed to add cashier";$.message.includes("Current user not found")?F="Authentication error. Please refresh the page and try again.":$.message.includes("email")?F="Email already exists. Please use a different email.":$.message.includes("network")||$.message.includes("fetch")?F="Network error. Please check your connection and try again.":$.message&&(F=`Failed to add cashier: ${$.message}`),alert(F)}finally{t(!1)}},z=async(v,$)=>{try{t(!0),await Ae.update(v,{permissions:$}),await S(),n(null)}catch(F){console.error("Error updating permissions:",F),alert("Failed to update permissions: "+F.message)}finally{t(!1)}},se=async(v,$)=>{try{t(!0);const F=!$,K=await fetch(`${Z}/users/${v}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({active:F})});if(!K.ok){const Y=await K.json().catch(()=>({error:"Network error"}));throw new Error(Y.error||`HTTP ${K.status}: ${K.statusText}`)}await S()}catch(F){console.error("Error updating user status:",F),alert("Failed to update user status: "+F.message)}finally{t(!1)}},Ce=async(v,$)=>{try{t(!0);const F=!$,K=await fetch(`${Z}/users/${v}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({locked:F})});if(!K.ok){const Y=await K.json().catch(()=>({error:"Network error"}));throw new Error(Y.error||`HTTP ${K.status}: ${K.statusText}`)}await S()}catch(F){console.error("Error updating user lock status:",F),alert("Failed to update user lock status: "+F.message)}finally{t(!1)}},ue=async v=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{t(!0),await Ae.delete(v),await S()}catch($){console.error("Error deleting user:",$),alert("Failed to delete user: "+$.message)}finally{t(!1)}},_=v=>{q(v),L(k()),P(!0)},W=async()=>{try{t(!0),await Ae.update(A.id,{cashierPIN:x}),await S(),P(!1),q(null),L(""),alert(`âœ… PIN reset successfully!

ðŸ”¢ New PIN for ${A.name}: ${x}

Please share this PIN securely with the cashier.`)}catch(v){console.error("Error resetting PIN:",v),alert("Failed to reset PIN: "+v.message)}finally{t(!1)}},G=v=>{p(v),C({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const $=setInterval(()=>{O(v)},3e3);C(F=>({...F,intervalId:$})),O(v)},ae=()=>{i?.intervalId&&clearInterval(i.intervalId),p(null),C(null)},O=async v=>{try{const $=await He.getAll(),K=(Array.isArray($)?$:[]).filter(ne=>ne.cashierId===v.id).sort((ne,X)=>new Date(X.createdAt)-new Date(ne.createdAt)).slice(0,10),Y={isActive:Math.random()>.3,currentCart:K.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:K.reduce((ne,X)=>ne+X.total,0),salesCount:K.length,lastActivity:K.length>0?new Date(K[0].createdAt).toLocaleTimeString():"No recent activity"};C(Y)}catch($){console.error("Error loading live view data:",$)}},J=(u||[]).filter(v=>v.role==="cashier");return r&&u.length===0?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),s()&&e.jsxs("button",{onClick:()=>b(!0),className:"btn-primary flex items-center gap-2",disabled:r,children:[e.jsx(le,{className:"w-4 h-4"}),"Add Cashier"]})]}),c()&&!s()&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(re,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"User Management Restricted"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The admin has disabled cashier user management. You cannot add, edit, or remove users at this time."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:u.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:J.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:u.filter(v=>v.active).length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(u||[]).map(v=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:v.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:v.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${v.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:v.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:v.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:v.role==="cashier"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:v.pin||v.cashierPIN||"----"}),e.jsx("button",{onClick:()=>_(v),className:"p-1 hover:bg-yellow-50 rounded text-yellow-600",title:"Reset PIN",disabled:r,children:e.jsx(ve,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${v.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:v.active?e.jsxs(e.Fragment,{children:[e.jsx(xs,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(vs,{className:"w-3 h-3"}),"Inactive"]})}),v.locked&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:[e.jsx(we,{className:"w-3 h-3"}),"Locked"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[s()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>se(v.id,v.active),className:`p-2 rounded-lg transition ${v.active?"hover:bg-red-50 text-red-600":"hover:bg-green-50 text-green-600"}`,title:v.active?"Deactivate User":"Activate User",disabled:r,children:v.active?e.jsx(vs,{className:"w-4 h-4"}):e.jsx(xs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ce(v.id,v.locked||!1),className:`p-2 rounded-lg transition ${v.locked?"hover:bg-green-50 text-green-600":"hover:bg-red-50 text-red-600"}`,title:v.locked?"Unlock User":"Lock User",disabled:r,children:e.jsx(we,{className:"w-4 h-4"})})]}),v.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",v.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(ps,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>G(v),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(ws,{className:"w-4 h-4"})})]}),s()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>n(v),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600",title:"Edit Permissions",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ue(v.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",title:"Delete User",disabled:r,children:e.jsx(ce,{className:"w-4 h-4"})})]})]})})]},v.id))})]}),u.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first cashier to get started"})]})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:N.name||"",onChange:v=>{console.log("Name input changed:",v.target.value),j({...N,name:v.target.value})},required:!0,disabled:r}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:N.email||"",onChange:v=>{console.log("Email input changed:",v.target.value),j({...N,email:v.target.value})},required:!0,disabled:r}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:N.password||"",onChange:v=>{console.log("Password input changed:",v.target.value),j({...N,password:v.target.value})},required:!0,minLength:6,disabled:r}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(N.permissions).map(([v,$])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:F=>j({...N,permissions:{...N.permissions,[v]:F.target.checked}}),disabled:r}),e.jsx("span",{className:"text-sm capitalize",children:v.replace(/([A-Z])/g," $1").trim()})]},v))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:r,children:r?"Adding...":"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>b(!1),className:"btn-secondary",disabled:r,children:"Cancel"})]})]})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",m.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(m.permissions||{}).map(([v,$])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:F=>n({...m,permissions:{...m.permissions,[v]:F.target.checked}}),disabled:r}),e.jsx("span",{className:"text-sm capitalize",children:v.replace(/([A-Z])/g," $1").trim()})]},v))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>z(m.id,m.permissions),className:"btn-primary flex-1",disabled:r,children:r?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>n(null),className:"btn-secondary",disabled:r,children:"Cancel"})]})]})}),f&&i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(ws,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",f.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:ae,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(_e,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${i.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:i.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Last Activity: ",i.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Oe,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(i.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(i.currentCart||[]).map((v,$)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[v.name," x",v.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",v.price.toLocaleString()]})]},$)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(i.currentCart||[]).reduce((v,$)=>v+$.price*$.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:i.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",i.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",i.salesCount>0?Math.round(i.totalSalesToday/i.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})}),w&&A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Reset PIN for ",A.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate a new 4-digit PIN for this cashier. The old PIN will be invalid."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"New PIN:"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-mono text-3xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:x})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>L(k()),className:"btn-secondary flex-1",disabled:r,children:"Generate New PIN"}),e.jsx("button",{onClick:W,className:"btn-primary flex-1",disabled:r,children:r?"Updating...":"Confirm & Update"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>{P(!1),q(null),L("")},className:"btn-secondary w-full",disabled:r,children:"Cancel"})})]})})]})}function Mt(){const[s,c]=a.useState([]),[u,g]=a.useState("all");a.useEffect(()=>{r()},[]);const r=()=>{const m=JSON.parse(localStorage.getItem("clockRecords")||"[]");c(m.reverse())},t=u==="all"?s:s.filter(m=>m.date===new Date().toDateString()),l=t.filter(m=>m.date===new Date().toDateString()).reduce((m,n)=>m+n.duration,0)/60,b=m=>{const n=Math.floor(m/60),f=m%60;return`${n}h ${f}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(Ze,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[l.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(gs,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(t.filter(m=>m.date===new Date().toDateString()).map(m=>m.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(je,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:s.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${u==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>g("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${u==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"})]})}),e.jsx("tbody",{children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-gray-500",children:"No records found"})}):t.map((m,n)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:m.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(m.clockIn).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(m.clockIn).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(m.clockOut).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:b(m.duration)})})]},n))})]})})]})]})}function _t(){const{user:s,updateUser:c}=he();ke();const[u,g]=a.useState(!1),[r,t]=a.useState(s?.plan||"ultra"),[l,b]=a.useState({}),[m,n]=a.useState(null),[f,p]=a.useState(s?.profilePicture||null),[i,C]=a.useState(!0),[d,y]=a.useState(!0);a.useEffect(()=>{N()},[]);const N=async()=>{try{const S=await Me.get();b(S),S.logo&&n(S.logo),C(S.cashierUserManagement!==!1),y(S.realTimeProductSync!==!1)}catch(S){console.error("Failed to load settings:",S)}},j=async S=>{try{const k={...l,...S};return await Me.update(k),b(k),!0}catch(k){return console.error("Failed to save settings:",k),!1}},w=async()=>{const S=!i;C(S),await j({cashierUserManagement:S})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{cashierUserManagement:S}})),alert(`âœ… Cashier User Management ${S?"ENABLED":"DISABLED"}`)):(C(!S),alert("âŒ Failed to save setting. Please try again."))},P=async()=>{const S=!d;y(S),await j({realTimeProductSync:S})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{realTimeProductSync:S}})),alert(`âœ… Real-time Product Sync ${S?"ENABLED":"DISABLED"}`)):(y(!S),alert("âŒ Failed to save setting. Please try again."))},A=async S=>{const k=S.target.files[0];if(k){const D=new FileReader;D.onloadend=async()=>{const z=D.result;n(z);try{await Me.update({...l,logo:z}),b({...l,logo:z})}catch(se){console.error("Failed to save logo:",se)}},D.readAsDataURL(k)}},q=async S=>{const k=S.target.files[0];if(k){const D=new FileReader;D.onloadend=async()=>{const z=D.result;p(z);try{await c({...s,profilePicture:z})}catch(se){console.error("Failed to save profile picture:",se)}},D.readAsDataURL(k)}},x=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],L=async()=>{const S=x.find(D=>D.id===r),k=r==="ultra"?"admin":"cashier";await c({...s,role:k,plan:r,price:S.price}),g(!1),setTimeout(()=>window.location.href=k==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(gs,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[f?e.jsx("img",{src:f,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:s?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(Ss,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:q})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:s?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:s?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:s?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Be,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[s?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",s?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>g(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(bs,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cashier User Management"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Cashier User Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow cashiers to add and remove users"})]}),e.jsx("button",{onClick:w,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${i?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${i?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${i?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:i?"âœ… Cashiers can add and remove users when enabled":"âŒ Cashiers cannot add or remove users when disabled"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Fs,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Real-time Product Sync"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Real-time Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync products between admin and cashier dashboards"})]}),e.jsx("button",{onClick:P,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${d?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${d?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${d?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:d?"âœ… Products will sync in real-time across all dashboards":"âŒ Products will not sync automatically across dashboards"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(we,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(ct,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[m&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:m,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(Ss,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:A})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:x.map(S=>e.jsxs("div",{onClick:()=>t(S.id),className:`card cursor-pointer transition-all ${r===S.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:S.name}),r===S.id&&e.jsx(Qe,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",S.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:S.features.map((k,D)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Qe,{className:"w-4 h-4 text-green-600"}),k]},D))})]},S.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:L,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function Bt(){const[s,c]=a.useState([]),[u,g]=a.useState(!1),[r,t]=a.useState(null),[l,b]=a.useState({name:"",amount:"",description:"",active:!0});a.useEffect(()=>{m()},[]);const m=()=>{const i=JSON.parse(localStorage.getItem("serviceFees")||"[]");c(i)},n=i=>{localStorage.setItem("serviceFees",JSON.stringify(i)),c(i)},f=i=>{if(i.preventDefault(),r){const C=s.map(d=>d.id===r.id?{...l,id:d.id}:d);n(C)}else{const C={...l,id:Date.now(),createdAt:new Date().toISOString()};n([...s,C])}g(!1),t(null),b({name:"",amount:"",description:"",active:!0})},p=i=>{confirm("Delete this service fee?")&&n(s.filter(C=>C.id!==i))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{g(!0),t(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:s.map(i=>e.jsxs("div",{className:`card ${i.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(ye,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:i.name}),e.jsx("p",{className:"text-xs text-gray-500",children:i.description})]})]}),e.jsx("span",{className:`badge ${i.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:i.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",i.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{t(i),b(i),g(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(ve,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>p(i.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(ce,{className:"w-4 h-4 text-red-600"})})]})]})]},i.id))}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[r?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:l.name,onChange:i=>b({...l,name:i.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:l.amount,onChange:i=>b({...l,amount:i.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:l.description,onChange:i=>b({...l,description:i.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.active,onChange:i=>b({...l,active:i.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ht(){const[s,c]=a.useState([]),[u,g]=a.useState([]),[r,t]=a.useState(!1),[l,b]=a.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});a.useEffect(()=>{m(),n()},[]);const m=async()=>{try{const d=localStorage.getItem("token"),y=await fetch(`${Z}/reminders`,{headers:{Authorization:`Bearer ${d}`}});if(!y.ok){console.error("API Error:",y.status,y.statusText),c([]);return}const N=await y.json();Array.isArray(N)?c(N):(console.error("Expected array but got:",typeof N,N),c([]))}catch(d){console.error("Failed to fetch reminders:",d),c([])}},n=async()=>{try{const d=localStorage.getItem("token"),y=await fetch(`${Z}/products`,{headers:{Authorization:`Bearer ${d}`}});if(!y.ok){console.error("API Error:",y.status,y.statusText),g([]);return}const N=await y.json();Array.isArray(N)?g(N):(console.error("Expected array but got:",typeof N,N),g([]))}catch(d){console.error("Failed to fetch products:",d),g([])}},f=async d=>{d.preventDefault();try{const y=localStorage.getItem("token"),N=await fetch(`${Z}/reminders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`},body:JSON.stringify(l)});if(!N.ok){const w=await N.json();console.error("Failed to create reminder:",w),alert(`Failed to create reminder: ${w.error||"Unknown error"}`);return}const j=await N.json();b({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),t(!1),m(),alert("Reminder created successfully!")}catch(y){console.error("Failed to create reminder:",y),alert("Failed to create reminder. Please try again.")}},p=async d=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const N=localStorage.getItem("token"),j=await fetch(`${Z}/reminders/${d}`,{method:"DELETE",headers:{Authorization:`Bearer ${N}`}});if(!j.ok){const w=await j.json();console.error("Failed to delete reminder:",w),alert(`Failed to delete reminder: ${w.error||"Unknown error"}`);return}m(),alert("Reminder deleted successfully!")}catch(y){console.error("Failed to delete reminder:",y),alert("Failed to delete reminder. Please try again.")}},i=d=>{l.days.includes(d)?b({...l,days:l.days.filter(y=>y!==d)}):b({...l,days:[...l.days,d]})},C=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(bs,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("button",{onClick:()=>t(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(le,{size:20}),"New Reminder"]})]}),e.jsx("div",{className:"grid gap-4",children:s.map(d=>{const y=u.find(N=>N.id===d.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${d.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:d.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",y?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",d.frequency]}),d.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",d.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(je,{size:16}),"Next: ",new Date(d.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${d.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:d.status}),e.jsx("button",{onClick:()=>p(d.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(ce,{size:20})})]})]})},d.id)})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:l.customerName,onChange:d=>b({...l,customerName:d.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:l.productId,onChange:d=>b({...l,productId:parseInt(d.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),u.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:l.frequency,onChange:d=>b({...l,frequency:d.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),l.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:C.map(d=>e.jsx("button",{type:"button",onClick:()=>i(d),className:`px-4 py-2 rounded-lg font-medium transition ${l.days.includes(d)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:d},d))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:l.nextDate,onChange:d=>b({...l,nextDate:d.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>t(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})}function Kt(){const[s,c]=a.useState([]),[u,g]=a.useState(!1),[r,t]=a.useState(null),[l,b]=a.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});a.useEffect(()=>{m()},[]);const m=async()=>{try{const i=await Ve.getAll();c(i)}catch(i){console.error("Failed to load discounts:",i)}},n=async i=>{i.preventDefault();try{r?await Ve.update(r.id,l):await Ve.create(l),g(!1),t(null),b({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),m()}catch(C){console.error("Failed to save discount:",C)}},f=async i=>{if(confirm("Delete this discount?"))try{await Ve.delete(i),m()}catch(C){console.error("Failed to delete discount:",C)}},p=i=>{const C=new Date,d=new Date(i.validFrom),y=new Date(i.validTo);return i.active&&d<=C&&y>=C};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{g(!0),t(null),b({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.map(i=>e.jsxs("div",{className:`card ${p(i)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${p(i)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(Se,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:i.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[i.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${p(i)?"badge-success":"bg-gray-200 text-gray-600"}`,children:p(i)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(i.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(i.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{t(i),b(i),g(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(ve,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>f(i.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(ce,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},i.id)),s.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(Se,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[r?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:n,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:l.name,onChange:i=>b({...l,name:i.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:l.percentage,onChange:i=>b({...l,percentage:parseFloat(i.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:l.validFrom,onChange:i=>b({...l,validFrom:i.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:l.validTo,onChange:i=>b({...l,validTo:i.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.active,onChange:i=>b({...l,active:i.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function zt(){const[s,c]=a.useState([]),[u,g]=a.useState([]),[r,t]=a.useState("all");a.useEffect(()=>{l(),b()},[]);const l=async()=>{try{const d=await qe.getAll();c(d)}catch(d){console.error("Failed to load credit requests:",d)}},b=async()=>{try{const d=await ie.getAll();g(d)}catch(d){console.error("Failed to load products:",d)}},m=async d=>{try{await qe.approve(d),l()}catch(y){console.error("Failed to approve request:",y)}},n=async d=>{try{await qe.reject(d),l()}catch(y){console.error("Failed to reject request:",y)}},f=d=>{const y=u.find(N=>N.id===d);return y?y.name:"Unknown Product"},p=s.filter(d=>r==="all"?!0:d.status===r),i=d=>{switch(d){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},C=d=>{switch(d){case"pending":return e.jsx(Ze,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(Ee,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(ks,{className:"w-6 h-6 text-red-600"});default:return e.jsx(Be,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(d=>e.jsx("button",{onClick:()=>t(d),className:`px-4 py-2 rounded-lg font-medium transition ${r===d?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:d.charAt(0).toUpperCase()+d.slice(1)},d))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[p.map(d=>e.jsx("div",{className:`card border-l-4 ${i(d.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${d.status==="pending"?"bg-orange-600":d.status==="approved"?"bg-green-600":"bg-red-600"}`,children:C(d.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:d.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:f(d.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:d.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",d.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(d.createdAt).toLocaleString()]}),d.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(d.approvedAt).toLocaleString()]})]})]}),d.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>m(d.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Ee,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>n(d.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(ks,{size:16}),"Reject"]})]}),d.status!=="pending"&&e.jsx("span",{className:`badge ${d.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:d.status.toUpperCase()})]})},d.id)),p.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(Be,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",r!=="all"?r:""," credit requests found."]})]})]})]})}function zs({onClose:s}){const[c,u]=a.useState([]),[g,r]=a.useState(!0);a.useEffect(()=>{t()},[]);const t=async()=>{try{const b=localStorage.getItem("token"),m=await fetch(`${Z}/reminders/today`,{headers:{Authorization:`Bearer ${b}`}});if(!m.ok){console.error("API Error:",m.status,m.statusText),u([]);return}const n=await m.json();Array.isArray(n)?u(n):(console.error("Expected array but got:",typeof n,n),u([]))}catch(b){console.error("Failed to fetch reminders:",b),u([])}finally{r(!1)}},l=async b=>{try{const m=localStorage.getItem("token");await fetch(`${Z}/reminders/${b}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({status:"fulfilled"})}),t()}catch(m){console.error("Failed to update reminder:",m)}};return g?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:s,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(_e,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ye,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):c.map(b=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:b.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",b.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:b.frequency})]}),e.jsxs("button",{onClick:()=>l(b.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Ee,{size:18}),"Mark Done"]})]},b.id))})]})})}function Js({onUnlock:s,userType:c="user"}){const[u,g]=a.useState(""),[r,t]=a.useState(""),[l,b]=a.useState("password"),[m,n]=a.useState(!1),[f,p]=a.useState(""),[i,C]=a.useState(!1),[d,y]=a.useState("2005"),N=JSON.parse(localStorage.getItem("user")||"{}");a.useEffect(()=>{(async()=>{try{const A=await Me.get();A?.screenLockPassword&&y(A.screenLockPassword)}catch(A){console.warn("Failed to load settings, using default password:",A)}})()},[]),a.useEffect(()=>{const P=document.getElementById(l==="password"?"unlock-password":"unlock-pin");P&&P.focus()},[l]);const j=async P=>{P.preventDefault(),P.stopPropagation(),C(!0),p("");try{if(l==="password")if(u===d)s();else throw new Error("Incorrect password");else if(l==="pin"&&N.pin)if(r===N.pin)s();else throw new Error("Incorrect PIN");else throw new Error(`Please enter a valid ${l}`)}catch(A){p(A.message||"Unlock failed")}finally{C(!1)}},w=P=>{const A=P.replace(/\D/g,"").slice(0,4);t(A)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:P=>P.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8",onClick:P=>P.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${c==="main_admin"?"bg-gradient-to-br from-red-600 to-orange-600":"bg-gradient-to-br from-blue-600 to-purple-600"}`,children:e.jsx(re,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-gray-600",children:c==="main_admin"?"Main Admin":N.name||"User"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Enter your ",l," to continue"]})]}),e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[c!=="main_admin"&&N.pin&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unlock Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{b("password"),p("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${l==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ”‘ Password"}),e.jsx("button",{type:"button",onClick:()=>{b("pin"),p("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${l==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ“± PIN"})]})]}),(l==="password"||c==="main_admin")&&e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-password",type:m?"text":"password",placeholder:"Enter your password",className:"w-full pl-10 pr-12 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",value:u,onChange:P=>g(P.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>n(!m),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:m?e.jsx(Os,{className:"w-5 h-5"}):e.jsx(ps,{className:"w-5 h-5"})})]}),l==="pin"&&c!=="main_admin"&&e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-pin",type:"text",placeholder:"Enter 4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-center text-2xl tracking-widest",value:r,onChange:P=>w(P.target.value),maxLength:4,required:!0})]}),f&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg border border-red-200",children:f}),e.jsx("button",{type:"submit",disabled:i||l==="pin"&&r.length!==4,className:`w-full py-3 rounded-lg font-bold transition-all disabled:opacity-50 disabled:cursor-not-allowed ${c==="main_admin"?"bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white":"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white"}`,children:i?"Unlocking...":"Unlock Screen"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Screen locked due to inactivity for security"})})]})})}function Gs(s=6e4){const[c,u]=a.useState(!1),[g,r]=a.useState(Date.now()),t=a.useCallback(()=>{r(Date.now()),c&&u(!1)},[c]),l=a.useCallback(()=>{u(!1),t()},[t]);return a.useEffect(()=>{const b=["mousedown","mousemove","keypress","scroll","touchstart","click"],m=()=>{t()};b.forEach(f=>{document.addEventListener(f,m,!0)});const n=setInterval(()=>{Date.now()-g>s&&!c&&u(!0)},1e3);return()=>{b.forEach(f=>{document.removeEventListener(f,m,!0)}),clearInterval(n)}},[g,s,c,t]),[c,l,t]}function Jt(){const{user:s,logout:c,isCashierUserManagementEnabled:u}=he(),g=ke(),r=hs(),[t,l]=a.useState(!0),[b,m]=a.useState(!1),[n,f]=a.useState({}),[p,i]=Gs(45e3);a.useEffect(()=>{const j=()=>{const P=localStorage.getItem("user");if(P){const A=JSON.parse(P);let q=!1;(A.plan==="ultra"||A.role==="admin")&&(A.active||(A.active=!0,q=!0),A.plan==="ultra"&&A.role!=="admin"&&(A.role="admin",q=!0),A.plan==="ultra"&&(!A.price||A.price!==1600)&&(A.price=1600,q=!0),q&&(localStorage.setItem("user",JSON.stringify(A)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};j(),setTimeout(j,100);const w=setTimeout(()=>{m(!0)},1e3);return C(),()=>clearTimeout(w)},[]);const C=async()=>{try{const j=await Me.get();f(j)}catch(j){console.error("Failed to load settings:",j)}},d=async()=>{if(window.confirm("Are you sure you want to clear all sales and data? This action cannot be undone."))try{const j=localStorage.getItem("token");await fetch(`${Z}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})}),alert("Data cleared successfully!"),window.location.reload()}catch(j){console.error("Failed to clear data:",j),alert("Failed to clear data")}},y=[{id:"overview",label:"Dashboard",icon:ot,path:"/admin"},{id:"sales",label:"Sales",icon:Ls,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:Ne,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:Rs,path:"/admin/recipes"},{id:"expenses",label:"Expenses",icon:Us,path:"/admin/expenses"},...u()?[{id:"users",label:"Users",icon:fe,path:"/admin/users"}]:[],{id:"time",label:"Time Tracking",icon:Ze,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:bs,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:ye,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:Se,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:Be,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:Te,path:"/admin/settings"}],N=j=>j==="/admin"?r.pathname==="/admin":r.pathname.startsWith(j);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${t?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[t&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>l(!t),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t?e.jsx(_e,{className:"w-5 h-5"}):e.jsx(dt,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:y.map(j=>{const w=j.icon;return e.jsxs("button",{onClick:()=>g(j.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${N(j.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(w,{className:"w-5 h-5 flex-shrink-0"}),t&&e.jsx("span",{className:"font-medium",children:j.label})]},j.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(mt,{className:"w-5 h-5 flex-shrink-0"}),t&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:c,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(Re,{className:"w-5 h-5 flex-shrink-0"}),t&&e.jsx("span",{className:"font-medium",children:"Logout"})]}),e.jsxs("button",{onClick:d,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors",children:[e.jsx(_e,{className:"w-5 h-5 flex-shrink-0"}),t&&e.jsx("span",{className:"font-medium",children:"Clear Data"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:y.find(j=>N(j.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:s?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(Ts,{children:[e.jsx(H,{path:"/",element:e.jsx(Ut,{})}),e.jsx(H,{path:"/sales",element:e.jsx(Ot,{})}),e.jsx(H,{path:"/inventory",element:e.jsx($t,{})}),e.jsx(H,{path:"/recipes",element:e.jsx(Ft,{})}),e.jsx(H,{path:"/expenses",element:e.jsx(Rt,{})}),e.jsx(H,{path:"/reminders",element:e.jsx(Ht,{})}),e.jsx(H,{path:"/service-fees",element:e.jsx(Bt,{})}),e.jsx(H,{path:"/discounts",element:e.jsx(Kt,{})}),e.jsx(H,{path:"/credit-requests",element:e.jsx(zt,{})}),e.jsx(H,{path:"/users",element:e.jsx(qt,{})}),e.jsx(H,{path:"/time",element:e.jsx(Mt,{})}),e.jsx(H,{path:"/settings",element:e.jsx(_t,{})})]})})]}),b&&e.jsx(zs,{onClose:()=>m(!1)}),p&&e.jsx(Js,{onUnlock:i,logo:n.logo})]})}function Gt(){const s=ke(),[c,u]=a.useState(!1),[g,r]=a.useState(0),t=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 900) or Ultra (KSH 1,600) package",image:"ðŸ“",details:"First user becomes Admin automatically. Choose Ultra for full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],l=[{icon:Ne,title:"Smart Inventory",desc:"Track raw materials & composite products with automatic stock deduction"},{icon:Rs,title:"Recipe Builder",desc:"Create bundled products with BOM and auto-calculate COGS"},{icon:Ie,title:"Real-time Analytics",desc:"Monitor sales, profit margins, and expenses in real-time"},{icon:fe,title:"User Management",desc:"Add cashiers with custom permissions and role-based access"},{icon:we,title:"Secure & Reliable",desc:"JWT authentication with role-based security"},{icon:us,title:"Advanced Reports",desc:"Daily, weekly summaries with profit/loss tracking"}],b=[{name:"Basic",price:900,icon:qs,popular:!1,features:["Cashier Dashboard","Basic Inventory","Sales Tracking","Daily/Weekly Reports","Single User","Email Support"]},{name:"Ultra",price:1600,icon:fs,popular:!0,features:["Admin + Cashier Dashboard","Full Inventory Management","Recipe/BOM Builder","Auto Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Unlimited Users","Priority Support"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s("/auth/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>s("/plans"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(xt,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>s("/plans"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(Je,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>u(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(ut,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 30-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(us,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:l.map((m,n)=>{const f=m.icon;return e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(f,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:m.title}),e.jsx("p",{className:"text-gray-600",children:m.desc})]},n)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:b.map((m,n)=>{const f=m.icon;return e.jsxs("div",{className:`relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${m.popular?"ring-4 ring-blue-600":""}`,children:[m.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${m.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(f,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:m.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",m.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:m.features.map((p,i)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Qe,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:p})]},i))}),e.jsx("button",{onClick:()=>s("/plans"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${m.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},n)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>s("/plans"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(Je,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{u(!1),r(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(_e,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",g+1," of ",t.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((g+1)/t.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(g+1)/t.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:t[g].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:t[g].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:t[g].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:t[g].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>r(Math.max(0,g-1)),disabled:g===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),g<t.length-1?e.jsxs("button",{onClick:()=>r(g+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(Je,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{u(!1),r(0),s("/plans")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(Je,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:t.map((m,n)=>e.jsx("button",{onClick:()=>r(n),className:`w-2 h-2 rounded-full transition-all ${n===g?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},n))})]})]})})]})}function Es(){const s=hs(),[c,u]=a.useState(s.pathname==="/auth/login"),[g,r]=a.useState("password"),[t,l]=a.useState({email:"",password:"",pin:"",name:"",newPassword:"",confirmPassword:""}),[b,m]=a.useState(""),[n,f]=a.useState(!1),[p,i]=a.useState(!1),C=ke(),{login:d}=he(),y=()=>{try{return JSON.parse(localStorage.getItem("selectedPlan")||"null")}catch(j){return console.warn("Invalid selectedPlan in localStorage:",j),null}},N=async j=>{j.preventDefault(),m(""),f(!0);try{if(p){if(t.newPassword!==t.confirmPassword){m("Passwords do not match"),f(!1);return}if(t.newPassword.length<6){m("Password must be at least 6 characters"),f(!1);return}const x=await De.login({email:t.email,newPassword:t.newPassword});x.token&&x.user&&(await d(x),C("/dashboard"));return}if(c){if(g==="pin"){if(!t.pin||t.pin.length!==4){m("Please enter a valid 4-digit PIN"),f(!1);return}}else if(!t.password){m("Please enter your password"),f(!1);return}}let w;if(c)if(g==="pin")try{w=await De.pinLogin({email:t.email,pin:t.pin})}catch(x){if(x.message.includes("PIN not set"))m("PIN not set for this user. Please use password login.");else if(x.message.includes("Invalid PIN"))m("Invalid PIN. Please try again.");else throw x;f(!1);return}else w=await De.login({email:t.email,password:t.password});else{const x=y();w=await De.signup({...t,plan:x?.id||"basic"})}if(w.needsPasswordSetup){i(!0),l({...t,email:w.email}),m(""),f(!1);return}if(!w||!w.user||!w.token)throw new Error("Authentication failed. Please try again.");const P={id:Date.now(),type:c?"login":"signup",user:{id:w.user.id,name:w.user.name,email:w.user.email,role:w.user.role,plan:w.user.plan},timestamp:new Date().toISOString(),ip:"Unknown",userAgent:navigator.userAgent},A=JSON.parse(localStorage.getItem("authActivities")||"[]");A.unshift(P),A.splice(50),localStorage.setItem("authActivities",JSON.stringify(A)),await d(w);const q=c?"logged in":"signed up";console.log(`âœ… User ${w.user.name} ${q} successfully`),w.user.role==="admin"?C("/admin"):w.user.role==="cashier"||w.user.plan==="basic"?C("/dashboard/cashier"):C("/admin")}catch(w){console.error("Authentication error:",w);let P=w.message||"Authentication failed. Please try again.";w.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),P="Invalid credentials. Please try again."),m(P)}finally{f(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:c?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600",children:c?"Login to your account":"Create your account"})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[p?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:t.newPassword,onChange:j=>l({...t,newPassword:j.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:t.confirmPassword,onChange:j=>l({...t,confirmPassword:j.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!c&&e.jsxs("div",{className:"relative",children:[e.jsx(gs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:t.name,onChange:j=>l({...t,name:j.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:t.email,onChange:j=>l({...t,email:j.target.value}),required:!0})]}),c&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Login Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>r("password"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${g==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Password"}),e.jsx("button",{type:"button",onClick:()=>r("pin"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${g==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"pin"})]})]}),c&&g==="password"&&e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:t.password,onChange:j=>l({...t,password:j.target.value}),required:!0})]}),c&&g==="pin"&&e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:t.pin,onChange:j=>l({...t,pin:j.target.value.replace(/\D/g,"").slice(0,4)}),maxLength:4,required:!0})]}),!c&&e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:t.password,onChange:j=>l({...t,password:j.target.value}),required:!0})]})]}),b&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:b}),e.jsx("button",{type:"submit",disabled:n,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50",children:n?"Please wait...":p?"Set Password":c?"Login":"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{u(!c),m(""),i(!1)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:c?"Don't have an account? Sign up":"Already have an account? Login"})})]})})}function Vt(){const[s,c]=a.useState("ultra"),[u,g]=a.useState(!1),[r,t]=a.useState({name:"",email:"",company:""}),l=ke(),b=[{id:"basic",name:"Basic Package",price:1e3,icon:qs,color:"from-green-500 to-teal-600",features:["Cashier Dashboard Only","Basic Inventory Management","Sales Tracking","Daily/Weekly Sales Summaries","Basic Profit/Loss View","Limited Email Notifications","Record Products Sold","Single User Access"]},{id:"ultra",name:"Ultra Package (Admin + Cashier)",price:2400,icon:fs,color:"from-blue-600 to-purple-600",popular:!0,features:["Admin Dashboard + Cashier POS","Full Inventory Management","Recipe/BOM Builder","Composite Products Support","Automatic Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Advanced Analytics","Unlimited Users"]}],m=async n=>{n.preventDefault();try{await fetch(`${Z}/demo-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),alert("Demo request submitted! Admin will review and contact you."),g(!1),t({name:"",email:"",company:""})}catch(f){console.error("Demo request failed:",f),alert("Failed to submit demo request. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:()=>l("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition",children:[e.jsx(ht,{size:20}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mb-8 md:mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Select the perfect plan for your business needs"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6 md:mb-8",children:b.map(n=>{const f=n.icon;return e.jsxs("div",{onClick:()=>c(n.id),className:`card cursor-pointer transition-all transform hover:scale-105 relative ${s===n.id?"ring-4 ring-blue-600 shadow-2xl bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-xl"}`,children:[n.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 md:mb-4",children:[e.jsx("div",{className:`w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br ${n.color} flex items-center justify-center`,children:e.jsx(f,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:n.name})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("span",{className:"text-3xl md:text-4xl font-bold",children:["KSH ",n.price]}),e.jsx("span",{className:"text-gray-600 text-sm md:text-base",children:"/month"})]}),e.jsx("ul",{className:"space-y-2 md:space-y-3",children:n.features.map((p,i)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs md:text-sm",children:p})]},i))})]},n.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center animate-fade-in",children:[e.jsx("button",{onClick:()=>{console.log("Get Started clicked with plan:",s);const n=b.find(f=>f.id===s);console.log("Selected plan:",n),localStorage.setItem("selectedPlan",JSON.stringify(n)),l("/auth/signup")},className:"btn-primary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all",children:"Get Started"}),e.jsx("button",{onClick:()=>g(!0),className:"btn-secondary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg border-2 border-gray-300 hover:border-gray-400 transition-all",children:"Request Free Demo"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-3 md:mt-4 text-center",children:"Secure payment â€¢ Cancel anytime"}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Free Demo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"We'll contact you to schedule a demo"})]}),e.jsxs("form",{onSubmit:m,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:r.name,onChange:n=>t({...r,name:n.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:r.email,onChange:n=>t({...r,email:n.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:r.company,onChange:n=>t({...r,company:n.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition",children:"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})})}function Wt({originalPrice:s,onApply:c}){const[u,g]=a.useState([]),[r,t]=a.useState(null),[l,b]=a.useState(!0);a.useEffect(()=>{m()},[]);const m=async()=>{try{const p=localStorage.getItem("token"),C=await fetch(`${Z}/discounts`,{headers:{Authorization:`Bearer ${p}`}});if(C.ok){const d=await C.json(),y=new Date,N=d.filter(j=>{if(!j.active)return!1;const w=new Date(j.validFrom),P=new Date(j.validTo);return w<=y&&P>=y});g(N)}}catch(p){console.error("Failed to fetch discounts:",p),g([])}finally{b(!1)}},n=p=>{t(p);const i=s*p.percentage/100,C=s-i;c({discount:p,newPrice:C,discountAmount:i})},f=()=>{t(null),c({discount:null,newPrice:s,discountAmount:0})};return l?e.jsxs("div",{className:"flex items-center justify-center p-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Loading discounts..."})]}):u.length===0?e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx(Se,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No active discounts available"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(pt,{className:"w-4 h-4 text-blue-600"}),"Available Discounts"]}),r&&e.jsx("button",{onClick:f,className:"text-xs text-red-600 hover:text-red-800 underline",children:"Clear discount"})]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:u.map(p=>{const i=s*p.percentage/100,C=s-i,d=r?.id===p.id;return e.jsxs("button",{onClick:()=>n(p),className:`w-full p-3 rounded-lg border-2 transition-all text-left ${d?"border-green-500 bg-green-50 shadow-md":"border-gray-200 hover:border-blue-400 hover:bg-blue-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"text-red-500",size:16}),e.jsx("span",{className:"font-bold text-gray-800",children:p.name}),e.jsxs("span",{className:"bg-red-500 text-white px-2 py-1 rounded text-xs font-bold",children:[p.percentage,"% OFF"]})]}),d&&e.jsx("div",{className:"w-5 h-5 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"âœ“"})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Save KSH ",i.toFixed(2)]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-gray-400 line-through text-sm",children:["KSH ",s.toFixed(2)]}),e.jsxs("p",{className:"text-green-600 font-bold text-lg",children:["KSH ",C.toFixed(2)]})]})]})]},p.id)})}),r&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-green-700 font-medium",children:["Applied: ",r.name]}),e.jsxs("span",{className:"text-green-600 font-bold",children:["-",r.percentage,"%"]})]}),e.jsxs("p",{className:"text-green-600 text-sm mt-1",children:["You save KSH ",(s*r.percentage/100).toFixed(2)]})]})]})}function Yt({product:s,onAddToCart:c,onRequestCredit:u,showDiscounts:g=!1}){const r=!!(s?.isComposite||s?.is_composite),t=r?s?.maxUnits??0:s?.quantity??0,l=t>0;return e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1",children:[s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-48 object-cover"}):e.jsx("div",{className:"w-full h-48 bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center",children:e.jsx(Ne,{size:64,className:"text-white"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800",children:s.name}),s.code&&e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium",children:s.code})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-2 capitalize",children:s.category}),s.notes&&e.jsx("p",{className:"text-gray-500 text-xs mb-3 italic bg-gray-50 p-2 rounded",children:s.notes}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:["KSH ",s.price?.toLocaleString()||0]}),e.jsx("div",{className:"text-right",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Producible: ",t]}),!l&&e.jsx("p",{className:"text-xs text-red-500",children:"Unavailable"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:`text-sm font-medium ${(s.quantity||0)<10?"text-red-600":"text-gray-600"}`,children:[s.quantity||0," ",s.unit||"pcs"]}),(s.quantity||0)<10&&e.jsx("p",{className:"text-xs text-red-500",children:"Low stock!"})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>c(s),disabled:!l,className:`flex-1 py-2 rounded-lg font-bold transition-all flex items-center justify-center gap-2 ${l?"bg-blue-600 text-white hover:bg-blue-700 hover:shadow-lg":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:[e.jsx(Oe,{size:18}),"Add to Cart"]}),u&&e.jsxs("button",{onClick:()=>u(s),className:"bg-orange-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-orange-600 transition-all hover:shadow-lg flex items-center gap-1",title:"Request credit for this product",children:[e.jsx(Be,{size:16}),"Credit"]})]})]})]})}function Qt(){const{user:s,logout:c,isUltraPackage:u,isBasicPackage:g,canEditStock:r,canManageUsers:t,canViewAnalytics:l,isRealTimeProductSyncEnabled:b,isCashierUserManagementEnabled:m}=he(),{products:n,refreshProducts:f}=Ks(),[p,i]=a.useState([]),[C,d]=a.useState([]),[y,N]=a.useState("cash"),[j,w]=a.useState(!0),[P,A]=a.useState("pos"),[q,x]=a.useState(!1),[L,S]=a.useState(null),[k,D]=a.useState({name:"",price:"",quantity:"",unit:"pcs"}),[z,se]=a.useState(""),[Ce,ue]=a.useState([]),[_,W]=a.useState({}),[G,ae]=a.useState(!1),[O,J]=a.useState(null),[v,$]=a.useState(!1),[F,K]=a.useState([]),[Y,ne]=a.useState([]),[X,Xe]=a.useState(null),[ee,pe]=a.useState({type:"percentage",value:"",reason:"",items:[]}),[Le,Pe]=a.useState(!1),[es,ss]=a.useState(Date.now()),[Ue,o]=a.useState(0),[E,U]=a.useState(!1),[I,B]=a.useState({name:"",email:"",password:"",confirmPassword:"",role:"cashier",cashierPIN:""});a.useEffect(()=>{de(),f();const h=localStorage.getItem(`clockIn_${s?.id}_${new Date().toDateString()}`);h&&(ae(!0),J(new Date(h)));const T=setInterval(()=>{console.log("ðŸ”„ Auto-refreshing products..."),Pe(!0),f().finally(()=>Pe(!1))},3e4);return()=>clearInterval(T)},[]),a.useEffect(()=>{if(n){const h=n.filter(T=>!T.pendingDelete&&!T.expenseOnly);i(h)}},[n]);const te=()=>{const h=new Date;localStorage.setItem(`clockIn_${s?.id}_${h.toDateString()}`,h.toISOString()),ae(!0),J(h)},ts=()=>{const h=new Date,T=localStorage.getItem(`clockIn_${s?.id}_${new Date().toDateString()}`);if(T){const M=new Date(T),ns=Math.floor((h-M)/1e3/60),Ns=JSON.parse(localStorage.getItem("clockRecords")||"[]");Ns.push({userId:s?.id,userName:s?.name,clockIn:M.toISOString(),clockOut:h.toISOString(),duration:ns,date:new Date().toDateString()}),localStorage.setItem("clockRecords",JSON.stringify(Ns)),localStorage.removeItem(`clockIn_${s?.id}_${new Date().toDateString()}`)}ae(!1),J(null)},oe=async h=>{h.preventDefault();try{if(I.password!==I.confirmPassword){alert("Passwords do not match");return}if(I.role==="cashier"&&(!I.cashierPIN||I.cashierPIN.length!==4)){alert("Please provide a valid 4-digit PIN for cashier accounts");return}const T={name:I.name,email:I.email,password:I.password,role:I.role,plan:I.role==="admin"?"1600":"900",active:!0,cashierPIN:I.cashierPIN||null,createdBy:s?.id,createdAt:new Date().toISOString()};console.log("Creating new user:",T),setTimeout(()=>{alert(`âœ… User "${I.name}" created successfully!

ðŸ“§ Email: ${I.email}
ðŸ‘¤ Role: ${I.role}
ðŸ“¦ Package: ${I.role==="admin"?"1600 Package":"900 Package"}
${I.cashierPIN?`ðŸ”¢ PIN: ${I.cashierPIN}`:""}

${I.role==="cashier"?"Cashier can now login with email and PIN from the landing page.":""}`),U(!1),B({name:"",email:"",password:"",confirmPassword:"",role:"cashier",cashierPIN:""})},1e3)}catch(T){console.error("Failed to create user:",T),alert("Failed to create user: "+T.message)}},de=async()=>{try{const[h,T,M,ns]=await Promise.all([He.getAll(),_s.get(),qe.getAll().catch(()=>[]),Y.getAll().catch(()=>[])]);ue(h.reverse()),W(T),K(M),ne(ns)}catch(h){console.error("Error loading data:",h),ue([]),W({}),K([]),ne([])}},as=h=>{const T=C.find(M=>M.id===h.id);d(T?C.map(M=>M.id===h.id?{...M,quantity:M.quantity+1}:M):[...C,{...h,quantity:1}])},$e=(h,T)=>{d(C.map(M=>M.id===h?{...M,quantity:Math.max(1,M.quantity+T)}:M).filter(M=>M.quantity>0))},Vs=h=>{d(C.filter(T=>T.id!==h))},Ws=async h=>{h.preventDefault();try{const T={type:ee.type,value:parseFloat(ee.value),reason:ee.reason,items:C.map(M=>({productId:M.id,quantity:M.quantity,price:M.price})),requestedBy:s?.id,requestedByName:s?.name,subtotal:ge,createdAt:new Date().toISOString()};await qe.create(T),$(!1),pe({type:"percentage",value:"",reason:"",items:[]}),await de(),alert("Discount request submitted successfully!")}catch(T){console.error("Failed to request discount:",T),alert("Failed to request discount: "+T.message)}},ge=C.reduce((h,T)=>h+T.price*T.quantity,0),rs=X?X.percentage/100:.05,Ke=ge*rs,ze=ge-Ke,js=j?0:ze*.16,ls=ze+js,Ys=({discount:h,newPrice:T,discountAmount:M})=>{Xe(h)},Qs=async()=>{if(C.length!==0)try{const h=await He.create({items:C.map(T=>({productId:T.id,quantity:T.quantity,price:T.price})),total:ls,paymentMethod:y});d([]),de(),alert(`âœ… Sale completed successfully!

ðŸ’° Total: KSH ${ls.toLocaleString()}
ðŸ“‹ Payment: ${y}
ðŸ§¾ Receipt #: ${h.id||"N/A"}

Thank you for your purchase!`)}catch(h){console.error("Checkout error:",h);let T="Failed to complete sale";h.message.includes("Failed to fetch")||h.message.includes("Network error")?T="Network error. Please check your connection and try again.":h.message.includes("401")||h.message.includes("unauthorized")?(T="Session expired. Please log in again.",localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/"):h.message&&(T=`Failed to complete sale: ${h.message}`),alert(T)}},ys=p.filter(h=>h.name?.toLowerCase().includes(z.toLowerCase()));return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-4 md:px-6 py-3 md:py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:u()?"Admin Dashboard":g()?"Cashier Dashboard":"POS System"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 hidden md:block",children:u()?"1600 Package - Full Admin Access":g()?"900 Package - Stock Management":"Package Access"})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsxs("div",{className:"text-right hidden md:block",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s?.email}),G&&O&&e.jsxs("p",{className:"text-xs text-green-600 font-medium",children:["Clocked in: ",O.toLocaleTimeString()]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:Le?e.jsxs("span",{className:"text-blue-600 flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse"}),"Updating..."]}):e.jsxs("span",{children:["Last update: ",new Date(es).toLocaleTimeString()]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[G?e.jsxs("button",{onClick:ts,className:"btn-secondary flex items-center gap-1 md:gap-2 text-sm md:text-base px-2 md:px-4 bg-red-50 text-red-600 border-red-200",children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Clock Out"})]}):e.jsxs("button",{onClick:te,className:"btn-secondary flex items-center gap-1 md:gap-2 text-sm md:text-base px-2 md:px-4 bg-green-50 text-green-600 border-green-200",children:[e.jsx(Re,{className:"w-4 h-4 rotate-180"}),e.jsx("span",{className:"hidden md:inline",children:"Clock In"})]}),e.jsxs("button",{onClick:()=>window.location.href="/cashier/settings",className:"btn-secondary flex items-center gap-1 md:gap-2 text-sm md:text-base px-2 md:px-4",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Settings"})]}),e.jsxs("button",{onClick:c,className:"btn-secondary flex items-center gap-1 md:gap-2 hover:bg-red-50 hover:text-red-600 hover:border-red-200 text-sm md:text-base px-2 md:px-4",children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Logout"})]})]})]})]})}),e.jsxs("div",{className:"flex gap-1 md:gap-2 px-2 md:px-6 py-2 md:py-4 bg-white border-b border-gray-200 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>A("pos"),className:`px-3 md:px-6 py-2 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base ${P==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Oe,{className:"w-4 h-4 inline mr-1 md:mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>A("sales"),className:`px-3 md:px-6 py-2 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base ${P==="sales"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(us,{className:"w-4 h-4 inline mr-1 md:mr-2"}),"Sales"]}),r()&&e.jsxs("button",{onClick:()=>A("stock"),className:`px-3 md:px-6 py-2 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base ${P==="stock"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ne,{className:"w-4 h-4 inline mr-1 md:mr-2"}),"Stock"]}),t()&&m()&&e.jsxs("button",{onClick:()=>A("users"),className:`px-3 md:px-6 py-2 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base ${P==="users"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Te,{className:"w-4 h-4 inline mr-1 md:mr-2"}),"Users"]}),t()&&!m()&&e.jsxs("button",{onClick:()=>alert("User Management has been disabled by the admin"),className:"px-3 md:px-6 py-2 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base bg-gray-200 text-gray-500 cursor-not-allowed opacity-60",title:"User Management disabled by admin",children:[e.jsx(Te,{className:"w-4 h-4 inline mr-1 md:mr-2"}),"Users (Disabled)"]})]}),P==="pos"&&e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1 p-3 md:p-6 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx($s,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:z,onChange:h=>se(h.target.value)})]}),e.jsxs("button",{onClick:()=>{console.log("ðŸ”„ Manual refresh triggered"),Pe(!0),de().finally(()=>{Pe(!1),ss(Date.now()),o(h=>h+1)})},disabled:Le,className:"btn-secondary flex items-center gap-2 px-4 py-2",title:"Refresh products manually",children:[e.jsx("svg",{className:`w-4 h-4 ${Le?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["ðŸ’¡ Products auto-refresh every 30 seconds. Current products: ",ys.length,Ue>0&&e.jsxs("span",{className:"ml-2 text-green-600",children:["â€¢ Updated ",Ue," time",Ue!==1?"s":""," this session"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:ys.map(h=>e.jsx(Yt,{product:h,onAddToCart:as,onRequestCredit:()=>{},showDiscounts:!0},h.id))})]}),e.jsxs("div",{className:"w-full md:w-96 bg-white border-t md:border-l md:border-t-0 border-gray-200 p-4 md:p-6 flex flex-col shadow-xl max-h-[50vh] md:max-h-none",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(Oe,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[C.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:C.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(Oe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:C.map(h=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:h.name}),e.jsx("button",{onClick:()=>Vs(h.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(ce,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>$e(h.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100",children:e.jsx(gt,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-semibold",children:h.quantity}),e.jsx("button",{onClick:()=>$e(h.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100",children:e.jsx(le,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(h.price*h.quantity).toLocaleString()]})]})]},h.id))})}),C.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-4 mb-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Se,{className:"w-4 h-4 text-white"})}),e.jsx("h4",{className:"font-semibold text-blue-900",children:"Available Discounts"})]}),Y.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"max-h-48 overflow-y-auto",children:e.jsx(Wt,{originalPrice:ge,onApply:Ys})}),X&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-green-700 font-medium",children:["Applied: ",X.name]})}),e.jsxs("span",{className:"text-green-600 font-bold",children:[X.percentage,"%"]})]})})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"No active discounts available"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Check with admin to set up discounts"})]}),e.jsxs("div",{className:"border-t-2 border-blue-300 pt-2 mt-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-blue-900",children:"Total Discount Applied"}),e.jsxs("span",{className:"text-sm font-bold text-blue-600",children:["KSH ",Ke.toLocaleString()," (",Math.round(rs*100),"%)"]})]}),X&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Applied discount: ",X.name," (",X.percentage,"%)"]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-gradient-to-r from-orange-50 to-yellow-50 border border-orange-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ye,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium text-orange-900",children:"Need Additional Discount?"})]}),e.jsx("p",{className:"text-xs text-orange-700 mb-3",children:"Request manager approval for special discounts due to customer circumstances, bulk orders, or promotional events."}),e.jsx("button",{onClick:()=>$(!0),className:"w-full px-4 py-3 bg-gradient-to-r from-orange-500 to-yellow-500 text-white rounded-lg hover:from-orange-600 hover:to-yellow-600 transition-all text-sm font-semibold shadow-md hover:shadow-lg transform hover:-translate-y-0.5",children:"ðŸ’° Request Manager Discount Approval"})]})]}),F.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-4",children:[e.jsx("h4",{className:"font-semibold text-yellow-900 mb-3",children:"Pending Discount Requests"}),e.jsxs("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:[F.slice(0,3).map(h=>e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-yellow-200",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:h.type==="percentage"?`${h.value}%`:`KSH ${h.value}`}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${h.status==="pending"?"bg-yellow-100 text-yellow-800":h.status==="approved"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:h.status})]}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:h.reason})]},h.id)),F.length>3&&e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["+",F.length-3," more requests"]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2 border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",ge.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-blue-600",children:[e.jsxs("span",{children:["Discount (",Math.round(rs*100),"%):"]}),e.jsxs("span",{className:"font-semibold",children:["-KSH ",Ke.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Discounted Subtotal:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",ze.toLocaleString()]})]}),!j&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Tax (16%):"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",js.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-xl font-bold border-t border-gray-200 pt-2",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",ls.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tax"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>w(!0),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${j?"bg-green-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Tax Inclusive"}),e.jsx("button",{onClick:()=>w(!1),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${j?"bg-gray-100 text-gray-600 hover:bg-gray-200":"bg-green-600 text-white"}`,children:"Tax Exclusive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:y,onChange:h=>N(h.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:Qs,disabled:C.length===0,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg",children:"Complete Sale"})]})]})]}),P==="stock"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Stock Management"}),e.jsxs("button",{onClick:()=>{x(!0),D({name:"",price:"",quantity:"",unit:"pcs"})},className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsx("div",{className:"card shadow-lg",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:p.map(h=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:h.name}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",h.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:`font-medium ${h.quantity<10?"text-red-600":"text-gray-900"}`,children:[h.quantity," ",h.unit]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{S(h),D({name:h.name,price:h.price,quantity:h.quantity,unit:h.unit||"pcs"})},className:"p-2 hover:bg-green-50 rounded-lg text-green-600",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:async()=>{if(confirm("Delete this product? This action cannot be undone."))try{await ie.delete(h.id),i(T=>T.filter(M=>M.id!==h.id)),alert("Product deleted successfully!"),de()}catch(T){console.error("Failed to delete product:",T);let M="Failed to delete product";T.message.includes("Failed to execute")||T.message.includes("JSON")?M="Network error. Please check your connection and try again.":T.message.includes("401")||T.message.includes("unauthorized")?M="You are not authorized to delete this product.":T.message.includes("404")||T.message.includes("not found")?M="Product not found. It may have been deleted already.":T.message&&(M=`Failed to delete product: ${T.message}`),alert(M)}},className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(ce,{className:"w-4 h-4"})})]})})]},h.id))})]})})}),(q||L)&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:L?"Edit Product":"Add Product"}),e.jsxs("form",{onSubmit:async h=>{h.preventDefault();try{L?await ie.update(L.id,{...L,...k,price:parseFloat(k.price),quantity:parseFloat(k.quantity)}):await ie.create({...k,price:parseFloat(k.price),cost:parseFloat(k.price)*.6,quantity:parseFloat(k.quantity),category:"raw"}),x(!1),S(null),de()}catch(T){alert("Failed: "+T.message)}},className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:k.name,onChange:h=>D({...k,name:h.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:k.price,onChange:h=>D({...k,price:h.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:k.quantity,onChange:h=>D({...k,quantity:h.target.value}),required:!0}),e.jsxs("select",{className:"input",value:k.unit,onChange:h=>D({...k,unit:h.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:L?"Update":"Add"}),e.jsx("button",{type:"button",onClick:()=>{x(!1),S(null)},className:"btn-secondary",children:"Cancel"})]})]})]})})]}),P==="sales"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Daily Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",_.dailySales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(ye,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Weekly Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",_.weeklySales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Ie,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",_.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Ne,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),s?.plan==="ultra"&&e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:Ce.slice(0,20).map(h=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(h.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[h.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:h.paymentMethod||"cash"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",h.total?.toLocaleString()]}),s?.plan==="ultra"&&e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",h.profit?.toLocaleString()||0]})]},h.id))})]})})]})]}),P==="users"&&u()&&t()&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsxs("button",{onClick:()=>{U(!0),B({name:"",email:"",password:"",confirmPassword:"",role:"cashier",cashierPIN:""})},className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600",children:[e.jsx(le,{className:"w-4 h-4"}),"Add User"]})]}),e.jsx("div",{className:"card shadow-lg",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Package"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:"Admin User"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:"admin@example.com"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:"Admin"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-primary",children:"1600 Package"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:"N/A"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:"Active"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"p-2 hover:bg-green-50 rounded-lg text-green-600",children:e.jsx(ve,{className:"w-4 h-4"})})})})]})})]})})}),E&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-lg",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New User"}),e.jsxs("form",{onSubmit:oe,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:I.name,onChange:h=>B({...I,name:h.target.value}),required:!0}),e.jsx("input",{type:"email",placeholder:"Email Address",className:"input",value:I.email,onChange:h=>B({...I,email:h.target.value}),required:!0}),e.jsx("input",{type:"password",placeholder:"Password",className:"input",value:I.password,onChange:h=>B({...I,password:h.target.value}),required:!0}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"input",value:I.confirmPassword,onChange:h=>B({...I,confirmPassword:h.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:I.role,onChange:h=>B({...I,role:h.target.value}),children:[e.jsx("option",{value:"cashier",children:"Cashier"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"input",value:I.cashierPIN,onChange:h=>B({...I,cashierPIN:h.target.value}),maxLength:"4",pattern:"[0-9]{4}",title:"Please enter a 4-digit PIN"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-700",children:["ðŸ’¡ ",e.jsx("strong",{children:"PIN Note:"})," Cashiers can login using their email and the 4-digit PIN provided."]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add User"}),e.jsx("button",{type:"button",onClick:()=>U(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-500 to-yellow-500 rounded-xl flex items-center justify-center",children:e.jsx(Se,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Request Manager Discount Approval"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Submit a discount request for manager review"})]})]}),e.jsxs("form",{onSubmit:Ws,className:"space-y-5",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ“‹ Cart Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Items in Cart:"}),e.jsx("span",{className:"font-semibold text-blue-900 ml-2",children:C.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Current Subtotal:"}),e.jsxs("span",{className:"font-semibold text-blue-900 ml-2",children:["KSH ",ge.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Applied Discounts:"}),e.jsxs("span",{className:"font-semibold text-green-600 ml-2",children:["KSH ",Ke.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"After Discounts:"}),e.jsxs("span",{className:"font-semibold text-blue-900 ml-2",children:["KSH ",ze.toLocaleString()]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Discount Type"}),e.jsxs("select",{className:"input",value:ee.type,onChange:h=>pe({...ee,type:h.target.value}),children:[e.jsx("option",{value:"percentage",children:"ðŸ“Š Percentage (%)"}),e.jsx("option",{value:"fixed",children:"ðŸ’° Fixed Amount (KSH)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:ee.type==="percentage"?"Discount Percentage":"Discount Amount (KSH)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:ee.type==="percentage"?"100":ge.toString(),placeholder:ee.type==="percentage"?"10":"500",className:"input",value:ee.value,onChange:h=>pe({...ee,value:h.target.value}),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"ðŸŽ¯ Reason for Discount Request"}),e.jsx("textarea",{className:"input",placeholder:"Please provide detailed reasoning for this discount request. Examples: Customer loyalty, bulk purchase, damaged packaging, special occasion, competitor pricing, etc.",rows:"4",value:ee.reason,onChange:h=>pe({...ee,reason:h.target.value}),required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Be specific about customer circumstances or business reasons to help managers approve requests faster."]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-yellow-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-semibold text-yellow-800 mb-1",children:"Important Notes:"}),e.jsxs("ul",{className:"text-yellow-700 space-y-1 text-xs",children:[e.jsx("li",{children:"â€¢ Manager approval is required for all discount requests"}),e.jsx("li",{children:"â€¢ Large discounts (greater than 20%) may require additional authorization"}),e.jsx("li",{children:"â€¢ All requests are logged and monitored for compliance"})]})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"submit",className:"flex-1 btn-primary bg-gradient-to-r from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600 text-white font-semibold py-3 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all",children:"ðŸ“¤ Submit Discount Request"}),e.jsx("button",{type:"button",onClick:()=>{$(!1),pe({type:"percentage",value:"",reason:"",items:[]})},className:"btn-secondary px-6",children:"Cancel"})]})]})]})})]})}function Zt(){const[s,c]=a.useState({email:"",password:""}),[u,g]=a.useState(!1),[r,t]=a.useState(""),[l,b]=a.useState(!1),m=ke();hs(),a.useEffect(()=>{const f=localStorage.getItem("ownerToken"),p=localStorage.getItem("ownerUser");if(f&&p)try{const i=JSON.parse(p);if(i.type==="main_admin"||i.type==="owner"){m("/main.admin/dashboard");return}}catch{localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser")}},[m]);const n=async f=>{f.preventDefault(),g(!0),t("");try{const p=await be.login(s);if(p.token&&p.user&&(p.user.type==="main_admin"||p.user.type==="owner"))localStorage.setItem("ownerToken",p.token),localStorage.setItem("ownerUser",JSON.stringify(p.user)),m("/main.admin/dashboard");else throw new Error("Invalid response from server")}catch(p){console.error("Owner login error:",p),t(p.message||"Access denied. Owner access only.")}finally{g(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-black/50 backdrop-blur-lg rounded-2xl shadow-2xl max-w-md w-full p-8 border border-red-500/30",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-red-600 to-black rounded-2xl mx-auto mb-4 flex items-center justify-center border border-red-500/50",children:e.jsx(we,{className:"w-8 h-8 text-red-400"})}),e.jsx("h1",{className:"text-3xl font-bold text-red-400 mb-2",children:"MAIN.ADMIN"}),e.jsx("p",{className:"text-gray-400",children:"System Owner Access"}),e.jsx("div",{className:"mt-2 text-xs text-red-500 bg-red-500/10 px-3 py-1 rounded border border-red-500/30",children:"ðŸ”’ ianmabruk3@gmail.com only"})]}),e.jsxs("form",{onSubmit:n,className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),e.jsx("input",{type:"email",placeholder:"Owner Email",className:"w-full pl-10 pr-4 py-3 bg-black/30 border border-red-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",value:s.email,onChange:f=>c({...s,email:f.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),e.jsx("input",{type:l?"text":"password",placeholder:"Owner Password",className:"w-full pl-10 pr-12 py-3 bg-black/30 border border-red-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",value:s.password,onChange:f=>c({...s,password:f.target.value}),required:!0}),e.jsx("button",{type:"button",onClick:()=>b(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-400",children:l?e.jsx(Os,{className:"w-5 h-5"}):e.jsx(ps,{className:"w-5 h-5"})})]}),r&&e.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm bg-red-500/10 p-3 rounded-lg border border-red-500/30",children:[e.jsx(Ye,{className:"w-4 h-4"}),r]}),e.jsx("button",{type:"submit",disabled:u,className:"w-full bg-gradient-to-r from-red-600 to-red-800 text-white py-3 rounded-lg font-bold hover:from-red-700 hover:to-red-900 transition-all disabled:opacity-50 disabled:cursor-not-allowed border border-red-500/50",children:u?"Authenticating...":"ACCESS SYSTEM"})]}),e.jsx("div",{className:"mt-8 p-4 bg-red-500/10 border border-red-500/30 rounded-lg",children:e.jsx("p",{className:"text-red-300 text-xs text-center",children:"âš ï¸ Restricted to system owner only"})})]})})}function Xt(){const[s,c]=a.useState([]),[u,g]=a.useState([]),[r,t]=a.useState({}),[l,b]=a.useState(!0),[m,n]=a.useState("overview"),[f,p]=a.useState(null),[i,C]=a.useState(null),[d,y]=a.useState(!1),N=ke();a.useEffect(()=>{const x=localStorage.getItem("ownerToken"),L=localStorage.getItem("ownerUser");if(!x||!L){N("/main.admin");return}try{const S=JSON.parse(L);if(S.type!=="main_admin"&&S.type!=="owner"||S.email!=="ianmabruk3@gmail.com"){N("/main.admin");return}}catch{N("/main.admin");return}j()},[N]);const j=async()=>{try{b(!0);const[x,L,S]=await Promise.all([be.getUsers(),be.getStats(),be.getActivities()]);c(x),t(L),g(S)}catch(x){console.error("Failed to load data:",x)}finally{b(!1)}},w=async(x,L)=>{try{p(`lock-${x}`);const S=!L;await be.lockUser(x,S),c(s.map(k=>k.id===x?{...k,locked:S,active:!S}:k)),setTimeout(j,1e3)}catch(S){console.error("Failed to toggle lock:",S),alert("Failed to update user status")}finally{p(null)}},P=async(x,L)=>{try{p(`plan-${x}`),await be.changePlan(x,L),c(s.map(S=>S.id===x?{...S,plan:L,price:L==="ultra"?2400:L==="basic"?1e3:0}:S)),y(!1),C(null),setTimeout(j,1e3)}catch(S){console.error("Failed to change plan:",S),alert("Failed to change user plan")}finally{p(null)}},A=async x=>{const L=x==="all"?"Are you sure you want to clear ALL system data? This will remove all sales, expenses, and products from ALL users. This cannot be undone.":`Are you sure you want to clear ${x} data from ALL users? This cannot be undone.`;if(confirm(L))try{p(`clear-${x}`),await be.clearData(x),alert(`${x.charAt(0).toUpperCase()+x.slice(1)} data cleared successfully`),j()}catch(S){console.error("Clear data failed:",S),alert("Failed to clear data")}finally{p(null)}},q=()=>{localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser"),N("/main.admin")};return l?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-red-400 text-xl",children:"Loading System Control..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black",children:[e.jsx("header",{className:"bg-black/50 backdrop-blur-lg border-b border-red-500/30 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(we,{className:"w-8 h-8 text-red-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-red-400",children:"MAIN.ADMIN"}),e.jsx("p",{className:"text-gray-400",children:"Ian Mabruk - System Owner"})]})]}),e.jsxs("button",{onClick:q,className:"flex items-center gap-2 bg-red-600/20 hover:bg-red-600/30 text-red-300 px-4 py-2 rounded-lg transition-colors border border-red-500/30",children:[e.jsx(Re,{className:"w-4 h-4"}),"Logout"]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(fe,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:r.totalUsers||0})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Users"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ee,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:r.activeUsers||0})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Active Users"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(je,{className:"w-8 h-8 text-yellow-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:r.trialUsers||0})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Free Trials"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ye,{className:"w-8 h-8 text-green-400"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:["KSH ",(r.mrr||0).toLocaleString()]})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Monthly Revenue"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(is,{className:"w-8 h-8 text-purple-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:(r.totalSignups||0)+(r.totalLogins||0)})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Activities"})]})]}),e.jsx("div",{className:"flex gap-4 mb-6 overflow-x-auto",children:[{id:"overview",label:"Overview",icon:Ie},{id:"users",label:`Users (${s.length})`,icon:fe},{id:"activities",label:`Activities (${u.length})`,icon:is},{id:"system",label:"System Control",icon:Te}].map(x=>{const L=x.icon;return e.jsxs("button",{onClick:()=>n(x.id),className:`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all whitespace-nowrap ${m===x.id?"bg-red-600 text-white":"bg-black/30 text-gray-300 hover:bg-black/50"}`,children:[e.jsx(L,{className:"w-4 h-4"}),x.label]},x.id)})}),m==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Plan Distribution"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-300 font-semibold",children:"Free Trial"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:r.planDistribution?.trial||0})]}),e.jsx(je,{className:"w-8 h-8 text-yellow-400"})]})}),e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-300 font-semibold",children:"Basic Plan"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:r.planDistribution?.basic||0})]}),e.jsx(xs,{className:"w-8 h-8 text-blue-400"})]})}),e.jsx("div",{className:"bg-purple-500/10 border border-purple-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-300 font-semibold",children:"Ultra Plan"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:r.planDistribution?.ultra||0})]}),e.jsx(fs,{className:"w-8 h-8 text-purple-400"})]})})]})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Recent Activity Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"User Activity"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Signups:"}),e.jsx("span",{className:"text-green-400",children:r.totalSignups||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Logins:"}),e.jsx("span",{className:"text-blue-400",children:r.totalLogins||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Recent Signups (7d):"}),e.jsx("span",{className:"text-yellow-400",children:r.recentSignups||0})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"System Health"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Active Users:"}),e.jsx("span",{className:"text-green-400",children:r.activeUsers||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Locked Users:"}),e.jsx("span",{className:"text-red-400",children:r.lockedUsers||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Revenue:"}),e.jsxs("span",{className:"text-green-400",children:["KSH ",(r.totalRevenue||0).toLocaleString()]})]})]})]})]})]})]}),m==="users"&&e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl border border-red-500/30 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"User Management"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Manage all system users, plans, and access control"})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User Details"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan & Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Trial Info"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Account Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Actions"})]})}),e.jsx("tbody",{children:s.map(x=>{const L=x.isFreeTrial,S=x.createdAt?new Date(x.createdAt).toLocaleDateString():"Unknown";return e.jsxs("tr",{className:"border-t border-red-500/20 hover:bg-black/20 transition",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:x.name}),e.jsx("p",{className:"text-sm text-gray-400",children:x.email}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",x.id," | Role: ",x.role]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Created: ",S]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-1",children:[L?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-yellow-500/20 text-yellow-300 flex items-center gap-1 w-fit",children:[e.jsx(je,{className:"w-3 h-3"}),"FREE TRIAL"]}):e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${x.plan==="ultra"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"}`,children:x.plan?.toUpperCase()}),x.price&&e.jsxs("p",{className:"text-xs text-gray-400",children:["KSH ",x.price,"/month"]})]})}),e.jsx("td",{className:"px-4 py-4",children:L?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("span",{className:"px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-300",children:[x.trialDaysLeft||0," days left"]}),x.trialDaysLeft<=7&&e.jsx("p",{className:"text-xs text-red-400",children:"âš ï¸ Expiring soon"})]}):e.jsx("span",{className:"text-xs text-gray-500",children:"Paid Plan"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-1",children:[x.locked?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-300 flex items-center gap-1 w-fit",children:[e.jsx(re,{className:"w-3 h-3"}),"Locked"]}):x.active?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-300 flex items-center gap-1 w-fit",children:[e.jsx(Ee,{className:"w-3 h-3"}),"Active"]}):e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-500/20 text-gray-300 w-fit",children:"Inactive"}),x.pin&&e.jsx("p",{className:"text-xs text-blue-400",children:"PIN Set"})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>w(x.id,x.locked),disabled:f===`lock-${x.id}`,className:`p-2 rounded-lg transition ${x.locked?"bg-green-500/20 hover:bg-green-500/30 text-green-300":"bg-red-500/20 hover:bg-red-500/30 text-red-300"} ${f===`lock-${x.id}`?"opacity-50 cursor-not-allowed":""}`,title:x.locked?"Unlock User":"Lock User",children:f===`lock-${x.id}`?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):x.locked?e.jsx(bt,{className:"w-4 h-4"}):e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{C(x),y(!0)},disabled:f===`plan-${x.id}`,className:"p-2 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 transition",title:"Change Plan",children:f===`plan-${x.id}`?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(ft,{className:"w-4 h-4"})})]})})]},x.id)})})]}),s.length===0&&e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx(fe,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No users registered yet"})]})]})]}),m==="activities"&&e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl border border-red-500/30 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"System Activity Log"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"All user activities and admin actions"})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Activity Type"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User Details"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan/Action"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Time"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"IP Address"})]})}),e.jsx("tbody",{children:u.slice(0,100).map(x=>{const L=x.timestamp?new Date(x.timestamp).toLocaleString():"Unknown",S=x.type==="signup",k=x.type==="admin_action";return e.jsxs("tr",{className:"border-t border-red-500/20 hover:bg-black/20 transition",children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${S?"bg-green-500/20 text-green-300":k?"bg-red-500/20 text-red-300":"bg-blue-500/20 text-blue-300"}`,children:S?"SIGNUP":k?"ADMIN":"LOGIN"}),k&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:x.action})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:x.name||x.targetUserEmail}),e.jsx("p",{className:"text-sm text-gray-400",children:x.email||x.targetUserEmail}),k&&e.jsxs("p",{className:"text-xs text-red-400",children:["By: ",x.adminEmail]})]})}),e.jsx("td",{className:"px-4 py-4",children:k?e.jsxs("div",{className:"text-xs",children:[x.oldPlan&&x.newPlan&&e.jsxs("span",{className:"text-yellow-400",children:[x.oldPlan," â†’ ",x.newPlan]}),x.action==="user_locked"&&e.jsx("span",{className:"text-red-400",children:"User Locked"}),x.action==="user_unlocked"&&e.jsx("span",{className:"text-green-400",children:"User Unlocked"})]}):e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${x.plan==="ultra"?"bg-purple-500/20 text-purple-300":x.plan==="basic"?"bg-blue-500/20 text-blue-300":"bg-yellow-500/20 text-yellow-300"}`,children:x.plan?.toUpperCase()||"TRIAL"})}),e.jsx("td",{className:"px-4 py-4 text-gray-300 text-sm",children:L}),e.jsx("td",{className:"px-4 py-4 text-gray-400 text-sm",children:x.ipAddress||"Unknown"})]},x.id)})})]}),u.length===0&&e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx(is,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No activity recorded yet"})]})]})]}),m==="system"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(jt,{className:"w-6 h-6"}),"System Data Management"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("button",{onClick:()=>A("sales"),disabled:f==="clear-sales",className:"p-4 bg-orange-500/20 hover:bg-orange-500/30 border border-orange-500/30 rounded-lg text-orange-300 transition-colors disabled:opacity-50",children:[f==="clear-sales"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(ce,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear Sales"}),e.jsx("p",{className:"text-xs opacity-75",children:"All user sales data"})]}),e.jsxs("button",{onClick:()=>A("expenses"),disabled:f==="clear-expenses",className:"p-4 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded-lg text-red-300 transition-colors disabled:opacity-50",children:[f==="clear-expenses"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(ye,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear Expenses"}),e.jsx("p",{className:"text-xs opacity-75",children:"All user expense data"})]}),e.jsxs("button",{onClick:()=>A("products"),disabled:f==="clear-products",className:"p-4 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-500/30 rounded-lg text-blue-300 transition-colors disabled:opacity-50",children:[f==="clear-products"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(Fs,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear Inventory"}),e.jsx("p",{className:"text-xs opacity-75",children:"All products & batches"})]}),e.jsxs("button",{onClick:()=>A("all"),disabled:f==="clear-all",className:"p-4 bg-red-600/20 hover:bg-red-600/30 border border-red-600/30 rounded-lg text-red-300 transition-colors disabled:opacity-50",children:[f==="clear-all"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(ms,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear All Data"}),e.jsx("p",{className:"text-xs opacity-75",children:"âš ï¸ Everything except users"})]})]})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(Te,{className:"w-6 h-6"}),"System Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"User Statistics"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Users:"}),e.jsx("span",{className:"text-white",children:s.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Active Users:"}),e.jsx("span",{className:"text-green-400",children:s.filter(x=>x.active&&!x.locked).length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Locked Users:"}),e.jsx("span",{className:"text-red-400",children:s.filter(x=>x.locked).length})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"Plan Distribution"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Basic Plans:"}),e.jsx("span",{className:"text-blue-400",children:s.filter(x=>x.plan==="basic").length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Ultra Plans:"}),e.jsx("span",{className:"text-purple-400",children:s.filter(x=>x.plan==="ultra").length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Free Trials:"}),e.jsx("span",{className:"text-yellow-400",children:s.filter(x=>!x.plan||x.plan==="trial").length})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"Revenue"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Monthly Revenue:"}),e.jsxs("span",{className:"text-green-400",children:["KSH ",(r.mrr||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Revenue:"}),e.jsxs("span",{className:"text-green-400",children:["KSH ",(r.totalRevenue||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Activities:"}),e.jsx("span",{className:"text-blue-400",children:u.length})]})]})]})]})]})]})]}),d&&i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-black/80 backdrop-blur-lg rounded-xl p-6 border border-red-500/30 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Change User Plan"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-gray-300",children:["User: ",e.jsx("span",{className:"text-white font-semibold",children:i.name})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:i.email}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Current Plan: ",e.jsx("span",{className:"text-yellow-400",children:i.plan||"trial"})]})]}),e.jsx("div",{className:"space-y-3 mb-6",children:["trial","basic","ultra"].map(x=>e.jsx("button",{onClick:()=>P(i.id,x),disabled:f===`plan-${i.id}`||i.plan===x,className:`w-full p-3 rounded-lg border transition ${i.plan===x?"bg-gray-500/20 border-gray-500/30 text-gray-400 cursor-not-allowed":x==="trial"?"bg-yellow-500/20 border-yellow-500/30 text-yellow-300 hover:bg-yellow-500/30":x==="basic"?"bg-blue-500/20 border-blue-500/30 text-blue-300 hover:bg-blue-500/30":"bg-purple-500/20 border-purple-500/30 text-purple-300 hover:bg-purple-500/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-semibold",children:[x.charAt(0).toUpperCase()+x.slice(1)," Plan"]}),e.jsx("p",{className:"text-xs opacity-75",children:x==="trial"?"Free - 30 days":x==="basic"?"KSH 1,000/month":"KSH 2,400/month"})]}),i.plan===x&&e.jsx(Ee,{className:"w-5 h-5"})]})},x))}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>{y(!1),C(null)},className:"flex-1 px-4 py-2 bg-gray-500/20 border border-gray-500/30 text-gray-300 rounded-lg hover:bg-gray-500/30 transition",children:"Cancel"})})]})})]})}function We({children:s,adminOnly:c=!1,ultraOnly:u=!1,ownerOnly:g=!1}){const{user:r,loading:t}=he(),[l,b]=a.useState(!1),m=Gs(6e4),n=m?.[0]||!1,f=m?.[1]||(()=>{}),[p,i]=a.useState({});if(a.useEffect(()=>{r&&!g&&((async()=>{try{const y=localStorage.getItem("token"),j=await fetch(`${Z}/settings`,{headers:{Authorization:`Bearer ${y}`}});if(j.ok){const w=await j.json();i(w)}}catch(y){console.error("Failed to load settings:",y)}})(),b(!0))},[r,g]),t&&!g)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(g){const d=localStorage.getItem("ownerToken"),y=localStorage.getItem("ownerUser");if(!d||!y)return e.jsx(Q,{to:"/main.admin"});try{if(JSON.parse(y).type!=="main_admin")return e.jsx(Q,{to:"/main.admin"})}catch{return e.jsx(Q,{to:"/main.admin"})}}else{if(!r)return e.jsx(Q,{to:"/auth/login"});if(!r.active)return e.jsx(Q,{to:"/plans"});if(c&&r.role!=="admin")return e.jsx(Q,{to:"/dashboard"});if(u&&(r.role!=="admin"||r.plan!=="ultra"))return e.jsx(Q,{to:"/dashboard"})}const C=g?"owner":"user";return e.jsxs(e.Fragment,{children:[n&&e.jsx(Js,{onUnlock:f,userType:C}),l&&e.jsx(zs,{onClose:()=>b(!1)}),s]})}function ea(){const{user:s}=he();return!s||!s.active?e.jsx(Q,{to:"/plans"}):s.role==="admin"?e.jsx(Q,{to:"/admin"}):e.jsx(Q,{to:"/dashboard/cashier"})}function sa(){return e.jsx(At,{children:e.jsx(Lt,{children:e.jsx(st,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(Ts,{children:[e.jsx(H,{path:"/",element:e.jsx(Gt,{})}),e.jsx(H,{path:"/auth/login",element:e.jsx(Es,{})}),e.jsx(H,{path:"/auth/signup",element:e.jsx(Es,{})}),e.jsx(H,{path:"/plans",element:e.jsx(Vt,{})}),e.jsx(H,{path:"/main.admin",element:e.jsx(Zt,{})}),e.jsx(H,{path:"/main.admin/dashboard",element:e.jsx(We,{ownerOnly:!0,children:e.jsx(Xt,{})})}),e.jsx(H,{path:"/dashboard",element:e.jsx(We,{children:e.jsx(ea,{})})}),e.jsx(H,{path:"/dashboard/cashier",element:e.jsx(We,{children:e.jsx(Qt,{})})}),e.jsx(H,{path:"/admin/*",element:e.jsx(We,{adminOnly:!0,children:e.jsx(Jt,{})})}),e.jsx(H,{path:"/login",element:e.jsx(Q,{to:"/auth/login"})}),e.jsx(H,{path:"/signup",element:e.jsx(Q,{to:"/auth/signup"})}),e.jsx(H,{path:"/subscription",element:e.jsx(Q,{to:"/plans"})}),e.jsx(H,{path:"/payment",element:e.jsx(Q,{to:"/plans"})}),e.jsx(H,{path:"/cashier",element:e.jsx(Q,{to:"/dashboard/cashier"})})]})})})})}St.createRoot(document.getElementById("root")).render(e.jsx(tt.StrictMode,{children:e.jsx(sa,{})}));
