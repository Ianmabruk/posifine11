import{a as Jt,b as Kt,g as Wt,r as a,u as ue,c as kt,R as Ct,d as J,B as Gt,N as Z,e as Vt}from"./vendor-Ct1st1Nj.js";import{C as _e,D as oe,T as qe,P as Ne,S as Pt,a as ze,b as At,c as re,d as Qt,e as Yt,f as we,g as ve,h as le,i as Tt,j as Zt,k as Dt,l as Xt,L as ae,U as ft,m as bt,n as Ie,E as xt,M as jt,o as ke,X as Ee,p as de,q as Me,r as ht,s as He,t as yt,u as Je,B as ut,R as It,I as es,v as Ke,w as mt,x as Se,y as We,z as Et,A as ts,F as $t,G as ss,H as as,J as rs,K as Xe,N as ls,O as Ue,Q as Lt,V as Ge,Z as $e,W as Ve,Y as Ft,_ as ns,$ as is,a0 as cs,a1 as os,a2 as ds,a3 as ms}from"./icons-BXlvFyWb.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))j(c);new MutationObserver(c=>{for(const l of c)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&j(r)}).observe(document,{childList:!0,subtree:!0});function f(c){const l={};return c.integrity&&(l.integrity=c.integrity),c.referrerPolicy&&(l.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?l.credentials="include":c.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function j(c){if(c.ep)return;c.ep=!0;const l=f(c);fetch(c.href,l)}})();var ot={exports:{}},Pe={};var Nt;function xs(){if(Nt)return Pe;Nt=1;var t=Jt(),n=Symbol.for("react.element"),f=Symbol.for("react.fragment"),j=Object.prototype.hasOwnProperty,c=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function r(x,m,h){var w,N={},i=null,I=null;h!==void 0&&(i=""+h),m.key!==void 0&&(i=""+m.key),m.ref!==void 0&&(I=m.ref);for(w in m)j.call(m,w)&&!l.hasOwnProperty(w)&&(N[w]=m[w]);if(x&&x.defaultProps)for(w in m=x.defaultProps,m)N[w]===void 0&&(N[w]=m[w]);return{$$typeof:n,type:x,key:i,ref:I,props:N,_owner:c.current}}return Pe.Fragment=f,Pe.jsx=r,Pe.jsxs=r,Pe}var wt;function hs(){return wt||(wt=1,ot.exports=xs()),ot.exports}var e=hs(),Oe={},vt;function us(){if(vt)return Oe;vt=1;var t=Kt();return Oe.createRoot=t.createRoot,Oe.hydrateRoot=t.hydrateRoot,Oe}var ps=us();const gs=Wt(ps),fs=()=>"https://posifine22.onrender.com/api",H=fs(),Ut=()=>localStorage.getItem("token"),Ot=async(t,n={},f=0,j=3)=>{const c=Ut(),l=t.startsWith("/")?t:`/${t}`,r={...n,headers:{"Content-Type":"application/json",...c&&!(l.startsWith("/auth")&&l!=="/auth/me")&&!l.includes("/main-admin/auth/login")&&{Authorization:`Bearer ${c}`},...n.headers}};try{const x=await fetch(`${H}${l}`,r);if(x.status===401){if(l.includes("/auth/login")||l.includes("/main-admin/auth/login")){const N=await x.json().catch(()=>({error:"Unauthorized"}));throw new Error(N.error||"Invalid credentials")}localStorage.removeItem("token"),localStorage.removeItem("user");const h=window.location.pathname||"";if(!h.includes("/login")&&!h.includes("/signup")&&!h.includes("/auth")&&!h.includes("/main.admin"))try{window.location.href="/login"}catch{}const w=new Error("Unauthorized");throw w.status=401,w}if(x.status===500)throw new Error("Server error 500 - Backend unavailable");if(x.ok)return x.status===204?{success:!0}:await x.json();const m=await x.json().catch(()=>({error:"Network error"}));throw new Error(m.error||`HTTP ${x.status}: ${x.statusText}`)}catch(x){if(x.name==="TypeError"&&x.message.includes("fetch")){if(console.error(`API Fetch Error (attempt ${f+1}/${j+1}):`,x),console.error("Attempted URL:",`${H}${l}`),f<j){const m=Math.min(1e3*Math.pow(2,f),1e4);return console.log(`Retrying in ${m}ms...`),await new Promise(h=>setTimeout(h,m)),Ot(t,n,f+1,j)}throw new Error("Cannot connect to server. The server may be waking up. Please try again in a moment.")}throw x}},q=(t,n={})=>Ot(t,n,0,3),ye={login:t=>q("/auth/login",{method:"POST",body:JSON.stringify(t)}),pinLogin:t=>q("/auth/pin-login",{method:"POST",body:JSON.stringify(t)}),signup:t=>q("/auth/signup",{method:"POST",body:JSON.stringify(t)}),signupWithPayment:t=>q("/signup-with-payment",{method:"POST",body:JSON.stringify(t)}),me:()=>q("/auth/me")},ge={getAll:()=>q("/users"),create:t=>q("/users",{method:"POST",body:JSON.stringify(t)}),update:(t,n)=>q(`/users/${t}`,{method:"PUT",body:JSON.stringify(n)}),delete:t=>q(`/users/${t}`,{method:"DELETE"}),setPin:(t,n)=>q(`/users/${t}/set-pin`,{method:"POST",body:JSON.stringify({pin:n})}),lock:(t,n)=>q(`/users/${t}/lock`,{method:"POST",body:JSON.stringify({locked:n})})},ee={getAll:()=>q("/products"),create:t=>q("/products",{method:"POST",body:JSON.stringify(t)}),update:(t,n)=>q(`/products/${t}`,{method:"PUT",body:JSON.stringify(n)}),delete:t=>q(`/products/${t}`,{method:"DELETE"}),updateStock:(t,n)=>q(`/products/${t}/stock`,{method:"PUT",body:JSON.stringify(n)}),getMaxProducible:t=>q(`/products/${t}/max-producible`),getWeightPricing:t=>q(`/products/${t}/weight-pricing`),addWeightPrice:(t,n,f)=>q(`/products/${t}/weight-pricing`,{method:"POST",body:JSON.stringify({weight:n,price:f})}),updateWeightPrice:(t,n,f)=>q(`/products/${t}/weight-pricing`,{method:"PUT",body:JSON.stringify({weight:n,price:f})}),deleteWeightPrice:(t,n)=>q(`/products/${t}/weight-pricing`,{method:"DELETE",body:JSON.stringify({weight:n})})},Le={getAll:async()=>[{id:1,total:450,items:[{name:"Coffee",quantity:2}],createdAt:new Date().toISOString()}],create:async t=>({id:Date.now(),...t,createdAt:new Date().toISOString()})},Qe={getAll:async()=>[{id:1,description:"Office supplies",amount:150,createdAt:new Date().toISOString()}],create:async t=>({id:Date.now(),...t,createdAt:new Date().toISOString()})},Rt={get:async()=>{try{const t=await fetch(`${H}/api/stats`,{headers:{Authorization:`Bearer ${localStorage.getItem("userToken")}`}});if(t.ok)return await t.json()}catch(t){console.error("Failed to fetch stats:",t)}return{totalSales:0,totalExpenses:0,profit:0,productCount:0}}},Re={getAll:()=>q("/discounts"),create:t=>q("/discounts",{method:"POST",body:JSON.stringify(t)}),update:(t,n)=>q(`/discounts/${t}`,{method:"PUT",body:JSON.stringify(n)}),delete:t=>q(`/discounts/${t}`,{method:"DELETE"})},dt={getAll:()=>q("/credit-requests"),create:t=>q("/credit-requests",{method:"POST",body:JSON.stringify(t)}),approve:t=>q(`/credit-requests/${t}/approve`,{method:"POST"}),reject:t=>q(`/credit-requests/${t}/reject`,{method:"POST"})},Te={get:async()=>({screenLockPassword:"2005",businessName:"My Business"}),update:async t=>t},Ye={getAll:t=>{const n=t?`/batches?productId=${t}`:"/batches";return q(n)},create:t=>q("/batches",{method:"POST",body:JSON.stringify(t)})},De={login:t=>q("/main-admin/auth/login",{method:"POST",body:JSON.stringify(t)}),getUsers:()=>{const t=localStorage.getItem("ownerToken");return q("/main-admin/users",{headers:{Authorization:`Bearer ${t}`}})},getStats:()=>{const t=localStorage.getItem("ownerToken");return q("/main-admin/stats",{headers:{Authorization:`Bearer ${t}`}})},getActivities:()=>{const t=localStorage.getItem("ownerToken");return q("/main-admin/activities",{headers:{Authorization:`Bearer ${t}`}})},getSalesAll:()=>{const t=localStorage.getItem("ownerToken");return q("/main-admin/sales-all",{headers:{Authorization:`Bearer ${t}`}})},getTimeEntriesAll:()=>{const t=localStorage.getItem("ownerToken");return q("/main-admin/time-entries-all",{headers:{Authorization:`Bearer ${t}`}})},lockUser:(t,n)=>{const f=localStorage.getItem("ownerToken");return q(`/main-admin/users/${t}/lock`,{method:"POST",headers:{Authorization:`Bearer ${f}`},body:JSON.stringify({locked:n})})},changePlan:(t,n)=>{const f=localStorage.getItem("ownerToken");return q(`/main-admin/users/${t}/plan`,{method:"POST",headers:{Authorization:`Bearer ${f}`},body:JSON.stringify({plan:n})})},clearData:t=>{const n=localStorage.getItem("ownerToken");return q("/main-admin/system/clear-data",{method:"POST",headers:{Authorization:`Bearer ${n}`},body:JSON.stringify({type:t})})}};let se=null,Be=new Set;function bs(){const t=H.replace(/\/api$/,"");return`${t.startsWith("https")?"wss":"ws"}://${t.replace(/^https?:\/\//,"")}/api/ws/products`}function js(){if(se&&(se.readyState===WebSocket.OPEN||se.readyState===WebSocket.CONNECTING))return;const t=Ut(),n=bs()+(t?`?token=${encodeURIComponent(t)}`:"");se=new WebSocket(n),se.onopen=()=>{console.debug("Products WS connected")},se.onmessage=f=>{let j=null;try{j=JSON.parse(f.data)}catch{return}Be.forEach(c=>{try{c(j)}catch(l){console.error("ws callback error",l)}})},se.onclose=()=>{console.debug("Products WS closed"),se=null},se.onerror=f=>{console.error("Products WS error",f)}}function ys(t){if(typeof t!="function")throw new Error("subscribeProducts requires a callback");return Be.add(t),js(),()=>{if(Be.delete(t),se&&Be.size===0){try{se.close()}catch{}se=null}}}const qt=a.createContext(),me=()=>a.useContext(qt),Ns=({children:t})=>{const[n,f]=a.useState(null),[j,c]=a.useState(!0),[l,r]=a.useState(!1),[x,m]=a.useState({});a.useEffect(()=>{h()},[]),a.useEffect(()=>{const A=()=>{const E=localStorage.getItem("user");if(E)try{const O=JSON.parse(E);f(O)}catch(O){console.warn("Failed to parse user from localStorage",O)}else f(null)};return window.addEventListener("storage",A),window.addEventListener("localStorageUpdated",A),()=>{window.removeEventListener("storage",A),window.removeEventListener("localStorageUpdated",A)}},[]);const h=async()=>{try{const A=localStorage.getItem("token"),E=localStorage.getItem("user");if(A)try{const O=await fetch(`${H}/auth/me`,{headers:{Authorization:`Bearer ${A}`,"Content-Type":"application/json"}});if(O.ok){const _=await O.json();f(_),localStorage.setItem("user",JSON.stringify(_))}else throw new Error("Invalid token")}catch(O){console.warn("Auth check failed:",O),localStorage.removeItem("token"),localStorage.removeItem("user")}}catch(A){console.error("Error initializing auth:",A),localStorage.removeItem("token"),localStorage.removeItem("user"),f(null)}finally{c(!1),r(!0)}},w=async A=>{try{if(A&&A.token&&A.user)return localStorage.setItem("token",A.token),localStorage.setItem("user",JSON.stringify(A.user)),f(A.user),A;const E=await ye.login(A);if(E.token&&E.user)return localStorage.setItem("token",E.token),localStorage.setItem("user",JSON.stringify(E.user)),f(E.user),E;throw new Error("Invalid response from server")}catch(E){throw console.error("Login failed:",E),E}},N=async A=>{try{const E=await ye.signup(A);if(E.token&&E.user)return localStorage.setItem("token",E.token),localStorage.setItem("user",JSON.stringify(E.user)),f(E.user),E;throw new Error("Invalid response from server")}catch(E){throw console.error("Signup failed:",E),E}},i=async A=>{try{if(localStorage.setItem("user",JSON.stringify(A)),f(A),window.dispatchEvent(new Event("localStorageUpdated")),A&&A.id)try{await ge.update(A.id,A)}catch(E){console.warn("Failed to persist updated user to backend",E)}return A}catch(E){throw console.error("updateUser failed:",E),E}},I=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),f(null),window.location.href="/login"},u=()=>!!n&&!!localStorage.getItem("token"),S=A=>n&&n.role===A,p=()=>n&&(n.role==="admin"||n.role==="main-admin"),y=()=>n&&n.role==="cashier",P=()=>n&&n.plan==="ultra",T=()=>n&&n.plan==="basic",D=()=>n&&(n.role==="admin"||n.role==="cashier"),U=()=>n&&n.role==="admin"&&n.plan==="ultra",b=()=>n&&n.role==="admin",C=()=>!0,g=()=>!0;return n?.locked?e.jsx(LockedAccount,{}):e.jsx(qt.Provider,{value:{user:n,loading:j,isInitialized:l,appSettings:x,login:w,signup:N,updateUser:i,logout:I,isAuthenticated:u,hasRole:S,isAdmin:p,isCashier:y,isUltraPackage:P,isBasicPackage:T,canEditStock:D,canManageUsers:U,canViewAnalytics:b,isRealTimeProductSyncEnabled:C,isCashierUserManagementEnabled:g},children:t})};new Date().toISOString();const Mt=a.createContext(),ws=()=>a.useContext(Mt),vs=({children:t})=>{const{user:n}=me(),[f,j]=a.useState([]),[c,l]=a.useState(!0),[r,x]=a.useState(null),[m,h]=a.useState(Date.now()),w=a.useCallback(async()=>{if(!localStorage.getItem("token")){l(!1);return}try{const i=await ee.getAll(),u=(Array.isArray(i)?i:[]).filter(S=>n?.role==="admin"?!0:!S.expenseOnly&&!S.pendingDelete&&S.visibleToCashier!==!1);j(u),x(null),window.dispatchEvent(new CustomEvent("productsSync",{detail:{products:u,timestamp:Date.now()}}))}catch(i){console.error("Failed to fetch products:",i),x(`Failed to load products: ${i.message}`),j([])}finally{l(!1),h(Date.now())}},[n]);a.useEffect(()=>{w()},[w,n]),a.useEffect(()=>{const i=setInterval(()=>{w()},2e3);return()=>clearInterval(i)},[w]);const N=async()=>{l(!0),await w()};return e.jsx(Mt.Provider,{value:{products:f,loading:c,error:r,lastUpdated:m,refreshProducts:N},children:t})};function Ss(){const[t,n]=a.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[f,j]=a.useState(!0),[c,l]=a.useState(null);a.useEffect(()=>{r()},[]);const r=async()=>{try{l(null);const[h,w]=await Promise.all([Rt.get(),Le.getAll()]),N={totalSales:h?.totalSales||0,totalExpenses:h?.totalExpenses||0,profit:h?.profit||0,grossProfit:h?.grossProfit||0,netProfit:h?.netProfit||0,totalCOGS:h?.totalCOGS||0,dailySales:h?.dailySales||0,weeklySales:h?.weeklySales||0,productCount:h?.productCount||0},i=Array.isArray(w)?w:[];n({stats:N,recentSales:i.slice(-10).reverse()})}catch(h){console.error("Failed to load data:",h),l(h.message),n({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{j(!1)}};if(f)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(c&&t.stats.totalSales===0&&t.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(_e,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:c}),e.jsx("button",{onClick:r,className:"btn-primary",children:"Retry"})]})});const x=[{label:"Total Sales",value:`KSH ${t.stats.totalSales?.toLocaleString()||0}`,icon:oe,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${t.stats.grossProfit?.toLocaleString()||0}`,icon:qe,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${t.stats.totalCOGS?.toLocaleString()||0}`,icon:Ne,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${t.stats.netProfit?.toLocaleString()||0}`,icon:qe,color:"from-purple-500 to-pink-600",change:"+15.3%"}],m=[{label:"Daily Sales",value:`KSH ${t.stats.dailySales?.toLocaleString()||0}`,icon:Pt,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${t.stats.weeklySales?.toLocaleString()||0}`,icon:qe,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${t.stats.totalExpenses?.toLocaleString()||0}`,icon:ze,color:"bg-red-50 text-red-600"},{label:"Products",value:t.stats.productCount||0,icon:Ne,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(x||[]).map((h,w)=>{const N=h?.icon;return N?e.jsxs("div",{className:`card bg-gradient-to-br ${h.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(N,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:h.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:h.label}),e.jsx("p",{className:"text-2xl font-bold",children:h.value})]},w):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(m||[]).map((h,w)=>{const N=h?.icon;return N?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${h.color} flex items-center justify-center`,children:e.jsx(N,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:h.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:h.value})]})]})},w):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!t.recentSales||t.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_e,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(t.recentSales||[]).map(h=>h?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:h.createdAt?new Date(h.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(h.items)?h.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:h.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",h.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",h.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",h.profit?.toLocaleString()||0]})]},h.id||Math.random()):null)})]})})]})]})}const ks=()=>"https://posifine22.onrender.com/api".replace("https://","wss://").replace("http://","ws://");class Cs{constructor(){this.ws=null,this.listeners={stock_updated:[],heartbeat:[],initial:[],error:[]},this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.isManualClose=!1}connect(n,f){return new Promise((j,c)=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){j();return}if(!n){c(new Error("No token provided for WebSocket connection"));return}const l=`${ks()}/ws/products?token=${encodeURIComponent(n)}`;try{this.ws=new WebSocket(l),this.ws.onopen=()=>{console.log("âœ… WebSocket connected for real-time updates"),this.reconnectAttempts=0,j()},this.ws.onmessage=r=>{try{const x=JSON.parse(r.data);x.type==="stock_updated"?(console.log("ðŸ“¦ Stock update received:",x.data),f&&f(x.data),this.emit("stock_updated",x.data)):x.type==="initial"?(console.log("ðŸ“¦ Initial products loaded via WebSocket"),this.emit("initial",x.products)):x.type==="heartbeat"&&this.emit("heartbeat",x)}catch(x){console.error("Error parsing WebSocket message:",x)}},this.ws.onerror=r=>{console.error("âŒ WebSocket error:",r),this.emit("error",r),c(r)},this.ws.onclose=()=>{console.log("ðŸ”Œ WebSocket disconnected"),this.isManualClose||this.attemptReconnect(n,f)}}catch(r){console.error("Failed to create WebSocket:",r),c(r)}})}attemptReconnect(n,f){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Max reconnection attempts reached");return}this.reconnectAttempts++;const j=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`ðŸ”„ Reconnecting in ${j}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect(n,f).catch(c=>{console.error("Reconnection failed:",c)})},j)}on(n,f){this.listeners[n]||(this.listeners[n]=[]),this.listeners[n].push(f)}emit(n,f){this.listeners[n]&&this.listeners[n].forEach(j=>{try{j(f)}catch(c){console.error(`Error in ${n} listener:`,c)}})}disconnect(){this.isManualClose=!0,this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}}const Ze=new Cs;function Ps(){const{user:t,isUltraPackage:n,isRealTimeProductSyncEnabled:f}=me(),{products:j,refreshProducts:c}=ws(),[l,r]=a.useState([]),[x,m]=a.useState([]),[h,w]=a.useState("all"),[N,i]=a.useState(""),[I,u]=a.useState(!1),[S,p]=a.useState(!1),[y,P]=a.useState(!1),[T,D]=a.useState(!1),[U,b]=a.useState(null),[C,g]=a.useState({}),[A,E]=a.useState({weight:"",price:""}),[O,_]=a.useState(null),[Y,te]=a.useState(null),[fe,ne]=a.useState(!1),[Ce,B]=a.useState(null),[ie,V]=a.useState(""),[z,v]=a.useState({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),[$,M]=a.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[L,K]=a.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0});a.useEffect(()=>{X();const s=localStorage.getItem("token");return s&&Ze.connect(s,d=>{d&&d.allProducts&&r(d.allProducts)}).catch(d=>{console.warn("WebSocket connection failed:",d)}),()=>{Ze.disconnect()}},[]);const X=async()=>{try{await c();const s=await Ye.getAll();m(s)}catch(s){console.error("Failed to load data:",s)}};a.useEffect(()=>{j&&r(j)},[j]);const xe=(s,d=!0)=>{const k=s.target.files[0];if(k){if(k.size>2*1024*1024){G("Image must be smaller than 2MB","error");return}const F=new FileReader;F.onload=R=>{const W=R.target.result;V(W),d?v({...z,image:W}):(K({...L,image:W}),L.id&&setTimeout(async()=>{try{await ee.update(L.id,{image:W}),G("âœ… Image saved","success")}catch(je){console.error("Failed to save image:",je)}},500))},F.readAsDataURL(k)}},he=s=>x.filter(k=>k.productId===s&&k.quantity>0).reduce((k,F)=>k+F.quantity,0),et=s=>x.filter(d=>d.productId===s&&d.quantity>0),G=(s,d="success")=>{te({message:s,type:d}),setTimeout(()=>te(null),5e3)},ce=async s=>{s.preventDefault();try{const d={...z,price:parseFloat(z.price),cost:parseFloat(z.cost||0),quantity:0,visibleToCashier:!z.expenseOnly&&z.visibleToCashier!==!1},k=await ee.create(d);v({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),V(""),u(!1),await X(),G(`âœ… Product "${k.name}" added successfully! ${k.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success")}catch(d){console.error("Failed to create product:",d),alert(`Failed to create product: ${d.message||"Unknown error"}`)}},tt=async s=>{s.preventDefault();try{const d={id:`batch-${Date.now()}`,productId:U.id,quantity:parseInt($.quantity),expiryDate:$.expiryDate,batchNumber:$.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat($.cost||U.cost||0)};m(k=>[...k,d]),G("âš¡ Adding stock...","info");try{await Ye.create({productId:U.id,quantity:parseInt($.quantity),expiryDate:$.expiryDate,batchNumber:$.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat($.cost||U.cost||0)}),M({quantity:"",expiryDate:"",batchNumber:"",cost:""}),P(!1),b(null),await X(),G(`âœ… Stock added successfully for ${U.name}!`,"success")}catch(k){throw m(F=>F.filter(R=>R.id!==d.id)),k}}catch(d){console.error("Failed to add stock:",d),G(`âŒ Failed to add stock: ${d.message||"Unknown error"}`,"error")}},be=async s=>{s.preventDefault();try{const d=l.find(R=>R.id===L.id);if(parseFloat(L.price)<d.price){alert("You cannot lower prices, only increase.");return}const k={...L,price:parseFloat(L.price),cost:parseFloat(L.cost),quantity:parseFloat(L.quantity)},F={...d,...k};r(R=>R.map(W=>W.id===L.id?F:W)),ne(!0),G("âš¡ Updating product...","info");try{const R=await ee.update(L.id,k);p(!1),f()?(window.dispatchEvent(new CustomEvent("productUpdated",{detail:{product:R,originalProduct:d,timestamp:new Date().toISOString(),type:"update"}})),G("âœ… Product updated and synced!","success")):G("âœ… Product updated successfully!","success"),B(new Date)}catch(R){throw r(W=>W.map(je=>je.id===L.id?d:je)),R}finally{ne(!1)}}catch(d){console.error("Failed to update product:",d),G(`âŒ Update failed: ${d.message||"Unknown error"}`,"error")}},st=async s=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const d=l.find(F=>F.id===s),k=await ee.delete(s);if(r(F=>F.filter(R=>R.id!==s)),f()&&d)ne(!0),window.dispatchEvent(new CustomEvent("productDeleted",{detail:{product:d,timestamp:new Date().toISOString(),type:"delete"}})),G(`ðŸ“¡ Product "${d.name}" deleted and synced to all dashboards!`,"success"),B(new Date),setTimeout(()=>{ne(!1)},3e3);else{const F=k?.message||"Product deleted successfully!";alert(F)}await c()}catch(d){console.error("Failed to delete product:",d);let k="Failed to delete product";d.message.includes("Failed to execute")||d.message.includes("JSON")?k="Network error. Please check your connection and try again.":d.message.includes("401")||d.message.includes("unauthorized")?k="You are not authorized to delete this product.":d.message.includes("404")||d.message.includes("not found")?k="Product not found. It may have been deleted already.":d.message&&(k=`Failed to delete product: ${d.message}`),alert(k)}},Fe=(l||[]).filter(s=>{if(!s)return!1;const d=s.name?.toLowerCase().includes(N.toLowerCase()),k=h==="all"||h==="raw"&&!s.recipe||h==="composite"&&s.recipe||h==="expense"&&s.expenseOnly||h==="low-stock"&&s.quantity<10;return d&&k}),at=(l||[]).filter(s=>s&&!s.recipe&&!s.expenseOnly),Q=(l||[]).filter(s=>s&&s.recipe),rt=(l||[]).filter(s=>s&&s.expenseOnly),lt=s=>{if(!s||!s.recipe)return 0;let d=1/0;return(s.recipe||[]).forEach(k=>{if(!k)return;const F=(l||[]).find(R=>R&&R.id===k.productId);if(F&&F.quantity>0&&k.quantity>0){const R=Math.floor(F.quantity/k.quantity);d=Math.min(d,R)}}),d===1/0?0:d},nt=s=>{if(!s)return 0;if(!s.recipe)return s.cost||0;let d=0;return(s.recipe||[]).forEach(k=>{if(!k)return;const F=(l||[]).find(R=>R&&R.id===k.productId);if(F&&F.quantity>0){const R=(F.cost||0)/F.quantity;d+=R*(k.quantity||0)}}),d},it=async s=>{b(s);try{const d=await ee.getWeightPricing(s.id);g(d.weightPricing||{})}catch(d){console.error("Failed to load weight pricing:",d),g({})}D(!0)},ct=async s=>{if(s.preventDefault(),!A.weight||!A.price){G("âŒ Please enter both weight and price","error");return}try{const d=parseFloat(A.weight),k=parseFloat(A.price);if(d*10%1!==0){G("âŒ Weight must be in 0.1kg increments (0.1, 0.2, 0.3, etc)","error");return}await ee.addWeightPrice(U.id,d,k),g({...C,[String(d)]:k}),E({weight:"",price:""}),G(`âœ… Weight price added for ${d}kg`,"success")}catch(d){G(`âŒ Failed to add weight price: ${d.message}`,"error")}},o=async s=>{if(confirm(`Delete pricing for ${s}kg?`))try{await ee.deleteWeightPrice(U.id,s);const d={...C};delete d[String(s)],g(d),G(`âœ… Weight price for ${s}kg deleted`,"success")}catch(d){G(`âŒ Failed to delete weight price: ${d.message}`,"error")}};return e.jsxs("div",{className:"p-6 space-y-6",children:[Y&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${Y.type==="success"?"bg-green-50 border border-green-200 text-green-800":Y.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:Y.message}),e.jsx("button",{onClick:()=>te(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(At,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:N,onChange:s=>i(s.target.value)})]}),e.jsxs("select",{value:h,onChange:s=>w(s.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>u(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:at.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:Q.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:rt.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(Fe||[]).map(s=>{if(!s)return null;const d=nt(s),k=s.price?((s.price-d)/s.price*100).toFixed(1):0,F=lt(s),R=O===s.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-12 h-12 object-cover rounded-lg",onError:W=>{W.target.style.display="none",W.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:s.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.recipe&&e.jsx("button",{onClick:()=>_(R?null:s.id),className:"p-1 hover:bg-gray-200 rounded",children:R?e.jsx(Qt,{className:"w-4 h-4"}):e.jsx(Yt,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:s.name}),s.quantity<10&&!s.recipe&&e.jsx(we,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${s.expenseOnly?"badge-warning":s.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:s.expenseOnly?"Expense":s.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",s.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",d.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${he(s.id)===0?"text-red-600":he(s.id)<10?"text-yellow-600":"text-gray-900"}`,children:[he(s.id)," ",s.unit]}),he(s.id)<10&&he(s.id)>0&&e.jsx(we,{className:"w-4 h-4 text-yellow-500"}),he(s.id)===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600",children:[et(s.id).length," active"]}),e.jsx("button",{onClick:()=>{b(s),P(!0)},className:"p-1 hover:bg-blue-50 rounded text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(re,{className:"w-3 h-3"})})]})}),e.jsx("td",{className:"px-4 py-3",children:s.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[F," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${k>30?"text-green-600":k>15?"text-yellow-600":"text-red-600"}`,children:[k,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>it(s),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600 transition-colors",title:"Edit weight-based pricing",children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{K(s),p(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>st(s.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(le,{className:"w-4 h-4"})})]})})]},s.id),R&&s.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(s.recipe||[]).map((W,je)=>{if(!W)return null;const pe=(l||[]).find(gt=>gt&&gt.id===W.productId);if(!pe)return null;const pt=(pe.cost||0)/(pe.quantity||1),Ht=pt*(W.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:pe.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[W.quantity||0," ",pe.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[pe.quantity||0," ",pe.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",pt.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",Ht.toFixed(2)]})]},je)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",d.toFixed(2)]})]})})]})]})})})]})})})]})})}),y&&U&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Add Stock for ",U.name]}),e.jsxs("form",{onSubmit:tt,className:"space-y-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:$.quantity,onChange:s=>M({...$,quantity:s.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:$.expiryDate,onChange:s=>M({...$,expiryDate:s.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:$.batchNumber,onChange:s=>M({...$,batchNumber:s.target.value})}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost per Unit",className:"input",value:$.cost,onChange:s=>M({...$,cost:s.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{P(!1),b(null),M({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:z.name,onChange:s=>v({...z,name:s.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:s=>xe(s,!0),className:"input"}),e.jsx(Tt,{className:"w-5 h-5 text-gray-400"})]}),(ie||z.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:ie||z.image,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:z.price,onChange:s=>v({...z,price:s.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:z.cost,onChange:s=>v({...z,cost:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:z.category,onChange:s=>v({...z,category:s.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsxs("select",{className:"input",value:z.unit,onChange:s=>v({...z,unit:s.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:z.expenseOnly,onChange:s=>v({...z,expenseOnly:s.target.checked,visibleToCashier:!s.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!z.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:z.visibleToCashier,onChange:s=>v({...z,visibleToCashier:s.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{u(!1),V(""),v({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0})},className:"btn-secondary",children:"Cancel"})]})]})]})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:be,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:L.name,onChange:s=>K({...L,name:s.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:L.image||"",onChange:s=>K({...L,image:s.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:s=>{const d=s.target.files[0];if(d){const k=new FileReader;k.onloadend=()=>{K({...L,image:k.result})},k.readAsDataURL(d)}}})]}),L.image&&e.jsx("img",{src:L.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:L.price||"",onChange:s=>K({...L,price:s.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:L.cost||"",onChange:s=>K({...L,cost:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:L.quantity||"",onChange:s=>K({...L,quantity:s.target.value}),required:!0}),e.jsxs("select",{className:"input",value:L.unit||"pcs",onChange:s=>K({...L,unit:s.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:L.category||"raw",onChange:s=>K({...L,category:s.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:L.expenseOnly||!1,onChange:s=>K({...L,expenseOnly:s.target.checked,visibleToCashier:!s.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!L.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:L.visibleToCashier!==!1,onChange:s=>K({...L,visibleToCashier:s.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>p(!1),className:"btn-secondary",children:"Cancel"})]})]})]})}),T&&U&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-96 overflow-y-auto",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Weight-Based Pricing - ",U.name]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Set different prices for different weights (in 0.1kg increments)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700",children:"Add New Weight Price"}),e.jsxs("form",{onSubmit:ct,className:"flex gap-3",children:[e.jsx("input",{type:"number",step:"0.1",min:"0.1",placeholder:"Weight (kg) - e.g., 0.1, 0.5, 1.0",className:"input flex-1",value:A.weight,onChange:s=>E({...A,weight:s.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Price (KSH)",className:"input flex-1",value:A.price,onChange:s=>E({...A,price:s.target.value}),required:!0}),e.jsx("button",{type:"submit",className:"btn-primary whitespace-nowrap",children:"Add Price"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Current Prices"}),Object.keys(C).length>0?e.jsx("div",{className:"space-y-2",children:Object.entries(C).sort(([s],[d])=>parseFloat(s)-parseFloat(d)).map(([s,d])=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-medium",children:[s," kg"]}),e.jsxs("span",{className:"text-gray-600 ml-4",children:["KSH ",parseFloat(d).toLocaleString()]})]}),e.jsx("button",{onClick:()=>o(s),className:"text-red-600 hover:bg-red-50 px-3 py-1 rounded text-sm font-medium transition-colors",children:"Delete"})]},s))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No weight-based pricing set. Add one above."})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Base price:"})," KSH ",U.price?.toLocaleString()]})})]}),e.jsx("div",{className:"flex gap-2 mt-6",children:e.jsx("button",{onClick:()=>{D(!1),b(null),g({}),E({weight:"",price:""})},className:"btn-secondary flex-1",children:"Done"})})]})})]})}function As(){const[t,n]=a.useState([]),[f,j]=a.useState([]),[c,l]=a.useState(!1),[r,x]=a.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});a.useEffect(()=>{m()},[]);const m=async()=>{const S=await ee.getAll();n(S),j(S.filter(p=>!p.recipe))},h=()=>{x({...r,ingredients:[...r.ingredients,{name:"",quantity:"",unit:"pcs"}]})},w=(S,p,y)=>{const P=[...r.ingredients];P[S][p]=y,x({...r,ingredients:P})},N=S=>{x({...r,ingredients:r.ingredients.filter((p,y)=>y!==S)})},i=()=>r.ingredients.reduce((S,p)=>{const y=f.find(P=>P.name.toLowerCase()===p.name.toLowerCase());if(y&&p.quantity){const P=y.cost/y.quantity;return S+P*parseFloat(p.quantity)}return S},0),I=async S=>{S.preventDefault();const p=[];for(const P of r.ingredients){if(!P.name||!P.quantity)continue;const T=f.find(D=>D.name.toLowerCase()===P.name.toLowerCase());T?p.push({productId:T.id,quantity:parseFloat(P.quantity),unit:P.unit||"pcs"}):p.push({name:P.name,quantity:parseFloat(P.quantity),unit:P.unit||"pcs"})}if(p.length===0){alert("Please add at least one ingredient");return}const y=i();try{await ee.create({name:r.name,price:parseFloat(r.price),cost:y,quantity:0,unit:"pcs",category:"composite",recipe:p,image:r.image||"",visibleToCashier:r.visibleToCashier,expenseOnly:!1}),x({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),l(!1),m(),alert("Recipe created successfully!")}catch(P){console.error("Error creating recipe:",P),alert("Failed to create recipe. Please try again.")}},u=t.filter(S=>S.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>l(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",u.length,")"]}),u.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:u.map(S=>{const p=S.recipe.reduce((P,T)=>{if(T.productId){const D=t.find(U=>U.id===T.productId);if(D){const U=D.cost/D.quantity;return P+U*T.quantity}}else if(T.name){const D=t.find(U=>U.name.toLowerCase()===T.name.toLowerCase());if(D){const U=D.cost/D.quantity;return P+U*T.quantity}}return P},0),y=((S.price-p)/S.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:S.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",S.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",p.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${y>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",y,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(le,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:S.recipe.map((P,T)=>{let D="",U=P.unit||"pcs";if(P.productId){const b=t.find(C=>C.id===P.productId);b&&(D=b.name,U=b.unit)}else P.name&&(D=P.name,U=P.unit||"pcs");return D?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:D}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[P.quantity," ",U]})]},T):null})})]})]},S.id)})})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:r.name,onChange:S=>x({...r,name:S.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:r.price,onChange:S=>x({...r,price:S.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:r.image,onChange:S=>x({...r,image:S.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.visibleToCashier,onChange:S=>x({...r,visibleToCashier:S.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:h,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:r.ingredients.map((S,p)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:S.name,onChange:y=>w(p,"name",y.target.value),required:!0,list:`ingredients-list-${p}`}),e.jsx("datalist",{id:`ingredients-list-${p}`,children:f.map(y=>e.jsxs("option",{value:y.name,children:[y.name," (",y.quantity," ",y.unit," available)"]},y.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:S.quantity,onChange:y=>w(p,"quantity",y.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:S.unit,onChange:y=>w(p,"unit",y.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>N(p),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(le,{className:"w-4 h-4"})})]},p))}),r.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),r.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",i().toFixed(2)]})]}),r.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(r.price)-i())/parseFloat(r.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(Zt,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{l(!1),x({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ts(){const[t,n]=a.useState([]),[f,j]=a.useState("all"),[c,l]=a.useState([]),[r,x]=a.useState(!1);a.useEffect(()=>{m()},[]);const m=async()=>{const p=await Le.getAll();n(p.reverse())},h=async p=>{if(window.confirm("Delete this sale? This action cannot be undone."))try{x(!0);const y=localStorage.getItem("token");if(!(await fetch(`${H}/sales/${p}`,{method:"DELETE",headers:{Authorization:`Bearer ${y}`}})).ok)throw new Error("Failed to delete sale");n(t.filter(T=>T.id!==p)),alert("Sale deleted successfully")}catch(y){alert("Failed to delete sale: "+y.message)}finally{x(!1)}},w=async()=>{if(c.length===0){alert("No sales selected");return}if(window.confirm(`Delete ${c.length} sales? This action cannot be undone.`))try{x(!0);const p=localStorage.getItem("token");if(!(await fetch(`${H}/sales/bulk-delete`,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({saleIds:c})})).ok)throw new Error("Failed to delete sales");n(t.filter(P=>!c.includes(P.id))),l([]),alert("Sales deleted successfully")}catch(p){alert("Failed to delete sales: "+p.message)}finally{x(!1)}},N=async()=>{if(window.confirm("Clear ALL sales data? This will delete everything and cannot be undone."))try{x(!0);const p=localStorage.getItem("token");if(!(await fetch(`${H}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({type:"sales"})})).ok)throw new Error("Failed to clear sales");n([]),l([]),alert("All sales data cleared")}catch(p){alert("Failed to clear sales: "+p.message)}finally{x(!1)}},i=t.filter(p=>{if(f==="today")return new Date(p.createdAt).toDateString()===new Date().toDateString();if(f==="week"){const y=new Date;return y.setDate(y.getDate()-7),new Date(p.createdAt)>=y}return!0}),I=i.reduce((p,y)=>p+y.total,0),u=i.reduce((p,y)=>p+(y.cogs||0),0),S=I-u;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:f,onChange:p=>j(p.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]}),c.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[c.length," selected"]}),e.jsxs("button",{onClick:w,disabled:r,className:"px-3 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(le,{className:"w-4 h-4"}),"Delete Selected"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:N,disabled:r||t.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(Dt,{className:"w-4 h-4"}),"Clear All Sales"]}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(Xt,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",I.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",u.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",S.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:c.length===i.length&&i.length>0,onChange:p=>{p.target.checked?l(i.map(y=>y.id)):l([])},className:"rounded"})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Action"})]})}),e.jsx("tbody",{children:i.map(p=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:c.includes(p.id),onChange:y=>{y.target.checked?l([...c,p.id]):l(c.filter(P=>P!==p.id))},className:"rounded"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",p.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(p.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[p.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:p.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",p.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",p.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",p.profit?.toLocaleString()||0]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("button",{onClick:()=>h(p.id),disabled:r,className:"px-3 py-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(le,{className:"w-4 h-4"}),"Delete"]})})]},p.id))})]})})]})]})}function Ds(){const[t,n]=a.useState([]),[f,j]=a.useState(!1),[c,l]=a.useState({description:"",amount:"",category:"general"});a.useEffect(()=>{r()},[]);const r=async()=>{const N=await Qe.getAll();n(N.reverse())},x=async N=>{N.preventDefault(),await Qe.create({...c,amount:parseFloat(c.amount)}),l({description:"",amount:"",category:"general"}),j(!1),r()},m=t.reduce((N,i)=>N+i.amount,0),h=t.filter(N=>!N.automatic),w=t.filter(N=>N.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("button",{onClick:()=>j(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",m.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",h.reduce((N,i)=>N+i.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",w.reduce((N,i)=>N+i.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.map(N=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(N.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:N.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:N.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${N.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:N.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",N.amount?.toLocaleString()]})]},N.id))})]})})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:c.description,onChange:N=>l({...c,description:N.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:c.amount,onChange:N=>l({...c,amount:N.target.value}),required:!0}),e.jsxs("select",{className:"input",value:c.category,onChange:N=>l({...c,category:N.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>j(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Is(){const{isCashierUserManagementEnabled:t,isCashier:n}=me(),[f,j]=a.useState([]),[c,l]=a.useState(!0),[r,x]=a.useState(!1),[m,h]=a.useState(null),[w,N]=a.useState(null),[i,I]=a.useState(null),[u,S]=a.useState(0),[p,y]=a.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),[P,T]=a.useState(!1),[D,U]=a.useState(null),[b,C]=a.useState("");a.useEffect(()=>{g()},[]),a.useEffect(()=>()=>{i?.intervalId&&clearInterval(i.intervalId)},[i]);const g=async()=>{try{l(!0);const v=await ge.getAll();j(Array.isArray(v)?v:[])}catch(v){console.error("Error loading users:",v),j([])}finally{l(!1)}},A=()=>Math.floor(1e3+Math.random()*9e3).toString(),E=async v=>{if(v.preventDefault(),console.log("Form submitted with data:",p),!p.name?.trim()||!p.email?.trim()||!p.password?.trim()){alert("Please fill in all required fields");return}if(p.password.length<6){alert("Password must be at least 6 characters long");return}try{l(!0);const $=A(),M={name:p.name.trim(),email:p.email.trim().toLowerCase(),password:p.password.trim(),pin:$};console.log("Sending user data:",M);const L=await ge.create(M);console.log("User creation result:",L),await g();const K=`âœ… Cashier added successfully!

ðŸ“§ Email: ${M.email}
ðŸ”‘ Password: ${M.password}
ðŸ”¢ PIN: ${$}

ðŸ’¡ LOGIN OPTIONS:
1. Email + Password: Use email and password above
2. PIN Login: Use email + ${$}

Please share these credentials securely with the new cashier.`;alert(K),y({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),x(!1)}catch($){console.error("Error creating cashier:",$);let M="Failed to add cashier";$.message.includes("Current user not found")?M="Authentication error. Please refresh the page and try again.":$.message.includes("email")?M="Email already exists. Please use a different email.":$.message.includes("network")||$.message.includes("fetch")?M="Network error. Please check your connection and try again.":$.message&&(M=`Failed to add cashier: ${$.message}`),alert(M)}finally{l(!1)}},O=async(v,$)=>{try{l(!0),await ge.update(v,{permissions:$}),await g(),h(null)}catch(M){console.error("Error updating permissions:",M),alert("Failed to update permissions: "+M.message)}finally{l(!1)}},_=async(v,$)=>{try{l(!0);const M=!$,L=await fetch(`${H}/users/${v}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({active:M})});if(!L.ok){const K=await L.json().catch(()=>({error:"Network error"}));throw new Error(K.error||`HTTP ${L.status}: ${L.statusText}`)}await g()}catch(M){console.error("Error updating user status:",M),alert("Failed to update user status: "+M.message)}finally{l(!1)}},Y=async(v,$)=>{try{l(!0);const M=!$,L=await fetch(`${H}/users/${v}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({locked:M})});if(!L.ok){const K=await L.json().catch(()=>({error:"Network error"}));throw new Error(K.error||`HTTP ${L.status}: ${L.statusText}`)}await g()}catch(M){console.error("Error updating user lock status:",M),alert("Failed to update user lock status: "+M.message)}finally{l(!1)}},te=async v=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{l(!0),await ge.delete(v),await g()}catch($){console.error("Error deleting user:",$),alert("Failed to delete user: "+$.message)}finally{l(!1)}},fe=async()=>{if(window.confirm("Clear ALL users data? This will delete all users and cannot be undone."))try{l(!0);const v=localStorage.getItem("token");if(!(await fetch(`${H}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:JSON.stringify({type:"users"})})).ok)throw new Error("Failed to clear users");j([]),alert("All users data cleared")}catch(v){alert("Failed to clear users: "+v.message)}finally{l(!1)}},ne=v=>{U(v),C(A()),T(!0)},Ce=async()=>{try{l(!0),await ge.update(D.id,{cashierPIN:b}),await g(),T(!1),U(null),C(""),alert(`âœ… PIN reset successfully!

ðŸ”¢ New PIN for ${D.name}: ${b}

Please share this PIN securely with the cashier.`)}catch(v){console.error("Error resetting PIN:",v),alert("Failed to reset PIN: "+v.message)}finally{l(!1)}},B=v=>{N(v),I({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const $=setInterval(()=>{V(v)},3e3);I(M=>({...M,intervalId:$})),V(v)},ie=()=>{i?.intervalId&&clearInterval(i.intervalId),N(null),I(null)},V=async v=>{try{const $=await Le.getAll(),L=(Array.isArray($)?$:[]).filter(X=>X.cashierId===v.id).sort((X,xe)=>new Date(xe.createdAt)-new Date(X.createdAt)).slice(0,10),K={isActive:Math.random()>.3,currentCart:L.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:L.reduce((X,xe)=>X+xe.total,0),salesCount:L.length,lastActivity:L.length>0?new Date(L[0].createdAt).toLocaleTimeString():"No recent activity"};I(K)}catch($){console.error("Error loading live view data:",$)}},z=(f||[]).filter(v=>v.role==="cashier");return c&&f.length===0?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),e.jsx("div",{className:"flex items-center gap-2",children:t()&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:fe,disabled:c||f.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(Dt,{className:"w-4 h-4"}),"Clear All Users"]}),e.jsxs("button",{onClick:()=>x(!0),className:"btn-primary flex items-center gap-2",disabled:c,children:[e.jsx(re,{className:"w-4 h-4"}),"Add Cashier"]})]})})]}),n()&&!t()&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(ae,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"User Management Restricted"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The admin has disabled cashier user management. You cannot add, edit, or remove users at this time."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:f.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:z.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:f.filter(v=>v.active).length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(f||[]).map(v=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:v.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:v.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${v.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:v.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:v.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:v.role==="cashier"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:v.pin||v.cashierPIN||"----"}),e.jsx("button",{onClick:()=>ne(v),className:"p-1 hover:bg-yellow-50 rounded text-yellow-600",title:"Reset PIN",disabled:c,children:e.jsx(ve,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${v.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:v.active?e.jsxs(e.Fragment,{children:[e.jsx(ft,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"w-3 h-3"}),"Inactive"]})}),v.locked&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:[e.jsx(Ie,{className:"w-3 h-3"}),"Locked"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>_(v.id,v.active),className:`p-2 rounded-lg transition ${v.active?"hover:bg-red-50 text-red-600":"hover:bg-green-50 text-green-600"}`,title:v.active?"Deactivate User":"Activate User",disabled:c,children:v.active?e.jsx(bt,{className:"w-4 h-4"}):e.jsx(ft,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Y(v.id,v.locked||!1),className:`p-2 rounded-lg transition ${v.locked?"hover:bg-green-50 text-green-600":"hover:bg-red-50 text-red-600"}`,title:v.locked?"Unlock User":"Lock User",disabled:c,children:e.jsx(Ie,{className:"w-4 h-4"})})]}),v.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",v.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(xt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>B(v),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(jt,{className:"w-4 h-4"})})]}),t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>h(v),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600",title:"Edit Permissions",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>te(v.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",title:"Delete User",disabled:c,children:e.jsx(le,{className:"w-4 h-4"})})]})]})})]},v.id))})]}),f.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ke,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first cashier to get started"})]})]})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:p.name||"",onChange:v=>{console.log("Name input changed:",v.target.value),y({...p,name:v.target.value})},required:!0,disabled:c}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:p.email||"",onChange:v=>{console.log("Email input changed:",v.target.value),y({...p,email:v.target.value})},required:!0,disabled:c}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:p.password||"",onChange:v=>{console.log("Password input changed:",v.target.value),y({...p,password:v.target.value})},required:!0,minLength:6,disabled:c}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(p.permissions).map(([v,$])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:M=>y({...p,permissions:{...p.permissions,[v]:M.target.checked}}),disabled:c}),e.jsx("span",{className:"text-sm capitalize",children:v.replace(/([A-Z])/g," $1").trim()})]},v))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:c,children:c?"Adding...":"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>x(!1),className:"btn-secondary",disabled:c,children:"Cancel"})]})]})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",m.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(m.permissions||{}).map(([v,$])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:M=>h({...m,permissions:{...m.permissions,[v]:M.target.checked}}),disabled:c}),e.jsx("span",{className:"text-sm capitalize",children:v.replace(/([A-Z])/g," $1").trim()})]},v))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>O(m.id,m.permissions),className:"btn-primary flex-1",disabled:c,children:c?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>h(null),className:"btn-secondary",disabled:c,children:"Cancel"})]})]})}),w&&i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(jt,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",w.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:ie,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(Ee,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${i.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:i.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(de,{className:"w-4 h-4"}),"Last Activity: ",i.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Me,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(i.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(i.currentCart||[]).map((v,$)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[v.name," x",v.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",v.price.toLocaleString()]})]},$)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(i.currentCart||[]).reduce((v,$)=>v+$.price*$.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:i.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",i.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",i.salesCount>0?Math.round(i.totalSalesToday/i.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})}),P&&D&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Reset PIN for ",D.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate a new 4-digit PIN for this cashier. The old PIN will be invalid."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"New PIN:"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-mono text-3xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:b})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C(A()),className:"btn-secondary flex-1",disabled:c,children:"Generate New PIN"}),e.jsx("button",{onClick:Ce,className:"btn-primary flex-1",disabled:c,children:c?"Updating...":"Confirm & Update"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>{T(!1),U(null),C("")},className:"btn-secondary w-full",disabled:c,children:"Cancel"})})]})})]})}function Es(){const[t,n]=a.useState([]),[f,j]=a.useState("all");a.useEffect(()=>{c()},[]);const c=()=>{const m=JSON.parse(localStorage.getItem("clockRecords")||"[]");n(m.reverse())},l=f==="all"?t:t.filter(m=>m.date===new Date().toDateString()),r=l.filter(m=>m.date===new Date().toDateString()).reduce((m,h)=>m+h.duration,0)/60,x=m=>{const h=Math.floor(m/60),w=m%60;return`${h}h ${w}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(de,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[r.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(ht,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(l.filter(m=>m.date===new Date().toDateString()).map(m=>m.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(He,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:t.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>j("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${f==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>j("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${f==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"})]})}),e.jsx("tbody",{children:l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-gray-500",children:"No records found"})}):l.map((m,h)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:m.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(m.clockIn).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(m.clockIn).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(m.clockOut).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:x(m.duration)})})]},h))})]})})]})]})}function $s(){const{user:t,updateUser:n}=me();ue();const[f,j]=a.useState(!1),[c,l]=a.useState(t?.plan||"ultra"),[r,x]=a.useState({}),[m,h]=a.useState(null),[w,N]=a.useState(t?.profilePicture||null),[i,I]=a.useState(!0),[u,S]=a.useState(!0);a.useEffect(()=>{p()},[]);const p=async()=>{try{const g=await Te.get();x(g),g.logo&&h(g.logo),I(g.cashierUserManagement!==!1),S(g.realTimeProductSync!==!1)}catch(g){console.error("Failed to load settings:",g)}},y=async g=>{try{const A={...r,...g};return await Te.update(A),x(A),!0}catch(A){return console.error("Failed to save settings:",A),!1}},P=async()=>{const g=!i;I(g),await y({cashierUserManagement:g})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{cashierUserManagement:g}})),alert(`âœ… Cashier User Management ${g?"ENABLED":"DISABLED"}`)):(I(!g),alert("âŒ Failed to save setting. Please try again."))},T=async()=>{const g=!u;S(g),await y({realTimeProductSync:g})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{realTimeProductSync:g}})),alert(`âœ… Real-time Product Sync ${g?"ENABLED":"DISABLED"}`)):(S(!g),alert("âŒ Failed to save setting. Please try again."))},D=async g=>{const A=g.target.files[0];if(A){const E=new FileReader;E.onloadend=async()=>{const O=E.result;h(O);try{await Te.update({...r,logo:O}),x({...r,logo:O})}catch(_){console.error("Failed to save logo:",_)}},E.readAsDataURL(A)}},U=async g=>{const A=g.target.files[0];if(A){const E=new FileReader;E.onloadend=async()=>{const O=E.result;N(O);try{await n({...t,profilePicture:O})}catch(_){console.error("Failed to save profile picture:",_)}},E.readAsDataURL(A)}},b=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],C=async()=>{const g=b.find(E=>E.id===c),A=c==="ultra"?"admin":"cashier";await n({...t,role:A,plan:c,price:g.price}),j(!1),setTimeout(()=>window.location.href=A==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(ht,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[w?e.jsx("img",{src:w,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:t?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(yt,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:U})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Je,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>j(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(ut,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(ke,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cashier User Management"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Cashier User Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow cashiers to add and remove users"})]}),e.jsx("button",{onClick:P,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${i?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${i?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${i?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:i?"âœ… Cashiers can add and remove users when enabled":"âŒ Cashiers cannot add or remove users when disabled"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(It,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Real-time Product Sync"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Real-time Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync products between admin and cashier dashboards"})]}),e.jsx("button",{onClick:T,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${u?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${u?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${u?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:u?"âœ… Products will sync in real-time across all dashboards":"âŒ Products will not sync automatically across dashboards"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(es,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[m&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:m,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(yt,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:D})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:b.map(g=>e.jsxs("div",{onClick:()=>l(g.id),className:`card cursor-pointer transition-all ${c===g.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:g.name}),c===g.id&&e.jsx(Ke,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",g.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:g.features.map((A,E)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ke,{className:"w-4 h-4 text-green-600"}),A]},E))})]},g.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:C,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>j(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function Ls(){const[t,n]=a.useState([]),[f,j]=a.useState(!1),[c,l]=a.useState(null),[r,x]=a.useState({name:"",amount:"",description:"",active:!0});a.useEffect(()=>{m()},[]);const m=()=>{const i=JSON.parse(localStorage.getItem("serviceFees")||"[]");n(i)},h=i=>{localStorage.setItem("serviceFees",JSON.stringify(i)),n(i)},w=i=>{if(i.preventDefault(),c){const I=t.map(u=>u.id===c.id?{...r,id:u.id}:u);h(I)}else{const I={...r,id:Date.now(),createdAt:new Date().toISOString()};h([...t,I])}j(!1),l(null),x({name:"",amount:"",description:"",active:!0})},N=i=>{confirm("Delete this service fee?")&&h(t.filter(I=>I.id!==i))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{j(!0),l(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(i=>e.jsxs("div",{className:`card ${i.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(oe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:i.name}),e.jsx("p",{className:"text-xs text-gray-500",children:i.description})]})]}),e.jsx("span",{className:`badge ${i.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:i.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",i.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{l(i),x(i),j(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(ve,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>N(i.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(le,{className:"w-4 h-4 text-red-600"})})]})]})]},i.id))}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[c?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:r.name,onChange:i=>x({...r,name:i.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:r.amount,onChange:i=>x({...r,amount:i.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:r.description,onChange:i=>x({...r,description:i.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.active,onChange:i=>x({...r,active:i.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>j(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Fs(){const[t,n]=a.useState([]),[f,j]=a.useState([]),[c,l]=a.useState(!1),[r,x]=a.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});a.useEffect(()=>{m(),h()},[]);const m=async()=>{try{const u=localStorage.getItem("token"),S=await fetch(`${H}/reminders`,{headers:{Authorization:`Bearer ${u}`}});if(!S.ok){console.error("API Error:",S.status,S.statusText),n([]);return}const p=await S.json();Array.isArray(p)?n(p):(console.error("Expected array but got:",typeof p,p),n([]))}catch(u){console.error("Failed to fetch reminders:",u),n([])}},h=async()=>{try{const u=localStorage.getItem("token"),S=await fetch(`${H}/products`,{headers:{Authorization:`Bearer ${u}`}});if(!S.ok){console.error("API Error:",S.status,S.statusText),j([]);return}const p=await S.json();Array.isArray(p)?j(p):(console.error("Expected array but got:",typeof p,p),j([]))}catch(u){console.error("Failed to fetch products:",u),j([])}},w=async u=>{u.preventDefault();try{const S=localStorage.getItem("token"),p=await fetch(`${H}/reminders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`},body:JSON.stringify(r)});if(!p.ok){const P=await p.json();console.error("Failed to create reminder:",P),alert(`Failed to create reminder: ${P.error||"Unknown error"}`);return}const y=await p.json();x({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),l(!1),m(),alert("Reminder created successfully!")}catch(S){console.error("Failed to create reminder:",S),alert("Failed to create reminder. Please try again.")}},N=async u=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const p=localStorage.getItem("token"),y=await fetch(`${H}/reminders/${u}`,{method:"DELETE",headers:{Authorization:`Bearer ${p}`}});if(!y.ok){const P=await y.json();console.error("Failed to delete reminder:",P),alert(`Failed to delete reminder: ${P.error||"Unknown error"}`);return}m(),alert("Reminder deleted successfully!")}catch(S){console.error("Failed to delete reminder:",S),alert("Failed to delete reminder. Please try again.")}},i=u=>{r.days.includes(u)?x({...r,days:r.days.filter(S=>S!==u)}):x({...r,days:[...r.days,u]})},I=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(ut,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("button",{onClick:()=>l(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(re,{size:20}),"New Reminder"]})]}),e.jsx("div",{className:"grid gap-4",children:t.map(u=>{const S=f.find(p=>p.id===u.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${u.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:u.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",S?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",u.frequency]}),u.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",u.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(He,{size:16}),"Next: ",new Date(u.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${u.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:u.status}),e.jsx("button",{onClick:()=>N(u.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(le,{size:20})})]})]})},u.id)})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:w,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:r.customerName,onChange:u=>x({...r,customerName:u.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:r.productId,onChange:u=>x({...r,productId:parseInt(u.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),f.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:r.frequency,onChange:u=>x({...r,frequency:u.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),r.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(u=>e.jsx("button",{type:"button",onClick:()=>i(u),className:`px-4 py-2 rounded-lg font-medium transition ${r.days.includes(u)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:u},u))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:r.nextDate,onChange:u=>x({...r,nextDate:u.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>l(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})}function Us(){const[t,n]=a.useState([]),[f,j]=a.useState(!1),[c,l]=a.useState(null),[r,x]=a.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});a.useEffect(()=>{m()},[]);const m=async()=>{try{const i=await Re.getAll();n(i)}catch(i){console.error("Failed to load discounts:",i)}},h=async i=>{i.preventDefault();try{c?await Re.update(c.id,r):await Re.create(r),j(!1),l(null),x({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),m()}catch(I){console.error("Failed to save discount:",I)}},w=async i=>{if(confirm("Delete this discount?"))try{await Re.delete(i),m()}catch(I){console.error("Failed to delete discount:",I)}},N=i=>{const I=new Date,u=new Date(i.validFrom),S=new Date(i.validTo);return i.active&&u<=I&&S>=I};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{j(!0),l(null),x({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(i=>e.jsxs("div",{className:`card ${N(i)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${N(i)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(mt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:i.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[i.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${N(i)?"badge-success":"bg-gray-200 text-gray-600"}`,children:N(i)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(i.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(i.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{l(i),x(i),j(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(ve,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>w(i.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(le,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},i.id)),t.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(mt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[c?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:r.name,onChange:i=>x({...r,name:i.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:r.percentage,onChange:i=>x({...r,percentage:parseFloat(i.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:r.validFrom,onChange:i=>x({...r,validFrom:i.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:r.validTo,onChange:i=>x({...r,validTo:i.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.active,onChange:i=>x({...r,active:i.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>j(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Os(){const[t,n]=a.useState([]),[f,j]=a.useState([]),[c,l]=a.useState("all");a.useEffect(()=>{r(),x()},[]);const r=async()=>{try{const u=await dt.getAll();n(u)}catch(u){console.error("Failed to load credit requests:",u)}},x=async()=>{try{const u=await ee.getAll();j(u)}catch(u){console.error("Failed to load products:",u)}},m=async u=>{try{await dt.approve(u),r()}catch(S){console.error("Failed to approve request:",S)}},h=async u=>{try{await dt.reject(u),r()}catch(S){console.error("Failed to reject request:",S)}},w=u=>{const S=f.find(p=>p.id===u);return S?S.name:"Unknown Product"},N=t.filter(u=>c==="all"?!0:u.status===c),i=u=>{switch(u){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},I=u=>{switch(u){case"pending":return e.jsx(de,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(Se,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(We,{className:"w-6 h-6 text-red-600"});default:return e.jsx(Je,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(u=>e.jsx("button",{onClick:()=>l(u),className:`px-4 py-2 rounded-lg font-medium transition ${c===u?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:u.charAt(0).toUpperCase()+u.slice(1)},u))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[N.map(u=>e.jsx("div",{className:`card border-l-4 ${i(u.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${u.status==="pending"?"bg-orange-600":u.status==="approved"?"bg-green-600":"bg-red-600"}`,children:I(u.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:u.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:w(u.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:u.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",u.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(u.createdAt).toLocaleString()]}),u.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(u.approvedAt).toLocaleString()]})]})]}),u.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>m(u.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Se,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>h(u.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(We,{size:16}),"Reject"]})]}),u.status!=="pending"&&e.jsx("span",{className:`badge ${u.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:u.status.toUpperCase()})]})},u.id)),N.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(Je,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",c!=="all"?c:""," credit requests found."]})]})]})]})}function Bt({onClose:t}){const[n,f]=a.useState([]),[j,c]=a.useState(!0);a.useEffect(()=>{l()},[]);const l=async()=>{try{const x=localStorage.getItem("token"),m=await fetch(`${H}/reminders/today`,{headers:{Authorization:`Bearer ${x}`}});if(!m.ok){console.error("API Error:",m.status,m.statusText),f([]);return}const h=await m.json();Array.isArray(h)?f(h):(console.error("Expected array but got:",typeof h,h),f([]))}catch(x){console.error("Failed to fetch reminders:",x),f([])}finally{c(!1)}},r=async x=>{try{const m=localStorage.getItem("token");await fetch(`${H}/reminders/${x}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({status:"fulfilled"})}),l()}catch(m){console.error("Failed to update reminder:",m)}};return j?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:t,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(Ee,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_e,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):n.map(x=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:x.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",x.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:x.frequency})]}),e.jsxs("button",{onClick:()=>r(x.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Se,{size:18}),"Mark Done"]})]},x.id))})]})})}function _t({onUnlock:t,userType:n="user"}){const[f,j]=a.useState(""),[c,l]=a.useState(""),[r,x]=a.useState("password"),[m,h]=a.useState(!1),[w,N]=a.useState(""),[i,I]=a.useState(!1),[u,S]=a.useState("2005"),p=JSON.parse(localStorage.getItem("user")||"{}");a.useEffect(()=>{(async()=>{try{const D=await Te.get();D?.screenLockPassword&&S(D.screenLockPassword)}catch(D){console.warn("Failed to load settings, using default password:",D)}})()},[]),a.useEffect(()=>{const T=document.getElementById(r==="password"?"unlock-password":"unlock-pin");T&&T.focus()},[r]);const y=async T=>{T.preventDefault(),T.stopPropagation(),I(!0),N("");try{if(r==="password")if(f===u)t();else throw new Error("Incorrect password");else if(r==="pin"&&p.pin)if(c===p.pin)t();else throw new Error("Incorrect PIN");else throw new Error(`Please enter a valid ${r}`)}catch(D){N(D.message||"Unlock failed")}finally{I(!1)}},P=T=>{const D=T.replace(/\D/g,"").slice(0,4);l(D)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:T=>T.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8",onClick:T=>T.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${n==="main_admin"?"bg-gradient-to-br from-red-600 to-orange-600":"bg-gradient-to-br from-blue-600 to-purple-600"}`,children:e.jsx(ae,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-gray-600",children:n==="main_admin"?"Main Admin":p.name||"User"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Enter your ",r," to continue"]})]}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[n!=="main_admin"&&p.pin&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unlock Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{x("password"),N("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${r==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ”‘ Password"}),e.jsx("button",{type:"button",onClick:()=>{x("pin"),N("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${r==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ“± PIN"})]})]}),(r==="password"||n==="main_admin")&&e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-password",type:m?"text":"password",placeholder:"Enter your password",className:"w-full pl-10 pr-12 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",value:f,onChange:T=>j(T.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!m),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:m?e.jsx(Et,{className:"w-5 h-5"}):e.jsx(xt,{className:"w-5 h-5"})})]}),r==="pin"&&n!=="main_admin"&&e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-pin",type:"text",placeholder:"Enter 4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-center text-2xl tracking-widest",value:c,onChange:T=>P(T.target.value),maxLength:4,required:!0})]}),w&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg border border-red-200",children:w}),e.jsx("button",{type:"submit",disabled:i||r==="pin"&&c.length!==4,className:`w-full py-3 rounded-lg font-bold transition-all disabled:opacity-50 disabled:cursor-not-allowed ${n==="main_admin"?"bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white":"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white"}`,children:i?"Unlocking...":"Unlock Screen"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Screen locked due to inactivity for security"})})]})})}function zt(t=6e4){const[n,f]=a.useState(!1),[j,c]=a.useState(Date.now()),l=a.useCallback(()=>{c(Date.now()),n&&f(!1)},[n]),r=a.useCallback(()=>{f(!1),l()},[l]);return a.useEffect(()=>{const x=["mousedown","mousemove","keypress","scroll","touchstart","click"],m=()=>{l()};x.forEach(w=>{document.addEventListener(w,m,!0)});const h=setInterval(()=>{Date.now()-j>t&&!n&&f(!0)},1e3);return()=>{x.forEach(w=>{document.removeEventListener(w,m,!0)}),clearInterval(h)}},[j,t,n,l]),[n,r,l]}function Rs(){const{user:t,logout:n,isCashierUserManagementEnabled:f}=me(),j=ue(),c=kt(),[l,r]=a.useState(!0),[x,m]=a.useState(!1),[h,w]=a.useState({}),[N,i]=zt(45e3);a.useEffect(()=>{const y=()=>{const T=localStorage.getItem("user");if(T){const D=JSON.parse(T);let U=!1;(D.plan==="ultra"||D.role==="admin")&&(D.active||(D.active=!0,U=!0),D.plan==="ultra"&&D.role!=="admin"&&(D.role="admin",U=!0),D.plan==="ultra"&&(!D.price||D.price!==1600)&&(D.price=1600,U=!0),U&&(localStorage.setItem("user",JSON.stringify(D)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};y(),setTimeout(y,100);const P=setTimeout(()=>{m(!0)},1e3);return I(),()=>clearTimeout(P)},[]);const I=async()=>{try{const y=await Te.get();w(y)}catch(y){console.error("Failed to load settings:",y)}},u=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses data? This action cannot be undone."))try{const y=localStorage.getItem("token"),T=await fetch(`${H}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!T.ok){const D=await T.json();throw new Error(D.message||"Failed to clear data")}alert("Data cleared successfully!"),window.location.reload()}catch(y){console.error("Failed to clear data:",y),alert("Failed to clear data: "+y.message)}},S=[{id:"overview",label:"Dashboard",icon:ts,path:"/admin"},{id:"sales",label:"Sales",icon:Pt,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:Ne,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:$t,path:"/admin/recipes"},{id:"expenses",label:"Expenses",icon:ze,path:"/admin/expenses"},...f()?[{id:"users",label:"Users",icon:ke,path:"/admin/users"}]:[],{id:"time",label:"Time Tracking",icon:de,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:ut,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:oe,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:mt,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:Je,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:ss,path:"/admin/settings"}],p=y=>y==="/admin"?c.pathname==="/admin":c.pathname.startsWith(y);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${l?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[l&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>r(!l),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:l?e.jsx(Ee,{className:"w-5 h-5"}):e.jsx(as,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:S.map(y=>{const P=y.icon;return e.jsxs("button",{onClick:()=>j(y.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${p(y.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(P,{className:"w-5 h-5 flex-shrink-0"}),l&&e.jsx("span",{className:"font-medium",children:y.label})]},y.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(rs,{className:"w-5 h-5 flex-shrink-0"}),l&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:n,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(Xe,{className:"w-5 h-5 flex-shrink-0"}),l&&e.jsx("span",{className:"font-medium",children:"Logout"})]}),e.jsxs("button",{onClick:u,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors",children:[e.jsx(Ee,{className:"w-5 h-5 flex-shrink-0"}),l&&e.jsx("span",{className:"font-medium",children:"Clear Data"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:S.find(y=>p(y.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:t?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(Ct,{children:[e.jsx(J,{path:"/",element:e.jsx(Ss,{})}),e.jsx(J,{path:"/sales",element:e.jsx(Ts,{})}),e.jsx(J,{path:"/inventory",element:e.jsx(Ps,{})}),e.jsx(J,{path:"/recipes",element:e.jsx(As,{})}),e.jsx(J,{path:"/expenses",element:e.jsx(Ds,{})}),e.jsx(J,{path:"/reminders",element:e.jsx(Fs,{})}),e.jsx(J,{path:"/service-fees",element:e.jsx(Ls,{})}),e.jsx(J,{path:"/discounts",element:e.jsx(Us,{})}),e.jsx(J,{path:"/credit-requests",element:e.jsx(Os,{})}),e.jsx(J,{path:"/users",element:e.jsx(Is,{})}),e.jsx(J,{path:"/time",element:e.jsx(Es,{})}),e.jsx(J,{path:"/settings",element:e.jsx($s,{})})]})})]}),x&&e.jsx(Bt,{onClose:()=>m(!1)}),N&&e.jsx(_t,{onUnlock:i,logo:h.logo})]})}function qs(){const t=ue(),[n,f]=a.useState(!1),[j,c]=a.useState(0),l=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 900) or Ultra (KSH 1,600) package",image:"ðŸ“",details:"First user becomes Admin automatically. Choose Ultra for full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],r=[{icon:Ne,title:"Smart Inventory",desc:"Track raw materials & composite products with automatic stock deduction"},{icon:$t,title:"Recipe Builder",desc:"Create bundled products with BOM and auto-calculate COGS"},{icon:qe,title:"Real-time Analytics",desc:"Monitor sales, profit margins, and expenses in real-time"},{icon:ke,title:"User Management",desc:"Add cashiers with custom permissions and role-based access"},{icon:Ie,title:"Secure & Reliable",desc:"JWT authentication with role-based security"},{icon:Ge,title:"Advanced Reports",desc:"Daily, weekly summaries with profit/loss tracking"}],x=[{name:"Basic",price:900,icon:$e,popular:!1,features:["Cashier Dashboard","Basic Inventory","Sales Tracking","Daily/Weekly Reports","Single User","Email Support"]},{name:"Ultra",price:1600,icon:Ve,popular:!0,features:["Admin + Cashier Dashboard","Full Inventory Management","Recipe/BOM Builder","Auto Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Unlimited Users","Priority Support"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/auth/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(ls,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(Ue,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>f(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(Lt,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 30-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ge,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:r.map((m,h)=>{const w=m.icon;return e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(w,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:m.title}),e.jsx("p",{className:"text-gray-600",children:m.desc})]},h)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:x.map((m,h)=>{const w=m.icon;return e.jsxs("div",{className:`relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${m.popular?"ring-4 ring-blue-600":""}`,children:[m.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${m.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(w,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:m.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",m.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:m.features.map((N,i)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:N})]},i))}),e.jsx("button",{onClick:()=>t("/plans"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${m.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},h)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(Ue,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{f(!1),c(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Ee,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",j+1," of ",l.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((j+1)/l.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(j+1)/l.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:l[j].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:l[j].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:l[j].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:l[j].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>c(Math.max(0,j-1)),disabled:j===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),j<l.length-1?e.jsxs("button",{onClick:()=>c(j+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(Ue,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{f(!1),c(0),t("/plans")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(Ue,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:l.map((m,h)=>e.jsx("button",{onClick:()=>c(h),className:`w-2 h-2 rounded-full transition-all ${h===j?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},h))})]})]})})]})}function St(){const t=kt(),[n,f]=a.useState(t.pathname==="/auth/login"),[j,c]=a.useState("password"),[l,r]=a.useState({email:"",password:"",pin:"",name:"",newPassword:"",confirmPassword:""}),[x,m]=a.useState(""),[h,w]=a.useState(!1),[N,i]=a.useState(!1),I=ue(),{login:u}=me(),S=()=>{try{return JSON.parse(localStorage.getItem("selectedPlan")||"null")}catch(y){return console.warn("Invalid selectedPlan in localStorage:",y),null}},p=async y=>{y.preventDefault(),m(""),w(!0);try{if(N){if(l.newPassword!==l.confirmPassword){m("Passwords do not match"),w(!1);return}if(l.newPassword.length<6){m("Password must be at least 6 characters"),w(!1);return}const b=await ye.login({email:l.email,newPassword:l.newPassword});b.token&&b.user&&(await u(b),I("/dashboard"));return}if(n){if(j==="pin"){if(!l.pin||l.pin.length!==4){m("Please enter a valid 4-digit PIN"),w(!1);return}}else if(!l.password){m("Please enter your password"),w(!1);return}}let P;if(n)if(j==="pin")try{P=await ye.pinLogin({email:l.email,pin:l.pin})}catch(b){if(b.message.includes("PIN not set"))m("PIN not set for this user. Please use password login.");else if(b.message.includes("Invalid PIN"))m("Invalid PIN. Please try again.");else throw b;w(!1);return}else P=await ye.login({email:l.email,password:l.password});else{const b=S();P=await ye.signup({...l,plan:b?.id||"basic"})}if(P.needsPasswordSetup){i(!0),r({...l,email:P.email}),m(""),w(!1);return}if(!P||!P.user||!P.token)throw new Error("Authentication failed. Please try again.");const T={id:Date.now(),type:n?"login":"signup",user:{id:P.user.id,name:P.user.name,email:P.user.email,role:P.user.role,plan:P.user.plan},timestamp:new Date().toISOString(),ip:"Unknown",userAgent:navigator.userAgent},D=JSON.parse(localStorage.getItem("authActivities")||"[]");D.unshift(T),D.splice(50),localStorage.setItem("authActivities",JSON.stringify(D)),await u(P);const U=n?"logged in":"signed up";console.log(`âœ… User ${P.user.name} ${U} successfully`),P.user.role==="admin"?I("/admin"):P.user.role==="cashier"||P.user.plan==="basic"?I("/dashboard/cashier"):I("/admin")}catch(P){console.error("Authentication error:",P);let T=P.message||"Authentication failed. Please try again.";P.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),T="Invalid credentials. Please try again."),m(T)}finally{w(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:n?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600",children:n?"Login to your account":"Create your account"})]}),e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[N?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.newPassword,onChange:y=>r({...l,newPassword:y.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.confirmPassword,onChange:y=>r({...l,confirmPassword:y.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!n&&e.jsxs("div",{className:"relative",children:[e.jsx(ht,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.name,onChange:y=>r({...l,name:y.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.email,onChange:y=>r({...l,email:y.target.value}),required:!0})]}),n&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Login Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>c("password"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${j==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Password"}),e.jsx("button",{type:"button",onClick:()=>c("pin"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${j==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"pin"})]})]}),n&&j==="password"&&e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.password,onChange:y=>r({...l,password:y.target.value}),required:!0})]}),n&&j==="pin"&&e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.pin,onChange:y=>r({...l,pin:y.target.value.replace(/\D/g,"").slice(0,4)}),maxLength:4,required:!0})]}),!n&&e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.password,onChange:y=>r({...l,password:y.target.value}),required:!0})]})]}),x&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:x}),e.jsx("button",{type:"submit",disabled:h,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50",children:h?"Please wait...":N?"Set Password":n?"Login":"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{f(!n),m(""),i(!1)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:n?"Don't have an account? Sign up":"Already have an account? Login"})})]})})}function Ms(){const[t,n]=a.useState("ultra"),[f,j]=a.useState(!1),[c,l]=a.useState({name:"",email:"",company:""}),r=ue(),x=[{id:"basic",name:"Basic Package",price:1e3,icon:$e,color:"from-green-500 to-teal-600",features:["Cashier Dashboard Only","Basic Inventory Management","Sales Tracking","Daily/Weekly Sales Summaries","Basic Profit/Loss View","Limited Email Notifications","Record Products Sold","Single User Access"]},{id:"ultra",name:"Ultra Package (Admin + Cashier)",price:2400,icon:Ve,color:"from-blue-600 to-purple-600",popular:!0,features:["Admin Dashboard + Cashier POS","Full Inventory Management","Recipe/BOM Builder","Composite Products Support","Automatic Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Advanced Analytics","Unlimited Users"]}],m=async h=>{h.preventDefault();try{await fetch(`${H}/demo-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),alert("Demo request submitted! Admin will review and contact you."),j(!1),l({name:"",email:"",company:""})}catch(w){console.error("Demo request failed:",w),alert("Failed to submit demo request. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:()=>r("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition",children:[e.jsx(ns,{size:20}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mb-8 md:mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Select the perfect plan for your business needs"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6 md:mb-8",children:x.map(h=>{const w=h.icon;return e.jsxs("div",{onClick:()=>n(h.id),className:`card cursor-pointer transition-all transform hover:scale-105 relative ${t===h.id?"ring-4 ring-blue-600 shadow-2xl bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-xl"}`,children:[h.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 md:mb-4",children:[e.jsx("div",{className:`w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br ${h.color} flex items-center justify-center`,children:e.jsx(w,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:h.name})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("span",{className:"text-3xl md:text-4xl font-bold",children:["KSH ",h.price]}),e.jsx("span",{className:"text-gray-600 text-sm md:text-base",children:"/month"})]}),e.jsx("ul",{className:"space-y-2 md:space-y-3",children:h.features.map((N,i)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Ke,{className:"w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs md:text-sm",children:N})]},i))})]},h.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center animate-fade-in",children:[e.jsx("button",{onClick:()=>{console.log("Get Started clicked with plan:",t);const h=x.find(w=>w.id===t);console.log("Selected plan:",h),localStorage.setItem("selectedPlan",JSON.stringify(h)),r("/auth/signup")},className:"btn-primary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all",children:"Get Started"}),e.jsx("button",{onClick:()=>j(!0),className:"btn-secondary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg border-2 border-gray-300 hover:border-gray-400 transition-all",children:"Request Free Demo"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-3 md:mt-4 text-center",children:"Secure payment â€¢ Cancel anytime"}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Free Demo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"We'll contact you to schedule a demo"})]}),e.jsxs("form",{onSubmit:m,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:c.name,onChange:h=>l({...c,name:h.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:c.email,onChange:h=>l({...c,email:h.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:c.company,onChange:h=>l({...c,company:h.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition",children:"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>j(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})})}function Bs(){const{user:t,logout:n}=me(),[f,j]=a.useState([]),[c,l]=a.useState([]),[r,x]=a.useState([]),[m,h]=a.useState("cash"),[w,N]=a.useState("pos"),[i,I]=a.useState({sales:[],expenses:[],stats:{}}),[u,S]=a.useState(""),[p,y]=a.useState(!1),[P,T]=a.useState(!1),[D,U]=a.useState(null),[b,C]=a.useState({name:"",price:"",cost:"",category:"finished",image:""}),[g,A]=a.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[E,O]=a.useState(!1),[_,Y]=a.useState({description:"",amount:"",category:""}),[te,fe]=a.useState(""),[ne,Ce]=a.useState([]),[B,ie]=a.useState(null),[V,z]=a.useState("exclusive"),[v,$]=a.useState(!1),[M,L]=a.useState(null),[K,X]=a.useState(null);a.useEffect(()=>{ce();const o=localStorage.getItem(`cart_${t?.id}`),s=localStorage.getItem(`paymentMethod_${t?.id}`),d=localStorage.getItem(`selectedDiscount_${t?.id}`),k=localStorage.getItem(`taxType_${t?.id}`),F=localStorage.getItem(`clockStatus_${t?.id}`),R=localStorage.getItem(`clockInTime_${t?.id}`);if(o)try{x(JSON.parse(o))}catch(W){console.warn("Failed to restore cart:",W)}if(s&&h(s),k&&z(k),d)try{ie(JSON.parse(d))}catch{}F==="clocked_in"&&($(!0),R&&X(new Date(R))),G()},[t?.id]),a.useEffect(()=>{const o=localStorage.getItem("token");o&&Ze.connect(o,d=>{if(d&&d.allProducts){const k=d.allProducts.filter(F=>F.visibleToCashier!==!1&&!F.expenseOnly);j(k)}d&&d.discounts&&Ce(d.discounts),d&&d.sale&&ce()}).catch(d=>{console.warn("WebSocket connection failed:",d)});const s=ys(d=>{try{if(!d)return;(d.type==="initial"||d.type==="products_snapshot"||d.type==="product_created"||d.type==="product_updated"||d.type==="product_deleted")&&ee.getAll().then(k=>j(k.filter(F=>F.visibleToCashier!==!1&&!F.expenseOnly))).catch(()=>{})}catch(k){console.error("Product subscription handler error",k)}});return()=>{try{s()}catch{}Ze.disconnect()}},[]),a.useEffect(()=>{(r.length>0||m||V)&&xe()},[r,m,V,B,t?.id]);const xe=()=>{localStorage.setItem(`cart_${t?.id}`,JSON.stringify(r)),localStorage.setItem(`paymentMethod_${t?.id}`,m),localStorage.setItem(`taxType_${t?.id}`,V),B&&localStorage.setItem(`selectedDiscount_${t?.id}`,JSON.stringify(B))},he=async()=>{try{const o=await fetch(`${H}/time-entries`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({action:"clock_in"})});if(o.ok){const s=await o.json();L(s),$(!0);const d=new Date;X(d),localStorage.setItem(`clockStatus_${t?.id}`,"clocked_in"),localStorage.setItem(`clockInTime_${t?.id}`,d.toISOString()),alert("Clocked in successfully!")}}catch(o){console.error("Clock in failed:",o),alert("Failed to clock in")}},et=async()=>{try{const o=await fetch(`${H}/time-entries`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({action:"clock_out"})});if(o.ok){const s=await o.json();L(s),$(!1),X(null),localStorage.removeItem(`clockStatus_${t?.id}`),localStorage.removeItem(`clockInTime_${t?.id}`);const d=Math.floor(s.duration/60),k=s.duration%60;alert(`Clocked out successfully! Total time: ${d}h ${k}m`)}}catch(o){console.error("Clock out failed:",o),alert("Failed to clock out")}},G=async()=>{try{const o=await fetch(`${H}/time-entries/today`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(o.ok){const d=(await o.json()).find(k=>k.cashierId===t?.id&&k.status==="clocked_in");d&&(L(d),$(!0),X(new Date(d.clockInTime)))}}catch(o){console.warn("Failed to check clock status:",o)}},ce=async()=>{try{const[o,s,d,k,F]=await Promise.all([ee.getAll(),Le.getAll(),Qe.getAll(),Rt.get(),Ye.getAll()]);j(o.filter(R=>R.visibleToCashier!==!1&&!R.expenseOnly)),I({sales:s,expenses:d,stats:k}),l(F);try{const R=await fetch(`${H}/discounts`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(W=>W.json());Ce(R||[])}catch(R){console.warn("Failed to load discounts:",R)}}catch(o){console.error("Failed to load data:",o)}},tt=(o,s=!0)=>{const d=o.target.files[0];if(d){const k=new FileReader;k.onload=F=>{const R=F.target.result;fe(R),s&&C({...b,image:R})},k.readAsDataURL(d)}},be=o=>c.filter(d=>d.productId===o&&d.quantity>0).reduce((d,k)=>d+k.quantity,0),st=o=>{const s=be(o.id);if(s<=0){alert("Product is out of stock!");return}const d=r.find(F=>F.id===o.id);if((d?d.quantity:0)>=s){alert(`Only ${s} units available in stock!`);return}x(d?r.map(F=>F.id===o.id?{...F,quantity:F.quantity+1}:F):[...r,{...o,quantity:1}])},Fe=(o,s)=>{f.find(k=>k.id===o);const d=be(o);x(r.map(k=>{if(k.id===o){const F=k.quantity+s;return F>d?(alert(`Only ${d} units available!`),k):{...k,quantity:Math.max(1,F)}}return k}).filter(k=>k.quantity>0))},at=o=>{x(r.filter(s=>s.id!==o))},Q=r.reduce((o,s)=>o+s.price*s.quantity,0),rt=async()=>{if(r.length!==0)try{const o=B?B.type==="percentage"?Q*B.value/100:B.value:0,s=Q*.16,d=V==="inclusive"?Q-o:Q-o+s;await Le.create({items:r.map(k=>({productId:k.id,quantity:k.quantity,price:k.price})),total:d,discount:o,tax:s,taxType:V,paymentMethod:m}),x([]),ie(null),z("exclusive"),await ce(),alert("Sale completed successfully!")}catch(o){console.error("Checkout failed:",o),alert("Sale failed. Please try again.")}},lt=async o=>{o.preventDefault();try{await ee.create({...b,price:parseFloat(b.price),cost:parseFloat(b.cost||0),quantity:0}),C({name:"",price:"",cost:"",category:"finished",image:""}),fe(""),y(!1),await ce(),alert("Product added successfully!")}catch(s){console.error("Failed to add product:",s),alert("Failed to add product")}},nt=async o=>{o.preventDefault();try{const s=Array.isArray(c)?c:[],k={id:s.length>0?Math.max(...s.map(F=>F.id||0))+1:1,productId:D.id,quantity:parseInt(g.quantity),expiryDate:g.expiryDate,batchNumber:g.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(g.cost||D.cost||0)};l(F=>[...F,k]),await Ye.create({productId:D.id,quantity:parseInt(g.quantity),expiryDate:g.expiryDate,batchNumber:g.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(g.cost||D.cost||0)}),A({quantity:"",expiryDate:"",batchNumber:"",cost:""}),T(!1),U(null),await ce(),alert("Stock added successfully!")}catch(s){console.error("Failed to add stock:",s),alert("Failed to add stock")}},it=async o=>{o.preventDefault();try{await Qe.create({..._,amount:parseFloat(_.amount)}),Y({description:"",amount:"",category:""}),O(!1),await ce()}catch(s){console.error("Failed to add expense:",s),alert("Failed to add expense")}},ct=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses? This action cannot be undone."))try{const o=localStorage.getItem("token"),d=await fetch(`${H}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!d.ok){const k=await d.json();throw new Error(k.message||"Failed to clear data")}I({sales:[],expenses:[],stats:{totalSales:0,totalExpenses:0,profit:0}}),x([]),alert("Data cleared successfully!"),await ce()}catch(o){console.error("Failed to clear data:",o),alert("Failed to clear data: "+o.message)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Cashier Dashboard"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cashier Plan - KSH 900/month"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),v&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-green-600 font-semibold",children:"ðŸŸ¢ Clocked In"}),e.jsxs("button",{onClick:et,className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-600 hover:bg-red-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(is,{className:"w-4 h-4"}),"Clock Out"]})]}),!v&&e.jsxs("button",{onClick:he,className:"px-4 py-2 rounded-lg font-medium transition-all bg-green-600 hover:bg-green-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(Lt,{className:"w-4 h-4"}),"Clock In"]}),e.jsxs("button",{onClick:()=>{xe(),n()},className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-100 hover:bg-red-200 text-red-600 border border-red-300 flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Logout"]}),e.jsxs("button",{onClick:ct,className:"px-4 py-2 rounded-lg font-medium transition-all bg-orange-100 hover:bg-orange-200 text-orange-600 border border-orange-300 flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Clear"]}),v&&K&&e.jsx("div",{className:"ml-auto text-right text-xs",children:e.jsxs("p",{className:"text-green-600 font-semibold flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"}),"Clocked In: ",K.toLocaleTimeString()]})})]})]})}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>N("pos"),className:`px-6 py-2 rounded-lg font-medium transition-all ${w==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Me,{className:"w-4 h-4 inline mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>N("monitor"),className:`px-6 py-2 rounded-lg font-medium transition-all ${w==="monitor"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ge,{className:"w-4 h-4 inline mr-2"}),"Monitor"]}),e.jsxs("button",{onClick:()=>N("products"),className:`px-6 py-2 rounded-lg font-medium transition-all ${w==="products"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ne,{className:"w-4 h-4 inline mr-2"}),"Products"]}),e.jsxs("button",{onClick:()=>N("expenses"),className:`px-6 py-2 rounded-lg font-medium transition-all ${w==="expenses"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(ze,{className:"w-4 h-4 inline mr-2"}),"Expenses"]})]}),w==="pos"&&e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(At,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:u,onChange:o=>S(o.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:f.filter(o=>o.name?.toLowerCase().includes(u.toLowerCase())).map(o=>{const s=be(o.id),d=s<10,k=s<=0;return e.jsxs("button",{onClick:()=>st(o),disabled:k,className:`card text-left hover:shadow-xl transition-all transform hover:scale-105 relative ${k?"opacity-50 cursor-not-allowed bg-gray-100":"bg-gradient-to-br from-white to-gray-50"}`,children:[o.image&&e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:o.image,alt:o.name,className:"w-full h-full object-cover"})}),d&&!k&&e.jsx("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white p-1 rounded-full",children:e.jsx(we,{className:"w-4 h-4"})}),k&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"OUT"}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-900",children:o.name}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["KSH ",o.price?.toLocaleString()]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:`text-xs font-medium ${k?"text-red-600":d?"text-yellow-600":"text-gray-500"}`,children:["Stock: ",s]}),d&&!k&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium",children:"Low Stock"})]})]},o.id)})})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-gray-200 p-6 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(Me,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[r.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:r.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(Me,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:r.map(o=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:o.name}),e.jsx("button",{onClick:()=>at(o.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(le,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Fe(o.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(cs,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-semibold",children:o.quantity}),e.jsx("button",{onClick:()=>Fe(o.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(re,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(o.price*o.quantity).toLocaleString()]})]})]},o.id))})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"text-gray-700",children:["KSH ",Q.toLocaleString()]})]}),B&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-KSH ",(B.type==="percentage"?Q*B.value/100:B.value).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-orange-600",children:[e.jsxs("span",{children:["Tax (",V==="exclusive"?"Added":"Included","):"]}),e.jsxs("span",{children:[V==="exclusive"?"+":"","KSH ",((Q-(B?B.type==="percentage"?Q*B.value/100:B.value:0))*.16).toLocaleString()]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Final Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(V==="exclusive"?Q-(B?B.type==="percentage"?Q*B.value/100:B.value:0)+(Q-(B?B.type==="percentage"?Q*B.value/100:B.value:0))*.16:Q-(B?B.type==="percentage"?Q*B.value/100:B.value:0)).toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Discount (Optional)"}),e.jsxs("select",{value:B?.id||"",onChange:o=>{o.target.value?ie(ne.find(s=>s.id===parseInt(o.target.value))):ie(null)},className:"input",children:[e.jsx("option",{value:"",children:"No Discount"}),ne.filter(o=>o.active).map(o=>e.jsxs("option",{value:o.id,children:[o.name," - ",o.type==="percentage"?`${o.value}%`:`KSH ${o.value}`]},o.id))]}),B&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Discount: KSH ",(B.type==="percentage"?Q*B.value/100:B.value).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tax Type"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"exclusive",checked:V==="exclusive",onChange:o=>z(o.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Exclusive (16% added)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"inclusive",checked:V==="inclusive",onChange:o=>z(o.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Inclusive"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:m,onChange:o=>h(o.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:rt,disabled:r.length===0,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg",children:"Complete Sale"})]})]})]}),w==="monitor"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",i.stats.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(oe,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",i.stats.totalExpenses?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(ze,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",i.stats.profit?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(oe,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Sales"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"})]})}),e.jsx("tbody",{children:i.sales.slice(-15).reverse().map((o,s)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(o.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[o.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:o.paymentMethod||"cash"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",o.total?.toLocaleString()]})]},s))})]})})]})]}),w==="products"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Manage Products & Stock"}),e.jsxs("button",{onClick:()=>y(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700",children:[e.jsx(re,{className:"w-4 h-4"}),"Add Product"]})]}),p&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl border-2 border-green-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Product"}),e.jsxs("form",{onSubmit:lt,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:b.name,onChange:o=>C({...b,name:o.target.value}),required:!0}),e.jsxs("select",{className:"input",value:b.category,onChange:o=>C({...b,category:o.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsx("input",{type:"number",placeholder:"Selling Price",className:"input",value:b.price,onChange:o=>C({...b,price:o.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Cost Price (Optional)",className:"input",value:b.cost,onChange:o=>C({...b,cost:o.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:o=>tt(o,!0),className:"input"}),e.jsx(Tt,{className:"w-5 h-5 text-gray-400"})]}),te&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:te,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{y(!1),fe(""),C({name:"",price:"",cost:"",category:"finished",image:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),P&&D&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"font-semibold mb-4 text-lg",children:["Add Stock for ",D.name]}),e.jsxs("form",{onSubmit:nt,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:g.quantity,onChange:o=>A({...g,quantity:o.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:g.expiryDate,onChange:o=>A({...g,expiryDate:o.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:g.batchNumber,onChange:o=>A({...g,batchNumber:o.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per Unit",className:"input",value:g.cost,onChange:o=>A({...g,cost:o.target.value})}),e.jsxs("div",{className:"flex gap-2 md:col-span-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{T(!1),U(null),A({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:f.map(o=>{const s=be(o.id),d=c.filter(F=>F.productId===o.id&&F.quantity>0),k=s<10;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[o.image&&e.jsx("img",{src:o.image,alt:o.name,className:"w-10 h-10 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:o.name}),e.jsx("div",{className:"text-xs text-gray-500",children:o.category})]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",o.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium ${s===0?"text-red-600":k?"text-yellow-600":"text-gray-900"}`,children:s}),k&&s>0&&e.jsx(we,{className:"w-4 h-4 text-yellow-500"}),s===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"text-gray-600",children:[d.length," active"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{U(o),T(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-green-50 rounded-lg text-green-600 transition-colors",title:"Edit Product",children:e.jsx(ve,{className:"w-4 h-4"})})]})})]},o.id)})})]})})]})}),w==="expenses"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Track Expenses"}),e.jsxs("button",{onClick:()=>O(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700",children:[e.jsx(re,{className:"w-4 h-4"}),"Add Expense"]})]}),E&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border-2 border-red-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Expense"}),e.jsxs("form",{onSubmit:it,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:_.description,onChange:o=>Y({..._,description:o.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Amount",className:"input",value:_.amount,onChange:o=>Y({..._,amount:o.target.value}),required:!0}),e.jsx("input",{type:"text",placeholder:"Category",className:"input",value:_.category,onChange:o=>Y({..._,category:o.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>O(!1),className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:i.expenses.slice().reverse().map((o,s)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(o.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:o.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:o.category||"General"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",o.amount?.toLocaleString()]})]},s))})]})})]})})]})}function _s(){const[t,n]=a.useState({email:"",password:""}),[f,j]=a.useState(!1),[c,l]=a.useState(""),[r,x]=a.useState(!1),m=ue(),h=a.useRef(!1);a.useEffect(()=>{if(h.current)return;h.current=!0;const N=localStorage.getItem("ownerToken"),i=localStorage.getItem("ownerUser");if(N&&i)try{JSON.parse(i).role==="owner"&&m("/main.admin/dashboard",{replace:!0})}catch{localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser")}},[m]);const w=async N=>{N.preventDefault(),j(!0),l("");try{const i=await De.login(t);if(i.token&&i.user&&i.user.role==="owner")localStorage.setItem("ownerToken",i.token),localStorage.setItem("ownerUser",JSON.stringify(i.user)),m("/main.admin/dashboard",{replace:!0});else throw new Error("Invalid response from server or insufficient permissions")}catch(i){l(i.message||"Access denied. Owner access only.")}finally{j(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-black/50 backdrop-blur-lg rounded-2xl shadow-2xl max-w-md w-full p-8 border border-red-500/30",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-600 to-red-800 rounded-3xl mx-auto mb-4 flex items-center justify-center border-2 border-red-400 shadow-lg",children:e.jsx("div",{className:"text-3xl font-bold text-white",children:"MTC"})}),e.jsx("h1",{className:"text-3xl font-bold text-red-400 mb-2",children:"MAIN.ADMIN"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Mabrixel Trading Co. - System Owner Access"}),e.jsx("div",{className:"mt-3 text-xs text-red-500 bg-red-500/10 px-3 py-2 rounded border border-red-500/30",children:"ðŸ”’ ianmabruk3@gmail.com only"})]}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),e.jsx("input",{type:"email",placeholder:"Owner Email",className:"w-full pl-10 pr-4 py-3 bg-black/30 border border-red-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",value:t.email,onChange:N=>n({...t,email:N.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),e.jsx("input",{type:r?"text":"password",placeholder:"Owner Password",className:"w-full pl-10 pr-12 py-3 bg-black/30 border border-red-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",value:t.password,onChange:N=>n({...t,password:N.target.value}),required:!0}),e.jsx("button",{type:"button",onClick:()=>x(!r),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-400",children:r?e.jsx(Et,{className:"w-5 h-5"}):e.jsx(xt,{className:"w-5 h-5"})})]}),c&&e.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm bg-red-500/10 p-3 rounded-lg border border-red-500/30",children:[e.jsx(_e,{className:"w-4 h-4"}),c]}),e.jsx("button",{type:"submit",disabled:f,className:"w-full bg-gradient-to-r from-red-600 to-red-800 text-white py-3 rounded-lg font-bold hover:from-red-700 hover:to-red-900 transition-all disabled:opacity-50 disabled:cursor-not-allowed border border-red-500/50",children:f?"Authenticating...":"ACCESS SYSTEM"})]}),e.jsx("div",{className:"mt-8 p-4 bg-red-500/10 border border-red-500/30 rounded-lg",children:e.jsx("p",{className:"text-red-300 text-xs text-center",children:"âš ï¸ Restricted to system owner only"})})]})})}function zs(){const[t,n]=a.useState([]),[f,j]=a.useState({}),[c,l]=a.useState(!0),[r,x]=a.useState(null),[m,h]=a.useState("all"),[w,N]=a.useState(null),i=ue();a.useEffect(()=>{const C=localStorage.getItem("ownerToken"),g=localStorage.getItem("ownerUser");if(!C||!g){i("/main.admin",{replace:!0});return}try{const E=JSON.parse(g);if(E.role!=="owner"&&!E.isMainAdmin||E.email!=="ianmabruk3@gmail.com"){i("/main.admin",{replace:!0});return}}catch{i("/main.admin",{replace:!0});return}I();const A=setInterval(I,3e4);return()=>clearInterval(A)},[]);const I=async()=>{try{l(!0);const[C,g]=await Promise.all([De.getUsers(),De.getStats()]);n(C||[]),j(g||{})}catch(C){console.error("Failed to load data:",C)}finally{l(!1)}},u=async(C,g)=>{try{x(`lock-${C}`),await De.lockUser(C,!g),await I()}catch{alert("Failed to update user status")}finally{x(null)}},S=()=>({freeDemo:t.filter(g=>g.planType==="free_demo"||!g.planType).length,trial:t.filter(g=>g.planType==="trial"||g.requestedTrial).length,paid:t.filter(g=>g.planType==="paid").length}),p=()=>m==="all"?t:m==="free_demo"?t.filter(C=>C.planType==="free_demo"||!C.planType):m==="trial"?t.filter(C=>C.planType==="trial"||C.requestedTrial):m==="paid"?t.filter(C=>C.planType==="paid"):t,y=C=>{if(!C)return"N/A";try{return new Date(C).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return"N/A"}},P=()=>{localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser"),i("/main.admin")};if(c)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-red-600 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-white text-lg",children:"Loading system data..."})]})});const T=S(),D=p(),U=t.filter(C=>C.active&&!C.locked).length,b=t.filter(C=>C.locked).length;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black text-white",children:[e.jsx("div",{className:"border-b border-red-500/30 bg-black/50 backdrop-blur-lg sticky top-0 z-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-600 to-red-800 rounded-2xl flex items-center justify-center border-2 border-red-400",children:e.jsx(Ve,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-red-400",children:"ðŸŽ¯ MTC System Owner"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Comprehensive Analytics & Control Dashboard"})]})]}),e.jsxs("button",{onClick:P,className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-medium transition-colors",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Logout"]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-blue-800 rounded-xl p-6 border border-blue-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ke,{className:"w-8 h-8 text-blue-200"}),e.jsx("span",{className:"text-3xl font-bold",children:t.length})]}),e.jsx("p",{className:"text-blue-100 text-sm font-medium",children:"Total Users"}),e.jsx("p",{className:"text-blue-300 text-xs mt-2",children:"All registered"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-600 to-green-800 rounded-xl p-6 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Se,{className:"w-8 h-8 text-green-200"}),e.jsx("span",{className:"text-3xl font-bold",children:U})]}),e.jsx("p",{className:"text-green-100 text-sm font-medium",children:"Active Users"}),e.jsx("p",{className:"text-green-300 text-xs mt-2",children:"Currently active"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-yellow-600 to-yellow-800 rounded-xl p-6 border border-yellow-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(de,{className:"w-8 h-8 text-yellow-200"}),e.jsx("span",{className:"text-3xl font-bold",children:T.trial})]}),e.jsx("p",{className:"text-yellow-100 text-sm font-medium",children:"Trial/Demo"}),e.jsx("p",{className:"text-yellow-300 text-xs mt-2",children:"Free & trial users"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-600 to-purple-800 rounded-xl p-6 border border-purple-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(oe,{className:"w-8 h-8 text-purple-200"}),e.jsx("span",{className:"text-3xl font-bold",children:T.paid})]}),e.jsx("p",{className:"text-purple-100 text-sm font-medium",children:"Paid Users"}),e.jsx("p",{className:"text-purple-300 text-xs mt-2",children:"Active subscriptions"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-600 to-red-800 rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ae,{className:"w-8 h-8 text-red-200"}),e.jsx("span",{className:"text-3xl font-bold",children:b})]}),e.jsx("p",{className:"text-red-100 text-sm font-medium",children:"Locked Users"}),e.jsx("p",{className:"text-red-300 text-xs mt-2",children:"Access restricted"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-black/50 border border-red-500/30 rounded-xl p-6 backdrop-blur-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-red-400",children:"ðŸ†“ Free Demo Users"}),e.jsx($e,{className:"w-6 h-6 text-red-400"})]}),e.jsx("p",{className:"text-4xl font-bold text-white mb-2",children:T.freeDemo}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Users on free demo"}),e.jsx("div",{className:"mt-4 w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-red-500 h-2 rounded-full transition-all",style:{width:`${t.length>0?T.freeDemo/t.length*100:0}%`}})}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:[t.length>0?Math.round(T.freeDemo/t.length*100):0,"% of users"]})]}),e.jsxs("div",{className:"bg-black/50 border border-yellow-500/30 rounded-xl p-6 backdrop-blur-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-yellow-400",children:"â±ï¸ Trial Users"}),e.jsx(de,{className:"w-6 h-6 text-yellow-400"})]}),e.jsx("p",{className:"text-4xl font-bold text-white mb-2",children:T.trial}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Requested/active trials"}),e.jsx("div",{className:"mt-4 w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-500 h-2 rounded-full transition-all",style:{width:`${t.length>0?T.trial/t.length*100:0}%`}})}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:[t.length>0?Math.round(T.trial/t.length*100):0,"% of users"]})]}),e.jsxs("div",{className:"bg-black/50 border border-green-500/30 rounded-xl p-6 backdrop-blur-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-green-400",children:"ðŸ’° Paid Users"}),e.jsx(oe,{className:"w-6 h-6 text-green-400"})]}),e.jsx("p",{className:"text-4xl font-bold text-white mb-2",children:T.paid}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Paid subscription users"}),e.jsx("div",{className:"mt-4 w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all",style:{width:`${t.length>0?T.paid/t.length*100:0}%`}})}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:[t.length>0?Math.round(T.paid/t.length*100):0,"% of users"]})]})]}),e.jsxs("div",{className:"bg-black/50 border border-red-500/30 rounded-xl p-6 backdrop-blur-lg mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"ðŸ“Š User Analytics & Management"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:m,onChange:C=>h(C.target.value),className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:border-red-500",children:[e.jsxs("option",{value:"all",children:["All Users (",t.length,")"]}),e.jsxs("option",{value:"free_demo",children:["Free Demo (",T.freeDemo,")"]}),e.jsxs("option",{value:"trial",children:["Trial Users (",T.trial,")"]}),e.jsxs("option",{value:"paid",children:["Paid Users (",T.paid,")"]})]}),e.jsx("button",{onClick:I,className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",title:"Refresh data",children:e.jsx(It,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-800/50 border-b border-gray-700",children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"User Info"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Plan Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Service Start"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Days Used"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Trial Request"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Actions"})]})}),e.jsx("tbody",{children:D.length>0?D.map(C=>{const g=C.planType||"free_demo",A=C.daysUsed||0;return e.jsxs("tr",{className:"border-b border-gray-700 hover:bg-gray-800/30 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[C.email==="ianmabruk3@gmail.com"&&e.jsx(Ve,{className:"w-4 h-4 text-yellow-500",title:"Main Admin"}),e.jsx("span",{className:"font-medium text-white",children:C.name})]}),e.jsx("p",{className:"text-gray-400 text-xs",children:C.email})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${g==="paid"?"bg-green-900 text-green-200":g==="trial"?"bg-yellow-900 text-yellow-200":"bg-gray-700 text-gray-200"}`,children:g==="free_demo"?"ðŸ†“ Free Demo":g==="trial"?"â±ï¸ Trial":"ðŸ’° Paid"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-300",children:y(C.serviceStartDate)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"font-bold text-blue-400",children:[A," days"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:C.requestedTrial?e.jsxs("span",{className:"px-2 py-1 bg-yellow-900/30 text-yellow-300 text-xs rounded flex items-center gap-1 w-fit",children:[e.jsx(we,{className:"w-3 h-3"})," Requested"]}):e.jsx("span",{className:"text-gray-500 text-xs",children:"â€”"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:C.active&&!C.locked?e.jsxs("span",{className:"flex items-center gap-1 text-green-400 font-medium text-xs",children:[e.jsx(Se,{className:"w-4 h-4"})," Active"]}):C.locked?e.jsxs("span",{className:"flex items-center gap-1 text-red-400 font-medium text-xs",children:[e.jsx(ae,{className:"w-4 h-4"})," Locked"]}):e.jsxs("span",{className:"flex items-center gap-1 text-gray-400 font-medium text-xs",children:[e.jsx(We,{className:"w-4 h-4"})," Inactive"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>u(C.id,C.locked),disabled:r===`lock-${C.id}`||C.email==="ianmabruk3@gmail.com",className:`px-3 py-1 rounded text-xs font-medium transition-colors ${C.locked?"bg-green-600 hover:bg-green-700 disabled:bg-gray-500 text-white":"bg-red-600 hover:bg-red-700 disabled:bg-gray-500 text-white"}`,children:r===`lock-${C.id}`?"Processing...":C.locked?"Unlock":"Lock"})})]},C.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-400",children:"No users found in this category"})})})]})}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-700 text-sm text-gray-400 flex justify-between",children:[e.jsxs("p",{children:["Showing ",D.length," of ",t.length," users"]}),e.jsxs("p",{children:["Last updated: ",new Date().toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-black/50 border border-blue-500/30 rounded-xl p-6 backdrop-blur-lg",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-4 flex items-center gap-2",children:[e.jsx(Ge,{className:"w-5 h-5"})," System Overview"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"Total Sales"}),e.jsxs("span",{className:"font-bold text-white",children:["KSH ",(f.totalSales||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"Total Expenses"}),e.jsxs("span",{className:"font-bold text-white",children:["KSH ",(f.totalExpenses||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"Profit"}),e.jsxs("span",{className:"font-bold text-green-400",children:["KSH ",(f.profit||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Products"}),e.jsx("span",{className:"font-bold text-white",children:f.productsCount||0})]})]})]}),e.jsxs("div",{className:"bg-black/50 border border-purple-500/30 rounded-xl p-6 backdrop-blur-lg",children:[e.jsxs("h3",{className:"text-lg font-bold text-purple-400 mb-4 flex items-center gap-2",children:[e.jsx(os,{className:"w-5 h-5"})," Quick Stats"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"Sales Records"}),e.jsx("span",{className:"font-bold text-white",children:f.salesCount||0})]}),e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"Expense Records"}),e.jsx("span",{className:"font-bold text-white",children:f.expensesCount||0})]}),e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"Active Accounts"}),e.jsx("span",{className:"font-bold text-green-400",children:U})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Locked Accounts"}),e.jsx("span",{className:"font-bold text-red-400",children:b})]})]})]})]}),e.jsxs("div",{className:"mt-8 bg-black/50 border border-gray-700 rounded-xl p-6 backdrop-blur-lg",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-300 mb-4",children:"ðŸ“‹ User Plan Types & Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-800/30 rounded-lg border border-gray-700",children:[e.jsx($e,{className:"w-5 h-5 text-red-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-300",children:"ðŸ†“ Free Demo"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"New users getting initial access to test the system"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-800/30 rounded-lg border border-gray-700",children:[e.jsx(de,{className:"w-5 h-5 text-yellow-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-300",children:"â±ï¸ Trial Users"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Users who requested trial period or using extended trial"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-800/30 rounded-lg border border-gray-700",children:[e.jsx(oe,{className:"w-5 h-5 text-green-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-300",children:"ðŸ’° Paid Users"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Users with active paid subscriptions"})]})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:e.jsxs("p",{className:"text-blue-300 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"ðŸ“Š Days Used:"})," Calculated from service start date to today"]})})]})]})]})}function Hs(){const[t,n]=a.useState([]),[f,j]=a.useState("all"),[c,l]=a.useState(""),[r,x]=a.useState(!0),[m,h]=a.useState(null),w=ue(),[N,i]=a.useState({totalUsers:0,activeUsers:0,freeTrialUsers:0,upgradeExpiredUsers:0,reaching30Days:0,totalRevenue:0});a.useEffect(()=>{const b=localStorage.getItem("ownerToken"),C=localStorage.getItem("ownerUser");if(!b||!C){w("/main.admin");return}I().finally(()=>x(!1))},[w]);const I=async()=>{try{let b=[];try{const C=localStorage.getItem("ownerToken"),g=await fetch(`${H}/api/main-admin/users-with-subscriptions`,{headers:{Authorization:`Bearer ${C}`}});if(g.ok)b=await g.json();else throw new Error("Failed to fetch subscription data")}catch(C){console.warn("Subscription API failed, using fallback:",C.message);try{b=await De.getUsers()}catch{b=await ge.getAll()}b=b.map(g=>{const A=new Date(g.createdAt||Date.now()),O=Math.floor((new Date-A)/(1e3*60*60*24)),_=g.plan==="free"||!g.plan,Y=O>=30&&_,te=Math.max(0,30-O);return{...g,createdAt:A.toISOString(),daysActive:O,isFreeTrial:_,hasReachedTrialLimit:Y,daysUntilExpiry:te,subscriptionStatus:_?Y?"trial_expired":"free_trial":"paid",planPrice:g.plan==="ultra"?1600:g.plan==="basic"?900:0,trialExpireDate:new Date(A.getTime()+720*60*60*1e3).toISOString()}})}if(b.length>0&&b[0].daysActive!==void 0)n(b),u(b);else{const C=b.map(g=>{const A=new Date(g.createdAt||Date.now()),O=Math.floor((new Date-A)/(1e3*60*60*24)),_=g.plan==="free"||!g.plan,Y=O>=30&&_,te=Math.max(0,30-O);return{...g,createdAt:A.toISOString(),daysActive:O,isFreeTrial:_,hasReachedTrialLimit:Y,daysUntilExpiry:te,subscriptionStatus:_?Y?"trial_expired":"free_trial":"paid",planPrice:g.plan==="ultra"?1600:g.plan==="basic"?900:0,trialExpireDate:new Date(A.getTime()+2592e6).toISOString()}});n(C),u(C)}}catch(b){console.error("Failed to load data:",b)}},u=b=>{const C=b.filter(O=>O.isFreeTrial).length,g=b.filter(O=>O.hasReachedTrialLimit).length,A=b.filter(O=>O.daysActive>=25&&O.daysActive<30&&O.isFreeTrial).length,E=b.filter(O=>!O.isFreeTrial&&!O.hasReachedTrialLimit).reduce((O,_)=>O+(_.planPrice||0),0);i({totalUsers:b.length,activeUsers:b.filter(O=>O.active!==!1).length,freeTrialUsers:C,upgradeExpiredUsers:g,reaching30Days:A,totalRevenue:E})},S=b=>b.hasReachedTrialLimit?"bg-red-100 border-red-300":b.daysUntilExpiry<=5&&b.isFreeTrial?"bg-yellow-100 border-yellow-300":b.isFreeTrial?"bg-blue-100 border-blue-300":"bg-green-100 border-green-300",p=b=>b.hasReachedTrialLimit?e.jsx("span",{className:"text-xs bg-red-600 text-white px-2 py-1 rounded-full",children:"Trial Expired"}):b.isFreeTrial?e.jsxs("span",{className:"text-xs bg-blue-600 text-white px-2 py-1 rounded-full",children:["Free Trial - ",b.daysUntilExpiry,"d left"]}):e.jsx("span",{className:"text-xs bg-green-600 text-white px-2 py-1 rounded-full",children:"Active"}),y=async b=>{const C=t.find(g=>g.id===b);if(C)try{const g=localStorage.getItem("ownerToken");if((await fetch(`${H}/api/main-admin/send-email`,{method:"POST",headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"},body:JSON.stringify({userId:b,type:"upgrade"})})).ok)alert(`Upgrade reminder sent to ${C.email}`);else throw new Error("Failed to send email")}catch(g){console.error("Failed to send email:",g),alert("Failed to send email")}},P=async(b,C)=>{try{h(b);const g=localStorage.getItem("ownerToken");if((await fetch(`${H}/api/main-admin/users/${b}/lock`,{method:"POST",headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"},body:JSON.stringify({locked:!C})})).ok)n(O=>O.map(_=>_.id===b?{..._,locked:!C,active:C}:_)),alert(`User ${C?"unlocked":"locked"} successfully`);else throw new Error("Failed to update user lock status")}catch(g){console.error("Failed to update user lock status:",g),alert("Failed to update user")}finally{h(null)}},T=async b=>{const C=t.find(g=>g.id===b);if(C)try{const g=localStorage.getItem("ownerToken");if((await fetch(`${H}/api/main-admin/send-email`,{method:"POST",headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"},body:JSON.stringify({userId:b,type:"upgrade"})})).ok)alert(`Redirect email sent to ${C.email}`);else throw new Error("Failed to send email")}catch(g){console.error("Failed to send redirect email:",g),alert("Failed to send email")}},D=t.filter(b=>{const C=b.name?.toLowerCase().includes(c.toLowerCase())||b.email?.toLowerCase().includes(c.toLowerCase()),g=f==="all"||f==="free_trial"&&b.isFreeTrial&&!b.hasReachedTrialLimit||f==="trial_expired"&&b.hasReachedTrialLimit||f==="paid"&&!b.isFreeTrial||f==="expiring_soon"&&b.daysUntilExpiry<=5&&b.isFreeTrial;return C&&g}),U=()=>{localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser"),w("/main.admin")};return r?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading admin dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Admin Dashboard"}),e.jsx("p",{className:"text-blue-100 mt-1",children:"User Management & Subscription Tracking"})]}),e.jsxs("button",{onClick:U,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Logout"]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:N.totalUsers})]}),e.jsx(ke,{className:"w-8 h-8 text-blue-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Free Trial"}),e.jsx("p",{className:"text-3xl font-bold text-blue-400",children:N.freeTrialUsers})]}),e.jsx(de,{className:"w-8 h-8 text-blue-400 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Expiring Soon"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:N.reaching30Days})]}),e.jsx(we,{className:"w-8 h-8 text-yellow-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Expired"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:N.upgradeExpiredUsers})]}),e.jsx(We,{className:"w-8 h-8 text-red-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Active"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:N.activeUsers})]}),e.jsx(Se,{className:"w-8 h-8 text-green-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Monthly Revenue"}),e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:["$",(N.totalRevenue/1e3).toFixed(1),"K"]})]}),e.jsx(oe,{className:"w-8 h-8 text-green-600 opacity-20"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"border-b p-6 flex gap-4 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx("input",{type:"text",placeholder:"Search users by name or email...",value:c,onChange:b=>l(b.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})}),e.jsxs("select",{value:f,onChange:b=>j(b.target.value),className:"px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"free_trial",children:"Free Trial"}),e.jsx("option",{value:"expiring_soon",children:"Expiring Soon"}),e.jsx("option",{value:"trial_expired",children:"Trial Expired"}),e.jsx("option",{value:"paid",children:"Paid Users"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Days Active"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Trial Expires"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:D.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-8 text-center text-gray-500",children:"No users found matching your criteria"})}):D.map(b=>e.jsxs("tr",{className:`border-b hover:bg-gray-50 transition ${S(b)}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:b.name}),e.jsx("p",{className:"text-xs text-gray-500",children:b.email})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-3 py-1 bg-gray-200 text-gray-800 rounded-full text-xs font-semibold",children:b.plan||"free"})}),e.jsx("td",{className:"px-6 py-4",children:p(b)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`font-semibold ${b.daysActive>=25?"text-red-600":"text-gray-900"}`,children:[b.daysActive," days"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-xs text-gray-600",children:new Date(b.trialExpireDate).toLocaleDateString()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[b.hasReachedTrialLimit&&e.jsxs("button",{onClick:()=>T(b.id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs font-semibold transition flex items-center gap-1",title:"Send upgrade prompt",children:[e.jsx($e,{className:"w-3 h-3"}),"Upgrade"]}),b.daysUntilExpiry<=5&&b.isFreeTrial&&!b.hasReachedTrialLimit&&e.jsxs("button",{onClick:()=>y(b.id),className:"bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-xs font-semibold transition flex items-center gap-1",title:"Send trial expiry reminder",children:[e.jsx(ds,{className:"w-3 h-3"}),"Remind"]}),e.jsx("button",{onClick:()=>P(b.id,b.locked),disabled:m===b.id,className:`${b.locked?"bg-green-600 hover:bg-green-700":"bg-orange-600 hover:bg-orange-700"} text-white px-3 py-1 rounded text-xs font-semibold transition disabled:opacity-50 flex items-center gap-1`,children:b.locked?e.jsxs(e.Fragment,{children:[e.jsx(ms,{className:"w-3 h-3"}),"Unlock"]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-3 h-3"}),"Lock"]})})]})})]},b.id))})]})})]})]})]})}function Ae({children:t,adminOnly:n=!1,ultraOnly:f=!1,ownerOnly:j=!1}){const{user:c,loading:l}=me(),[r,x]=a.useState(!1),m=zt(6e4),h=m?.[0]||!1,w=m?.[1]||(()=>{}),[N,i]=a.useState({});if(a.useEffect(()=>{c&&!j&&((async()=>{try{const S=localStorage.getItem("token"),y=await fetch(`${H}/settings`,{headers:{Authorization:`Bearer ${S}`}});if(y.ok){const P=await y.json();i(P)}}catch(S){console.error("Failed to load settings:",S)}})(),x(!0))},[c,j]),l&&!j)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(j){const u=localStorage.getItem("ownerToken"),S=localStorage.getItem("ownerUser");if(!u||!S)return e.jsx(Z,{to:"/main.admin"});try{if(JSON.parse(S).type!=="main_admin")return e.jsx(Z,{to:"/main.admin"})}catch{return e.jsx(Z,{to:"/main.admin"})}}else{if(!c)return e.jsx(Z,{to:"/auth/login"});if(!c.active)return e.jsx(Z,{to:"/plans"});if(n&&c.role!=="admin")return e.jsx(Z,{to:"/dashboard"});if(f&&(c.role!=="admin"||c.plan!=="ultra"))return e.jsx(Z,{to:"/dashboard"})}const I=j?"owner":"user";return e.jsxs(e.Fragment,{children:[h&&e.jsx(_t,{onUnlock:w,userType:I}),r&&e.jsx(Bt,{onClose:()=>x(!1)}),t]})}function Js(){const{user:t}=me();return!t||!t.active?e.jsx(Z,{to:"/plans"}):t.role==="admin"?e.jsx(Z,{to:"/admin"}):e.jsx(Z,{to:"/dashboard/cashier"})}function Ks(){return e.jsx(Ns,{children:e.jsx(vs,{children:e.jsx(Gt,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(Ct,{children:[e.jsx(J,{path:"/",element:e.jsx(qs,{})}),e.jsx(J,{path:"/auth/login",element:e.jsx(St,{})}),e.jsx(J,{path:"/auth/signup",element:e.jsx(St,{})}),e.jsx(J,{path:"/plans",element:e.jsx(Ms,{})}),e.jsx(J,{path:"/main.admin",element:e.jsx(_s,{})}),e.jsx(J,{path:"/main.admin/dashboard",element:e.jsx(Ae,{ownerOnly:!0,children:e.jsx(Hs,{})})}),e.jsx(J,{path:"/main.admin/dashboard-legacy",element:e.jsx(Ae,{ownerOnly:!0,children:e.jsx(zs,{})})}),e.jsx(J,{path:"/dashboard",element:e.jsx(Ae,{children:e.jsx(Js,{})})}),e.jsx(J,{path:"/dashboard/cashier",element:e.jsx(Ae,{children:e.jsx(Bs,{})})}),e.jsx(J,{path:"/admin/*",element:e.jsx(Ae,{adminOnly:!0,children:e.jsx(Rs,{})})}),e.jsx(J,{path:"/login",element:e.jsx(Z,{to:"/auth/login"})}),e.jsx(J,{path:"/signup",element:e.jsx(Z,{to:"/auth/signup"})}),e.jsx(J,{path:"/subscription",element:e.jsx(Z,{to:"/plans"})}),e.jsx(J,{path:"/payment",element:e.jsx(Z,{to:"/plans"})}),e.jsx(J,{path:"/cashier",element:e.jsx(Z,{to:"/dashboard/cashier"})})]})})})})}gs.createRoot(document.getElementById("root")).render(e.jsx(Vt.StrictMode,{children:e.jsx(Ks,{})}));
