import{a as Yt,b as Qt,g as Xt,r as s,u as Ue,c as It,R as Et,d as le,B as Zt,N as ge,e as es}from"./vendor-Ct1st1Nj.js";import{L as we,M as et,P as ts,C as ut,D as Te,T as Re,a as _e,S as Lt,b as tt,c as gt,d as ye,e as ss,f as as,g as $e,h as Ie,i as Pe,j as Tt,k as rs,l as $t,m as yt,U as Nt,n as vt,o as Be,E as Me,p as wt,q as Oe,X as Je,r as He,s as Xe,t as ft,u as st,v as St,w as at,B as bt,R as ls,I as ns,x as rt,y as kt,z as Ot,A as ht,F as Le,G as lt,H as Ut,J as is,K as cs,N as Ft,O as os,Q as ds,V as ms,W as jt,Y as xs,Z as We,_ as Rt,$ as pt,a0 as Mt,a1 as qt,a2 as us,a3 as hs,a4 as ps,a5 as gs}from"./icons-COEhrEF5.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))g(c);new MutationObserver(c=>{for(const i of c)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&g(n)}).observe(document,{childList:!0,subtree:!0});function p(c){const i={};return c.integrity&&(i.integrity=c.integrity),c.referrerPolicy&&(i.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?i.credentials="include":c.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function g(c){if(c.ep)return;c.ep=!0;const i=p(c);fetch(c.href,i)}})();var dt={exports:{}},Fe={};var Ct;function fs(){if(Ct)return Fe;Ct=1;var t=Yt(),o=Symbol.for("react.element"),p=Symbol.for("react.fragment"),g=Object.prototype.hasOwnProperty,c=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function n(a,x,m){var h,D={},r=null,P=null;m!==void 0&&(r=""+m),x.key!==void 0&&(r=""+x.key),x.ref!==void 0&&(P=x.ref);for(h in x)g.call(x,h)&&!i.hasOwnProperty(h)&&(D[h]=x[h]);if(a&&a.defaultProps)for(h in x=a.defaultProps,x)D[h]===void 0&&(D[h]=x[h]);return{$$typeof:o,type:a,key:r,ref:P,props:D,_owner:c.current}}return Fe.Fragment=p,Fe.jsx=n,Fe.jsxs=n,Fe}var Pt;function bs(){return Pt||(Pt=1,dt.exports=fs()),dt.exports}var e=bs(),Ge={},At;function js(){if(At)return Ge;At=1;var t=Qt();return Ge.createRoot=t.createRoot,Ge.hydrateRoot=t.hydrateRoot,Ge}var ys=js();const Ns=Xt(ys),vs=()=>"https://posifine22.onrender.com/api",ue=vs(),_t=()=>localStorage.getItem("token"),Bt=async(t,o={},p=0,g=3)=>{const c=_t(),i=t.startsWith("/")?t:`/${t}`,n={...o,headers:{"Content-Type":"application/json",...c&&!(i.startsWith("/auth")&&i!=="/auth/me")&&!i.includes("/main-admin/auth/login")&&{Authorization:`Bearer ${c}`},...o.headers}};try{const a=await fetch(`${ue}${i}`,n);if(a.status===401){localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser");const m=window.location.pathname||"";if(!m.includes("/login")&&!m.includes("/signup")&&!m.includes("/auth")&&!m.includes("/main.admin"))try{window.location.href="/login"}catch{}const h=new Error("Unauthorized");throw h.status=401,h}if(a.status===500)throw new Error("Server error 500 - Backend unavailable");if(a.ok)return a.status===204?{success:!0}:await a.json();const x=await a.json().catch(()=>({error:"Network error"}));throw new Error(x.error||`HTTP ${a.status}: ${a.statusText}`)}catch(a){if(a.name==="TypeError"&&a.message.includes("fetch")){if(console.error(`API Fetch Error (attempt ${p+1}/${g+1}):`,a),console.error("Attempted URL:",`${ue}${i}`),p<g){const x=Math.min(1e3*Math.pow(2,p),1e4);return console.log(`Retrying in ${x}ms...`),await new Promise(m=>setTimeout(m,x)),Bt(t,o,p+1,g)}throw new Error("Cannot connect to server. The server may be waking up. Please try again in a moment.")}throw a}},V=(t,o={})=>Bt(t,o,0,3),Ee={login:t=>V("/auth/login",{method:"POST",body:JSON.stringify(t)}),pinLogin:t=>V("/auth/pin-login",{method:"POST",body:JSON.stringify(t)}),signup:t=>V("/auth/signup",{method:"POST",body:JSON.stringify(t)}),signupWithPayment:t=>V("/signup-with-payment",{method:"POST",body:JSON.stringify(t)}),me:()=>V("/auth/me")},De={getAll:()=>V("/users"),create:t=>V("/users",{method:"POST",body:JSON.stringify(t)}),update:(t,o)=>V(`/users/${t}`,{method:"PUT",body:JSON.stringify(o)}),delete:t=>V(`/users/${t}`,{method:"DELETE"}),setPin:(t,o)=>V(`/users/${t}/set-pin`,{method:"POST",body:JSON.stringify({pin:o})}),lock:(t,o)=>V(`/users/${t}/lock`,{method:"POST",body:JSON.stringify({locked:o})})},be={getAll:()=>V("/products"),create:t=>V("/products",{method:"POST",body:JSON.stringify(t)}),update:(t,o)=>V(`/products/${t}`,{method:"PUT",body:JSON.stringify(o)}),delete:t=>V(`/products/${t}`,{method:"DELETE"}),updateStock:(t,o)=>V(`/products/${t}/stock`,{method:"PUT",body:JSON.stringify(o)}),getMaxProducible:t=>V(`/products/${t}/max-producible`)},ze={getAll:async()=>[{id:1,total:450,items:[{name:"Coffee",quantity:2}],createdAt:new Date().toISOString()}],create:async t=>({id:Date.now(),...t,createdAt:new Date().toISOString()})},nt={getAll:async()=>[{id:1,description:"Office supplies",amount:150,createdAt:new Date().toISOString()}],create:async t=>({id:Date.now(),...t,createdAt:new Date().toISOString()})},Jt={get:async()=>({totalExpenses:300,profit:1200,productCount:5})},Ye={getAll:()=>V("/discounts"),create:t=>V("/discounts",{method:"POST",body:JSON.stringify(t)}),update:(t,o)=>V(`/discounts/${t}`,{method:"PUT",body:JSON.stringify(o)}),delete:t=>V(`/discounts/${t}`,{method:"DELETE"})},mt={getAll:()=>V("/credit-requests"),create:t=>V("/credit-requests",{method:"POST",body:JSON.stringify(t)}),approve:t=>V(`/credit-requests/${t}/approve`,{method:"POST"}),reject:t=>V(`/credit-requests/${t}/reject`,{method:"POST"})},qe={get:async()=>({screenLockPassword:"2005",businessName:"My Business"}),update:async t=>t},it={getAll:t=>{const o=t?`/batches?productId=${t}`:"/batches";return V(o)},create:t=>V("/batches",{method:"POST",body:JSON.stringify(t)})},zt={clearData:(t="all")=>V("/clear-data",{method:"POST",body:JSON.stringify({type:t})})},Qe={login:t=>V("/main-admin/auth/login",{method:"POST",body:JSON.stringify(t)}),getUsers:()=>{const t=localStorage.getItem("ownerToken");return V("/main-admin/users",{headers:{Authorization:`Bearer ${t}`,"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}})},getStats:()=>{const t=localStorage.getItem("ownerToken");return V("/main-admin/stats",{headers:{Authorization:`Bearer ${t}`,"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}})},getActivities:()=>{const t=localStorage.getItem("ownerToken");return V("/main-admin/activities",{headers:{Authorization:`Bearer ${t}`}})},getSalesAll:()=>{const t=localStorage.getItem("ownerToken");return V("/main-admin/sales-all",{headers:{Authorization:`Bearer ${t}`}})},getTimeEntriesAll:()=>{const t=localStorage.getItem("ownerToken");return V("/main-admin/time-entries-all",{headers:{Authorization:`Bearer ${t}`}})},lockUser:(t,o)=>{const p=localStorage.getItem("ownerToken");return V(`/main-admin/users/${t}/lock`,{method:"POST",headers:{Authorization:`Bearer ${p}`},body:JSON.stringify({locked:o})})},changePlan:(t,o)=>{const p=localStorage.getItem("ownerToken");return V(`/main-admin/users/${t}/plan`,{method:"POST",headers:{Authorization:`Bearer ${p}`},body:JSON.stringify({plan:o})})},deleteUser:t=>{const o=localStorage.getItem("ownerToken");return V(`/main-admin/users/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}})},clearData:t=>{const o=localStorage.getItem("ownerToken");return V("/main-admin/system/clear-data",{method:"POST",headers:{Authorization:`Bearer ${o}`},body:JSON.stringify({type:t})})}};let ve=null,Ze=new Set;function ws(){const t=ue.replace(/\/api$/,"");return`${t.startsWith("https")?"wss":"ws"}://${t.replace(/^https?:\/\//,"")}/api/ws/products`}function Ss(){if(ve&&(ve.readyState===WebSocket.OPEN||ve.readyState===WebSocket.CONNECTING))return;const t=_t(),o=ws()+(t?`?token=${encodeURIComponent(t)}`:"");ve=new WebSocket(o),ve.onopen=()=>{console.debug("Products WS connected")},ve.onmessage=p=>{let g=null;try{g=JSON.parse(p.data)}catch{return}Ze.forEach(c=>{try{c(g)}catch(i){console.error("ws callback error",i)}})},ve.onclose=()=>{console.debug("Products WS closed"),ve=null},ve.onerror=p=>{console.error("Products WS error",p)}}function ks(t){if(typeof t!="function")throw new Error("subscribeProducts requires a callback");return Ze.add(t),Ss(),()=>{if(Ze.delete(t),ve&&Ze.size===0){try{ve.close()}catch{}ve=null}}}function Cs(){return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 text-center border border-red-200",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-500 to-orange-500 rounded-full mx-auto mb-6 flex items-center justify-center",children:e.jsx(we,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Account Suspended"}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[e.jsx("p",{className:"text-red-700 font-medium mb-2",children:"Out of credit"}),e.jsx("p",{className:"text-red-600 text-sm",children:"Your account has been temporarily suspended. Please reach out to the developer to resolve this issue."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-600",children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Contact: support@universal.com"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-600",children:[e.jsx(ts,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Phone: +254 XXX XXX XXX"})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["Account ID: ",localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")).id:"Unknown"]})})]})})}const Ht=s.createContext(),ke=()=>s.useContext(Ht),Ps=({children:t})=>{const[o,p]=s.useState(null),[g,c]=s.useState(!0),[i,n]=s.useState(!1),[a,x]=s.useState({});s.useEffect(()=>{h()},[]),s.useEffect(()=>{const k=()=>{const H=localStorage.getItem("user");if(H)try{const X=JSON.parse(H);p(X)}catch(X){console.warn("Failed to parse user from localStorage",X)}else p(null)},A=H=>{const X=H.detail?.userId,oe=o||JSON.parse(localStorage.getItem("user")||"{}");oe&&oe.id===X&&(alert("âš ï¸ Your account has been locked by the system administrator. You will be logged out."),localStorage.removeItem("token"),localStorage.removeItem("user"),p(null),setTimeout(()=>{window.location.href="/auth/login?reason=account_locked"},1e3))};return window.addEventListener("storage",k),window.addEventListener("localStorageUpdated",k),window.addEventListener("accountLocked",A),()=>{window.removeEventListener("storage",k),window.removeEventListener("localStorageUpdated",k),window.removeEventListener("accountLocked",A)}},[o]);const m=()=>{["products","sales","expenses","activities","timeEntries","dashboardCache","inventoryCache","analyticsCache"].forEach(A=>{try{localStorage.removeItem(A),sessionStorage.removeItem(A)}catch(H){console.warn(`Failed to clear ${A}`,H)}})},h=async()=>{try{m();const k=localStorage.getItem("token"),A=localStorage.getItem("user");if(k&&A)try{const H=JSON.parse(A);if(H.locked){localStorage.removeItem("token"),localStorage.removeItem("user"),p(null),n(!0),c(!1);return}p(H),fetch(`${ue}/auth/me`,{headers:{Authorization:`Bearer ${k}`,"Content-Type":"application/json"}}).then(X=>{if(X.ok)return X.json().then(oe=>{oe.locked?(localStorage.removeItem("token"),localStorage.removeItem("user"),p(null)):(p(oe),localStorage.setItem("user",JSON.stringify(oe)))});throw new Error("Invalid token")}).catch(X=>{console.warn("Auth check failed:",X),localStorage.removeItem("token"),localStorage.removeItem("user")})}catch(H){console.warn("Auth initialization failed:",H),localStorage.removeItem("token"),localStorage.removeItem("user")}}catch(k){console.error("Error initializing auth:",k),localStorage.removeItem("token"),localStorage.removeItem("user"),p(null)}finally{n(!0),c(!1)}},D=async k=>{try{if(k&&k.token&&k.user)return localStorage.setItem("token",k.token),localStorage.setItem("user",JSON.stringify(k.user)),p(k.user),k;const A=await Ee.login(k);if(A.token&&A.user)return localStorage.setItem("token",A.token),localStorage.setItem("user",JSON.stringify(A.user)),p(A.user),A;throw new Error("Invalid response from server")}catch(A){throw console.error("Login failed:",A),A}},r=async k=>{try{const A=await Ee.signup(k);if(A.token&&A.user)return localStorage.setItem("token",A.token),localStorage.setItem("user",JSON.stringify(A.user)),p(A.user),A;throw new Error("Invalid response from server")}catch(A){throw console.error("Signup failed:",A),A}},P=async k=>{try{if(localStorage.setItem("user",JSON.stringify(k)),p(k),window.dispatchEvent(new Event("localStorageUpdated")),k&&k.id)try{await De.update(k.id,k)}catch(A){console.warn("Failed to persist updated user to backend",A)}return k}catch(A){throw console.error("updateUser failed:",A),A}},j=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),p(null),window.location.href="/login"},f=()=>!!o&&!!localStorage.getItem("token"),S=k=>o&&o.role===k,y=()=>o&&(o.role==="admin"||o.role==="main-admin"),$=()=>o&&o.role==="cashier",N=()=>o&&o.plan==="ultra",L=()=>o&&o.plan==="basic",w=()=>o&&(o.role==="admin"||o.role==="cashier"),O=()=>o&&o.role==="admin"&&o.plan==="ultra",U=()=>o&&o.role==="admin",C=()=>!0,b=()=>!0;return o?.locked?e.jsx(Cs,{}):e.jsx(Ht.Provider,{value:{user:o,loading:g,isInitialized:i,appSettings:a,login:D,signup:r,updateUser:P,logout:j,isAuthenticated:f,hasRole:S,isAdmin:y,isCashier:$,isUltraPackage:N,isBasicPackage:L,canEditStock:w,canManageUsers:O,canViewAnalytics:U,isRealTimeProductSyncEnabled:C,isCashierUserManagementEnabled:b},children:t})};new Date().toISOString();const Kt=s.createContext(),As=()=>s.useContext(Kt),Ds=({children:t})=>{const{user:o}=ke(),[p,g]=s.useState([]),[c,i]=s.useState(!0),[n,a]=s.useState(null),[x,m]=s.useState(Date.now()),h=s.useCallback(async()=>{if(!localStorage.getItem("token")){i(!1);return}try{const r=await be.getAll(),j=(Array.isArray(r)?r:[]).filter(f=>o?.role==="admin"?!0:!f.expenseOnly&&!f.pendingDelete&&f.visibleToCashier!==!1);g(j),a(null),window.dispatchEvent(new CustomEvent("productsSync",{detail:{products:j,timestamp:Date.now()}}))}catch(r){console.error("Failed to fetch products:",r),a(`Failed to load products: ${r.message}`),g([])}finally{i(!1),m(Date.now())}},[o]);s.useEffect(()=>{h()},[h,o]),s.useEffect(()=>{const r=setInterval(()=>{h()},500);return()=>clearInterval(r)},[h]);const D=async()=>{i(!0),await h()};return e.jsx(Kt.Provider,{value:{products:p,loading:c,error:n,lastUpdated:x,refreshProducts:D},children:t})};function Is(){const[t,o]=s.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[p,g]=s.useState(!0),[c,i]=s.useState(null);s.useEffect(()=>{n()},[]);const n=async()=>{try{i(null);const[m,h]=await Promise.all([Jt.get(),ze.getAll()]),D={totalSales:m?.totalSales||0,totalExpenses:m?.totalExpenses||0,profit:m?.profit||0,grossProfit:m?.grossProfit||0,netProfit:m?.netProfit||0,totalCOGS:m?.totalCOGS||0,dailySales:m?.dailySales||0,weeklySales:m?.weeklySales||0,productCount:m?.productCount||0},r=Array.isArray(h)?h:[];o({stats:D,recentSales:r.slice(-10).reverse()})}catch(m){console.error("Failed to load data:",m),i(m.message),o({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{g(!1)}};if(p)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(c&&t.stats.totalSales===0&&t.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(ut,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:c}),e.jsx("button",{onClick:n,className:"btn-primary",children:"Retry"})]})});const a=[{label:"Total Sales",value:`KSH ${t.stats.totalSales?.toLocaleString()||0}`,icon:Te,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${t.stats.grossProfit?.toLocaleString()||0}`,icon:Re,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${t.stats.totalCOGS?.toLocaleString()||0}`,icon:_e,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${t.stats.netProfit?.toLocaleString()||0}`,icon:Re,color:"from-purple-500 to-pink-600",change:"+15.3%"}],x=[{label:"Daily Sales",value:`KSH ${t.stats.dailySales?.toLocaleString()||0}`,icon:Lt,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${t.stats.weeklySales?.toLocaleString()||0}`,icon:Re,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${t.stats.totalExpenses?.toLocaleString()||0}`,icon:tt,color:"bg-red-50 text-red-600"},{label:"Products",value:t.stats.productCount||0,icon:_e,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(a||[]).map((m,h)=>{const D=m?.icon;return D?e.jsxs("div",{className:`card bg-gradient-to-br ${m.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(D,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:m.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:m.label}),e.jsx("p",{className:"text-2xl font-bold",children:m.value})]},h):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(x||[]).map((m,h)=>{const D=m?.icon;return D?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${m.color} flex items-center justify-center`,children:e.jsx(D,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:m.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:m.value})]})]})},h):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!t.recentSales||t.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ut,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(t.recentSales||[]).map(m=>m?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:m.createdAt?new Date(m.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(m.items)?m.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:m.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",m.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",m.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",m.profit?.toLocaleString()||0]})]},m.id||Math.random()):null)})]})})]})]})}const Es=()=>"https://posifine22.onrender.com/api".replace("https://","wss://").replace("http://","ws://");class Ls{constructor(){this.ws=null,this.listeners={stock_updated:[],heartbeat:[],initial:[],error:[],sale_deleted:[],sale_created:[],product_deleted:[],product_created:[],product_updated:[],user_deleted:[],data_cleared:[],products_cleared:[],cashier_clocked_in:[],cashier_clocked_out:[]},this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.isManualClose=!1}connect(o,p){return new Promise((g,c)=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){g();return}if(!o){c(new Error("No token provided for WebSocket connection"));return}const i=`${Es()}/ws/products?token=${encodeURIComponent(o)}`;try{this.ws=new WebSocket(i),this.ws.onopen=()=>{console.log("âœ… WebSocket connected for real-time updates"),this.reconnectAttempts=0,g()},this.ws.onmessage=n=>{try{const a=JSON.parse(n.data);a.type==="stock_updated"?(console.log("ðŸ“¦ Stock update received:",a.data),p&&p(a.data),this.emit("stock_updated",a.data)):a.type==="product_created"?(console.log("âœ¨ New product created:",a.data.product),this.emit("product_created",a.data),window.dispatchEvent(new Event("productCreated"))):a.type==="product_updated"?(console.log("ðŸ“ Product updated:",a.data.product),this.emit("product_updated",a.data),window.dispatchEvent(new Event("productUpdated"))):a.type==="initial"?(console.log("ðŸ“¦ Initial products loaded via WebSocket"),this.emit("initial",a.products)):a.type==="heartbeat"?this.emit("heartbeat",a):a.type==="sale_deleted"?(console.log("ðŸ—‘ï¸ Sale deleted:",a.data),this.emit("sale_deleted",a.data),window.dispatchEvent(new Event("saleDeleted"))):a.type==="product_deleted"?(console.log("ðŸ—‘ï¸ Product deleted:",a.data),this.emit("product_deleted",a.data),window.dispatchEvent(new Event("dataUpdated"))):a.type==="user_deleted"?(console.log("ðŸ—‘ï¸ User deleted:",a.data),this.emit("user_deleted",a.data),window.dispatchEvent(new Event("userDeleted"))):a.type==="data_cleared"?(console.log("ðŸ—‘ï¸ Data cleared:",a.data),this.emit("data_cleared",a.data),window.dispatchEvent(new Event("dataUpdated"))):a.type==="products_cleared"?(console.log("ðŸ—‘ï¸ Products cleared:",a.data),this.emit("products_cleared",a.data),window.dispatchEvent(new CustomEvent("productsCleared",{detail:a.data}))):a.type==="sale_created"?(console.log("ðŸ’° New sale recorded:",a.data.sale),this.emit("sale_created",a.data),window.dispatchEvent(new CustomEvent("saleCreated",{detail:a.data}))):a.type==="cashier_clocked_in"?(console.log("â° Cashier clocked in:",a.data.entry),this.emit("cashier_clocked_in",a.data),window.dispatchEvent(new CustomEvent("cashierClockIn",{detail:a.data}))):a.type==="cashier_clocked_out"&&(console.log("â° Cashier clocked out:",a.data.entry),this.emit("cashier_clocked_out",a.data),window.dispatchEvent(new CustomEvent("cashierClockOut",{detail:a.data})))}catch(a){console.error("Error parsing WebSocket message:",a)}},this.ws.onerror=n=>{console.error("âŒ WebSocket error:",n),this.emit("error",n),c(n)},this.ws.onclose=()=>{console.log("ðŸ”Œ WebSocket disconnected"),this.isManualClose||this.attemptReconnect(o,p)}}catch(n){console.error("Failed to create WebSocket:",n),c(n)}})}attemptReconnect(o,p){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Max reconnection attempts reached");return}this.reconnectAttempts++;const g=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`ðŸ”„ Reconnecting in ${g}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect(o,p).catch(c=>{console.error("Reconnection failed:",c)})},g)}on(o,p){this.listeners[o]||(this.listeners[o]=[]),this.listeners[o].push(p)}emit(o,p){this.listeners[o]&&this.listeners[o].forEach(g=>{try{g(p)}catch(c){console.error(`Error in ${o} listener:`,c)}})}disconnect(){this.isManualClose=!0,this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}}const ct=new Ls;function Ts(){const{user:t,isUltraPackage:o,isRealTimeProductSyncEnabled:p}=ke(),{products:g,refreshProducts:c}=As(),[i,n]=s.useState([]),[a,x]=s.useState([]),[m,h]=s.useState("all"),[D,r]=s.useState(""),[P,j]=s.useState(!1),[f,S]=s.useState(!1),[y,$]=s.useState(!1),[N,L]=s.useState(null),[w,O]=s.useState(null),[U,C]=s.useState(null),[b,k]=s.useState(!1),[A,H]=s.useState(null),[X,oe]=s.useState(""),[W,he]=s.useState({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),[ie,J]=s.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[q,se]=s.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0});s.useEffect(()=>{v();const d=localStorage.getItem("token");return d&&ct.connect(d,E=>{E&&E.allProducts&&n(E.allProducts)}).catch(E=>{console.warn("WebSocket connection failed:",E)}),()=>{ct.disconnect()}},[]);const v=async()=>{try{await c();const d=await it.getAll();x(d)}catch(d){console.error("Failed to load data:",d)}};s.useEffect(()=>{g&&n(g)},[g]);const z=(d,E=!0)=>{const M=d.target.files[0];if(M){if(M.size>2*1024*1024){I("Image must be smaller than 2MB","error");return}const te=new FileReader;te.onload=ee=>{const K=ee.target.result;oe(K),E?he({...W,image:K}):(se({...q,image:K}),q.id&&setTimeout(async()=>{try{await be.update(q.id,{image:K}),I("âœ… Image saved","success")}catch(Ce){console.error("Failed to save image:",Ce)}},500))},te.readAsDataURL(M)}},R=d=>a.filter(M=>M.productId===d&&M.quantity>0).reduce((M,te)=>M+te.quantity,0),ce=d=>a.filter(E=>E.productId===d&&E.quantity>0),u=(d,E)=>!E||!d?d:["kg","g","gram","grams","kilogram","kilograms"].includes(E.toLowerCase())?d>=1?`${d.toFixed(2)}`:`${d.toFixed(3)}`.replace(/\.?0+$/,""):Math.round(d).toString(),I=(d,E="success")=>{C({message:d,type:E}),setTimeout(()=>C(null),5e3)},_=async d=>{d.preventDefault(),console.log("ðŸ”µ handleAddProduct triggered",{newProduct:W});try{if(!W.name||!W.name.trim()){I("âŒ Product name is required","error");return}if(!W.price||isNaN(parseFloat(W.price))){I("âŒ Valid product price is required","error");return}const E={...W,price:parseFloat(W.price),cost:parseFloat(W.cost||0),quantity:0,visibleToCashier:!W.expenseOnly&&W.visibleToCashier!==!1};console.log("ðŸ“ Sending product data to API:",E);const M=await be.create(E);console.log("âœ… Product created successfully:",M),he({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),oe(""),j(!1),console.log("ðŸ”„ Refreshing product list..."),await v(),I(`âœ… Product "${M.name}" added successfully! ${M.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success")}catch(E){console.error("âŒ Failed to create product:",E),console.error("Error details:",{message:E.message,status:E.status,stack:E.stack}),I(`âŒ Failed to create product: ${E.message||"Unknown error"}`,"error")}},Y=async d=>{d.preventDefault();try{const E=parseFloat(ie.quantity);if(isNaN(E)||E<=0){I("âŒ Please enter a valid quantity","error");return}const te=N.unit&&["kg","g","gram","grams","kilogram","kilograms"].includes(N.unit.toLowerCase())?.01:1;if(E<te){I(`âŒ Minimum quantity is ${te} ${N.unit}`,"error");return}const ee={id:`batch-${Date.now()}`,productId:N.id,quantity:E,expiryDate:ie.expiryDate,batchNumber:ie.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(ie.cost||N.cost||0)};x(K=>[...K,ee]),I("âš¡ Adding stock...","info");try{await it.create({productId:N.id,quantity:E,expiryDate:ie.expiryDate,batchNumber:ie.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(ie.cost||N.cost||0)}),J({quantity:"",expiryDate:"",batchNumber:"",cost:""}),$(!1),L(null),await v(),I(`âœ… Stock added successfully for ${N.name}!`,"success")}catch(K){throw x(Ce=>Ce.filter(Se=>Se.id!==ee.id)),K}}catch(E){console.error("Failed to add stock:",E),I(`âŒ Failed to add stock: ${E.message||"Unknown error"}`,"error")}},ne=async d=>{d.preventDefault();try{const E=i.find(ee=>ee.id===q.id);if(parseFloat(q.price)<E.price){alert("You cannot lower prices, only increase.");return}const M={...q,price:parseFloat(q.price),cost:parseFloat(q.cost),quantity:parseFloat(q.quantity)},te={...E,...M};n(ee=>ee.map(K=>K.id===q.id?te:K)),k(!0),I("âš¡ Updating product...","info");try{const ee=await be.update(q.id,M);S(!1),p()?(window.dispatchEvent(new CustomEvent("productUpdated",{detail:{product:ee,originalProduct:E,timestamp:new Date().toISOString(),type:"update"}})),I("âœ… Product updated and synced!","success")):I("âœ… Product updated successfully!","success"),H(new Date)}catch(ee){throw n(K=>K.map(Ce=>Ce.id===q.id?E:Ce)),ee}finally{k(!1)}}catch(E){console.error("Failed to update product:",E),I(`âŒ Update failed: ${E.message||"Unknown error"}`,"error")}},Z=async d=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const E=i.find(te=>te.id===d),M=await be.delete(d);if(n(te=>te.filter(ee=>ee.id!==d)),p()&&E)k(!0),window.dispatchEvent(new CustomEvent("productDeleted",{detail:{product:E,timestamp:new Date().toISOString(),type:"delete"}})),I(`ðŸ“¡ Product "${E.name}" deleted and synced to all dashboards!`,"success"),H(new Date),setTimeout(()=>{k(!1)},3e3);else{const te=M?.message||"Product deleted successfully!";alert(te)}await c()}catch(E){console.error("Failed to delete product:",E);let M="Failed to delete product";E.message.includes("Failed to execute")||E.message.includes("JSON")?M="Network error. Please check your connection and try again.":E.message.includes("401")||E.message.includes("unauthorized")?M="You are not authorized to delete this product.":E.message.includes("404")||E.message.includes("not found")?M="Product not found. It may have been deleted already.":E.message&&(M=`Failed to delete product: ${E.message}`),alert(M)}},ae=(i||[]).filter(d=>{if(!d)return!1;const E=d.name?.toLowerCase().includes(D.toLowerCase()),M=m==="all"||m==="raw"&&!d.recipe||m==="composite"&&d.recipe||m==="expense"&&d.expenseOnly||m==="low-stock"&&d.quantity<10;return E&&M}),de=(i||[]).filter(d=>d&&!d.recipe&&!d.expenseOnly),je=(i||[]).filter(d=>d&&d.recipe),fe=(i||[]).filter(d=>d&&d.expenseOnly),Ae=d=>{if(!d||!d.recipe)return 0;let E=1/0;return(d.recipe||[]).forEach(M=>{if(!M)return;const te=(i||[]).find(ee=>ee&&ee.id===M.productId);if(te&&te.quantity>0&&M.quantity>0){const ee=Math.floor(te.quantity/M.quantity);E=Math.min(E,ee)}}),E===1/0?0:E},me=d=>{if(!d)return 0;if(!d.recipe)return d.cost||0;let E=0;return(d.recipe||[]).forEach(M=>{if(!M)return;const te=(i||[]).find(ee=>ee&&ee.id===M.productId);if(te&&te.quantity>0){const ee=(te.cost||0)/te.quantity;E+=ee*(M.quantity||0)}}),E};return e.jsxs("div",{className:"p-6 space-y-6",children:[U&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${U.type==="success"?"bg-green-50 border border-green-200 text-green-800":U.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:U.message}),e.jsx("button",{onClick:()=>C(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(gt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:D,onChange:d=>r(d.target.value)})]}),e.jsxs("select",{value:m,onChange:d=>h(d.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>j(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:de.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:je.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:fe.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(ae||[]).map(d=>{if(!d)return null;const E=me(d),M=d.price?((d.price-E)/d.price*100).toFixed(1):0,te=Ae(d),ee=w===d.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[d.image?e.jsx("img",{src:d.image,alt:d.name,className:"w-12 h-12 object-cover rounded-lg",onError:K=>{K.target.style.display="none",K.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:d.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[d.recipe&&e.jsx("button",{onClick:()=>O(ee?null:d.id),className:"p-1 hover:bg-gray-200 rounded",children:ee?e.jsx(ss,{className:"w-4 h-4"}):e.jsx(as,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:d.name}),d.quantity<10&&!d.recipe&&e.jsx($e,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${d.expenseOnly?"badge-warning":d.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:d.expenseOnly?"Expense":d.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",d.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",E.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${R(d.id)===0?"text-red-600":R(d.id)<10?"text-yellow-600":"text-gray-900"}`,children:[u(R(d.id),d.unit)," ",d.unit]}),R(d.id)<10&&R(d.id)>0&&e.jsx($e,{className:"w-4 h-4 text-yellow-500"}),R(d.id)===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600",children:[ce(d.id).length," active"]}),e.jsx("button",{onClick:()=>{L(d),$(!0)},className:"p-1 hover:bg-blue-50 rounded text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(ye,{className:"w-3 h-3"})})]})}),e.jsx("td",{className:"px-4 py-3",children:d.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[te," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${M>30?"text-green-600":M>15?"text-yellow-600":"text-red-600"}`,children:[M,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{se(d),S(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Z(d.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(Pe,{className:"w-4 h-4"})})]})})]},d.id),ee&&d.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(d.recipe||[]).map((K,Ce)=>{if(!K)return null;const Se=(i||[]).find(Ve=>Ve&&Ve.id===K.productId);if(!Se)return null;const Ke=(Se.cost||0)/(Se.quantity||1),ot=Ke*(K.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:Se.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[K.quantity||0," ",Se.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[Se.quantity||0," ",Se.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",Ke.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",ot.toFixed(2)]})]},Ce)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",E.toFixed(2)]})]})})]})]})})})]})})})]})})}),y&&N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-2",children:["Add Stock for ",N.name]}),e.jsxs("p",{className:"text-xs text-gray-600 mb-4",children:["Unit: ",e.jsx("span",{className:"font-semibold",children:N.unit}),["kg","g","gram","grams","kilogram","kilograms"].includes(N.unit?.toLowerCase())&&e.jsx("span",{className:"ml-2 text-blue-600",children:"ðŸ”¹ Supports decimals (e.g., 0.5 kg, 250 g)"})]}),e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Quantity ",["kg","g","gram","grams","kilogram","kilograms"].includes(N.unit?.toLowerCase())?"(decimal allowed)":"(whole numbers)"]}),e.jsx("input",{type:"number",step:["kg","g","gram","grams","kilogram","kilograms"].includes(N.unit?.toLowerCase())?"0.01":"1",min:["kg","g","gram","grams","kilogram","kilograms"].includes(N.unit?.toLowerCase())?"0.01":"1",placeholder:["kg","g","gram","grams","kilogram","kilograms"].includes(N.unit?.toLowerCase())?"e.g., 0.5, 1.25":"e.g., 100, 500",className:"input",value:ie.quantity,onChange:d=>J({...ie,quantity:d.target.value}),required:!0})]}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:ie.expiryDate,onChange:d=>J({...ie,expiryDate:d.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:ie.batchNumber,onChange:d=>J({...ie,batchNumber:d.target.value})}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Cost per Unit",className:"input",value:ie.cost,onChange:d=>J({...ie,cost:d.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{$(!1),L(null),J({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:W.name,onChange:d=>he({...W,name:d.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:d=>z(d,!0),className:"input"}),e.jsx(Tt,{className:"w-5 h-5 text-gray-400"})]}),(X||W.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:X||W.image,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:W.price,onChange:d=>he({...W,price:d.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:W.cost,onChange:d=>he({...W,cost:d.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:W.category,onChange:d=>he({...W,category:d.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsxs("select",{className:"input",value:W.unit,onChange:d=>he({...W,unit:d.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:W.expenseOnly,onChange:d=>he({...W,expenseOnly:d.target.checked,visibleToCashier:!d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!W.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:W.visibleToCashier,onChange:d=>he({...W,visibleToCashier:d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{j(!1),oe(""),he({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0})},className:"btn-secondary",children:"Cancel"})]})]})]})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:ne,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:q.name,onChange:d=>se({...q,name:d.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:q.image||"",onChange:d=>se({...q,image:d.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:d=>{const E=d.target.files[0];if(E){const M=new FileReader;M.onloadend=()=>{se({...q,image:M.result})},M.readAsDataURL(E)}}})]}),q.image&&e.jsx("img",{src:q.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:q.price||"",onChange:d=>se({...q,price:d.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:q.cost||"",onChange:d=>se({...q,cost:d.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:q.quantity||"",onChange:d=>se({...q,quantity:d.target.value}),required:!0}),e.jsxs("select",{className:"input",value:q.unit||"pcs",onChange:d=>se({...q,unit:d.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:q.category||"raw",onChange:d=>se({...q,category:d.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:q.expenseOnly||!1,onChange:d=>se({...q,expenseOnly:d.target.checked,visibleToCashier:!d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!q.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:q.visibleToCashier!==!1,onChange:d=>se({...q,visibleToCashier:d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>S(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function $s(){const[t,o]=s.useState([]),[p,g]=s.useState([]),[c,i]=s.useState(!1),[n,a]=s.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});s.useEffect(()=>{x()},[]);const x=async()=>{const f=await be.getAll();o(f),g(f.filter(S=>!S.recipe))},m=()=>{a({...n,ingredients:[...n.ingredients,{name:"",quantity:"",unit:"pcs"}]})},h=(f,S,y)=>{const $=[...n.ingredients];$[f][S]=y,a({...n,ingredients:$})},D=f=>{a({...n,ingredients:n.ingredients.filter((S,y)=>y!==f)})},r=()=>n.ingredients.reduce((f,S)=>{const y=p.find($=>$.name.toLowerCase()===S.name.toLowerCase());if(y&&S.quantity){const $=y.cost/y.quantity;return f+$*parseFloat(S.quantity)}return f},0),P=async f=>{f.preventDefault();const S=[];for(const $ of n.ingredients){if(!$.name||!$.quantity)continue;const N=p.find(L=>L.name.toLowerCase()===$.name.toLowerCase());N?S.push({productId:N.id,quantity:parseFloat($.quantity),unit:$.unit||"pcs"}):S.push({name:$.name,quantity:parseFloat($.quantity),unit:$.unit||"pcs"})}if(S.length===0){alert("Please add at least one ingredient");return}const y=r();try{await be.create({name:n.name,price:parseFloat(n.price),cost:y,quantity:0,unit:"pcs",category:"composite",recipe:S,image:n.image||"",visibleToCashier:n.visibleToCashier,expenseOnly:!1}),a({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),i(!1),x(),alert("Recipe created successfully!")}catch($){console.error("Error creating recipe:",$),alert("Failed to create recipe. Please try again.")}},j=t.filter(f=>f.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>i(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",j.length,")"]}),j.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:j.map(f=>{const S=f.recipe.reduce(($,N)=>{if(N.productId){const L=t.find(w=>w.id===N.productId);if(L){const w=L.cost/L.quantity;return $+w*N.quantity}}else if(N.name){const L=t.find(w=>w.name.toLowerCase()===N.name.toLowerCase());if(L){const w=L.cost/L.quantity;return $+w*N.quantity}}return $},0),y=((f.price-S)/f.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:f.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",f.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",S.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${y>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",y,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(Pe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:f.recipe.map(($,N)=>{let L="",w=$.unit||"pcs";if($.productId){const O=t.find(U=>U.id===$.productId);O&&(L=O.name,w=O.unit)}else $.name&&(L=$.name,w=$.unit||"pcs");return L?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:L}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[$.quantity," ",w]})]},N):null})})]})]},f.id)})})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:n.name,onChange:f=>a({...n,name:f.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:n.price,onChange:f=>a({...n,price:f.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:n.image,onChange:f=>a({...n,image:f.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.visibleToCashier,onChange:f=>a({...n,visibleToCashier:f.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:m,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:n.ingredients.map((f,S)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:f.name,onChange:y=>h(S,"name",y.target.value),required:!0,list:`ingredients-list-${S}`}),e.jsx("datalist",{id:`ingredients-list-${S}`,children:p.map(y=>e.jsxs("option",{value:y.name,children:[y.name," (",y.quantity," ",y.unit," available)"]},y.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:f.quantity,onChange:y=>h(S,"quantity",y.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:f.unit,onChange:y=>h(S,"unit",y.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>D(S),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(Pe,{className:"w-4 h-4"})})]},S))}),n.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),n.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",r().toFixed(2)]})]}),n.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(n.price)-r())/parseFloat(n.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{i(!1),a({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Os(){const[t,o]=s.useState([]),[p,g]=s.useState("all");s.useEffect(()=>{c()},[]);const c=async()=>{const h=await ze.getAll();o(h.reverse())},i=async()=>{if(window.confirm(`âš ï¸ Are you sure you want to clear ALL sales data?

This action CANNOT be undone!`))try{await zt.clearData("sales"),o([]),alert("âœ… All sales cleared successfully!")}catch(h){console.error("Failed to clear sales:",h),alert("âŒ Failed to clear sales: "+h.message)}},n=t.filter(h=>{if(p==="today")return new Date(h.createdAt).toDateString()===new Date().toDateString();if(p==="week"){const D=new Date;return D.setDate(D.getDate()-7),new Date(h.createdAt)>=D}return!0}),a=n.reduce((h,D)=>h+D.total,0),x=n.reduce((h,D)=>h+(D.cogs||0),0),m=a-x;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("select",{value:p,onChange:h=>g(h.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:i,className:"btn-secondary flex items-center gap-2 hover:bg-red-50 hover:text-red-600 hover:border-red-200",children:[e.jsx($t,{className:"w-4 h-4"}),"Clear All Sales"]}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(yt,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",a.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",x.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",m.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(yt,{className:"w-8 h-8 text-gray-400"})}),e.jsx("p",{className:"text-gray-600 font-medium text-lg",children:"No sales yet"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Your sales transactions will appear here once processed"})]})})}):n.map(h=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",h.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(h.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[h.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:h.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",h.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",h.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",h.profit?.toLocaleString()||0]})]},h.id))})]})})]})]})}function Us(){const[t,o]=s.useState([]),[p,g]=s.useState(!1),[c,i]=s.useState({description:"",amount:"",category:"general"});s.useEffect(()=>{n()},[]);const n=async()=>{const r=await nt.getAll();o(r.reverse())},a=async()=>{if(window.confirm(`âš ï¸ Are you sure you want to clear ALL expenses data?

This action CANNOT be undone!`))try{if(!localStorage.getItem("token")){alert("âŒ Not authenticated. Please login again.");return}await zt.clearData("expenses"),o([]),localStorage.removeItem("expenses"),window.dispatchEvent(new Event("expensesCleared")),alert("âœ… All expenses cleared successfully!")}catch(r){console.error("Failed to clear expenses:",r),alert("âŒ Failed to clear expenses: "+r.message)}},x=async r=>{r.preventDefault(),await nt.create({...c,amount:parseFloat(c.amount)}),i({description:"",amount:"",category:"general"}),g(!1),n()},m=t.reduce((r,P)=>r+P.amount,0),h=t.filter(r=>!r.automatic),D=t.filter(r=>r.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:a,className:"btn-secondary flex items-center gap-2 hover:bg-red-50 hover:text-red-600 hover:border-red-200",children:[e.jsx($t,{className:"w-4 h-4"}),"Clear All"]}),e.jsxs("button",{onClick:()=>g(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Add Expense"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",m.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",h.reduce((r,P)=>r+P.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",D.reduce((r,P)=>r+P.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.map(r=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(r.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:r.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${r.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:r.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",r.amount?.toLocaleString()]})]},r.id))})]})})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:c.description,onChange:r=>i({...c,description:r.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:c.amount,onChange:r=>i({...c,amount:r.target.value}),required:!0}),e.jsxs("select",{className:"input",value:c.category,onChange:r=>i({...c,category:r.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Fs(){const{isCashierUserManagementEnabled:t,isCashier:o}=ke(),[p,g]=s.useState([]),[c,i]=s.useState(!0),[n,a]=s.useState(!1),[x,m]=s.useState(null),[h,D]=s.useState(null),[r,P]=s.useState(null),[j,f]=s.useState(0),[S,y]=s.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),[$,N]=s.useState(!1),[L,w]=s.useState(null),[O,U]=s.useState("");s.useEffect(()=>{C()},[]),s.useEffect(()=>()=>{r?.intervalId&&clearInterval(r.intervalId)},[r]);const C=async()=>{try{i(!0);const v=await De.getAll();g(Array.isArray(v)?v:[])}catch(v){console.error("Error loading users:",v),g([])}finally{i(!1)}},b=()=>Math.floor(1e3+Math.random()*9e3).toString(),k=async v=>{if(v.preventDefault(),console.log("Form submitted with data:",S),!S.name?.trim()||!S.email?.trim()||!S.password?.trim()){alert("Please fill in all required fields");return}if(S.password.length<6){alert("Password must be at least 6 characters long");return}try{i(!0);const z=b(),R={name:S.name.trim(),email:S.email.trim().toLowerCase(),password:S.password.trim(),pin:z};console.log("Sending user data:",R);const ce=await De.create(R);console.log("User creation result:",ce),await C();const u=`âœ… Cashier added successfully!

ðŸ“§ Email: ${R.email}
ðŸ”‘ Password: ${R.password}
ðŸ”¢ PIN: ${z}

ðŸ’¡ LOGIN OPTIONS:
1. Email + Password: Use email and password above
2. PIN Login: Use email + ${z}

Please share these credentials securely with the new cashier.`;alert(u),y({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),a(!1)}catch(z){console.error("Error creating cashier:",z);let R="Failed to add cashier";z.message.includes("Current user not found")?R="Authentication error. Please refresh the page and try again.":z.message.includes("email")?R="Email already exists. Please use a different email.":z.message.includes("network")||z.message.includes("fetch")?R="Network error. Please check your connection and try again.":z.message&&(R=`Failed to add cashier: ${z.message}`),alert(R)}finally{i(!1)}},A=async(v,z)=>{try{i(!0),await De.update(v,{permissions:z}),await C(),m(null)}catch(R){console.error("Error updating permissions:",R),alert("Failed to update permissions: "+R.message)}finally{i(!1)}},H=async(v,z)=>{try{i(!0);const R=!z,ce=await fetch(`${ue}/users/${v}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({active:R})});if(!ce.ok){const u=await ce.json().catch(()=>({error:"Network error"}));throw new Error(u.error||`HTTP ${ce.status}: ${ce.statusText}`)}await C()}catch(R){console.error("Error updating user status:",R),alert("Failed to update user status: "+R.message)}finally{i(!1)}},X=async(v,z)=>{try{i(!0);const R=!z,ce=await fetch(`${ue}/users/${v}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({locked:R})});if(!ce.ok){const u=await ce.json().catch(()=>({error:"Network error"}));throw new Error(u.error||`HTTP ${ce.status}: ${ce.statusText}`)}await C()}catch(R){console.error("Error updating user lock status:",R),alert("Failed to update user lock status: "+R.message)}finally{i(!1)}},oe=async v=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{i(!0),await De.delete(v),await C()}catch(z){console.error("Error deleting user:",z),alert("Failed to delete user: "+z.message)}finally{i(!1)}},W=v=>{w(v),U(b()),N(!0)},he=async()=>{try{i(!0),await De.update(L.id,{cashierPIN:O}),await C(),N(!1),w(null),U(""),alert(`âœ… PIN reset successfully!

ðŸ”¢ New PIN for ${L.name}: ${O}

Please share this PIN securely with the cashier.`)}catch(v){console.error("Error resetting PIN:",v),alert("Failed to reset PIN: "+v.message)}finally{i(!1)}},ie=v=>{D(v),P({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const z=setInterval(()=>{q(v)},3e3);P(R=>({...R,intervalId:z})),q(v)},J=()=>{r?.intervalId&&clearInterval(r.intervalId),D(null),P(null)},q=async v=>{try{const z=await ze.getAll(),ce=(Array.isArray(z)?z:[]).filter(I=>I.cashierId===v.id).sort((I,_)=>new Date(_.createdAt)-new Date(I.createdAt)).slice(0,10),u={isActive:Math.random()>.3,currentCart:ce.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:ce.reduce((I,_)=>I+_.total,0),salesCount:ce.length,lastActivity:ce.length>0?new Date(ce[0].createdAt).toLocaleTimeString():"No recent activity"};P(u)}catch(z){console.error("Error loading live view data:",z)}},se=(p||[]).filter(v=>v.role==="cashier");return c&&p.length===0?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),t()&&e.jsxs("button",{onClick:()=>a(!0),className:"btn-primary flex items-center gap-2",disabled:c,children:[e.jsx(ye,{className:"w-4 h-4"}),"Add Cashier"]})]}),o()&&!t()&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(we,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"User Management Restricted"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The admin has disabled cashier user management. You cannot add, edit, or remove users at this time."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:p.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:se.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:p.filter(v=>v.active).length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(p||[]).map(v=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:v.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:v.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${v.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:v.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:v.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:v.role==="cashier"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:v.pin||v.cashierPIN||"----"}),e.jsx("button",{onClick:()=>W(v),className:"p-1 hover:bg-yellow-50 rounded text-yellow-600",title:"Reset PIN",disabled:c,children:e.jsx(Ie,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${v.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:v.active?e.jsxs(e.Fragment,{children:[e.jsx(Nt,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(vt,{className:"w-3 h-3"}),"Inactive"]})}),v.locked&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:[e.jsx(Be,{className:"w-3 h-3"}),"Locked"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>H(v.id,v.active),className:`p-2 rounded-lg transition ${v.active?"hover:bg-red-50 text-red-600":"hover:bg-green-50 text-green-600"}`,title:v.active?"Deactivate User":"Activate User",disabled:c,children:v.active?e.jsx(vt,{className:"w-4 h-4"}):e.jsx(Nt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>X(v.id,v.locked||!1),className:`p-2 rounded-lg transition ${v.locked?"hover:bg-green-50 text-green-600":"hover:bg-red-50 text-red-600"}`,title:v.locked?"Unlock User":"Lock User",disabled:c,children:e.jsx(Be,{className:"w-4 h-4"})})]}),v.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",v.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ie(v),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(wt,{className:"w-4 h-4"})})]}),t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>m(v),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600",title:"Edit Permissions",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>oe(v.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",title:"Delete User",disabled:c,children:e.jsx(Pe,{className:"w-4 h-4"})})]})]})})]},v.id))})]}),p.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Oe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first cashier to get started"})]})]})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:S.name||"",onChange:v=>{console.log("Name input changed:",v.target.value),y({...S,name:v.target.value})},required:!0,disabled:c}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:S.email||"",onChange:v=>{console.log("Email input changed:",v.target.value),y({...S,email:v.target.value})},required:!0,disabled:c}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:S.password||"",onChange:v=>{console.log("Password input changed:",v.target.value),y({...S,password:v.target.value})},required:!0,minLength:6,disabled:c}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(S.permissions).map(([v,z])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:z,onChange:R=>y({...S,permissions:{...S.permissions,[v]:R.target.checked}}),disabled:c}),e.jsx("span",{className:"text-sm capitalize",children:v.replace(/([A-Z])/g," $1").trim()})]},v))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:c,children:c?"Adding...":"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>a(!1),className:"btn-secondary",disabled:c,children:"Cancel"})]})]})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",x.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(x.permissions||{}).map(([v,z])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:z,onChange:R=>m({...x,permissions:{...x.permissions,[v]:R.target.checked}}),disabled:c}),e.jsx("span",{className:"text-sm capitalize",children:v.replace(/([A-Z])/g," $1").trim()})]},v))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>A(x.id,x.permissions),className:"btn-primary flex-1",disabled:c,children:c?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>m(null),className:"btn-secondary",disabled:c,children:"Cancel"})]})]})}),h&&r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(wt,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",h.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:J,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(Je,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${r.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:r.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(He,{className:"w-4 h-4"}),"Last Activity: ",r.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Xe,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(r.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(r.currentCart||[]).map((v,z)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[v.name," x",v.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",v.price.toLocaleString()]})]},z)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(r.currentCart||[]).reduce((v,z)=>v+z.price*z.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:r.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",r.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",r.salesCount>0?Math.round(r.totalSalesToday/r.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})}),$&&L&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Reset PIN for ",L.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate a new 4-digit PIN for this cashier. The old PIN will be invalid."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"New PIN:"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-mono text-3xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:O})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>U(b()),className:"btn-secondary flex-1",disabled:c,children:"Generate New PIN"}),e.jsx("button",{onClick:he,className:"btn-primary flex-1",disabled:c,children:c?"Updating...":"Confirm & Update"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>{N(!1),w(null),U("")},className:"btn-secondary w-full",disabled:c,children:"Cancel"})})]})})]})}function Rs(){const[t,o]=s.useState([]),[p,g]=s.useState("all");s.useEffect(()=>{c()},[]);const c=()=>{const x=JSON.parse(localStorage.getItem("clockRecords")||"[]");o(x.reverse())},i=p==="all"?t:t.filter(x=>x.date===new Date().toDateString()),n=i.filter(x=>x.date===new Date().toDateString()).reduce((x,m)=>x+m.duration,0)/60,a=x=>{const m=Math.floor(x/60),h=x%60;return`${m}h ${h}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(He,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[n.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(ft,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(i.filter(x=>x.date===new Date().toDateString()).map(x=>x.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(st,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:t.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${p==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>g("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${p==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"})]})}),e.jsx("tbody",{children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-gray-500",children:"No records found"})}):i.map((x,m)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:x.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.clockIn).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.clockIn).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.clockOut).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:a(x.duration)})})]},m))})]})})]})]})}function Ms(){const{user:t,updateUser:o}=ke();Ue();const[p,g]=s.useState(!1),[c,i]=s.useState(t?.plan||"ultra"),[n,a]=s.useState({}),[x,m]=s.useState(null),[h,D]=s.useState(t?.profilePicture||null),[r,P]=s.useState(!0),[j,f]=s.useState(!0);s.useEffect(()=>{S()},[]);const S=async()=>{try{const C=await qe.get();a(C),C.logo&&m(C.logo),P(C.cashierUserManagement!==!1),f(C.realTimeProductSync!==!1)}catch(C){console.error("Failed to load settings:",C)}},y=async C=>{try{const b={...n,...C};return await qe.update(b),a(b),!0}catch(b){return console.error("Failed to save settings:",b),!1}},$=async()=>{const C=!r;P(C),await y({cashierUserManagement:C})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{cashierUserManagement:C}})),alert(`âœ… Cashier User Management ${C?"ENABLED":"DISABLED"}`)):(P(!C),alert("âŒ Failed to save setting. Please try again."))},N=async()=>{const C=!j;f(C),await y({realTimeProductSync:C})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{realTimeProductSync:C}})),alert(`âœ… Real-time Product Sync ${C?"ENABLED":"DISABLED"}`)):(f(!C),alert("âŒ Failed to save setting. Please try again."))},L=async C=>{const b=C.target.files[0];if(b){const k=new FileReader;k.onloadend=async()=>{const A=k.result;m(A);try{await qe.update({...n,logo:A}),a({...n,logo:A})}catch(H){console.error("Failed to save logo:",H)}},k.readAsDataURL(b)}},w=async C=>{const b=C.target.files[0];if(b){const k=new FileReader;k.onloadend=async()=>{const A=k.result;D(A);try{await o({...t,profilePicture:A})}catch(H){console.error("Failed to save profile picture:",H)}},k.readAsDataURL(b)}},O=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],U=async()=>{const C=O.find(k=>k.id===c),b=c==="ultra"?"admin":"cashier";await o({...t,role:b,plan:c,price:C.price}),g(!1),setTimeout(()=>window.location.href=b==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(ft,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[h?e.jsx("img",{src:h,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:t?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(St,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:w})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(at,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>g(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(bt,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Oe,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cashier User Management"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Cashier User Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow cashiers to add and remove users"})]}),e.jsx("button",{onClick:$,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${r?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${r?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${r?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:r?"âœ… Cashiers can add and remove users when enabled":"âŒ Cashiers cannot add or remove users when disabled"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(ls,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Real-time Product Sync"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Real-time Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync products between admin and cashier dashboards"})]}),e.jsx("button",{onClick:N,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${j?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${j?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${j?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:j?"âœ… Products will sync in real-time across all dashboards":"âŒ Products will not sync automatically across dashboards"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(Be,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(ns,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[x&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:x,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(St,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:L})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:O.map(C=>e.jsxs("div",{onClick:()=>i(C.id),className:`card cursor-pointer transition-all ${c===C.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:C.name}),c===C.id&&e.jsx(rt,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",C.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:C.features.map((b,k)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(rt,{className:"w-4 h-4 text-green-600"}),b]},k))})]},C.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:U,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function qs(){const[t,o]=s.useState([]),[p,g]=s.useState(!1),[c,i]=s.useState(null),[n,a]=s.useState({name:"",amount:"",description:"",active:!0});s.useEffect(()=>{x()},[]);const x=()=>{const r=JSON.parse(localStorage.getItem("serviceFees")||"[]");o(r)},m=r=>{localStorage.setItem("serviceFees",JSON.stringify(r)),o(r)},h=r=>{if(r.preventDefault(),c){const P=t.map(j=>j.id===c.id?{...n,id:j.id}:j);m(P)}else{const P={...n,id:Date.now(),createdAt:new Date().toISOString()};m([...t,P])}g(!1),i(null),a({name:"",amount:"",description:"",active:!0})},D=r=>{confirm("Delete this service fee?")&&m(t.filter(P=>P.id!==r))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{g(!0),i(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(r=>e.jsxs("div",{className:`card ${r.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Te,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:r.name}),e.jsx("p",{className:"text-xs text-gray-500",children:r.description})]})]}),e.jsx("span",{className:`badge ${r.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:r.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",r.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{i(r),a(r),g(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(Ie,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>D(r.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(Pe,{className:"w-4 h-4 text-red-600"})})]})]})]},r.id))}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[c?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:n.name,onChange:r=>a({...n,name:r.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:n.amount,onChange:r=>a({...n,amount:r.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:n.description,onChange:r=>a({...n,description:r.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.active,onChange:r=>a({...n,active:r.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function _s(){const{user:t}=ke(),[o,p]=s.useState([]),[g,c]=s.useState([]),[i,n]=s.useState(!1),[a,x]=s.useState(!1),[m,h]=s.useState([]),[D,r]=s.useState(""),[P,j]=s.useState("all"),[f,S]=s.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});s.useEffect(()=>{y(),$(),O();const b=()=>{O()};return window.addEventListener("messageReceived",b),()=>window.removeEventListener("messageReceived",b)},[]);const y=async()=>{try{const b=localStorage.getItem("token"),k=await fetch(`${ue}/reminders`,{headers:{Authorization:`Bearer ${b}`}});if(!k.ok){console.error("API Error:",k.status,k.statusText),p([]);return}const A=await k.json();Array.isArray(A)?p(A):(console.error("Expected array but got:",typeof A,A),p([]))}catch(b){console.error("Failed to fetch reminders:",b),p([])}},$=async()=>{try{const b=localStorage.getItem("token"),k=await fetch(`${ue}/products`,{headers:{Authorization:`Bearer ${b}`}});if(!k.ok){console.error("API Error:",k.status,k.statusText),c([]);return}const A=await k.json();Array.isArray(A)?c(A):(console.error("Expected array but got:",typeof A,A),c([]))}catch(b){console.error("Failed to fetch products:",b),c([])}},N=async b=>{b.preventDefault();try{const k=localStorage.getItem("token"),A=await fetch(`${ue}/reminders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify(f)});if(!A.ok){const X=await A.json();console.error("Failed to create reminder:",X),alert(`Failed to create reminder: ${X.error||"Unknown error"}`);return}const H=await A.json();S({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),n(!1),y(),alert("Reminder created successfully!")}catch(k){console.error("Failed to create reminder:",k),alert("Failed to create reminder. Please try again.")}},L=async b=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const A=localStorage.getItem("token"),H=await fetch(`${ue}/reminders/${b}`,{method:"DELETE",headers:{Authorization:`Bearer ${A}`}});if(!H.ok){const X=await H.json();console.error("Failed to delete reminder:",X),alert(`Failed to delete reminder: ${X.error||"Unknown error"}`);return}y(),alert("Reminder deleted successfully!")}catch(k){console.error("Failed to delete reminder:",k),alert("Failed to delete reminder. Please try again.")}},w=b=>{f.days.includes(b)?S({...f,days:f.days.filter(k=>k!==b)}):S({...f,days:[...f.days,b]})},O=()=>{const b=`adminMessages_${t?.email||"default"}`,k=JSON.parse(localStorage.getItem(b)||"[]");h(k)},U=b=>{if(b.preventDefault(),!D.trim())return;const k={id:Date.now(),sender:"admin",recipient:P,text:D,timestamp:new Date().toISOString(),read:!1},A=`adminMessages_${t?.email||"default"}`,H=JSON.parse(localStorage.getItem(A)||"[]");H.push(k),localStorage.setItem(A,JSON.stringify(H));const X=`cashierMessages_${t?.email||"default"}`,oe=JSON.parse(localStorage.getItem(X)||"[]");oe.push(k),localStorage.setItem(X,JSON.stringify(oe)),h(H),r(""),window.dispatchEvent(new CustomEvent("newAdminMessage",{detail:k})),alert("Message sent to cashier(s)!")},C=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(bt,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>x(!0),className:"bg-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-purple-700 transition flex items-center gap-2",children:[e.jsx(kt,{size:20}),"Message Cashier"]}),e.jsxs("button",{onClick:()=>n(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(ye,{size:20}),"New Reminder"]})]})]}),e.jsx("div",{className:"grid gap-4",children:o.map(b=>{const k=g.find(A=>A.id===b.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${b.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:b.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",k?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",b.frequency]}),b.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",b.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(st,{size:16}),"Next: ",new Date(b.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${b.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:b.status}),e.jsx("button",{onClick:()=>L(b.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(Pe,{size:20})})]})]})},b.id)})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:N,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:f.customerName,onChange:b=>S({...f,customerName:b.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:f.productId,onChange:b=>S({...f,productId:parseInt(b.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),g.map(b=>e.jsx("option",{value:b.id,children:b.name},b.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:f.frequency,onChange:b=>S({...f,frequency:b.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),f.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:C.map(b=>e.jsx("button",{type:"button",onClick:()=>w(b),className:`px-4 py-2 rounded-lg font-medium transition ${f.days.includes(b)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:b},b))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:f.nextDate,onChange:b=>S({...f,nextDate:b.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>n(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-96 flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 p-6 text-white rounded-t-2xl",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(kt,{size:24}),"Send Message to Cashier"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:m.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No messages yet. Start a conversation!"}):m.map(b=>e.jsxs("div",{className:`p-4 rounded-lg ${b.sender==="admin"?"bg-blue-50 ml-8":"bg-gray-50 mr-8"}`,children:[e.jsx("p",{className:"text-sm font-semibold text-gray-600 mb-1",children:b.sender==="admin"?"You":"Cashier"}),e.jsx("p",{className:"text-gray-800",children:b.text}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:new Date(b.timestamp).toLocaleTimeString()})]},b.id))}),e.jsxs("form",{onSubmit:U,className:"p-4 border-t space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Send To"}),e.jsxs("select",{value:P,onChange:b=>j(b.target.value),className:"w-full px-4 py-2 rounded-lg border focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"all",children:"All Cashiers"}),e.jsx("option",{value:"cashier",children:"Primary Cashier"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",value:D,onChange:b=>r(b.target.value),placeholder:"Type your message...",className:"flex-1 px-4 py-3 rounded-lg border focus:ring-2 focus:ring-purple-500"}),e.jsx("button",{type:"submit",className:"bg-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-purple-700 transition flex items-center gap-2",children:e.jsx(Ot,{size:18})})]})]}),e.jsx("button",{onClick:()=>x(!1),className:"w-full py-2 bg-gray-200 text-gray-700 font-bold hover:bg-gray-300 transition rounded-b-2xl",children:"Close"})]})})]})}function Bs(){const[t,o]=s.useState([]),[p,g]=s.useState(!1),[c,i]=s.useState(null),[n,a]=s.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});s.useEffect(()=>{x()},[]);const x=async()=>{try{const r=await Ye.getAll();o(r)}catch(r){console.error("Failed to load discounts:",r)}},m=async r=>{r.preventDefault();try{c?await Ye.update(c.id,n):await Ye.create(n),g(!1),i(null),a({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),x()}catch(P){console.error("Failed to save discount:",P)}},h=async r=>{if(confirm("Delete this discount?"))try{await Ye.delete(r),x()}catch(P){console.error("Failed to delete discount:",P)}},D=r=>{const P=new Date,j=new Date(r.validFrom),f=new Date(r.validTo);return r.active&&j<=P&&f>=P};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{g(!0),i(null),a({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(r=>e.jsxs("div",{className:`card ${D(r)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${D(r)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(ht,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:r.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[r.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${D(r)?"badge-success":"bg-gray-200 text-gray-600"}`,children:D(r)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(r.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(r.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{i(r),a(r),g(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(Ie,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>h(r.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(Pe,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},r.id)),t.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(ht,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[c?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:n.name,onChange:r=>a({...n,name:r.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:n.percentage,onChange:r=>a({...n,percentage:parseFloat(r.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:n.validFrom,onChange:r=>a({...n,validFrom:r.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:n.validTo,onChange:r=>a({...n,validTo:r.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.active,onChange:r=>a({...n,active:r.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Js(){const[t,o]=s.useState([]),[p,g]=s.useState([]),[c,i]=s.useState("all");s.useEffect(()=>{n(),a()},[]);const n=async()=>{try{const j=await mt.getAll();o(j)}catch(j){console.error("Failed to load credit requests:",j)}},a=async()=>{try{const j=await be.getAll();g(j)}catch(j){console.error("Failed to load products:",j)}},x=async j=>{try{await mt.approve(j),n()}catch(f){console.error("Failed to approve request:",f)}},m=async j=>{try{await mt.reject(j),n()}catch(f){console.error("Failed to reject request:",f)}},h=j=>{const f=p.find(S=>S.id===j);return f?f.name:"Unknown Product"},D=t.filter(j=>c==="all"?!0:j.status===c),r=j=>{switch(j){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},P=j=>{switch(j){case"pending":return e.jsx(He,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(Le,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(lt,{className:"w-6 h-6 text-red-600"});default:return e.jsx(at,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(j=>e.jsx("button",{onClick:()=>i(j),className:`px-4 py-2 rounded-lg font-medium transition ${c===j?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:j.charAt(0).toUpperCase()+j.slice(1)},j))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[D.map(j=>e.jsx("div",{className:`card border-l-4 ${r(j.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${j.status==="pending"?"bg-orange-600":j.status==="approved"?"bg-green-600":"bg-red-600"}`,children:P(j.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:j.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:h(j.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:j.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",j.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(j.createdAt).toLocaleString()]}),j.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(j.approvedAt).toLocaleString()]})]})]}),j.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>x(j.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Le,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>m(j.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(lt,{size:16}),"Reject"]})]}),j.status!=="pending"&&e.jsx("span",{className:`badge ${j.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:j.status.toUpperCase()})]})},j.id)),D.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(at,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",c!=="all"?c:""," credit requests found."]})]})]})]})}function zs(){const{user:t}=ke(),[o,p]=s.useState([]),[g,c]=s.useState(!1),[i,n]=s.useState(!1),[a,x]=s.useState(null),[m,h]=s.useState(null),[D,r]=s.useState(""),[P,j]=s.useState({supplierName:"",details:"",orderDate:"",expectedDelivery:"",amount:""}),f=(w,O="success")=>{h({message:w,type:O}),setTimeout(()=>h(null),3e3)};s.useEffect(()=>{S()},[t]);const S=()=>{try{const w=`vendors_${t?.email||"default"}`,O=JSON.parse(localStorage.getItem(w)||"[]");p(O)}catch(w){console.error("Failed to load vendors:",w),p([])}},y=async w=>{w.preventDefault();try{if(!P.supplierName.trim()){f("âŒ Supplier name is required","error");return}const O={id:Math.random().toString(36).substr(2,9),supplierName:P.supplierName,details:P.details,orderDate:P.orderDate,expectedDelivery:P.expectedDelivery,amount:parseFloat(P.amount||0),createdBy:t?.id||t?.name||"Unknown",createdAt:new Date().toISOString()},U=`vendors_${t?.email||"default"}`,C=JSON.parse(localStorage.getItem(U)||"[]");C.push(O),localStorage.setItem(U,JSON.stringify(C)),j({supplierName:"",details:"",orderDate:"",expectedDelivery:"",amount:""}),c(!1),S(),f(`âœ… Vendor "${O.supplierName}" added successfully!`,"success")}catch(O){console.error("Failed to add vendor:",O),f(`âŒ Failed to add vendor: ${O.message}`,"error")}},$=async w=>{w.preventDefault();try{if(!a.supplierName.trim()){f("âŒ Supplier name is required","error");return}const O=`vendors_${t?.email||"default"}`,U=JSON.parse(localStorage.getItem(O)||"[]"),C=U.findIndex(b=>b.id===a.id);C!==-1&&(U[C]={...a,amount:parseFloat(a.amount||0)},localStorage.setItem(O,JSON.stringify(U))),n(!1),x(null),S(),f(`âœ… Vendor "${a.supplierName}" updated successfully!`,"success")}catch(O){console.error("Failed to update vendor:",O),f(`âŒ Failed to update vendor: ${O.message}`,"error")}},N=async(w,O)=>{if(confirm(`Are you sure you want to delete vendor "${O}"?`))try{const U=`vendors_${t?.email||"default"}`,b=JSON.parse(localStorage.getItem(U)||"[]").filter(k=>k.id!==w);localStorage.setItem(U,JSON.stringify(b)),S(),f(`âœ… Vendor "${O}" deleted successfully!`,"success")}catch(U){console.error("Failed to delete vendor:",U),f(`âŒ Failed to delete vendor: ${U.message}`,"error")}},L=o.filter(w=>w.supplierName?.toLowerCase().includes(D.toLowerCase())||w.details?.toLowerCase().includes(D.toLowerCase()));return e.jsxs("div",{className:"p-6",children:[m&&e.jsx("div",{className:`mb-4 p-4 rounded-lg ${m.type==="error"?"bg-red-50 text-red-800":"bg-green-50 text-green-800"}`,children:m.message}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Ut,{className:"w-6 h-6 text-blue-600"}),"Vendor Management"]}),e.jsxs("button",{onClick:()=>c(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Add Vendor"]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search vendors by name or details...",value:D,onChange:w=>r(w.target.value),className:"input w-full"})}),e.jsx("div",{className:"card overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Supplier Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Details"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Order Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Expected Delivery"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount (KSH)"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Created By"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:L&&L.length>0?L.slice().reverse().map(w=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-semibold",children:w.supplierName}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:w.details||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:w.orderDate?new Date(w.orderDate).toLocaleDateString():"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:w.expectedDelivery?new Date(w.expectedDelivery).toLocaleDateString():"-"}),e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-orange-600",children:w.amount?w.amount.toLocaleString():"0"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:w.createdBy}),e.jsxs("td",{className:"px-4 py-3 text-sm flex gap-2",children:[e.jsx("button",{onClick:()=>{x(w),n(!0)},className:"text-blue-600 hover:text-blue-800 transition-colors",title:"Edit vendor",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>N(w.id,w.supplierName),className:"text-red-600 hover:text-red-800 transition-colors",title:"Delete vendor",children:e.jsx(Pe,{className:"w-4 h-4"})})]})]},w.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:D?"No vendors match your search":"No vendors added yet"})})})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Vendor"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Supplier Name",value:P.supplierName,onChange:w=>j({...P,supplierName:w.target.value}),className:"input w-full",required:!0}),e.jsx("textarea",{placeholder:"Details (optional)",value:P.details,onChange:w=>j({...P,details:w.target.value}),className:"input w-full",rows:"2"}),e.jsx("input",{type:"date",value:P.orderDate,onChange:w=>j({...P,orderDate:w.target.value}),className:"input w-full"}),e.jsx("input",{type:"date",value:P.expectedDelivery,onChange:w=>j({...P,expectedDelivery:w.target.value}),className:"input w-full"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount (KSH)",value:P.amount,onChange:w=>j({...P,amount:w.target.value}),className:"input w-full"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Vendor"}),e.jsx("button",{type:"button",onClick:()=>{c(!1),j({supplierName:"",details:"",orderDate:"",expectedDelivery:"",amount:""})},className:"btn-secondary flex-1",children:"Cancel"})]})]})]})}),i&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Vendor"}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Supplier Name",value:a.supplierName,onChange:w=>x({...a,supplierName:w.target.value}),className:"input w-full",required:!0}),e.jsx("textarea",{placeholder:"Details (optional)",value:a.details,onChange:w=>x({...a,details:w.target.value}),className:"input w-full",rows:"2"}),e.jsx("input",{type:"date",value:a.orderDate,onChange:w=>x({...a,orderDate:w.target.value}),className:"input w-full"}),e.jsx("input",{type:"date",value:a.expectedDelivery,onChange:w=>x({...a,expectedDelivery:w.target.value}),className:"input w-full"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount (KSH)",value:a.amount,onChange:w=>x({...a,amount:w.target.value}),className:"input w-full"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Vendor"}),e.jsx("button",{type:"button",onClick:()=>{n(!1),x(null)},className:"btn-secondary flex-1",children:"Cancel"})]})]})]})})]})}function Vt({onClose:t}){const[o,p]=s.useState([]),[g,c]=s.useState(!0);s.useEffect(()=>{i()},[]);const i=async()=>{try{const a=localStorage.getItem("token"),x=await fetch(`${ue}/reminders/today`,{headers:{Authorization:`Bearer ${a}`}});if(!x.ok){console.error("API Error:",x.status,x.statusText),p([]);return}const m=await x.json();Array.isArray(m)?p(m):(console.error("Expected array but got:",typeof m,m),p([]))}catch(a){console.error("Failed to fetch reminders:",a),p([])}finally{c(!1)}},n=async a=>{try{const x=localStorage.getItem("token");await fetch(`${ue}/reminders/${a}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify({status:"fulfilled"})}),i()}catch(x){console.error("Failed to update reminder:",x)}};return g?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:t,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(Je,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ut,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):o.map(a=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:a.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",a.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:a.frequency})]}),e.jsxs("button",{onClick:()=>n(a.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Le,{size:18}),"Mark Done"]})]},a.id))})]})})}function Wt({onUnlock:t,userType:o="user"}){const[p,g]=s.useState(""),[c,i]=s.useState(""),[n,a]=s.useState("password"),[x,m]=s.useState(!1),[h,D]=s.useState(""),[r,P]=s.useState(!1),[j,f]=s.useState("2005"),S=JSON.parse(localStorage.getItem("user")||"{}");s.useEffect(()=>{(async()=>{try{const L=await qe.get();L?.screenLockPassword&&f(L.screenLockPassword)}catch(L){console.warn("Failed to load settings, using default password:",L)}})()},[]),s.useEffect(()=>{const N=document.getElementById(n==="password"?"unlock-password":"unlock-pin");N&&N.focus()},[n]);const y=async N=>{N.preventDefault(),N.stopPropagation(),P(!0),D("");try{if(n==="password")if(p===j)t();else throw new Error("Incorrect password");else if(n==="pin"&&S.pin)if(c===S.pin)t();else throw new Error("Incorrect PIN");else throw new Error(`Please enter a valid ${n}`)}catch(L){D(L.message||"Unlock failed")}finally{P(!1)}},$=N=>{const L=N.replace(/\D/g,"").slice(0,4);i(L)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:N=>N.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${o==="main_admin"?"bg-gradient-to-br from-red-600 to-orange-600":"bg-gradient-to-br from-blue-600 to-purple-600"}`,children:e.jsx(we,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-gray-600",children:o==="main_admin"?"Main Admin":S.name||"User"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Enter your ",n," to continue"]})]}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[o!=="main_admin"&&S.pin&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unlock Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{a("password"),D("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${n==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ”‘ Password"}),e.jsx("button",{type:"button",onClick:()=>{a("pin"),D("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${n==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ“± PIN"})]})]}),(n==="password"||o==="main_admin")&&e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-password",type:x?"text":"password",placeholder:"Enter your password",className:"w-full pl-10 pr-12 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",value:p,onChange:N=>g(N.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>m(!x),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:x?e.jsx(is,{className:"w-5 h-5"}):e.jsx(Me,{className:"w-5 h-5"})})]}),n==="pin"&&o!=="main_admin"&&e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-pin",type:"text",placeholder:"Enter 4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-center text-2xl tracking-widest",value:c,onChange:N=>$(N.target.value),maxLength:4,required:!0})]}),h&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg border border-red-200",children:h}),e.jsx("button",{type:"submit",disabled:r||n==="pin"&&c.length!==4,className:`w-full py-3 rounded-lg font-bold transition-all disabled:opacity-50 disabled:cursor-not-allowed ${o==="main_admin"?"bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white":"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white"}`,children:r?"Unlocking...":"Unlock Screen"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Screen locked due to inactivity for security"})})]})})}function Gt(t=6e4){const[o,p]=s.useState(!1),[g,c]=s.useState(Date.now()),i=s.useCallback(()=>{c(Date.now()),o&&p(!1)},[o]),n=s.useCallback(()=>{p(!1),i()},[i]);return s.useEffect(()=>{const a=["mousedown","mousemove","keypress","scroll","touchstart","click"],x=()=>{i()};a.forEach(h=>{document.addEventListener(h,x,!0)});const m=setInterval(()=>{Date.now()-g>t&&!o&&p(!0)},1e3);return()=>{a.forEach(h=>{document.removeEventListener(h,x,!0)}),clearInterval(m)}},[g,t,o,i]),[o,n,i]}function Hs(){const{user:t,logout:o,isCashierUserManagementEnabled:p}=ke(),g=Ue(),c=It(),[i,n]=s.useState(!0),[a,x]=s.useState(!1),[m,h]=s.useState({}),[D,r]=Gt(45e3);s.useEffect(()=>{const y=()=>{const N=localStorage.getItem("user");if(N){const L=JSON.parse(N);let w=!1;(L.plan==="ultra"||L.role==="admin")&&(L.active||(L.active=!0,w=!0),L.plan==="ultra"&&L.role!=="admin"&&(L.role="admin",w=!0),L.plan==="ultra"&&(!L.price||L.price!==1600)&&(L.price=1600,w=!0),w&&(localStorage.setItem("user",JSON.stringify(L)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};y(),setTimeout(y,100);const $=setTimeout(()=>{x(!0)},1e3);return P(),()=>clearTimeout($)},[]);const P=async()=>{try{const y=await qe.get();h(y)}catch(y){console.error("Failed to load settings:",y)}},j=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses data? This action cannot be undone."))try{const y=localStorage.getItem("token"),N=await fetch(`${ue}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!N.ok){const L=await N.json();throw console.error("Clear data error:",L),new Error(L.message||"Failed to clear data")}localStorage.removeItem("products"),localStorage.removeItem("sales"),localStorage.removeItem("expenses"),localStorage.removeItem("users"),setData({products:[],sales:[],expenses:[],stats:{},users:[],vendors:[]}),setActiveTab("overview"),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new CustomEvent("dataCleared")),alert("âœ… Data cleared successfully! Refreshing..."),setTimeout(()=>{window.location.href="/admin"},500)}catch(y){console.error("Failed to clear data:",y),alert("âŒ Failed to clear data: "+y.message)}},f=[{id:"overview",label:"Dashboard",icon:cs,path:"/admin"},{id:"sales",label:"Sales",icon:Lt,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:_e,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:Ft,path:"/admin/recipes"},{id:"vendors",label:"Vendors",icon:Ut,path:"/admin/vendors"},{id:"expenses",label:"Expenses",icon:tt,path:"/admin/expenses"},...p()?[{id:"users",label:"Users",icon:Oe,path:"/admin/users"}]:[],{id:"time",label:"Time Tracking",icon:He,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:bt,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:Te,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:ht,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:at,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:os,path:"/admin/settings"}],S=y=>y==="/admin"?c.pathname==="/admin":c.pathname.startsWith(y);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${i?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[i&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>n(!i),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i?e.jsx(Je,{className:"w-5 h-5"}):e.jsx(ds,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:f.map(y=>{const $=y.icon;return e.jsxs("button",{onClick:()=>g(y.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${S(y.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx($,{className:"w-5 h-5 flex-shrink-0"}),i&&e.jsx("span",{className:"font-medium",children:y.label})]},y.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(ms,{className:"w-5 h-5 flex-shrink-0"}),i&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:o,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(jt,{className:"w-5 h-5 flex-shrink-0"}),i&&e.jsx("span",{className:"font-medium",children:"Logout"})]}),e.jsxs("button",{onClick:j,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors",children:[e.jsx(Je,{className:"w-5 h-5 flex-shrink-0"}),i&&e.jsx("span",{className:"font-medium",children:"Clear Data"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:f.find(y=>S(y.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:t?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(Et,{children:[e.jsx(le,{path:"/",element:e.jsx(Is,{})}),e.jsx(le,{path:"/sales",element:e.jsx(Os,{})}),e.jsx(le,{path:"/inventory",element:e.jsx(Ts,{})}),e.jsx(le,{path:"/recipes",element:e.jsx($s,{})}),e.jsx(le,{path:"/vendors",element:e.jsx(zs,{})}),e.jsx(le,{path:"/expenses",element:e.jsx(Us,{})}),e.jsx(le,{path:"/reminders",element:e.jsx(_s,{})}),e.jsx(le,{path:"/service-fees",element:e.jsx(qs,{})}),e.jsx(le,{path:"/discounts",element:e.jsx(Bs,{})}),e.jsx(le,{path:"/credit-requests",element:e.jsx(Js,{})}),e.jsx(le,{path:"/users",element:e.jsx(Fs,{})}),e.jsx(le,{path:"/time",element:e.jsx(Rs,{})}),e.jsx(le,{path:"/settings",element:e.jsx(Ms,{})})]})})]}),a&&e.jsx(Vt,{onClose:()=>x(!1)}),D&&e.jsx(Wt,{onUnlock:r,logo:m.logo})]})}function Ks(){const t=Ue(),[o,p]=s.useState(!1),[g,c]=s.useState(0),i=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 900) or Ultra (KSH 1,600) package",image:"ðŸ“",details:"First user becomes Admin automatically. Choose Ultra for full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],n=[{icon:_e,title:"Smart Inventory",desc:"Track raw materials & composite products with automatic stock deduction"},{icon:Ft,title:"Recipe Builder",desc:"Create bundled products with BOM and auto-calculate COGS"},{icon:Re,title:"Real-time Analytics",desc:"Monitor sales, profit margins, and expenses in real-time"},{icon:Oe,title:"User Management",desc:"Add cashiers with custom permissions and role-based access"},{icon:Be,title:"Secure & Reliable",desc:"JWT authentication with role-based security"},{icon:pt,title:"Advanced Reports",desc:"Daily, weekly summaries with profit/loss tracking"}],a=[{name:"Basic",price:900,icon:Mt,popular:!1,features:["Cashier Dashboard","Basic Inventory","Sales Tracking","Daily/Weekly Reports","Single User","Email Support"]},{name:"Ultra",price:1600,icon:qt,popular:!0,features:["Admin + Cashier Dashboard","Full Inventory Management","Recipe/BOM Builder","Auto Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Unlimited Users","Priority Support"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/auth/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(xs,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(We,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>p(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(Rt,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 30-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(pt,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:n.map((x,m)=>{const h=x.icon;return e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(h,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:x.title}),e.jsx("p",{className:"text-gray-600",children:x.desc})]},m)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:a.map((x,m)=>{const h=x.icon;return e.jsxs("div",{className:`relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${x.popular?"ring-4 ring-blue-600":""}`,children:[x.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${x.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(h,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:x.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",x.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:x.features.map((D,r)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(rt,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:D})]},r))}),e.jsx("button",{onClick:()=>t("/plans"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${x.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},m)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(We,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{p(!1),c(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Je,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",g+1," of ",i.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((g+1)/i.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(g+1)/i.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:i[g].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:i[g].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:i[g].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:i[g].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>c(Math.max(0,g-1)),disabled:g===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),g<i.length-1?e.jsxs("button",{onClick:()=>c(g+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(We,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{p(!1),c(0),t("/plans")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(We,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:i.map((x,m)=>e.jsx("button",{onClick:()=>c(m),className:`w-2 h-2 rounded-full transition-all ${m===g?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},m))})]})]})})]})}function Dt(){const t=It(),[o,p]=s.useState(t.pathname==="/auth/login"),[g,c]=s.useState("password"),[i,n]=s.useState({email:"",password:"",pin:"",name:"",newPassword:"",confirmPassword:""}),[a,x]=s.useState(""),[m,h]=s.useState(!1),[D,r]=s.useState(!1),P=Ue(),{login:j}=ke(),f=()=>{try{return JSON.parse(localStorage.getItem("selectedPlan")||"null")}catch(y){return console.warn("Invalid selectedPlan in localStorage:",y),null}},S=async y=>{y.preventDefault(),x(""),h(!0);const $=performance.now();try{if(D){if(i.newPassword!==i.confirmPassword){x("Passwords do not match"),h(!1);return}if(i.newPassword.length<6){x("Password must be at least 6 characters"),h(!1);return}const U=await Ee.login({email:i.email,newPassword:i.newPassword});U.token&&U.user&&(await j(U),P("/dashboard"));return}if(o){if(g==="pin"){if(!i.pin||i.pin.length!==4){x("Please enter a valid 4-digit PIN"),h(!1);return}}else if(!i.password){x("Please enter your password"),h(!1);return}}let N;if(o)if(g==="pin")try{N=await Ee.pinLogin({email:i.email,pin:i.pin})}catch(U){if(U.message.includes("PIN not set"))x("PIN not set for this user. Please use password login.");else if(U.message.includes("Invalid PIN"))x("Invalid PIN. Please try again.");else throw U;h(!1);return}else N=await Ee.login({email:i.email,password:i.password});else{const U=f();N=await Ee.signup({...i,plan:U?.id||"basic"})}if(N.needsPasswordSetup){r(!0),n({...i,email:N.email}),x(""),h(!1);return}if(!N||!N.user||!N.token)throw new Error("Authentication failed. Please try again.");if(N.user?.locked){x("Your account has been locked by the administrator."),h(!1);return}await j(N);const L={id:Date.now(),type:o?"login":"signup",user:{id:N.user.id,name:N.user.name,email:N.user.email,role:N.user.role,plan:N.user.plan},timestamp:new Date().toISOString()};Promise.resolve().then(()=>{const U=JSON.parse(localStorage.getItem("authActivities")||"[]");U.unshift(L),U.splice(50),localStorage.setItem("authActivities",JSON.stringify(U))});const w=o?"logged in":"signed up";console.log(`âœ… User ${N.user.name} ${w} successfully`);const O=performance.now()-$;console.log(`âš¡ Auth completed in ${O.toFixed(0)}ms`),N.user.role==="admin"?P("/admin"):(N.user.role==="cashier"||console.log("No role detected, defaulting to cashier"),P("/dashboard/cashier"))}catch(N){console.error("Authentication error:",N);let L=N.message||"Authentication failed. Please try again.";N.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),L="Invalid credentials. Please try again."),x(L)}finally{h(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:o?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600",children:o?"Login to your account":"Create your account"})]}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[D?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:i.newPassword,onChange:y=>n({...i,newPassword:y.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:i.confirmPassword,onChange:y=>n({...i,confirmPassword:y.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!o&&e.jsxs("div",{className:"relative",children:[e.jsx(ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:i.name,onChange:y=>n({...i,name:y.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(et,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:i.email,onChange:y=>n({...i,email:y.target.value}),required:!0})]}),o&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Login Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>c("password"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${g==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Password"}),e.jsx("button",{type:"button",onClick:()=>c("pin"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${g==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"pin"})]})]}),o&&g==="password"&&e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:i.password,onChange:y=>n({...i,password:y.target.value}),required:!0})]}),o&&g==="pin"&&e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:i.pin,onChange:y=>n({...i,pin:y.target.value.replace(/\D/g,"").slice(0,4)}),maxLength:4,required:!0})]}),!o&&e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:i.password,onChange:y=>n({...i,password:y.target.value}),required:!0})]})]}),a&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:a}),e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50",children:m?"Please wait...":D?"Set Password":o?"Login":"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{p(!o),x(""),r(!1)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:o?"Don't have an account? Sign up":"Already have an account? Login"})})]})})}function Vs(){const[t,o]=s.useState("ultra"),[p,g]=s.useState(!1),[c,i]=s.useState({name:"",email:"",company:""}),n=Ue(),a=[{id:"basic",name:"Professional Package",price:1500,icon:Mt,color:"from-green-500 to-teal-600",features:["Admin Dashboard + Cashier POS","Basic Inventory Management","Sales Tracking","Daily/Weekly Sales Summaries","Basic Profit/Loss View","Limited Email Notifications","Record Products Sold","Up to 2 Users","Vendor Management","Basic Expense Tracking","Limited Analytics"]},{id:"ultra",name:"Ultra Package (Enterprise)",price:3e3,icon:qt,color:"from-blue-600 to-purple-600",popular:!0,features:["Admin Dashboard + Cashier POS","Full Inventory Management","Recipe/BOM Builder","Composite Products Support","Automatic Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Advanced Analytics","Unlimited Users","Vendor Management","Advanced Reporting","Priority Support"]}],x=async m=>{m.preventDefault();try{await fetch(`${ue}/demo-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),alert("Demo request submitted! Admin will review and contact you."),g(!1),i({name:"",email:"",company:""})}catch(h){console.error("Demo request failed:",h),alert("Failed to submit demo request. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:()=>n("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition",children:[e.jsx(us,{size:20}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mb-8 md:mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Select the perfect plan for your business needs"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6 md:mb-8",children:a.map(m=>{const h=m.icon;return e.jsxs("div",{onClick:()=>o(m.id),className:`card cursor-pointer transition-all transform hover:scale-105 relative ${t===m.id?"ring-4 ring-blue-600 shadow-2xl bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-xl"}`,children:[m.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 md:mb-4",children:[e.jsx("div",{className:`w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br ${m.color} flex items-center justify-center`,children:e.jsx(h,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:m.name})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("span",{className:"text-3xl md:text-4xl font-bold",children:["KSH ",m.price]}),e.jsx("span",{className:"text-gray-600 text-sm md:text-base",children:"/month"})]}),e.jsx("ul",{className:"space-y-2 md:space-y-3",children:m.features.map((D,r)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(rt,{className:"w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs md:text-sm",children:D})]},r))})]},m.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center animate-fade-in",children:[e.jsx("button",{onClick:()=>{console.log("Get Started clicked with plan:",t);const m=a.find(h=>h.id===t);console.log("Selected plan:",m),localStorage.setItem("selectedPlan",JSON.stringify(m)),n("/auth/signup")},className:"btn-primary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all",children:"Get Started"}),e.jsx("button",{onClick:()=>g(!0),className:"btn-secondary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg border-2 border-gray-300 hover:border-gray-400 transition-all",children:"Request Free Demo"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-3 md:mt-4 text-center",children:"Secure payment â€¢ Cancel anytime"}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Free Demo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"We'll contact you to schedule a demo"})]}),e.jsxs("form",{onSubmit:x,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:c.name,onChange:m=>i({...c,name:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:c.email,onChange:m=>i({...c,email:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:c.company,onChange:m=>i({...c,company:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition",children:"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})})}function Ws(){const{user:t,logout:o}=ke(),[p,g]=s.useState([]),[c,i]=s.useState([]),[n,a]=s.useState([]),[x,m]=s.useState("cash"),[h,D]=s.useState("pos"),[r,P]=s.useState({sales:[],expenses:[],stats:{}}),[j,f]=s.useState(""),[S,y]=s.useState(!1),[$,N]=s.useState(!1),[L,w]=s.useState(null),[O,U]=s.useState({name:"",price:"",cost:"",category:"finished",image:""}),[C,b]=s.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[k,A]=s.useState(!1),[H,X]=s.useState({description:"",amount:"",category:""}),[oe,W]=s.useState(""),[he,ie]=s.useState([]),[J,q]=s.useState(null),[se,v]=s.useState("exclusive"),[z,R]=s.useState(!1),[ce,u]=s.useState(null),[I,_]=s.useState(null),[Y,ne]=s.useState(!1);s.useEffect(()=>{fe();const l=localStorage.getItem(`cart_${t?.id}`),T=localStorage.getItem(`paymentMethod_${t?.id}`),F=localStorage.getItem(`selectedDiscount_${t?.id}`),B=localStorage.getItem(`taxType_${t?.id}`),re=localStorage.getItem(`clockStatus_${t?.id}`),G=localStorage.getItem(`clockInTime_${t?.id}`);if(l)try{a(JSON.parse(l))}catch(xe){console.warn("Failed to restore cart:",xe)}if(T&&m(T),B&&v(B),F)try{q(JSON.parse(F))}catch{}re==="clocked_in"&&(R(!0),G&&_(new Date(G))),je()},[t?.id]),s.useEffect(()=>{const l=localStorage.getItem("token");l&&ct.connect(l,Q=>{if(Q&&Q.allProducts){const pe=Q.allProducts.filter(Ne=>Ne.visibleToCashier!==!1&&!Ne.expenseOnly);g(pe)}Q&&Q.discounts&&ie(Q.discounts),Q&&Q.sale&&fe()}).catch(Q=>{console.warn("WebSocket connection failed:",Q)});const T=ks(Q=>{try{if(!Q)return;(Q.type==="initial"||Q.type==="products_snapshot"||Q.type==="product_created"||Q.type==="product_updated"||Q.type==="product_deleted")&&be.getAll().then(pe=>g(pe.filter(Ne=>Ne.visibleToCashier!==!1&&!Ne.expenseOnly))).catch(()=>{})}catch(pe){console.error("Product subscription handler error",pe)}}),F=()=>{console.log("ðŸŽ‰ Product created event detected - refreshing product list"),be.getAll().then(Q=>g(Q.filter(pe=>pe.visibleToCashier!==!1&&!pe.expenseOnly))).catch(()=>{})},B=()=>{console.log("ðŸ“ Product updated event detected - refreshing product list"),be.getAll().then(Q=>g(Q.filter(pe=>pe.visibleToCashier!==!1&&!pe.expenseOnly))).catch(()=>{})},re=Q=>{const pe=Q.detail?.userId,Ne=t?.id;pe===Ne&&(console.log("ðŸ”’ Screen locked by admin"),ne(!0))},G=Q=>{const pe=Q.detail?.userId,Ne=t?.id;pe===Ne&&(console.log("ðŸ”“ Screen unlocked"),ne(!1))},xe=Q=>{console.log("ðŸ’° Sale created - refreshing inventory"),be.getAll().then(pe=>g(pe.filter(Ne=>Ne.visibleToCashier!==!1&&!Ne.expenseOnly))).catch(()=>{}),fe()};return window.addEventListener("productCreated",F),window.addEventListener("productUpdated",B),window.addEventListener("screenLocked",re),window.addEventListener("screenUnlocked",G),window.addEventListener("saleCreated",xe),()=>{try{T()}catch{}window.removeEventListener("productCreated",F),window.removeEventListener("productUpdated",B),window.removeEventListener("screenLocked",re),window.removeEventListener("screenUnlocked",G),window.removeEventListener("saleCreated",xe),ct.disconnect()}},[]),s.useEffect(()=>{(n.length>0||x||se)&&Z()},[n,x,se,J,t?.id]);const Z=()=>{localStorage.setItem(`cart_${t?.id}`,JSON.stringify(n)),localStorage.setItem(`paymentMethod_${t?.id}`,x),localStorage.setItem(`taxType_${t?.id}`,se),J&&localStorage.setItem(`selectedDiscount_${t?.id}`,JSON.stringify(J))},ae=async()=>{try{const l=await fetch(`${ue}/clock-in`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({})});if(l.ok){const T=await l.json();u(T),R(!0);const F=new Date;_(F),localStorage.setItem(`clockStatus_${t?.id}`,"clocked_in"),localStorage.setItem(`clockInTime_${t?.id}`,F.toISOString()),alert("â° Clocked in successfully! Your shift has started.")}else{const T=await l.json();alert(`âŒ Clock-in failed: ${T.error}`)}}catch(l){console.error("Clock in failed:",l),alert("Failed to clock in. Please check your connection.")}},de=async()=>{try{const l=await fetch(`${ue}/clock-out`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({})});if(l.ok){const T=await l.json();u(T),R(!1),_(null),localStorage.removeItem(`clockStatus_${t?.id}`),localStorage.removeItem(`clockInTime_${t?.id}`);const F=Math.floor(T.duration/60),B=T.duration%60;alert(`â° Clocked out successfully! Total time: ${F}h ${B}m`)}else{const T=await l.json();alert(`âŒ Clock-out failed: ${T.error}`)}}catch(l){console.error("Clock out failed:",l),alert("Failed to clock out. Please check your connection.")}},je=async()=>{try{const l=await fetch(`${ue}/time-entries/today`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(l.ok){const F=(await l.json()).find(B=>B.cashierId===t?.id&&B.status==="clocked_in");F&&(u(F),R(!0),_(new Date(F.clockInTime)))}}catch(l){console.warn("Failed to check clock status:",l)}},fe=async()=>{try{const[l,T,F,B,re]=await Promise.all([be.getAll(),ze.getAll(),nt.getAll(),Jt.get(),it.getAll()]);g(l.filter(G=>G.visibleToCashier!==!1&&!G.expenseOnly)),P({sales:T,expenses:F,stats:B}),i(re);try{const G=await fetch(`${ue}/discounts`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(xe=>xe.json());ie(G||[])}catch(G){console.warn("Failed to load discounts:",G)}}catch(l){console.error("Failed to load data:",l)}},Ae=(l,T=!0)=>{const F=l.target.files[0];if(F){const B=new FileReader;B.onload=re=>{const G=re.target.result;W(G),T&&U({...O,image:G})},B.readAsDataURL(F)}},me=l=>c.filter(F=>F.productId===l&&F.quantity>0).reduce((F,B)=>F+B.quantity,0),d=(l,T)=>!T||!l?l:["kg","g","gram","grams","kilogram","kilograms"].includes(T.toLowerCase())?l>=1?`${l.toFixed(2)}`:`${l.toFixed(3)}`.replace(/\.?0+$/,""):Math.round(l).toString(),E=l=>l.unit&&["kg","g","gram","grams","kilogram","kilograms"].includes(l.unit.toLowerCase()),M=l=>{const T=me(l.id);if(T<=0){alert("Product is out of stock!");return}const F=n.find(re=>re.id===l.id),B=F?F.quantity:0;if(E(l)){const re=prompt(`Enter quantity to add (${l.unit}):

Available: ${d(T,l.unit)} ${l.unit}
Current in cart: ${d(B,l.unit)} ${l.unit}`,"0.1");if(re===null)return;const G=parseFloat(re);if(isNaN(G)||G<=0){alert("Please enter a valid quantity");return}if(B+G>T){alert(`Only ${d(T-B,l.unit)} ${l.unit} more available!`);return}a(F?n.map(xe=>xe.id===l.id?{...xe,quantity:xe.quantity+G}:xe):[...n,{...l,quantity:G}])}else{if(B>=T){alert(`Only ${T} units available in stock!`);return}a(F?n.map(re=>re.id===l.id?{...re,quantity:re.quantity+1}:re):[...n,{...l,quantity:1}])}},te=(l,T)=>{const F=p.find(G=>G.id===l),B=me(l),re=n.find(G=>G.id===l);if(E(F)){const G=prompt(`Update quantity (${F.unit}):

Available: ${d(B,F.unit)} ${F.unit}`,d(re?.quantity||0,F.unit));if(G===null)return;const xe=parseFloat(G);if(isNaN(xe)||xe<=0){alert("Please enter a valid quantity");return}if(xe>B){alert(`Only ${d(B,F.unit)} ${F.unit} available!`);return}a(n.map(Q=>Q.id===l?{...Q,quantity:xe}:Q).filter(Q=>Q.quantity>0))}else a(n.map(G=>{if(G.id===l){const xe=G.quantity+T;return xe>B?(alert(`Only ${B} units available!`),G):{...G,quantity:Math.max(1,xe)}}return G}).filter(G=>G.quantity>0))},ee=l=>{a(n.filter(T=>T.id!==l))},K=n.reduce((l,T)=>l+T.price*T.quantity,0),Ce=async()=>{if(n.length!==0)try{const l=J?J.type==="percentage"?K*J.value/100:J.value:0,T=K*.16,F=se==="inclusive"?K-l:K-l+T;await ze.create({items:n.map(B=>({productId:B.id,quantity:B.quantity,price:B.price})),total:F,discount:l,tax:T,taxType:se,paymentMethod:x}),a([]),q(null),v("exclusive"),await fe(),alert("Sale completed successfully!")}catch(l){console.error("Checkout failed:",l),alert("Sale failed. Please try again.")}},Se=async l=>{l.preventDefault();try{await be.create({...O,price:parseFloat(O.price),cost:parseFloat(O.cost||0),quantity:0}),U({name:"",price:"",cost:"",category:"finished",image:""}),W(""),y(!1),await fe(),alert("Product added successfully!")}catch(T){console.error("Failed to add product:",T),alert("Failed to add product")}},Ke=async l=>{l.preventDefault();try{const T=Array.isArray(c)?c:[],B={id:T.length>0?Math.max(...T.map(re=>re.id||0))+1:1,productId:L.id,quantity:parseInt(C.quantity),expiryDate:C.expiryDate,batchNumber:C.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(C.cost||L.cost||0)};i(re=>[...re,B]),await it.create({productId:L.id,quantity:parseInt(C.quantity),expiryDate:C.expiryDate,batchNumber:C.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(C.cost||L.cost||0)}),b({quantity:"",expiryDate:"",batchNumber:"",cost:""}),N(!1),w(null),await fe(),alert("Stock added successfully!")}catch(T){console.error("Failed to add stock:",T),alert("Failed to add stock")}},ot=async l=>{l.preventDefault();try{await nt.create({...H,amount:parseFloat(H.amount)}),X({description:"",amount:"",category:""}),A(!1),await fe()}catch(T){console.error("Failed to add expense:",T),alert("Failed to add expense")}},Ve=async()=>{if(window.confirm("Are you sure you want to clear all sales and data? This action cannot be undone."))try{const l=localStorage.getItem("token");if(!l){alert("âŒ Not authenticated. Please login again.");return}const F=await fetch(`${ue}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!F.ok){const B=await F.json();throw new Error(B.message||"Failed to clear data")}localStorage.removeItem("sales"),localStorage.removeItem("expenses"),localStorage.removeItem("products"),localStorage.removeItem("cart"),P({sales:[],expenses:[],stats:{totalSales:0,totalExpenses:0,profit:0},products:[]}),a([]),setActiveTab("dashboard"),window.dispatchEvent(new Event("dataCleared")),window.dispatchEvent(new Event("storage")),alert("âœ… Data cleared successfully! Refreshing..."),setTimeout(()=>{window.location.href="/dashboard/cashier"},500)}catch(l){console.error("Failed to clear data:",l),alert("âŒ Failed to clear data: "+l.message)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[Y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("svg",{className:"w-12 h-12 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm6-10V7a3 3 0 00-3-3m3 3V7a3 3 0 013 3m-6-3a3 3 0 013-3m0 0V7m0 0a3 3 0 00-3 3m6-3V7m0 0a3 3 0 00-3 3"})})}),e.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"Screen Locked"}),e.jsx("p",{className:"text-xl text-gray-300 mb-2",children:"Your account has been locked by the administrator"}),e.jsx("p",{className:"text-gray-400 mb-8",children:"Please contact your administrator to unlock your account"}),e.jsx("button",{onClick:o,className:"px-6 py-3 bg-white text-red-600 font-bold rounded-lg hover:bg-gray-100 transition",children:"Logout"})]})}),e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Cashier Dashboard"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cashier Plan - KSH 900/month"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),z&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-green-600 font-semibold",children:"ðŸŸ¢ Clocked In"}),e.jsxs("button",{onClick:de,className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-600 hover:bg-red-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(hs,{className:"w-4 h-4"}),"Clock Out"]})]}),!z&&e.jsxs("button",{onClick:ae,className:"px-4 py-2 rounded-lg font-medium transition-all bg-green-600 hover:bg-green-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(Rt,{className:"w-4 h-4"}),"Clock In"]}),e.jsxs("button",{onClick:()=>{Z(),o()},className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-100 hover:bg-red-200 text-red-600 border border-red-300 flex items-center gap-2",children:[e.jsx(jt,{className:"w-4 h-4"}),"Logout"]}),e.jsxs("button",{onClick:Ve,className:"px-4 py-2 rounded-lg font-medium transition-all bg-orange-100 hover:bg-orange-200 text-orange-600 border border-orange-300 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Clear"]}),z&&I&&e.jsx("div",{className:"ml-auto text-right text-xs",children:e.jsxs("p",{className:"text-green-600 font-semibold flex items-center gap-1",children:[e.jsx(He,{className:"w-4 h-4"}),"Clocked In: ",I.toLocaleTimeString()]})})]})]})}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>D("pos"),className:`px-6 py-2 rounded-lg font-medium transition-all ${h==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Xe,{className:"w-4 h-4 inline mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>D("monitor"),className:`px-6 py-2 rounded-lg font-medium transition-all ${h==="monitor"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(pt,{className:"w-4 h-4 inline mr-2"}),"Monitor"]}),e.jsxs("button",{onClick:()=>D("products"),className:`px-6 py-2 rounded-lg font-medium transition-all ${h==="products"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(_e,{className:"w-4 h-4 inline mr-2"}),"Products"]}),e.jsxs("button",{onClick:()=>D("expenses"),className:`px-6 py-2 rounded-lg font-medium transition-all ${h==="expenses"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(tt,{className:"w-4 h-4 inline mr-2"}),"Expenses"]})]}),h==="pos"&&e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(gt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:j,onChange:l=>f(l.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:p.filter(l=>l.name?.toLowerCase().includes(j.toLowerCase())).map(l=>{const T=me(l.id),F=T<10,B=T<=0;return e.jsxs("button",{onClick:()=>M(l),disabled:B,className:`card text-left hover:shadow-xl transition-all transform hover:scale-105 relative ${B?"opacity-50 cursor-not-allowed bg-gray-100":"bg-gradient-to-br from-white to-gray-50"}`,children:[l.image&&e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:l.image,alt:l.name,className:"w-full h-full object-cover"})}),F&&!B&&e.jsx("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white p-1 rounded-full",children:e.jsx($e,{className:"w-4 h-4"})}),B&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"OUT"}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-900",children:l.name}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["KSH ",l.price?.toLocaleString()]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:`text-xs font-medium ${B?"text-red-600":F?"text-yellow-600":"text-gray-500"}`,children:["Stock: ",T]}),F&&!B&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium",children:"Low Stock"})]})]},l.id)})})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-gray-200 p-6 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(Xe,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[n.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:n.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(Xe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:n.map(l=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:l.name}),e.jsx("button",{onClick:()=>ee(l.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(Pe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>te(l.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(ps,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-12 text-center font-semibold text-sm",children:d(l.quantity,l.unit)}),e.jsx("span",{className:"text-xs text-gray-600 w-8",children:l.unit}),e.jsx("button",{onClick:()=>te(l.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(ye,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(l.price*l.quantity).toLocaleString()]})]})]},l.id))})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"text-gray-700",children:["KSH ",K.toLocaleString()]})]}),J&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-KSH ",(J.type==="percentage"?K*J.value/100:J.value).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-orange-600",children:[e.jsxs("span",{children:["Tax (",se==="exclusive"?"Added":"Included","):"]}),e.jsxs("span",{children:[se==="exclusive"?"+":"","KSH ",((K-(J?J.type==="percentage"?K*J.value/100:J.value:0))*.16).toLocaleString()]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Final Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(se==="exclusive"?K-(J?J.type==="percentage"?K*J.value/100:J.value:0)+(K-(J?J.type==="percentage"?K*J.value/100:J.value:0))*.16:K-(J?J.type==="percentage"?K*J.value/100:J.value:0)).toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Discount (Optional)"}),e.jsxs("select",{value:J?.id||"",onChange:l=>{l.target.value?q(he.find(T=>T.id===parseInt(l.target.value))):q(null)},className:"input",children:[e.jsx("option",{value:"",children:"No Discount"}),he.filter(l=>l.active).map(l=>e.jsxs("option",{value:l.id,children:[l.name," - ",l.type==="percentage"?`${l.value}%`:`KSH ${l.value}`]},l.id))]}),J&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Discount: KSH ",(J.type==="percentage"?K*J.value/100:J.value).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tax Type"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"exclusive",checked:se==="exclusive",onChange:l=>v(l.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Exclusive (16% added)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"inclusive",checked:se==="inclusive",onChange:l=>v(l.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Inclusive"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:x,onChange:l=>m(l.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:Ce,disabled:n.length===0,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg",children:"Complete Sale"})]})]})]}),h==="monitor"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",r.stats.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Te,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",r.stats.totalExpenses?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(tt,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",r.stats.profit?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Te,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Sales"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"})]})}),e.jsx("tbody",{children:r.sales.slice(-15).reverse().map((l,T)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(l.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[l.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:l.paymentMethod||"cash"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",l.total?.toLocaleString()]})]},T))})]})})]})]}),h==="products"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Manage Products & Stock"}),e.jsxs("button",{onClick:()=>y(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700",children:[e.jsx(ye,{className:"w-4 h-4"}),"Add Product"]})]}),S&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl border-2 border-green-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Product"}),e.jsxs("form",{onSubmit:Se,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:O.name,onChange:l=>U({...O,name:l.target.value}),required:!0}),e.jsxs("select",{className:"input",value:O.category,onChange:l=>U({...O,category:l.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsx("input",{type:"number",placeholder:"Selling Price",className:"input",value:O.price,onChange:l=>U({...O,price:l.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Cost Price (Optional)",className:"input",value:O.cost,onChange:l=>U({...O,cost:l.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:l=>Ae(l,!0),className:"input"}),e.jsx(Tt,{className:"w-5 h-5 text-gray-400"})]}),oe&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:oe,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{y(!1),W(""),U({name:"",price:"",cost:"",category:"finished",image:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),$&&L&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"font-semibold mb-4 text-lg",children:["Add Stock for ",L.name]}),e.jsxs("form",{onSubmit:Ke,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:C.quantity,onChange:l=>b({...C,quantity:l.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:C.expiryDate,onChange:l=>b({...C,expiryDate:l.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:C.batchNumber,onChange:l=>b({...C,batchNumber:l.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per Unit",className:"input",value:C.cost,onChange:l=>b({...C,cost:l.target.value})}),e.jsxs("div",{className:"flex gap-2 md:col-span-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{N(!1),w(null),b({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:p.map(l=>{const T=me(l.id),F=c.filter(re=>re.productId===l.id&&re.quantity>0),B=T<10;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[l.image&&e.jsx("img",{src:l.image,alt:l.name,className:"w-10 h-10 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:l.name}),e.jsx("div",{className:"text-xs text-gray-500",children:l.category})]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",l.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium ${T===0?"text-red-600":B?"text-yellow-600":"text-gray-900"}`,children:T}),B&&T>0&&e.jsx($e,{className:"w-4 h-4 text-yellow-500"}),T===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"text-gray-600",children:[F.length," active"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{w(l),N(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-green-50 rounded-lg text-green-600 transition-colors",title:"Edit Product",children:e.jsx(Ie,{className:"w-4 h-4"})})]})})]},l.id)})})]})})]})}),h==="expenses"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Track Expenses"}),e.jsxs("button",{onClick:()=>A(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700",children:[e.jsx(ye,{className:"w-4 h-4"}),"Add Expense"]})]}),k&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border-2 border-red-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Expense"}),e.jsxs("form",{onSubmit:ot,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:H.description,onChange:l=>X({...H,description:l.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Amount",className:"input",value:H.amount,onChange:l=>X({...H,amount:l.target.value}),required:!0}),e.jsx("input",{type:"text",placeholder:"Category",className:"input",value:H.category,onChange:l=>X({...H,category:l.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>A(!1),className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:r.expenses.slice().reverse().map((l,T)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(l.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:l.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:l.category||"General"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",l.amount?.toLocaleString()]})]},T))})]})})]})})]})}function Gs(){const[t,o]=s.useState([]),[p,g]=s.useState([]),[c,i]=s.useState("all"),[n,a]=s.useState(""),[x,m]=s.useState(!1),[h,D]=s.useState(!1),[r,P]=s.useState([]),[j,f]=s.useState({subject:"",message:""}),[S,y]=s.useState(!0),[$,N]=s.useState(null),[L,w]=s.useState(!0),[O,U]=s.useState(null),[C,b]=s.useState([]),k=Ue(),[A,H]=s.useState({totalUsers:0,activeUsers:0,lockedUsers:0,totalRevenue:0,pendingPayments:0,overduePayments:0,activeDays:0,downDays:0}),[X,oe]=s.useState([]);s.useEffect(()=>{const u=localStorage.getItem("mainAdminToken"),I=localStorage.getItem("mainAdminUser");if(!u||!I){k("/main-admin/login");return}W().finally(()=>y(!1));const _=JSON.parse(localStorage.getItem("authActivities")||"[]");oe(_.slice(0,10));const Y=JSON.parse(localStorage.getItem("adminReminders")||"[]");b(Y.filter(ae=>ae.status==="pending"));const ne=ae=>{const de=ae.detail;b(je=>[de,...je])};window.addEventListener("subscriptionReminderCreated",ne);const Z=setInterval(()=>{const ae=JSON.parse(localStorage.getItem("authActivities")||"[]");oe(ae.slice(0,10));const de=JSON.parse(localStorage.getItem("adminReminders")||"[]");b(de.filter(je=>je.status==="pending"))},5e3);return()=>{clearInterval(Z),window.removeEventListener("subscriptionReminderCreated",ne)}},[k]);const W=async()=>{try{N(null);let u=[],I=[],_=!0;try{u=await Qe.getUsers(),I=await Qe.getPayments()}catch(Y){console.warn("MainAdmin API not available, falling back to regular users API:",Y.message);try{u=await De.getAll()}catch(ne){console.warn("Users API also failed:",ne.message),_=!1}_||(I=[],w(!1))}u.length===0&&!_&&(u=ie(),I=J(u)),o(u),g(I),w(_),q(u,I)}catch(u){console.error("Failed to load data:",u),N("Failed to load dashboard data");const I=ie();o(I),g(J(I)),w(!1),q(I,[])}},he=()=>{localStorage.removeItem("mainAdminToken"),localStorage.removeItem("mainAdminUser"),k("/main-admin/login")},ie=()=>{const u=localStorage.getItem("user"),I=[];if(u){const Y=JSON.parse(u);I.push({...Y,id:Y.id||"real-user"})}return[{name:"John Doe",email:"john@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Jane Smith",email:"jane@example.com",plan:"basic",price:900,active:!0,locked:!1,role:"cashier"},{name:"Bob Wilson",email:"bob@example.com",plan:"ultra",price:1600,active:!1,locked:!1,role:"admin"},{name:"Alice Brown",email:"alice@example.com",plan:"basic",price:900,active:!0,locked:!0,role:"cashier"},{name:"Mike Johnson",email:"mike@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Sarah Davis",email:"sarah@example.com",plan:"basic",price:900,active:!1,locked:!1,role:"cashier"}].forEach((Y,ne)=>{I.push({id:`demo-${ne+1}`,...Y,createdAt:new Date(Date.now()-ne*864e5).toISOString(),lastLogin:new Date(Date.now()-Math.random()*864e5).toISOString()})}),I},J=u=>u.flatMap(I=>[{id:`payment-${I.id}-1`,userId:I.id,amount:I.plan==="ultra"?1600:900,status:Math.random()>.3?"paid":"pending",createdAt:new Date(Date.now()-30*864e5).toISOString(),dueDate:new Date(Date.now()+5*864e5).toISOString()},{id:`payment-${I.id}-2`,userId:I.id,amount:I.plan==="ultra"?1600:900,status:Math.random()>.7?"paid":Math.random()>.5?"pending":"overdue",createdAt:new Date(Date.now()-60*864e5).toISOString(),dueDate:new Date(Date.now()-5*864e5).toISOString()}]),q=(u,I)=>{const _=u.length,Y=u.filter(me=>me.active).length,ne=u.filter(me=>me.locked).length,Z=I.filter(me=>me.status==="paid").reduce((me,d)=>me+d.amount,0),ae=I.filter(me=>me.status==="pending").length,de=I.filter(me=>me.status==="overdue").length,je=localStorage.getItem("appCreatedDate");let fe=0,Ae=0;if(je){const me=new Date(je),E=Math.floor((new Date-me)/(1e3*60*60*24)),M=parseFloat(localStorage.getItem("uptimePercentage")||"99.5");fe=Math.floor(E*M/100),Ae=E-fe}else localStorage.setItem("appCreatedDate",new Date().toISOString()),fe=0,Ae=0;H({totalUsers:_,activeUsers:Y,lockedUsers:ne,totalRevenue:Z,pendingPayments:ae,overduePayments:de,activeDays:fe,downDays:Ae})},se=async(u,I)=>{try{U(u);const _=!I;try{if(await Qe.lockUser(u,_),_){const ae=t.find(de=>de.id===u);if(localStorage.setItem(`lockNotification_${u}`,JSON.stringify({type:"account_locked",message:"Your account has been locked by the system administrator.",lockedAt:new Date().toISOString(),reason:"Admin account lock"})),ae){const de={id:Date.now(),type:"subscription_renewal",title:"Subscription Renewal Notice",description:`Account for ${ae.name} (${ae.email}) has been locked. Plan: ${ae.plan?.toUpperCase()||"UNKNOWN"} - ${ae.price?"KSH "+ae.price:"Free"}. Please contact user to renew subscription.`,priority:"high",targetUser:ae.name,targetEmail:ae.email,dueDate:new Date(Date.now()+2592e5).toISOString(),createdAt:new Date().toISOString(),status:"pending"},je=JSON.parse(localStorage.getItem("adminReminders")||"[]");je.push(de),localStorage.setItem("adminReminders",JSON.stringify(je)),window.dispatchEvent(new CustomEvent("subscriptionReminderCreated",{detail:de}))}window.dispatchEvent(new CustomEvent("accountLocked",{detail:{userId:u}}))}const Y=t.map(ae=>ae.id===u?{...ae,locked:_,active:!_}:ae);o(Y),q(Y,p);const ne=t.find(ae=>ae.id===u),Z=_?"locked":"unlocked";alert(`âœ… ${ne?.name||`User ${u}`} has been ${Z} successfully!${_?" Subscription renewal reminder created and user will be logged out immediately.":""}`)}catch(Y){console.error("API lock failed:",Y);const ne=t.map(de=>de.id===u?{...de,locked:_,active:!_}:de);o(ne),q(ne,p);const Z=t.find(de=>de.id===u),ae=_?"locked":"unlocked";alert(`âš ï¸ Backend not available. ${Z?.name||`User ${u}`} ${ae} locally. Changes will sync when backend is available.`)}}catch(_){console.error("Failed to toggle lock:",_),alert(`âŒ Failed to update user status: ${_.message}`)}finally{U(null)}},v=async(u,I,_)=>{try{y(!0);try{await Qe.sendEmail({userIds:u,subject:I,message:_}),alert("Emails sent successfully!"),m(!1),P([]),f({subject:"",message:""});return}catch(Z){console.warn("Backend email operation failed, simulating email send:",Z.message)}const Y=t.filter(Z=>u.includes(Z.id)),ne=JSON.parse(localStorage.getItem("emailLogs")||"[]");ne.push({timestamp:new Date().toISOString(),recipients:Y.map(Z=>({id:Z.id,name:Z.name,email:Z.email})),subject:I,message:_,status:"simulated"}),localStorage.setItem("emailLogs",JSON.stringify(ne)),alert(`âœ… Email simulation successful!

ðŸ“§ Sent to ${Y.length} user(s):
${Y.map(Z=>`${Z.name} (${Z.email})`).join(`
`)}

${L?"":`ðŸ“Œ Backend not deployed - this was a simulation.
`}ðŸ’¡ Deploy backend to send real emails.`),m(!1),P([]),f({subject:"",message:""})}catch(Y){console.error("Failed to send email:",Y),alert("Failed to process email request.")}finally{y(!1)}},z=async u=>{const I=t.find(_=>_.id===u);I&&await v([u],"Payment Reminder - Subscription",`Dear ${I.name},

This is a friendly reminder about your pending subscription payment for ${I.plan?.toUpperCase()} plan (KSH ${I.price}).

Please complete your payment to continue enjoying our services.

Thank you!`)},R=t.filter(u=>{const I=u.name?.toLowerCase().includes(n.toLowerCase())||u.email?.toLowerCase().includes(n.toLowerCase());if(c==="all")return I;if(c==="active")return I&&u.active&&!u.locked;if(c==="locked")return I&&u.locked;if(c==="trial")return I&&(!u.active||!u.plan);if(c==="pending-payment"){const _=p.filter(Y=>Y.userId===u.id&&Y.status==="pending");return I&&_.length>0}if(c==="overdue"){const _=p.filter(Y=>Y.userId===u.id&&Y.status==="overdue");return I&&_.length>0}return I}),ce=u=>{const I=p.filter(Z=>Z.userId===u),_=I.filter(Z=>Z.status==="pending").length,Y=I.filter(Z=>Z.status==="overdue").length,ne=I.filter(Z=>Z.status==="paid").length;return{pending:_,overdue:Y,paid:ne,total:I.length}};return S&&t.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-white mx-auto mb-4"}),e.jsx("p",{className:"text-white text-xl",children:"Loading Main Admin Dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900",children:[!L&&e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm md:text-base font-semibold",children:["âš ï¸ Demo Mode: Backend not available. Actions are simulated locally.",e.jsx("a",{href:"/BACKEND_NOT_DEPLOYED.md",className:"underline ml-2",children:"Deploy Backend â†’"})]})}),$&&e.jsx("div",{className:"bg-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm font-semibold",children:["âš ï¸ ",$]})}),C.length>0&&e.jsx("div",{className:"bg-gradient-to-r from-orange-500/20 to-red-500/20 border-l-4 border-orange-500 px-6 py-4 mx-6 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx($e,{className:"w-5 h-5 text-orange-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-white font-bold mb-2",children:[C.length," Subscription Renewal Reminder",C.length!==1?"s":""]}),e.jsx("div",{className:"space-y-2",children:C.slice(0,3).map(u=>e.jsxs("p",{className:"text-orange-100 text-sm",children:["â€¢ ",e.jsx("span",{className:"font-semibold",children:u.targetUser})," (",u.targetEmail,") - ",u.description.split("-")[1]?.trim()]},u.id))}),C.length>3&&e.jsxs("p",{className:"text-orange-100 text-sm mt-2",children:["... and ",C.length-3," more pending reminder",C.length-3!==1?"s":""]})]})]})}),$&&e.jsx("div",{className:"bg-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm font-semibold",children:["âš ï¸ ",$]})}),e.jsx("header",{className:"bg-black/30 backdrop-blur-lg border-b border-white/10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Main Admin Dashboard"}),e.jsx("p",{className:"text-gray-300",children:"Monitor all users, payments, and system activity"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>D(!0),className:"flex items-center gap-2 bg-green-500/20 hover:bg-green-500/30 text-green-300 px-4 py-2 rounded-lg transition-colors",children:[e.jsx(Me,{className:"w-4 h-4"}),"View Analytics"]}),e.jsxs("button",{onClick:he,className:"flex items-center gap-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 px-4 py-2 rounded-lg transition-colors",children:[e.jsx(jt,{className:"w-4 h-4"}),"Logout"]})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Oe,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:A.totalUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Le,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:A.activeUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Active Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(we,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:A.lockedUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Locked Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Te,{className:"w-8 h-8 text-yellow-400"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:["KSH ",A.totalRevenue.toLocaleString()]})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx($e,{className:"w-8 h-8 text-orange-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:A.pendingPayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Pending Payments"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(lt,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:A.overduePayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Overdue Payments"})]})]}),e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 flex-1 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-80",children:[e.jsx(gt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",value:n,onChange:u=>a(u.target.value)})]}),e.jsxs("select",{value:c,onChange:u=>i(u.target.value),className:"px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"locked",children:"Locked"}),e.jsx("option",{value:"trial",children:"Free Trial"}),e.jsx("option",{value:"pending-payment",children:"Pending Payment"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsxs("button",{onClick:()=>m(!0),disabled:r.length===0||S,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-3 rounded-lg font-bold flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(et,{className:"w-5 h-5"}),"Send Email to Selected (",r.length,")"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"xl:col-span-2 bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"All Users"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left",children:e.jsx("input",{type:"checkbox",checked:r.length===R.length&&R.length>0,onChange:u=>{u.target.checked?P(R.map(I=>I.id)):P([])},className:"w-5 h-5 rounded"})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Trial Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Signup Details"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Actions"})]})}),e.jsxs("tbody",{children:[R.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"px-4 py-12 text-center",children:[e.jsx(Oe,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:n||c!=="all"?"Try adjusting your filters":"Users will appear here once they sign up"})]})}),R.map(u=>(ce(u.id),e.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:r.includes(u.id),onChange:I=>{I.target.checked?P([...r,u.id]):P(r.filter(_=>_!==u.id))},className:"w-5 h-5 rounded"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[u.profilePicture?e.jsx("img",{src:u.profilePicture,alt:u.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:u.name?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:u.name}),e.jsx("p",{className:"text-sm text-gray-400",children:u.email})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${u.plan==="ultra"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"}`,children:[u.plan?.toUpperCase()||"FREE"," ",u.price?`- KSH ${u.price}`:""]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"flex flex-col gap-1",children:u.plan==="trial"||!u.plan||u.isFreeTrial?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"px-2 py-1 rounded text-xs font-bold bg-yellow-500/20 text-yellow-300",children:"FREE TRIAL"}),u.trialDaysLeft!==void 0&&e.jsxs("span",{className:"text-xs text-gray-400",children:[u.trialDaysLeft," days left"]}),u.trialExpiry&&e.jsxs("span",{className:"text-xs text-gray-400",children:["Expires: ",new Date(u.trialExpiry).toLocaleDateString()]})]}):e.jsx("span",{className:"px-2 py-1 rounded text-xs font-bold bg-green-500/20 text-green-300",children:"PAID PLAN"})})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{className:"font-semibold text-gray-300",children:["Joined: ",new Date(u.createdAt).toLocaleDateString()]}),u.signupDetails?.company&&e.jsxs("div",{className:"text-gray-400",children:[e.jsx("span",{className:"text-gray-500",children:"Co:"})," ",u.signupDetails.company]}),u.signupDetails?.industry&&e.jsxs("div",{className:"text-gray-400",children:[e.jsx("span",{className:"text-gray-500",children:"Industry:"})," ",u.signupDetails.industry]}),u.signupDetails?.country&&e.jsxs("div",{className:"text-gray-400",children:[e.jsx("span",{className:"text-gray-500",children:"Country:"})," ",u.signupDetails.country]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"flex items-center gap-2",children:u.locked?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-300 flex items-center gap-1",children:[e.jsx(we,{className:"w-3 h-3"}),"Locked"]}):u.active?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-300 flex items-center gap-1",children:[e.jsx(Le,{className:"w-3 h-3"}),"Active"]}):e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-500/20 text-gray-300",children:"Inactive"})})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>se(u.id,u.locked),disabled:O===u.id,className:`p-2 rounded-lg transition ${u.locked?"bg-green-500/20 hover:bg-green-500/30 text-green-300":"bg-red-500/20 hover:bg-red-500/30 text-red-300"} ${O===u.id?"opacity-50 cursor-not-allowed":""}`,title:u.locked?"Unlock User":"Lock User",children:O===u.id?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):u.locked?e.jsx(gs,{className:"w-4 h-4"}):e.jsx(we,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("screenLocked",{detail:{userId:u.id}})),alert(`âœ… Screen lock triggered for ${u.name}. Their screen will be locked immediately.`)},className:"p-2 rounded-lg bg-orange-500/20 hover:bg-orange-500/30 text-orange-300 transition",title:"Lock Screen (Prevents user interaction)",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm6-10V7a3 3 0 00-3-3m3 3V7a3 3 0 013 3m-6-3a3 3 0 013-3m0 0V7m0 0a3 3 0 00-3 3m6-3V7m0 0a3 3 0 00-3 3"})})}),e.jsx("button",{onClick:()=>z(u.id),disabled:S,className:"p-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 transition",title:"Send Payment Reminder",children:e.jsx(Ot,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{u.role==="cashier"?window.open("/dashboard/cashier","_blank"):window.open("/admin","_blank")},className:"p-2 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 transition",title:"View User Dashboard",children:e.jsx(Me,{className:"w-4 h-4"})})]})})]},u.id)))]})]})})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl border border-white/20",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5"}),"Recent Activity"]})}),e.jsx("div",{className:"p-4 space-y-3 max-h-96 overflow-y-auto",children:X.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"No recent activity"}):X.map(u=>e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${u.type==="login"?"bg-green-400":"bg-blue-400"}`}),e.jsx("span",{className:"text-white font-medium",children:u.user.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${u.type==="login"?"bg-green-500/20 text-green-300":"bg-blue-500/20 text-blue-300"}`,children:u.type})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:u.user.email}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:new Date(u.timestamp).toLocaleString()})]},u.id))})]})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-purple-900 rounded-2xl shadow-2xl max-w-2xl w-full border border-white/20",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(et,{}),"Send Email to ",r.length," User(s)"]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Subject"}),e.jsx("input",{type:"text",value:j.subject,onChange:u=>f({...j,subject:u.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email subject..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Message"}),e.jsx("textarea",{value:j.message,onChange:u=>f({...j,message:u.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 h-40",placeholder:"Email message..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>v(r,j.subject,j.message),disabled:S,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white py-3 rounded-lg font-bold transition disabled:opacity-50",children:S?"Sending...":"Send Email"}),e.jsx("button",{onClick:()=>m(!1),className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-lg font-bold transition",children:"Cancel"})]})]})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-purple-900 rounded-2xl shadow-2xl max-w-2xl w-full border border-white/20",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5"}),"Website Analytics & Uptime"]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-white/10 rounded-lg p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center",children:e.jsx(Le,{className:"w-6 h-6 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Active Days"}),e.jsx("p",{className:"text-3xl font-bold text-white",children:A.activeDays})]})]})}),e.jsx("div",{className:"bg-white/10 rounded-lg p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-red-500/20 rounded-lg flex items-center justify-center",children:e.jsx(lt,{className:"w-6 h-6 text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Down Days"}),e.jsx("p",{className:"text-3xl font-bold text-white",children:A.downDays})]})]})})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-6 border border-white/20",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"System Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"Uptime Percentage"}),e.jsxs("span",{className:"text-2xl font-bold text-green-400",children:[parseFloat(localStorage.getItem("uptimePercentage")||"99.5").toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full",style:{width:`${parseFloat(localStorage.getItem("uptimePercentage")||"99.5")}%`}})})]})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-6 border border-white/20",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Key Metrics"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"Total Users"}),e.jsx("span",{className:"text-white font-semibold",children:A.totalUsers})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"Active Users"}),e.jsx("span",{className:"text-green-400 font-semibold",children:A.activeUsers})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"Total Revenue"}),e.jsxs("span",{className:"text-yellow-400 font-semibold",children:["KSH ",A.totalRevenue.toLocaleString()]})]})]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>D(!1),className:"flex-1 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white py-3 rounded-lg font-bold transition",children:"Close"})})]})]})})]})}function xt({children:t,adminOnly:o=!1,ultraOnly:p=!1,ownerOnly:g=!1}){const{user:c,loading:i}=ke(),[n,a]=s.useState(!1),x=Gt(6e4),m=x?.[0]||!1,h=x?.[1]||(()=>{}),[D,r]=s.useState({});if(s.useEffect(()=>{c&&!g&&((async()=>{try{const f=localStorage.getItem("token"),y=await fetch(`${ue}/settings`,{headers:{Authorization:`Bearer ${f}`}});if(y.ok){const $=await y.json();r($)}}catch(f){console.error("Failed to load settings:",f)}})(),a(!0))},[c,g]),i&&!g)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(g){const j=localStorage.getItem("ownerToken"),f=localStorage.getItem("ownerUser");if(!j||!f)return e.jsx(ge,{to:"/main.admin"});try{if(JSON.parse(f).type!=="main_admin")return e.jsx(ge,{to:"/main.admin"})}catch{return e.jsx(ge,{to:"/main.admin"})}}else{if(!c)return e.jsx(ge,{to:"/auth/login"});if(!c.active)return e.jsx(ge,{to:"/plans"});if(o&&c.role!=="admin")return e.jsx(ge,{to:"/dashboard"});if(p&&(c.role!=="admin"||c.plan!=="ultra"))return e.jsx(ge,{to:"/dashboard"})}const P=g?"owner":"user";return e.jsxs(e.Fragment,{children:[m&&e.jsx(Wt,{onUnlock:h,userType:P}),n&&e.jsx(Vt,{onClose:()=>a(!1)}),t]})}function Ys(){const{user:t}=ke();return!t||!t.active?e.jsx(ge,{to:"/plans"}):t.role==="admin"?e.jsx(ge,{to:"/admin"}):e.jsx(ge,{to:"/dashboard/cashier"})}function Qs(){return e.jsx(Ps,{children:e.jsx(Ds,{children:e.jsx(Zt,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(Et,{children:[e.jsx(le,{path:"/",element:e.jsx(Ks,{})}),e.jsx(le,{path:"/auth/login",element:e.jsx(Dt,{})}),e.jsx(le,{path:"/auth/signup",element:e.jsx(Dt,{})}),e.jsx(le,{path:"/plans",element:e.jsx(Vs,{})}),e.jsx(le,{path:"/main.admin/*",element:e.jsx(Gs,{})}),e.jsx(le,{path:"/dashboard",element:e.jsx(xt,{children:e.jsx(Ys,{})})}),e.jsx(le,{path:"/dashboard/cashier",element:e.jsx(xt,{children:e.jsx(Ws,{})})}),e.jsx(le,{path:"/admin/*",element:e.jsx(xt,{adminOnly:!0,children:e.jsx(Hs,{})})}),e.jsx(le,{path:"/login",element:e.jsx(ge,{to:"/auth/login"})}),e.jsx(le,{path:"/signup",element:e.jsx(ge,{to:"/auth/signup"})}),e.jsx(le,{path:"/subscription",element:e.jsx(ge,{to:"/plans"})}),e.jsx(le,{path:"/payment",element:e.jsx(ge,{to:"/plans"})}),e.jsx(le,{path:"/cashier",element:e.jsx(ge,{to:"/dashboard/cashier"})})]})})})})}Ns.createRoot(document.getElementById("root")).render(e.jsx(es.StrictMode,{children:e.jsx(Qs,{})}));
