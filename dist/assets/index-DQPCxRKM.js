import{a as Jt,b as Kt,g as Wt,r as a,u as ke,c as St,R as kt,d as z,B as Gt,N as te,e as Vt}from"./vendor-Ct1st1Nj.js";import{C as Me,D as ye,T as Ae,P as Ne,S as Ct,a as Be,b as mt,c as ie,d as Yt,e as Qt,f as Ie,g as ve,h as xe,i as Pt,j as Zt,k as At,l as Xt,L as ne,U as gt,m as ft,n as _e,E as Dt,M as bt,o as we,X as Se,p as Le,q as Re,r as xt,s as He,t as jt,u as ze,B as ut,R as es,I as ts,v as Je,w as it,x as Ee,y as ct,z as ss,A as It,F as as,G as rs,H as ls,J as ht,K as ns,N as $e,O as Et,Q as ot,V as Tt,Z as Lt,W as dt,Y as is,_ as cs,$ as os,a0 as ds,a1 as ms}from"./icons-CjAbPccD.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))h(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&h(n)}).observe(document,{childList:!0,subtree:!0});function g(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function h(l){if(l.ep)return;l.ep=!0;const r=g(l);fetch(l.href,r)}})();var rt={exports:{}},Pe={};var yt;function xs(){if(yt)return Pe;yt=1;var t=Jt(),c=Symbol.for("react.element"),g=Symbol.for("react.fragment"),h=Object.prototype.hasOwnProperty,l=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function n(u,f,m){var N,v={},i=null,$=null;m!==void 0&&(i=""+m),f.key!==void 0&&(i=""+f.key),f.ref!==void 0&&($=f.ref);for(N in f)h.call(f,N)&&!r.hasOwnProperty(N)&&(v[N]=f[N]);if(u&&u.defaultProps)for(N in f=u.defaultProps,f)v[N]===void 0&&(v[N]=f[N]);return{$$typeof:c,type:u,key:i,ref:$,props:v,_owner:l.current}}return Pe.Fragment=g,Pe.jsx=n,Pe.jsxs=n,Pe}var Nt;function us(){return Nt||(Nt=1,rt.exports=xs()),rt.exports}var e=us(),Oe={},vt;function hs(){if(vt)return Oe;vt=1;var t=Kt();return Oe.createRoot=t.createRoot,Oe.hydrateRoot=t.hydrateRoot,Oe}var ps=hs();const gs=Wt(ps),fs=()=>"https://posifine22.onrender.com/api",J=fs(),$t=()=>localStorage.getItem("token"),Ot=async(t,c={},g=0,h=3)=>{const l=$t(),r=t.startsWith("/")?t:`/${t}`,n={...c,headers:{"Content-Type":"application/json",...l&&!(r.startsWith("/auth")&&r!=="/auth/me")&&!r.includes("/main-admin/auth/login")&&{Authorization:`Bearer ${l}`},...c.headers}};try{const u=await fetch(`${J}${r}`,n);if(u.status===401){if(r.includes("/auth/login")||r.includes("/main-admin/auth/login")){const v=await u.json().catch(()=>({error:"Unauthorized"}));throw new Error(v.error||"Invalid credentials")}localStorage.removeItem("token"),localStorage.removeItem("user");const m=window.location.pathname||"";if(!m.includes("/login")&&!m.includes("/signup")&&!m.includes("/auth")&&!m.includes("/main.admin"))try{window.location.href="/login"}catch{}const N=new Error("Unauthorized");throw N.status=401,N}if(u.status===500)throw new Error("Server error 500 - Backend unavailable");if(u.ok)return u.status===204?{success:!0}:await u.json();const f=await u.json().catch(()=>({error:"Network error"}));throw new Error(f.error||`HTTP ${u.status}: ${u.statusText}`)}catch(u){if(u.name==="TypeError"&&u.message.includes("fetch")){if(console.error(`API Fetch Error (attempt ${g+1}/${h+1}):`,u),console.error("Attempted URL:",`${J}${r}`),g<h){const f=Math.min(1e3*Math.pow(2,g),1e4);return console.log(`Retrying in ${f}ms...`),await new Promise(m=>setTimeout(m,f)),Ot(t,c,g+1,h)}throw new Error("Cannot connect to server. The server may be waking up. Please try again in a moment.")}throw u}},F=(t,c={})=>Ot(t,c,0,3),je={login:t=>F("/auth/login",{method:"POST",body:JSON.stringify(t)}),pinLogin:t=>F("/auth/pin-login",{method:"POST",body:JSON.stringify(t)}),signup:t=>F("/auth/signup",{method:"POST",body:JSON.stringify(t)}),signupWithPayment:t=>F("/signup-with-payment",{method:"POST",body:JSON.stringify(t)}),me:()=>F("/auth/me")},ge={getAll:()=>F("/users"),create:t=>F("/users",{method:"POST",body:JSON.stringify(t)}),update:(t,c)=>F(`/users/${t}`,{method:"PUT",body:JSON.stringify(c)}),delete:t=>F(`/users/${t}`,{method:"DELETE"}),setPin:(t,c)=>F(`/users/${t}/set-pin`,{method:"POST",body:JSON.stringify({pin:c})}),lock:(t,c)=>F(`/users/${t}/lock`,{method:"POST",body:JSON.stringify({locked:c})})},se={getAll:()=>F("/products"),create:t=>F("/products",{method:"POST",body:JSON.stringify(t)}),update:(t,c)=>F(`/products/${t}`,{method:"PUT",body:JSON.stringify(c)}),delete:t=>F(`/products/${t}`,{method:"DELETE"}),updateStock:(t,c)=>F(`/products/${t}/stock`,{method:"PUT",body:JSON.stringify(c)}),getMaxProducible:t=>F(`/products/${t}/max-producible`),getWeightPricing:t=>F(`/products/${t}/weight-pricing`),addWeightPrice:(t,c,g)=>F(`/products/${t}/weight-pricing`,{method:"POST",body:JSON.stringify({weight:c,price:g})}),updateWeightPrice:(t,c,g)=>F(`/products/${t}/weight-pricing`,{method:"PUT",body:JSON.stringify({weight:c,price:g})}),deleteWeightPrice:(t,c)=>F(`/products/${t}/weight-pricing`,{method:"DELETE",body:JSON.stringify({weight:c})})},Te={getAll:()=>F("/sales"),create:t=>F("/sales",{method:"POST",body:JSON.stringify(t)}),delete:t=>F(`/sales/${t}`,{method:"DELETE"}),adminComplete:t=>F("/admin-complete-sale",{method:"POST",body:JSON.stringify(t)})},Ke={getAll:()=>F("/expenses"),create:t=>F("/expenses",{method:"POST",body:JSON.stringify(t)}),update:(t,c)=>F(`/expenses/${t}`,{method:"PUT",body:JSON.stringify(c)}),delete:t=>F(`/expenses/${t}`,{method:"DELETE"})},Ut={get:async()=>{try{const t=await fetch(`${J}/api/stats`,{headers:{Authorization:`Bearer ${localStorage.getItem("userToken")}`}});if(t.ok)return await t.json()}catch(t){console.error("Failed to fetch stats:",t)}return{totalSales:0,totalExpenses:0,profit:0,productCount:0}}},Ue={getAll:()=>F("/discounts"),create:t=>F("/discounts",{method:"POST",body:JSON.stringify(t)}),update:(t,c)=>F(`/discounts/${t}`,{method:"PUT",body:JSON.stringify(c)}),delete:t=>F(`/discounts/${t}`,{method:"DELETE"})},lt={getAll:()=>F("/credit-requests"),create:t=>F("/credit-requests",{method:"POST",body:JSON.stringify(t)}),approve:t=>F(`/credit-requests/${t}/approve`,{method:"POST"}),reject:t=>F(`/credit-requests/${t}/reject`,{method:"POST"})},De={get:()=>F("/settings"),update:t=>F("/settings",{method:"PUT",body:JSON.stringify(t)})},We={getAll:t=>{const c=t?`/batches?productId=${t}`:"/batches";return F(c)},create:t=>F("/batches",{method:"POST",body:JSON.stringify(t)})},Fe={login:t=>F("/main-admin/auth/login",{method:"POST",body:JSON.stringify(t)}),getUsers:()=>{const t=localStorage.getItem("ownerToken");return F("/main-admin/users",{headers:{Authorization:`Bearer ${t}`}})},getStats:()=>{const t=localStorage.getItem("ownerToken");return F("/main-admin/stats",{headers:{Authorization:`Bearer ${t}`}})},getActivities:()=>{const t=localStorage.getItem("ownerToken");return F("/main-admin/activities",{headers:{Authorization:`Bearer ${t}`}})},getSalesAll:()=>{const t=localStorage.getItem("ownerToken");return F("/main-admin/sales-all",{headers:{Authorization:`Bearer ${t}`}})},getTimeEntriesAll:()=>{const t=localStorage.getItem("ownerToken");return F("/main-admin/time-entries-all",{headers:{Authorization:`Bearer ${t}`}})},lockUser:(t,c)=>{const g=localStorage.getItem("ownerToken");return F(`/main-admin/users/${t}/lock`,{method:"POST",headers:{Authorization:`Bearer ${g}`},body:JSON.stringify({locked:c})})},changePlan:(t,c)=>{const g=localStorage.getItem("ownerToken");return F(`/main-admin/users/${t}/plan`,{method:"POST",headers:{Authorization:`Bearer ${g}`},body:JSON.stringify({plan:c})})},clearData:t=>{const c=localStorage.getItem("ownerToken");return F("/main-admin/system/clear-data",{method:"POST",headers:{Authorization:`Bearer ${c}`},body:JSON.stringify({type:t})})}};let le=null,qe=new Set;function bs(){const t=J.replace(/\/api$/,"");return`${t.startsWith("https")?"wss":"ws"}://${t.replace(/^https?:\/\//,"")}/api/ws/products`}function js(){if(le&&(le.readyState===WebSocket.OPEN||le.readyState===WebSocket.CONNECTING))return;const t=$t(),c=bs()+(t?`?token=${encodeURIComponent(t)}`:"");le=new WebSocket(c),le.onopen=()=>{console.debug("Products WS connected")},le.onmessage=g=>{let h=null;try{h=JSON.parse(g.data)}catch{return}qe.forEach(l=>{try{l(h)}catch(r){console.error("ws callback error",r)}})},le.onclose=()=>{console.debug("Products WS closed"),le=null},le.onerror=g=>{console.error("Products WS error",g)}}function ys(t){if(typeof t!="function")throw new Error("subscribeProducts requires a callback");return qe.add(t),js(),()=>{if(qe.delete(t),le&&qe.size===0){try{le.close()}catch{}le=null}}}const Ft=a.createContext(),he=()=>a.useContext(Ft),Ns=({children:t})=>{const[c,g]=a.useState(null),[h,l]=a.useState(!0),[r,n]=a.useState(!1),[u,f]=a.useState({});a.useEffect(()=>{m()},[]),a.useEffect(()=>{const D=()=>{const U=localStorage.getItem("user");if(U)try{const H=JSON.parse(U);g(H)}catch(H){console.warn("Failed to parse user from localStorage",H)}else g(null)};return window.addEventListener("storage",D),window.addEventListener("localStorageUpdated",D),()=>{window.removeEventListener("storage",D),window.removeEventListener("localStorageUpdated",D)}},[]);const m=async()=>{try{const D=localStorage.getItem("token"),U=localStorage.getItem("user");if(D)try{const H=await fetch(`${J}/auth/me`,{headers:{Authorization:`Bearer ${D}`,"Content-Type":"application/json"}});if(H.ok){const W=await H.json();g(W),localStorage.setItem("user",JSON.stringify(W))}else throw new Error("Invalid token")}catch(H){console.warn("Auth check failed:",H),localStorage.removeItem("token"),localStorage.removeItem("user")}}catch(D){console.error("Error initializing auth:",D),localStorage.removeItem("token"),localStorage.removeItem("user"),g(null)}finally{l(!1),n(!0)}},N=async D=>{try{if(D&&D.token&&D.user)return localStorage.setItem("token",D.token),localStorage.setItem("user",JSON.stringify(D.user)),g(D.user),D;const U=await je.login(D);if(U.token&&U.user)return localStorage.setItem("token",U.token),localStorage.setItem("user",JSON.stringify(U.user)),g(U.user),U;throw new Error("Invalid response from server")}catch(U){throw console.error("Login failed:",U),U}},v=async D=>{try{const U=await je.signup(D);if(U.token&&U.user)return localStorage.setItem("token",U.token),localStorage.setItem("user",JSON.stringify(U.user)),g(U.user),U;throw new Error("Invalid response from server")}catch(U){throw console.error("Signup failed:",U),U}},i=async D=>{try{if(localStorage.setItem("user",JSON.stringify(D)),g(D),window.dispatchEvent(new Event("localStorageUpdated")),D&&D.id)try{await ge.update(D.id,D)}catch(U){console.warn("Failed to persist updated user to backend",U)}return D}catch(U){throw console.error("updateUser failed:",U),U}},$=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),g(null),window.location.href="/login"},x=()=>!!c&&!!localStorage.getItem("token"),k=D=>c&&c.role===D,b=()=>c&&(c.role==="admin"||c.role==="main-admin"),y=()=>c&&c.role==="cashier",w=()=>c&&c.plan==="ultra",L=()=>c&&c.plan==="basic",A=()=>c&&(c.role==="admin"||c.role==="cashier"),O=()=>c&&c.role==="admin"&&c.plan==="ultra",R=()=>c&&c.role==="admin",_=()=>!0,I=()=>!0;return c?.locked?e.jsx(LockedAccount,{}):e.jsx(Ft.Provider,{value:{user:c,loading:h,isInitialized:r,appSettings:u,login:N,signup:v,updateUser:i,logout:$,isAuthenticated:x,hasRole:k,isAdmin:b,isCashier:y,isUltraPackage:w,isBasicPackage:L,canEditStock:A,canManageUsers:O,canViewAnalytics:R,isRealTimeProductSyncEnabled:_,isCashierUserManagementEnabled:I},children:t})};new Date().toISOString();const Rt=a.createContext(),qt=()=>a.useContext(Rt),vs=({children:t})=>{const{user:c}=he(),[g,h]=a.useState([]),[l,r]=a.useState(!0),[n,u]=a.useState(null),[f,m]=a.useState(Date.now()),N=a.useCallback(async()=>{if(!localStorage.getItem("token")){r(!1);return}try{const i=await se.getAll(),x=(Array.isArray(i)?i:[]).filter(k=>!k.pendingDelete);h(x),u(null),window.dispatchEvent(new CustomEvent("productsSync",{detail:{products:x,timestamp:Date.now()}}))}catch(i){console.error("Failed to fetch products:",i),u(`Failed to load products: ${i.message}`),h([])}finally{r(!1),m(Date.now())}},[]);a.useEffect(()=>{N()},[]),a.useEffect(()=>{const i=setInterval(()=>{N()},6e4);return()=>clearInterval(i)},[]),a.useEffect(()=>{const i=()=>{console.log("ðŸ”„ Data cleared event received - forcing products refresh"),h([]),u(null),N()};return window.addEventListener("dataCleared",i),window.addEventListener("productsCleared",i),()=>{window.removeEventListener("dataCleared",i),window.removeEventListener("productsCleared",i)}},[]);const v=async()=>{r(!0),await N()};return e.jsx(Rt.Provider,{value:{products:g,loading:l,error:n,lastUpdated:f,refreshProducts:v},children:t})},Mt=a.createContext(),ws=()=>a.useContext(Mt),Ss=({children:t})=>{const[c,g]=a.useState(!1),h=a.useCallback(()=>{g(!0)},[]),l=a.useCallback(()=>{g(!1)},[]),r={isLocked:c,lock:h,unlock:l};return e.jsx(Mt.Provider,{value:r,children:t})};function ks(){const[t,c]=a.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[g,h]=a.useState(!0),[l,r]=a.useState(null);a.useEffect(()=>{n()},[]);const n=async()=>{try{r(null);const[m,N]=await Promise.all([Ut.get(),Te.getAll()]),v={totalSales:m?.totalSales||0,totalExpenses:m?.totalExpenses||0,profit:m?.profit||0,grossProfit:m?.grossProfit||0,netProfit:m?.netProfit||0,totalCOGS:m?.totalCOGS||0,dailySales:m?.dailySales||0,weeklySales:m?.weeklySales||0,productCount:m?.productCount||0},i=Array.isArray(N)?N:[];c({stats:v,recentSales:i.slice(-10).reverse()})}catch(m){console.error("Failed to load data:",m),r(m.message),c({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{h(!1)}};if(g)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(l&&t.stats.totalSales===0&&t.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Me,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:l}),e.jsx("button",{onClick:n,className:"btn-primary",children:"Retry"})]})});const u=[{label:"Total Sales",value:`KSH ${t.stats.totalSales?.toLocaleString()||0}`,icon:ye,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${t.stats.grossProfit?.toLocaleString()||0}`,icon:Ae,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${t.stats.totalCOGS?.toLocaleString()||0}`,icon:Ne,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${t.stats.netProfit?.toLocaleString()||0}`,icon:Ae,color:"from-purple-500 to-pink-600",change:"+15.3%"}],f=[{label:"Daily Sales",value:`KSH ${t.stats.dailySales?.toLocaleString()||0}`,icon:Ct,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${t.stats.weeklySales?.toLocaleString()||0}`,icon:Ae,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${t.stats.totalExpenses?.toLocaleString()||0}`,icon:Be,color:"bg-red-50 text-red-600"},{label:"Products",value:t.stats.productCount||0,icon:Ne,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(u||[]).map((m,N)=>{const v=m?.icon;return v?e.jsxs("div",{className:`card bg-gradient-to-br ${m.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(v,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:m.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:m.label}),e.jsx("p",{className:"text-2xl font-bold",children:m.value})]},N):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(f||[]).map((m,N)=>{const v=m?.icon;return v?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${m.color} flex items-center justify-center`,children:e.jsx(v,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:m.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:m.value})]})]})},N):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!t.recentSales||t.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Me,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(t.recentSales||[]).map(m=>m?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:m.createdAt?new Date(m.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(m.items)?m.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:m.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",m.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",m.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",m.profit?.toLocaleString()||0]})]},m.id||Math.random()):null)})]})})]})]})}const Cs=()=>"https://posifine22.onrender.com/api".replace("https://","wss://").replace("http://","ws://");class Ps{constructor(){this.ws=null,this.listeners={stock_updated:[],heartbeat:[],initial:[],error:[]},this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.isManualClose=!1}connect(c,g){return new Promise((h,l)=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){h();return}if(!c){l(new Error("No token provided for WebSocket connection"));return}const r=`${Cs()}/ws/products?token=${encodeURIComponent(c)}`;try{this.ws=new WebSocket(r),this.ws.onopen=()=>{console.log("âœ… WebSocket connected for real-time updates"),this.reconnectAttempts=0,h()},this.ws.onmessage=n=>{try{const u=JSON.parse(n.data);u.type==="stock_updated"?(console.log("ðŸ“¦ Stock update received:",u.data),g&&g(u.data),this.emit("stock_updated",u.data)):u.type==="initial"?(console.log("ðŸ“¦ Initial products loaded via WebSocket"),this.emit("initial",u.products)):u.type==="heartbeat"&&this.emit("heartbeat",u)}catch(u){console.error("Error parsing WebSocket message:",u)}},this.ws.onerror=n=>{console.error("âŒ WebSocket error:",n),this.emit("error",n),l(n)},this.ws.onclose=()=>{console.log("ðŸ”Œ WebSocket disconnected"),this.isManualClose||this.attemptReconnect(c,g)}}catch(n){console.error("Failed to create WebSocket:",n),l(n)}})}attemptReconnect(c,g){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Max reconnection attempts reached");return}this.reconnectAttempts++;const h=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`ðŸ”„ Reconnecting in ${h}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect(c,g).catch(l=>{console.error("Reconnection failed:",l)})},h)}on(c,g){this.listeners[c]||(this.listeners[c]=[]),this.listeners[c].push(g)}emit(c,g){this.listeners[c]&&this.listeners[c].forEach(h=>{try{h(g)}catch(l){console.error(`Error in ${c} listener:`,l)}})}disconnect(){this.isManualClose=!0,this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}}const Ge=new Ps;function As(){const{user:t,isUltraPackage:c,isRealTimeProductSyncEnabled:g}=he(),{products:h,refreshProducts:l}=qt(),[r,n]=a.useState([]),[u,f]=a.useState([]),[m,N]=a.useState("all"),[v,i]=a.useState(""),[$,x]=a.useState(!1),[k,b]=a.useState(!1),[y,w]=a.useState(!1),[L,A]=a.useState(!1),[O,R]=a.useState(null),[_,I]=a.useState({}),[D,U]=a.useState({weight:"",price:""}),[H,W]=a.useState(null),[ae,ce]=a.useState(null),[oe,de]=a.useState(!1),[pe,B]=a.useState(null),[ee,V]=a.useState(""),[p,d]=a.useState({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),[S,T]=a.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[P,q]=a.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0});a.useEffect(()=>{K();const o=localStorage.getItem("token");return o&&Ge.connect(o,s=>{s&&s.allProducts&&n(s.allProducts)}).catch(s=>{console.warn("WebSocket connection failed:",s)}),()=>{Ge.disconnect()}},[]);const K=async()=>{try{await l();const o=await We.getAll();f(o)}catch(o){console.error("Failed to load data:",o)}};a.useEffect(()=>{h&&n(h)},[h]);const X=(o,s=!0)=>{const j=o.target.files[0];if(j){if(j.size>2*1024*1024){Q("Image must be smaller than 2MB","error");return}const C=new FileReader;C.onload=E=>{const M=E.target.result;V(M),s?d({...p,image:M}):(q({...P,image:M}),P.id&&setTimeout(async()=>{try{await se.update(P.id,{image:M}),Q("âœ… Image saved","success")}catch(Y){console.error("Failed to save image:",Y)}},500))},C.readAsDataURL(j)}},G=o=>u.filter(j=>j.productId===o&&j.quantity>0).reduce((j,C)=>j+C.quantity,0),fe=o=>u.filter(s=>s.productId===o&&s.quantity>0),Q=(o,s="success")=>{ce({message:o,type:s}),setTimeout(()=>ce(null),5e3)},Ve=async o=>{o.preventDefault();try{const s={...p,price:parseFloat(p.price),cost:parseFloat(p.cost||0),quantity:0,visibleToCashier:!p.expenseOnly&&p.visibleToCashier!==!1},j=await se.create(s);d({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),V(""),x(!1),await K(),Q(`âœ… Product "${j.name}" added successfully! ${j.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success")}catch(s){console.error("Failed to create product:",s),alert(`Failed to create product: ${s.message||"Unknown error"}`)}},Ye=async o=>{o.preventDefault();try{const s={id:`batch-${Date.now()}`,productId:O.id,quantity:parseInt(S.quantity),expiryDate:S.expiryDate,batchNumber:S.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(S.cost||O.cost||0)};f(j=>[...j,s]),Q("âš¡ Adding stock...","info");try{await We.create({productId:O.id,quantity:parseInt(S.quantity),expiryDate:S.expiryDate,batchNumber:S.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(S.cost||O.cost||0)}),T({quantity:"",expiryDate:"",batchNumber:"",cost:""}),w(!1),R(null),await K(),Q(`âœ… Stock added successfully for ${O.name}!`,"success")}catch(j){throw f(C=>C.filter(E=>E.id!==s.id)),j}}catch(s){console.error("Failed to add stock:",s),Q(`âŒ Failed to add stock: ${s.message||"Unknown error"}`,"error")}},ue=async o=>{o.preventDefault();try{const s=r.find(E=>E.id===P.id);if(parseFloat(P.price)<s.price){alert("You cannot lower prices, only increase.");return}const j={...P,price:parseFloat(P.price),cost:parseFloat(P.cost),quantity:parseFloat(P.quantity)},C={...s,...j};n(E=>E.map(M=>M.id===P.id?C:M)),de(!0),Q("âš¡ Updating product...","info");try{const E=await se.update(P.id,j);b(!1),g()?(window.dispatchEvent(new CustomEvent("productUpdated",{detail:{product:E,originalProduct:s,timestamp:new Date().toISOString(),type:"update"}})),Q("âœ… Product updated and synced!","success")):Q("âœ… Product updated successfully!","success"),B(new Date)}catch(E){throw n(M=>M.map(Y=>Y.id===P.id?s:Y)),E}finally{de(!1)}}catch(s){console.error("Failed to update product:",s),Q(`âŒ Update failed: ${s.message||"Unknown error"}`,"error")}},Qe=async o=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const s=r.find(C=>C.id===o),j=await se.delete(o);if(n(C=>C.filter(E=>E.id!==o)),g()&&s)de(!0),window.dispatchEvent(new CustomEvent("productDeleted",{detail:{product:s,timestamp:new Date().toISOString(),type:"delete"}})),Q(`ðŸ“¡ Product "${s.name}" deleted and synced to all dashboards!`,"success"),B(new Date),setTimeout(()=>{de(!1)},3e3);else{const C=j?.message||"Product deleted successfully!";alert(C)}await l()}catch(s){console.error("Failed to delete product:",s);let j="Failed to delete product";s.message.includes("Failed to execute")||s.message.includes("JSON")?j="Network error. Please check your connection and try again.":s.message.includes("401")||s.message.includes("unauthorized")?j="You are not authorized to delete this product.":s.message.includes("404")||s.message.includes("not found")?j="Product not found. It may have been deleted already.":s.message&&(j=`Failed to delete product: ${s.message}`),alert(j)}},be=(r||[]).filter(o=>{if(!o)return!1;const s=o.name?.toLowerCase().includes(v.toLowerCase()),j=m==="all"||m==="raw"&&!o.recipe||m==="composite"&&o.recipe||m==="expense"&&o.expenseOnly||m==="low-stock"&&o.quantity<10;return s&&j}),Ze=(r||[]).filter(o=>o&&!o.recipe&&!o.expenseOnly),Ce=(r||[]).filter(o=>o&&o.recipe),Xe=(r||[]).filter(o=>o&&o.expenseOnly),Z=o=>{if(!o||!o.recipe)return 0;let s=1/0;return(o.recipe||[]).forEach(j=>{if(!j)return;const C=(r||[]).find(E=>E&&E.id===j.productId);if(C&&C.quantity>0&&j.quantity>0){const E=Math.floor(C.quantity/j.quantity);s=Math.min(s,E)}}),s===1/0?0:s},et=o=>{if(!o)return 0;if(!o.recipe)return o.cost||0;let s=0;return(o.recipe||[]).forEach(j=>{if(!j)return;const C=(r||[]).find(E=>E&&E.id===j.productId);if(C&&C.quantity>0){const E=(C.cost||0)/C.quantity;s+=E*(j.quantity||0)}}),s},tt=async o=>{R(o);try{const s=await se.getWeightPricing(o.id);I(s.weightPricing||{})}catch(s){console.error("Failed to load weight pricing:",s),I({})}A(!0)},st=async o=>{if(o.preventDefault(),!D.weight||!D.price){Q("âŒ Please enter both weight and price","error");return}try{const s=parseFloat(D.weight),j=parseFloat(D.price);if(s*10%1!==0){Q("âŒ Weight must be in 0.1kg increments (0.1, 0.2, 0.3, etc)","error");return}await se.addWeightPrice(O.id,s,j),I({..._,[String(s)]:j}),U({weight:"",price:""}),Q(`âœ… Weight price added for ${s}kg`,"success")}catch(s){Q(`âŒ Failed to add weight price: ${s.message}`,"error")}},at=async o=>{if(confirm(`Delete pricing for ${o}kg?`))try{await se.deleteWeightPrice(O.id,o);const s={..._};delete s[String(o)],I(s),Q(`âœ… Weight price for ${o}kg deleted`,"success")}catch(s){Q(`âŒ Failed to delete weight price: ${s.message}`,"error")}};return e.jsxs("div",{className:"p-6 space-y-6",children:[ae&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${ae.type==="success"?"bg-green-50 border border-green-200 text-green-800":ae.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:ae.message}),e.jsx("button",{onClick:()=>ce(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(mt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:v,onChange:o=>i(o.target.value)})]}),e.jsxs("select",{value:m,onChange:o=>N(o.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>x(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:Ze.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:Ce.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:Xe.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(be||[]).map(o=>{if(!o)return null;const s=et(o),j=o.price?((o.price-s)/o.price*100).toFixed(1):0,C=Z(o),E=H===o.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[o.image?e.jsx("img",{src:o.image,alt:o.name,className:"w-12 h-12 object-cover rounded-lg",onError:M=>{M.target.style.display="none",M.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:o.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[o.recipe&&e.jsx("button",{onClick:()=>W(E?null:o.id),className:"p-1 hover:bg-gray-200 rounded",children:E?e.jsx(Yt,{className:"w-4 h-4"}):e.jsx(Qt,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:o.name}),o.quantity<10&&!o.recipe&&e.jsx(Ie,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${o.expenseOnly?"badge-warning":o.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:o.expenseOnly?"Expense":o.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",o.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",s.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${G(o.id)===0?"text-red-600":G(o.id)<10?"text-yellow-600":"text-gray-900"}`,children:[G(o.id)," ",o.unit]}),G(o.id)<10&&G(o.id)>0&&e.jsx(Ie,{className:"w-4 h-4 text-yellow-500"}),G(o.id)===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600",children:[fe(o.id).length," active"]}),e.jsx("button",{onClick:()=>{R(o),w(!0)},className:"p-1 hover:bg-blue-50 rounded text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(ie,{className:"w-3 h-3"})})]})}),e.jsx("td",{className:"px-4 py-3",children:o.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[C," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${j>30?"text-green-600":j>15?"text-yellow-600":"text-red-600"}`,children:[j,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>tt(o),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600 transition-colors",title:"Edit weight-based pricing",children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{q(o),b(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Qe(o.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(xe,{className:"w-4 h-4"})})]})})]},o.id),E&&o.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(o.recipe||[]).map((M,Y)=>{if(!M)return null;const re=(r||[]).find(pt=>pt&&pt.id===M.productId);if(!re)return null;const me=(re.cost||0)/(re.quantity||1),zt=me*(M.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:re.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[M.quantity||0," ",re.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[re.quantity||0," ",re.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",me.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",zt.toFixed(2)]})]},Y)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",s.toFixed(2)]})]})})]})]})})})]})})})]})})}),y&&O&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Add Stock for ",O.name]}),e.jsxs("form",{onSubmit:Ye,className:"space-y-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:S.quantity,onChange:o=>T({...S,quantity:o.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:S.expiryDate,onChange:o=>T({...S,expiryDate:o.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:S.batchNumber,onChange:o=>T({...S,batchNumber:o.target.value})}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost per Unit",className:"input",value:S.cost,onChange:o=>T({...S,cost:o.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{w(!1),R(null),T({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]})}),$&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:Ve,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:p.name,onChange:o=>d({...p,name:o.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:o=>X(o,!0),className:"input"}),e.jsx(Pt,{className:"w-5 h-5 text-gray-400"})]}),(ee||p.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:ee||p.image,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:p.price,onChange:o=>d({...p,price:o.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:p.cost,onChange:o=>d({...p,cost:o.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:p.category,onChange:o=>d({...p,category:o.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsxs("select",{className:"input",value:p.unit,onChange:o=>d({...p,unit:o.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:p.expenseOnly,onChange:o=>d({...p,expenseOnly:o.target.checked,visibleToCashier:!o.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!p.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:p.visibleToCashier,onChange:o=>d({...p,visibleToCashier:o.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{x(!1),V(""),d({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0})},className:"btn-secondary",children:"Cancel"})]})]})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:ue,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:P.name,onChange:o=>q({...P,name:o.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:P.image||"",onChange:o=>q({...P,image:o.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:o=>{const s=o.target.files[0];if(s){const j=new FileReader;j.onloadend=()=>{q({...P,image:j.result})},j.readAsDataURL(s)}}})]}),P.image&&e.jsx("img",{src:P.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:P.price||"",onChange:o=>q({...P,price:o.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:P.cost||"",onChange:o=>q({...P,cost:o.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:P.quantity||"",onChange:o=>q({...P,quantity:o.target.value}),required:!0}),e.jsxs("select",{className:"input",value:P.unit||"pcs",onChange:o=>q({...P,unit:o.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:P.category||"raw",onChange:o=>q({...P,category:o.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:P.expenseOnly||!1,onChange:o=>q({...P,expenseOnly:o.target.checked,visibleToCashier:!o.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!P.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:P.visibleToCashier!==!1,onChange:o=>q({...P,visibleToCashier:o.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>b(!1),className:"btn-secondary",children:"Cancel"})]})]})]})}),L&&O&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-96 overflow-y-auto",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Weight-Based Pricing - ",O.name]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Set different prices for different weights (in 0.1kg increments)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700",children:"Add New Weight Price"}),e.jsxs("form",{onSubmit:st,className:"flex gap-3",children:[e.jsx("input",{type:"number",step:"0.1",min:"0.1",placeholder:"Weight (kg) - e.g., 0.1, 0.5, 1.0",className:"input flex-1",value:D.weight,onChange:o=>U({...D,weight:o.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Price (KSH)",className:"input flex-1",value:D.price,onChange:o=>U({...D,price:o.target.value}),required:!0}),e.jsx("button",{type:"submit",className:"btn-primary whitespace-nowrap",children:"Add Price"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Current Prices"}),Object.keys(_).length>0?e.jsx("div",{className:"space-y-2",children:Object.entries(_).sort(([o],[s])=>parseFloat(o)-parseFloat(s)).map(([o,s])=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-medium",children:[o," kg"]}),e.jsxs("span",{className:"text-gray-600 ml-4",children:["KSH ",parseFloat(s).toLocaleString()]})]}),e.jsx("button",{onClick:()=>at(o),className:"text-red-600 hover:bg-red-50 px-3 py-1 rounded text-sm font-medium transition-colors",children:"Delete"})]},o))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No weight-based pricing set. Add one above."})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Base price:"})," KSH ",O.price?.toLocaleString()]})})]}),e.jsx("div",{className:"flex gap-2 mt-6",children:e.jsx("button",{onClick:()=>{A(!1),R(null),I({}),U({weight:"",price:""})},className:"btn-secondary flex-1",children:"Done"})})]})})]})}function Ds(){const[t,c]=a.useState([]),[g,h]=a.useState([]),[l,r]=a.useState(!1),[n,u]=a.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});a.useEffect(()=>{f()},[]);const f=async()=>{const k=await se.getAll();c(k),h(k.filter(b=>!b.recipe))},m=()=>{u({...n,ingredients:[...n.ingredients,{name:"",quantity:"",unit:"pcs"}]})},N=(k,b,y)=>{const w=[...n.ingredients];w[k][b]=y,u({...n,ingredients:w})},v=k=>{u({...n,ingredients:n.ingredients.filter((b,y)=>y!==k)})},i=()=>n.ingredients.reduce((k,b)=>{const y=g.find(w=>w.name.toLowerCase()===b.name.toLowerCase());if(y&&b.quantity){const w=y.cost/y.quantity;return k+w*parseFloat(b.quantity)}return k},0),$=async k=>{k.preventDefault();const b=[];for(const w of n.ingredients){if(!w.name||!w.quantity)continue;const L=g.find(A=>A.name.toLowerCase()===w.name.toLowerCase());L?b.push({productId:L.id,quantity:parseFloat(w.quantity),unit:w.unit||"pcs"}):b.push({name:w.name,quantity:parseFloat(w.quantity),unit:w.unit||"pcs"})}if(b.length===0){alert("Please add at least one ingredient");return}const y=i();try{await se.create({name:n.name,price:parseFloat(n.price),cost:y,quantity:0,unit:"pcs",category:"composite",recipe:b,image:n.image||"",visibleToCashier:n.visibleToCashier,expenseOnly:!1}),u({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),r(!1),f(),alert("Recipe created successfully!")}catch(w){console.error("Error creating recipe:",w),alert("Failed to create recipe. Please try again.")}},x=t.filter(k=>k.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>r(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",x.length,")"]}),x.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:x.map(k=>{const b=k.recipe.reduce((w,L)=>{if(L.productId){const A=t.find(O=>O.id===L.productId);if(A){const O=A.cost/A.quantity;return w+O*L.quantity}}else if(L.name){const A=t.find(O=>O.name.toLowerCase()===L.name.toLowerCase());if(A){const O=A.cost/A.quantity;return w+O*L.quantity}}return w},0),y=((k.price-b)/k.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:k.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",k.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",b.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${y>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",y,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(xe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:k.recipe.map((w,L)=>{let A="",O=w.unit||"pcs";if(w.productId){const R=t.find(_=>_.id===w.productId);R&&(A=R.name,O=R.unit)}else w.name&&(A=w.name,O=w.unit||"pcs");return A?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:A}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[w.quantity," ",O]})]},L):null})})]})]},k.id)})})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:n.name,onChange:k=>u({...n,name:k.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:n.price,onChange:k=>u({...n,price:k.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:n.image,onChange:k=>u({...n,image:k.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.visibleToCashier,onChange:k=>u({...n,visibleToCashier:k.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:m,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:n.ingredients.map((k,b)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:k.name,onChange:y=>N(b,"name",y.target.value),required:!0,list:`ingredients-list-${b}`}),e.jsx("datalist",{id:`ingredients-list-${b}`,children:g.map(y=>e.jsxs("option",{value:y.name,children:[y.name," (",y.quantity," ",y.unit," available)"]},y.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:k.quantity,onChange:y=>N(b,"quantity",y.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:k.unit,onChange:y=>N(b,"unit",y.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>v(b),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(xe,{className:"w-4 h-4"})})]},b))}),n.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),n.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",i().toFixed(2)]})]}),n.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(n.price)-i())/parseFloat(n.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(Zt,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{r(!1),u({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Is(){const[t,c]=a.useState([]),[g,h]=a.useState("all"),[l,r]=a.useState([]),[n,u]=a.useState(!1);a.useEffect(()=>{f()},[]);const f=async()=>{const b=await Te.getAll();c(b.reverse())},m=async b=>{if(window.confirm("Delete this sale? This action cannot be undone."))try{u(!0);const y=localStorage.getItem("token");if(!(await fetch(`${J}/sales/${b}`,{method:"DELETE",headers:{Authorization:`Bearer ${y}`}})).ok)throw new Error("Failed to delete sale");c(t.filter(L=>L.id!==b)),alert("Sale deleted successfully")}catch(y){alert("Failed to delete sale: "+y.message)}finally{u(!1)}},N=async()=>{if(l.length===0){alert("No sales selected");return}if(window.confirm(`Delete ${l.length} sales? This action cannot be undone.`))try{u(!0);const b=localStorage.getItem("token");if(!(await fetch(`${J}/sales/bulk-delete`,{method:"POST",headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"},body:JSON.stringify({saleIds:l})})).ok)throw new Error("Failed to delete sales");c(t.filter(w=>!l.includes(w.id))),r([]),alert("Sales deleted successfully")}catch(b){alert("Failed to delete sales: "+b.message)}finally{u(!1)}},v=async()=>{if(window.confirm("Clear ALL sales data? This will delete everything and cannot be undone."))try{u(!0);const b=localStorage.getItem("token");if(!(await fetch(`${J}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"},body:JSON.stringify({type:"sales"})})).ok)throw new Error("Failed to clear sales");c([]),r([]),alert("All sales data cleared")}catch(b){alert("Failed to clear sales: "+b.message)}finally{u(!1)}},i=t.filter(b=>{if(g==="today")return new Date(b.createdAt).toDateString()===new Date().toDateString();if(g==="week"){const y=new Date;return y.setDate(y.getDate()-7),new Date(b.createdAt)>=y}return!0}),$=i.reduce((b,y)=>b+y.total,0),x=i.reduce((b,y)=>b+(y.cogs||0),0),k=$-x;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:g,onChange:b=>h(b.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]}),l.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[l.length," selected"]}),e.jsxs("button",{onClick:N,disabled:n,className:"px-3 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),"Delete Selected"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:v,disabled:n||t.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4"}),"Clear All Sales"]}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(Xt,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",$.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",x.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",k.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:l.length===i.length&&i.length>0,onChange:b=>{b.target.checked?r(i.map(y=>y.id)):r([])},className:"rounded"})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Action"})]})}),e.jsx("tbody",{children:i.map(b=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:l.includes(b.id),onChange:y=>{y.target.checked?r([...l,b.id]):r(l.filter(w=>w!==b.id))},className:"rounded"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",b.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(b.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[b.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:b.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",b.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",b.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",b.profit?.toLocaleString()||0]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("button",{onClick:()=>m(b.id),disabled:n,className:"px-3 py-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),"Delete"]})})]},b.id))})]})})]})]})}function Es(){const[t,c]=a.useState([]),[g,h]=a.useState(!1),[l,r]=a.useState({description:"",amount:"",category:"general"});a.useEffect(()=>{n()},[]);const n=async()=>{const v=await Ke.getAll();c(v.reverse())},u=async v=>{v.preventDefault(),await Ke.create({...l,amount:parseFloat(l.amount)}),r({description:"",amount:"",category:"general"}),h(!1),n()},f=t.reduce((v,i)=>v+i.amount,0),m=t.filter(v=>!v.automatic),N=t.filter(v=>v.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",f.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",m.reduce((v,i)=>v+i.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",N.reduce((v,i)=>v+i.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.map(v=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(v.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:v.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:v.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${v.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:v.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",v.amount?.toLocaleString()]})]},v.id))})]})})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:l.description,onChange:v=>r({...l,description:v.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:l.amount,onChange:v=>r({...l,amount:v.target.value}),required:!0}),e.jsxs("select",{className:"input",value:l.category,onChange:v=>r({...l,category:v.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ts(){const{isCashierUserManagementEnabled:t,isCashier:c}=he(),[g,h]=a.useState([]),[l,r]=a.useState(!0),[n,u]=a.useState(!1),[f,m]=a.useState(null),[N,v]=a.useState(null),[i,$]=a.useState(null),[x,k]=a.useState(0),[b,y]=a.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),[w,L]=a.useState(!1),[A,O]=a.useState(null),[R,_]=a.useState("");a.useEffect(()=>{I()},[]),a.useEffect(()=>()=>{i?.intervalId&&clearInterval(i.intervalId)},[i]);const I=async()=>{try{r(!0);const d=await ge.getAll();h(Array.isArray(d)?d:[])}catch(d){console.error("Error loading users:",d),h([])}finally{r(!1)}},D=()=>Math.floor(1e3+Math.random()*9e3).toString(),U=async d=>{if(d.preventDefault(),console.log("Form submitted with data:",b),!b.name?.trim()||!b.email?.trim()||!b.password?.trim()){alert("Please fill in all required fields");return}if(b.password.length<6){alert("Password must be at least 6 characters long");return}try{r(!0);const S=D(),T={name:b.name.trim(),email:b.email.trim().toLowerCase(),password:b.password.trim(),pin:S};console.log("Sending user data:",T);const P=await ge.create(T);console.log("User creation result:",P),await I();const q=`âœ… Cashier added successfully!

ðŸ“§ Email: ${T.email}
ðŸ”‘ Password: ${T.password}
ðŸ”¢ PIN: ${S}

ðŸ’¡ LOGIN OPTIONS:
1. Email + Password: Use email and password above
2. PIN Login: Use email + ${S}

Please share these credentials securely with the new cashier.`;alert(q),y({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),u(!1)}catch(S){console.error("Error creating cashier:",S);let T="Failed to add cashier";S.message.includes("Current user not found")?T="Authentication error. Please refresh the page and try again.":S.message.includes("email")?T="Email already exists. Please use a different email.":S.message.includes("network")||S.message.includes("fetch")?T="Network error. Please check your connection and try again.":S.message&&(T=`Failed to add cashier: ${S.message}`),alert(T)}finally{r(!1)}},H=async(d,S)=>{try{r(!0),await ge.update(d,{permissions:S}),await I(),m(null)}catch(T){console.error("Error updating permissions:",T),alert("Failed to update permissions: "+T.message)}finally{r(!1)}},W=async(d,S)=>{try{r(!0);const T=!S,P=await fetch(`${J}/users/${d}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({active:T})});if(!P.ok){const q=await P.json().catch(()=>({error:"Network error"}));throw new Error(q.error||`HTTP ${P.status}: ${P.statusText}`)}await I()}catch(T){console.error("Error updating user status:",T),alert("Failed to update user status: "+T.message)}finally{r(!1)}},ae=async(d,S)=>{try{r(!0);const T=!S,P=await fetch(`${J}/users/${d}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({locked:T})});if(!P.ok){const q=await P.json().catch(()=>({error:"Network error"}));throw new Error(q.error||`HTTP ${P.status}: ${P.statusText}`)}await I()}catch(T){console.error("Error updating user lock status:",T),alert("Failed to update user lock status: "+T.message)}finally{r(!1)}},ce=async d=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{r(!0),await ge.delete(d),await I()}catch(S){console.error("Error deleting user:",S),alert("Failed to delete user: "+S.message)}finally{r(!1)}},oe=async()=>{if(window.confirm("Clear ALL users data? This will delete all users and cannot be undone."))try{r(!0);const d=localStorage.getItem("token");if(!(await fetch(`${J}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({type:"users"})})).ok)throw new Error("Failed to clear users");h([]),alert("All users data cleared")}catch(d){alert("Failed to clear users: "+d.message)}finally{r(!1)}},de=d=>{O(d),_(D()),L(!0)},pe=async()=>{try{r(!0),await ge.update(A.id,{cashierPIN:R}),await I(),L(!1),O(null),_(""),alert(`âœ… PIN reset successfully!

ðŸ”¢ New PIN for ${A.name}: ${R}

Please share this PIN securely with the cashier.`)}catch(d){console.error("Error resetting PIN:",d),alert("Failed to reset PIN: "+d.message)}finally{r(!1)}},B=d=>{v(d),$({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const S=setInterval(()=>{V(d)},3e3);$(T=>({...T,intervalId:S})),V(d)},ee=()=>{i?.intervalId&&clearInterval(i.intervalId),v(null),$(null)},V=async d=>{try{const S=await Te.getAll(),P=(Array.isArray(S)?S:[]).filter(K=>K.cashierId===d.id).sort((K,X)=>new Date(X.createdAt)-new Date(K.createdAt)).slice(0,10),q={isActive:Math.random()>.3,currentCart:P.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:P.reduce((K,X)=>K+X.total,0),salesCount:P.length,lastActivity:P.length>0?new Date(P[0].createdAt).toLocaleTimeString():"No recent activity"};$(q)}catch(S){console.error("Error loading live view data:",S)}},p=(g||[]).filter(d=>d.role==="cashier");return l&&g.length===0?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),e.jsx("div",{className:"flex items-center gap-2",children:t()&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:oe,disabled:l||g.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4"}),"Clear All Users"]}),e.jsxs("button",{onClick:()=>u(!0),className:"btn-primary flex items-center gap-2",disabled:l,children:[e.jsx(ie,{className:"w-4 h-4"}),"Add Cashier"]})]})})]}),c()&&!t()&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(ne,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"User Management Restricted"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The admin has disabled cashier user management. You cannot add, edit, or remove users at this time."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:g.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:p.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:g.filter(d=>d.active).length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(g||[]).map(d=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:d.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:d.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${d.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:d.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:d.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:d.role==="cashier"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:d.pin||d.cashierPIN||"----"}),e.jsx("button",{onClick:()=>de(d),className:"p-1 hover:bg-yellow-50 rounded text-yellow-600",title:"Reset PIN",disabled:l,children:e.jsx(ve,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${d.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:d.active?e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(ft,{className:"w-3 h-3"}),"Inactive"]})}),d.locked&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:[e.jsx(_e,{className:"w-3 h-3"}),"Locked"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>W(d.id,d.active),className:`p-2 rounded-lg transition ${d.active?"hover:bg-red-50 text-red-600":"hover:bg-green-50 text-green-600"}`,title:d.active?"Deactivate User":"Activate User",disabled:l,children:d.active?e.jsx(ft,{className:"w-4 h-4"}):e.jsx(gt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ae(d.id,d.locked||!1),className:`p-2 rounded-lg transition ${d.locked?"hover:bg-green-50 text-green-600":"hover:bg-red-50 text-red-600"}`,title:d.locked?"Unlock User":"Lock User",disabled:l,children:e.jsx(_e,{className:"w-4 h-4"})})]}),d.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",d.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(Dt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>B(d),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(bt,{className:"w-4 h-4"})})]}),t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>m(d),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600",title:"Edit Permissions",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ce(d.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",title:"Delete User",disabled:l,children:e.jsx(xe,{className:"w-4 h-4"})})]})]})})]},d.id))})]}),g.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(we,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first cashier to get started"})]})]})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:b.name||"",onChange:d=>{console.log("Name input changed:",d.target.value),y({...b,name:d.target.value})},required:!0,disabled:l}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:b.email||"",onChange:d=>{console.log("Email input changed:",d.target.value),y({...b,email:d.target.value})},required:!0,disabled:l}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:b.password||"",onChange:d=>{console.log("Password input changed:",d.target.value),y({...b,password:d.target.value})},required:!0,minLength:6,disabled:l}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(b.permissions).map(([d,S])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:T=>y({...b,permissions:{...b.permissions,[d]:T.target.checked}}),disabled:l}),e.jsx("span",{className:"text-sm capitalize",children:d.replace(/([A-Z])/g," $1").trim()})]},d))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:l,children:l?"Adding...":"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn-secondary",disabled:l,children:"Cancel"})]})]})]})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",f.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(f.permissions||{}).map(([d,S])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:T=>m({...f,permissions:{...f.permissions,[d]:T.target.checked}}),disabled:l}),e.jsx("span",{className:"text-sm capitalize",children:d.replace(/([A-Z])/g," $1").trim()})]},d))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>H(f.id,f.permissions),className:"btn-primary flex-1",disabled:l,children:l?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>m(null),className:"btn-secondary",disabled:l,children:"Cancel"})]})]})}),N&&i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(bt,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",N.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:ee,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(Se,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${i.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:i.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Le,{className:"w-4 h-4"}),"Last Activity: ",i.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Re,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(i.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(i.currentCart||[]).map((d,S)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[d.name," x",d.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",d.price.toLocaleString()]})]},S)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(i.currentCart||[]).reduce((d,S)=>d+S.price*S.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:i.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",i.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",i.salesCount>0?Math.round(i.totalSalesToday/i.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})}),w&&A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Reset PIN for ",A.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate a new 4-digit PIN for this cashier. The old PIN will be invalid."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"New PIN:"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-mono text-3xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:R})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>_(D()),className:"btn-secondary flex-1",disabled:l,children:"Generate New PIN"}),e.jsx("button",{onClick:pe,className:"btn-primary flex-1",disabled:l,children:l?"Updating...":"Confirm & Update"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>{L(!1),O(null),_("")},className:"btn-secondary w-full",disabled:l,children:"Cancel"})})]})})]})}function Ls(){const[t,c]=a.useState([]),[g,h]=a.useState("all");a.useEffect(()=>{l()},[]);const l=()=>{const f=JSON.parse(localStorage.getItem("clockRecords")||"[]");c(f.reverse())},r=g==="all"?t:t.filter(f=>f.date===new Date().toDateString()),n=r.filter(f=>f.date===new Date().toDateString()).reduce((f,m)=>f+m.duration,0)/60,u=f=>{const m=Math.floor(f/60),N=f%60;return`${m}h ${N}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(Le,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[n.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(xt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(r.filter(f=>f.date===new Date().toDateString()).map(f=>f.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(He,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:t.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${g==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>h("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${g==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"})]})}),e.jsx("tbody",{children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-gray-500",children:"No records found"})}):r.map((f,m)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:f.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(f.clockIn).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(f.clockIn).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(f.clockOut).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:u(f.duration)})})]},m))})]})})]})]})}function $s(){const{user:t,updateUser:c}=he();ke();const[g,h]=a.useState(!1),[l,r]=a.useState(t?.plan||"ultra"),[n,u]=a.useState({}),[f,m]=a.useState(null),[N,v]=a.useState(t?.profilePicture||null),[i,$]=a.useState(!0),[x,k]=a.useState(!0);a.useEffect(()=>{b()},[]);const b=async()=>{try{const I=await De.get();u(I),I.logo&&m(I.logo),$(I.cashierUserManagement!==!1),k(I.realTimeProductSync!==!1)}catch(I){console.error("Failed to load settings:",I)}},y=async I=>{try{const D={...n,...I};return await De.update(D),u(D),!0}catch(D){return console.error("Failed to save settings:",D),!1}},w=async()=>{const I=!i;$(I),await y({cashierUserManagement:I})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{cashierUserManagement:I}})),alert(`âœ… Cashier User Management ${I?"ENABLED":"DISABLED"}`)):($(!I),alert("âŒ Failed to save setting. Please try again."))},L=async()=>{const I=!x;k(I),await y({realTimeProductSync:I})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{realTimeProductSync:I}})),alert(`âœ… Real-time Product Sync ${I?"ENABLED":"DISABLED"}`)):(k(!I),alert("âŒ Failed to save setting. Please try again."))},A=async I=>{const D=I.target.files[0];if(D){const U=new FileReader;U.onloadend=async()=>{const H=U.result;m(H);try{await De.update({...n,logo:H}),u({...n,logo:H})}catch(W){console.error("Failed to save logo:",W)}},U.readAsDataURL(D)}},O=async I=>{const D=I.target.files[0];if(D){const U=new FileReader;U.onloadend=async()=>{const H=U.result;v(H);try{await c({...t,profilePicture:H})}catch(W){console.error("Failed to save profile picture:",W)}},U.readAsDataURL(D)}},R=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],_=async()=>{const I=R.find(U=>U.id===l),D=l==="ultra"?"admin":"cashier";await c({...t,role:D,plan:l,price:I.price}),h(!1),setTimeout(()=>window.location.href=D==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(xt,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[N?e.jsx("img",{src:N,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:t?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(jt,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:O})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(ze,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>h(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(ut,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(we,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cashier User Management"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Cashier User Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow cashiers to add and remove users"})]}),e.jsx("button",{onClick:w,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${i?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${i?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${i?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:i?"âœ… Cashiers can add and remove users when enabled":"âŒ Cashiers cannot add or remove users when disabled"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(es,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Real-time Product Sync"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Real-time Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync products between admin and cashier dashboards"})]}),e.jsx("button",{onClick:L,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${x?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${x?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${x?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:x?"âœ… Products will sync in real-time across all dashboards":"âŒ Products will not sync automatically across dashboards"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(_e,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(ts,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[f&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:f,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(jt,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:A})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:R.map(I=>e.jsxs("div",{onClick:()=>r(I.id),className:`card cursor-pointer transition-all ${l===I.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:I.name}),l===I.id&&e.jsx(Je,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",I.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:I.features.map((D,U)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Je,{className:"w-4 h-4 text-green-600"}),D]},U))})]},I.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:_,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>h(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function Os(){const[t,c]=a.useState([]),[g,h]=a.useState(!1),[l,r]=a.useState(null),[n,u]=a.useState({name:"",amount:"",description:"",active:!0});a.useEffect(()=>{f()},[]);const f=()=>{const i=JSON.parse(localStorage.getItem("serviceFees")||"[]");c(i)},m=i=>{localStorage.setItem("serviceFees",JSON.stringify(i)),c(i)},N=i=>{if(i.preventDefault(),l){const $=t.map(x=>x.id===l.id?{...n,id:x.id}:x);m($)}else{const $={...n,id:Date.now(),createdAt:new Date().toISOString()};m([...t,$])}h(!1),r(null),u({name:"",amount:"",description:"",active:!0})},v=i=>{confirm("Delete this service fee?")&&m(t.filter($=>$.id!==i))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{h(!0),r(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(i=>e.jsxs("div",{className:`card ${i.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(ye,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:i.name}),e.jsx("p",{className:"text-xs text-gray-500",children:i.description})]})]}),e.jsx("span",{className:`badge ${i.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:i.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",i.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{r(i),u(i),h(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(ve,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>v(i.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(xe,{className:"w-4 h-4 text-red-600"})})]})]})]},i.id))}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[l?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:n.name,onChange:i=>u({...n,name:i.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:n.amount,onChange:i=>u({...n,amount:i.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:n.description,onChange:i=>u({...n,description:i.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.active,onChange:i=>u({...n,active:i.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Us(){const[t,c]=a.useState([]),[g,h]=a.useState([]),[l,r]=a.useState(!1),[n,u]=a.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});a.useEffect(()=>{f(),m()},[]);const f=async()=>{try{const x=localStorage.getItem("token"),k=await fetch(`${J}/reminders`,{headers:{Authorization:`Bearer ${x}`}});if(!k.ok){console.error("API Error:",k.status,k.statusText),c([]);return}const b=await k.json();Array.isArray(b)?c(b):(console.error("Expected array but got:",typeof b,b),c([]))}catch(x){console.error("Failed to fetch reminders:",x),c([])}},m=async()=>{try{const x=localStorage.getItem("token"),k=await fetch(`${J}/products`,{headers:{Authorization:`Bearer ${x}`}});if(!k.ok){console.error("API Error:",k.status,k.statusText),h([]);return}const b=await k.json();Array.isArray(b)?h(b):(console.error("Expected array but got:",typeof b,b),h([]))}catch(x){console.error("Failed to fetch products:",x),h([])}},N=async x=>{x.preventDefault();try{const k=localStorage.getItem("token"),b=await fetch(`${J}/reminders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify(n)});if(!b.ok){const w=await b.json();console.error("Failed to create reminder:",w),alert(`Failed to create reminder: ${w.error||"Unknown error"}`);return}const y=await b.json();u({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),r(!1),f(),alert("Reminder created successfully!")}catch(k){console.error("Failed to create reminder:",k),alert("Failed to create reminder. Please try again.")}},v=async x=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const b=localStorage.getItem("token"),y=await fetch(`${J}/reminders/${x}`,{method:"DELETE",headers:{Authorization:`Bearer ${b}`}});if(!y.ok){const w=await y.json();console.error("Failed to delete reminder:",w),alert(`Failed to delete reminder: ${w.error||"Unknown error"}`);return}f(),alert("Reminder deleted successfully!")}catch(k){console.error("Failed to delete reminder:",k),alert("Failed to delete reminder. Please try again.")}},i=x=>{n.days.includes(x)?u({...n,days:n.days.filter(k=>k!==x)}):u({...n,days:[...n.days,x]})},$=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(ut,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("button",{onClick:()=>r(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(ie,{size:20}),"New Reminder"]})]}),e.jsx("div",{className:"grid gap-4",children:t.map(x=>{const k=g.find(b=>b.id===x.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${x.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:x.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",k?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",x.frequency]}),x.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",x.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(He,{size:16}),"Next: ",new Date(x.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${x.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:x.status}),e.jsx("button",{onClick:()=>v(x.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(xe,{size:20})})]})]})},x.id)})}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:N,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:n.customerName,onChange:x=>u({...n,customerName:x.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:n.productId,onChange:x=>u({...n,productId:parseInt(x.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),g.map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:n.frequency,onChange:x=>u({...n,frequency:x.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),n.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:$.map(x=>e.jsx("button",{type:"button",onClick:()=>i(x),className:`px-4 py-2 rounded-lg font-medium transition ${n.days.includes(x)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:x},x))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:n.nextDate,onChange:x=>u({...n,nextDate:x.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>r(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})}function Fs(){const[t,c]=a.useState([]),[g,h]=a.useState(!1),[l,r]=a.useState(null),[n,u]=a.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});a.useEffect(()=>{f()},[]);const f=async()=>{try{const i=await Ue.getAll();c(i)}catch(i){console.error("Failed to load discounts:",i)}},m=async i=>{i.preventDefault();try{l?await Ue.update(l.id,n):await Ue.create(n),h(!1),r(null),u({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),f()}catch($){console.error("Failed to save discount:",$)}},N=async i=>{if(confirm("Delete this discount?"))try{await Ue.delete(i),f()}catch($){console.error("Failed to delete discount:",$)}},v=i=>{const $=new Date,x=new Date(i.validFrom),k=new Date(i.validTo);return i.active&&x<=$&&k>=$};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{h(!0),r(null),u({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(i=>e.jsxs("div",{className:`card ${v(i)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${v(i)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(it,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:i.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[i.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${v(i)?"badge-success":"bg-gray-200 text-gray-600"}`,children:v(i)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(i.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(i.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{r(i),u(i),h(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(ve,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>N(i.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(xe,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},i.id)),t.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(it,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[l?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:n.name,onChange:i=>u({...n,name:i.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:n.percentage,onChange:i=>u({...n,percentage:parseFloat(i.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:n.validFrom,onChange:i=>u({...n,validFrom:i.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:n.validTo,onChange:i=>u({...n,validTo:i.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.active,onChange:i=>u({...n,active:i.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Rs(){const[t,c]=a.useState([]),[g,h]=a.useState([]),[l,r]=a.useState("all");a.useEffect(()=>{n(),u()},[]);const n=async()=>{try{const x=await lt.getAll();c(x)}catch(x){console.error("Failed to load credit requests:",x)}},u=async()=>{try{const x=await se.getAll();h(x)}catch(x){console.error("Failed to load products:",x)}},f=async x=>{try{await lt.approve(x),n()}catch(k){console.error("Failed to approve request:",k)}},m=async x=>{try{await lt.reject(x),n()}catch(k){console.error("Failed to reject request:",k)}},N=x=>{const k=g.find(b=>b.id===x);return k?k.name:"Unknown Product"},v=t.filter(x=>l==="all"?!0:x.status===l),i=x=>{switch(x){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},$=x=>{switch(x){case"pending":return e.jsx(Le,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(Ee,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(ct,{className:"w-6 h-6 text-red-600"});default:return e.jsx(ze,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(x=>e.jsx("button",{onClick:()=>r(x),className:`px-4 py-2 rounded-lg font-medium transition ${l===x?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:x.charAt(0).toUpperCase()+x.slice(1)},x))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[v.map(x=>e.jsx("div",{className:`card border-l-4 ${i(x.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${x.status==="pending"?"bg-orange-600":x.status==="approved"?"bg-green-600":"bg-red-600"}`,children:$(x.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:x.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:N(x.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:x.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",x.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(x.createdAt).toLocaleString()]}),x.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(x.approvedAt).toLocaleString()]})]})]}),x.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>f(x.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Ee,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>m(x.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(ct,{size:16}),"Reject"]})]}),x.status!=="pending"&&e.jsx("span",{className:`badge ${x.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:x.status.toUpperCase()})]})},x.id)),v.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(ze,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",l!=="all"?l:""," credit requests found."]})]})]})]})}function Bt({onClose:t}){const[c,g]=a.useState([]),[h,l]=a.useState(!0),r=a.useRef({data:null,timestamp:null}),n=3e4;a.useEffect(()=>{u()},[]);const u=async()=>{try{const m=Date.now();if(r.current.data&&r.current.timestamp&&m-r.current.timestamp<n){console.log("ðŸ“¦ Using cached reminders"),g(r.current.data),l(!1);return}const N=localStorage.getItem("token"),v=await fetch(`${J}/reminders/today`,{headers:{Authorization:`Bearer ${N}`}});if(!v.ok){console.error("API Error:",v.status,v.statusText),g([]),l(!1);return}const i=await v.json();Array.isArray(i)?(r.current.data=i,r.current.timestamp=Date.now(),g(i)):(console.error("Expected array but got:",typeof i,i),g([]))}catch(m){console.error("Failed to fetch reminders:",m),g([])}finally{l(!1)}},f=async m=>{try{const N=localStorage.getItem("token");await fetch(`${J}/reminders/${m}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${N}`},body:JSON.stringify({status:"fulfilled"})}),r.current={data:null,timestamp:null},u()}catch(N){console.error("Failed to update reminder:",N)}};return h?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:t,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(Se,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Me,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):c.map(m=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:m.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",m.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:m.frequency})]}),e.jsxs("button",{onClick:()=>f(m.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Ee,{size:18}),"Mark Done"]})]},m.id))})]})})}function _t({onUnlock:t,userType:c="user"}){const[g,h]=a.useState(""),[l,r]=a.useState(""),[n,u]=a.useState("password"),[f,m]=a.useState(!1),[N,v]=a.useState(""),[i,$]=a.useState(!1),[x,k]=a.useState("2005"),b=JSON.parse(localStorage.getItem("user")||"{}");a.useEffect(()=>{(async()=>{try{const A=await De.get();A?.screenLockPassword&&k(A.screenLockPassword)}catch(A){console.warn("Failed to load settings, using default password:",A)}})()},[]),a.useEffect(()=>{const L=document.getElementById(n==="password"?"unlock-password":"unlock-pin");L&&L.focus()},[n]);const y=async L=>{L.preventDefault(),L.stopPropagation(),$(!0),v("");try{const A=localStorage.getItem("token");if(!A)throw new Error("No authentication token found");const O=await fetch("https://posifine22.onrender.com/api/auth/unlock-screen",{method:"POST",headers:{Authorization:`Bearer ${A}`,"Content-Type":"application/json"},body:JSON.stringify({pin:l})});if(!O.ok){const _=await O.json();throw O.status===429?new Error(_.message||"Too many failed attempts. Try again later."):O.status===401?new Error(_.message||"Incorrect PIN"):new Error(_.message||"Unlock failed")}const R=await O.json();R.token&&localStorage.setItem("token",R.token),r(""),h(""),t(R)}catch(A){v(A.message||"Unlock failed")}finally{$(!1)}},w=L=>{const A=L.replace(/\D/g,"").slice(0,4);r(A)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:L=>L.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8",onClick:L=>L.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${c==="main_admin"?"bg-gradient-to-br from-red-600 to-orange-600":"bg-gradient-to-br from-blue-600 to-purple-600"}`,children:e.jsx(ne,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-gray-600",children:c==="main_admin"?"Main Admin":b.name||"User"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Enter your ",n," to continue"]})]}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter PIN to unlock"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",id:"unlock-pin",value:l,onChange:L=>w(L.target.value),placeholder:"0000",maxLength:"4",className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-center tracking-widest text-2xl",disabled:i})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"ðŸ”’ PIN validated securely on server"})]}),N&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-red-700 text-sm font-medium",children:[N.includes("Too many")?"âŒ ":"âš ï¸ ",N]})}),e.jsx("button",{type:"submit",disabled:i||l.length<4,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 rounded-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"}),"Verifying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-5 h-5"}),"Unlock Screen"]})})]})]})})}function Ht(t=6e4){const[c,g]=a.useState(!1),h=a.useRef(Date.now()),l=a.useCallback(()=>{h.current=Date.now(),g(!1)},[]),r=a.useCallback(()=>{g(!1),h.current=Date.now()},[]);return a.useEffect(()=>{const n=["mousedown","mousemove","keypress","scroll","touchstart","click"],u=()=>{h.current=Date.now(),c&&g(!1)};n.forEach(m=>{document.addEventListener(m,u,!0)});const f=setInterval(()=>{Date.now()-h.current>t&&!c&&g(!0)},5e3);return()=>{n.forEach(m=>{document.removeEventListener(m,u,!0)}),clearInterval(f)}},[t,c]),[c,r,l]}function qs(){const{user:t,logout:c,isCashierUserManagementEnabled:g}=he(),h=ke(),l=St(),[r,n]=a.useState(!0),[u,f]=a.useState(!1),[m,N]=a.useState({}),[v,i]=Ht(45e3);a.useEffect(()=>{const y=()=>{const L=localStorage.getItem("user");if(L){const A=JSON.parse(L);let O=!1;(A.plan==="ultra"||A.role==="admin")&&(A.active||(A.active=!0,O=!0),A.plan==="ultra"&&A.role!=="admin"&&(A.role="admin",O=!0),A.plan==="ultra"&&(!A.price||A.price!==1600)&&(A.price=1600,O=!0),O&&(localStorage.setItem("user",JSON.stringify(A)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};y(),setTimeout(y,100);const w=setTimeout(()=>{f(!0)},1e3);return $(),()=>clearTimeout(w)},[]);const $=async()=>{try{const y=await De.get();N(y)}catch(y){console.error("Failed to load settings:",y)}},x=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses data? This action cannot be undone."))try{const y=localStorage.getItem("token"),L=await fetch(`${J}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!L.ok){const A=await L.json();throw new Error(A.message||"Failed to clear data")}alert("Data cleared successfully!"),window.location.reload()}catch(y){console.error("Failed to clear data:",y),alert("Failed to clear data: "+y.message)}},k=[{id:"overview",label:"Dashboard",icon:ss,path:"/admin"},{id:"sales",label:"Sales",icon:Ct,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:Ne,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:It,path:"/admin/recipes"},{id:"expenses",label:"Expenses",icon:Be,path:"/admin/expenses"},...g()?[{id:"users",label:"Users",icon:we,path:"/admin/users"}]:[],{id:"time",label:"Time Tracking",icon:Le,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:ut,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:ye,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:it,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:ze,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:as,path:"/admin/settings"}],b=y=>y==="/admin"?l.pathname==="/admin":l.pathname.startsWith(y);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${r?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[r&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>n(!r),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r?e.jsx(Se,{className:"w-5 h-5"}):e.jsx(rs,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:k.map(y=>{const w=y.icon;return e.jsxs("button",{onClick:()=>h(y.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${b(y.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(w,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:y.label})]},y.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(ls,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:c,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(ht,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Logout"})]}),e.jsxs("button",{onClick:x,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors",children:[e.jsx(Se,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Clear Data"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:k.find(y=>b(y.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:t?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(kt,{children:[e.jsx(z,{path:"/",element:e.jsx(ks,{})}),e.jsx(z,{path:"/sales",element:e.jsx(Is,{})}),e.jsx(z,{path:"/inventory",element:e.jsx(As,{})}),e.jsx(z,{path:"/recipes",element:e.jsx(Ds,{})}),e.jsx(z,{path:"/expenses",element:e.jsx(Es,{})}),e.jsx(z,{path:"/reminders",element:e.jsx(Us,{})}),e.jsx(z,{path:"/service-fees",element:e.jsx(Os,{})}),e.jsx(z,{path:"/discounts",element:e.jsx(Fs,{})}),e.jsx(z,{path:"/credit-requests",element:e.jsx(Rs,{})}),e.jsx(z,{path:"/users",element:e.jsx(Ts,{})}),e.jsx(z,{path:"/time",element:e.jsx(Ls,{})}),e.jsx(z,{path:"/settings",element:e.jsx($s,{})})]})})]}),u&&e.jsx(Bt,{onClose:()=>f(!1)}),v&&e.jsx(_t,{onUnlock:i,logo:m.logo})]})}function Ms(){const t=ke(),[c,g]=a.useState(!1),[h,l]=a.useState(0),r=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 1,600 - 1 Cashier) or Ultra (KSH 3,000 - Unlimited) package",image:"ðŸ“",details:"First user becomes Admin automatically. Basic supports 1 cashier. Ultra supports unlimited cashiers with full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],n=[{icon:Ne,title:"Smart Inventory",desc:"Track raw materials & composite products with automatic stock deduction"},{icon:It,title:"Recipe Builder",desc:"Create bundled products with BOM and auto-calculate COGS"},{icon:Ae,title:"Real-time Analytics",desc:"Monitor sales, profit margins, and expenses in real-time"},{icon:we,title:"User Management",desc:"Add cashiers with custom permissions and role-based access"},{icon:_e,title:"Secure & Reliable",desc:"JWT authentication with role-based security"},{icon:ot,title:"Advanced Reports",desc:"Daily, weekly summaries with profit/loss tracking"}],u=[{name:"Ultra",price:3e3,icon:Tt,popular:!0,features:["Admin + Cashier Dashboard","Full Inventory Management","Recipe/BOM Builder","Auto Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Unlimited Cashiers","Priority Support"]},{name:"Basic",price:1600,icon:Lt,popular:!1,features:["Cashier Dashboard","Basic Inventory","Sales Tracking","Daily/Weekly Reports","Basic Profit/Loss View","Email Support","1 Cashier Only"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/auth/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(ns,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx($e,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>g(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(Et,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 30-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ot,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:n.map((f,m)=>{const N=f.icon;return e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(N,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:f.title}),e.jsx("p",{className:"text-gray-600",children:f.desc})]},m)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:u.map((f,m)=>{const N=f.icon;return e.jsxs("div",{className:`relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${f.popular?"ring-4 ring-blue-600":""}`,children:[f.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${f.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(N,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:f.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",f.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:f.features.map((v,i)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:v})]},i))}),e.jsx("button",{onClick:()=>t("/plans"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${f.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},m)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx($e,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{g(!1),l(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Se,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",h+1," of ",r.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((h+1)/r.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(h+1)/r.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:r[h].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:r[h].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:r[h].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:r[h].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>l(Math.max(0,h-1)),disabled:h===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),h<r.length-1?e.jsxs("button",{onClick:()=>l(h+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx($e,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{g(!1),l(0),t("/plans")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx($e,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:r.map((f,m)=>e.jsx("button",{onClick:()=>l(m),className:`w-2 h-2 rounded-full transition-all ${m===h?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},m))})]})]})})]})}function wt(){const t=St(),[c,g]=a.useState(t.pathname==="/auth/login"),[h,l]=a.useState("password"),[r,n]=a.useState({email:"",password:"",pin:"",name:"",newPassword:"",confirmPassword:""}),[u,f]=a.useState(""),[m,N]=a.useState(!1),[v,i]=a.useState(!1),$=ke(),{login:x}=he(),k=()=>{try{return JSON.parse(localStorage.getItem("selectedPlan")||"null")}catch(y){return console.warn("Invalid selectedPlan in localStorage:",y),null}},b=async y=>{y.preventDefault(),f(""),N(!0);try{if(v){if(r.newPassword!==r.confirmPassword){f("Passwords do not match"),N(!1);return}if(r.newPassword.length<6){f("Password must be at least 6 characters"),N(!1);return}const R=await je.login({email:r.email,newPassword:r.newPassword});R.token&&R.user&&(await x(R),$("/dashboard"));return}if(c){if(h==="pin"){if(!r.pin||r.pin.length!==4){f("Please enter a valid 4-digit PIN"),N(!1);return}}else if(!r.password){f("Please enter your password"),N(!1);return}}let w;if(c)if(h==="pin")try{w=await je.pinLogin({email:r.email,pin:r.pin})}catch(R){if(R.message.includes("PIN not set"))f("PIN not set for this user. Please use password login.");else if(R.message.includes("Invalid PIN"))f("Invalid PIN. Please try again.");else throw R;N(!1);return}else w=await je.login({email:r.email,password:r.password});else{const R=k(),_=localStorage.getItem("planId")||R?.id||"basic";w=await je.signup({...r,planId:_})}if(w.needsPasswordSetup){i(!0),n({...r,email:w.email}),f(""),N(!1);return}if(!w||!w.user||!w.token)throw new Error("Authentication failed. Please try again.");const L={id:Date.now(),type:c?"login":"signup",user:{id:w.user.id,name:w.user.name,email:w.user.email,role:w.user.role,plan:w.user.plan},timestamp:new Date().toISOString(),ip:"Unknown",userAgent:navigator.userAgent},A=JSON.parse(localStorage.getItem("authActivities")||"[]");A.unshift(L),A.splice(50),localStorage.setItem("authActivities",JSON.stringify(A)),await x(w);const O=c?"logged in":"signed up";console.log(`âœ… User ${w.user.name} ${O} successfully`),w.user.role==="admin"?$("/admin"):w.user.role==="cashier"||w.user.plan==="basic"?$("/dashboard/cashier"):$("/admin")}catch(w){console.error("Authentication error:",w);let L=w.message||"Authentication failed. Please try again.";w.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),L="Invalid credentials. Please try again."),f(L)}finally{N(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:c?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600",children:c?"Login to your account":"Create your account"})]}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[v?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.newPassword,onChange:y=>n({...r,newPassword:y.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.confirmPassword,onChange:y=>n({...r,confirmPassword:y.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!c&&e.jsxs("div",{className:"relative",children:[e.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.name,onChange:y=>n({...r,name:y.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.email,onChange:y=>n({...r,email:y.target.value}),required:!0})]}),c&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Login Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>l("password"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${h==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Password"}),e.jsx("button",{type:"button",onClick:()=>l("pin"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${h==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"pin"})]})]}),c&&h==="password"&&e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.password,onChange:y=>n({...r,password:y.target.value}),required:!0})]}),c&&h==="pin"&&e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.pin,onChange:y=>n({...r,pin:y.target.value.replace(/\D/g,"").slice(0,4)}),maxLength:4,required:!0})]}),!c&&e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.password,onChange:y=>n({...r,password:y.target.value}),required:!0})]})]}),u&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:u}),e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50",children:m?"Please wait...":v?"Set Password":c?"Login":"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{g(!c),f(""),i(!1)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:c?"Don't have an account? Sign up":"Already have an account? Login"})})]})})}function Bs(){const[t,c]=a.useState("ultra"),[g,h]=a.useState(!1),[l,r]=a.useState({name:"",email:"",company:""}),n=ke(),u=[{id:"ultra",name:"Ultra Package (Unlimited)",price:3e3,icon:Tt,color:"from-blue-600 to-purple-600",popular:!0,features:["Admin Dashboard + Cashier POS","Full Inventory Management","Recipe/BOM Builder","Composite Products Support","Automatic Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Advanced Analytics","Unlimited Cashiers","Priority Support"]},{id:"basic",name:"Basic Package",price:1600,icon:Lt,color:"from-green-500 to-teal-600",popular:!1,features:["Admin Dashboard + Cashier POS","Basic Inventory Management","Sales Tracking","Daily/Weekly Sales Summaries","Basic Profit/Loss View","Email Notifications","Record Products Sold","1 Cashier Only"]}],f=async m=>{m.preventDefault();try{await fetch(`${J}/demo-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),alert("Demo request submitted! Admin will review and contact you."),h(!1),r({name:"",email:"",company:""})}catch(N){console.error("Demo request failed:",N),alert("Failed to submit demo request. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:()=>n("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition",children:[e.jsx(is,{size:20}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mb-8 md:mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Select the perfect plan for your business needs"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6 md:mb-8",children:u.map(m=>{const N=m.icon;return e.jsxs("div",{onClick:()=>c(m.id),className:`card cursor-pointer transition-all transform hover:scale-105 relative ${t===m.id?"ring-4 ring-blue-600 shadow-2xl bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-xl"}`,children:[m.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 md:mb-4",children:[e.jsx("div",{className:`w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br ${m.color} flex items-center justify-center`,children:e.jsx(N,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:m.name})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("span",{className:"text-3xl md:text-4xl font-bold",children:["KSH ",m.price]}),e.jsx("span",{className:"text-gray-600 text-sm md:text-base",children:"/month"})]}),e.jsx("ul",{className:"space-y-2 md:space-y-3",children:m.features.map((v,i)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Je,{className:"w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs md:text-sm",children:v})]},i))})]},m.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center animate-fade-in",children:[e.jsx("button",{onClick:()=>{console.log("Get Started clicked with plan:",t);const m=u.find(N=>N.id===t);console.log("Selected plan:",m),localStorage.setItem("selectedPlan",JSON.stringify(m)),n("/auth/signup")},className:"btn-primary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all",children:"Get Started"}),e.jsx("button",{onClick:()=>h(!0),className:"btn-secondary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg border-2 border-gray-300 hover:border-gray-400 transition-all",children:"Request Free Demo"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-3 md:mt-4 text-center",children:"Secure payment â€¢ Cancel anytime"}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Free Demo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"We'll contact you to schedule a demo"})]}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:l.name,onChange:m=>r({...l,name:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:l.email,onChange:m=>r({...l,email:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:l.company,onChange:m=>r({...l,company:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition",children:"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})})}function _s(){const{user:t,logout:c}=he(),[g,h]=a.useState([]),[l,r]=a.useState([]),[n,u]=a.useState([]),[f,m]=a.useState("cash"),[N,v]=a.useState("pos"),[i,$]=a.useState({sales:[],expenses:[],stats:{}}),[x,k]=a.useState(""),[b,y]=a.useState(!1),[w,L]=a.useState(!1),[A,O]=a.useState(null),[R,_]=a.useState({name:"",price:"",cost:"",category:"finished",image:""}),[I,D]=a.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[U,H]=a.useState(!1),[W,ae]=a.useState({description:"",amount:"",category:""}),[ce,oe]=a.useState(""),[de,pe]=a.useState([]),[B,ee]=a.useState(null),[V,p]=a.useState("exclusive"),[d,S]=a.useState(!1),[T,P]=a.useState(null),[q,K]=a.useState(null),[X,G]=a.useState({});a.useEffect(()=>{ue();const s=localStorage.getItem(`cart_${t?.id}`),j=localStorage.getItem(`paymentMethod_${t?.id}`),C=localStorage.getItem(`selectedDiscount_${t?.id}`),E=localStorage.getItem(`taxType_${t?.id}`),M=localStorage.getItem(`clockStatus_${t?.id}`),Y=localStorage.getItem(`clockInTime_${t?.id}`);if(s)try{u(JSON.parse(s))}catch(re){console.warn("Failed to restore cart:",re)}if(j&&m(j),E&&p(E),C)try{ee(JSON.parse(C))}catch{}M==="clocked_in"&&(S(!0),Y&&K(new Date(Y))),Ye()},[t?.id]),a.useEffect(()=>{const s=localStorage.getItem("token");s&&Ge.connect(s,C=>{if(C&&C.allProducts){const E=C.allProducts.filter(M=>M.visibleToCashier!==!1&&!M.expenseOnly);h(E)}C&&C.discounts&&pe(C.discounts),C&&C.sale&&ue()}).catch(C=>{console.warn("WebSocket connection failed:",C)});const j=ys(C=>{try{if(!C)return;(C.type==="initial"||C.type==="products_snapshot"||C.type==="product_created"||C.type==="product_updated"||C.type==="product_deleted")&&se.getAll().then(E=>h(E.filter(M=>M.visibleToCashier!==!1&&!M.expenseOnly))).catch(()=>{})}catch(E){console.error("Product subscription handler error",E)}});return()=>{try{j()}catch{}Ge.disconnect()}},[]),a.useEffect(()=>{(n.length>0||f||V)&&fe()},[n,f,V,B,t?.id]);const fe=()=>{localStorage.setItem(`cart_${t?.id}`,JSON.stringify(n)),localStorage.setItem(`paymentMethod_${t?.id}`,f),localStorage.setItem(`taxType_${t?.id}`,V),B&&localStorage.setItem(`selectedDiscount_${t?.id}`,JSON.stringify(B))},Q=async()=>{try{const s=await fetch(`${J}/clock-in`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(s.ok){const j=await s.json();P(j.entry),S(!0);const C=new Date(j.entry.clockIn);K(C),localStorage.setItem(`clockStatus_${t?.id}`,"clocked_in"),localStorage.setItem(`clockInTime_${t?.id}`,C.toISOString()),alert("âœ… "+j.message)}else{const j=await s.json();alert("âš ï¸ "+(j.message||"Failed to clock in"))}}catch(s){console.error("Clock in failed:",s),alert("Failed to clock in")}},Ve=async()=>{try{const s=await fetch(`${J}/clock-out`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(s.ok){const j=await s.json();P(j.entry),S(!1),K(null),localStorage.removeItem(`clockStatus_${t?.id}`),localStorage.removeItem(`clockInTime_${t?.id}`),alert("âœ… "+j.message)}else{const j=await s.json();alert("âš ï¸ "+(j.message||"Failed to clock out"))}}catch(s){console.error("Clock out failed:",s),alert("Failed to clock out")}},Ye=async()=>{try{const s=await fetch(`${J}/clock-status`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(s.ok){const j=await s.json();j.isClockedIn&&(S(!0),K(new Date(j.clockInTime)))}}catch(s){console.warn("Failed to check clock status:",s)}},ue=async()=>{try{const[s,j,C,E,M]=await Promise.all([se.getAll(),Te.getAll(),Ke.getAll(),Ut.get(),We.getAll()]);h(s.filter(Y=>Y.visibleToCashier!==!1&&!Y.expenseOnly)),$({sales:j,expenses:C,stats:E}),r(M);try{const Y=await fetch(`${J}/discounts`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(re=>re.json());pe(Y||[])}catch(Y){console.warn("Failed to load discounts:",Y)}}catch(s){console.error("Failed to load data:",s)}},Qe=(s,j=!0)=>{const C=s.target.files[0];if(C){const E=new FileReader;E.onload=M=>{const Y=M.target.result;oe(Y),j&&_({...R,image:Y})},E.readAsDataURL(C)}},be=s=>l.filter(C=>C.productId===s&&C.quantity>0).reduce((C,E)=>C+E.quantity,0),Ze=s=>{const j=be(s.id);if(j<=0){alert("Product is out of stock!");return}const C=n.find(M=>M.id===s.id);if((C?C.quantity:0)>=j){alert(`Only ${j} units available in stock!`);return}u(C?n.map(M=>M.id===s.id?{...M,quantity:M.quantity+1}:M):[...n,{...s,quantity:1}])},Ce=(s,j)=>{g.find(E=>E.id===s);const C=be(s);u(n.map(E=>{if(E.id===s){const M=E.quantity+j;return M>C?(alert(`Only ${C} units available!`),E):{...E,quantity:Math.max(1,M)}}return E}).filter(E=>E.quantity>0))},Xe=s=>{u(n.filter(j=>j.id!==s))},Z=n.reduce((s,j)=>s+j.price*j.quantity,0),et=async()=>{if(n.length!==0)try{const s=B?B.type==="percentage"?Z*B.value/100:B.value:0,j=Z*.16,C=V==="inclusive"?Z-s:Z-s+j,E=n.map(me=>({productId:me.id,quantity:me.quantity,unit:X[me.id]||me.unit||"piece",price:me.price})),M=await Te.create({items:E,total:C,discount:s,tax:j,taxType:V,paymentMethod:f}),re=(await se.getAll()).filter(me=>me.visibleToCashier!==!1&&!me.expenseOnly);h(re),u([]),G({}),ee(null),p("exclusive"),await ue(),alert("Sale completed successfully!")}catch(s){console.error("Checkout failed:",s),alert("Sale failed. Please try again.")}},tt=async s=>{s.preventDefault();try{await se.create({...R,price:parseFloat(R.price),cost:parseFloat(R.cost||0),quantity:0}),_({name:"",price:"",cost:"",category:"finished",image:""}),oe(""),y(!1),await ue(),alert("Product added successfully!")}catch(j){console.error("Failed to add product:",j),alert("Failed to add product")}},st=async s=>{s.preventDefault();try{const j=Array.isArray(l)?l:[],E={id:j.length>0?Math.max(...j.map(M=>M.id||0))+1:1,productId:A.id,quantity:parseInt(I.quantity),expiryDate:I.expiryDate,batchNumber:I.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(I.cost||A.cost||0)};r(M=>[...M,E]),await We.create({productId:A.id,quantity:parseInt(I.quantity),expiryDate:I.expiryDate,batchNumber:I.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(I.cost||A.cost||0)}),D({quantity:"",expiryDate:"",batchNumber:"",cost:""}),L(!1),O(null),await ue(),alert("Stock added successfully!")}catch(j){console.error("Failed to add stock:",j),alert("Failed to add stock")}},at=async s=>{s.preventDefault();try{await Ke.create({...W,amount:parseFloat(W.amount)}),ae({description:"",amount:"",category:""}),H(!1),await ue()}catch(j){console.error("Failed to add expense:",j),alert("Failed to add expense")}},o=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses? This action cannot be undone."))try{const s=localStorage.getItem("token"),C=await fetch(`${J}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!C.ok){const E=await C.json();throw new Error(E.message||"Failed to clear data")}$({sales:[],expenses:[],stats:{totalSales:0,totalExpenses:0,profit:0}}),u([]),alert("Data cleared successfully!"),await ue()}catch(s){console.error("Failed to clear data:",s),alert("Failed to clear data: "+s.message)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Cashier Dashboard"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cashier Plan - KSH 900/month"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),d&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-green-600 font-semibold",children:"ðŸŸ¢ Clocked In"}),e.jsxs("button",{onClick:Ve,className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-600 hover:bg-red-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(cs,{className:"w-4 h-4"}),"Clock Out"]})]}),!d&&e.jsxs("button",{onClick:Q,className:"px-4 py-2 rounded-lg font-medium transition-all bg-green-600 hover:bg-green-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(Et,{className:"w-4 h-4"}),"Clock In"]}),e.jsxs("button",{onClick:()=>{fe(),c()},className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-100 hover:bg-red-200 text-red-600 border border-red-300 flex items-center gap-2",children:[e.jsx(ht,{className:"w-4 h-4"}),"Logout"]}),e.jsxs("button",{onClick:o,className:"px-4 py-2 rounded-lg font-medium transition-all bg-orange-100 hover:bg-orange-200 text-orange-600 border border-orange-300 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Clear"]}),d&&q&&e.jsx("div",{className:"ml-auto text-right text-xs",children:e.jsxs("p",{className:"text-green-600 font-semibold flex items-center gap-1",children:[e.jsx(Le,{className:"w-4 h-4"}),"Clocked In: ",q.toLocaleTimeString()]})})]})]})}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>v("pos"),className:`px-6 py-2 rounded-lg font-medium transition-all ${N==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Re,{className:"w-4 h-4 inline mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>v("monitor"),className:`px-6 py-2 rounded-lg font-medium transition-all ${N==="monitor"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(ot,{className:"w-4 h-4 inline mr-2"}),"Monitor"]}),e.jsxs("button",{onClick:()=>v("products"),className:`px-6 py-2 rounded-lg font-medium transition-all ${N==="products"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ne,{className:"w-4 h-4 inline mr-2"}),"Products"]}),e.jsxs("button",{onClick:()=>v("expenses"),className:`px-6 py-2 rounded-lg font-medium transition-all ${N==="expenses"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Be,{className:"w-4 h-4 inline mr-2"}),"Expenses"]})]}),N==="pos"&&e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(mt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:x,onChange:s=>k(s.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:g.filter(s=>s.name?.toLowerCase().includes(x.toLowerCase())).map(s=>{const j=be(s.id),C=j<10,E=j<=0;return e.jsxs("button",{onClick:()=>Ze(s),disabled:E,className:`card text-left hover:shadow-xl transition-all transform hover:scale-105 relative ${E?"opacity-50 cursor-not-allowed bg-gray-100":"bg-gradient-to-br from-white to-gray-50"}`,children:[s.image&&e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover"})}),C&&!E&&e.jsx("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white p-1 rounded-full",children:e.jsx(Ie,{className:"w-4 h-4"})}),E&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"OUT"}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-900",children:s.name}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["KSH ",s.price?.toLocaleString()]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:`text-xs font-medium ${E?"text-red-600":C?"text-yellow-600":"text-gray-500"}`,children:["Stock: ",j]}),C&&!E&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium",children:"Low Stock"})]})]},s.id)})})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-gray-200 p-6 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(Re,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[n.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:n.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(Re,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:n.map(s=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("button",{onClick:()=>Xe(s.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(xe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Ce(s.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(os,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-semibold",children:s.quantity}),e.jsx("button",{onClick:()=>Ce(s.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(ie,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(s.price*s.quantity).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2 items-center mt-2",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-600",children:"Unit:"}),e.jsxs("select",{value:X[s.id]||s.unit||"piece",onChange:j=>{G({...X,[s.id]:j.target.value})},className:"text-xs px-2 py-1 border border-gray-300 rounded bg-white",children:[e.jsx("option",{value:"piece",children:"Piece"}),e.jsx("option",{value:"kg",children:"Kilogram (kg)"}),e.jsx("option",{value:"g",children:"Grams (g)"}),e.jsx("option",{value:"l",children:"Liters (L)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",max:"999",placeholder:"qty",defaultValue:s.quantity,className:"text-xs px-2 py-1 border border-gray-300 rounded w-16",onChange:j=>{const C=parseFloat(j.target.value);!isNaN(C)&&C>0&&Ce(s.id,C-s.quantity)}})]})]},s.id))})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"text-gray-700",children:["KSH ",Z.toLocaleString()]})]}),B&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-KSH ",(B.type==="percentage"?Z*B.value/100:B.value).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-orange-600",children:[e.jsxs("span",{children:["Tax (",V==="exclusive"?"Added":"Included","):"]}),e.jsxs("span",{children:[V==="exclusive"?"+":"","KSH ",((Z-(B?B.type==="percentage"?Z*B.value/100:B.value:0))*.16).toLocaleString()]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Final Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(V==="exclusive"?Z-(B?B.type==="percentage"?Z*B.value/100:B.value:0)+(Z-(B?B.type==="percentage"?Z*B.value/100:B.value:0))*.16:Z-(B?B.type==="percentage"?Z*B.value/100:B.value:0)).toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Discount (Optional)"}),e.jsxs("select",{value:B?.id||"",onChange:s=>{s.target.value?ee(de.find(j=>j.id===parseInt(s.target.value))):ee(null)},className:"input",children:[e.jsx("option",{value:"",children:"No Discount"}),de.filter(s=>s.active).map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.type==="percentage"?`${s.value}%`:`KSH ${s.value}`]},s.id))]}),B&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Discount: KSH ",(B.type==="percentage"?Z*B.value/100:B.value).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tax Type"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"exclusive",checked:V==="exclusive",onChange:s=>p(s.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Exclusive (16% added)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"inclusive",checked:V==="inclusive",onChange:s=>p(s.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Inclusive"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:f,onChange:s=>m(s.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:et,disabled:n.length===0,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg",children:"Complete Sale"})]})]})]}),N==="monitor"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",i.stats.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(ye,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",i.stats.totalExpenses?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Be,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",i.stats.profit?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(ye,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Sales"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"})]})}),e.jsx("tbody",{children:i.sales.slice(-15).reverse().map((s,j)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(s.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[s.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:s.paymentMethod||"cash"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",s.total?.toLocaleString()]})]},j))})]})})]})]}),N==="products"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Manage Products & Stock"}),e.jsxs("button",{onClick:()=>y(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700",children:[e.jsx(ie,{className:"w-4 h-4"}),"Add Product"]})]}),b&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl border-2 border-green-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Product"}),e.jsxs("form",{onSubmit:tt,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:R.name,onChange:s=>_({...R,name:s.target.value}),required:!0}),e.jsxs("select",{className:"input",value:R.category,onChange:s=>_({...R,category:s.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsx("input",{type:"number",placeholder:"Selling Price",className:"input",value:R.price,onChange:s=>_({...R,price:s.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Cost Price (Optional)",className:"input",value:R.cost,onChange:s=>_({...R,cost:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:s=>Qe(s,!0),className:"input"}),e.jsx(Pt,{className:"w-5 h-5 text-gray-400"})]}),ce&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:ce,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{y(!1),oe(""),_({name:"",price:"",cost:"",category:"finished",image:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),w&&A&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"font-semibold mb-4 text-lg",children:["Add Stock for ",A.name]}),e.jsxs("form",{onSubmit:st,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:I.quantity,onChange:s=>D({...I,quantity:s.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:I.expiryDate,onChange:s=>D({...I,expiryDate:s.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:I.batchNumber,onChange:s=>D({...I,batchNumber:s.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per Unit",className:"input",value:I.cost,onChange:s=>D({...I,cost:s.target.value})}),e.jsxs("div",{className:"flex gap-2 md:col-span-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{L(!1),O(null),D({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:g.map(s=>{const j=be(s.id),C=l.filter(M=>M.productId===s.id&&M.quantity>0),E=j<10;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.image&&e.jsx("img",{src:s.image,alt:s.name,className:"w-10 h-10 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.category})]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",s.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium ${j===0?"text-red-600":E?"text-yellow-600":"text-gray-900"}`,children:j}),E&&j>0&&e.jsx(Ie,{className:"w-4 h-4 text-yellow-500"}),j===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"text-gray-600",children:[C.length," active"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{O(s),L(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-green-50 rounded-lg text-green-600 transition-colors",title:"Edit Product",children:e.jsx(ve,{className:"w-4 h-4"})})]})})]},s.id)})})]})})]})}),N==="expenses"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Track Expenses"}),e.jsxs("button",{onClick:()=>H(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700",children:[e.jsx(ie,{className:"w-4 h-4"}),"Add Expense"]})]}),U&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border-2 border-red-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Expense"}),e.jsxs("form",{onSubmit:at,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:W.description,onChange:s=>ae({...W,description:s.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Amount",className:"input",value:W.amount,onChange:s=>ae({...W,amount:s.target.value}),required:!0}),e.jsx("input",{type:"text",placeholder:"Category",className:"input",value:W.category,onChange:s=>ae({...W,category:s.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>H(!1),className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:i.expenses.slice().reverse().map((s,j)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:s.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:s.category||"General"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",s.amount?.toLocaleString()]})]},j))})]})})]})})]})}function Hs(){const[t,c]=a.useState([]),[g,h]=a.useState([]),[l,r]=a.useState("all"),[n,u]=a.useState(""),[f,m]=a.useState(!1),[N,v]=a.useState([]),[i,$]=a.useState({subject:"",message:""}),[x,k]=a.useState(!0),[b,y]=a.useState(null),[w,L]=a.useState(!0),[A,O]=a.useState(null),R=ke(),[_,I]=a.useState({totalUsers:0,activeUsers:0,lockedUsers:0,totalRevenue:0,pendingPayments:0,overduePayments:0}),[D,U]=a.useState([]);a.useEffect(()=>{const p=localStorage.getItem("mainAdminToken"),d=localStorage.getItem("mainAdminUser");if(!p||!d){R("/main-admin/login");return}H().finally(()=>k(!1));const S=JSON.parse(localStorage.getItem("authActivities")||"[]");U(S.slice(0,10));const T=setInterval(()=>{const P=JSON.parse(localStorage.getItem("authActivities")||"[]");U(P.slice(0,10))},5e3);return()=>clearInterval(T)},[R]);const H=async()=>{try{y(null);let p=[],d=[],S=!0;try{p=await Fe.getUsers(),d=await Fe.getPayments()}catch(T){console.warn("MainAdmin API not available, falling back to regular users API:",T.message);try{p=await ge.getAll()}catch(P){console.warn("Users API also failed:",P.message),S=!1}S||(d=[],L(!1))}p.length===0&&!S&&(p=ae(),d=ce(p)),c(p),h(d),L(S),oe(p,d)}catch(p){console.error("Failed to load data:",p),y("Failed to load dashboard data");const d=ae();c(d),h(ce(d)),L(!1),oe(d,[])}},W=()=>{localStorage.removeItem("mainAdminToken"),localStorage.removeItem("mainAdminUser"),R("/main-admin/login")},ae=()=>{const p=localStorage.getItem("user"),d=[];if(p){const T=JSON.parse(p);d.push({...T,id:T.id||"real-user"})}return[{name:"John Doe",email:"john@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Jane Smith",email:"jane@example.com",plan:"basic",price:900,active:!0,locked:!1,role:"cashier"},{name:"Bob Wilson",email:"bob@example.com",plan:"ultra",price:1600,active:!1,locked:!1,role:"admin"},{name:"Alice Brown",email:"alice@example.com",plan:"basic",price:900,active:!0,locked:!0,role:"cashier"},{name:"Mike Johnson",email:"mike@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Sarah Davis",email:"sarah@example.com",plan:"basic",price:900,active:!1,locked:!1,role:"cashier"}].forEach((T,P)=>{d.push({id:`demo-${P+1}`,...T,createdAt:new Date(Date.now()-P*864e5).toISOString(),lastLogin:new Date(Date.now()-Math.random()*864e5).toISOString()})}),d},ce=p=>p.flatMap(d=>[{id:`payment-${d.id}-1`,userId:d.id,amount:d.plan==="ultra"?1600:900,status:Math.random()>.3?"paid":"pending",createdAt:new Date(Date.now()-30*864e5).toISOString(),dueDate:new Date(Date.now()+5*864e5).toISOString()},{id:`payment-${d.id}-2`,userId:d.id,amount:d.plan==="ultra"?1600:900,status:Math.random()>.7?"paid":Math.random()>.5?"pending":"overdue",createdAt:new Date(Date.now()-60*864e5).toISOString(),dueDate:new Date(Date.now()-5*864e5).toISOString()}]),oe=(p,d)=>{const S=p.length,T=p.filter(G=>G.active).length,P=p.filter(G=>G.locked).length,q=d.filter(G=>G.status==="paid").reduce((G,fe)=>G+fe.amount,0),K=d.filter(G=>G.status==="pending").length,X=d.filter(G=>G.status==="overdue").length;I({totalUsers:S,activeUsers:T,lockedUsers:P,totalRevenue:q,pendingPayments:K,overduePayments:X})},de=async(p,d)=>{try{O(p);const S=!d;try{await Fe.lockUser(p,S);const T=t.map(K=>K.id===p?{...K,locked:S,active:!S}:K);c(T),oe(T,g);const P=t.find(K=>K.id===p),q=S?"locked":"unlocked";alert(`âœ… ${P?.name||`User ${p}`} has been ${q} successfully!`)}catch(T){console.error("API lock failed:",T);const P=t.map(X=>X.id===p?{...X,locked:S,active:!S}:X);c(P),oe(P,g);const q=t.find(X=>X.id===p),K=S?"locked":"unlocked";alert(`âš ï¸ Backend not available. ${q?.name||`User ${p}`} ${K} locally. Changes will sync when backend is available.`)}}catch(S){console.error("Failed to toggle lock:",S),alert(`âŒ Failed to update user status: ${S.message}`)}finally{O(null)}},pe=async(p,d,S)=>{try{k(!0);try{await Fe.sendEmail({userIds:p,subject:d,message:S}),alert("Emails sent successfully!"),m(!1),v([]),$({subject:"",message:""});return}catch(q){console.warn("Backend email operation failed, simulating email send:",q.message)}const T=t.filter(q=>p.includes(q.id)),P=JSON.parse(localStorage.getItem("emailLogs")||"[]");P.push({timestamp:new Date().toISOString(),recipients:T.map(q=>({id:q.id,name:q.name,email:q.email})),subject:d,message:S,status:"simulated"}),localStorage.setItem("emailLogs",JSON.stringify(P)),alert(`âœ… Email simulation successful!

ðŸ“§ Sent to ${T.length} user(s):
${T.map(q=>`${q.name} (${q.email})`).join(`
`)}

${w?"":`ðŸ“Œ Backend not deployed - this was a simulation.
`}ðŸ’¡ Deploy backend to send real emails.`),m(!1),v([]),$({subject:"",message:""})}catch(T){console.error("Failed to send email:",T),alert("Failed to process email request.")}finally{k(!1)}},B=async p=>{const d=t.find(S=>S.id===p);d&&await pe([p],"Payment Reminder - Subscription",`Dear ${d.name},

This is a friendly reminder about your pending subscription payment for ${d.plan?.toUpperCase()} plan (KSH ${d.price}).

Please complete your payment to continue enjoying our services.

Thank you!`)},ee=t.filter(p=>{const d=p.name?.toLowerCase().includes(n.toLowerCase())||p.email?.toLowerCase().includes(n.toLowerCase());if(l==="all")return d;if(l==="active")return d&&p.active&&!p.locked;if(l==="locked")return d&&p.locked;if(l==="trial")return d&&(!p.active||!p.plan);if(l==="pending-payment"){const S=g.filter(T=>T.userId===p.id&&T.status==="pending");return d&&S.length>0}if(l==="overdue"){const S=g.filter(T=>T.userId===p.id&&T.status==="overdue");return d&&S.length>0}return d}),V=p=>{const d=g.filter(q=>q.userId===p),S=d.filter(q=>q.status==="pending").length,T=d.filter(q=>q.status==="overdue").length,P=d.filter(q=>q.status==="paid").length;return{pending:S,overdue:T,paid:P,total:d.length}};return x&&t.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-white mx-auto mb-4"}),e.jsx("p",{className:"text-white text-xl",children:"Loading Main Admin Dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900",children:[!w&&e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm md:text-base font-semibold",children:["âš ï¸ Demo Mode: Backend not available. Actions are simulated locally.",e.jsx("a",{href:"/BACKEND_NOT_DEPLOYED.md",className:"underline ml-2",children:"Deploy Backend â†’"})]})}),b&&e.jsx("div",{className:"bg-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm font-semibold",children:["âš ï¸ ",b]})}),e.jsx("header",{className:"bg-black/30 backdrop-blur-lg border-b border-white/10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Main Admin Dashboard"}),e.jsx("p",{className:"text-gray-300",children:"Monitor all users, payments, and system activity"})]}),e.jsxs("button",{onClick:W,className:"flex items-center gap-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 px-4 py-2 rounded-lg transition-colors",children:[e.jsx(ht,{className:"w-4 h-4"}),"Logout"]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(we,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:_.totalUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ee,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:_.activeUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Active Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ne,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:_.lockedUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Locked Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ye,{className:"w-8 h-8 text-yellow-400"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:["KSH ",_.totalRevenue.toLocaleString()]})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ie,{className:"w-8 h-8 text-orange-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:_.pendingPayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Pending Payments"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ct,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:_.overduePayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Overdue Payments"})]})]}),e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 flex-1 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-80",children:[e.jsx(mt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",value:n,onChange:p=>u(p.target.value)})]}),e.jsxs("select",{value:l,onChange:p=>r(p.target.value),className:"px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"locked",children:"Locked"}),e.jsx("option",{value:"trial",children:"Free Trial"}),e.jsx("option",{value:"pending-payment",children:"Pending Payment"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsxs("button",{onClick:()=>m(!0),disabled:N.length===0||x,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-3 rounded-lg font-bold flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(dt,{className:"w-5 h-5"}),"Send Email to Selected (",N.length,")"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"xl:col-span-2 bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"All Users"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left",children:e.jsx("input",{type:"checkbox",checked:N.length===ee.length&&ee.length>0,onChange:p=>{p.target.checked?v(ee.map(d=>d.id)):v([])},className:"w-5 h-5 rounded"})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Actions"})]})}),e.jsxs("tbody",{children:[ee.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:"5",className:"px-4 py-12 text-center",children:[e.jsx(we,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:n||l!=="all"?"Try adjusting your filters":"Users will appear here once they sign up"})]})}),ee.map(p=>(V(p.id),e.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:N.includes(p.id),onChange:d=>{d.target.checked?v([...N,p.id]):v(N.filter(S=>S!==p.id))},className:"w-5 h-5 rounded"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[p.profilePicture?e.jsx("img",{src:p.profilePicture,alt:p.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:p.name?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:p.name}),e.jsx("p",{className:"text-sm text-gray-400",children:p.email})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${p.plan==="ultra"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"}`,children:[p.plan?.toUpperCase()," - KSH ",p.price]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"flex items-center gap-2",children:p.locked?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-300 flex items-center gap-1",children:[e.jsx(ne,{className:"w-3 h-3"}),"Locked"]}):p.active?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-300 flex items-center gap-1",children:[e.jsx(Ee,{className:"w-3 h-3"}),"Active"]}):e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-500/20 text-gray-300",children:"Inactive"})})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>de(p.id,p.locked),disabled:A===p.id,className:`p-2 rounded-lg transition ${p.locked?"bg-green-500/20 hover:bg-green-500/30 text-green-300":"bg-red-500/20 hover:bg-red-500/30 text-red-300"} ${A===p.id?"opacity-50 cursor-not-allowed":""}`,title:p.locked?"Unlock User":"Lock User",children:A===p.id?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):p.locked?e.jsx(ds,{className:"w-4 h-4"}):e.jsx(ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>B(p.id),disabled:x,className:"p-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 transition",title:"Send Payment Reminder",children:e.jsx(ms,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{p.role==="cashier"?window.open("/dashboard/cashier","_blank"):window.open("/admin","_blank")},className:"p-2 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 transition",title:"View User Dashboard",children:e.jsx(Dt,{className:"w-4 h-4"})})]})})]},p.id)))]})]})})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl border border-white/20",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5"}),"Recent Activity"]})}),e.jsx("div",{className:"p-4 space-y-3 max-h-96 overflow-y-auto",children:D.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"No recent activity"}):D.map(p=>e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${p.type==="login"?"bg-green-400":"bg-blue-400"}`}),e.jsx("span",{className:"text-white font-medium",children:p.user.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${p.type==="login"?"bg-green-500/20 text-green-300":"bg-blue-500/20 text-blue-300"}`,children:p.type})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:p.user.email}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:new Date(p.timestamp).toLocaleString()})]},p.id))})]})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-purple-900 rounded-2xl shadow-2xl max-w-2xl w-full border border-white/20",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(dt,{}),"Send Email to ",N.length," User(s)"]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Subject"}),e.jsx("input",{type:"text",value:i.subject,onChange:p=>$({...i,subject:p.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email subject..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Message"}),e.jsx("textarea",{value:i.message,onChange:p=>$({...i,message:p.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 h-40",placeholder:"Email message..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>pe(N,i.subject,i.message),disabled:x,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white py-3 rounded-lg font-bold transition disabled:opacity-50",children:x?"Sending...":"Send Email"}),e.jsx("button",{onClick:()=>m(!1),className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-lg font-bold transition",children:"Cancel"})]})]})]})})]})}function zs({user:t}){const[c,g]=a.useState(!1);if(c||!t)return null;const h=t?.serviceStartDate?new Date(t.serviceStartDate):null,l=t?.daysUsed||0,r=t?.plan||"",u=Math.max(0,30-l);return u>7?null:e.jsxs("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-3 md:p-4 flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(Me,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-amber-900",children:u===0?`Your ${r} plan has expired. Please renew to continue.`:`Your ${r} plan expires in ${u} day${u!==1?"s":""}. Consider upgrading.`}),e.jsxs("p",{className:"text-xs text-amber-700 mt-1",children:["Service started: ",h?.toLocaleDateString()||"Unknown"]})]})]}),e.jsx("button",{onClick:()=>g(!0),className:"flex-shrink-0 text-amber-600 hover:text-amber-900",children:e.jsx(Se,{className:"w-5 h-5"})})]})}function Js(){const{refreshProducts:t}=qt();return a.useEffect(()=>{const c=l=>{console.log("ðŸ“¦ Stock update received:",l.detail),t()},g=l=>{console.log("âœ… Sale completed, refreshing stock:",l.detail),t()},h=l=>{console.log("ðŸ”„ Products sync event:",l.detail)};return window.addEventListener("stockUpdate",c),window.addEventListener("saleComplete",g),window.addEventListener("productsSync",h),()=>{window.removeEventListener("stockUpdate",c),window.removeEventListener("saleComplete",g),window.removeEventListener("productsSync",h)}},[t]),null}function nt({children:t,adminOnly:c=!1,ultraOnly:g=!1,ownerOnly:h=!1}){const{user:l,loading:r}=he(),{isLocked:n,lock:u,unlock:f}=ws(),[m,N]=a.useState(!1),v=Ht(6e4),i=v?.[0]||n||!1,$=a.useCallback(()=>{v?.[1]?.(),f()},[v,f]),[x,k]=a.useState({});if(a.useEffect(()=>{l&&!h&&((async()=>{try{const w=localStorage.getItem("token"),A=await fetch(`${J}/settings`,{headers:{Authorization:`Bearer ${w}`}});if(A.ok){const O=await A.json();k(O)}}catch(w){console.error("Failed to load settings:",w)}})(),sessionStorage.getItem("reminderShown")||(N(!0),sessionStorage.setItem("reminderShown","true")))},[l,h]),a.useEffect(()=>{const y=w=>{console.log("ðŸ”’ Admin locked screen:",w.detail),u("admin")};return window.addEventListener("admin_locked_user_screen",y),()=>window.removeEventListener("admin_locked_user_screen",y)},[u]),r&&!h)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(h){const y=localStorage.getItem("ownerToken"),w=localStorage.getItem("ownerUser");if(!y||!w)return e.jsx(te,{to:"/main.admin"});try{if(JSON.parse(w).type!=="main_admin")return e.jsx(te,{to:"/main.admin"})}catch{return e.jsx(te,{to:"/main.admin"})}}else{if(!l)return e.jsx(te,{to:"/auth/login"});if(!l.active)return e.jsx(te,{to:"/plans"});if(c&&l.role!=="admin")return e.jsx(te,{to:"/dashboard"});if(g&&(l.role!=="admin"||l.plan!=="ultra"))return e.jsx(te,{to:"/dashboard"})}const b=h?"owner":"user";return e.jsxs(e.Fragment,{children:[e.jsx(zs,{}),e.jsx(Js,{}),i&&e.jsx(_t,{onUnlock:$,userType:b}),m&&e.jsx(Bt,{onClose:()=>N(!1)}),t]})}function Ks(){const{user:t}=he();return!t||!t.active?e.jsx(te,{to:"/plans"}):t.role==="admin"?e.jsx(te,{to:"/admin"}):e.jsx(te,{to:"/dashboard/cashier"})}function Ws(){return e.jsx(Ns,{children:e.jsx(vs,{children:e.jsx(Ss,{children:e.jsx(Gt,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(kt,{children:[e.jsx(z,{path:"/",element:e.jsx(Ms,{})}),e.jsx(z,{path:"/auth/login",element:e.jsx(wt,{})}),e.jsx(z,{path:"/auth/signup",element:e.jsx(wt,{})}),e.jsx(z,{path:"/plans",element:e.jsx(Bs,{})}),e.jsx(z,{path:"/main.admin/*",element:e.jsx(Hs,{})}),e.jsx(z,{path:"/dashboard",element:e.jsx(nt,{children:e.jsx(Ks,{})})}),e.jsx(z,{path:"/dashboard/cashier",element:e.jsx(nt,{children:e.jsx(_s,{})})}),e.jsx(z,{path:"/admin/*",element:e.jsx(nt,{adminOnly:!0,children:e.jsx(qs,{})})}),e.jsx(z,{path:"/login",element:e.jsx(te,{to:"/auth/login"})}),e.jsx(z,{path:"/signup",element:e.jsx(te,{to:"/auth/signup"})}),e.jsx(z,{path:"/subscription",element:e.jsx(te,{to:"/plans"})}),e.jsx(z,{path:"/payment",element:e.jsx(te,{to:"/plans"})}),e.jsx(z,{path:"/cashier",element:e.jsx(te,{to:"/dashboard/cashier"})})]})})})})})}gs.createRoot(document.getElementById("root")).render(e.jsx(Vt.StrictMode,{children:e.jsx(Ws,{})}));
