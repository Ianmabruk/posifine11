import{a as Kt,b as Vt,g as Gt,r as a,u as Pe,c as Ct,R as Pt,d as V,B as Qt,N as se,e as Yt}from"./vendor-Ct1st1Nj.js";import{C as Be,D as Se,T as De,P as ke,S as At,a as _e,b as Qe,c as le,d as Zt,e as Xt,f as Ee,g as je,h as ce,i as It,j as es,k as Dt,l as ts,L as ie,U as bt,m as jt,n as ze,E as Tt,M as yt,o as Ce,X as ye,p as Oe,q as qe,r as ut,s as Je,t as Nt,u as He,B as ht,R as ss,I as as,v as We,w as dt,x as $e,y as mt,z as Ke,A as rs,F as ls,G as ns,H as Et,J as is,K as cs,N as os,O as ds,Q as pt,V as ms,W as Fe,Y as $t,Z as xt,_ as Lt,$ as Ot,a0 as xs,a1 as us,a2 as hs,a3 as ps,a4 as gs}from"./icons-BVA-JfoF.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))b(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&b(l)}).observe(document,{childList:!0,subtree:!0});function f(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function b(n){if(n.ep)return;n.ep=!0;const r=f(n);fetch(n.href,r)}})();var nt={exports:{}},Ie={};var vt;function fs(){if(vt)return Ie;vt=1;var t=Kt(),c=Symbol.for("react.element"),f=Symbol.for("react.fragment"),b=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function l(m,g,u){var j,k={},d=null,E=null;u!==void 0&&(d=""+u),g.key!==void 0&&(d=""+g.key),g.ref!==void 0&&(E=g.ref);for(j in g)b.call(g,j)&&!r.hasOwnProperty(j)&&(k[j]=g[j]);if(m&&m.defaultProps)for(j in g=m.defaultProps,g)k[j]===void 0&&(k[j]=g[j]);return{$$typeof:c,type:m,key:d,ref:E,props:k,_owner:n.current}}return Ie.Fragment=f,Ie.jsx=l,Ie.jsxs=l,Ie}var wt;function bs(){return wt||(wt=1,nt.exports=fs()),nt.exports}var e=bs(),Ue={},St;function js(){if(St)return Ue;St=1;var t=Vt();return Ue.createRoot=t.createRoot,Ue.hydrateRoot=t.hydrateRoot,Ue}var ys=js();const Ns=Gt(ys),vs=()=>"https://posifine22.onrender.com/api",W=vs(),Ft=()=>localStorage.getItem("token"),Ut=async(t,c={},f=0,b=3)=>{const n=Ft(),r=t.startsWith("/")?t:`/${t}`,l={...c,headers:{"Content-Type":"application/json",...n&&!(r.startsWith("/auth")&&r!=="/auth/me")&&!r.includes("/main-admin/auth/login")&&{Authorization:`Bearer ${n}`},...c.headers}};try{const m=await fetch(`${W}${r}`,l);if(m.status===401){if(r.includes("/auth/login")||r.includes("/main-admin/auth/login")){const k=await m.json().catch(()=>({error:"Unauthorized"}));throw new Error(k.error||"Invalid credentials")}localStorage.removeItem("token"),localStorage.removeItem("user");const u=window.location.pathname||"";if(!u.includes("/login")&&!u.includes("/signup")&&!u.includes("/auth")&&!u.includes("/main.admin"))try{window.location.href="/login"}catch{}const j=new Error("Unauthorized");throw j.status=401,j}if(m.status===500)throw new Error("Server error 500 - Backend unavailable");if(m.ok)return m.status===204?{success:!0}:await m.json();const g=await m.json().catch(()=>({error:"Network error"}));throw new Error(g.error||`HTTP ${m.status}: ${m.statusText}`)}catch(m){if(m.name==="TypeError"&&m.message.includes("fetch")){if(console.error(`API Fetch Error (attempt ${f+1}/${b+1}):`,m),console.error("Attempted URL:",`${W}${r}`),f<b){const g=Math.min(1e3*Math.pow(2,f),1e4);return console.log(`Retrying in ${g}ms...`),await new Promise(u=>setTimeout(u,g)),Ut(t,c,f+1,b)}throw new Error("Cannot connect to server. The server may be waking up. Please try again in a moment.")}throw m}},F=(t,c={})=>Ut(t,c,0,3),we={login:t=>F("/auth/login",{method:"POST",body:JSON.stringify(t)}),pinLogin:t=>F("/auth/pin-login",{method:"POST",body:JSON.stringify(t)}),signup:t=>F("/auth/signup",{method:"POST",body:JSON.stringify(t)}),signupWithPayment:t=>F("/signup-with-payment",{method:"POST",body:JSON.stringify(t)}),me:()=>F("/auth/me"),updatePin:t=>F("/auth/update-pin",{method:"POST",body:JSON.stringify({pin:t})})},be={getAll:()=>F("/users"),create:t=>F("/users",{method:"POST",body:JSON.stringify(t)}),update:(t,c)=>F(`/users/${t}`,{method:"PUT",body:JSON.stringify(c)}),delete:t=>F(`/users/${t}`,{method:"DELETE"}),setPin:(t,c)=>F(`/users/${t}/set-pin`,{method:"POST",body:JSON.stringify({pin:c})}),lock:(t,c)=>F(`/users/${t}/lock`,{method:"POST",body:JSON.stringify({locked:c})})},ae={getAll:()=>F("/products"),create:t=>F("/products",{method:"POST",body:JSON.stringify(t)}),update:(t,c)=>F(`/products/${t}`,{method:"PUT",body:JSON.stringify(c)}),delete:t=>F(`/products/${t}`,{method:"DELETE"}),updateStock:(t,c)=>F(`/products/${t}/stock`,{method:"PUT",body:JSON.stringify(c)}),getMaxProducible:t=>F(`/products/${t}/max-producible`),getWeightPricing:t=>F(`/products/${t}/weight-pricing`),addWeightPrice:(t,c,f)=>F(`/products/${t}/weight-pricing`,{method:"POST",body:JSON.stringify({weight:c,price:f})}),updateWeightPrice:(t,c,f)=>F(`/products/${t}/weight-pricing`,{method:"PUT",body:JSON.stringify({weight:c,price:f})}),deleteWeightPrice:(t,c)=>F(`/products/${t}/weight-pricing`,{method:"DELETE",body:JSON.stringify({weight:c})})},Le={getAll:()=>F("/sales"),create:t=>F("/sales",{method:"POST",body:JSON.stringify(t)}),delete:t=>F(`/sales/${t}`,{method:"DELETE"}),adminComplete:t=>F("/admin-complete-sale",{method:"POST",body:JSON.stringify(t)})},Ve={getAll:()=>F("/expenses"),create:t=>F("/expenses",{method:"POST",body:JSON.stringify(t)}),update:(t,c)=>F(`/expenses/${t}`,{method:"PUT",body:JSON.stringify(c)}),delete:t=>F(`/expenses/${t}`,{method:"DELETE"})},Rt={get:async()=>{try{const t=await fetch(`${W}/api/stats`,{headers:{Authorization:`Bearer ${localStorage.getItem("userToken")}`}});if(t.ok)return await t.json()}catch(t){console.error("Failed to fetch stats:",t)}return{totalSales:0,totalExpenses:0,profit:0,productCount:0}}},Re={getAll:()=>F("/discounts"),create:t=>F("/discounts",{method:"POST",body:JSON.stringify(t)}),update:(t,c)=>F(`/discounts/${t}`,{method:"PUT",body:JSON.stringify(c)}),delete:t=>F(`/discounts/${t}`,{method:"DELETE"})},it={getAll:()=>F("/credit-requests"),create:t=>F("/credit-requests",{method:"POST",body:JSON.stringify(t)}),approve:t=>F(`/credit-requests/${t}/approve`,{method:"POST"}),reject:t=>F(`/credit-requests/${t}/reject`,{method:"POST"})},Te={get:()=>F("/settings"),update:t=>F("/settings",{method:"PUT",body:JSON.stringify(t)})},Ge={getAll:t=>{const c=t?`/batches?productId=${t}`:"/batches";return F(c)},create:t=>F("/batches",{method:"POST",body:JSON.stringify(t)})},ct={login:t=>F("/main-admin/auth/login",{method:"POST",body:JSON.stringify(t)}),getUsers:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return F("/main-admin/users",{headers:{Authorization:`Bearer ${t}`}})},getStats:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return F("/main-admin/stats",{headers:{Authorization:`Bearer ${t}`}})},getActivities:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return F("/main-admin/activities",{headers:{Authorization:`Bearer ${t}`}})},getSalesAll:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return F("/main-admin/sales-all",{headers:{Authorization:`Bearer ${t}`}})},getTimeEntriesAll:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return F("/main-admin/time-entries-all",{headers:{Authorization:`Bearer ${t}`}})},lockUser:(t,c)=>{const f=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return F(`/main-admin/users/${t}/lock`,{method:"POST",headers:{Authorization:`Bearer ${f}`},body:JSON.stringify({locked:c})})},changePlan:(t,c)=>{const f=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return F(`/main-admin/users/${t}/plan`,{method:"POST",headers:{Authorization:`Bearer ${f}`},body:JSON.stringify({plan:c})})},clearData:t=>{const c=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return F("/main-admin/system/clear-data",{method:"POST",headers:{Authorization:`Bearer ${c}`},body:JSON.stringify({type:t})})},getSubscribers:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return F("/main-admin/subscribers",{headers:{Authorization:`Bearer ${t}`}})},getSubscribersAnalytics:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return F("/main-admin/subscribers/analytics",{headers:{Authorization:`Bearer ${t}`}})},getUsersWithSubscriptions:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return F("/main-admin/users-with-subscriptions",{headers:{Authorization:`Bearer ${t}`}})}};let ne=null,Me=new Set;function ws(){const t=W.replace(/\/api$/,"");return`${t.startsWith("https")?"wss":"ws"}://${t.replace(/^https?:\/\//,"")}/api/ws/products`}function Ss(){if(ne&&(ne.readyState===WebSocket.OPEN||ne.readyState===WebSocket.CONNECTING))return;const t=Ft(),c=ws()+(t?`?token=${encodeURIComponent(t)}`:"");ne=new WebSocket(c),ne.onopen=()=>{console.debug("Products WS connected")},ne.onmessage=f=>{let b=null;try{b=JSON.parse(f.data)}catch{return}Me.forEach(n=>{try{n(b)}catch(r){console.error("ws callback error",r)}})},ne.onclose=()=>{console.debug("Products WS closed"),ne=null},ne.onerror=f=>{console.error("Products WS error",f)}}function ks(t){if(typeof t!="function")throw new Error("subscribeProducts requires a callback");return Me.add(t),Ss(),()=>{if(Me.delete(t),ne&&Me.size===0){try{ne.close()}catch{}ne=null}}}const qt=a.createContext(),me=()=>a.useContext(qt),Cs=({children:t})=>{const[c,f]=a.useState(null),[b,n]=a.useState(!0),[r,l]=a.useState(!1),[m,g]=a.useState({});a.useEffect(()=>{u()},[]),a.useEffect(()=>{const T=()=>{const U=localStorage.getItem("user");if(U)try{const H=JSON.parse(U);f(H)}catch(H){console.warn("Failed to parse user from localStorage",H)}else f(null)};return window.addEventListener("storage",T),window.addEventListener("localStorageUpdated",T),()=>{window.removeEventListener("storage",T),window.removeEventListener("localStorageUpdated",T)}},[]);const u=async()=>{try{const T=localStorage.getItem("token"),U=localStorage.getItem("user");if(T)try{const H=await fetch(`${W}/auth/me`,{headers:{Authorization:`Bearer ${T}`,"Content-Type":"application/json"}});if(H.ok){const G=await H.json();f(G),localStorage.setItem("user",JSON.stringify(G))}else throw new Error("Invalid token")}catch(H){console.warn("Auth check failed:",H),localStorage.removeItem("token"),localStorage.removeItem("user")}}catch(T){console.error("Error initializing auth:",T),localStorage.removeItem("token"),localStorage.removeItem("user"),f(null)}finally{n(!1),l(!0)}},j=async T=>{try{if(T&&T.token&&T.user)return localStorage.setItem("token",T.token),localStorage.setItem("user",JSON.stringify(T.user)),f(T.user),T;const U=await we.login(T);if(U.token&&U.user)return localStorage.setItem("token",U.token),localStorage.setItem("user",JSON.stringify(U.user)),f(U.user),U;throw new Error("Invalid response from server")}catch(U){throw console.error("Login failed:",U),U}},k=async T=>{try{const U=await we.signup(T);if(U.token&&U.user)return localStorage.setItem("token",U.token),localStorage.setItem("user",JSON.stringify(U.user)),f(U.user),U;throw new Error("Invalid response from server")}catch(U){throw console.error("Signup failed:",U),U}},d=async T=>{try{if(localStorage.setItem("user",JSON.stringify(T)),f(T),window.dispatchEvent(new Event("localStorageUpdated")),T&&T.id)try{await be.update(T.id,T)}catch(U){console.warn("Failed to persist updated user to backend",U)}return T}catch(U){throw console.error("updateUser failed:",U),U}},E=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),f(null),window.location.href="/login"},i=()=>!!c&&!!localStorage.getItem("token"),v=T=>c&&c.role===T,y=()=>c&&(c.role==="admin"||c.role==="main-admin"),N=()=>c&&c.role==="cashier",p=()=>c&&c.plan==="ultra",D=()=>c&&c.plan==="basic",P=()=>c&&(c.role==="admin"||c.role==="cashier"),M=()=>c&&c.role==="admin"&&c.plan==="ultra",R=()=>c&&c.role==="admin",q=()=>!0,A=()=>!0;return c?.locked?e.jsx(LockedAccount,{}):e.jsx(qt.Provider,{value:{user:c,loading:b,isInitialized:r,appSettings:m,login:j,signup:k,updateUser:d,logout:E,isAuthenticated:i,hasRole:v,isAdmin:y,isCashier:N,isUltraPackage:p,isBasicPackage:D,canEditStock:P,canManageUsers:M,canViewAnalytics:R,isRealTimeProductSyncEnabled:q,isCashierUserManagementEnabled:A},children:t})};new Date().toISOString();const Mt=a.createContext(),Bt=()=>a.useContext(Mt),Ps=({children:t})=>{const{user:c}=me(),[f,b]=a.useState([]),[n,r]=a.useState(!0),[l,m]=a.useState(null),[g,u]=a.useState(Date.now()),j=a.useCallback(async()=>{if(!localStorage.getItem("token")){r(!1);return}try{const d=await ae.getAll(),i=(Array.isArray(d)?d:[]).filter(v=>!v.pendingDelete);b(i),m(null),window.dispatchEvent(new CustomEvent("productsSync",{detail:{products:i,timestamp:Date.now()}}))}catch(d){console.error("Failed to fetch products:",d),m(`Failed to load products: ${d.message}`),b([])}finally{r(!1),u(Date.now())}},[]);a.useEffect(()=>{j()},[]),a.useEffect(()=>{const d=()=>{console.log("ðŸ”„ Data cleared event received - forcing products refresh"),b([]),m(null),j()};return window.addEventListener("dataCleared",d),window.addEventListener("productsCleared",d),()=>{window.removeEventListener("dataCleared",d),window.removeEventListener("productsCleared",d)}},[]);const k=async()=>{r(!0),await j()};return e.jsx(Mt.Provider,{value:{products:f,loading:n,error:l,lastUpdated:g,refreshProducts:k},children:t})},_t=a.createContext(),As=()=>a.useContext(_t),Is=900*1e3,Ds=({children:t})=>{const{user:c}=me(),[f,b]=a.useState(!1),n=a.useRef(null),r=a.useRef(Date.now()),l=a.useCallback(()=>{r.current=Date.now(),n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{b(!0),console.log("ðŸ”’ Screen locked due to inactivity")},Is)},[]);a.useEffect(()=>{const j=["mousedown","keydown","click","touchstart"];return j.forEach(k=>{document.addEventListener(k,l)}),l(),()=>{j.forEach(k=>{document.removeEventListener(k,l)}),n.current&&clearTimeout(n.current)}},[l]);const m=a.useCallback(()=>{b(!0),console.log("ðŸ”’ Screen manually locked")},[]),g=a.useCallback(()=>{b(!1),l(),console.log("ðŸ”“ Screen unlocked")},[l]),u={isLocked:f,lock:m,unlock:g};return e.jsx(_t.Provider,{value:u,children:t})};function Ts(){const[t,c]=a.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[f,b]=a.useState(!0),[n,r]=a.useState(null);a.useEffect(()=>{l()},[]);const l=async()=>{try{r(null);const[u,j]=await Promise.all([Rt.get(),Le.getAll()]),k={totalSales:u?.totalSales||0,totalExpenses:u?.totalExpenses||0,profit:u?.profit||0,grossProfit:u?.grossProfit||0,netProfit:u?.netProfit||0,totalCOGS:u?.totalCOGS||0,dailySales:u?.dailySales||0,weeklySales:u?.weeklySales||0,productCount:u?.productCount||0},d=Array.isArray(j)?j:[];c({stats:k,recentSales:d.slice(-10).reverse()})}catch(u){console.error("Failed to load data:",u),r(u.message),c({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{b(!1)}};if(f)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(n&&t.stats.totalSales===0&&t.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Be,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:n}),e.jsx("button",{onClick:l,className:"btn-primary",children:"Retry"})]})});const m=[{label:"Total Sales",value:`KSH ${t.stats.totalSales?.toLocaleString()||0}`,icon:Se,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${t.stats.grossProfit?.toLocaleString()||0}`,icon:De,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${t.stats.totalCOGS?.toLocaleString()||0}`,icon:ke,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${t.stats.netProfit?.toLocaleString()||0}`,icon:De,color:"from-purple-500 to-pink-600",change:"+15.3%"}],g=[{label:"Daily Sales",value:`KSH ${t.stats.dailySales?.toLocaleString()||0}`,icon:At,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${t.stats.weeklySales?.toLocaleString()||0}`,icon:De,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${t.stats.totalExpenses?.toLocaleString()||0}`,icon:_e,color:"bg-red-50 text-red-600"},{label:"Products",value:t.stats.productCount||0,icon:ke,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(m||[]).map((u,j)=>{const k=u?.icon;return k?e.jsxs("div",{className:`card bg-gradient-to-br ${u.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(k,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:u.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:u.label}),e.jsx("p",{className:"text-2xl font-bold",children:u.value})]},j):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(g||[]).map((u,j)=>{const k=u?.icon;return k?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${u.color} flex items-center justify-center`,children:e.jsx(k,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:u.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:u.value})]})]})},j):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!t.recentSales||t.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Be,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(t.recentSales||[]).map(u=>u?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:u.createdAt?new Date(u.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(u.items)?u.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:u.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",u.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",u.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",u.profit?.toLocaleString()||0]})]},u.id||Math.random()):null)})]})})]})]})}const Es=()=>"https://posifine22.onrender.com/api".replace("https://","wss://").replace("http://","ws://");class $s{constructor(){this.ws=null,this.listeners={stock_updated:[],sale_completed:[],admin_sale_completed:[],product_created:[],product_updated:[],product_deleted:[],heartbeat:[],initial:[],error:[]},this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.isManualClose=!1}connect(c,f){return new Promise((b,n)=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){b();return}if(!c){n(new Error("No token provided for WebSocket connection"));return}const r=`${Es()}/ws/products?token=${encodeURIComponent(c)}`;try{this.ws=new WebSocket(r),this.ws.onopen=()=>{console.log("âœ… WebSocket connected for real-time updates"),this.reconnectAttempts=0,b()},this.ws.onmessage=l=>{try{const m=JSON.parse(l.data),g=m.type?m.type.toLowerCase():"unknown";g==="stock_updated"?(console.log("ðŸ“¦ Stock update received:",m.data),f&&f(m.data),this.emit("stock_updated",m.data)):g==="sale_completed"?(console.log("ðŸ’° Sale completed - stock deducted:",m.data),this.emit("sale_completed",m.data),f&&m.data.updatedProducts&&f({allProducts:m.data.updatedProducts})):g==="admin_sale_completed"?(console.log("ðŸ‘¨â€ðŸ’¼ Admin sale completed:",m.data),this.emit("admin_sale_completed",m.data),this.emit("sale_completed",m.data),f&&m.data.updatedProducts&&f({allProducts:m.data.updatedProducts})):g==="product_created"?(console.log("âœ¨ Product created:",m.data),this.emit("product_created",m.data)):g==="product_updated"?(console.log("ðŸ“ Product updated:",m.data),this.emit("product_updated",m.data),f&&m.data.allProducts&&f({allProducts:m.data.allProducts})):g==="product_deleted"?(console.log("ðŸ—‘ï¸ Product deleted:",m.data),this.emit("product_deleted",m.data),f&&m.data.allProducts&&f({allProducts:m.data.allProducts})):g==="initial"?(console.log("ðŸ“¦ Initial products loaded via WebSocket"),this.emit("initial",m.products)):g==="heartbeat"?this.emit("heartbeat",m):(console.log(`ðŸ“¨ Message received (${g}):`,m.data),g!=="unknown"&&this.emit(g,m.data))}catch(m){console.error("Error parsing WebSocket message:",m)}},this.ws.onerror=l=>{console.error("âŒ WebSocket error:",l),this.emit("error",l),n(l)},this.ws.onclose=()=>{console.log("ðŸ”Œ WebSocket disconnected"),this.isManualClose||this.attemptReconnect(c,f)}}catch(l){console.error("Failed to create WebSocket:",l),n(l)}})}attemptReconnect(c,f){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Max reconnection attempts reached");return}this.reconnectAttempts++;const b=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`ðŸ”„ Reconnecting in ${b}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect(c,f).catch(n=>{console.error("Reconnection failed:",n)})},b)}on(c,f){this.listeners[c]||(this.listeners[c]=[]),this.listeners[c].push(f)}emit(c,f){this.listeners[c]&&this.listeners[c].forEach(b=>{try{b(f)}catch(n){console.error(`Error in ${c} listener:`,n)}})}disconnect(){this.isManualClose=!0,this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}}const fe=new $s;function Ls(){const{user:t,isUltraPackage:c,isRealTimeProductSyncEnabled:f}=me(),{products:b,refreshProducts:n}=Bt(),[r,l]=a.useState([]),[m,g]=a.useState([]),[u,j]=a.useState(!1),[k,d]=a.useState("all"),[E,i]=a.useState(""),[v,y]=a.useState(!1),[N,p]=a.useState(!1),[D,P]=a.useState(!1),[M,R]=a.useState(!1),[q,A]=a.useState(null),[T,U]=a.useState({}),[H,G]=a.useState({weight:"",price:""}),[oe,ue]=a.useState(null),[te,de]=a.useState(null),[he,z]=a.useState(!1),[re,Y]=a.useState(null),[w,h]=a.useState(""),[S,I]=a.useState({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),[O,_]=a.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[L,K]=a.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0}),X=async()=>{try{console.log("ðŸ“¦ Loading inventory data..."),await n();const s=await Ge.getAll();g(s),console.log("âœ… Inventory data loaded")}catch(s){console.error("âŒ Failed to load data:",s),Q("Failed to load inventory data","error")}};a.useEffect(()=>{u||(X(),j(!0));const s=localStorage.getItem("token");return s&&(fe.connect(s,o=>{o&&o.allProducts&&o.allProducts.length>0&&(console.log("ðŸ“¦ WebSocket stock update received:",o.allProducts.length,"products"),l(o.allProducts))}).catch(o=>{console.warn("WebSocket connection failed:",o)}),fe.on("sale_completed",o=>{if(console.log("ðŸ”„ Sale completed - updating inventory display:",o),o.updatedProducts&&o.updatedProducts.length>0&&(console.log(`âœ… Updating ${o.updatedProducts.length} products from sale`),l(o.updatedProducts),Q(`âœ… Stock updated! Sale #${o.saleId} deducted inventory`,"success")),o.lowStockWarnings&&o.lowStockWarnings.length>0){const C=o.lowStockWarnings.map($=>`${$.name}: ${$.current} left`).join(", ");Q(`âš ï¸ Low stock alert: ${C}`,"warning")}})),()=>{fe.disconnect()}},[u]),a.useEffect(()=>{b&&b.length>0&&r.length===0&&(console.log("ðŸ“¦ Initial sync from global context:",b.length,"products"),l(b))},[b.length]);const Ne=(s,o=!0)=>{const C=s.target.files[0];if(C){if(C.size>2*1024*1024){Q("Image must be smaller than 2MB","error");return}const $=new FileReader;$.onload=B=>{const J=B.target.result;h(J),o?I({...S,image:J}):(K({...L,image:J}),L.id&&setTimeout(async()=>{try{await ae.update(L.id,{image:J}),Q("âœ… Image saved","success")}catch(xe){console.error("Failed to save image:",xe)}},500))},$.readAsDataURL(C)}},pe=s=>m.filter(C=>C.productId===s&&C.quantity>0).reduce((C,$)=>C+$.quantity,0),Ye=s=>m.filter(o=>o.productId===s&&o.quantity>0),Q=(s,o="success")=>{de({message:s,type:o}),setTimeout(()=>de(null),5e3)},ge=async s=>{s.preventDefault();try{const o={...S,price:parseFloat(S.price),cost:parseFloat(S.cost||0),quantity:0,visibleToCashier:!S.expenseOnly&&S.visibleToCashier!==!1},C=await ae.create(o);I({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),h(""),y(!1),await X(),Q(`âœ… Product "${C.name}" added successfully! ${C.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success")}catch(o){console.error("Failed to create product:",o),alert(`Failed to create product: ${o.message||"Unknown error"}`)}},Ze=async s=>{s.preventDefault();try{const o={id:`batch-${Date.now()}`,productId:q.id,quantity:parseInt(O.quantity),expiryDate:O.expiryDate,batchNumber:O.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(O.cost||q.cost||0)};g(C=>[...C,o]),Q("âš¡ Adding stock...","info");try{await Ge.create({productId:q.id,quantity:parseInt(O.quantity),expiryDate:O.expiryDate,batchNumber:O.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(O.cost||q.cost||0)}),_({quantity:"",expiryDate:"",batchNumber:"",cost:""}),P(!1),A(null),await X(),Q(`âœ… Stock added successfully for ${q.name}!`,"success")}catch(C){throw g($=>$.filter(B=>B.id!==o.id)),C}}catch(o){console.error("Failed to add stock:",o),Q(`âŒ Failed to add stock: ${o.message||"Unknown error"}`,"error")}},ve=async s=>{s.preventDefault();try{const o=r.find(B=>B.id===L.id);if(parseFloat(L.price)<o.price){alert("You cannot lower prices, only increase.");return}const C={...L,price:parseFloat(L.price),cost:parseFloat(L.cost),quantity:parseFloat(L.quantity)},$={...o,...C};l(B=>B.map(J=>J.id===L.id?$:J)),z(!0),Q("âš¡ Updating product...","info");try{const B=await ae.update(L.id,C);p(!1),f()?(window.dispatchEvent(new CustomEvent("productUpdated",{detail:{product:B,originalProduct:o,timestamp:new Date().toISOString(),type:"update"}})),Q("âœ… Product updated and synced!","success")):Q("âœ… Product updated successfully!","success"),Y(new Date)}catch(B){throw l(J=>J.map(xe=>xe.id===L.id?o:xe)),B}finally{z(!1)}}catch(o){console.error("Failed to update product:",o),Q(`âŒ Update failed: ${o.message||"Unknown error"}`,"error")}},Xe=async s=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const o=r.find($=>$.id===s),C=await ae.delete(s);if(l($=>$.filter(B=>B.id!==s)),f()&&o)z(!0),window.dispatchEvent(new CustomEvent("productDeleted",{detail:{product:o,timestamp:new Date().toISOString(),type:"delete"}})),Q(`ðŸ“¡ Product "${o.name}" deleted and synced to all dashboards!`,"success"),Y(new Date),setTimeout(()=>{z(!1)},3e3);else{const $=C?.message||"Product deleted successfully!";alert($)}await n()}catch(o){console.error("Failed to delete product:",o);let C="Failed to delete product";o.message.includes("Failed to execute")||o.message.includes("JSON")?C="Network error. Please check your connection and try again.":o.message.includes("401")||o.message.includes("unauthorized")?C="You are not authorized to delete this product.":o.message.includes("404")||o.message.includes("not found")?C="Product not found. It may have been deleted already.":o.message&&(C=`Failed to delete product: ${o.message}`),alert(C)}},Ae=(r||[]).filter(s=>{if(!s)return!1;const o=s.name?.toLowerCase().includes(E.toLowerCase()),C=k==="all"||k==="raw"&&!s.recipe||k==="composite"&&s.recipe||k==="expense"&&s.expenseOnly||k==="low-stock"&&s.quantity<10;return o&&C}),et=(r||[]).filter(s=>s&&!s.recipe&&!s.expenseOnly),ee=(r||[]).filter(s=>s&&s.recipe),tt=(r||[]).filter(s=>s&&s.expenseOnly),st=s=>{if(!s||!s.recipe)return 0;let o=1/0;return(s.recipe||[]).forEach(C=>{if(!C)return;const $=(r||[]).find(B=>B&&B.id===C.productId);if($&&$.quantity>0&&C.quantity>0){const B=Math.floor($.quantity/C.quantity);o=Math.min(o,B)}}),o===1/0?0:o},at=s=>{if(!s)return 0;if(!s.recipe)return s.cost||0;let o=0;return(s.recipe||[]).forEach(C=>{if(!C)return;const $=(r||[]).find(B=>B&&B.id===C.productId);if($&&$.quantity>0){const B=($.cost||0)/$.quantity;o+=B*(C.quantity||0)}}),o},rt=async s=>{A(s);try{const o=await ae.getWeightPricing(s.id);U(o.weightPricing||{})}catch(o){console.error("Failed to load weight pricing:",o),U({})}R(!0)},lt=async s=>{if(s.preventDefault(),!H.weight||!H.price){Q("âŒ Please enter both weight and price","error");return}try{const o=parseFloat(H.weight),C=parseFloat(H.price);if(o*10%1!==0){Q("âŒ Weight must be in 0.1kg increments (0.1, 0.2, 0.3, etc)","error");return}await ae.addWeightPrice(q.id,o,C),U({...T,[String(o)]:C}),G({weight:"",price:""}),Q(`âœ… Weight price added for ${o}kg`,"success")}catch(o){Q(`âŒ Failed to add weight price: ${o.message}`,"error")}},x=async s=>{if(confirm(`Delete pricing for ${s}kg?`))try{await ae.deleteWeightPrice(q.id,s);const o={...T};delete o[String(s)],U(o),Q(`âœ… Weight price for ${s}kg deleted`,"success")}catch(o){Q(`âŒ Failed to delete weight price: ${o.message}`,"error")}};return e.jsxs("div",{className:"p-6 space-y-6",children:[te&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${te.type==="success"?"bg-green-50 border border-green-200 text-green-800":te.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:te.message}),e.jsx("button",{onClick:()=>de(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:E,onChange:s=>i(s.target.value)})]}),e.jsxs("select",{value:k,onChange:s=>d(s.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>y(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:et.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:ee.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:tt.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(Ae||[]).map(s=>{if(!s)return null;const o=at(s),C=s.price?((s.price-o)/s.price*100).toFixed(1):0,$=st(s),B=oe===s.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-12 h-12 object-cover rounded-lg",onError:J=>{J.target.style.display="none",J.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:s.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.recipe&&e.jsx("button",{onClick:()=>ue(B?null:s.id),className:"p-1 hover:bg-gray-200 rounded",children:B?e.jsx(Zt,{className:"w-4 h-4"}):e.jsx(Xt,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:s.name}),s.quantity<10&&!s.recipe&&e.jsx(Ee,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${s.expenseOnly?"badge-warning":s.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:s.expenseOnly?"Expense":s.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",s.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",o.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${pe(s.id)===0?"text-red-600":pe(s.id)<10?"text-yellow-600":"text-gray-900"}`,children:[pe(s.id)," ",s.unit]}),pe(s.id)<10&&pe(s.id)>0&&e.jsx(Ee,{className:"w-4 h-4 text-yellow-500"}),pe(s.id)===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600",children:[Ye(s.id).length," active"]}),e.jsx("button",{onClick:()=>{A(s),P(!0)},className:"p-1 hover:bg-blue-50 rounded text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(le,{className:"w-3 h-3"})})]})}),e.jsx("td",{className:"px-4 py-3",children:s.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[$," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${C>30?"text-green-600":C>15?"text-yellow-600":"text-red-600"}`,children:[C,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>rt(s),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600 transition-colors",title:"Edit weight-based pricing",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{K(s),p(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Xe(s.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(ce,{className:"w-4 h-4"})})]})})]},s.id),B&&s.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(s.recipe||[]).map((J,xe)=>{if(!J)return null;const Z=(r||[]).find(ft=>ft&&ft.id===J.productId);if(!Z)return null;const gt=(Z.cost||0)/(Z.quantity||1),Wt=gt*(J.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:Z.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[J.quantity||0," ",Z.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[Z.quantity||0," ",Z.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",gt.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",Wt.toFixed(2)]})]},xe)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",o.toFixed(2)]})]})})]})]})})})]})})})]})})}),D&&q&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Add Stock for ",q.name]}),e.jsxs("form",{onSubmit:Ze,className:"space-y-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:O.quantity,onChange:s=>_({...O,quantity:s.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:O.expiryDate,onChange:s=>_({...O,expiryDate:s.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:O.batchNumber,onChange:s=>_({...O,batchNumber:s.target.value})}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost per Unit",className:"input",value:O.cost,onChange:s=>_({...O,cost:s.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{P(!1),A(null),_({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:ge,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:S.name,onChange:s=>I({...S,name:s.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:s=>Ne(s,!0),className:"input"}),e.jsx(It,{className:"w-5 h-5 text-gray-400"})]}),(w||S.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:w||S.image,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:S.price,onChange:s=>I({...S,price:s.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:S.cost,onChange:s=>I({...S,cost:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:S.category,onChange:s=>I({...S,category:s.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsxs("select",{className:"input",value:S.unit,onChange:s=>I({...S,unit:s.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:S.expenseOnly,onChange:s=>I({...S,expenseOnly:s.target.checked,visibleToCashier:!s.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!S.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:S.visibleToCashier,onChange:s=>I({...S,visibleToCashier:s.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{y(!1),h(""),I({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0})},className:"btn-secondary",children:"Cancel"})]})]})]})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:ve,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:L.name,onChange:s=>K({...L,name:s.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:L.image||"",onChange:s=>K({...L,image:s.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:s=>{const o=s.target.files[0];if(o){const C=new FileReader;C.onloadend=()=>{K({...L,image:C.result})},C.readAsDataURL(o)}}})]}),L.image&&e.jsx("img",{src:L.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:L.price||"",onChange:s=>K({...L,price:s.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:L.cost||"",onChange:s=>K({...L,cost:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:L.quantity||"",onChange:s=>K({...L,quantity:s.target.value}),required:!0}),e.jsxs("select",{className:"input",value:L.unit||"pcs",onChange:s=>K({...L,unit:s.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:L.category||"raw",onChange:s=>K({...L,category:s.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:L.expenseOnly||!1,onChange:s=>K({...L,expenseOnly:s.target.checked,visibleToCashier:!s.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!L.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:L.visibleToCashier!==!1,onChange:s=>K({...L,visibleToCashier:s.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>p(!1),className:"btn-secondary",children:"Cancel"})]})]})]})}),M&&q&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-96 overflow-y-auto",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Weight-Based Pricing - ",q.name]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Set different prices for different weights (in 0.1kg increments)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700",children:"Add New Weight Price"}),e.jsxs("form",{onSubmit:lt,className:"flex gap-3",children:[e.jsx("input",{type:"number",step:"0.1",min:"0.1",placeholder:"Weight (kg) - e.g., 0.1, 0.5, 1.0",className:"input flex-1",value:H.weight,onChange:s=>G({...H,weight:s.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Price (KSH)",className:"input flex-1",value:H.price,onChange:s=>G({...H,price:s.target.value}),required:!0}),e.jsx("button",{type:"submit",className:"btn-primary whitespace-nowrap",children:"Add Price"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Current Prices"}),Object.keys(T).length>0?e.jsx("div",{className:"space-y-2",children:Object.entries(T).sort(([s],[o])=>parseFloat(s)-parseFloat(o)).map(([s,o])=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-medium",children:[s," kg"]}),e.jsxs("span",{className:"text-gray-600 ml-4",children:["KSH ",parseFloat(o).toLocaleString()]})]}),e.jsx("button",{onClick:()=>x(s),className:"text-red-600 hover:bg-red-50 px-3 py-1 rounded text-sm font-medium transition-colors",children:"Delete"})]},s))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No weight-based pricing set. Add one above."})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Base price:"})," KSH ",q.price?.toLocaleString()]})})]}),e.jsx("div",{className:"flex gap-2 mt-6",children:e.jsx("button",{onClick:()=>{R(!1),A(null),U({}),G({weight:"",price:""})},className:"btn-secondary flex-1",children:"Done"})})]})})]})}function Os(){const[t,c]=a.useState([]),[f,b]=a.useState([]),[n,r]=a.useState(!1),[l,m]=a.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});a.useEffect(()=>{g()},[]);const g=async()=>{const v=await ae.getAll();c(v),b(v.filter(y=>!y.recipe))},u=()=>{m({...l,ingredients:[...l.ingredients,{name:"",quantity:"",unit:"pcs"}]})},j=(v,y,N)=>{const p=[...l.ingredients];p[v][y]=N,m({...l,ingredients:p})},k=v=>{m({...l,ingredients:l.ingredients.filter((y,N)=>N!==v)})},d=()=>l.ingredients.reduce((v,y)=>{const N=f.find(p=>p.name.toLowerCase()===y.name.toLowerCase());if(N&&y.quantity){const p=N.cost/N.quantity;return v+p*parseFloat(y.quantity)}return v},0),E=async v=>{v.preventDefault();const y=[];for(const p of l.ingredients){if(!p.name||!p.quantity)continue;const D=f.find(P=>P.name.toLowerCase()===p.name.toLowerCase());D?y.push({productId:D.id,quantity:parseFloat(p.quantity),unit:p.unit||"pcs"}):y.push({name:p.name,quantity:parseFloat(p.quantity),unit:p.unit||"pcs"})}if(y.length===0){alert("Please add at least one ingredient");return}const N=d();try{await ae.create({name:l.name,price:parseFloat(l.price),cost:N,quantity:0,unit:"pcs",category:"composite",recipe:y,image:l.image||"",visibleToCashier:l.visibleToCashier,expenseOnly:!1}),m({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),r(!1),g(),alert("Recipe created successfully!")}catch(p){console.error("Error creating recipe:",p),alert("Failed to create recipe. Please try again.")}},i=t.filter(v=>v.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>r(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",i.length,")"]}),i.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:i.map(v=>{const y=v.recipe.reduce((p,D)=>{if(D.productId){const P=t.find(M=>M.id===D.productId);if(P){const M=P.cost/P.quantity;return p+M*D.quantity}}else if(D.name){const P=t.find(M=>M.name.toLowerCase()===D.name.toLowerCase());if(P){const M=P.cost/P.quantity;return p+M*D.quantity}}return p},0),N=((v.price-y)/v.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:v.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",v.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",y.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${N>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",N,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(ce,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:v.recipe.map((p,D)=>{let P="",M=p.unit||"pcs";if(p.productId){const R=t.find(q=>q.id===p.productId);R&&(P=R.name,M=R.unit)}else p.name&&(P=p.name,M=p.unit||"pcs");return P?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:P}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[p.quantity," ",M]})]},D):null})})]})]},v.id)})})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:l.name,onChange:v=>m({...l,name:v.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:l.price,onChange:v=>m({...l,price:v.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:l.image,onChange:v=>m({...l,image:v.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.visibleToCashier,onChange:v=>m({...l,visibleToCashier:v.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:u,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:l.ingredients.map((v,y)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:v.name,onChange:N=>j(y,"name",N.target.value),required:!0,list:`ingredients-list-${y}`}),e.jsx("datalist",{id:`ingredients-list-${y}`,children:f.map(N=>e.jsxs("option",{value:N.name,children:[N.name," (",N.quantity," ",N.unit," available)"]},N.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:v.quantity,onChange:N=>j(y,"quantity",N.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:v.unit,onChange:N=>j(y,"unit",N.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>k(y),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(ce,{className:"w-4 h-4"})})]},y))}),l.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),l.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",d().toFixed(2)]})]}),l.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(l.price)-d())/parseFloat(l.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(es,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{r(!1),m({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Fs(){const[t,c]=a.useState([]),[f,b]=a.useState("all"),[n,r]=a.useState([]),[l,m]=a.useState(!1);a.useEffect(()=>{g()},[]);const g=async()=>{const y=await Le.getAll();c(y.reverse())},u=async y=>{if(window.confirm("Delete this sale? This action cannot be undone."))try{m(!0);const N=localStorage.getItem("token");if(!(await fetch(`${W}/sales/${y}`,{method:"DELETE",headers:{Authorization:`Bearer ${N}`}})).ok)throw new Error("Failed to delete sale");c(t.filter(D=>D.id!==y)),alert("Sale deleted successfully")}catch(N){alert("Failed to delete sale: "+N.message)}finally{m(!1)}},j=async()=>{if(n.length===0){alert("No sales selected");return}if(window.confirm(`Delete ${n.length} sales? This action cannot be undone.`))try{m(!0);const y=localStorage.getItem("token");if(!(await fetch(`${W}/sales/bulk-delete`,{method:"POST",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify({saleIds:n})})).ok)throw new Error("Failed to delete sales");c(t.filter(p=>!n.includes(p.id))),r([]),alert("Sales deleted successfully")}catch(y){alert("Failed to delete sales: "+y.message)}finally{m(!1)}},k=async()=>{if(window.confirm("Clear ALL sales data? This will delete everything and cannot be undone."))try{m(!0);const y=localStorage.getItem("token");if(!(await fetch(`${W}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify({type:"sales"})})).ok)throw new Error("Failed to clear sales");c([]),r([]),alert("All sales data cleared")}catch(y){alert("Failed to clear sales: "+y.message)}finally{m(!1)}},d=t.filter(y=>{if(f==="today")return new Date(y.createdAt).toDateString()===new Date().toDateString();if(f==="week"){const N=new Date;return N.setDate(N.getDate()-7),new Date(y.createdAt)>=N}return!0}),E=d.reduce((y,N)=>y+N.total,0),i=d.reduce((y,N)=>y+(N.cogs||0),0),v=E-i;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:f,onChange:y=>b(y.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]}),n.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[n.length," selected"]}),e.jsxs("button",{onClick:j,disabled:l,className:"px-3 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(ce,{className:"w-4 h-4"}),"Delete Selected"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:k,disabled:l||t.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(Dt,{className:"w-4 h-4"}),"Clear All Sales"]}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",E.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",i.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",v.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:n.length===d.length&&d.length>0,onChange:y=>{y.target.checked?r(d.map(N=>N.id)):r([])},className:"rounded"})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Action"})]})}),e.jsx("tbody",{children:d.map(y=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:n.includes(y.id),onChange:N=>{N.target.checked?r([...n,y.id]):r(n.filter(p=>p!==y.id))},className:"rounded"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",y.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(y.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[y.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:y.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",y.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",y.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",y.profit?.toLocaleString()||0]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("button",{onClick:()=>u(y.id),disabled:l,className:"px-3 py-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(ce,{className:"w-4 h-4"}),"Delete"]})})]},y.id))})]})})]})]})}function Us(){const[t,c]=a.useState([]),[f,b]=a.useState(!1),[n,r]=a.useState({description:"",amount:"",category:"general"}),[l,m]=a.useState(null);a.useEffect(()=>{u();const i=localStorage.getItem("token");return i&&(fe.connect(i).catch(v=>{console.warn("WebSocket connection failed:",v)}),fe.on("sale_completed",v=>{console.log("ðŸ’° Sale completed - updating expenses:",v),u(),v.saleId&&g(`âœ… Expenses updated from Sale #${v.saleId}`,"success")})),()=>{fe.disconnect()}},[]);const g=(i,v)=>{m({message:i,type:v}),setTimeout(()=>m(null),3e3)},u=async()=>{const i=await Ve.getAll();c(i.reverse())},j=async i=>{i.preventDefault(),await Ve.create({...n,amount:parseFloat(n.amount)}),r({description:"",amount:"",category:"general"}),b(!1),u()},k=t.reduce((i,v)=>i+v.amount,0),d=t.filter(i=>!i.automatic),E=t.filter(i=>i.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[l&&e.jsx("div",{className:`fixed top-4 right-4 p-4 rounded-lg text-white font-medium z-50 ${l.type==="success"?"bg-green-600":"bg-blue-600"}`,children:l.message}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("button",{onClick:()=>b(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",k.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",d.reduce((i,v)=>i+v.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",E.reduce((i,v)=>i+v.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.map(i=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(i.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:i.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:i.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${i.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:i.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",i.amount?.toLocaleString()]})]},i.id))})]})})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:n.description,onChange:i=>r({...n,description:i.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:n.amount,onChange:i=>r({...n,amount:i.target.value}),required:!0}),e.jsxs("select",{className:"input",value:n.category,onChange:i=>r({...n,category:i.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>b(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Rs(){const{isCashierUserManagementEnabled:t,isCashier:c}=me(),[f,b]=a.useState([]),[n,r]=a.useState(!0),[l,m]=a.useState(!1),[g,u]=a.useState(null),[j,k]=a.useState(null),[d,E]=a.useState(null),[i,v]=a.useState(0),[y,N]=a.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),[p,D]=a.useState(!1),[P,M]=a.useState(null),[R,q]=a.useState("");a.useEffect(()=>{A()},[]),a.useEffect(()=>()=>{d?.intervalId&&clearInterval(d.intervalId)},[d]);const A=async()=>{try{r(!0);const h=await be.getAll();b(Array.isArray(h)?h:[])}catch(h){console.error("Error loading users:",h),b([])}finally{r(!1)}},T=()=>Math.floor(1e3+Math.random()*9e3).toString(),U=async h=>{if(h.preventDefault(),console.log("Form submitted with data:",y),!y.name?.trim()||!y.email?.trim()||!y.password?.trim()){alert("Please fill in all required fields");return}if(y.password.length<6){alert("Password must be at least 6 characters long");return}try{r(!0);const S=T(),I={name:y.name.trim(),email:y.email.trim().toLowerCase(),password:y.password.trim(),pin:S};console.log("Sending user data:",I);const O=await be.create(I);console.log("User creation result:",O),await A();const _=`âœ… Cashier added successfully!

ðŸ“§ Email: ${I.email}
ðŸ”‘ Password: ${I.password}
ðŸ”¢ PIN: ${S}

ðŸ’¡ LOGIN OPTIONS:
1. Email + Password: Use email and password above
2. PIN Login: Use email + ${S}

Please share these credentials securely with the new cashier.`;alert(_),N({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),m(!1)}catch(S){console.error("Error creating cashier:",S);let I="Failed to add cashier";S.message.includes("Current user not found")?I="Authentication error. Please refresh the page and try again.":S.message.includes("email")?I="Email already exists. Please use a different email.":S.message.includes("network")||S.message.includes("fetch")?I="Network error. Please check your connection and try again.":S.message&&(I=`Failed to add cashier: ${S.message}`),alert(I)}finally{r(!1)}},H=async(h,S)=>{try{r(!0),await be.update(h,{permissions:S}),await A(),u(null)}catch(I){console.error("Error updating permissions:",I),alert("Failed to update permissions: "+I.message)}finally{r(!1)}},G=async(h,S)=>{try{r(!0);const I=!S,O=await fetch(`${W}/users/${h}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({active:I})});if(!O.ok){const _=await O.json().catch(()=>({error:"Network error"}));throw new Error(_.error||`HTTP ${O.status}: ${O.statusText}`)}await A()}catch(I){console.error("Error updating user status:",I),alert("Failed to update user status: "+I.message)}finally{r(!1)}},oe=async(h,S)=>{try{r(!0);const I=!S,O=await fetch(`${W}/users/${h}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({locked:I})});if(!O.ok){const _=await O.json().catch(()=>({error:"Network error"}));throw new Error(_.error||`HTTP ${O.status}: ${O.statusText}`)}await A()}catch(I){console.error("Error updating user lock status:",I),alert("Failed to update user lock status: "+I.message)}finally{r(!1)}},ue=async h=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{r(!0),await be.delete(h),await A()}catch(S){console.error("Error deleting user:",S),alert("Failed to delete user: "+S.message)}finally{r(!1)}},te=async()=>{if(window.confirm("Clear ALL users data? This will delete all users and cannot be undone."))try{r(!0);const h=localStorage.getItem("token");if(!(await fetch(`${W}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify({type:"users"})})).ok)throw new Error("Failed to clear users");b([]),alert("All users data cleared")}catch(h){alert("Failed to clear users: "+h.message)}finally{r(!1)}},de=h=>{M(h),q(T()),D(!0)},he=async()=>{try{r(!0),await be.update(P.id,{cashierPIN:R}),await A(),D(!1),M(null),q(""),alert(`âœ… PIN reset successfully!

ðŸ”¢ New PIN for ${P.name}: ${R}

Please share this PIN securely with the cashier.`)}catch(h){console.error("Error resetting PIN:",h),alert("Failed to reset PIN: "+h.message)}finally{r(!1)}},z=h=>{k(h),E({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const S=setInterval(()=>{Y(h)},3e3);E(I=>({...I,intervalId:S})),Y(h)},re=()=>{d?.intervalId&&clearInterval(d.intervalId),k(null),E(null)},Y=async h=>{try{const S=await Le.getAll(),O=(Array.isArray(S)?S:[]).filter(L=>L.cashierId===h.id).sort((L,K)=>new Date(K.createdAt)-new Date(L.createdAt)).slice(0,10),_={isActive:Math.random()>.3,currentCart:O.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:O.reduce((L,K)=>L+K.total,0),salesCount:O.length,lastActivity:O.length>0?new Date(O[0].createdAt).toLocaleTimeString():"No recent activity"};E(_)}catch(S){console.error("Error loading live view data:",S)}},w=(f||[]).filter(h=>h.role==="cashier");return n&&f.length===0?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),e.jsx("div",{className:"flex items-center gap-2",children:t()&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:te,disabled:n||f.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(Dt,{className:"w-4 h-4"}),"Clear All Users"]}),e.jsxs("button",{onClick:()=>m(!0),className:"btn-primary flex items-center gap-2",disabled:n,children:[e.jsx(le,{className:"w-4 h-4"}),"Add Cashier"]})]})})]}),c()&&!t()&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(ie,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"User Management Restricted"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The admin has disabled cashier user management. You cannot add, edit, or remove users at this time."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:f.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:w.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:f.filter(h=>h.active).length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(f||[]).map(h=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:h.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:h.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${h.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:h.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:h.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:h.role==="cashier"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:h.pin||h.cashierPIN||"----"}),e.jsx("button",{onClick:()=>de(h),className:"p-1 hover:bg-yellow-50 rounded text-yellow-600",title:"Reset PIN",disabled:n,children:e.jsx(je,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${h.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:h.active?e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(jt,{className:"w-3 h-3"}),"Inactive"]})}),h.locked&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:[e.jsx(ze,{className:"w-3 h-3"}),"Locked"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>G(h.id,h.active),className:`p-2 rounded-lg transition ${h.active?"hover:bg-red-50 text-red-600":"hover:bg-green-50 text-green-600"}`,title:h.active?"Deactivate User":"Activate User",disabled:n,children:h.active?e.jsx(jt,{className:"w-4 h-4"}):e.jsx(bt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>oe(h.id,h.locked||!1),className:`p-2 rounded-lg transition ${h.locked?"hover:bg-green-50 text-green-600":"hover:bg-red-50 text-red-600"}`,title:h.locked?"Unlock User":"Lock User",disabled:n,children:e.jsx(ze,{className:"w-4 h-4"})})]}),h.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",h.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(Tt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>z(h),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(yt,{className:"w-4 h-4"})})]}),t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u(h),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600",title:"Edit Permissions",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ue(h.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",title:"Delete User",disabled:n,children:e.jsx(ce,{className:"w-4 h-4"})})]})]})})]},h.id))})]}),f.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ce,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first cashier to get started"})]})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:y.name||"",onChange:h=>{console.log("Name input changed:",h.target.value),N({...y,name:h.target.value})},required:!0,disabled:n}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:y.email||"",onChange:h=>{console.log("Email input changed:",h.target.value),N({...y,email:h.target.value})},required:!0,disabled:n}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:y.password||"",onChange:h=>{console.log("Password input changed:",h.target.value),N({...y,password:h.target.value})},required:!0,minLength:6,disabled:n}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(y.permissions).map(([h,S])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:I=>N({...y,permissions:{...y.permissions,[h]:I.target.checked}}),disabled:n}),e.jsx("span",{className:"text-sm capitalize",children:h.replace(/([A-Z])/g," $1").trim()})]},h))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:n,children:n?"Adding...":"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>m(!1),className:"btn-secondary",disabled:n,children:"Cancel"})]})]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",g.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(g.permissions||{}).map(([h,S])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:I=>u({...g,permissions:{...g.permissions,[h]:I.target.checked}}),disabled:n}),e.jsx("span",{className:"text-sm capitalize",children:h.replace(/([A-Z])/g," $1").trim()})]},h))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>H(g.id,g.permissions),className:"btn-primary flex-1",disabled:n,children:n?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>u(null),className:"btn-secondary",disabled:n,children:"Cancel"})]})]})}),j&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(yt,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",j.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:re,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(ye,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${d.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:d.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Last Activity: ",d.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(qe,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(d.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(d.currentCart||[]).map((h,S)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[h.name," x",h.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",h.price.toLocaleString()]})]},S)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(d.currentCart||[]).reduce((h,S)=>h+S.price*S.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:d.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",d.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",d.salesCount>0?Math.round(d.totalSalesToday/d.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})}),p&&P&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Reset PIN for ",P.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate a new 4-digit PIN for this cashier. The old PIN will be invalid."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"New PIN:"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-mono text-3xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:R})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>q(T()),className:"btn-secondary flex-1",disabled:n,children:"Generate New PIN"}),e.jsx("button",{onClick:he,className:"btn-primary flex-1",disabled:n,children:n?"Updating...":"Confirm & Update"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>{D(!1),M(null),q("")},className:"btn-secondary w-full",disabled:n,children:"Cancel"})})]})})]})}function qs(){const[t,c]=a.useState([]),[f,b]=a.useState("all");a.useEffect(()=>{n()},[]);const n=()=>{const g=JSON.parse(localStorage.getItem("clockRecords")||"[]");c(g.reverse())},r=f==="all"?t:t.filter(g=>g.date===new Date().toDateString()),l=r.filter(g=>g.date===new Date().toDateString()).reduce((g,u)=>g+u.duration,0)/60,m=g=>{const u=Math.floor(g/60),j=g%60;return`${u}h ${j}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(Oe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[l.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(ut,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(r.filter(g=>g.date===new Date().toDateString()).map(g=>g.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(Je,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:t.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${f==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>b("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${f==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"})]})}),e.jsx("tbody",{children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-gray-500",children:"No records found"})}):r.map((g,u)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:g.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(g.clockIn).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(g.clockIn).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(g.clockOut).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:m(g.duration)})})]},u))})]})})]})]})}function Ms(){const{user:t,updateUser:c}=me();Pe();const[f,b]=a.useState(!1),[n,r]=a.useState(t?.plan||"ultra"),[l,m]=a.useState({}),[g,u]=a.useState(null),[j,k]=a.useState(t?.profilePicture||null),[d,E]=a.useState(!0),[i,v]=a.useState(!0);a.useEffect(()=>{y()},[]);const y=async()=>{try{const A=await Te.get();m(A),A.logo&&u(A.logo),E(A.cashierUserManagement!==!1),v(A.realTimeProductSync!==!1)}catch(A){console.error("Failed to load settings:",A)}},N=async A=>{try{const T={...l,...A};return await Te.update(T),m(T),!0}catch(T){return console.error("Failed to save settings:",T),!1}},p=async()=>{const A=!d;E(A),await N({cashierUserManagement:A})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{cashierUserManagement:A}})),alert(`âœ… Cashier User Management ${A?"ENABLED":"DISABLED"}`)):(E(!A),alert("âŒ Failed to save setting. Please try again."))},D=async()=>{const A=!i;v(A),await N({realTimeProductSync:A})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{realTimeProductSync:A}})),alert(`âœ… Real-time Product Sync ${A?"ENABLED":"DISABLED"}`)):(v(!A),alert("âŒ Failed to save setting. Please try again."))},P=async A=>{const T=A.target.files[0];if(T){const U=new FileReader;U.onloadend=async()=>{const H=U.result;u(H);try{await Te.update({...l,logo:H}),m({...l,logo:H})}catch(G){console.error("Failed to save logo:",G)}},U.readAsDataURL(T)}},M=async A=>{const T=A.target.files[0];if(T){const U=new FileReader;U.onloadend=async()=>{const H=U.result;k(H);try{await c({...t,profilePicture:H})}catch(G){console.error("Failed to save profile picture:",G)}},U.readAsDataURL(T)}},R=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],q=async()=>{const A=R.find(U=>U.id===n),T=n==="ultra"?"admin":"cashier";await c({...t,role:T,plan:n,price:A.price}),b(!1),setTimeout(()=>window.location.href=T==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(ut,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[j?e.jsx("img",{src:j,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:t?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(Nt,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:M})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(He,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>b(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(ht,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Ce,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cashier User Management"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Cashier User Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow cashiers to add and remove users"})]}),e.jsx("button",{onClick:p,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${d?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${d?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${d?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:d?"âœ… Cashiers can add and remove users when enabled":"âŒ Cashiers cannot add or remove users when disabled"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(ss,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Real-time Product Sync"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Real-time Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync products between admin and cashier dashboards"})]}),e.jsx("button",{onClick:D,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${i?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${i?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${i?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:i?"âœ… Products will sync in real-time across all dashboards":"âŒ Products will not sync automatically across dashboards"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(ze,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(as,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[g&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:g,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(Nt,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:P})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:R.map(A=>e.jsxs("div",{onClick:()=>r(A.id),className:`card cursor-pointer transition-all ${n===A.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:A.name}),n===A.id&&e.jsx(We,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",A.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:A.features.map((T,U)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(We,{className:"w-4 h-4 text-green-600"}),T]},U))})]},A.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:q,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>b(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function Bs(){const[t,c]=a.useState([]),[f,b]=a.useState(!1),[n,r]=a.useState(null),[l,m]=a.useState({name:"",amount:"",description:"",active:!0});a.useEffect(()=>{g()},[]);const g=()=>{const d=JSON.parse(localStorage.getItem("serviceFees")||"[]");c(d)},u=d=>{localStorage.setItem("serviceFees",JSON.stringify(d)),c(d)},j=d=>{if(d.preventDefault(),n){const E=t.map(i=>i.id===n.id?{...l,id:i.id}:i);u(E)}else{const E={...l,id:Date.now(),createdAt:new Date().toISOString()};u([...t,E])}b(!1),r(null),m({name:"",amount:"",description:"",active:!0})},k=d=>{confirm("Delete this service fee?")&&u(t.filter(E=>E.id!==d))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{b(!0),r(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(d=>e.jsxs("div",{className:`card ${d.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Se,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:d.name}),e.jsx("p",{className:"text-xs text-gray-500",children:d.description})]})]}),e.jsx("span",{className:`badge ${d.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:d.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",d.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{r(d),m(d),b(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(je,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>k(d.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(ce,{className:"w-4 h-4 text-red-600"})})]})]})]},d.id))}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:l.name,onChange:d=>m({...l,name:d.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:l.amount,onChange:d=>m({...l,amount:d.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:l.description,onChange:d=>m({...l,description:d.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.active,onChange:d=>m({...l,active:d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>b(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function _s(){const[t,c]=a.useState([]),[f,b]=a.useState([]),[n,r]=a.useState(!1),[l,m]=a.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});a.useEffect(()=>{g(),u()},[]);const g=async()=>{try{const i=localStorage.getItem("token"),v=await fetch(`${W}/reminders`,{headers:{Authorization:`Bearer ${i}`}});if(!v.ok){console.error("API Error:",v.status,v.statusText),c([]);return}const y=await v.json();Array.isArray(y)?c(y):(console.error("Expected array but got:",typeof y,y),c([]))}catch(i){console.error("Failed to fetch reminders:",i),c([])}},u=async()=>{try{const i=localStorage.getItem("token"),v=await fetch(`${W}/products`,{headers:{Authorization:`Bearer ${i}`}});if(!v.ok){console.error("API Error:",v.status,v.statusText),b([]);return}const y=await v.json();Array.isArray(y)?b(y):(console.error("Expected array but got:",typeof y,y),b([]))}catch(i){console.error("Failed to fetch products:",i),b([])}},j=async i=>{i.preventDefault();try{const v=localStorage.getItem("token"),y=await fetch(`${W}/reminders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`},body:JSON.stringify(l)});if(!y.ok){const p=await y.json();console.error("Failed to create reminder:",p),alert(`Failed to create reminder: ${p.error||"Unknown error"}`);return}const N=await y.json();m({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),r(!1),g(),alert("Reminder created successfully!")}catch(v){console.error("Failed to create reminder:",v),alert("Failed to create reminder. Please try again.")}},k=async i=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const y=localStorage.getItem("token"),N=await fetch(`${W}/reminders/${i}`,{method:"DELETE",headers:{Authorization:`Bearer ${y}`}});if(!N.ok){const p=await N.json();console.error("Failed to delete reminder:",p),alert(`Failed to delete reminder: ${p.error||"Unknown error"}`);return}g(),alert("Reminder deleted successfully!")}catch(v){console.error("Failed to delete reminder:",v),alert("Failed to delete reminder. Please try again.")}},d=i=>{l.days.includes(i)?m({...l,days:l.days.filter(v=>v!==i)}):m({...l,days:[...l.days,i]})},E=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(ht,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("button",{onClick:()=>r(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(le,{size:20}),"New Reminder"]})]}),e.jsx("div",{className:"grid gap-4",children:t.map(i=>{const v=f.find(y=>y.id===i.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${i.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:i.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",v?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",i.frequency]}),i.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",i.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(Je,{size:16}),"Next: ",new Date(i.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${i.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:i.status}),e.jsx("button",{onClick:()=>k(i.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(ce,{size:20})})]})]})},i.id)})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:l.customerName,onChange:i=>m({...l,customerName:i.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:l.productId,onChange:i=>m({...l,productId:parseInt(i.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),f.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:l.frequency,onChange:i=>m({...l,frequency:i.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),l.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:E.map(i=>e.jsx("button",{type:"button",onClick:()=>d(i),className:`px-4 py-2 rounded-lg font-medium transition ${l.days.includes(i)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:i},i))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:l.nextDate,onChange:i=>m({...l,nextDate:i.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>r(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})}function zs(){const[t,c]=a.useState([]),[f,b]=a.useState(!1),[n,r]=a.useState(null),[l,m]=a.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});a.useEffect(()=>{g()},[]);const g=async()=>{try{const d=await Re.getAll();c(d)}catch(d){console.error("Failed to load discounts:",d)}},u=async d=>{d.preventDefault();try{n?await Re.update(n.id,l):await Re.create(l),b(!1),r(null),m({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),g()}catch(E){console.error("Failed to save discount:",E)}},j=async d=>{if(confirm("Delete this discount?"))try{await Re.delete(d),g()}catch(E){console.error("Failed to delete discount:",E)}},k=d=>{const E=new Date,i=new Date(d.validFrom),v=new Date(d.validTo);return d.active&&i<=E&&v>=E};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{b(!0),r(null),m({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(d=>e.jsxs("div",{className:`card ${k(d)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${k(d)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(dt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:d.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[d.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${k(d)?"badge-success":"bg-gray-200 text-gray-600"}`,children:k(d)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(d.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(d.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{r(d),m(d),b(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(je,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>j(d.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(ce,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},d.id)),t.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(dt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:l.name,onChange:d=>m({...l,name:d.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:l.percentage,onChange:d=>m({...l,percentage:parseFloat(d.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:l.validFrom,onChange:d=>m({...l,validFrom:d.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:l.validTo,onChange:d=>m({...l,validTo:d.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.active,onChange:d=>m({...l,active:d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>b(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Js(){const[t,c]=a.useState([]),[f,b]=a.useState([]),[n,r]=a.useState("all");a.useEffect(()=>{l(),m()},[]);const l=async()=>{try{const i=await it.getAll();c(i)}catch(i){console.error("Failed to load credit requests:",i)}},m=async()=>{try{const i=await ae.getAll();b(i)}catch(i){console.error("Failed to load products:",i)}},g=async i=>{try{await it.approve(i),l()}catch(v){console.error("Failed to approve request:",v)}},u=async i=>{try{await it.reject(i),l()}catch(v){console.error("Failed to reject request:",v)}},j=i=>{const v=f.find(y=>y.id===i);return v?v.name:"Unknown Product"},k=t.filter(i=>n==="all"?!0:i.status===n),d=i=>{switch(i){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},E=i=>{switch(i){case"pending":return e.jsx(Oe,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx($e,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(mt,{className:"w-6 h-6 text-red-600"});default:return e.jsx(He,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(i=>e.jsx("button",{onClick:()=>r(i),className:`px-4 py-2 rounded-lg font-medium transition ${n===i?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:i.charAt(0).toUpperCase()+i.slice(1)},i))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[k.map(i=>e.jsx("div",{className:`card border-l-4 ${d(i.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${i.status==="pending"?"bg-orange-600":i.status==="approved"?"bg-green-600":"bg-red-600"}`,children:E(i.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:i.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:j(i.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:i.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",i.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(i.createdAt).toLocaleString()]}),i.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(i.approvedAt).toLocaleString()]})]})]}),i.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>g(i.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx($e,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>u(i.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(mt,{size:16}),"Reject"]})]}),i.status!=="pending"&&e.jsx("span",{className:`badge ${i.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:i.status.toUpperCase()})]})},i.id)),k.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(He,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",n!=="all"?n:""," credit requests found."]})]})]})]})}function Hs(){const[t,c]=a.useState([]),[f,b]=a.useState(!0),[n,r]=a.useState(!1),[l,m]=a.useState(null),[g,u]=a.useState(""),[j,k]=a.useState({name:"",email:"",phone:"",address:"",city:"",country:"",products:""});a.useEffect(()=>{d()},[]);const d=async()=>{try{b(!0);const p=localStorage.getItem("token"),D=await fetch(`${W}/vendors`,{headers:{Authorization:`Bearer ${p}`}});if(D.ok){const P=await D.json();c(Array.isArray(P)?P:[])}}catch(p){console.error("Failed to load vendors:",p),c([])}finally{b(!1)}},E=()=>{m(null),k({name:"",email:"",phone:"",address:"",city:"",country:"",products:""}),r(!0)},i=p=>{m(p),k(p),r(!0)},v=async p=>{if(window.confirm("Are you sure you want to delete this vendor?"))try{const D=localStorage.getItem("token");(await fetch(`${W}/vendors/${p}`,{method:"DELETE",headers:{Authorization:`Bearer ${D}`}})).ok?(c(t.filter(M=>M.id!==p)),alert("Vendor deleted successfully")):alert("Failed to delete vendor")}catch(D){console.error("Failed to delete vendor:",D),alert("Failed to delete vendor")}},y=async p=>{p.preventDefault();try{const D=localStorage.getItem("token"),P=l?"PUT":"POST",M=l?`${W}/vendors/${l.id}`:`${W}/vendors`,R=await fetch(M,{method:P,headers:{Authorization:`Bearer ${D}`,"Content-Type":"application/json"},body:JSON.stringify(j)});if(R.ok){const q=await R.json();c(l?t.map(A=>A.id===q.id?q:A):[...t,q]),r(!1),alert(l?"Vendor updated":"Vendor added")}else alert("Failed to save vendor")}catch(D){console.error("Failed to save vendor:",D),alert("Failed to save vendor")}},N=t.filter(p=>p.name?.toLowerCase().includes(g.toLowerCase())||p.email?.toLowerCase().includes(g.toLowerCase()));return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Vendors"}),e.jsxs("button",{onClick:E,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(le,{className:"w-5 h-5"}),"Add Vendor"]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Qe,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search vendors...",value:g,onChange:p=>u(p.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"})]})}),f?e.jsx("div",{className:"text-center py-8",children:"Loading vendors..."}):N.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["No vendors found. ",t.length===0&&"Add your first vendor to get started."]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map(p=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:p.name}),e.jsx("p",{className:"text-sm text-gray-500",children:p.products})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>i(p),className:"p-2 text-blue-600 hover:bg-blue-50 rounded",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>v(p.id),className:"p-2 text-red-600 hover:bg-red-50 rounded",children:e.jsx(ce,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[p.email&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Ke,{className:"w-4 h-4"}),e.jsx("a",{href:`mailto:${p.email}`,children:p.email})]}),p.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(rs,{className:"w-4 h-4"}),e.jsx("a",{href:`tel:${p.phone}`,children:p.phone})]}),p.address&&e.jsxs("div",{className:"flex items-start gap-2 text-gray-600",children:[e.jsx(ls,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[p.address,p.city&&`, ${p.city}`,p.country&&`, ${p.country}`]})]})]})]},p.id))}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:l?"Edit Vendor":"Add Vendor"}),e.jsx("button",{onClick:()=>r(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(ye,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vendor Name *"}),e.jsx("input",{type:"text",required:!0,value:j.name,onChange:p=>k({...j,name:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g., ABC Supplies"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Products/Services"}),e.jsx("input",{type:"text",value:j.products,onChange:p=>k({...j,products:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g., Vegetables, Fruits"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:j.email,onChange:p=>k({...j,email:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"vendor@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:j.phone,onChange:p=>k({...j,phone:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"+1 (555) 000-0000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("input",{type:"text",value:j.address,onChange:p=>k({...j,address:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Street address"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",value:j.city,onChange:p=>k({...j,city:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"City"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Country"}),e.jsx("input",{type:"text",value:j.country,onChange:p=>k({...j,country:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Country"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),className:"flex-1 px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"flex-1 px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700",children:[l?"Update":"Add"," Vendor"]})]})]})]})})]})}function zt({onClose:t}){const[c,f]=a.useState([]),[b,n]=a.useState(!0),r=a.useRef({data:null,timestamp:null}),l=3e4;a.useEffect(()=>{m()},[]);const m=async()=>{try{const u=Date.now();if(r.current.data&&r.current.timestamp&&u-r.current.timestamp<l){console.log("ðŸ“¦ Using cached reminders"),f(r.current.data),n(!1);return}const j=localStorage.getItem("token"),k=await fetch(`${W}/reminders/today`,{headers:{Authorization:`Bearer ${j}`}});if(!k.ok){console.error("API Error:",k.status,k.statusText),f([]),n(!1);return}const d=await k.json();Array.isArray(d)?(r.current.data=d,r.current.timestamp=Date.now(),f(d)):(console.error("Expected array but got:",typeof d,d),f([]))}catch(u){console.error("Failed to fetch reminders:",u),f([])}finally{n(!1)}},g=async u=>{try{const j=localStorage.getItem("token");await fetch(`${W}/reminders/${u}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify({status:"fulfilled"})}),r.current={data:null,timestamp:null},m()}catch(j){console.error("Failed to update reminder:",j)}};return b?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:t,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(ye,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Be,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):c.map(u=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:u.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",u.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:u.frequency})]}),e.jsxs("button",{onClick:()=>g(u.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx($e,{size:18}),"Mark Done"]})]},u.id))})]})})}function Jt({onUnlock:t,userType:c="user"}){const[f,b]=a.useState(""),[n,r]=a.useState(""),[l,m]=a.useState("password"),[g,u]=a.useState(!1),[j,k]=a.useState(""),[d,E]=a.useState(!1),[i,v]=a.useState("2005"),y=JSON.parse(localStorage.getItem("user")||"{}");a.useEffect(()=>{(async()=>{try{const P=await Te.get();P?.screenLockPassword&&v(P.screenLockPassword)}catch(P){console.warn("Failed to load settings, using default password:",P)}})()},[]),a.useEffect(()=>{const D=document.getElementById(l==="password"?"unlock-password":"unlock-pin");D&&D.focus()},[l]);const N=async D=>{D.preventDefault(),D.stopPropagation(),E(!0),k("");try{const P=localStorage.getItem("token");if(!P)throw new Error("No authentication token found");const M=await fetch("https://posifine22.onrender.com/api/auth/unlock-screen",{method:"POST",headers:{Authorization:`Bearer ${P}`,"Content-Type":"application/json"},body:JSON.stringify({pin:n})});if(!M.ok){const q=await M.json();throw M.status===429?new Error(q.message||"Too many failed attempts. Try again later."):M.status===401?new Error(q.message||"Incorrect PIN"):new Error(q.message||"Unlock failed")}const R=await M.json();R.token&&localStorage.setItem("token",R.token),r(""),b(""),t(R)}catch(P){k(P.message||"Unlock failed")}finally{E(!1)}},p=D=>{const P=D.replace(/\D/g,"").slice(0,4);r(P)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:D=>D.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8",onClick:D=>D.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${c==="main_admin"?"bg-gradient-to-br from-red-600 to-orange-600":"bg-gradient-to-br from-blue-600 to-purple-600"}`,children:e.jsx(ie,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-gray-600",children:c==="main_admin"?"Main Admin":y.name||"User"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Enter your ",l," to continue"]})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter PIN to unlock"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",id:"unlock-pin",value:n,onChange:D=>p(D.target.value),placeholder:"0000",maxLength:"4",className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-center tracking-widest text-2xl",disabled:d})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"ðŸ”’ PIN validated securely on server"})]}),j&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-red-700 text-sm font-medium",children:[j.includes("Too many")?"âŒ ":"âš ï¸ ",j]})}),e.jsx("button",{type:"submit",disabled:d||n.length<4,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 rounded-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"}),"Verifying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-5 h-5"}),"Unlock Screen"]})})]})]})})}function Ht(t=6e4){const[c,f]=a.useState(!1),b=a.useRef(Date.now()),n=a.useCallback(()=>{b.current=Date.now(),f(!1)},[]),r=a.useCallback(()=>{f(!1),b.current=Date.now()},[]);return a.useEffect(()=>{const l=["mousedown","mousemove","keypress","scroll","touchstart","click"],m=()=>{b.current=Date.now(),c&&f(!1)};l.forEach(u=>{document.addEventListener(u,m,!0)});const g=setInterval(()=>{Date.now()-b.current>t&&!c&&f(!0)},5e3);return()=>{l.forEach(u=>{document.removeEventListener(u,m,!0)}),clearInterval(g)}},[t,c]),[c,r,n]}function Ws(){const{user:t,logout:c,isCashierUserManagementEnabled:f}=me(),b=Pe(),n=Ct(),[r,l]=a.useState(!0),[m,g]=a.useState(!1),[u,j]=a.useState({}),[k,d]=Ht(45e3);a.useEffect(()=>{const N=()=>{const D=localStorage.getItem("user");if(D){const P=JSON.parse(D);let M=!1;(P.plan==="ultra"||P.role==="admin")&&(P.active||(P.active=!0,M=!0),P.plan==="ultra"&&P.role!=="admin"&&(P.role="admin",M=!0),P.plan==="ultra"&&(!P.price||P.price!==1600)&&(P.price=1600,M=!0),M&&(localStorage.setItem("user",JSON.stringify(P)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};N(),setTimeout(N,100);const p=setTimeout(()=>{g(!0)},1e3);return E(),()=>clearTimeout(p)},[]);const E=async()=>{try{const N=await Te.get();j(N)}catch(N){console.error("Failed to load settings:",N)}},i=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses data? This action cannot be undone."))try{const N=localStorage.getItem("token"),D=await fetch(`${W}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!D.ok){const P=await D.json();throw new Error(P.message||"Failed to clear data")}alert("Data cleared successfully!"),window.location.reload()}catch(N){console.error("Failed to clear data:",N),alert("Failed to clear data: "+N.message)}},v=[{id:"overview",label:"Dashboard",icon:ns,path:"/admin"},{id:"sales",label:"Sales",icon:At,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:ke,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:Et,path:"/admin/recipes"},{id:"expenses",label:"Expenses",icon:_e,path:"/admin/expenses"},{id:"vendors",label:"Vendors",icon:is,path:"/admin/vendors"},...f()?[{id:"users",label:"Users",icon:Ce,path:"/admin/users"}]:[],{id:"time",label:"Time Tracking",icon:Oe,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:ht,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:Se,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:dt,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:He,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:cs,path:"/admin/settings"}],y=N=>N==="/admin"?n.pathname==="/admin":n.pathname.startsWith(N);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${r?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[r&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>l(!r),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r?e.jsx(ye,{className:"w-5 h-5"}):e.jsx(os,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:v.map(N=>{const p=N.icon;return e.jsxs("button",{onClick:()=>b(N.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${y(N.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(p,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:N.label})]},N.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(ds,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:c,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(pt,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Logout"})]}),e.jsxs("button",{onClick:i,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors",children:[e.jsx(ye,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Clear Data"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:v.find(N=>y(N.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:t?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(Pt,{children:[e.jsx(V,{path:"/",element:e.jsx(Ts,{})}),e.jsx(V,{path:"/sales",element:e.jsx(Fs,{})}),e.jsx(V,{path:"/inventory",element:e.jsx(Ls,{})}),e.jsx(V,{path:"/recipes",element:e.jsx(Os,{})}),e.jsx(V,{path:"/expenses",element:e.jsx(Us,{})}),e.jsx(V,{path:"/vendors",element:e.jsx(Hs,{})}),e.jsx(V,{path:"/reminders",element:e.jsx(_s,{})}),e.jsx(V,{path:"/service-fees",element:e.jsx(Bs,{})}),e.jsx(V,{path:"/discounts",element:e.jsx(zs,{})}),e.jsx(V,{path:"/credit-requests",element:e.jsx(Js,{})}),e.jsx(V,{path:"/users",element:e.jsx(Rs,{})}),e.jsx(V,{path:"/time",element:e.jsx(qs,{})}),e.jsx(V,{path:"/settings",element:e.jsx(Ms,{})})]})})]}),m&&e.jsx(zt,{onClose:()=>g(!1)}),k&&e.jsx(Jt,{onUnlock:d,logo:u.logo})]})}function Ks(){const t=Pe(),[c,f]=a.useState(!1),[b,n]=a.useState(0),r=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 1,600 - 1 Cashier) or Ultra (KSH 3,000 - Unlimited) package",image:"ðŸ“",details:"First user becomes Admin automatically. Basic supports 1 cashier. Ultra supports unlimited cashiers with full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],l=[{icon:ke,title:"Smart Inventory",desc:"Track raw materials & composite products with automatic stock deduction"},{icon:Et,title:"Recipe Builder",desc:"Create bundled products with BOM and auto-calculate COGS"},{icon:De,title:"Real-time Analytics",desc:"Monitor sales, profit margins, and expenses in real-time"},{icon:Ce,title:"User Management",desc:"Add cashiers with custom permissions and role-based access"},{icon:ze,title:"Secure & Reliable",desc:"JWT authentication with role-based security"},{icon:xt,title:"Advanced Reports",desc:"Daily, weekly summaries with profit/loss tracking"}],m=[{name:"Ultra",price:3e3,icon:Lt,popular:!0,features:["Admin + Cashier Dashboard","Full Inventory Management","Recipe/BOM Builder","Auto Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Unlimited Cashiers","Priority Support"]},{name:"Basic",price:1600,icon:Ot,popular:!1,features:["Cashier Dashboard","Basic Inventory","Sales Tracking","Daily/Weekly Reports","Basic Profit/Loss View","Email Support","1 Cashier Only"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/auth/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(ms,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(Fe,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>f(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx($t,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 30-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(xt,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:l.map((g,u)=>{const j=g.icon;return e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(j,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:g.title}),e.jsx("p",{className:"text-gray-600",children:g.desc})]},u)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:m.map((g,u)=>{const j=g.icon;return e.jsxs("div",{className:`relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${g.popular?"ring-4 ring-blue-600":""}`,children:[g.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${g.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(j,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:g.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",g.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:g.features.map((k,d)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:k})]},d))}),e.jsx("button",{onClick:()=>t("/plans"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${g.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},u)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(Fe,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{f(!1),n(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(ye,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",b+1," of ",r.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((b+1)/r.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(b+1)/r.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:r[b].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:r[b].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:r[b].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:r[b].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>n(Math.max(0,b-1)),disabled:b===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),b<r.length-1?e.jsxs("button",{onClick:()=>n(b+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(Fe,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{f(!1),n(0),t("/plans")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(Fe,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:r.map((g,u)=>e.jsx("button",{onClick:()=>n(u),className:`w-2 h-2 rounded-full transition-all ${u===b?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},u))})]})]})})]})}function kt(){const t=Ct(),[c,f]=a.useState(t.pathname==="/auth/login"),[b,n]=a.useState("password"),[r,l]=a.useState({email:"",password:"",pin:"",name:"",newPassword:"",confirmPassword:""}),[m,g]=a.useState(""),[u,j]=a.useState(!1),[k,d]=a.useState(!1),E=Pe(),{login:i}=me(),v=()=>{try{return JSON.parse(localStorage.getItem("selectedPlan")||"null")}catch(N){return console.warn("Invalid selectedPlan in localStorage:",N),null}},y=async N=>{N.preventDefault(),g(""),j(!0);try{if(k){if(r.newPassword!==r.confirmPassword){g("Passwords do not match"),j(!1);return}if(r.newPassword.length<6){g("Password must be at least 6 characters"),j(!1);return}const R=await we.login({email:r.email,newPassword:r.newPassword});R.token&&R.user&&(await i(R),E("/dashboard"));return}if(c){if(b==="pin"){if(!r.pin||r.pin.length!==4){g("Please enter a valid 4-digit PIN"),j(!1);return}}else if(!r.password){g("Please enter your password"),j(!1);return}}let p;if(c)if(b==="pin")try{p=await we.pinLogin({email:r.email,pin:r.pin})}catch(R){if(R.message.includes("PIN not set"))g("PIN not set for this user. Please use password login.");else if(R.message.includes("Invalid PIN"))g("Invalid PIN. Please try again.");else throw R;j(!1);return}else p=await we.login({email:r.email,password:r.password});else{const R=v(),q=localStorage.getItem("planId")||R?.id||"basic";p=await we.signup({...r,planId:q})}if(p.needsPasswordSetup){d(!0),l({...r,email:p.email}),g(""),j(!1);return}if(!p||!p.user||!p.token)throw new Error("Authentication failed. Please try again.");const D={id:Date.now(),type:c?"login":"signup",user:{id:p.user.id,name:p.user.name,email:p.user.email,role:p.user.role,plan:p.user.plan},timestamp:new Date().toISOString(),ip:"Unknown",userAgent:navigator.userAgent},P=JSON.parse(localStorage.getItem("authActivities")||"[]");P.unshift(D),P.splice(50),localStorage.setItem("authActivities",JSON.stringify(P)),await i(p);const M=c?"logged in":"signed up";console.log(`âœ… User ${p.user.name} ${M} successfully`),p.user.role==="admin"?E("/admin"):p.user.role==="cashier"||p.user.plan==="basic"?E("/dashboard/cashier"):E("/admin")}catch(p){console.error("Authentication error:",p);let D=p.message||"Authentication failed. Please try again.";p.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),D="Invalid credentials. Please try again."),g(D)}finally{j(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:c?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600",children:c?"Login to your account":"Create your account"})]}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[k?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.newPassword,onChange:N=>l({...r,newPassword:N.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.confirmPassword,onChange:N=>l({...r,confirmPassword:N.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!c&&e.jsxs("div",{className:"relative",children:[e.jsx(ut,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.name,onChange:N=>l({...r,name:N.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.email,onChange:N=>l({...r,email:N.target.value}),required:!0})]}),c&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Login Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n("password"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${b==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Password"}),e.jsx("button",{type:"button",onClick:()=>n("pin"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${b==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"pin"})]})]}),c&&b==="password"&&e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.password,onChange:N=>l({...r,password:N.target.value}),required:!0})]}),c&&b==="pin"&&e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.pin,onChange:N=>l({...r,pin:N.target.value.replace(/\D/g,"").slice(0,4)}),maxLength:4,required:!0})]}),!c&&e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.password,onChange:N=>l({...r,password:N.target.value}),required:!0})]})]}),m&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:m}),e.jsx("button",{type:"submit",disabled:u,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50",children:u?"Please wait...":k?"Set Password":c?"Login":"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{f(!c),g(""),d(!1)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:c?"Don't have an account? Sign up":"Already have an account? Login"})})]})})}function Vs(){const[t,c]=a.useState("ultra"),[f,b]=a.useState(!1),[n,r]=a.useState({name:"",email:"",company:""}),l=Pe(),m=[{id:"ultra",name:"Ultra Package (Unlimited)",price:3e3,icon:Lt,color:"from-blue-600 to-purple-600",popular:!0,features:["Admin Dashboard + Cashier POS","Full Inventory Management","Recipe/BOM Builder","Composite Products Support","Automatic Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Advanced Analytics","Unlimited Cashiers","Priority Support"]},{id:"basic",name:"Basic Package",price:1600,icon:Ot,color:"from-green-500 to-teal-600",popular:!1,features:["Admin Dashboard + Cashier POS","Basic Inventory Management","Sales Tracking","Daily/Weekly Sales Summaries","Basic Profit/Loss View","Email Notifications","Record Products Sold","1 Cashier Only"]}],g=async u=>{u.preventDefault();try{await fetch(`${W}/demo-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),alert("Demo request submitted! Admin will review and contact you."),b(!1),r({name:"",email:"",company:""})}catch(j){console.error("Demo request failed:",j),alert("Failed to submit demo request. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:()=>l("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition",children:[e.jsx(xs,{size:20}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mb-8 md:mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Select the perfect plan for your business needs"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6 md:mb-8",children:m.map(u=>{const j=u.icon;return e.jsxs("div",{onClick:()=>c(u.id),className:`card cursor-pointer transition-all transform hover:scale-105 relative ${t===u.id?"ring-4 ring-blue-600 shadow-2xl bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-xl"}`,children:[u.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 md:mb-4",children:[e.jsx("div",{className:`w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br ${u.color} flex items-center justify-center`,children:e.jsx(j,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:u.name})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("span",{className:"text-3xl md:text-4xl font-bold",children:["KSH ",u.price]}),e.jsx("span",{className:"text-gray-600 text-sm md:text-base",children:"/month"})]}),e.jsx("ul",{className:"space-y-2 md:space-y-3",children:u.features.map((k,d)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(We,{className:"w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs md:text-sm",children:k})]},d))})]},u.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center animate-fade-in",children:[e.jsx("button",{onClick:()=>{console.log("Get Started clicked with plan:",t);const u=m.find(j=>j.id===t);console.log("Selected plan:",u),localStorage.setItem("selectedPlan",JSON.stringify(u)),l("/auth/signup")},className:"btn-primary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all",children:"Get Started"}),e.jsx("button",{onClick:()=>b(!0),className:"btn-secondary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg border-2 border-gray-300 hover:border-gray-400 transition-all",children:"Request Free Demo"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-3 md:mt-4 text-center",children:"Secure payment â€¢ Cancel anytime"}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Free Demo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"We'll contact you to schedule a demo"})]}),e.jsxs("form",{onSubmit:g,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:n.name,onChange:u=>r({...n,name:u.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:n.email,onChange:u=>r({...n,email:u.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:n.company,onChange:u=>r({...n,company:u.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition",children:"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})})}function Gs(){const{user:t,logout:c}=me(),[f,b]=a.useState([]),[n,r]=a.useState([]),[l,m]=a.useState([]),[g,u]=a.useState("cash"),[j,k]=a.useState("pos"),[d,E]=a.useState({sales:[],expenses:[],stats:{}}),[i,v]=a.useState(""),[y,N]=a.useState(!1),[p,D]=a.useState(!1),[P,M]=a.useState(null),[R,q]=a.useState({name:"",price:"",cost:"",category:"finished",image:""}),[A,T]=a.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[U,H]=a.useState(!1),[G,oe]=a.useState({description:"",amount:"",category:""}),[ue,te]=a.useState(""),[de,he]=a.useState([]),[z,re]=a.useState(null),[Y,w]=a.useState("exclusive"),[h,S]=a.useState(!1),[I,O]=a.useState(null),[_,L]=a.useState(null),[K,X]=a.useState({});a.useEffect(()=>{ge();const x=localStorage.getItem(`cart_${t?.id}`),s=localStorage.getItem(`paymentMethod_${t?.id}`),o=localStorage.getItem(`selectedDiscount_${t?.id}`),C=localStorage.getItem(`taxType_${t?.id}`),$=localStorage.getItem(`clockStatus_${t?.id}`),B=localStorage.getItem(`clockInTime_${t?.id}`);if(x)try{m(JSON.parse(x))}catch(J){console.warn("Failed to restore cart:",J)}if(s&&u(s),C&&w(C),o)try{re(JSON.parse(o))}catch{}$==="clocked_in"&&(S(!0),B&&L(new Date(B))),Q()},[t?.id]),a.useEffect(()=>{const x=localStorage.getItem("token");x&&fe.connect(x,o=>{if(console.log("ðŸ“¡ WebSocket callback received:",o),o&&o.allProducts){console.log(`ðŸ“¦ Merging ${o.allProducts.length} products from WebSocket`);const C=o.allProducts.filter($=>$.visibleToCashier!==!1&&!$.expenseOnly);b(C)}o&&o.productId!==void 0&&o.newQuantity!==void 0&&(console.log(`ðŸ“¦ Stock update for product ${o.productId}: ${o.newQuantity}${o.unit||""}`),b(C=>C.map(B=>B.id===o.productId?{...B,quantity:o.newQuantity}:B))),o&&o.discounts&&(console.log("ðŸ“Š Discount list updated"),he(o.discounts)),o&&o.sale&&(console.log("ðŸ’° Sale detected, reloading stats"),ge())}).catch(o=>{console.warn("âš ï¸ WebSocket connection failed:",o)});const s=ks(o=>{try{if(!o)return;console.log("ðŸ“¨ Product subscription message:",o.type),(o.type==="initial"||o.type==="products_snapshot"||o.type==="product_created"||o.type==="product_updated"||o.type==="product_deleted")&&ae.getAll().then(C=>{const $=C.filter(B=>B.visibleToCashier!==!1&&!B.expenseOnly);console.log(`âœ… Subscription update: ${$.length} products`),b($)}).catch(C=>{console.error("Failed to fetch products from subscription:",C)})}catch(C){console.error("âŒ Product subscription handler error",C)}});return()=>{try{s()}catch{}fe.disconnect()}},[]),a.useEffect(()=>{(l.length>0||g||Y)&&Ne()},[l,g,Y,z,t?.id]);const Ne=()=>{localStorage.setItem(`cart_${t?.id}`,JSON.stringify(l)),localStorage.setItem(`paymentMethod_${t?.id}`,g),localStorage.setItem(`taxType_${t?.id}`,Y),z&&localStorage.setItem(`selectedDiscount_${t?.id}`,JSON.stringify(z))},pe=async()=>{try{const x=await fetch(`${W}/clock-in`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(x.ok){const s=await x.json();O(s.entry),S(!0);const o=new Date(s.entry.clockIn);L(o),localStorage.setItem(`clockStatus_${t?.id}`,"clocked_in"),localStorage.setItem(`clockInTime_${t?.id}`,o.toISOString()),alert("âœ… "+s.message)}else{const s=await x.json();alert("âš ï¸ "+(s.message||"Failed to clock in"))}}catch(x){console.error("Clock in failed:",x),alert("Failed to clock in")}},Ye=async()=>{try{const x=await fetch(`${W}/clock-out`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(x.ok){const s=await x.json();O(s.entry),S(!1),L(null),localStorage.removeItem(`clockStatus_${t?.id}`),localStorage.removeItem(`clockInTime_${t?.id}`),alert("âœ… "+s.message)}else{const s=await x.json();alert("âš ï¸ "+(s.message||"Failed to clock out"))}}catch(x){console.error("Clock out failed:",x),alert("Failed to clock out")}},Q=async()=>{try{const x=await fetch(`${W}/clock-status`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(x.ok){const s=await x.json();s.isClockedIn&&(S(!0),L(new Date(s.clockInTime)))}}catch(x){console.warn("Failed to check clock status:",x)}},ge=async()=>{try{const[x,s,o,C,$]=await Promise.all([ae.getAll(),Le.getAll(),Ve.getAll(),Rt.get(),Ge.getAll()]);if(b(x.filter(J=>J.visibleToCashier!==!1&&!J.expenseOnly)),E({sales:s,expenses:o,stats:C}),r($),localStorage.getItem(`clockStatus_${t?.id}`)==="true"){S(!0);const J=localStorage.getItem(`clockInTime_${t?.id}`);J&&L(new Date(J))}try{const J=await fetch(`${W}/discounts`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(xe=>xe.json());he(J||[])}catch(J){console.warn("Failed to load discounts:",J)}}catch(x){console.error("Failed to load data:",x)}},Ze=(x,s=!0)=>{const o=x.target.files[0];if(o){const C=new FileReader;C.onload=$=>{const B=$.target.result;te(B),s&&q({...R,image:B})},C.readAsDataURL(o)}},ve=x=>n.filter(o=>o.productId===x&&o.quantity>0).reduce((o,C)=>o+C.quantity,0),Xe=x=>{const s=ve(x.id);if(s<=0){alert("Product is out of stock!");return}const o=l.find($=>$.id===x.id);if((o?o.quantity:0)>=s){alert(`Only ${s} units available in stock!`);return}m(o?l.map($=>$.id===x.id?{...$,quantity:$.quantity+1}:$):[...l,{...x,quantity:1}])},Ae=(x,s)=>{f.find(C=>C.id===x);const o=ve(x);m(l.map(C=>{if(C.id===x){const $=C.quantity+s;return $>o?(alert(`Only ${o} units available!`),C):{...C,quantity:Math.max(1,$)}}return C}).filter(C=>C.quantity>0))},et=x=>{m(l.filter(s=>s.id!==x))},ee=l.reduce((x,s)=>x+s.price*s.quantity,0),tt=async()=>{if(l.length!==0)try{const x=z?z.type==="percentage"?ee*z.value/100:z.value:0,s=ee*.16,o=Y==="inclusive"?ee-x:ee-x+s,C=l.map(Z=>({productId:Z.id,quantity:Z.quantity,unit:K[Z.id]||Z.unit||"piece",price:Z.price}));console.log("ðŸ“¤ Creating sale...");const $=await Le.create({items:C,total:o,discount:x,tax:s,taxType:Y,paymentMethod:g});console.log("âœ… Sale created:",$.id),console.log("ðŸ”„ Refreshing product inventory...");const B=await ae.getAll();console.log(`ðŸ“¦ Received ${B.length} products from server`);const J=B.filter(Z=>Z.visibleToCashier!==!1&&!Z.expenseOnly);if(console.log(`âœ… Filtered to ${J.length} visible products`),b(J),m([]),X({}),re(null),w("exclusive"),localStorage.getItem(`clockStatus_${t?.id}`)==="true"){S(!0);const Z=localStorage.getItem(`clockInTime_${t?.id}`);Z&&L(new Date(Z))}console.log("âœ… Sale completed successfully!"),alert("âœ… Sale completed successfully!")}catch(x){console.error("âŒ Checkout failed:",x.message,x),alert(`âŒ Sale failed: ${x.message||"Unknown error occurred"}`)}},st=async x=>{x.preventDefault();try{console.log("âž• Creating new product:",R.name);const s=await ae.create({...R,price:parseFloat(R.price),cost:parseFloat(R.cost||0),quantity:0});console.log("âœ… Product created:",s),q({name:"",price:"",cost:"",category:"finished",image:""}),te(""),N(!1),console.log("ðŸ”„ Reloading data..."),await ge(),console.log("âœ… Product added successfully!"),alert("âœ… Product added successfully!")}catch(s){console.error("âŒ Failed to add product:",s.message,s),alert(`âŒ Failed to add product: ${s.message||"Unknown error"}`)}},at=async x=>{x.preventDefault();try{const s=Array.isArray(n)?n:[],C={id:s.length>0?Math.max(...s.map($=>$.id||0))+1:1,productId:P.id,quantity:parseInt(A.quantity),expiryDate:A.expiryDate,batchNumber:A.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(A.cost||P.cost||0)};r($=>[...$,C]),await Ge.create({productId:P.id,quantity:parseInt(A.quantity),expiryDate:A.expiryDate,batchNumber:A.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(A.cost||P.cost||0)}),T({quantity:"",expiryDate:"",batchNumber:"",cost:""}),D(!1),M(null),await ge(),alert("Stock added successfully!")}catch(s){console.error("Failed to add stock:",s),alert("Failed to add stock")}},rt=async x=>{x.preventDefault();try{await Ve.create({...G,amount:parseFloat(G.amount)}),oe({description:"",amount:"",category:""}),H(!1),await ge()}catch(s){console.error("Failed to add expense:",s),alert("Failed to add expense")}},lt=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses? This action cannot be undone."))try{const x=localStorage.getItem("token"),o=await fetch(`${W}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${x}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!o.ok){const C=await o.json();throw new Error(C.message||"Failed to clear data")}E({sales:[],expenses:[],stats:{totalSales:0,totalExpenses:0,profit:0}}),m([]),alert("Data cleared successfully!"),await ge()}catch(x){console.error("Failed to clear data:",x),alert("Failed to clear data: "+x.message)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Cashier Dashboard"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cashier Plan - KSH 900/month"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),h&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-green-600 font-semibold",children:"ðŸŸ¢ Clocked In"}),e.jsxs("button",{onClick:Ye,className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-600 hover:bg-red-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(us,{className:"w-4 h-4"}),"Clock Out"]})]}),!h&&e.jsxs("button",{onClick:pe,className:"px-4 py-2 rounded-lg font-medium transition-all bg-green-600 hover:bg-green-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx($t,{className:"w-4 h-4"}),"Clock In"]}),e.jsxs("button",{onClick:()=>{Ne(),c()},className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-100 hover:bg-red-200 text-red-600 border border-red-300 flex items-center gap-2",children:[e.jsx(pt,{className:"w-4 h-4"}),"Logout"]}),e.jsxs("button",{onClick:lt,className:"px-4 py-2 rounded-lg font-medium transition-all bg-orange-100 hover:bg-orange-200 text-orange-600 border border-orange-300 flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Clear"]}),h&&_&&e.jsx("div",{className:"ml-auto text-right text-xs",children:e.jsxs("p",{className:"text-green-600 font-semibold flex items-center gap-1",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Clocked In: ",_.toLocaleTimeString()]})})]})]})}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>k("pos"),className:`px-6 py-2 rounded-lg font-medium transition-all ${j==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(qe,{className:"w-4 h-4 inline mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>k("monitor"),className:`px-6 py-2 rounded-lg font-medium transition-all ${j==="monitor"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(xt,{className:"w-4 h-4 inline mr-2"}),"Monitor"]}),e.jsxs("button",{onClick:()=>k("products"),className:`px-6 py-2 rounded-lg font-medium transition-all ${j==="products"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(ke,{className:"w-4 h-4 inline mr-2"}),"Products"]}),e.jsxs("button",{onClick:()=>k("expenses"),className:`px-6 py-2 rounded-lg font-medium transition-all ${j==="expenses"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(_e,{className:"w-4 h-4 inline mr-2"}),"Expenses"]})]}),j==="pos"&&e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:i,onChange:x=>v(x.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:f.filter(x=>x.name?.toLowerCase().includes(i.toLowerCase())).map(x=>{const s=ve(x.id),o=s<10,C=s<=0;return e.jsxs("button",{onClick:()=>Xe(x),disabled:C,className:`card text-left hover:shadow-xl transition-all transform hover:scale-105 relative ${C?"opacity-50 cursor-not-allowed bg-gray-100":"bg-gradient-to-br from-white to-gray-50"}`,children:[x.image&&e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:x.image,alt:x.name,className:"w-full h-full object-cover"})}),o&&!C&&e.jsx("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white p-1 rounded-full",children:e.jsx(Ee,{className:"w-4 h-4"})}),C&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"OUT"}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-900",children:x.name}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["KSH ",x.price?.toLocaleString()]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:`text-xs font-medium ${C?"text-red-600":o?"text-yellow-600":"text-gray-500"}`,children:["Stock: ",s]}),o&&!C&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium",children:"Low Stock"})]})]},x.id)})})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-gray-200 p-6 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(qe,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[l.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:l.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(qe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:l.map(x=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:x.name}),e.jsx("button",{onClick:()=>et(x.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(ce,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Ae(x.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(hs,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-semibold",children:x.quantity}),e.jsx("button",{onClick:()=>Ae(x.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(le,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(x.price*x.quantity).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2 items-center mt-2",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-600",children:"Unit:"}),e.jsxs("select",{value:K[x.id]||x.unit||"piece",onChange:s=>{X({...K,[x.id]:s.target.value})},className:"text-xs px-2 py-1 border border-gray-300 rounded bg-white",children:[e.jsx("option",{value:"piece",children:"Piece"}),e.jsx("option",{value:"kg",children:"Kilogram (kg)"}),e.jsx("option",{value:"g",children:"Grams (g)"}),e.jsx("option",{value:"l",children:"Liters (L)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",max:"999",placeholder:"qty",defaultValue:x.quantity,className:"text-xs px-2 py-1 border border-gray-300 rounded w-16",onChange:s=>{const o=parseFloat(s.target.value);!isNaN(o)&&o>0&&Ae(x.id,o-x.quantity)}})]})]},x.id))})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"text-gray-700",children:["KSH ",ee.toLocaleString()]})]}),z&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-KSH ",(z.type==="percentage"?ee*z.value/100:z.value).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-orange-600",children:[e.jsxs("span",{children:["Tax (",Y==="exclusive"?"Added":"Included","):"]}),e.jsxs("span",{children:[Y==="exclusive"?"+":"","KSH ",((ee-(z?z.type==="percentage"?ee*z.value/100:z.value:0))*.16).toLocaleString()]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Final Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(Y==="exclusive"?ee-(z?z.type==="percentage"?ee*z.value/100:z.value:0)+(ee-(z?z.type==="percentage"?ee*z.value/100:z.value:0))*.16:ee-(z?z.type==="percentage"?ee*z.value/100:z.value:0)).toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Discount (Optional)"}),e.jsxs("select",{value:z?.id||"",onChange:x=>{x.target.value?re(de.find(s=>s.id===parseInt(x.target.value))):re(null)},className:"input",children:[e.jsx("option",{value:"",children:"No Discount"}),de.filter(x=>x.active).map(x=>e.jsxs("option",{value:x.id,children:[x.name," - ",x.type==="percentage"?`${x.value}%`:`KSH ${x.value}`]},x.id))]}),z&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Discount: KSH ",(z.type==="percentage"?ee*z.value/100:z.value).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tax Type"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"exclusive",checked:Y==="exclusive",onChange:x=>w(x.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Exclusive (16% added)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"inclusive",checked:Y==="inclusive",onChange:x=>w(x.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Inclusive"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:g,onChange:x=>u(x.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:tt,disabled:l.length===0,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg",children:"Complete Sale"})]})]})]}),j==="monitor"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",d.stats.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Se,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",d.stats.totalExpenses?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(_e,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",d.stats.profit?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Se,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Sales"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"})]})}),e.jsx("tbody",{children:d.sales.slice(-15).reverse().map((x,s)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[x.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:x.paymentMethod||"cash"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",x.total?.toLocaleString()]})]},s))})]})})]})]}),j==="products"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Manage Products & Stock"}),e.jsxs("button",{onClick:()=>N(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Product"]})]}),y&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl border-2 border-green-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Product"}),e.jsxs("form",{onSubmit:st,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:R.name,onChange:x=>q({...R,name:x.target.value}),required:!0}),e.jsxs("select",{className:"input",value:R.category,onChange:x=>q({...R,category:x.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsx("input",{type:"number",placeholder:"Selling Price",className:"input",value:R.price,onChange:x=>q({...R,price:x.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Cost Price (Optional)",className:"input",value:R.cost,onChange:x=>q({...R,cost:x.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:x=>Ze(x,!0),className:"input"}),e.jsx(It,{className:"w-5 h-5 text-gray-400"})]}),ue&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:ue,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{N(!1),te(""),q({name:"",price:"",cost:"",category:"finished",image:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),p&&P&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"font-semibold mb-4 text-lg",children:["Add Stock for ",P.name]}),e.jsxs("form",{onSubmit:at,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:A.quantity,onChange:x=>T({...A,quantity:x.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:A.expiryDate,onChange:x=>T({...A,expiryDate:x.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:A.batchNumber,onChange:x=>T({...A,batchNumber:x.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per Unit",className:"input",value:A.cost,onChange:x=>T({...A,cost:x.target.value})}),e.jsxs("div",{className:"flex gap-2 md:col-span-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{D(!1),M(null),T({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:f.map(x=>{const s=ve(x.id),o=n.filter($=>$.productId===x.id&&$.quantity>0),C=s<10;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[x.image&&e.jsx("img",{src:x.image,alt:x.name,className:"w-10 h-10 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:x.name}),e.jsx("div",{className:"text-xs text-gray-500",children:x.category})]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",x.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium ${s===0?"text-red-600":C?"text-yellow-600":"text-gray-900"}`,children:s}),C&&s>0&&e.jsx(Ee,{className:"w-4 h-4 text-yellow-500"}),s===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"text-gray-600",children:[o.length," active"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{M(x),D(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-green-50 rounded-lg text-green-600 transition-colors",title:"Edit Product",children:e.jsx(je,{className:"w-4 h-4"})})]})})]},x.id)})})]})})]})}),j==="expenses"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Track Expenses"}),e.jsxs("button",{onClick:()=>H(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Expense"]})]}),U&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border-2 border-red-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Expense"}),e.jsxs("form",{onSubmit:rt,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:G.description,onChange:x=>oe({...G,description:x.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Amount",className:"input",value:G.amount,onChange:x=>oe({...G,amount:x.target.value}),required:!0}),e.jsx("input",{type:"text",placeholder:"Category",className:"input",value:G.category,onChange:x=>oe({...G,category:x.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>H(!1),className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:d.expenses.slice().reverse().map((x,s)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:x.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:x.category||"General"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",x.amount?.toLocaleString()]})]},s))})]})})]})})]})}function Qs(){const[t,c]=a.useState([]),[f,b]=a.useState([]),[n,r]=a.useState("all"),[l,m]=a.useState(""),[g,u]=a.useState(!1),[j,k]=a.useState([]),[d,E]=a.useState({subject:"",message:""}),[i,v]=a.useState(!0),[y,N]=a.useState(null),[p,D]=a.useState(!0),[P,M]=a.useState(null),R=Pe(),[q,A]=a.useState({totalUsers:0,activeUsers:0,lockedUsers:0,totalRevenue:0,pendingPayments:0,overduePayments:0}),[T,U]=a.useState([]);a.useEffect(()=>{const w=localStorage.getItem("token")||localStorage.getItem("mainAdminToken"),h=localStorage.getItem("user")||localStorage.getItem("mainAdminUser");if(!w||!h){R("/main-admin/login");return}try{if(JSON.parse(h).role!=="owner"){R("/main-admin/login");return}}catch{R("/main-admin/login");return}H().finally(()=>v(!1));const S=JSON.parse(localStorage.getItem("authActivities")||"[]");U(S.slice(0,10));const I=setInterval(()=>{const O=JSON.parse(localStorage.getItem("authActivities")||"[]");U(O.slice(0,10))},5e3);return()=>clearInterval(I)},[R]);const H=async()=>{try{N(null);let w=[],h=!0;try{w=await ct.getUsers()}catch(S){console.warn("MainAdmin API not available, falling back to regular users API:",S.message);try{w=await be.getAll()}catch(I){console.warn("Users API also failed:",I.message),h=!1}}w.length===0&&!h&&(w=oe()),c(w),D(h),te(w,[])}catch(w){console.error("Failed to load data:",w),N("Failed to load dashboard data");const h=oe();c(h),b(ue(h)),D(!1),te(h,[])}},G=()=>{localStorage.removeItem("mainAdminToken"),localStorage.removeItem("mainAdminUser"),R("/main-admin/login")},oe=()=>{const w=localStorage.getItem("user"),h=[];if(w){const I=JSON.parse(w);h.push({...I,id:I.id||"real-user"})}return[{name:"John Doe",email:"john@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Jane Smith",email:"jane@example.com",plan:"basic",price:900,active:!0,locked:!1,role:"cashier"},{name:"Bob Wilson",email:"bob@example.com",plan:"ultra",price:1600,active:!1,locked:!1,role:"admin"},{name:"Alice Brown",email:"alice@example.com",plan:"basic",price:900,active:!0,locked:!0,role:"cashier"},{name:"Mike Johnson",email:"mike@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Sarah Davis",email:"sarah@example.com",plan:"basic",price:900,active:!1,locked:!1,role:"cashier"}].forEach((I,O)=>{h.push({id:`demo-${O+1}`,...I,createdAt:new Date(Date.now()-O*864e5).toISOString(),lastLogin:new Date(Date.now()-Math.random()*864e5).toISOString()})}),h},ue=w=>w.flatMap(h=>[{id:`payment-${h.id}-1`,userId:h.id,amount:h.plan==="ultra"?1600:900,status:Math.random()>.3?"paid":"pending",createdAt:new Date(Date.now()-30*864e5).toISOString(),dueDate:new Date(Date.now()+5*864e5).toISOString()},{id:`payment-${h.id}-2`,userId:h.id,amount:h.plan==="ultra"?1600:900,status:Math.random()>.7?"paid":Math.random()>.5?"pending":"overdue",createdAt:new Date(Date.now()-60*864e5).toISOString(),dueDate:new Date(Date.now()-5*864e5).toISOString()}]),te=(w,h)=>{const S=w.length,I=w.filter(X=>X.active).length,O=w.filter(X=>X.locked).length,_=h.filter(X=>X.status==="paid").reduce((X,Ne)=>X+Ne.amount,0),L=h.filter(X=>X.status==="pending").length,K=h.filter(X=>X.status==="overdue").length;A({totalUsers:S,activeUsers:I,lockedUsers:O,totalRevenue:_,pendingPayments:L,overduePayments:K})},de=async(w,h)=>{try{M(w);const S=!h;try{await ct.lockUser(w,S);const I=t.map(L=>L.id===w?{...L,locked:S,active:!S}:L);c(I),te(I,f);const O=t.find(L=>L.id===w),_=S?"locked":"unlocked";alert(`âœ… ${O?.name||`User ${w}`} has been ${_} successfully!`)}catch(I){console.error("API lock failed:",I);const O=t.map(K=>K.id===w?{...K,locked:S,active:!S}:K);c(O),te(O,f);const _=t.find(K=>K.id===w),L=S?"locked":"unlocked";alert(`âš ï¸ Backend not available. ${_?.name||`User ${w}`} ${L} locally. Changes will sync when backend is available.`)}}catch(S){console.error("Failed to toggle lock:",S),alert(`âŒ Failed to update user status: ${S.message}`)}finally{M(null)}},he=async(w,h,S)=>{try{v(!0);try{await ct.sendEmail({userIds:w,subject:h,message:S}),alert("Emails sent successfully!"),u(!1),k([]),E({subject:"",message:""});return}catch(_){console.warn("Backend email operation failed, simulating email send:",_.message)}const I=t.filter(_=>w.includes(_.id)),O=JSON.parse(localStorage.getItem("emailLogs")||"[]");O.push({timestamp:new Date().toISOString(),recipients:I.map(_=>({id:_.id,name:_.name,email:_.email})),subject:h,message:S,status:"simulated"}),localStorage.setItem("emailLogs",JSON.stringify(O)),alert(`âœ… Email simulation successful!

ðŸ“§ Sent to ${I.length} user(s):
${I.map(_=>`${_.name} (${_.email})`).join(`
`)}

${p?"":`ðŸ“Œ Backend not deployed - this was a simulation.
`}ðŸ’¡ Deploy backend to send real emails.`),u(!1),k([]),E({subject:"",message:""})}catch(I){console.error("Failed to send email:",I),alert("Failed to process email request.")}finally{v(!1)}},z=async w=>{const h=t.find(S=>S.id===w);h&&await he([w],"Payment Reminder - Subscription",`Dear ${h.name},

This is a friendly reminder about your pending subscription payment for ${h.plan?.toUpperCase()} plan (KSH ${h.price}).

Please complete your payment to continue enjoying our services.

Thank you!`)},re=t.filter(w=>{const h=w.name?.toLowerCase().includes(l.toLowerCase())||w.email?.toLowerCase().includes(l.toLowerCase());if(n==="all")return h;if(n==="active")return h&&w.active&&!w.locked;if(n==="locked")return h&&w.locked;if(n==="trial")return h&&(!w.active||!w.plan);if(n==="pending-payment"){const S=f.filter(I=>I.userId===w.id&&I.status==="pending");return h&&S.length>0}if(n==="overdue"){const S=f.filter(I=>I.userId===w.id&&I.status==="overdue");return h&&S.length>0}return h}),Y=w=>{const h=f.filter(_=>_.userId===w),S=h.filter(_=>_.status==="pending").length,I=h.filter(_=>_.status==="overdue").length,O=h.filter(_=>_.status==="paid").length;return{pending:S,overdue:I,paid:O,total:h.length}};return i&&t.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-white mx-auto mb-4"}),e.jsx("p",{className:"text-white text-xl",children:"Loading Main Admin Dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900",children:[!p&&e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm md:text-base font-semibold",children:["âš ï¸ Demo Mode: Backend not available. Actions are simulated locally.",e.jsx("a",{href:"/BACKEND_NOT_DEPLOYED.md",className:"underline ml-2",children:"Deploy Backend â†’"})]})}),y&&e.jsx("div",{className:"bg-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm font-semibold",children:["âš ï¸ ",y]})}),e.jsx("header",{className:"bg-black/30 backdrop-blur-lg border-b border-white/10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Main Admin Dashboard"}),e.jsx("p",{className:"text-gray-300",children:"Monitor all users, payments, and system activity"})]}),e.jsxs("button",{onClick:G,className:"flex items-center gap-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 px-4 py-2 rounded-lg transition-colors",children:[e.jsx(pt,{className:"w-4 h-4"}),"Logout"]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ce,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:q.totalUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx($e,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:q.activeUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Active Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ie,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:q.lockedUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Locked Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Se,{className:"w-8 h-8 text-yellow-400"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:["KSH ",q.totalRevenue.toLocaleString()]})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ee,{className:"w-8 h-8 text-orange-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:q.pendingPayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Pending Payments"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(mt,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:q.overduePayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Overdue Payments"})]})]}),e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 flex-1 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-80",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",value:l,onChange:w=>m(w.target.value)})]}),e.jsxs("select",{value:n,onChange:w=>r(w.target.value),className:"px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"locked",children:"Locked"}),e.jsx("option",{value:"trial",children:"Free Trial"}),e.jsx("option",{value:"pending-payment",children:"Pending Payment"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsxs("button",{onClick:()=>u(!0),disabled:j.length===0||i,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-3 rounded-lg font-bold flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ke,{className:"w-5 h-5"}),"Send Email to Selected (",j.length,")"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"xl:col-span-2 bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"All Users"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left",children:e.jsx("input",{type:"checkbox",checked:j.length===re.length&&re.length>0,onChange:w=>{w.target.checked?k(re.map(h=>h.id)):k([])},className:"w-5 h-5 rounded"})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Actions"})]})}),e.jsxs("tbody",{children:[re.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:"5",className:"px-4 py-12 text-center",children:[e.jsx(Ce,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:l||n!=="all"?"Try adjusting your filters":"Users will appear here once they sign up"})]})}),re.map(w=>(Y(w.id),e.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:j.includes(w.id),onChange:h=>{h.target.checked?k([...j,w.id]):k(j.filter(S=>S!==w.id))},className:"w-5 h-5 rounded"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[w.profilePicture?e.jsx("img",{src:w.profilePicture,alt:w.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:w.name?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:w.name}),e.jsx("p",{className:"text-sm text-gray-400",children:w.email})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${w.plan==="ultra"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"}`,children:[w.plan?.toUpperCase()," - KSH ",w.price]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"flex items-center gap-2",children:w.locked?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-300 flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"}),"Locked"]}):w.active?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-300 flex items-center gap-1",children:[e.jsx($e,{className:"w-3 h-3"}),"Active"]}):e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-500/20 text-gray-300",children:"Inactive"})})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>de(w.id,w.locked),disabled:P===w.id,className:`p-2 rounded-lg transition ${w.locked?"bg-green-500/20 hover:bg-green-500/30 text-green-300":"bg-red-500/20 hover:bg-red-500/30 text-red-300"} ${P===w.id?"opacity-50 cursor-not-allowed":""}`,title:w.locked?"Unlock User":"Lock User",children:P===w.id?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):w.locked?e.jsx(ps,{className:"w-4 h-4"}):e.jsx(ie,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>z(w.id),disabled:i,className:"p-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 transition",title:"Send Payment Reminder",children:e.jsx(gs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{w.role==="cashier"?window.open("/dashboard/cashier","_blank"):window.open("/admin","_blank")},className:"p-2 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 transition",title:"View User Dashboard",children:e.jsx(Tt,{className:"w-4 h-4"})})]})})]},w.id)))]})]})})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl border border-white/20",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5"}),"Recent Activity"]})}),e.jsx("div",{className:"p-4 space-y-3 max-h-96 overflow-y-auto",children:T.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"No recent activity"}):T.map(w=>e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${w.type==="login"?"bg-green-400":"bg-blue-400"}`}),e.jsx("span",{className:"text-white font-medium",children:w.user.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${w.type==="login"?"bg-green-500/20 text-green-300":"bg-blue-500/20 text-blue-300"}`,children:w.type})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:w.user.email}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:new Date(w.timestamp).toLocaleString()})]},w.id))})]})]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-purple-900 rounded-2xl shadow-2xl max-w-2xl w-full border border-white/20",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Ke,{}),"Send Email to ",j.length," User(s)"]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Subject"}),e.jsx("input",{type:"text",value:d.subject,onChange:w=>E({...d,subject:w.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email subject..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Message"}),e.jsx("textarea",{value:d.message,onChange:w=>E({...d,message:w.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 h-40",placeholder:"Email message..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>he(j,d.subject,d.message),disabled:i,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white py-3 rounded-lg font-bold transition disabled:opacity-50",children:i?"Sending...":"Send Email"}),e.jsx("button",{onClick:()=>u(!1),className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-lg font-bold transition",children:"Cancel"})]})]})]})})]})}function Ys({user:t}){const[c,f]=a.useState(!1);if(c||!t)return null;const b=t?.serviceStartDate?new Date(t.serviceStartDate):null,n=t?.daysUsed||0,r=t?.plan||"",m=Math.max(0,30-n);return m>7?null:e.jsxs("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-3 md:p-4 flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(Be,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-amber-900",children:m===0?`Your ${r} plan has expired. Please renew to continue.`:`Your ${r} plan expires in ${m} day${m!==1?"s":""}. Consider upgrading.`}),e.jsxs("p",{className:"text-xs text-amber-700 mt-1",children:["Service started: ",b?.toLocaleDateString()||"Unknown"]})]})]}),e.jsx("button",{onClick:()=>f(!0),className:"flex-shrink-0 text-amber-600 hover:text-amber-900",children:e.jsx(ye,{className:"w-5 h-5"})})]})}function Zs(){const{refreshProducts:t}=Bt();return a.useEffect(()=>{const c=n=>{console.log("ðŸ“¦ Stock update received:",n.detail),t()},f=n=>{console.log("âœ… Sale completed, refreshing stock:",n.detail),t()},b=n=>{console.log("ðŸ”„ Products sync event:",n.detail)};return window.addEventListener("stockUpdate",c),window.addEventListener("saleComplete",f),window.addEventListener("productsSync",b),()=>{window.removeEventListener("stockUpdate",c),window.removeEventListener("saleComplete",f),window.removeEventListener("productsSync",b)}},[t]),null}function ot({children:t,adminOnly:c=!1,ultraOnly:f=!1,ownerOnly:b=!1}){const{user:n,loading:r}=me(),{isLocked:l,lock:m,unlock:g}=As(),[u,j]=a.useState(!1),k=Ht(6e4),d=k?.[0]||l||!1,E=a.useCallback(()=>{k?.[1]?.(),g()},[k,g]),[i,v]=a.useState({});if(a.useEffect(()=>{n&&!b&&((async()=>{try{const p=localStorage.getItem("token"),P=await fetch(`${W}/settings`,{headers:{Authorization:`Bearer ${p}`}});if(P.ok){const M=await P.json();v(M)}}catch(p){console.error("Failed to load settings:",p)}})(),sessionStorage.getItem("reminderShown")||(j(!0),sessionStorage.setItem("reminderShown","true")))},[n,b]),a.useEffect(()=>{const N=p=>{console.log("ðŸ”’ Admin locked screen:",p.detail),m("admin")};return window.addEventListener("admin_locked_user_screen",N),()=>window.removeEventListener("admin_locked_user_screen",N)},[m]),r&&!b)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(b){const N=localStorage.getItem("ownerToken"),p=localStorage.getItem("ownerUser");if(!N||!p)return e.jsx(se,{to:"/main.admin"});try{if(JSON.parse(p).type!=="main_admin")return e.jsx(se,{to:"/main.admin"})}catch{return e.jsx(se,{to:"/main.admin"})}}else{if(!n)return e.jsx(se,{to:"/auth/login"});if(!n.active)return e.jsx(se,{to:"/plans"});if(c&&n.role!=="admin")return e.jsx(se,{to:"/dashboard"});if(f&&(n.role!=="admin"||n.plan!=="ultra"))return e.jsx(se,{to:"/dashboard"})}const y=b?"owner":"user";return e.jsxs(e.Fragment,{children:[e.jsx(Ys,{}),e.jsx(Zs,{}),d&&e.jsx(Jt,{onUnlock:E,userType:y}),u&&e.jsx(zt,{onClose:()=>j(!1)}),t]})}function Xs(){const{user:t}=me();return!t||!t.active?e.jsx(se,{to:"/plans"}):t.role==="admin"?e.jsx(se,{to:"/admin"}):e.jsx(se,{to:"/dashboard/cashier"})}function ea(){return e.jsx(Cs,{children:e.jsx(Ps,{children:e.jsx(Ds,{children:e.jsx(Qt,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(Pt,{children:[e.jsx(V,{path:"/",element:e.jsx(Ks,{})}),e.jsx(V,{path:"/auth/login",element:e.jsx(kt,{})}),e.jsx(V,{path:"/auth/signup",element:e.jsx(kt,{})}),e.jsx(V,{path:"/plans",element:e.jsx(Vs,{})}),e.jsx(V,{path:"/main.admin/*",element:e.jsx(Qs,{})}),e.jsx(V,{path:"/dashboard",element:e.jsx(ot,{children:e.jsx(Xs,{})})}),e.jsx(V,{path:"/dashboard/cashier",element:e.jsx(ot,{children:e.jsx(Gs,{})})}),e.jsx(V,{path:"/admin/*",element:e.jsx(ot,{adminOnly:!0,children:e.jsx(Ws,{})})}),e.jsx(V,{path:"/login",element:e.jsx(se,{to:"/auth/login"})}),e.jsx(V,{path:"/signup",element:e.jsx(se,{to:"/auth/signup"})}),e.jsx(V,{path:"/subscription",element:e.jsx(se,{to:"/plans"})}),e.jsx(V,{path:"/payment",element:e.jsx(se,{to:"/plans"})}),e.jsx(V,{path:"/cashier",element:e.jsx(se,{to:"/dashboard/cashier"})})]})})})})})}Ns.createRoot(document.getElementById("root")).render(e.jsx(Yt.StrictMode,{children:e.jsx(ea,{})}));
