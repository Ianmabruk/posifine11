import{a as Ut,b as Ot,g as Ft,r,u as ye,c as Ze,R as ht,d as J,B as $t,N as X,e as Rt}from"./vendor-Ct1st1Nj.js";import{C as Re,D as fe,T as Ce,P as Ae,S as pt,a as qe,b as gt,c as ae,d as qt,e as Mt,f as De,g as Se,h as ie,i as bt,j as Bt,k as Ht,L as le,U as Ve,l as nt,m as je,E as Xe,M as it,n as ge,X as Ie,o as Je,p as Fe,q as et,r as be,s as ct,t as Me,B as tt,R as ft,I as zt,u as Be,v as We,w as we,x as ot,y as jt,z as Jt,A as yt,F as Ye,G as Kt,H as _t,J as st,K as Gt,N as Te,O as Vt,Q as Qe,Z as Nt,V as at,W as vt,Y as Wt,_ as Yt,$ as Ke,a0 as Qt,a1 as Zt,a2 as Xt}from"./icons-D1SUkt2n.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))b(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&b(l)}).observe(document,{childList:!0,subtree:!0});function f(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function b(n){if(n.ep)return;n.ep=!0;const s=f(n);fetch(n.href,s)}})();var _e={exports:{}},ke={};var dt;function es(){if(dt)return ke;dt=1;var t=Ut(),o=Symbol.for("react.element"),f=Symbol.for("react.fragment"),b=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function l(h,m,i){var u,g={},a=null,P=null;i!==void 0&&(a=""+i),m.key!==void 0&&(a=""+m.key),m.ref!==void 0&&(P=m.ref);for(u in m)b.call(m,u)&&!s.hasOwnProperty(u)&&(g[u]=m[u]);if(h&&h.defaultProps)for(u in m=h.defaultProps,m)g[u]===void 0&&(g[u]=m[u]);return{$$typeof:o,type:h,key:a,ref:P,props:g,_owner:n.current}}return ke.Fragment=f,ke.jsx=l,ke.jsxs=l,ke}var mt;function ts(){return mt||(mt=1,_e.exports=es()),_e.exports}var e=ts(),Le={},xt;function ss(){if(xt)return Le;xt=1;var t=Ot();return Le.createRoot=t.createRoot,Le.hydrateRoot=t.hydrateRoot,Le}var as=ss();const rs=Ft(as),ls=()=>{const t="https://posifine11-backend-spu4.vercel.app";{const o=t.replace(/\/$/,"");return o.endsWith("/api")?o:`${o}/api`}},Z=ls(),wt=()=>localStorage.getItem("token"),U=async(t,o={})=>{const f=wt(),b=t.startsWith("/")?t:`/${t}`,n={...o,headers:{"Content-Type":"application/json",...f&&!(b.startsWith("/auth")&&b!=="/auth/me")&&!b.includes("/main-admin/auth/login")&&{Authorization:`Bearer ${f}`},...o.headers}};try{const s=await fetch(`${Z}${b}`,n);if(s.status===401){localStorage.removeItem("token"),localStorage.removeItem("user");const h=window.location.pathname||"";if(!h.includes("/login")&&!h.includes("/signup")&&!h.includes("/auth")&&!h.includes("/main.admin"))try{window.location.href="/login"}catch{}const m=new Error("Unauthorized");throw m.status=401,m}if(s.ok)return s.status===204?{success:!0}:await s.json();const l=await s.json().catch(()=>({error:"Network error"}));throw new Error(l.error||`HTTP ${s.status}: ${s.statusText}`)}catch(s){throw s.name==="TypeError"&&s.message.includes("fetch")?(console.error("API Fetch Error:",s),console.error("Attempted URL:",`${Z}${b}`),new Error("Backend server unavailable. Using demo mode.")):s}},ve={login:t=>U("/auth/login",{method:"POST",body:JSON.stringify(t)}),pinLogin:t=>U("/auth/pin-login",{method:"POST",body:JSON.stringify(t)}),signup:t=>U("/auth/signup",{method:"POST",body:JSON.stringify(t)}),signupWithPayment:t=>U("/signup-with-payment",{method:"POST",body:JSON.stringify(t)}),me:()=>U("/auth/me")},Ne={getAll:()=>U("/users"),create:t=>U("/users",{method:"POST",body:JSON.stringify(t)}),update:(t,o)=>U(`/users/${t}`,{method:"PUT",body:JSON.stringify(o)}),delete:t=>U(`/users/${t}`,{method:"DELETE"}),setPin:(t,o)=>U(`/users/${t}/set-pin`,{method:"POST",body:JSON.stringify({pin:o})}),lock:(t,o)=>U(`/users/${t}/lock`,{method:"POST",body:JSON.stringify({locked:o})})},ne={getAll:()=>U("/products"),create:t=>U("/products",{method:"POST",body:JSON.stringify(t)}),update:(t,o)=>U(`/products/${t}`,{method:"PUT",body:JSON.stringify(o)}),delete:t=>U(`/products/${t}`,{method:"DELETE"}),getMaxProducible:t=>U(`/products/${t}/max-producible`)},Ee={getAll:()=>U("/sales"),create:t=>U("/sales",{method:"POST",body:JSON.stringify(t)})},He={getAll:()=>U("/expenses"),create:t=>U("/expenses",{method:"POST",body:JSON.stringify(t)})},St={get:()=>U("/stats")},Ue={getAll:()=>U("/discounts"),create:t=>U("/discounts",{method:"POST",body:JSON.stringify(t)}),update:(t,o)=>U(`/discounts/${t}`,{method:"PUT",body:JSON.stringify(o)}),delete:t=>U(`/discounts/${t}`,{method:"DELETE"})},Ge={getAll:()=>U("/credit-requests"),create:t=>U("/credit-requests",{method:"POST",body:JSON.stringify(t)}),approve:t=>U(`/credit-requests/${t}/approve`,{method:"POST"}),reject:t=>U(`/credit-requests/${t}/reject`,{method:"POST"})},Pe={get:()=>U("/settings"),update:t=>U("/settings",{method:"POST",body:JSON.stringify(t)})},ze={getAll:t=>{const o=t?`/batches?productId=${t}`:"/batches";return U(o)},create:t=>U("/batches",{method:"POST",body:JSON.stringify(t)})},pe={login:t=>U("/main-admin/auth/login",{method:"POST",body:JSON.stringify(t)}),getUsers:()=>{const t=localStorage.getItem("ownerToken");return U("/main-admin/users",{headers:{Authorization:`Bearer ${t}`}})},getStats:()=>{const t=localStorage.getItem("ownerToken");return U("/main-admin/stats",{headers:{Authorization:`Bearer ${t}`}})},getActivities:()=>{const t=localStorage.getItem("ownerToken");return U("/main-admin/activities",{headers:{Authorization:`Bearer ${t}`}})},lockUser:(t,o)=>{const f=localStorage.getItem("ownerToken");return U(`/main-admin/users/${t}/lock`,{method:"POST",headers:{Authorization:`Bearer ${f}`},body:JSON.stringify({locked:o})})},changePlan:(t,o)=>{const f=localStorage.getItem("ownerToken");return U(`/main-admin/users/${t}/plan`,{method:"POST",headers:{Authorization:`Bearer ${f}`},body:JSON.stringify({plan:o})})},clearData:t=>{const o=localStorage.getItem("ownerToken");return U("/main-admin/system/clear-data",{method:"POST",headers:{Authorization:`Bearer ${o}`},body:JSON.stringify({type:t})})}};let se=null,$e=new Set;function ns(){const t=Z.replace(/\/api$/,"");return`${t.startsWith("https")?"wss":"ws"}://${t.replace(/^https?:\/\//,"")}/api/ws/products`}function is(){if(se&&(se.readyState===WebSocket.OPEN||se.readyState===WebSocket.CONNECTING))return;const t=wt(),o=ns()+(t?`?token=${encodeURIComponent(t)}`:"");se=new WebSocket(o),se.onopen=()=>{console.debug("Products WS connected")},se.onmessage=f=>{let b=null;try{b=JSON.parse(f.data)}catch{return}$e.forEach(n=>{try{n(b)}catch(s){console.error("ws callback error",s)}})},se.onclose=()=>{console.debug("Products WS closed"),se=null},se.onerror=f=>{console.error("Products WS error",f)}}function cs(t){if(typeof t!="function")throw new Error("subscribeProducts requires a callback");return $e.add(t),is(),()=>{if($e.delete(t),se&&$e.size===0){try{se.close()}catch{}se=null}}}const kt=r.createContext(),de=()=>r.useContext(kt),os=({children:t})=>{const[o,f]=r.useState(null),[b,n]=r.useState(!0),[s,l]=r.useState(!1),[h,m]=r.useState({});r.useEffect(()=>{i()},[]),r.useEffect(()=>{const k=()=>{const D=localStorage.getItem("user");if(D)try{const H=JSON.parse(D);f(H)}catch(H){console.warn("Failed to parse user from localStorage",H)}else f(null)};return window.addEventListener("storage",k),window.addEventListener("localStorageUpdated",k),()=>{window.removeEventListener("storage",k),window.removeEventListener("localStorageUpdated",k)}},[]);const i=async()=>{try{const k=localStorage.getItem("token"),D=localStorage.getItem("user");if(k)try{const H=await fetch(`${Z}/auth/me`,{headers:{Authorization:`Bearer ${k}`,"Content-Type":"application/json"}});if(H.ok){const M=await H.json();f(M),localStorage.setItem("user",JSON.stringify(M))}else throw new Error("Invalid token")}catch(H){if(console.warn("Auth check failed:",H),H.message.includes("fetch")||H.message.includes("Network")){const M={id:1,name:"Demo Admin",email:"admin@demo.com",role:"admin",plan:"ultra",active:!0};f(M),localStorage.setItem("user",JSON.stringify(M));return}if(D)try{const M=JSON.parse(D);f(M)}catch{localStorage.removeItem("token"),localStorage.removeItem("user")}else localStorage.removeItem("token")}}catch(k){console.error("Error initializing auth:",k),localStorage.removeItem("token"),localStorage.removeItem("user"),f(null)}finally{n(!1),l(!0)}},u=async k=>{try{if(k&&k.token&&k.user)return localStorage.setItem("token",k.token),localStorage.setItem("user",JSON.stringify(k.user)),f(k.user),k;const D=await ve.login(k);if(D.token&&D.user)return localStorage.setItem("token",D.token),localStorage.setItem("user",JSON.stringify(D.user)),f(D.user),D;throw new Error("Invalid response from server")}catch(D){if(console.error("Login failed:",D),D.message.includes("500")||D.message.includes("Network")||D.message.includes("fetch")){const H={id:1,name:"Demo User",email:k.email||"demo@example.com",role:"admin",plan:"ultra",active:!0},M="demo-token-"+Date.now();return localStorage.setItem("token",M),localStorage.setItem("user",JSON.stringify(H)),f(H),{user:H,token:M}}throw D}},g=async k=>{try{const D=await ve.signup(k);if(D.token&&D.user)return localStorage.setItem("token",D.token),localStorage.setItem("user",JSON.stringify(D.user)),f(D.user),D;throw new Error("Invalid response from server")}catch(D){throw console.error("Signup failed:",D),D}},a=async k=>{try{if(localStorage.setItem("user",JSON.stringify(k)),f(k),window.dispatchEvent(new Event("localStorageUpdated")),k&&k.id)try{await Ne.update(k.id,k)}catch(D){console.warn("Failed to persist updated user to backend",D)}return k}catch(D){throw console.error("updateUser failed:",D),D}},P=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),f(null),window.location.href="/login"},x=()=>!!o&&!!localStorage.getItem("token"),j=k=>o&&o.role===k,N=()=>o&&(o.role==="admin"||o.role==="main-admin"),y=()=>o&&o.role==="cashier",S=()=>o&&o.plan==="ultra",A=()=>o&&o.plan==="basic",C=()=>o&&(o.role==="admin"||o.role==="cashier"),R=()=>o&&o.role==="admin"&&o.plan==="ultra",c=()=>o&&o.role==="admin",T=()=>!0,v=()=>!0;return o?.locked?e.jsx(LockedAccount,{}):e.jsx(kt.Provider,{value:{user:o,loading:b,isInitialized:s,appSettings:h,login:u,signup:g,updateUser:a,logout:P,isAuthenticated:x,hasRole:j,isAdmin:N,isCashier:y,isUltraPackage:S,isBasicPackage:A,canEditStock:C,canManageUsers:R,canViewAnalytics:c,isRealTimeProductSyncEnabled:T,isCashierUserManagementEnabled:v},children:t})},ds=[{id:1,name:"Coffee Beans",price:1200,quantity:50,unit:"kg",category:"beverages",code:"CB001"},{id:2,name:"Sugar",price:150,quantity:100,unit:"kg",category:"ingredients",code:"SG001"},{id:3,name:"Milk",price:80,quantity:25,unit:"L",category:"dairy",code:"MK001"}];new Date().toISOString();const Ct=r.createContext(),ms=()=>r.useContext(Ct),xs=({children:t})=>{const{user:o}=de(),[f,b]=r.useState([]),[n,s]=r.useState(!0),[l,h]=r.useState(null),[m,i]=r.useState(Date.now()),u=r.useCallback(async()=>{if(!localStorage.getItem("token")){s(!1);return}try{const a=await ne.getAll();let P=[];Array.isArray(a)?P=a:a&&Array.isArray(a.products)?P=a.products:a&&Array.isArray(a.data)&&(P=a.data);const x=P.filter(j=>!j.pendingDelete);b(j=>JSON.stringify(j)!==JSON.stringify(x)?(console.log("Products updated:",x.length,"products"),x):j),h(null)}catch(a){console.error("Failed to fetch products:",a),a.message.includes("500")||a.message.includes("Network")||a.message.includes("fetch")?(console.log("Using demo products due to backend error"),b(ds),h("Using demo data - backend unavailable")):f.length===0?h(a.message||"Failed to load products"):console.warn("Product fetch failed, keeping cached products")}finally{s(!1),i(Date.now())}},[]);r.useEffect(()=>{u()},[u,o]),r.useEffect(()=>{const a=setInterval(()=>{console.log("Auto-refreshing products..."),u()},5e3);return()=>clearInterval(a)},[u]);const g=async()=>{s(!0),await u()};return e.jsx(Ct.Provider,{value:{products:f,loading:n,error:l,lastUpdated:m,refreshProducts:g},children:t})};function us(){const[t,o]=r.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[f,b]=r.useState(!0),[n,s]=r.useState(null);r.useEffect(()=>{l()},[]);const l=async()=>{try{s(null);const[i,u]=await Promise.all([St.get(),Ee.getAll()]),g={totalSales:i?.totalSales||0,totalExpenses:i?.totalExpenses||0,profit:i?.profit||0,grossProfit:i?.grossProfit||0,netProfit:i?.netProfit||0,totalCOGS:i?.totalCOGS||0,dailySales:i?.dailySales||0,weeklySales:i?.weeklySales||0,productCount:i?.productCount||0},a=Array.isArray(u)?u:[];o({stats:g,recentSales:a.slice(-10).reverse()})}catch(i){console.error("Failed to load data:",i),s(i.message),o({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{b(!1)}};if(f)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(n&&t.stats.totalSales===0&&t.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Re,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:n}),e.jsx("button",{onClick:l,className:"btn-primary",children:"Retry"})]})});const h=[{label:"Total Sales",value:`KSH ${t.stats.totalSales?.toLocaleString()||0}`,icon:fe,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${t.stats.grossProfit?.toLocaleString()||0}`,icon:Ce,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${t.stats.totalCOGS?.toLocaleString()||0}`,icon:Ae,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${t.stats.netProfit?.toLocaleString()||0}`,icon:Ce,color:"from-purple-500 to-pink-600",change:"+15.3%"}],m=[{label:"Daily Sales",value:`KSH ${t.stats.dailySales?.toLocaleString()||0}`,icon:pt,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${t.stats.weeklySales?.toLocaleString()||0}`,icon:Ce,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${t.stats.totalExpenses?.toLocaleString()||0}`,icon:qe,color:"bg-red-50 text-red-600"},{label:"Products",value:t.stats.productCount||0,icon:Ae,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(h||[]).map((i,u)=>{const g=i?.icon;return g?e.jsxs("div",{className:`card bg-gradient-to-br ${i.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(g,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:i.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:i.label}),e.jsx("p",{className:"text-2xl font-bold",children:i.value})]},u):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(m||[]).map((i,u)=>{const g=i?.icon;return g?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${i.color} flex items-center justify-center`,children:e.jsx(g,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:i.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:i.value})]})]})},u):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!t.recentSales||t.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Re,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(t.recentSales||[]).map(i=>i?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:i.createdAt?new Date(i.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(i.items)?i.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:i.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",i.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",i.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",i.profit?.toLocaleString()||0]})]},i.id||Math.random()):null)})]})})]})]})}function hs(){const{user:t,isUltraPackage:o,isRealTimeProductSyncEnabled:f}=de(),{products:b,refreshProducts:n}=ms(),[s,l]=r.useState([]),[h,m]=r.useState([]),[i,u]=r.useState("all"),[g,a]=r.useState(""),[P,x]=r.useState(!1),[j,N]=r.useState(!1),[y,S]=r.useState(!1),[A,C]=r.useState(null),[R,c]=r.useState(null),[T,v]=r.useState(null),[k,D]=r.useState(!1),[H,M]=r.useState(null),[ce,me]=r.useState(""),[B,G]=r.useState({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),[Q,te]=r.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[$,Y]=r.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0});r.useEffect(()=>{w()},[]);const w=async()=>{try{await n();const d=await ze.getAll();m(d)}catch(d){console.error("Failed to load data:",d)}};r.useEffect(()=>{b&&l(b)},[b]);const L=(d,I=!0)=>{const F=d.target.files[0];if(F){const K=new FileReader;K.onload=V=>{const re=V.target.result;me(re),I?G({...B,image:re}):Y({...$,image:re})},K.readAsDataURL(F)}},O=d=>h.filter(F=>F.productId===d&&F.quantity>0).reduce((F,K)=>F+K.quantity,0),_=d=>h.filter(I=>I.productId===d&&I.quantity>0),ee=(d,I="success")=>{v({message:d,type:I}),setTimeout(()=>v(null),5e3)},oe=async d=>{d.preventDefault();try{const I={...B,price:parseFloat(B.price),cost:parseFloat(B.cost||0),quantity:0,visibleToCashier:!B.expenseOnly&&B.visibleToCashier!==!1},F=await ne.create(I);G({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),me(""),x(!1),await w(),ee(`âœ… Product "${F.name}" added successfully! ${F.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success")}catch(I){console.error("Failed to create product:",I),alert(`Failed to create product: ${I.message||"Unknown error"}`)}},xe=async d=>{d.preventDefault();try{await ze.create({productId:A.id,quantity:parseInt(Q.quantity),expiryDate:Q.expiryDate,batchNumber:Q.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(Q.cost||A.cost||0)}),te({quantity:"",expiryDate:"",batchNumber:"",cost:""}),S(!1),C(null),await w(),ee(`âœ… Stock added successfully for ${A.name}!`,"success")}catch(I){console.error("Failed to add stock:",I),alert("Failed to add stock")}},p=async d=>{d.preventDefault();try{const I=s.find(V=>V.id===$.id);if(parseFloat($.price)<I.price){alert("You cannot lower prices, only increase.");return}const F={...$,price:parseFloat($.price),cost:parseFloat($.cost),quantity:parseFloat($.quantity)},K=await ne.update($.id,F);N(!1),await n(),f()?(D(!0),window.dispatchEvent(new CustomEvent("productUpdated",{detail:{product:K,originalProduct:I,timestamp:new Date().toISOString(),type:"update"}})),ee("ðŸ“¡ Product updated and synced to all dashboards!","success"),M(new Date),setTimeout(()=>{D(!1)},3e3)):alert("Product updated successfully!")}catch(I){console.error("Failed to update product:",I),alert(`Failed to update product: ${I.message||"Unknown error"}`)}},E=async d=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const I=s.find(K=>K.id===d),F=await ne.delete(d);if(l(K=>K.filter(V=>V.id!==d)),f()&&I)D(!0),window.dispatchEvent(new CustomEvent("productDeleted",{detail:{product:I,timestamp:new Date().toISOString(),type:"delete"}})),ee(`ðŸ“¡ Product "${I.name}" deleted and synced to all dashboards!`,"success"),M(new Date),setTimeout(()=>{D(!1)},3e3);else{const K=F?.message||"Product deleted successfully!";alert(K)}await n()}catch(I){console.error("Failed to delete product:",I);let F="Failed to delete product";I.message.includes("Failed to execute")||I.message.includes("JSON")?F="Network error. Please check your connection and try again.":I.message.includes("401")||I.message.includes("unauthorized")?F="You are not authorized to delete this product.":I.message.includes("404")||I.message.includes("not found")?F="Product not found. It may have been deleted already.":I.message&&(F=`Failed to delete product: ${I.message}`),alert(F)}},z=(s||[]).filter(d=>{if(!d)return!1;const I=d.name?.toLowerCase().includes(g.toLowerCase()),F=i==="all"||i==="raw"&&!d.recipe||i==="composite"&&d.recipe||i==="expense"&&d.expenseOnly||i==="low-stock"&&d.quantity<10;return I&&F}),q=(s||[]).filter(d=>d&&!d.recipe&&!d.expenseOnly),W=(s||[]).filter(d=>d&&d.recipe),ue=(s||[]).filter(d=>d&&d.expenseOnly),It=d=>{if(!d||!d.recipe)return 0;let I=1/0;return(d.recipe||[]).forEach(F=>{if(!F)return;const K=(s||[]).find(V=>V&&V.id===F.productId);if(K&&K.quantity>0&&F.quantity>0){const V=Math.floor(K.quantity/F.quantity);I=Math.min(I,V)}}),I===1/0?0:I},Et=d=>{if(!d)return 0;if(!d.recipe)return d.cost||0;let I=0;return(d.recipe||[]).forEach(F=>{if(!F)return;const K=(s||[]).find(V=>V&&V.id===F.productId);if(K&&K.quantity>0){const V=(K.cost||0)/K.quantity;I+=V*(F.quantity||0)}}),I};return e.jsxs("div",{className:"p-6 space-y-6",children:[T&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${T.type==="success"?"bg-green-50 border border-green-200 text-green-800":T.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:T.message}),e.jsx("button",{onClick:()=>v(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(gt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:g,onChange:d=>a(d.target.value)})]}),e.jsxs("select",{value:i,onChange:d=>u(d.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>x(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:q.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:W.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:ue.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(z||[]).map(d=>{if(!d)return null;const I=Et(d),F=d.price?((d.price-I)/d.price*100).toFixed(1):0,K=It(d),V=R===d.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[d.image?e.jsx("img",{src:d.image,alt:d.name,className:"w-12 h-12 object-cover rounded-lg",onError:re=>{re.target.style.display="none",re.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:d.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[d.recipe&&e.jsx("button",{onClick:()=>c(V?null:d.id),className:"p-1 hover:bg-gray-200 rounded",children:V?e.jsx(qt,{className:"w-4 h-4"}):e.jsx(Mt,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:d.name}),d.quantity<10&&!d.recipe&&e.jsx(De,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${d.expenseOnly?"badge-warning":d.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:d.expenseOnly?"Expense":d.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",d.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",I.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${O(d.id)===0?"text-red-600":O(d.id)<10?"text-yellow-600":"text-gray-900"}`,children:[O(d.id)," ",d.unit]}),O(d.id)<10&&O(d.id)>0&&e.jsx(De,{className:"w-4 h-4 text-yellow-500"}),O(d.id)===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600",children:[_(d.id).length," active"]}),e.jsx("button",{onClick:()=>{C(d),S(!0)},className:"p-1 hover:bg-blue-50 rounded text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(ae,{className:"w-3 h-3"})})]})}),e.jsx("td",{className:"px-4 py-3",children:d.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[K," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${F>30?"text-green-600":F>15?"text-yellow-600":"text-red-600"}`,children:[F,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{Y(d),N(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>E(d.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(ie,{className:"w-4 h-4"})})]})})]},d.id),V&&d.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(d.recipe||[]).map((re,Tt)=>{if(!re)return null;const he=(s||[]).find(lt=>lt&&lt.id===re.productId);if(!he)return null;const rt=(he.cost||0)/(he.quantity||1),Lt=rt*(re.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:he.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[re.quantity||0," ",he.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[he.quantity||0," ",he.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",rt.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",Lt.toFixed(2)]})]},Tt)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",I.toFixed(2)]})]})})]})]})})})]})})})]})})}),y&&A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Add Stock for ",A.name]}),e.jsxs("form",{onSubmit:xe,className:"space-y-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:Q.quantity,onChange:d=>te({...Q,quantity:d.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:Q.expiryDate,onChange:d=>te({...Q,expiryDate:d.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:Q.batchNumber,onChange:d=>te({...Q,batchNumber:d.target.value})}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost per Unit",className:"input",value:Q.cost,onChange:d=>te({...Q,cost:d.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{S(!1),C(null),te({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:oe,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:B.name,onChange:d=>G({...B,name:d.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:d=>L(d,!0),className:"input"}),e.jsx(bt,{className:"w-5 h-5 text-gray-400"})]}),(ce||B.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:ce||B.image,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:B.price,onChange:d=>G({...B,price:d.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:B.cost,onChange:d=>G({...B,cost:d.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:B.category,onChange:d=>G({...B,category:d.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsxs("select",{className:"input",value:B.unit,onChange:d=>G({...B,unit:d.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:B.expenseOnly,onChange:d=>G({...B,expenseOnly:d.target.checked,visibleToCashier:!d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!B.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:B.visibleToCashier,onChange:d=>G({...B,visibleToCashier:d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{x(!1),me(""),G({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0})},className:"btn-secondary",children:"Cancel"})]})]})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:$.name,onChange:d=>Y({...$,name:d.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:$.image||"",onChange:d=>Y({...$,image:d.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:d=>{const I=d.target.files[0];if(I){const F=new FileReader;F.onloadend=()=>{Y({...$,image:F.result})},F.readAsDataURL(I)}}})]}),$.image&&e.jsx("img",{src:$.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:$.price||"",onChange:d=>Y({...$,price:d.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:$.cost||"",onChange:d=>Y({...$,cost:d.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:$.quantity||"",onChange:d=>Y({...$,quantity:d.target.value}),required:!0}),e.jsxs("select",{className:"input",value:$.unit||"pcs",onChange:d=>Y({...$,unit:d.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:$.category||"raw",onChange:d=>Y({...$,category:d.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:$.expenseOnly||!1,onChange:d=>Y({...$,expenseOnly:d.target.checked,visibleToCashier:!d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!$.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:$.visibleToCashier!==!1,onChange:d=>Y({...$,visibleToCashier:d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>N(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function ps(){const[t,o]=r.useState([]),[f,b]=r.useState([]),[n,s]=r.useState(!1),[l,h]=r.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});r.useEffect(()=>{m()},[]);const m=async()=>{const j=await ne.getAll();o(j),b(j.filter(N=>!N.recipe))},i=()=>{h({...l,ingredients:[...l.ingredients,{name:"",quantity:"",unit:"pcs"}]})},u=(j,N,y)=>{const S=[...l.ingredients];S[j][N]=y,h({...l,ingredients:S})},g=j=>{h({...l,ingredients:l.ingredients.filter((N,y)=>y!==j)})},a=()=>l.ingredients.reduce((j,N)=>{const y=f.find(S=>S.name.toLowerCase()===N.name.toLowerCase());if(y&&N.quantity){const S=y.cost/y.quantity;return j+S*parseFloat(N.quantity)}return j},0),P=async j=>{j.preventDefault();const N=[];for(const S of l.ingredients){if(!S.name||!S.quantity)continue;const A=f.find(C=>C.name.toLowerCase()===S.name.toLowerCase());A?N.push({productId:A.id,quantity:parseFloat(S.quantity),unit:S.unit||"pcs"}):N.push({name:S.name,quantity:parseFloat(S.quantity),unit:S.unit||"pcs"})}if(N.length===0){alert("Please add at least one ingredient");return}const y=a();try{await ne.create({name:l.name,price:parseFloat(l.price),cost:y,quantity:0,unit:"pcs",category:"composite",recipe:N,image:l.image||"",visibleToCashier:l.visibleToCashier,expenseOnly:!1}),h({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),s(!1),m(),alert("Recipe created successfully!")}catch(S){console.error("Error creating recipe:",S),alert("Failed to create recipe. Please try again.")}},x=t.filter(j=>j.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>s(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",x.length,")"]}),x.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:x.map(j=>{const N=j.recipe.reduce((S,A)=>{if(A.productId){const C=t.find(R=>R.id===A.productId);if(C){const R=C.cost/C.quantity;return S+R*A.quantity}}else if(A.name){const C=t.find(R=>R.name.toLowerCase()===A.name.toLowerCase());if(C){const R=C.cost/C.quantity;return S+R*A.quantity}}return S},0),y=((j.price-N)/j.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:j.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",j.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",N.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${y>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",y,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(ie,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:j.recipe.map((S,A)=>{let C="",R=S.unit||"pcs";if(S.productId){const c=t.find(T=>T.id===S.productId);c&&(C=c.name,R=c.unit)}else S.name&&(C=S.name,R=S.unit||"pcs");return C?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:C}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[S.quantity," ",R]})]},A):null})})]})]},j.id)})})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:l.name,onChange:j=>h({...l,name:j.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:l.price,onChange:j=>h({...l,price:j.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:l.image,onChange:j=>h({...l,image:j.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.visibleToCashier,onChange:j=>h({...l,visibleToCashier:j.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:i,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:l.ingredients.map((j,N)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:j.name,onChange:y=>u(N,"name",y.target.value),required:!0,list:`ingredients-list-${N}`}),e.jsx("datalist",{id:`ingredients-list-${N}`,children:f.map(y=>e.jsxs("option",{value:y.name,children:[y.name," (",y.quantity," ",y.unit," available)"]},y.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:j.quantity,onChange:y=>u(N,"quantity",y.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:j.unit,onChange:y=>u(N,"unit",y.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>g(N),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(ie,{className:"w-4 h-4"})})]},N))}),l.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),l.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",a().toFixed(2)]})]}),l.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(l.price)-a())/parseFloat(l.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(Bt,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{s(!1),h({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function gs(){const[t,o]=r.useState([]),[f,b]=r.useState("all");r.useEffect(()=>{n()},[]);const n=async()=>{const i=await Ee.getAll();o(i.reverse())},s=t.filter(i=>{if(f==="today")return new Date(i.createdAt).toDateString()===new Date().toDateString();if(f==="week"){const u=new Date;return u.setDate(u.getDate()-7),new Date(i.createdAt)>=u}return!0}),l=s.reduce((i,u)=>i+u.total,0),h=s.reduce((i,u)=>i+(u.cogs||0),0),m=l-h;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("select",{value:f,onChange:i=>b(i.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]})}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(Ht,{className:"w-4 h-4"}),"Export"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",l.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",h.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",m.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:s.map(i=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",i.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(i.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[i.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:i.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",i.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",i.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",i.profit?.toLocaleString()||0]})]},i.id))})]})})]})]})}function bs(){const[t,o]=r.useState([]),[f,b]=r.useState(!1),[n,s]=r.useState({description:"",amount:"",category:"general"});r.useEffect(()=>{l()},[]);const l=async()=>{const g=await He.getAll();o(g.reverse())},h=async g=>{g.preventDefault(),await He.create({...n,amount:parseFloat(n.amount)}),s({description:"",amount:"",category:"general"}),b(!1),l()},m=t.reduce((g,a)=>g+a.amount,0),i=t.filter(g=>!g.automatic),u=t.filter(g=>g.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("button",{onClick:()=>b(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",m.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",i.reduce((g,a)=>g+a.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",u.reduce((g,a)=>g+a.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.map(g=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(g.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:g.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:g.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${g.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:g.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",g.amount?.toLocaleString()]})]},g.id))})]})})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:n.description,onChange:g=>s({...n,description:g.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:n.amount,onChange:g=>s({...n,amount:g.target.value}),required:!0}),e.jsxs("select",{className:"input",value:n.category,onChange:g=>s({...n,category:g.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>b(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function fs(){const{isCashierUserManagementEnabled:t,isCashier:o}=de(),[f,b]=r.useState([]),[n,s]=r.useState(!0),[l,h]=r.useState(!1),[m,i]=r.useState(null),[u,g]=r.useState(null),[a,P]=r.useState(null),[x,j]=r.useState(0),[N,y]=r.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),[S,A]=r.useState(!1),[C,R]=r.useState(null),[c,T]=r.useState("");r.useEffect(()=>{v()},[]),r.useEffect(()=>()=>{a?.intervalId&&clearInterval(a.intervalId)},[a]);const v=async()=>{try{s(!0);const w=await Ne.getAll();b(Array.isArray(w)?w:[])}catch(w){console.error("Error loading users:",w),b([])}finally{s(!1)}},k=()=>Math.floor(1e3+Math.random()*9e3).toString(),D=async w=>{if(w.preventDefault(),console.log("Form submitted with data:",N),!N.name?.trim()||!N.email?.trim()||!N.password?.trim()){alert("Please fill in all required fields");return}if(N.password.length<6){alert("Password must be at least 6 characters long");return}try{s(!0);const L=k(),O={name:N.name.trim(),email:N.email.trim().toLowerCase(),password:N.password.trim(),pin:L};console.log("Sending user data:",O);const _=await Ne.create(O);console.log("User creation result:",_),await v();const ee=`âœ… Cashier added successfully!

ðŸ“§ Email: ${O.email}
ðŸ”‘ Password: ${O.password}
ðŸ”¢ PIN: ${L}

ðŸ’¡ LOGIN OPTIONS:
1. Email + Password: Use email and password above
2. PIN Login: Use email + ${L}

Please share these credentials securely with the new cashier.`;alert(ee),y({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),h(!1)}catch(L){console.error("Error creating cashier:",L);let O="Failed to add cashier";L.message.includes("Current user not found")?O="Authentication error. Please refresh the page and try again.":L.message.includes("email")?O="Email already exists. Please use a different email.":L.message.includes("network")||L.message.includes("fetch")?O="Network error. Please check your connection and try again.":L.message&&(O=`Failed to add cashier: ${L.message}`),alert(O)}finally{s(!1)}},H=async(w,L)=>{try{s(!0),await Ne.update(w,{permissions:L}),await v(),i(null)}catch(O){console.error("Error updating permissions:",O),alert("Failed to update permissions: "+O.message)}finally{s(!1)}},M=async(w,L)=>{try{s(!0);const O=!L,_=await fetch(`${Z}/users/${w}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({active:O})});if(!_.ok){const ee=await _.json().catch(()=>({error:"Network error"}));throw new Error(ee.error||`HTTP ${_.status}: ${_.statusText}`)}await v()}catch(O){console.error("Error updating user status:",O),alert("Failed to update user status: "+O.message)}finally{s(!1)}},ce=async(w,L)=>{try{s(!0);const O=!L,_=await fetch(`${Z}/users/${w}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({locked:O})});if(!_.ok){const ee=await _.json().catch(()=>({error:"Network error"}));throw new Error(ee.error||`HTTP ${_.status}: ${_.statusText}`)}await v()}catch(O){console.error("Error updating user lock status:",O),alert("Failed to update user lock status: "+O.message)}finally{s(!1)}},me=async w=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{s(!0),await Ne.delete(w),await v()}catch(L){console.error("Error deleting user:",L),alert("Failed to delete user: "+L.message)}finally{s(!1)}},B=w=>{R(w),T(k()),A(!0)},G=async()=>{try{s(!0),await Ne.update(C.id,{cashierPIN:c}),await v(),A(!1),R(null),T(""),alert(`âœ… PIN reset successfully!

ðŸ”¢ New PIN for ${C.name}: ${c}

Please share this PIN securely with the cashier.`)}catch(w){console.error("Error resetting PIN:",w),alert("Failed to reset PIN: "+w.message)}finally{s(!1)}},Q=w=>{g(w),P({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const L=setInterval(()=>{$(w)},3e3);P(O=>({...O,intervalId:L})),$(w)},te=()=>{a?.intervalId&&clearInterval(a.intervalId),g(null),P(null)},$=async w=>{try{const L=await Ee.getAll(),_=(Array.isArray(L)?L:[]).filter(oe=>oe.cashierId===w.id).sort((oe,xe)=>new Date(xe.createdAt)-new Date(oe.createdAt)).slice(0,10),ee={isActive:Math.random()>.3,currentCart:_.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:_.reduce((oe,xe)=>oe+xe.total,0),salesCount:_.length,lastActivity:_.length>0?new Date(_[0].createdAt).toLocaleTimeString():"No recent activity"};P(ee)}catch(L){console.error("Error loading live view data:",L)}},Y=(f||[]).filter(w=>w.role==="cashier");return n&&f.length===0?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),t()&&e.jsxs("button",{onClick:()=>h(!0),className:"btn-primary flex items-center gap-2",disabled:n,children:[e.jsx(ae,{className:"w-4 h-4"}),"Add Cashier"]})]}),o()&&!t()&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(le,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"User Management Restricted"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The admin has disabled cashier user management. You cannot add, edit, or remove users at this time."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:f.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:Y.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:f.filter(w=>w.active).length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(f||[]).map(w=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:w.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:w.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${w.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:w.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:w.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:w.role==="cashier"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:w.cashierPIN||"----"}),e.jsx("button",{onClick:()=>B(w),className:"p-1 hover:bg-yellow-50 rounded text-yellow-600",title:"Reset PIN",disabled:n,children:e.jsx(Se,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${w.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:w.active?e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(nt,{className:"w-3 h-3"}),"Inactive"]})}),w.locked&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:[e.jsx(je,{className:"w-3 h-3"}),"Locked"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>M(w.id,w.active),className:`p-2 rounded-lg transition ${w.active?"hover:bg-red-50 text-red-600":"hover:bg-green-50 text-green-600"}`,title:w.active?"Deactivate User":"Activate User",disabled:n,children:w.active?e.jsx(nt,{className:"w-4 h-4"}):e.jsx(Ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ce(w.id,w.locked||!1),className:`p-2 rounded-lg transition ${w.locked?"hover:bg-green-50 text-green-600":"hover:bg-red-50 text-red-600"}`,title:w.locked?"Unlock User":"Lock User",disabled:n,children:e.jsx(je,{className:"w-4 h-4"})})]}),w.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",w.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(Xe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Q(w),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(it,{className:"w-4 h-4"})})]}),t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>i(w),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600",title:"Edit Permissions",children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>me(w.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",title:"Delete User",disabled:n,children:e.jsx(ie,{className:"w-4 h-4"})})]})]})})]},w.id))})]}),f.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first cashier to get started"})]})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:N.name||"",onChange:w=>{console.log("Name input changed:",w.target.value),y({...N,name:w.target.value})},required:!0,disabled:n}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:N.email||"",onChange:w=>{console.log("Email input changed:",w.target.value),y({...N,email:w.target.value})},required:!0,disabled:n}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:N.password||"",onChange:w=>{console.log("Password input changed:",w.target.value),y({...N,password:w.target.value})},required:!0,minLength:6,disabled:n}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(N.permissions).map(([w,L])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:O=>y({...N,permissions:{...N.permissions,[w]:O.target.checked}}),disabled:n}),e.jsx("span",{className:"text-sm capitalize",children:w.replace(/([A-Z])/g," $1").trim()})]},w))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:n,children:n?"Adding...":"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"btn-secondary",disabled:n,children:"Cancel"})]})]})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",m.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(m.permissions||{}).map(([w,L])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:O=>i({...m,permissions:{...m.permissions,[w]:O.target.checked}}),disabled:n}),e.jsx("span",{className:"text-sm capitalize",children:w.replace(/([A-Z])/g," $1").trim()})]},w))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>H(m.id,m.permissions),className:"btn-primary flex-1",disabled:n,children:n?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>i(null),className:"btn-secondary",disabled:n,children:"Cancel"})]})]})}),u&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(it,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",u.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:te,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(Ie,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${a.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:a.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Je,{className:"w-4 h-4"}),"Last Activity: ",a.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Fe,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(a.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(a.currentCart||[]).map((w,L)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[w.name," x",w.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",w.price.toLocaleString()]})]},L)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(a.currentCart||[]).reduce((w,L)=>w+L.price*L.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:a.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",a.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",a.salesCount>0?Math.round(a.totalSalesToday/a.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})}),S&&C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Reset PIN for ",C.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate a new 4-digit PIN for this cashier. The old PIN will be invalid."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"New PIN:"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-mono text-3xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:c})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>T(k()),className:"btn-secondary flex-1",disabled:n,children:"Generate New PIN"}),e.jsx("button",{onClick:G,className:"btn-primary flex-1",disabled:n,children:n?"Updating...":"Confirm & Update"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>{A(!1),R(null),T("")},className:"btn-secondary w-full",disabled:n,children:"Cancel"})})]})})]})}function js(){const[t,o]=r.useState([]),[f,b]=r.useState("all");r.useEffect(()=>{n()},[]);const n=()=>{const m=JSON.parse(localStorage.getItem("clockRecords")||"[]");o(m.reverse())},s=f==="all"?t:t.filter(m=>m.date===new Date().toDateString()),l=s.filter(m=>m.date===new Date().toDateString()).reduce((m,i)=>m+i.duration,0)/60,h=m=>{const i=Math.floor(m/60),u=m%60;return`${i}h ${u}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(Je,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[l.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(et,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(s.filter(m=>m.date===new Date().toDateString()).map(m=>m.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(be,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:t.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${f==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>b("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${f==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-gray-500",children:"No records found"})}):s.map((m,i)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:m.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(m.clockIn).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(m.clockIn).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(m.clockOut).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:h(m.duration)})})]},i))})]})})]})]})}function ys(){const{user:t,updateUser:o}=de();ye();const[f,b]=r.useState(!1),[n,s]=r.useState(t?.plan||"ultra"),[l,h]=r.useState({}),[m,i]=r.useState(null),[u,g]=r.useState(t?.profilePicture||null),[a,P]=r.useState(!0),[x,j]=r.useState(!0);r.useEffect(()=>{N()},[]);const N=async()=>{try{const v=await Pe.get();h(v),v.logo&&i(v.logo),P(v.cashierUserManagement!==!1),j(v.realTimeProductSync!==!1)}catch(v){console.error("Failed to load settings:",v)}},y=async v=>{try{const k={...l,...v};return await Pe.update(k),h(k),!0}catch(k){return console.error("Failed to save settings:",k),!1}},S=async()=>{const v=!a;P(v),await y({cashierUserManagement:v})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{cashierUserManagement:v}})),alert(`âœ… Cashier User Management ${v?"ENABLED":"DISABLED"}`)):(P(!v),alert("âŒ Failed to save setting. Please try again."))},A=async()=>{const v=!x;j(v),await y({realTimeProductSync:v})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{realTimeProductSync:v}})),alert(`âœ… Real-time Product Sync ${v?"ENABLED":"DISABLED"}`)):(j(!v),alert("âŒ Failed to save setting. Please try again."))},C=async v=>{const k=v.target.files[0];if(k){const D=new FileReader;D.onloadend=async()=>{const H=D.result;i(H);try{await Pe.update({...l,logo:H}),h({...l,logo:H})}catch(M){console.error("Failed to save logo:",M)}},D.readAsDataURL(k)}},R=async v=>{const k=v.target.files[0];if(k){const D=new FileReader;D.onloadend=async()=>{const H=D.result;g(H);try{await o({...t,profilePicture:H})}catch(M){console.error("Failed to save profile picture:",M)}},D.readAsDataURL(k)}},c=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],T=async()=>{const v=c.find(D=>D.id===n),k=n==="ultra"?"admin":"cashier";await o({...t,role:k,plan:n,price:v.price}),b(!1),setTimeout(()=>window.location.href=k==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(et,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[u?e.jsx("img",{src:u,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:t?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(ct,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:R})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Me,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>b(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(tt,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(ge,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cashier User Management"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Cashier User Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow cashiers to add and remove users"})]}),e.jsx("button",{onClick:S,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${a?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${a?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${a?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:a?"âœ… Cashiers can add and remove users when enabled":"âŒ Cashiers cannot add or remove users when disabled"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(ft,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Real-time Product Sync"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Real-time Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync products between admin and cashier dashboards"})]}),e.jsx("button",{onClick:A,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${x?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${x?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${x?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:x?"âœ… Products will sync in real-time across all dashboards":"âŒ Products will not sync automatically across dashboards"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(je,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(zt,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[m&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:m,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:C})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:c.map(v=>e.jsxs("div",{onClick:()=>s(v.id),className:`card cursor-pointer transition-all ${n===v.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:v.name}),n===v.id&&e.jsx(Be,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",v.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:v.features.map((k,D)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Be,{className:"w-4 h-4 text-green-600"}),k]},D))})]},v.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:T,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>b(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function Ns(){const[t,o]=r.useState([]),[f,b]=r.useState(!1),[n,s]=r.useState(null),[l,h]=r.useState({name:"",amount:"",description:"",active:!0});r.useEffect(()=>{m()},[]);const m=()=>{const a=JSON.parse(localStorage.getItem("serviceFees")||"[]");o(a)},i=a=>{localStorage.setItem("serviceFees",JSON.stringify(a)),o(a)},u=a=>{if(a.preventDefault(),n){const P=t.map(x=>x.id===n.id?{...l,id:x.id}:x);i(P)}else{const P={...l,id:Date.now(),createdAt:new Date().toISOString()};i([...t,P])}b(!1),s(null),h({name:"",amount:"",description:"",active:!0})},g=a=>{confirm("Delete this service fee?")&&i(t.filter(P=>P.id!==a))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{b(!0),s(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(a=>e.jsxs("div",{className:`card ${a.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500",children:a.description})]})]}),e.jsx("span",{className:`badge ${a.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:a.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",a.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{s(a),h(a),b(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(Se,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>g(a.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(ie,{className:"w-4 h-4 text-red-600"})})]})]})]},a.id))}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:l.name,onChange:a=>h({...l,name:a.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:l.amount,onChange:a=>h({...l,amount:a.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:l.description,onChange:a=>h({...l,description:a.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.active,onChange:a=>h({...l,active:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>b(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function vs(){const[t,o]=r.useState([]),[f,b]=r.useState([]),[n,s]=r.useState(!1),[l,h]=r.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});r.useEffect(()=>{m(),i()},[]);const m=async()=>{try{const x=localStorage.getItem("token"),j=await fetch(`${Z}/reminders`,{headers:{Authorization:`Bearer ${x}`}});if(!j.ok){console.error("API Error:",j.status,j.statusText),o([]);return}const N=await j.json();Array.isArray(N)?o(N):(console.error("Expected array but got:",typeof N,N),o([]))}catch(x){console.error("Failed to fetch reminders:",x),o([])}},i=async()=>{try{const x=localStorage.getItem("token"),j=await fetch(`${Z}/products`,{headers:{Authorization:`Bearer ${x}`}});if(!j.ok){console.error("API Error:",j.status,j.statusText),b([]);return}const N=await j.json();Array.isArray(N)?b(N):(console.error("Expected array but got:",typeof N,N),b([]))}catch(x){console.error("Failed to fetch products:",x),b([])}},u=async x=>{x.preventDefault();try{const j=localStorage.getItem("token"),N=await fetch(`${Z}/reminders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify(l)});if(!N.ok){const S=await N.json();console.error("Failed to create reminder:",S),alert(`Failed to create reminder: ${S.error||"Unknown error"}`);return}const y=await N.json();h({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),s(!1),m(),alert("Reminder created successfully!")}catch(j){console.error("Failed to create reminder:",j),alert("Failed to create reminder. Please try again.")}},g=async x=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const N=localStorage.getItem("token"),y=await fetch(`${Z}/reminders/${x}`,{method:"DELETE",headers:{Authorization:`Bearer ${N}`}});if(!y.ok){const S=await y.json();console.error("Failed to delete reminder:",S),alert(`Failed to delete reminder: ${S.error||"Unknown error"}`);return}m(),alert("Reminder deleted successfully!")}catch(j){console.error("Failed to delete reminder:",j),alert("Failed to delete reminder. Please try again.")}},a=x=>{l.days.includes(x)?h({...l,days:l.days.filter(j=>j!==x)}):h({...l,days:[...l.days,x]})},P=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(tt,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("button",{onClick:()=>s(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(ae,{size:20}),"New Reminder"]})]}),e.jsx("div",{className:"grid gap-4",children:t.map(x=>{const j=f.find(N=>N.id===x.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${x.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:x.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",j?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",x.frequency]}),x.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",x.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(be,{size:16}),"Next: ",new Date(x.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${x.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:x.status}),e.jsx("button",{onClick:()=>g(x.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(ie,{size:20})})]})]})},x.id)})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:u,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:l.customerName,onChange:x=>h({...l,customerName:x.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:l.productId,onChange:x=>h({...l,productId:parseInt(x.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),f.map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:l.frequency,onChange:x=>h({...l,frequency:x.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),l.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:P.map(x=>e.jsx("button",{type:"button",onClick:()=>a(x),className:`px-4 py-2 rounded-lg font-medium transition ${l.days.includes(x)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:x},x))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:l.nextDate,onChange:x=>h({...l,nextDate:x.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>s(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})}function ws(){const[t,o]=r.useState([]),[f,b]=r.useState(!1),[n,s]=r.useState(null),[l,h]=r.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});r.useEffect(()=>{m()},[]);const m=async()=>{try{const a=await Ue.getAll();o(a)}catch(a){console.error("Failed to load discounts:",a)}},i=async a=>{a.preventDefault();try{n?await Ue.update(n.id,l):await Ue.create(l),b(!1),s(null),h({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),m()}catch(P){console.error("Failed to save discount:",P)}},u=async a=>{if(confirm("Delete this discount?"))try{await Ue.delete(a),m()}catch(P){console.error("Failed to delete discount:",P)}},g=a=>{const P=new Date,x=new Date(a.validFrom),j=new Date(a.validTo);return a.active&&x<=P&&j>=P};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{b(!0),s(null),h({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(a=>e.jsxs("div",{className:`card ${g(a)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${g(a)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(We,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[a.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${g(a)?"badge-success":"bg-gray-200 text-gray-600"}`,children:g(a)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(a.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(a.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{s(a),h(a),b(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(Se,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>u(a.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(ie,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},a.id)),t.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(We,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:l.name,onChange:a=>h({...l,name:a.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:l.percentage,onChange:a=>h({...l,percentage:parseFloat(a.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:l.validFrom,onChange:a=>h({...l,validFrom:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:l.validTo,onChange:a=>h({...l,validTo:a.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.active,onChange:a=>h({...l,active:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>b(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ss(){const[t,o]=r.useState([]),[f,b]=r.useState([]),[n,s]=r.useState("all");r.useEffect(()=>{l(),h()},[]);const l=async()=>{try{const x=await Ge.getAll();o(x)}catch(x){console.error("Failed to load credit requests:",x)}},h=async()=>{try{const x=await ne.getAll();b(x)}catch(x){console.error("Failed to load products:",x)}},m=async x=>{try{await Ge.approve(x),l()}catch(j){console.error("Failed to approve request:",j)}},i=async x=>{try{await Ge.reject(x),l()}catch(j){console.error("Failed to reject request:",j)}},u=x=>{const j=f.find(N=>N.id===x);return j?j.name:"Unknown Product"},g=t.filter(x=>n==="all"?!0:x.status===n),a=x=>{switch(x){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},P=x=>{switch(x){case"pending":return e.jsx(Je,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(we,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(ot,{className:"w-6 h-6 text-red-600"});default:return e.jsx(Me,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(x=>e.jsx("button",{onClick:()=>s(x),className:`px-4 py-2 rounded-lg font-medium transition ${n===x?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:x.charAt(0).toUpperCase()+x.slice(1)},x))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[g.map(x=>e.jsx("div",{className:`card border-l-4 ${a(x.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${x.status==="pending"?"bg-orange-600":x.status==="approved"?"bg-green-600":"bg-red-600"}`,children:P(x.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:x.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:u(x.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:x.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",x.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(x.createdAt).toLocaleString()]}),x.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(x.approvedAt).toLocaleString()]})]})]}),x.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>m(x.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(we,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>i(x.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(ot,{size:16}),"Reject"]})]}),x.status!=="pending"&&e.jsx("span",{className:`badge ${x.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:x.status.toUpperCase()})]})},x.id)),g.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(Me,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",n!=="all"?n:""," credit requests found."]})]})]})]})}function Pt({onClose:t}){const[o,f]=r.useState([]),[b,n]=r.useState(!0);r.useEffect(()=>{s()},[]);const s=async()=>{try{const h=localStorage.getItem("token"),m=await fetch(`${Z}/reminders/today`,{headers:{Authorization:`Bearer ${h}`}});if(!m.ok){console.error("API Error:",m.status,m.statusText),f([]);return}const i=await m.json();Array.isArray(i)?f(i):(console.error("Expected array but got:",typeof i,i),f([]))}catch(h){console.error("Failed to fetch reminders:",h),f([])}finally{n(!1)}},l=async h=>{try{const m=localStorage.getItem("token");await fetch(`${Z}/reminders/${h}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({status:"fulfilled"})}),s()}catch(m){console.error("Failed to update reminder:",m)}};return b?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:t,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(Ie,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Re,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):o.map(h=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:h.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",h.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:h.frequency})]}),e.jsxs("button",{onClick:()=>l(h.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(we,{size:18}),"Mark Done"]})]},h.id))})]})})}function At({onUnlock:t,userType:o="user"}){const[f,b]=r.useState(""),[n,s]=r.useState(""),[l,h]=r.useState("password"),[m,i]=r.useState(!1),[u,g]=r.useState(""),[a,P]=r.useState(!1),[x,j]=r.useState("2005"),N=JSON.parse(localStorage.getItem("user")||"{}");r.useEffect(()=>{(async()=>{try{const C=await Pe.get();C?.screenLockPassword&&j(C.screenLockPassword)}catch(C){console.warn("Failed to load settings, using default password:",C)}})()},[]),r.useEffect(()=>{const A=document.getElementById(l==="password"?"unlock-password":"unlock-pin");A&&A.focus()},[l]);const y=async A=>{A.preventDefault(),A.stopPropagation(),P(!0),g("");try{if(l==="password")if(f===x)t();else throw new Error("Incorrect password");else if(l==="pin"&&N.pin)if(n===N.pin)t();else throw new Error("Incorrect PIN");else throw new Error(`Please enter a valid ${l}`)}catch(C){g(C.message||"Unlock failed")}finally{P(!1)}},S=A=>{const C=A.replace(/\D/g,"").slice(0,4);s(C)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:A=>A.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8",onClick:A=>A.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${o==="main_admin"?"bg-gradient-to-br from-red-600 to-orange-600":"bg-gradient-to-br from-blue-600 to-purple-600"}`,children:e.jsx(le,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-gray-600",children:o==="main_admin"?"Main Admin":N.name||"User"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Enter your ",l," to continue"]})]}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[o!=="main_admin"&&N.pin&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unlock Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{h("password"),g("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${l==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ”‘ Password"}),e.jsx("button",{type:"button",onClick:()=>{h("pin"),g("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${l==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ“± PIN"})]})]}),(l==="password"||o==="main_admin")&&e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-password",type:m?"text":"password",placeholder:"Enter your password",className:"w-full pl-10 pr-12 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",value:f,onChange:A=>b(A.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>i(!m),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:m?e.jsx(jt,{className:"w-5 h-5"}):e.jsx(Xe,{className:"w-5 h-5"})})]}),l==="pin"&&o!=="main_admin"&&e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-pin",type:"text",placeholder:"Enter 4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-center text-2xl tracking-widest",value:n,onChange:A=>S(A.target.value),maxLength:4,required:!0})]}),u&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg border border-red-200",children:u}),e.jsx("button",{type:"submit",disabled:a||l==="pin"&&n.length!==4,className:`w-full py-3 rounded-lg font-bold transition-all disabled:opacity-50 disabled:cursor-not-allowed ${o==="main_admin"?"bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white":"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white"}`,children:a?"Unlocking...":"Unlock Screen"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Screen locked due to inactivity for security"})})]})})}function Dt(t=6e4){const[o,f]=r.useState(!1),[b,n]=r.useState(Date.now()),s=r.useCallback(()=>{n(Date.now()),o&&f(!1)},[o]),l=r.useCallback(()=>{f(!1),s()},[s]);return r.useEffect(()=>{const h=["mousedown","mousemove","keypress","scroll","touchstart","click"],m=()=>{s()};h.forEach(u=>{document.addEventListener(u,m,!0)});const i=setInterval(()=>{Date.now()-b>t&&!o&&f(!0)},1e3);return()=>{h.forEach(u=>{document.removeEventListener(u,m,!0)}),clearInterval(i)}},[b,t,o,s]),[o,l,s]}function ks(){const{user:t,logout:o,isCashierUserManagementEnabled:f}=de(),b=ye(),n=Ze(),[s,l]=r.useState(!0),[h,m]=r.useState(!1),[i,u]=r.useState({}),[g,a]=Dt(45e3);r.useEffect(()=>{const y=()=>{const A=localStorage.getItem("user");if(A){const C=JSON.parse(A);let R=!1;(C.plan==="ultra"||C.role==="admin")&&(C.active||(C.active=!0,R=!0),C.plan==="ultra"&&C.role!=="admin"&&(C.role="admin",R=!0),C.plan==="ultra"&&(!C.price||C.price!==1600)&&(C.price=1600,R=!0),R&&(localStorage.setItem("user",JSON.stringify(C)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};y(),setTimeout(y,100);const S=setTimeout(()=>{m(!0)},1e3);return P(),()=>clearTimeout(S)},[]);const P=async()=>{try{const y=await Pe.get();u(y)}catch(y){console.error("Failed to load settings:",y)}},x=async()=>{if(window.confirm("Are you sure you want to clear all sales and data? This action cannot be undone."))try{const y=localStorage.getItem("token");await fetch(`${Z}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})}),alert("Data cleared successfully!"),window.location.reload()}catch(y){console.error("Failed to clear data:",y),alert("Failed to clear data")}},j=[{id:"overview",label:"Dashboard",icon:Jt,path:"/admin"},{id:"sales",label:"Sales",icon:pt,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:Ae,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:yt,path:"/admin/recipes"},{id:"expenses",label:"Expenses",icon:qe,path:"/admin/expenses"},...f()?[{id:"users",label:"Users",icon:ge,path:"/admin/users"}]:[],{id:"time",label:"Time Tracking",icon:Je,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:tt,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:fe,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:We,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:Me,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:Ye,path:"/admin/settings"}],N=y=>y==="/admin"?n.pathname==="/admin":n.pathname.startsWith(y);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${s?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[s&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>l(!s),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s?e.jsx(Ie,{className:"w-5 h-5"}):e.jsx(Kt,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:j.map(y=>{const S=y.icon;return e.jsxs("button",{onClick:()=>b(y.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${N(y.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(S,{className:"w-5 h-5 flex-shrink-0"}),s&&e.jsx("span",{className:"font-medium",children:y.label})]},y.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(_t,{className:"w-5 h-5 flex-shrink-0"}),s&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:o,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(st,{className:"w-5 h-5 flex-shrink-0"}),s&&e.jsx("span",{className:"font-medium",children:"Logout"})]}),e.jsxs("button",{onClick:x,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors",children:[e.jsx(Ie,{className:"w-5 h-5 flex-shrink-0"}),s&&e.jsx("span",{className:"font-medium",children:"Clear Data"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:j.find(y=>N(y.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:t?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(ht,{children:[e.jsx(J,{path:"/",element:e.jsx(us,{})}),e.jsx(J,{path:"/sales",element:e.jsx(gs,{})}),e.jsx(J,{path:"/inventory",element:e.jsx(hs,{})}),e.jsx(J,{path:"/recipes",element:e.jsx(ps,{})}),e.jsx(J,{path:"/expenses",element:e.jsx(bs,{})}),e.jsx(J,{path:"/reminders",element:e.jsx(vs,{})}),e.jsx(J,{path:"/service-fees",element:e.jsx(Ns,{})}),e.jsx(J,{path:"/discounts",element:e.jsx(ws,{})}),e.jsx(J,{path:"/credit-requests",element:e.jsx(Ss,{})}),e.jsx(J,{path:"/users",element:e.jsx(fs,{})}),e.jsx(J,{path:"/time",element:e.jsx(js,{})}),e.jsx(J,{path:"/settings",element:e.jsx(ys,{})})]})})]}),h&&e.jsx(Pt,{onClose:()=>m(!1)}),g&&e.jsx(At,{onUnlock:a,logo:i.logo})]})}function Cs(){const t=ye(),[o,f]=r.useState(!1),[b,n]=r.useState(0),s=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 900) or Ultra (KSH 1,600) package",image:"ðŸ“",details:"First user becomes Admin automatically. Choose Ultra for full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],l=[{icon:Ae,title:"Smart Inventory",desc:"Track raw materials & composite products with automatic stock deduction"},{icon:yt,title:"Recipe Builder",desc:"Create bundled products with BOM and auto-calculate COGS"},{icon:Ce,title:"Real-time Analytics",desc:"Monitor sales, profit margins, and expenses in real-time"},{icon:ge,title:"User Management",desc:"Add cashiers with custom permissions and role-based access"},{icon:je,title:"Secure & Reliable",desc:"JWT authentication with role-based security"},{icon:Qe,title:"Advanced Reports",desc:"Daily, weekly summaries with profit/loss tracking"}],h=[{name:"Basic",price:900,icon:Nt,popular:!1,features:["Cashier Dashboard","Basic Inventory","Sales Tracking","Daily/Weekly Reports","Single User","Email Support"]},{name:"Ultra",price:1600,icon:at,popular:!0,features:["Admin + Cashier Dashboard","Full Inventory Management","Recipe/BOM Builder","Auto Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Unlimited Users","Priority Support"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/auth/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(Gt,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(Te,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>f(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(Vt,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 30-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Qe,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:l.map((m,i)=>{const u=m.icon;return e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(u,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:m.title}),e.jsx("p",{className:"text-gray-600",children:m.desc})]},i)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:h.map((m,i)=>{const u=m.icon;return e.jsxs("div",{className:`relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${m.popular?"ring-4 ring-blue-600":""}`,children:[m.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${m.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(u,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:m.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",m.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:m.features.map((g,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:g})]},a))}),e.jsx("button",{onClick:()=>t("/plans"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${m.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},i)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(Te,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{f(!1),n(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Ie,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",b+1," of ",s.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((b+1)/s.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(b+1)/s.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:s[b].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:s[b].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:s[b].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:s[b].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>n(Math.max(0,b-1)),disabled:b===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),b<s.length-1?e.jsxs("button",{onClick:()=>n(b+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(Te,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{f(!1),n(0),t("/plans")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(Te,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:s.map((m,i)=>e.jsx("button",{onClick:()=>n(i),className:`w-2 h-2 rounded-full transition-all ${i===b?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},i))})]})]})})]})}function ut(){const t=Ze(),[o,f]=r.useState(t.pathname==="/auth/login"),[b,n]=r.useState("password"),[s,l]=r.useState({email:"",password:"",pin:"",name:"",newPassword:"",confirmPassword:""}),[h,m]=r.useState(""),[i,u]=r.useState(!1),[g,a]=r.useState(!1),P=ye(),{login:x}=de(),j=()=>{try{return JSON.parse(localStorage.getItem("selectedPlan")||"null")}catch(y){return console.warn("Invalid selectedPlan in localStorage:",y),null}},N=async y=>{y.preventDefault(),m(""),u(!0);try{if(g){if(s.newPassword!==s.confirmPassword){m("Passwords do not match"),u(!1);return}if(s.newPassword.length<6){m("Password must be at least 6 characters"),u(!1);return}const c=await ve.login({email:s.email,newPassword:s.newPassword});c.token&&c.user&&(await x(c),P("/dashboard"));return}if(o){if(b==="pin"){if(!s.pin||s.pin.length!==4){m("Please enter a valid 4-digit PIN"),u(!1);return}}else if(!s.password){m("Please enter your password"),u(!1);return}}let S;if(o)if(b==="pin")try{S=await ve.pinLogin({email:s.email,pin:s.pin})}catch(c){if(c.message.includes("PIN not set"))m("PIN not set for this user. Please use password login.");else if(c.message.includes("Invalid PIN"))m("Invalid PIN. Please try again.");else throw c;u(!1);return}else S=await ve.login({email:s.email,password:s.password});else{const c=j();S=await ve.signup({...s,plan:c?.id||"basic"})}if(S.needsPasswordSetup){a(!0),l({...s,email:S.email}),m(""),u(!1);return}if(!S||!S.user||!S.token)throw new Error("Authentication failed. Please try again.");const A={id:Date.now(),type:o?"login":"signup",user:{id:S.user.id,name:S.user.name,email:S.user.email,role:S.user.role,plan:S.user.plan},timestamp:new Date().toISOString(),ip:"Unknown",userAgent:navigator.userAgent},C=JSON.parse(localStorage.getItem("authActivities")||"[]");C.unshift(A),C.splice(50),localStorage.setItem("authActivities",JSON.stringify(C)),await x(S);const R=o?"logged in":"signed up";console.log(`âœ… User ${S.user.name} ${R} successfully`),S.user.role==="admin"?P("/admin"):P("/dashboard/cashier")}catch(S){console.error("Authentication error:",S);let A=S.message||"Authentication failed. Please try again.";S.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),A="Invalid credentials. Please try again."),m(A)}finally{u(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:o?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600",children:o?"Login to your account":"Create your account"})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[g?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:s.newPassword,onChange:y=>l({...s,newPassword:y.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:s.confirmPassword,onChange:y=>l({...s,confirmPassword:y.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!o&&e.jsxs("div",{className:"relative",children:[e.jsx(et,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:s.name,onChange:y=>l({...s,name:y.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(vt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:s.email,onChange:y=>l({...s,email:y.target.value}),required:!0})]}),o&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Login Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n("password"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${b==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Password"}),e.jsx("button",{type:"button",onClick:()=>n("pin"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${b==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"pin"})]})]}),o&&b==="password"&&e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:s.password,onChange:y=>l({...s,password:y.target.value}),required:!0})]}),o&&b==="pin"&&e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:s.pin,onChange:y=>l({...s,pin:y.target.value.replace(/\D/g,"").slice(0,4)}),maxLength:4,required:!0})]}),!o&&e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:s.password,onChange:y=>l({...s,password:y.target.value}),required:!0})]})]}),h&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:h}),e.jsx("button",{type:"submit",disabled:i,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50",children:i?"Please wait...":g?"Set Password":o?"Login":"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{f(!o),m(""),a(!1)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:o?"Don't have an account? Sign up":"Already have an account? Login"})})]})})}function Ps(){const[t,o]=r.useState("ultra"),[f,b]=r.useState(!1),[n,s]=r.useState({name:"",email:"",company:""}),l=ye(),h=[{id:"basic",name:"Basic Package",price:1e3,icon:Nt,color:"from-green-500 to-teal-600",features:["Cashier Dashboard Only","Basic Inventory Management","Sales Tracking","Daily/Weekly Sales Summaries","Basic Profit/Loss View","Limited Email Notifications","Record Products Sold","Single User Access"]},{id:"ultra",name:"Ultra Package",price:2400,icon:at,color:"from-blue-600 to-purple-600",popular:!0,features:["Admin Dashboard + Cashier POS","Full Inventory Management","Recipe/BOM Builder","Composite Products Support","Automatic Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Advanced Analytics","Unlimited Users"]}],m=async i=>{i.preventDefault();try{await fetch(`${Z}/demo-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),alert("Demo request submitted! Admin will review and contact you."),b(!1),s({name:"",email:"",company:""})}catch(u){console.error("Demo request failed:",u),alert("Failed to submit demo request. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:()=>l("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition",children:[e.jsx(Wt,{size:20}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mb-8 md:mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Select the perfect plan for your business needs"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6 md:mb-8",children:h.map(i=>{const u=i.icon;return e.jsxs("div",{onClick:()=>o(i.id),className:`card cursor-pointer transition-all transform hover:scale-105 relative ${t===i.id?"ring-4 ring-blue-600 shadow-2xl bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-xl"}`,children:[i.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 md:mb-4",children:[e.jsx("div",{className:`w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br ${i.color} flex items-center justify-center`,children:e.jsx(u,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:i.name})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("span",{className:"text-3xl md:text-4xl font-bold",children:["KSH ",i.price]}),e.jsx("span",{className:"text-gray-600 text-sm md:text-base",children:"/month"})]}),e.jsx("ul",{className:"space-y-2 md:space-y-3",children:i.features.map((g,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Be,{className:"w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs md:text-sm",children:g})]},a))})]},i.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center animate-fade-in",children:[e.jsx("button",{onClick:()=>{console.log("Get Started clicked with plan:",t);const i=h.find(u=>u.id===t);console.log("Selected plan:",i),localStorage.setItem("selectedPlan",JSON.stringify(i)),l("/auth/signup")},className:"btn-primary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all",children:"Get Started"}),e.jsx("button",{onClick:()=>b(!0),className:"btn-secondary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg border-2 border-gray-300 hover:border-gray-400 transition-all",children:"Request Free Demo"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-3 md:mt-4 text-center",children:"Secure payment â€¢ Cancel anytime"}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Free Demo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"We'll contact you to schedule a demo"})]}),e.jsxs("form",{onSubmit:m,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:n.name,onChange:i=>s({...n,name:i.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:n.email,onChange:i=>s({...n,email:i.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:n.company,onChange:i=>s({...n,company:i.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition",children:"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})})}function As(){const{user:t,logout:o}=de(),[f,b]=r.useState([]),[n,s]=r.useState([]),[l,h]=r.useState([]),[m,i]=r.useState("cash"),[u,g]=r.useState("pos"),[a,P]=r.useState({sales:[],expenses:[],stats:{}}),[x,j]=r.useState(""),[N,y]=r.useState(!1),[S,A]=r.useState(!1),[C,R]=r.useState(null),[c,T]=r.useState({name:"",price:"",cost:"",category:"finished",image:""}),[v,k]=r.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[D,H]=r.useState(!1),[M,ce]=r.useState({description:"",amount:"",category:""}),[me,B]=r.useState("");r.useEffect(()=>{G()},[]),r.useEffect(()=>{const p=cs(E=>{try{if(!E)return;(E.type==="initial"||E.type==="products_snapshot"||E.type==="product_created"||E.type==="product_updated"||E.type==="product_deleted")&&ne.getAll().then(z=>b(z.filter(q=>q.visibleToCashier!==!1&&!q.expenseOnly))).catch(()=>{})}catch(z){console.error("Product subscription handler error",z)}});return()=>{try{p()}catch{}}},[]);const G=async()=>{try{const[p,E,z,q,W]=await Promise.all([ne.getAll(),Ee.getAll(),He.getAll(),St.get(),ze.getAll()]);b(p.filter(ue=>ue.visibleToCashier!==!1&&!ue.expenseOnly)),P({sales:E,expenses:z,stats:q}),s(W)}catch(p){console.error("Failed to load data:",p)}},Q=(p,E=!0)=>{const z=p.target.files[0];if(z){const q=new FileReader;q.onload=W=>{const ue=W.target.result;B(ue),E&&T({...c,image:ue})},q.readAsDataURL(z)}},te=p=>n.filter(z=>z.productId===p&&z.quantity>0).reduce((z,q)=>z+q.quantity,0),$=p=>{const E=te(p.id);if(E<=0){alert("Product is out of stock!");return}const z=l.find(W=>W.id===p.id);if((z?z.quantity:0)>=E){alert(`Only ${E} units available in stock!`);return}h(z?l.map(W=>W.id===p.id?{...W,quantity:W.quantity+1}:W):[...l,{...p,quantity:1}])},Y=(p,E)=>{f.find(q=>q.id===p);const z=te(p);h(l.map(q=>{if(q.id===p){const W=q.quantity+E;return W>z?(alert(`Only ${z} units available!`),q):{...q,quantity:Math.max(1,W)}}return q}).filter(q=>q.quantity>0))},w=p=>{h(l.filter(E=>E.id!==p))},L=l.reduce((p,E)=>p+E.price*E.quantity,0),O=async()=>{if(l.length!==0)try{await Ee.create({items:l.map(p=>({productId:p.id,quantity:p.quantity,price:p.price})),total:L,paymentMethod:m}),h([]),await G(),alert("Sale completed successfully!")}catch(p){console.error("Checkout failed:",p),alert("Sale failed. Please try again.")}},_=async p=>{p.preventDefault();try{await ne.create({...c,price:parseFloat(c.price),cost:parseFloat(c.cost||0),quantity:0}),T({name:"",price:"",cost:"",category:"finished",image:""}),B(""),y(!1),await G(),alert("Product added successfully!")}catch(E){console.error("Failed to add product:",E),alert("Failed to add product")}},ee=async p=>{p.preventDefault();try{await ze.create({productId:C.id,quantity:parseInt(v.quantity),expiryDate:v.expiryDate,batchNumber:v.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(v.cost||C.cost||0)}),k({quantity:"",expiryDate:"",batchNumber:"",cost:""}),A(!1),R(null),await G(),alert("Stock added successfully!")}catch(E){console.error("Failed to add stock:",E),alert("Failed to add stock")}},oe=async p=>{p.preventDefault();try{await He.create({...M,amount:parseFloat(M.amount)}),ce({description:"",amount:"",category:""}),H(!1),await G()}catch(E){console.error("Failed to add expense:",E),alert("Failed to add expense")}},xe=async()=>{if(window.confirm("Are you sure you want to clear all sales and data? This action cannot be undone."))try{const p=localStorage.getItem("token");await fetch(`${Z}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})}).catch(()=>{}),P({sales:[],expenses:[],stats:{totalSales:0,totalExpenses:0,profit:0}}),h([]),alert("Data cleared successfully!"),await G()}catch(p){console.error("Failed to clear data:",p),alert("Failed to clear data")}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Cashier Dashboard"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cashier Plan - KSH 900/month"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsxs("button",{onClick:o,className:"btn-secondary flex items-center gap-2 hover:bg-red-50 hover:text-red-600 hover:border-red-200",children:[e.jsx(st,{className:"w-4 h-4"}),"Logout"]}),e.jsxs("button",{onClick:xe,className:"btn-secondary flex items-center gap-2 hover:bg-orange-50 hover:text-orange-600 hover:border-orange-200",children:[e.jsx(ie,{className:"w-4 h-4"}),"Clear Data"]})]})]})}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>g("pos"),className:`px-6 py-2 rounded-lg font-medium transition-all ${u==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Fe,{className:"w-4 h-4 inline mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>g("monitor"),className:`px-6 py-2 rounded-lg font-medium transition-all ${u==="monitor"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Qe,{className:"w-4 h-4 inline mr-2"}),"Monitor"]}),e.jsxs("button",{onClick:()=>g("products"),className:`px-6 py-2 rounded-lg font-medium transition-all ${u==="products"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ae,{className:"w-4 h-4 inline mr-2"}),"Products"]}),e.jsxs("button",{onClick:()=>g("expenses"),className:`px-6 py-2 rounded-lg font-medium transition-all ${u==="expenses"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(qe,{className:"w-4 h-4 inline mr-2"}),"Expenses"]})]}),u==="pos"&&e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(gt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:x,onChange:p=>j(p.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:f.filter(p=>p.name?.toLowerCase().includes(x.toLowerCase())).map(p=>{const E=te(p.id),z=E<10,q=E<=0;return e.jsxs("button",{onClick:()=>$(p),disabled:q,className:`card text-left hover:shadow-xl transition-all transform hover:scale-105 relative ${q?"opacity-50 cursor-not-allowed bg-gray-100":"bg-gradient-to-br from-white to-gray-50"}`,children:[p.image&&e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:p.image,alt:p.name,className:"w-full h-full object-cover"})}),z&&!q&&e.jsx("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white p-1 rounded-full",children:e.jsx(De,{className:"w-4 h-4"})}),q&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"OUT"}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-900",children:p.name}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["KSH ",p.price?.toLocaleString()]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:`text-xs font-medium ${q?"text-red-600":z?"text-yellow-600":"text-gray-500"}`,children:["Stock: ",E]}),z&&!q&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium",children:"Low Stock"})]})]},p.id)})})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-gray-200 p-6 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(Fe,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[l.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:l.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(Fe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:l.map(p=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:p.name}),e.jsx("button",{onClick:()=>w(p.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(ie,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Y(p.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(Yt,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-semibold",children:p.quantity}),e.jsx("button",{onClick:()=>Y(p.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(p.price*p.quantity).toLocaleString()]})]})]},p.id))})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between text-xl font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",L.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:m,onChange:p=>i(p.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:O,disabled:l.length===0,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg",children:"Complete Sale"})]})]})]}),u==="monitor"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",a.stats.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(fe,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",a.stats.totalExpenses?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(qe,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",a.stats.profit?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(fe,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Sales"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"})]})}),e.jsx("tbody",{children:a.sales.slice(-15).reverse().map((p,E)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(p.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[p.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:p.paymentMethod||"cash"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",p.total?.toLocaleString()]})]},E))})]})})]})]}),u==="products"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Manage Products & Stock"}),e.jsxs("button",{onClick:()=>y(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700",children:[e.jsx(ae,{className:"w-4 h-4"}),"Add Product"]})]}),N&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl border-2 border-green-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Product"}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:c.name,onChange:p=>T({...c,name:p.target.value}),required:!0}),e.jsxs("select",{className:"input",value:c.category,onChange:p=>T({...c,category:p.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsx("input",{type:"number",placeholder:"Selling Price",className:"input",value:c.price,onChange:p=>T({...c,price:p.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Cost Price (Optional)",className:"input",value:c.cost,onChange:p=>T({...c,cost:p.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:p=>Q(p,!0),className:"input"}),e.jsx(bt,{className:"w-5 h-5 text-gray-400"})]}),me&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:me,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{y(!1),B(""),T({name:"",price:"",cost:"",category:"finished",image:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),S&&C&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"font-semibold mb-4 text-lg",children:["Add Stock for ",C.name]}),e.jsxs("form",{onSubmit:ee,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:v.quantity,onChange:p=>k({...v,quantity:p.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:v.expiryDate,onChange:p=>k({...v,expiryDate:p.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:v.batchNumber,onChange:p=>k({...v,batchNumber:p.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per Unit",className:"input",value:v.cost,onChange:p=>k({...v,cost:p.target.value})}),e.jsxs("div",{className:"flex gap-2 md:col-span-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{A(!1),R(null),k({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:f.map(p=>{const E=te(p.id),z=n.filter(W=>W.productId===p.id&&W.quantity>0),q=E<10;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[p.image&&e.jsx("img",{src:p.image,alt:p.name,className:"w-10 h-10 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:p.name}),e.jsx("div",{className:"text-xs text-gray-500",children:p.category})]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",p.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium ${E===0?"text-red-600":q?"text-yellow-600":"text-gray-900"}`,children:E}),q&&E>0&&e.jsx(De,{className:"w-4 h-4 text-yellow-500"}),E===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"text-gray-600",children:[z.length," active"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{R(p),A(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-green-50 rounded-lg text-green-600 transition-colors",title:"Edit Product",children:e.jsx(Se,{className:"w-4 h-4"})})]})})]},p.id)})})]})})]})}),u==="expenses"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Track Expenses"}),e.jsxs("button",{onClick:()=>H(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700",children:[e.jsx(ae,{className:"w-4 h-4"}),"Add Expense"]})]}),D&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border-2 border-red-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Expense"}),e.jsxs("form",{onSubmit:oe,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:M.description,onChange:p=>ce({...M,description:p.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Amount",className:"input",value:M.amount,onChange:p=>ce({...M,amount:p.target.value}),required:!0}),e.jsx("input",{type:"text",placeholder:"Category",className:"input",value:M.category,onChange:p=>ce({...M,category:p.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>H(!1),className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:a.expenses.slice().reverse().map((p,E)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(p.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:p.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:p.category||"General"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",p.amount?.toLocaleString()]})]},E))})]})})]})})]})}function Ds(){const[t,o]=r.useState({email:"",password:""}),[f,b]=r.useState(!1),[n,s]=r.useState(""),[l,h]=r.useState(!1),m=ye();Ze(),r.useEffect(()=>{const u=localStorage.getItem("ownerToken"),g=localStorage.getItem("ownerUser");if(u&&g)try{const a=JSON.parse(g);if(a.type==="main_admin"||a.type==="owner"){m("/main.admin/dashboard");return}}catch{localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser")}},[m]);const i=async u=>{u.preventDefault(),b(!0),s("");try{const g=await pe.login(t);if(g.token&&g.user&&(g.user.type==="main_admin"||g.user.type==="owner"))localStorage.setItem("ownerToken",g.token),localStorage.setItem("ownerUser",JSON.stringify(g.user)),m("/main.admin/dashboard");else throw new Error("Invalid response from server")}catch(g){console.error("Owner login error:",g),s(g.message||"Access denied. Owner access only.")}finally{b(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-black/50 backdrop-blur-lg rounded-2xl shadow-2xl max-w-md w-full p-8 border border-red-500/30",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-red-600 to-black rounded-2xl mx-auto mb-4 flex items-center justify-center border border-red-500/50",children:e.jsx(je,{className:"w-8 h-8 text-red-400"})}),e.jsx("h1",{className:"text-3xl font-bold text-red-400 mb-2",children:"MAIN.ADMIN"}),e.jsx("p",{className:"text-gray-400",children:"System Owner Access"}),e.jsx("div",{className:"mt-2 text-xs text-red-500 bg-red-500/10 px-3 py-1 rounded border border-red-500/30",children:"ðŸ”’ ianmabruk3@gmail.com only"})]}),e.jsxs("form",{onSubmit:i,className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(vt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),e.jsx("input",{type:"email",placeholder:"Owner Email",className:"w-full pl-10 pr-4 py-3 bg-black/30 border border-red-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",value:t.email,onChange:u=>o({...t,email:u.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),e.jsx("input",{type:l?"text":"password",placeholder:"Owner Password",className:"w-full pl-10 pr-12 py-3 bg-black/30 border border-red-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",value:t.password,onChange:u=>o({...t,password:u.target.value}),required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-400",children:l?e.jsx(jt,{className:"w-5 h-5"}):e.jsx(Xe,{className:"w-5 h-5"})})]}),n&&e.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm bg-red-500/10 p-3 rounded-lg border border-red-500/30",children:[e.jsx(Re,{className:"w-4 h-4"}),n]}),e.jsx("button",{type:"submit",disabled:f,className:"w-full bg-gradient-to-r from-red-600 to-red-800 text-white py-3 rounded-lg font-bold hover:from-red-700 hover:to-red-900 transition-all disabled:opacity-50 disabled:cursor-not-allowed border border-red-500/50",children:f?"Authenticating...":"ACCESS SYSTEM"})]}),e.jsx("div",{className:"mt-8 p-4 bg-red-500/10 border border-red-500/30 rounded-lg",children:e.jsx("p",{className:"text-red-300 text-xs text-center",children:"âš ï¸ Restricted to system owner only"})})]})})}function Is(){const[t,o]=r.useState([]),[f,b]=r.useState([]),[n,s]=r.useState({}),[l,h]=r.useState(!0),[m,i]=r.useState("overview"),[u,g]=r.useState(null),[a,P]=r.useState(null),[x,j]=r.useState(!1),N=ye();r.useEffect(()=>{const c=localStorage.getItem("ownerToken"),T=localStorage.getItem("ownerUser");if(!c||!T){N("/main.admin");return}try{const v=JSON.parse(T);if(v.type!=="main_admin"&&v.type!=="owner"||v.email!=="ianmabruk3@gmail.com"){N("/main.admin");return}}catch{N("/main.admin");return}y()},[N]);const y=async()=>{try{h(!0);const[c,T,v]=await Promise.all([pe.getUsers(),pe.getStats(),pe.getActivities()]);o(c),s(T),b(v)}catch(c){console.error("Failed to load data:",c)}finally{h(!1)}},S=async(c,T)=>{try{g(`lock-${c}`);const v=!T;await pe.lockUser(c,v),o(t.map(k=>k.id===c?{...k,locked:v,active:!v}:k)),setTimeout(y,1e3)}catch(v){console.error("Failed to toggle lock:",v),alert("Failed to update user status")}finally{g(null)}},A=async(c,T)=>{try{g(`plan-${c}`),await pe.changePlan(c,T),o(t.map(v=>v.id===c?{...v,plan:T,price:T==="ultra"?2400:T==="basic"?1e3:0}:v)),j(!1),P(null),setTimeout(y,1e3)}catch(v){console.error("Failed to change plan:",v),alert("Failed to change user plan")}finally{g(null)}},C=async c=>{const T=c==="all"?"Are you sure you want to clear ALL system data? This will remove all sales, expenses, and products from ALL users. This cannot be undone.":`Are you sure you want to clear ${c} data from ALL users? This cannot be undone.`;if(confirm(T))try{g(`clear-${c}`),await pe.clearData(c),alert(`${c.charAt(0).toUpperCase()+c.slice(1)} data cleared successfully`),y()}catch(v){console.error("Clear data failed:",v),alert("Failed to clear data")}finally{g(null)}},R=()=>{localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser"),N("/main.admin")};return l?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-red-400 text-xl",children:"Loading System Control..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black",children:[e.jsx("header",{className:"bg-black/50 backdrop-blur-lg border-b border-red-500/30 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(je,{className:"w-8 h-8 text-red-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-red-400",children:"MAIN.ADMIN"}),e.jsx("p",{className:"text-gray-400",children:"Ian Mabruk - System Owner"})]})]}),e.jsxs("button",{onClick:R,className:"flex items-center gap-2 bg-red-600/20 hover:bg-red-600/30 text-red-300 px-4 py-2 rounded-lg transition-colors border border-red-500/30",children:[e.jsx(st,{className:"w-4 h-4"}),"Logout"]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ge,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:n.totalUsers||0})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Users"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(we,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:n.activeUsers||0})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Active Users"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(be,{className:"w-8 h-8 text-yellow-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:n.trialUsers||0})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Free Trials"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(fe,{className:"w-8 h-8 text-green-400"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:["KSH ",(n.mrr||0).toLocaleString()]})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Monthly Revenue"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ke,{className:"w-8 h-8 text-purple-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:(n.totalSignups||0)+(n.totalLogins||0)})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Activities"})]})]}),e.jsx("div",{className:"flex gap-4 mb-6 overflow-x-auto",children:[{id:"overview",label:"Overview",icon:Ce},{id:"users",label:`Users (${t.length})`,icon:ge},{id:"activities",label:`Activities (${f.length})`,icon:Ke},{id:"system",label:"System Control",icon:Ye}].map(c=>{const T=c.icon;return e.jsxs("button",{onClick:()=>i(c.id),className:`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all whitespace-nowrap ${m===c.id?"bg-red-600 text-white":"bg-black/30 text-gray-300 hover:bg-black/50"}`,children:[e.jsx(T,{className:"w-4 h-4"}),c.label]},c.id)})}),m==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Plan Distribution"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-300 font-semibold",children:"Free Trial"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:n.planDistribution?.trial||0})]}),e.jsx(be,{className:"w-8 h-8 text-yellow-400"})]})}),e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-300 font-semibold",children:"Basic Plan"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:n.planDistribution?.basic||0})]}),e.jsx(Ve,{className:"w-8 h-8 text-blue-400"})]})}),e.jsx("div",{className:"bg-purple-500/10 border border-purple-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-300 font-semibold",children:"Ultra Plan"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:n.planDistribution?.ultra||0})]}),e.jsx(at,{className:"w-8 h-8 text-purple-400"})]})})]})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Recent Activity Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"User Activity"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Signups:"}),e.jsx("span",{className:"text-green-400",children:n.totalSignups||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Logins:"}),e.jsx("span",{className:"text-blue-400",children:n.totalLogins||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Recent Signups (7d):"}),e.jsx("span",{className:"text-yellow-400",children:n.recentSignups||0})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"System Health"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Active Users:"}),e.jsx("span",{className:"text-green-400",children:n.activeUsers||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Locked Users:"}),e.jsx("span",{className:"text-red-400",children:n.lockedUsers||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Revenue:"}),e.jsxs("span",{className:"text-green-400",children:["KSH ",(n.totalRevenue||0).toLocaleString()]})]})]})]})]})]})]}),m==="users"&&e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl border border-red-500/30 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"User Management"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Manage all system users, plans, and access control"})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User Details"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan & Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Trial Info"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Account Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Actions"})]})}),e.jsx("tbody",{children:t.map(c=>{const T=c.isFreeTrial,v=c.createdAt?new Date(c.createdAt).toLocaleDateString():"Unknown";return e.jsxs("tr",{className:"border-t border-red-500/20 hover:bg-black/20 transition",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:c.name}),e.jsx("p",{className:"text-sm text-gray-400",children:c.email}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",c.id," | Role: ",c.role]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Created: ",v]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-1",children:[T?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-yellow-500/20 text-yellow-300 flex items-center gap-1 w-fit",children:[e.jsx(be,{className:"w-3 h-3"}),"FREE TRIAL"]}):e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${c.plan==="ultra"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"}`,children:c.plan?.toUpperCase()}),c.price&&e.jsxs("p",{className:"text-xs text-gray-400",children:["KSH ",c.price,"/month"]})]})}),e.jsx("td",{className:"px-4 py-4",children:T?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("span",{className:"px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-300",children:[c.trialDaysLeft||0," days left"]}),c.trialDaysLeft<=7&&e.jsx("p",{className:"text-xs text-red-400",children:"âš ï¸ Expiring soon"})]}):e.jsx("span",{className:"text-xs text-gray-500",children:"Paid Plan"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-1",children:[c.locked?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-300 flex items-center gap-1 w-fit",children:[e.jsx(le,{className:"w-3 h-3"}),"Locked"]}):c.active?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-300 flex items-center gap-1 w-fit",children:[e.jsx(we,{className:"w-3 h-3"}),"Active"]}):e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-500/20 text-gray-300 w-fit",children:"Inactive"}),c.pin&&e.jsx("p",{className:"text-xs text-blue-400",children:"PIN Set"})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>S(c.id,c.locked),disabled:u===`lock-${c.id}`,className:`p-2 rounded-lg transition ${c.locked?"bg-green-500/20 hover:bg-green-500/30 text-green-300":"bg-red-500/20 hover:bg-red-500/30 text-red-300"} ${u===`lock-${c.id}`?"opacity-50 cursor-not-allowed":""}`,title:c.locked?"Unlock User":"Lock User",children:u===`lock-${c.id}`?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):c.locked?e.jsx(Qt,{className:"w-4 h-4"}):e.jsx(le,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{P(c),j(!0)},disabled:u===`plan-${c.id}`,className:"p-2 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 transition",title:"Change Plan",children:u===`plan-${c.id}`?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(Zt,{className:"w-4 h-4"})})]})})]},c.id)})})]}),t.length===0&&e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx(ge,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No users registered yet"})]})]})]}),m==="activities"&&e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl border border-red-500/30 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"System Activity Log"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"All user activities and admin actions"})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Activity Type"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User Details"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan/Action"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Time"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"IP Address"})]})}),e.jsx("tbody",{children:f.slice(0,100).map(c=>{const T=c.timestamp?new Date(c.timestamp).toLocaleString():"Unknown",v=c.type==="signup",k=c.type==="admin_action";return e.jsxs("tr",{className:"border-t border-red-500/20 hover:bg-black/20 transition",children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${v?"bg-green-500/20 text-green-300":k?"bg-red-500/20 text-red-300":"bg-blue-500/20 text-blue-300"}`,children:v?"SIGNUP":k?"ADMIN":"LOGIN"}),k&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:c.action})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:c.name||c.targetUserEmail}),e.jsx("p",{className:"text-sm text-gray-400",children:c.email||c.targetUserEmail}),k&&e.jsxs("p",{className:"text-xs text-red-400",children:["By: ",c.adminEmail]})]})}),e.jsx("td",{className:"px-4 py-4",children:k?e.jsxs("div",{className:"text-xs",children:[c.oldPlan&&c.newPlan&&e.jsxs("span",{className:"text-yellow-400",children:[c.oldPlan," â†’ ",c.newPlan]}),c.action==="user_locked"&&e.jsx("span",{className:"text-red-400",children:"User Locked"}),c.action==="user_unlocked"&&e.jsx("span",{className:"text-green-400",children:"User Unlocked"})]}):e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${c.plan==="ultra"?"bg-purple-500/20 text-purple-300":c.plan==="basic"?"bg-blue-500/20 text-blue-300":"bg-yellow-500/20 text-yellow-300"}`,children:c.plan?.toUpperCase()||"TRIAL"})}),e.jsx("td",{className:"px-4 py-4 text-gray-300 text-sm",children:T}),e.jsx("td",{className:"px-4 py-4 text-gray-400 text-sm",children:c.ipAddress||"Unknown"})]},c.id)})})]}),f.length===0&&e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx(Ke,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No activity recorded yet"})]})]})]}),m==="system"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(Xt,{className:"w-6 h-6"}),"System Data Management"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("button",{onClick:()=>C("sales"),disabled:u==="clear-sales",className:"p-4 bg-orange-500/20 hover:bg-orange-500/30 border border-orange-500/30 rounded-lg text-orange-300 transition-colors disabled:opacity-50",children:[u==="clear-sales"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(ie,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear Sales"}),e.jsx("p",{className:"text-xs opacity-75",children:"All user sales data"})]}),e.jsxs("button",{onClick:()=>C("expenses"),disabled:u==="clear-expenses",className:"p-4 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded-lg text-red-300 transition-colors disabled:opacity-50",children:[u==="clear-expenses"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(fe,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear Expenses"}),e.jsx("p",{className:"text-xs opacity-75",children:"All user expense data"})]}),e.jsxs("button",{onClick:()=>C("products"),disabled:u==="clear-products",className:"p-4 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-500/30 rounded-lg text-blue-300 transition-colors disabled:opacity-50",children:[u==="clear-products"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(ft,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear Inventory"}),e.jsx("p",{className:"text-xs opacity-75",children:"All products & batches"})]}),e.jsxs("button",{onClick:()=>C("all"),disabled:u==="clear-all",className:"p-4 bg-red-600/20 hover:bg-red-600/30 border border-red-600/30 rounded-lg text-red-300 transition-colors disabled:opacity-50",children:[u==="clear-all"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(De,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear All Data"}),e.jsx("p",{className:"text-xs opacity-75",children:"âš ï¸ Everything except users"})]})]})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(Ye,{className:"w-6 h-6"}),"System Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"User Statistics"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Users:"}),e.jsx("span",{className:"text-white",children:t.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Active Users:"}),e.jsx("span",{className:"text-green-400",children:t.filter(c=>c.active&&!c.locked).length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Locked Users:"}),e.jsx("span",{className:"text-red-400",children:t.filter(c=>c.locked).length})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"Plan Distribution"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Basic Plans:"}),e.jsx("span",{className:"text-blue-400",children:t.filter(c=>c.plan==="basic").length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Ultra Plans:"}),e.jsx("span",{className:"text-purple-400",children:t.filter(c=>c.plan==="ultra").length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Free Trials:"}),e.jsx("span",{className:"text-yellow-400",children:t.filter(c=>!c.plan||c.plan==="trial").length})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"Revenue"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Monthly Revenue:"}),e.jsxs("span",{className:"text-green-400",children:["KSH ",(n.mrr||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Revenue:"}),e.jsxs("span",{className:"text-green-400",children:["KSH ",(n.totalRevenue||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Activities:"}),e.jsx("span",{className:"text-blue-400",children:f.length})]})]})]})]})]})]})]}),x&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-black/80 backdrop-blur-lg rounded-xl p-6 border border-red-500/30 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Change User Plan"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-gray-300",children:["User: ",e.jsx("span",{className:"text-white font-semibold",children:a.name})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:a.email}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Current Plan: ",e.jsx("span",{className:"text-yellow-400",children:a.plan||"trial"})]})]}),e.jsx("div",{className:"space-y-3 mb-6",children:["trial","basic","ultra"].map(c=>e.jsx("button",{onClick:()=>A(a.id,c),disabled:u===`plan-${a.id}`||a.plan===c,className:`w-full p-3 rounded-lg border transition ${a.plan===c?"bg-gray-500/20 border-gray-500/30 text-gray-400 cursor-not-allowed":c==="trial"?"bg-yellow-500/20 border-yellow-500/30 text-yellow-300 hover:bg-yellow-500/30":c==="basic"?"bg-blue-500/20 border-blue-500/30 text-blue-300 hover:bg-blue-500/30":"bg-purple-500/20 border-purple-500/30 text-purple-300 hover:bg-purple-500/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-semibold",children:[c.charAt(0).toUpperCase()+c.slice(1)," Plan"]}),e.jsx("p",{className:"text-xs opacity-75",children:c==="trial"?"Free - 30 days":c==="basic"?"KSH 1,000/month":"KSH 2,400/month"})]}),a.plan===c&&e.jsx(we,{className:"w-5 h-5"})]})},c))}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>{j(!1),P(null)},className:"flex-1 px-4 py-2 bg-gray-500/20 border border-gray-500/30 text-gray-300 rounded-lg hover:bg-gray-500/30 transition",children:"Cancel"})})]})})]})}function Oe({children:t,adminOnly:o=!1,ultraOnly:f=!1,ownerOnly:b=!1}){const{user:n,loading:s}=de(),[l,h]=r.useState(!1),m=Dt(6e4),i=m?.[0]||!1,u=m?.[1]||(()=>{}),[g,a]=r.useState({});if(r.useEffect(()=>{n&&!b&&((async()=>{try{const j=localStorage.getItem("token"),y=await fetch(`${Z}/settings`,{headers:{Authorization:`Bearer ${j}`}});if(y.ok){const S=await y.json();a(S)}}catch(j){console.error("Failed to load settings:",j)}})(),h(!0))},[n,b]),s&&!b)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(b){const x=localStorage.getItem("ownerToken"),j=localStorage.getItem("ownerUser");if(!x||!j)return e.jsx(X,{to:"/main.admin"});try{if(JSON.parse(j).type!=="main_admin")return e.jsx(X,{to:"/main.admin"})}catch{return e.jsx(X,{to:"/main.admin"})}}else{if(!n)return e.jsx(X,{to:"/auth/login"});if(!n.active)return e.jsx(X,{to:"/plans"});if(o&&n.role!=="admin")return e.jsx(X,{to:"/dashboard"});if(f&&(n.role!=="admin"||n.plan!=="ultra"))return e.jsx(X,{to:"/dashboard"})}const P=b?"owner":"user";return e.jsxs(e.Fragment,{children:[i&&e.jsx(At,{onUnlock:u,userType:P}),l&&e.jsx(Pt,{onClose:()=>h(!1)}),t]})}function Es(){const{user:t}=de();return!t||!t.active?e.jsx(X,{to:"/plans"}):t.plan==="ultra"&&t.role==="admin"?e.jsx(X,{to:"/admin"}):e.jsx(X,{to:"/dashboard/cashier"})}function Ts(){return e.jsx(os,{children:e.jsx(xs,{children:e.jsx($t,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(ht,{children:[e.jsx(J,{path:"/",element:e.jsx(Cs,{})}),e.jsx(J,{path:"/auth/login",element:e.jsx(ut,{})}),e.jsx(J,{path:"/auth/signup",element:e.jsx(ut,{})}),e.jsx(J,{path:"/plans",element:e.jsx(Ps,{})}),e.jsx(J,{path:"/main.admin",element:e.jsx(Ds,{})}),e.jsx(J,{path:"/main.admin/dashboard",element:e.jsx(Oe,{ownerOnly:!0,children:e.jsx(Is,{})})}),e.jsx(J,{path:"/dashboard",element:e.jsx(Oe,{children:e.jsx(Es,{})})}),e.jsx(J,{path:"/dashboard/cashier",element:e.jsx(Oe,{children:e.jsx(As,{})})}),e.jsx(J,{path:"/admin/*",element:e.jsx(Oe,{adminOnly:!0,children:e.jsx(ks,{})})}),e.jsx(J,{path:"/login",element:e.jsx(X,{to:"/auth/login"})}),e.jsx(J,{path:"/signup",element:e.jsx(X,{to:"/auth/signup"})}),e.jsx(J,{path:"/subscription",element:e.jsx(X,{to:"/plans"})}),e.jsx(J,{path:"/payment",element:e.jsx(X,{to:"/plans"})}),e.jsx(J,{path:"/cashier",element:e.jsx(X,{to:"/dashboard/cashier"})})]})})})})}rs.createRoot(document.getElementById("root")).render(e.jsx(Rt.StrictMode,{children:e.jsx(Ts,{})}));
