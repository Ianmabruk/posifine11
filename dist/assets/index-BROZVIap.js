import{a as bs,b as ys,g as js,r as s,u as Je,c as zt,R as Ht,d as Z,B as Ns,N as oe,e as vs}from"./vendor-Ct1st1Nj.js";import{C as Ze,D as ze,T as Qe,P as Oe,S as Jt,a as xt,b as yt,c as pe,d as ws,e as Ss,f as Xe,g as Ue,h as ye,i as Wt,j as ks,k as Kt,l as Cs,L as he,U as Lt,m as Ot,n as ut,E as Vt,M as Ut,o as He,X as Ce,p as tt,q as it,r as Pt,s as ht,t as Ft,u as Le,B as At,R as Ps,I as As,v as pt,w as kt,x as _e,y as ot,z as gt,A as Is,F as Ds,G as Ts,H as Gt,J as Es,K as $s,N as Ls,O as Os,Q as It,V as Us,W as lt,Y as Qt,Z as Ct,_ as Yt,$ as Zt,a0 as Fs,a1 as Rs,a2 as qs,a3 as Ms,a4 as Bs}from"./icons-BVA-JfoF.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))j(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&j(o)}).observe(document,{childList:!0,subtree:!0});function p(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function j(l){if(l.ep)return;l.ep=!0;const r=p(l);fetch(l.href,r)}})();var vt={exports:{}},Ve={};var Rt;function _s(){if(Rt)return Ve;Rt=1;var t=bs(),i=Symbol.for("react.element"),p=Symbol.for("react.fragment"),j=Object.prototype.hasOwnProperty,l=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function o(c,g,m){var f,w={},a=null,I=null;m!==void 0&&(a=""+m),g.key!==void 0&&(a=""+g.key),g.ref!==void 0&&(I=g.ref);for(f in g)j.call(g,f)&&!r.hasOwnProperty(f)&&(w[f]=g[f]);if(c&&c.defaultProps)for(f in g=c.defaultProps,g)w[f]===void 0&&(w[f]=g[f]);return{$$typeof:i,type:c,key:a,ref:I,props:w,_owner:l.current}}return Ve.Fragment=p,Ve.jsx=o,Ve.jsxs=o,Ve}var qt;function zs(){return qt||(qt=1,vt.exports=_s()),vt.exports}var e=zs(),nt={},Mt;function Hs(){if(Mt)return nt;Mt=1;var t=ys();return nt.createRoot=t.createRoot,nt.hydrateRoot=t.hydrateRoot,nt}var Js=Hs();const Ws=js(Js),Ks=()=>"https://posifine22.onrender.com/api",ee=Ks(),Xt=()=>localStorage.getItem("token"),es=async(t,i={},p=0,j=3)=>{const l=Xt(),r=t.startsWith("/")?t:`/${t}`,o={...i,headers:{"Content-Type":"application/json",...l&&!(r.startsWith("/auth")&&r!=="/auth/me")&&!r.includes("/main-admin/auth/login")&&{Authorization:`Bearer ${l}`},...i.headers}};try{const c=await fetch(`${ee}${r}`,o);if(c.status===401){if(r.includes("/auth/login")||r.includes("/main-admin/auth/login")){const w=await c.json().catch(()=>({error:"Unauthorized"}));throw new Error(w.error||"Invalid credentials")}localStorage.removeItem("token"),localStorage.removeItem("user");const m=window.location.pathname||"";if(!m.includes("/login")&&!m.includes("/signup")&&!m.includes("/auth")&&!m.includes("/main.admin"))try{window.location.href="/login"}catch{}const f=new Error("Unauthorized");throw f.status=401,f}if(c.status===500)throw new Error("Server error 500 - Backend unavailable");if(c.ok)return c.status===204?{success:!0}:await c.json();const g=await c.json().catch(()=>({error:"Network error"}));throw new Error(g.error||`HTTP ${c.status}: ${c.statusText}`)}catch(c){if(c.name==="TypeError"&&c.message.includes("fetch")){if(console.error(`API Fetch Error (attempt ${p+1}/${j+1}):`,c),console.error("Attempted URL:",`${ee}${r}`),p<j){const g=Math.min(1e3*Math.pow(2,p),1e4);return console.log(`Retrying in ${g}ms...`),await new Promise(m=>setTimeout(m,g)),es(t,i,p+1,j)}throw new Error("Cannot connect to server. The server may be waking up. Please try again in a moment.")}throw c}},$=(t,i={})=>es(t,i,0,3),Be={login:t=>$("/auth/login",{method:"POST",body:JSON.stringify(t)}),pinLogin:t=>$("/auth/pin-login",{method:"POST",body:JSON.stringify(t)}),signup:t=>$("/auth/signup",{method:"POST",body:JSON.stringify(t)}),signupWithPayment:t=>$("/signup-with-payment",{method:"POST",body:JSON.stringify(t)}),me:()=>$("/auth/me"),updatePin:t=>$("/auth/update-pin",{method:"POST",body:JSON.stringify({pin:t})})},$e={getAll:()=>$("/users"),create:t=>$("/users",{method:"POST",body:JSON.stringify(t)}),update:(t,i)=>$(`/users/${t}`,{method:"PUT",body:JSON.stringify(i)}),delete:t=>$(`/users/${t}`,{method:"DELETE"}),setPin:(t,i)=>$(`/users/${t}/set-pin`,{method:"POST",body:JSON.stringify({pin:i})}),lock:(t,i)=>$(`/users/${t}/lock`,{method:"POST",body:JSON.stringify({locked:i})})},ce={getAll:()=>$("/products"),create:t=>$("/products",{method:"POST",body:JSON.stringify(t)}),update:(t,i)=>$(`/products/${t}`,{method:"PUT",body:JSON.stringify(i)}),delete:t=>$(`/products/${t}`,{method:"DELETE"}),updateStock:(t,i)=>$(`/products/${t}/stock`,{method:"PUT",body:JSON.stringify(i)}),getMaxProducible:t=>$(`/products/${t}/max-producible`),getWeightPricing:t=>$(`/products/${t}/weight-pricing`),addWeightPrice:(t,i,p)=>$(`/products/${t}/weight-pricing`,{method:"POST",body:JSON.stringify({weight:i,price:p})}),updateWeightPrice:(t,i,p)=>$(`/products/${t}/weight-pricing`,{method:"PUT",body:JSON.stringify({weight:i,price:p})}),deleteWeightPrice:(t,i)=>$(`/products/${t}/weight-pricing`,{method:"DELETE",body:JSON.stringify({weight:i})})},et={getAll:()=>$("/sales"),create:t=>$("/sales",{method:"POST",body:JSON.stringify(t)}),delete:t=>$(`/sales/${t}`,{method:"DELETE"}),adminComplete:t=>$("/admin-complete-sale",{method:"POST",body:JSON.stringify(t)})},ft={getAll:()=>$("/expenses"),create:t=>$("/expenses",{method:"POST",body:JSON.stringify(t)}),update:(t,i)=>$(`/expenses/${t}`,{method:"PUT",body:JSON.stringify(i)}),delete:t=>$(`/expenses/${t}`,{method:"DELETE"})},ts={get:()=>$("/stats")},Ge={getAll:()=>$("/discounts"),create:t=>$("/discounts",{method:"POST",body:JSON.stringify(t)}),update:(t,i)=>$(`/discounts/${t}`,{method:"PUT",body:JSON.stringify(i)}),delete:t=>$(`/discounts/${t}`,{method:"DELETE"})},ct={getAll:()=>$("/credit-requests"),create:t=>$("/credit-requests",{method:"POST",body:JSON.stringify(t)}),update:(t,i)=>$(`/credit-requests/${t}`,{method:"PUT",body:JSON.stringify(i)}),approve:t=>$(`/credit-requests/${t}/approve`,{method:"POST"}),reject:t=>$(`/credit-requests/${t}/reject`,{method:"POST"})},Ye={get:()=>$("/settings"),update:t=>$("/settings",{method:"PUT",body:JSON.stringify(t)})},dt={getAll:()=>$("/time-entries"),getStatus:()=>$("/clock-status"),create:t=>$("/time-entries",{method:"POST",body:JSON.stringify({action:t})}),update:(t,i)=>$(`/time-entries/${t}`,{method:"PUT",body:JSON.stringify(i)}),delete:t=>$(`/time-entries/${t}`,{method:"DELETE"})},bt={getAll:t=>{const i=t?`/batches?productId=${t}`:"/batches";return $(i)},create:t=>$("/batches",{method:"POST",body:JSON.stringify(t)})},wt={login:t=>$("/main-admin/auth/login",{method:"POST",body:JSON.stringify(t)}),getUsers:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return $("/main-admin/users",{headers:{Authorization:`Bearer ${t}`}})},getStats:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return $("/main-admin/stats",{headers:{Authorization:`Bearer ${t}`}})},getActivities:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return $("/main-admin/activities",{headers:{Authorization:`Bearer ${t}`}})},getSalesAll:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return $("/main-admin/sales-all",{headers:{Authorization:`Bearer ${t}`}})},getTimeEntriesAll:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return $("/main-admin/time-entries-all",{headers:{Authorization:`Bearer ${t}`}})},lockUser:(t,i)=>{const p=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return $(`/main-admin/users/${t}/lock`,{method:"POST",headers:{Authorization:`Bearer ${p}`},body:JSON.stringify({locked:i})})},changePlan:(t,i)=>{const p=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return $(`/main-admin/users/${t}/plan`,{method:"POST",headers:{Authorization:`Bearer ${p}`},body:JSON.stringify({plan:i})})},clearData:t=>{const i=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return $("/main-admin/system/clear-data",{method:"POST",headers:{Authorization:`Bearer ${i}`},body:JSON.stringify({type:t})})},getSubscribers:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return $("/main-admin/subscribers",{headers:{Authorization:`Bearer ${t}`}})},getSubscribersAnalytics:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return $("/main-admin/subscribers/analytics",{headers:{Authorization:`Bearer ${t}`}})},getUsersWithSubscriptions:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return $("/main-admin/users-with-subscriptions",{headers:{Authorization:`Bearer ${t}`}})}};let be=null,mt=new Set;function Vs(){const t=ee.replace(/\/api$/,"");return`${t.startsWith("https")?"wss":"ws"}://${t.replace(/^https?:\/\//,"")}/api/ws/products`}function Gs(){if(be&&(be.readyState===WebSocket.OPEN||be.readyState===WebSocket.CONNECTING))return;const t=Xt(),i=Vs()+(t?`?token=${encodeURIComponent(t)}`:"");be=new WebSocket(i),be.onopen=()=>{console.debug("Products WS connected")},be.onmessage=p=>{let j=null;try{j=JSON.parse(p.data)}catch{return}mt.forEach(l=>{try{l(j)}catch(r){console.error("ws callback error",r)}})},be.onclose=()=>{console.debug("Products WS closed"),be=null},be.onerror=p=>{console.error("Products WS error",p)}}function Bt(t){if(typeof t!="function")throw new Error("subscribeProducts requires a callback");return mt.add(t),Gs(),()=>{if(mt.delete(t),be&&mt.size===0){try{be.close()}catch{}be=null}}}const ss=s.createContext(),Ne=()=>s.useContext(ss),Qs=({children:t})=>{const[i,p]=s.useState(null),[j,l]=s.useState(!0),[r,o]=s.useState(!1),[c,g]=s.useState({});s.useEffect(()=>{m()},[]),s.useEffect(()=>{const E=()=>{const U=localStorage.getItem("user");if(U)try{const J=JSON.parse(U);p(J)}catch(J){console.warn("Failed to parse user from localStorage",J)}else p(null)};return window.addEventListener("storage",E),window.addEventListener("localStorageUpdated",E),()=>{window.removeEventListener("storage",E),window.removeEventListener("localStorageUpdated",E)}},[]);const m=async()=>{try{const E=localStorage.getItem("token"),U=localStorage.getItem("user");if(E)try{const J=await fetch(`${ee}/auth/me`,{headers:{Authorization:`Bearer ${E}`,"Content-Type":"application/json"}});if(J.ok){const te=await J.json();p(te),localStorage.setItem("user",JSON.stringify(te))}else throw new Error("Invalid token")}catch(J){console.warn("Auth check failed:",J),localStorage.removeItem("token"),localStorage.removeItem("user")}}catch(E){console.error("Error initializing auth:",E),localStorage.removeItem("token"),localStorage.removeItem("user"),p(null)}finally{l(!1),o(!0)}},f=async E=>{try{if(E&&E.token&&E.user)return localStorage.setItem("token",E.token),localStorage.setItem("user",JSON.stringify(E.user)),p(E.user),E;const U=await Be.login(E);if(U.token&&U.user)return localStorage.setItem("token",U.token),localStorage.setItem("user",JSON.stringify(U.user)),p(U.user),U;throw new Error("Invalid response from server")}catch(U){throw console.error("Login failed:",U),U}},w=async E=>{try{const U=await Be.signup(E);if(U.token&&U.user)return localStorage.setItem("token",U.token),localStorage.setItem("user",JSON.stringify(U.user)),p(U.user),U;throw new Error("Invalid response from server")}catch(U){throw console.error("Signup failed:",U),U}},a=async E=>{try{if(localStorage.setItem("user",JSON.stringify(E)),p(E),window.dispatchEvent(new Event("localStorageUpdated")),E&&E.id)try{await $e.update(E.id,E)}catch(U){console.warn("Failed to persist updated user to backend",U)}return E}catch(U){throw console.error("updateUser failed:",U),U}},I=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),p(null),window.location.href="/login"},b=()=>!!i&&!!localStorage.getItem("token"),v=E=>i&&i.role===E,y=()=>i&&(i.role==="admin"||i.role==="main-admin"),N=()=>i&&i.role==="cashier",x=()=>i&&i.plan==="ultra",u=()=>i&&i.plan==="basic",A=()=>i&&(i.role==="admin"||i.role==="cashier"),B=()=>i&&i.role==="admin"&&i.plan==="ultra",z=()=>i&&i.role==="admin",H=()=>!0,L=()=>!0;return i?.locked?e.jsx(LockedAccount,{}):e.jsx(ss.Provider,{value:{user:i,loading:j,isInitialized:r,appSettings:c,login:f,signup:w,updateUser:a,logout:I,isAuthenticated:b,hasRole:v,isAdmin:y,isCashier:N,isUltraPackage:x,isBasicPackage:u,canEditStock:A,canManageUsers:B,canViewAnalytics:z,isRealTimeProductSyncEnabled:H,isCashierUserManagementEnabled:L},children:t})};new Date().toISOString();const as=s.createContext(),Dt=()=>s.useContext(as),Ys=({children:t})=>{const{user:i}=Ne(),[p,j]=s.useState([]),[l,r]=s.useState(!0),[o,c]=s.useState(null),[g,m]=s.useState(Date.now()),f=s.useCallback(async()=>{if(!localStorage.getItem("token"))return r(!1),[];try{const a=await ce.getAll(),b=(Array.isArray(a)?a:[]).filter(v=>!v.pendingDelete);return j(b),c(null),window.dispatchEvent(new CustomEvent("productsSync",{detail:{products:b,timestamp:Date.now()}})),b}catch(a){return console.error("Failed to fetch products:",a),c(`Failed to load products: ${a.message}`),j([]),[]}finally{r(!1),m(Date.now())}},[]);s.useEffect(()=>{f()},[]),s.useEffect(()=>{const a=()=>{console.log("ðŸ”„ Data cleared event received - forcing products refresh"),j([]),c(null),f()};return window.addEventListener("dataCleared",a),window.addEventListener("productsCleared",a),()=>{window.removeEventListener("dataCleared",a),window.removeEventListener("productsCleared",a)}},[]);const w=async()=>(r(!0),await f());return e.jsx(as.Provider,{value:{products:p,loading:l,error:o,lastUpdated:g,refreshProducts:w},children:t})},rs=s.createContext(),ls=()=>s.useContext(rs),Zs=900*1e3,Xs=({children:t})=>{const{user:i}=Ne(),[p,j]=s.useState(!1),l=s.useRef(null),r=s.useRef(Date.now()),o=s.useCallback(()=>{r.current=Date.now(),l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{j(!0),console.log("ðŸ”’ Screen locked due to inactivity")},Zs)},[]);s.useEffect(()=>{const f=["mousedown","keydown","click","touchstart"];return f.forEach(w=>{document.addEventListener(w,o)}),o(),()=>{f.forEach(w=>{document.removeEventListener(w,o)}),l.current&&clearTimeout(l.current)}},[o]);const c=s.useCallback(()=>{j(!0),console.log("ðŸ”’ Screen manually locked")},[]),g=s.useCallback(()=>{j(!1),o(),console.log("ðŸ”“ Screen unlocked")},[o]),m={isLocked:p,lock:c,unlock:g};return e.jsx(rs.Provider,{value:m,children:t})};function ea(){const[t,i]=s.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[p,j]=s.useState(!0),[l,r]=s.useState(null);s.useEffect(()=>{o()},[]);const o=async()=>{try{r(null);const[m,f]=await Promise.all([ts.get(),et.getAll()]),w={totalSales:m?.totalSales||0,totalExpenses:m?.totalExpenses||0,profit:m?.profit||0,grossProfit:m?.grossProfit||0,netProfit:m?.netProfit||0,totalCOGS:m?.totalCOGS||0,dailySales:m?.dailySales||0,weeklySales:m?.weeklySales||0,productCount:m?.productCount||0},a=Array.isArray(f)?f:[];i({stats:w,recentSales:a.slice(-10).reverse()})}catch(m){console.error("Failed to load data:",m),r(m.message),i({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{j(!1)}};if(p)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(l&&t.stats.totalSales===0&&t.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Ze,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:l}),e.jsx("button",{onClick:o,className:"btn-primary",children:"Retry"})]})});const c=[{label:"Total Sales",value:`KSH ${t.stats.totalSales?.toLocaleString()||0}`,icon:ze,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${t.stats.grossProfit?.toLocaleString()||0}`,icon:Qe,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${t.stats.totalCOGS?.toLocaleString()||0}`,icon:Oe,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${t.stats.netProfit?.toLocaleString()||0}`,icon:Qe,color:"from-purple-500 to-pink-600",change:"+15.3%"}],g=[{label:"Daily Sales",value:`KSH ${t.stats.dailySales?.toLocaleString()||0}`,icon:Jt,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${t.stats.weeklySales?.toLocaleString()||0}`,icon:Qe,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${t.stats.totalExpenses?.toLocaleString()||0}`,icon:xt,color:"bg-red-50 text-red-600"},{label:"Products",value:t.stats.productCount||0,icon:Oe,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(c||[]).map((m,f)=>{const w=m?.icon;return w?e.jsxs("div",{className:`card bg-gradient-to-br ${m.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(w,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:m.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:m.label}),e.jsx("p",{className:"text-2xl font-bold",children:m.value})]},f):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(g||[]).map((m,f)=>{const w=m?.icon;return w?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${m.color} flex items-center justify-center`,children:e.jsx(w,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:m.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:m.value})]})]})},f):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!t.recentSales||t.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ze,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(t.recentSales||[]).map(m=>m?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:m.createdAt?new Date(m.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(m.items)?m.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:m.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",m.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",m.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",m.profit?.toLocaleString()||0]})]},m.id||Math.random()):null)})]})})]})]})}const ta=()=>"https://posifine22.onrender.com/api".replace("https://","wss://").replace("http://","ws://");class sa{constructor(){this.ws=null,this.listeners={stock_updated:[],sale_completed:[],admin_sale_completed:[],product_created:[],product_updated:[],product_deleted:[],heartbeat:[],initial:[],error:[]},this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.isManualClose=!1}connect(i,p){return new Promise((j,l)=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){j();return}if(!i){l(new Error("No token provided for WebSocket connection"));return}const r=`${ta()}/ws/products?token=${encodeURIComponent(i)}`;try{this.ws=new WebSocket(r),this.ws.onopen=()=>{console.log("âœ… WebSocket connected for real-time updates"),this.reconnectAttempts=0,j()},this.ws.onmessage=o=>{try{const c=JSON.parse(o.data),g=c.type?c.type.toLowerCase():"unknown";g==="stock_updated"?(console.log("ðŸ“¦ Stock update received:",c.data),p&&p(c.data),this.emit("stock_updated",c.data)):g==="sale_completed"?(console.log("ðŸ’° Sale completed - stock deducted:",c.data),this.emit("sale_completed",c.data),p&&c.data.updatedProducts&&p({allProducts:c.data.updatedProducts})):g==="admin_sale_completed"?(console.log("ðŸ‘¨â€ðŸ’¼ Admin sale completed:",c.data),this.emit("admin_sale_completed",c.data),this.emit("sale_completed",c.data),p&&c.data.updatedProducts&&p({allProducts:c.data.updatedProducts})):g==="product_created"?(console.log("âœ¨ Product created:",c.data),this.emit("product_created",c.data)):g==="product_updated"?(console.log("ðŸ“ Product updated:",c.data),this.emit("product_updated",c.data),p&&c.data.allProducts&&p({allProducts:c.data.allProducts})):g==="product_deleted"?(console.log("ðŸ—‘ï¸ Product deleted:",c.data),this.emit("product_deleted",c.data),p&&c.data.allProducts&&p({allProducts:c.data.allProducts})):g==="initial"?(console.log("ðŸ“¦ Initial products loaded via WebSocket"),this.emit("initial",c.products)):g==="heartbeat"?this.emit("heartbeat",c):(console.log(`ðŸ“¨ Message received (${g}):`,c.data),g!=="unknown"&&this.emit(g,c.data))}catch(c){console.error("Error parsing WebSocket message:",c)}},this.ws.onerror=o=>{console.error("âŒ WebSocket error:",o),this.emit("error",o),l(o)},this.ws.onclose=()=>{console.log("ðŸ”Œ WebSocket disconnected"),this.isManualClose||this.attemptReconnect(i,p)}}catch(o){console.error("Failed to create WebSocket:",o),l(o)}})}attemptReconnect(i,p){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Max reconnection attempts reached");return}this.reconnectAttempts++;const j=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`ðŸ”„ Reconnecting in ${j}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect(i,p).catch(l=>{console.error("Reconnection failed:",l)})},j)}on(i,p){this.listeners[i]||(this.listeners[i]=[]),this.listeners[i].push(p)}emit(i,p){this.listeners[i]&&this.listeners[i].forEach(j=>{try{j(p)}catch(l){console.error(`Error in ${i} listener:`,l)}})}disconnect(){this.isManualClose=!0,this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}}const Se=new sa;function aa(){const{user:t,isUltraPackage:i,isRealTimeProductSyncEnabled:p}=Ne(),{products:j,refreshProducts:l}=Dt(),[r,o]=s.useState([]),[c,g]=s.useState([]),[m,f]=s.useState(!1),[w,a]=s.useState("all"),[I,b]=s.useState(""),[v,y]=s.useState(!1),[N,x]=s.useState(!1),[u,A]=s.useState(!1),[B,z]=s.useState(!1),[H,L]=s.useState(null),[E,U]=s.useState({}),[J,te]=s.useState({weight:"",price:""}),[se,ge]=s.useState(null),[de,je]=s.useState(null),[Ie,me]=s.useState(!1),[ae,xe]=s.useState(null),[S,h]=s.useState(""),[k,D]=s.useState({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),[O,_]=s.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[F,Y]=s.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0}),M=async()=>{try{console.log("ðŸ“¦ Loading inventory data..."),await l();const d=await bt.getAll();g(d),console.log("âœ… Inventory data loaded")}catch(d){console.error("âŒ Failed to load data:",d),X("Failed to load inventory data","error")}};s.useEffect(()=>{m||(M(),f(!0));const d=localStorage.getItem("token");return d&&(Se.connect(d,C=>{C&&C.allProducts&&C.allProducts.length>0&&(console.log("ðŸ“¦ WebSocket stock update received:",C.allProducts.length,"products"),o(C.allProducts))}).catch(C=>{console.warn("WebSocket connection failed:",C)}),Se.on("sale_completed",C=>{if(console.log("ðŸ”„ Sale completed - updating inventory display:",C),C.updatedProducts&&C.updatedProducts.length>0&&(console.log(`âœ… Updating ${C.updatedProducts.length} products from sale`),o(C.updatedProducts),X(`âœ… Stock updated! Sale #${C.saleId} deducted inventory`,"success")),C.lowStockWarnings&&C.lowStockWarnings.length>0){const R=C.lowStockWarnings.map(V=>`${V.name}: ${V.current} left`).join(", ");X(`âš ï¸ Low stock alert: ${R}`,"warning")}})),()=>{Se.disconnect()}},[m]),s.useEffect(()=>{j&&j.length>0&&r.length===0&&(console.log("ðŸ“¦ Initial sync from global context:",j.length,"products"),o(j))},[j.length]);const Pe=(d,C=!0)=>{const R=d.target.files[0];if(R){if(R.size>2*1024*1024){X("Image must be smaller than 2MB","error");return}const V=new FileReader;V.onload=G=>{const le=G.target.result;h(le),C?D({...k,image:le}):(Y({...F,image:le}),F.id&&setTimeout(async()=>{try{await ce.update(F.id,{image:le}),X("âœ… Image saved","success")}catch(Ae){console.error("Failed to save image:",Ae)}},500))},V.readAsDataURL(R)}},re=d=>c.filter(R=>R.productId===d&&R.quantity>0).reduce((R,V)=>R+V.quantity,0),Fe=d=>c.filter(C=>C.productId===d&&C.quantity>0),X=(d,C="success")=>{je({message:d,type:C}),setTimeout(()=>je(null),5e3)},De=async d=>{d.preventDefault();try{const C={...k,price:parseFloat(k.price),cost:parseFloat(k.cost||0),quantity:0,visibleToCashier:!k.expenseOnly&&k.visibleToCashier!==!1},R=await ce.create(C);D({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),h(""),y(!1),X(`âœ… Product "${R.name}" added successfully! ${R.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success"),M().catch(V=>console.warn("Background refresh failed:",V))}catch(C){console.error("Failed to create product:",C),alert(`Failed to create product: ${C.message||"Unknown error"}`)}},Tt=async d=>{d.preventDefault();try{const C={id:`batch-${Date.now()}`,productId:H.id,quantity:parseInt(O.quantity),expiryDate:O.expiryDate,batchNumber:O.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(O.cost||H.cost||0)};g(R=>[...R,C]),X("âš¡ Adding stock...","info");try{await bt.create({productId:H.id,quantity:parseInt(O.quantity),expiryDate:O.expiryDate,batchNumber:O.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(O.cost||H.cost||0)}),_({quantity:"",expiryDate:"",batchNumber:"",cost:""}),A(!1),L(null),X(`âœ… Stock added successfully for ${H.name}!`,"success"),M().catch(R=>console.warn("Background refresh failed:",R))}catch(R){throw g(V=>V.filter(G=>G.id!==C.id)),R}}catch(C){console.error("Failed to add stock:",C),X(`âŒ Failed to add stock: ${C.message||"Unknown error"}`,"error")}},Re=async d=>{d.preventDefault();try{const C=r.find(G=>G.id===F.id);if(parseFloat(F.price)<C.price){alert("You cannot lower prices, only increase.");return}const R={...F,price:parseFloat(F.price),cost:parseFloat(F.cost),quantity:parseFloat(F.quantity)},V={...C,...R};o(G=>G.map(le=>le.id===F.id?V:le)),me(!0),X("âš¡ Updating product...","info");try{const G=await ce.update(F.id,R);x(!1),p()?(window.dispatchEvent(new CustomEvent("productUpdated",{detail:{product:G,originalProduct:C,timestamp:new Date().toISOString(),type:"update"}})),X("âœ… Product updated and synced!","success")):X("âœ… Product updated successfully!","success"),xe(new Date)}catch(G){throw o(le=>le.map(Ae=>Ae.id===F.id?C:Ae)),G}finally{me(!1)}}catch(C){console.error("Failed to update product:",C),X(`âŒ Update failed: ${C.message||"Unknown error"}`,"error")}},st=async d=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const C=r.find(V=>V.id===d),R=await ce.delete(d);if(o(V=>V.filter(G=>G.id!==d)),p()&&C)me(!0),window.dispatchEvent(new CustomEvent("productDeleted",{detail:{product:C,timestamp:new Date().toISOString(),type:"delete"}})),X(`ðŸ“¡ Product "${C.name}" deleted and synced to all dashboards!`,"success"),xe(new Date),setTimeout(()=>{me(!1)},3e3);else{const V=R?.message||"Product deleted successfully!";alert(V)}await l()}catch(C){console.error("Failed to delete product:",C);let R="Failed to delete product";C.message.includes("Failed to execute")||C.message.includes("JSON")?R="Network error. Please check your connection and try again.":C.message.includes("401")||C.message.includes("unauthorized")?R="You are not authorized to delete this product.":C.message.includes("404")||C.message.includes("not found")?R="Product not found. It may have been deleted already.":C.message&&(R=`Failed to delete product: ${C.message}`),alert(R)}},Te=(r||[]).filter(d=>{if(!d)return!1;const C=d.name?.toLowerCase().includes(I.toLowerCase()),R=w==="all"||w==="raw"&&!d.recipe||w==="composite"&&d.recipe||w==="expense"&&d.expenseOnly||w==="low-stock"&&d.quantity<10;return C&&R}),We=(r||[]).filter(d=>d&&!d.recipe&&!d.expenseOnly),at=(r||[]).filter(d=>d&&d.recipe),Ke=(r||[]).filter(d=>d&&d.expenseOnly),qe=d=>{if(!d||!d.recipe)return 0;let C=1/0;return(d.recipe||[]).forEach(R=>{if(!R)return;const V=(r||[]).find(G=>G&&G.id===R.productId);if(V&&V.quantity>0&&R.quantity>0){const G=Math.floor(V.quantity/R.quantity);C=Math.min(C,G)}}),C===1/0?0:C},Et=d=>{if(!d)return 0;if(!d.recipe)return d.cost||0;let C=0;return(d.recipe||[]).forEach(R=>{if(!R)return;const V=(r||[]).find(G=>G&&G.id===R.productId);if(V&&V.quantity>0){const G=(V.cost||0)/V.quantity;C+=G*(R.quantity||0)}}),C},rt=async d=>{L(d);try{const C=await ce.getWeightPricing(d.id);U(C.weightPricing||{})}catch(C){console.error("Failed to load weight pricing:",C),U({})}z(!0)},$t=async d=>{if(d.preventDefault(),!J.weight||!J.price){X("âŒ Please enter both weight and price","error");return}try{const C=parseFloat(J.weight),R=parseFloat(J.price);if(C*10%1!==0){X("âŒ Weight must be in 0.1kg increments (0.1, 0.2, 0.3, etc)","error");return}await ce.addWeightPrice(H.id,C,R),U({...E,[String(C)]:R}),te({weight:"",price:""}),X(`âœ… Weight price added for ${C}kg`,"success")}catch(C){X(`âŒ Failed to add weight price: ${C.message}`,"error")}},ve=async d=>{if(confirm(`Delete pricing for ${d}kg?`))try{await ce.deleteWeightPrice(H.id,d);const C={...E};delete C[String(d)],U(C),X(`âœ… Weight price for ${d}kg deleted`,"success")}catch(C){X(`âŒ Failed to delete weight price: ${C.message}`,"error")}};return e.jsxs("div",{className:"p-6 space-y-6",children:[de&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${de.type==="success"?"bg-green-50 border border-green-200 text-green-800":de.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:de.message}),e.jsx("button",{onClick:()=>je(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:I,onChange:d=>b(d.target.value)})]}),e.jsxs("select",{value:w,onChange:d=>a(d.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>y(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:We.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:at.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:Ke.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(Te||[]).map(d=>{if(!d)return null;const C=Et(d),R=d.price?((d.price-C)/d.price*100).toFixed(1):0,V=qe(d),G=se===d.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[d.image?e.jsx("img",{src:d.image,alt:d.name,className:"w-12 h-12 object-cover rounded-lg",onError:le=>{le.target.style.display="none",le.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:d.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[d.recipe&&e.jsx("button",{onClick:()=>ge(G?null:d.id),className:"p-1 hover:bg-gray-200 rounded",children:G?e.jsx(ws,{className:"w-4 h-4"}):e.jsx(Ss,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:d.name}),d.quantity<10&&!d.recipe&&e.jsx(Xe,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${d.expenseOnly?"badge-warning":d.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:d.expenseOnly?"Expense":d.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",d.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",C.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${re(d.id)===0?"text-red-600":re(d.id)<10?"text-yellow-600":"text-gray-900"}`,children:[re(d.id)," ",d.unit]}),re(d.id)<10&&re(d.id)>0&&e.jsx(Xe,{className:"w-4 h-4 text-yellow-500"}),re(d.id)===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600",children:[Fe(d.id).length," active"]}),e.jsx("button",{onClick:()=>{L(d),A(!0)},className:"p-1 hover:bg-blue-50 rounded text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(pe,{className:"w-3 h-3"})})]})}),e.jsx("td",{className:"px-4 py-3",children:d.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[V," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${R>30?"text-green-600":R>15?"text-yellow-600":"text-red-600"}`,children:[R,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>rt(d),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600 transition-colors",title:"Edit weight-based pricing",children:e.jsx(Oe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{Y(d),x(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>st(d.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(ye,{className:"w-4 h-4"})})]})})]},d.id),G&&d.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(d.recipe||[]).map((le,Ae)=>{if(!le)return null;const ke=(r||[]).find(Ee=>Ee&&Ee.id===le.productId);if(!ke)return null;const we=(ke.cost||0)/(ke.quantity||1),jt=we*(le.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:ke.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[le.quantity||0," ",ke.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[ke.quantity||0," ",ke.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",we.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",jt.toFixed(2)]})]},Ae)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",C.toFixed(2)]})]})})]})]})})})]})})})]})})}),u&&H&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Add Stock for ",H.name]}),e.jsxs("form",{onSubmit:Tt,className:"space-y-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:O.quantity,onChange:d=>_({...O,quantity:d.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:O.expiryDate,onChange:d=>_({...O,expiryDate:d.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:O.batchNumber,onChange:d=>_({...O,batchNumber:d.target.value})}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost per Unit",className:"input",value:O.cost,onChange:d=>_({...O,cost:d.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{A(!1),L(null),_({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:De,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:k.name,onChange:d=>D({...k,name:d.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:d=>Pe(d,!0),className:"input"}),e.jsx(Wt,{className:"w-5 h-5 text-gray-400"})]}),(S||k.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:S||k.image,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:k.price,onChange:d=>D({...k,price:d.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:k.cost,onChange:d=>D({...k,cost:d.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:k.category,onChange:d=>D({...k,category:d.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsxs("select",{className:"input",value:k.unit,onChange:d=>D({...k,unit:d.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k.expenseOnly,onChange:d=>D({...k,expenseOnly:d.target.checked,visibleToCashier:!d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!k.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k.visibleToCashier,onChange:d=>D({...k,visibleToCashier:d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{y(!1),h(""),D({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0})},className:"btn-secondary",children:"Cancel"})]})]})]})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:Re,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:F.name,onChange:d=>Y({...F,name:d.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:F.image||"",onChange:d=>Y({...F,image:d.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:d=>{const C=d.target.files[0];if(C){const R=new FileReader;R.onloadend=()=>{Y({...F,image:R.result})},R.readAsDataURL(C)}}})]}),F.image&&e.jsx("img",{src:F.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:F.price||"",onChange:d=>Y({...F,price:d.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:F.cost||"",onChange:d=>Y({...F,cost:d.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:F.quantity||"",onChange:d=>Y({...F,quantity:d.target.value}),required:!0}),e.jsxs("select",{className:"input",value:F.unit||"pcs",onChange:d=>Y({...F,unit:d.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:F.category||"raw",onChange:d=>Y({...F,category:d.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:F.expenseOnly||!1,onChange:d=>Y({...F,expenseOnly:d.target.checked,visibleToCashier:!d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!F.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:F.visibleToCashier!==!1,onChange:d=>Y({...F,visibleToCashier:d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>x(!1),className:"btn-secondary",children:"Cancel"})]})]})]})}),B&&H&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-96 overflow-y-auto",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Weight-Based Pricing - ",H.name]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Set different prices for different weights (in 0.1kg increments)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700",children:"Add New Weight Price"}),e.jsxs("form",{onSubmit:$t,className:"flex gap-3",children:[e.jsx("input",{type:"number",step:"0.1",min:"0.1",placeholder:"Weight (kg) - e.g., 0.1, 0.5, 1.0",className:"input flex-1",value:J.weight,onChange:d=>te({...J,weight:d.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Price (KSH)",className:"input flex-1",value:J.price,onChange:d=>te({...J,price:d.target.value}),required:!0}),e.jsx("button",{type:"submit",className:"btn-primary whitespace-nowrap",children:"Add Price"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Current Prices"}),Object.keys(E).length>0?e.jsx("div",{className:"space-y-2",children:Object.entries(E).sort(([d],[C])=>parseFloat(d)-parseFloat(C)).map(([d,C])=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-medium",children:[d," kg"]}),e.jsxs("span",{className:"text-gray-600 ml-4",children:["KSH ",parseFloat(C).toLocaleString()]})]}),e.jsx("button",{onClick:()=>ve(d),className:"text-red-600 hover:bg-red-50 px-3 py-1 rounded text-sm font-medium transition-colors",children:"Delete"})]},d))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No weight-based pricing set. Add one above."})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Base price:"})," KSH ",H.price?.toLocaleString()]})})]}),e.jsx("div",{className:"flex gap-2 mt-6",children:e.jsx("button",{onClick:()=>{z(!1),L(null),U({}),te({weight:"",price:""})},className:"btn-secondary flex-1",children:"Done"})})]})})]})}function ra(){const[t,i]=s.useState([]),[p,j]=s.useState([]),[l,r]=s.useState(!1),[o,c]=s.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});s.useEffect(()=>{g()},[]);const g=async()=>{const v=await ce.getAll();i(v),j(v.filter(y=>!y.recipe))},m=()=>{c({...o,ingredients:[...o.ingredients,{name:"",quantity:"",unit:"pcs"}]})},f=(v,y,N)=>{const x=[...o.ingredients];x[v][y]=N,c({...o,ingredients:x})},w=v=>{c({...o,ingredients:o.ingredients.filter((y,N)=>N!==v)})},a=()=>o.ingredients.reduce((v,y)=>{const N=p.find(x=>x.name.toLowerCase()===y.name.toLowerCase());if(N&&y.quantity){const x=N.cost/N.quantity;return v+x*parseFloat(y.quantity)}return v},0),I=async v=>{v.preventDefault();const y=[];for(const x of o.ingredients){if(!x.name||!x.quantity)continue;const u=p.find(A=>A.name.toLowerCase()===x.name.toLowerCase());u?y.push({productId:u.id,quantity:parseFloat(x.quantity),unit:x.unit||"pcs"}):y.push({name:x.name,quantity:parseFloat(x.quantity),unit:x.unit||"pcs"})}if(y.length===0){alert("Please add at least one ingredient");return}const N=a();try{await ce.create({name:o.name,price:parseFloat(o.price),cost:N,quantity:0,unit:"pcs",category:"composite",recipe:y,image:o.image||"",visibleToCashier:o.visibleToCashier,expenseOnly:!1}),c({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),r(!1),g(),alert("Recipe created successfully!")}catch(x){console.error("Error creating recipe:",x),alert("Failed to create recipe. Please try again.")}},b=t.filter(v=>v.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>r(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",b.length,")"]}),b.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:b.map(v=>{const y=v.recipe.reduce((x,u)=>{if(u.productId){const A=t.find(B=>B.id===u.productId);if(A){const B=A.cost/A.quantity;return x+B*u.quantity}}else if(u.name){const A=t.find(B=>B.name.toLowerCase()===u.name.toLowerCase());if(A){const B=A.cost/A.quantity;return x+B*u.quantity}}return x},0),N=((v.price-y)/v.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:v.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",v.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",y.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${N>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",N,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(ye,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:v.recipe.map((x,u)=>{let A="",B=x.unit||"pcs";if(x.productId){const z=t.find(H=>H.id===x.productId);z&&(A=z.name,B=z.unit)}else x.name&&(A=x.name,B=x.unit||"pcs");return A?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:A}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[x.quantity," ",B]})]},u):null})})]})]},v.id)})})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:o.name,onChange:v=>c({...o,name:v.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:o.price,onChange:v=>c({...o,price:v.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:o.image,onChange:v=>c({...o,image:v.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.visibleToCashier,onChange:v=>c({...o,visibleToCashier:v.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:m,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:o.ingredients.map((v,y)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:v.name,onChange:N=>f(y,"name",N.target.value),required:!0,list:`ingredients-list-${y}`}),e.jsx("datalist",{id:`ingredients-list-${y}`,children:p.map(N=>e.jsxs("option",{value:N.name,children:[N.name," (",N.quantity," ",N.unit," available)"]},N.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:v.quantity,onChange:N=>f(y,"quantity",N.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:v.unit,onChange:N=>f(y,"unit",N.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>w(y),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(ye,{className:"w-4 h-4"})})]},y))}),o.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),o.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",a().toFixed(2)]})]}),o.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(o.price)-a())/parseFloat(o.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(ks,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{r(!1),c({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function la(){const[t,i]=s.useState([]),[p,j]=s.useState("all"),[l,r]=s.useState([]),[o,c]=s.useState(!1);s.useEffect(()=>{g()},[]);const g=async()=>{const y=await et.getAll();i(y.reverse())},m=async y=>{if(window.confirm("Delete this sale? This action cannot be undone."))try{c(!0);const N=localStorage.getItem("token");if(!(await fetch(`${ee}/sales/${y}`,{method:"DELETE",headers:{Authorization:`Bearer ${N}`}})).ok)throw new Error("Failed to delete sale");i(t.filter(u=>u.id!==y)),alert("Sale deleted successfully")}catch(N){alert("Failed to delete sale: "+N.message)}finally{c(!1)}},f=async()=>{if(l.length===0){alert("No sales selected");return}if(window.confirm(`Delete ${l.length} sales? This action cannot be undone.`))try{c(!0);const y=localStorage.getItem("token");if(!(await fetch(`${ee}/sales/bulk-delete`,{method:"POST",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify({saleIds:l})})).ok)throw new Error("Failed to delete sales");i(t.filter(x=>!l.includes(x.id))),r([]),alert("Sales deleted successfully")}catch(y){alert("Failed to delete sales: "+y.message)}finally{c(!1)}},w=async()=>{if(window.confirm("Clear ALL sales data? This will delete everything and cannot be undone."))try{c(!0);const y=localStorage.getItem("token");if(!(await fetch(`${ee}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify({type:"sales"})})).ok)throw new Error("Failed to clear sales");i([]),r([]),alert("All sales data cleared")}catch(y){alert("Failed to clear sales: "+y.message)}finally{c(!1)}},a=t.filter(y=>{if(p==="today")return new Date(y.createdAt).toDateString()===new Date().toDateString();if(p==="week"){const N=new Date;return N.setDate(N.getDate()-7),new Date(y.createdAt)>=N}return!0}),I=a.reduce((y,N)=>y+N.total,0),b=a.reduce((y,N)=>y+(N.cogs||0),0),v=I-b;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:p,onChange:y=>j(y.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]}),l.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[l.length," selected"]}),e.jsxs("button",{onClick:f,disabled:o,className:"px-3 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),"Delete Selected"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:w,disabled:o||t.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(Kt,{className:"w-4 h-4"}),"Clear All Sales"]}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(Cs,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",I.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",b.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",v.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:l.length===a.length&&a.length>0,onChange:y=>{y.target.checked?r(a.map(N=>N.id)):r([])},className:"rounded"})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Action"})]})}),e.jsx("tbody",{children:a.map(y=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:l.includes(y.id),onChange:N=>{N.target.checked?r([...l,y.id]):r(l.filter(x=>x!==y.id))},className:"rounded"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",y.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(y.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[y.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:y.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",y.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",y.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",y.profit?.toLocaleString()||0]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("button",{onClick:()=>m(y.id),disabled:o,className:"px-3 py-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),"Delete"]})})]},y.id))})]})})]})]})}function na(){const[t,i]=s.useState([]),[p,j]=s.useState(!1),[l,r]=s.useState({description:"",amount:"",category:"general"}),[o,c]=s.useState(null);s.useEffect(()=>{m();const b=localStorage.getItem("token");return b&&(Se.connect(b).catch(v=>{console.warn("WebSocket connection failed:",v)}),Se.on("sale_completed",v=>{console.log("ðŸ’° Sale completed - updating expenses:",v),m(),v.saleId&&g(`âœ… Expenses updated from Sale #${v.saleId}`,"success")})),()=>{Se.disconnect()}},[]);const g=(b,v)=>{c({message:b,type:v}),setTimeout(()=>c(null),3e3)},m=async()=>{const b=await ft.getAll();i(b.reverse())},f=async b=>{b.preventDefault(),await ft.create({...l,amount:parseFloat(l.amount)}),r({description:"",amount:"",category:"general"}),j(!1),m()},w=t.reduce((b,v)=>b+v.amount,0),a=t.filter(b=>!b.automatic),I=t.filter(b=>b.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[o&&e.jsx("div",{className:`fixed top-4 right-4 p-4 rounded-lg text-white font-medium z-50 ${o.type==="success"?"bg-green-600":"bg-blue-600"}`,children:o.message}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("button",{onClick:()=>j(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",w.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",a.reduce((b,v)=>b+v.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",I.reduce((b,v)=>b+v.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.map(b=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(b.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:b.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:b.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${b.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:b.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",b.amount?.toLocaleString()]})]},b.id))})]})})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:l.description,onChange:b=>r({...l,description:b.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:l.amount,onChange:b=>r({...l,amount:b.target.value}),required:!0}),e.jsxs("select",{className:"input",value:l.category,onChange:b=>r({...l,category:b.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>j(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function ia(){const{isCashierUserManagementEnabled:t,isCashier:i}=Ne(),[p,j]=s.useState([]),[l,r]=s.useState(!0),[o,c]=s.useState(!1),[g,m]=s.useState(null),[f,w]=s.useState(null),[a,I]=s.useState(null),[b,v]=s.useState(0),[y,N]=s.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),[x,u]=s.useState(!1),[A,B]=s.useState(null),[z,H]=s.useState("");s.useEffect(()=>{L()},[]),s.useEffect(()=>()=>{a?.intervalId&&clearInterval(a.intervalId)},[a]);const L=async()=>{try{r(!0);const h=await $e.getAll();j(Array.isArray(h)?h:[])}catch(h){console.error("Error loading users:",h),j([])}finally{r(!1)}},E=()=>Math.floor(1e3+Math.random()*9e3).toString(),U=async h=>{if(h.preventDefault(),console.log("Form submitted with data:",y),!y.name?.trim()||!y.email?.trim()||!y.password?.trim()){alert("Please fill in all required fields");return}if(y.password.length<6){alert("Password must be at least 6 characters long");return}try{r(!0);const k=E(),D={name:y.name.trim(),email:y.email.trim().toLowerCase(),password:y.password.trim(),pin:k};console.log("Sending user data:",D);const O=await $e.create(D);console.log("User creation result:",O),await L();const _=`âœ… Cashier added successfully!

ðŸ“§ Email: ${D.email}
ðŸ”‘ Password: ${D.password}
ðŸ”¢ PIN: ${k}

ðŸ’¡ LOGIN OPTIONS:
1. Email + Password: Use email and password above
2. PIN Login: Use email + ${k}

Please share these credentials securely with the new cashier.`;alert(_),N({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),c(!1)}catch(k){console.error("Error creating cashier:",k);let D="Failed to add cashier";k.message.includes("Current user not found")?D="Authentication error. Please refresh the page and try again.":k.message.includes("email")?D="Email already exists. Please use a different email.":k.message.includes("network")||k.message.includes("fetch")?D="Network error. Please check your connection and try again.":k.message&&(D=`Failed to add cashier: ${k.message}`),alert(D)}finally{r(!1)}},J=async(h,k)=>{try{r(!0),await $e.update(h,{permissions:k}),await L(),m(null)}catch(D){console.error("Error updating permissions:",D),alert("Failed to update permissions: "+D.message)}finally{r(!1)}},te=async(h,k)=>{try{r(!0);const D=!k,O=await fetch(`${ee}/users/${h}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({active:D})});if(!O.ok){const _=await O.json().catch(()=>({error:"Network error"}));throw new Error(_.error||`HTTP ${O.status}: ${O.statusText}`)}await L()}catch(D){console.error("Error updating user status:",D),alert("Failed to update user status: "+D.message)}finally{r(!1)}},se=async(h,k)=>{try{r(!0);const D=!k,O=await fetch(`${ee}/users/${h}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({locked:D})});if(!O.ok){const _=await O.json().catch(()=>({error:"Network error"}));throw new Error(_.error||`HTTP ${O.status}: ${O.statusText}`)}await L()}catch(D){console.error("Error updating user lock status:",D),alert("Failed to update user lock status: "+D.message)}finally{r(!1)}},ge=async h=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{r(!0),await $e.delete(h),await L()}catch(k){console.error("Error deleting user:",k),alert("Failed to delete user: "+k.message)}finally{r(!1)}},de=async()=>{if(window.confirm("Clear ALL users data? This will delete all users and cannot be undone."))try{r(!0);const h=localStorage.getItem("token");if(!(await fetch(`${ee}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify({type:"users"})})).ok)throw new Error("Failed to clear users");j([]),alert("All users data cleared")}catch(h){alert("Failed to clear users: "+h.message)}finally{r(!1)}},je=h=>{B(h),H(E()),u(!0)},Ie=async()=>{try{r(!0),await $e.update(A.id,{cashierPIN:z}),await L(),u(!1),B(null),H(""),alert(`âœ… PIN reset successfully!

ðŸ”¢ New PIN for ${A.name}: ${z}

Please share this PIN securely with the cashier.`)}catch(h){console.error("Error resetting PIN:",h),alert("Failed to reset PIN: "+h.message)}finally{r(!1)}},me=h=>{w(h),I({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const k=setInterval(()=>{xe(h)},3e3);I(D=>({...D,intervalId:k})),xe(h)},ae=()=>{a?.intervalId&&clearInterval(a.intervalId),w(null),I(null)},xe=async h=>{try{const k=await et.getAll(),O=(Array.isArray(k)?k:[]).filter(F=>F.cashierId===h.id).sort((F,Y)=>new Date(Y.createdAt)-new Date(F.createdAt)).slice(0,10),_={isActive:Math.random()>.3,currentCart:O.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:O.reduce((F,Y)=>F+Y.total,0),salesCount:O.length,lastActivity:O.length>0?new Date(O[0].createdAt).toLocaleTimeString():"No recent activity"};I(_)}catch(k){console.error("Error loading live view data:",k)}},S=(p||[]).filter(h=>h.role==="cashier");return l&&p.length===0?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),e.jsx("div",{className:"flex items-center gap-2",children:t()&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:de,disabled:l||p.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(Kt,{className:"w-4 h-4"}),"Clear All Users"]}),e.jsxs("button",{onClick:()=>c(!0),className:"btn-primary flex items-center gap-2",disabled:l,children:[e.jsx(pe,{className:"w-4 h-4"}),"Add Cashier"]})]})})]}),i()&&!t()&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(he,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"User Management Restricted"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The admin has disabled cashier user management. You cannot add, edit, or remove users at this time."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:p.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:S.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:p.filter(h=>h.active).length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(p||[]).map(h=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:h.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:h.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${h.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:h.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:h.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:h.role==="cashier"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:h.pin||h.cashierPIN||"----"}),e.jsx("button",{onClick:()=>je(h),className:"p-1 hover:bg-yellow-50 rounded text-yellow-600",title:"Reset PIN",disabled:l,children:e.jsx(Ue,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${h.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:h.active?e.jsxs(e.Fragment,{children:[e.jsx(Lt,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ot,{className:"w-3 h-3"}),"Inactive"]})}),h.locked&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:[e.jsx(ut,{className:"w-3 h-3"}),"Locked"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>te(h.id,h.active),className:`p-2 rounded-lg transition ${h.active?"hover:bg-red-50 text-red-600":"hover:bg-green-50 text-green-600"}`,title:h.active?"Deactivate User":"Activate User",disabled:l,children:h.active?e.jsx(Ot,{className:"w-4 h-4"}):e.jsx(Lt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>se(h.id,h.locked||!1),className:`p-2 rounded-lg transition ${h.locked?"hover:bg-green-50 text-green-600":"hover:bg-red-50 text-red-600"}`,title:h.locked?"Unlock User":"Lock User",disabled:l,children:e.jsx(ut,{className:"w-4 h-4"})})]}),h.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",h.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(Vt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>me(h),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(Ut,{className:"w-4 h-4"})})]}),t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>m(h),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600",title:"Edit Permissions",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ge(h.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",title:"Delete User",disabled:l,children:e.jsx(ye,{className:"w-4 h-4"})})]})]})})]},h.id))})]}),p.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(He,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first cashier to get started"})]})]})]}),o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:y.name||"",onChange:h=>{console.log("Name input changed:",h.target.value),N({...y,name:h.target.value})},required:!0,disabled:l}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:y.email||"",onChange:h=>{console.log("Email input changed:",h.target.value),N({...y,email:h.target.value})},required:!0,disabled:l}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:y.password||"",onChange:h=>{console.log("Password input changed:",h.target.value),N({...y,password:h.target.value})},required:!0,minLength:6,disabled:l}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(y.permissions).map(([h,k])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:D=>N({...y,permissions:{...y.permissions,[h]:D.target.checked}}),disabled:l}),e.jsx("span",{className:"text-sm capitalize",children:h.replace(/([A-Z])/g," $1").trim()})]},h))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:l,children:l?"Adding...":"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>c(!1),className:"btn-secondary",disabled:l,children:"Cancel"})]})]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",g.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(g.permissions||{}).map(([h,k])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:D=>m({...g,permissions:{...g.permissions,[h]:D.target.checked}}),disabled:l}),e.jsx("span",{className:"text-sm capitalize",children:h.replace(/([A-Z])/g," $1").trim()})]},h))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>J(g.id,g.permissions),className:"btn-primary flex-1",disabled:l,children:l?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>m(null),className:"btn-secondary",disabled:l,children:"Cancel"})]})]})}),f&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(Ut,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",f.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:ae,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(Ce,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${a.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:a.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(tt,{className:"w-4 h-4"}),"Last Activity: ",a.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(it,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(a.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(a.currentCart||[]).map((h,k)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[h.name," x",h.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",h.price.toLocaleString()]})]},k)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(a.currentCart||[]).reduce((h,k)=>h+k.price*k.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:a.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",a.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",a.salesCount>0?Math.round(a.totalSalesToday/a.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})}),x&&A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Reset PIN for ",A.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate a new 4-digit PIN for this cashier. The old PIN will be invalid."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"New PIN:"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-mono text-3xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:z})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>H(E()),className:"btn-secondary flex-1",disabled:l,children:"Generate New PIN"}),e.jsx("button",{onClick:Ie,className:"btn-primary flex-1",disabled:l,children:l?"Updating...":"Confirm & Update"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>{u(!1),B(null),H("")},className:"btn-secondary w-full",disabled:l,children:"Cancel"})})]})})]})}function oa(){const{user:t}=Ne(),[i,p]=s.useState([]),[j,l]=s.useState("all"),[r,o]=s.useState(!0);s.useEffect(()=>{c();const a=setInterval(c,3e4);return()=>clearInterval(a)},[]);const c=async()=>{try{o(!0);const a=await dt.getAll();Array.isArray(a)&&(p(a.reverse()),console.log(`âœ… Loaded ${a.length} clock records from backend`))}catch(a){console.error("Failed to load clock records:",a),p([])}finally{o(!1)}},g=new Date().toDateString(),m=j==="all"?i:i.filter(a=>{try{return new Date(a.date||a.clockInTime).toDateString()===g}catch{return!1}}),f=i.filter(a=>{try{return new Date(a.date||a.clockInTime).toDateString()===g&&a.duration}catch{return!1}}).reduce((a,I)=>a+(I.duration||0),0)/60,w=a=>{let I=typeof a=="number"?a<120?a:Math.floor(a/60):0;const b=Math.floor(I/60),v=I%60;return`${b}h ${v}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(tt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[f.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(Pt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers Today"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(i.filter(a=>{try{return new Date(a.date||a.clockInTime).toDateString()===new Date().toDateString()}catch{return!1}}).map(a=>a.cashierId||a.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(ht,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:i.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>l("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${j==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>l("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${j==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"}),e.jsx("button",{onClick:c,disabled:r,className:"px-4 py-2 rounded-lg text-sm font-medium bg-green-100 text-green-600 hover:bg-green-200 disabled:opacity-50",children:r?"Loading...":"Refresh"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"})]})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:r?"Loading records...":"No records found"})}):m.map((a,I)=>{const b=new Date(a.clockInTime),v=a.clockOutTime?new Date(a.clockOutTime):null;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:a.cashierName||a.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:b.toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:b.toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:v?v.toLocaleTimeString():"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:a.duration?w(a.duration):"-"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${a.status==="clocked_in"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a.status==="clocked_in"?"ðŸŸ¢ Clocked In":"âœ“ Clocked Out"})})]},I)})})]})})]})]})}function ca(){const{user:t,updateUser:i}=Ne();Je();const[p,j]=s.useState(!1),[l,r]=s.useState(t?.plan||"ultra"),[o,c]=s.useState({}),[g,m]=s.useState(null),[f,w]=s.useState(t?.profilePicture||null),[a,I]=s.useState(!0),[b,v]=s.useState(!0);s.useEffect(()=>{y()},[]);const y=async()=>{try{const L=await Ye.get();c(L),L.logo&&m(L.logo),I(L.cashierUserManagement!==!1),v(L.realTimeProductSync!==!1)}catch(L){console.error("Failed to load settings:",L)}},N=async L=>{try{const E={...o,...L};return await Ye.update(E),c(E),!0}catch(E){return console.error("Failed to save settings:",E),!1}},x=async()=>{const L=!a;I(L),await N({cashierUserManagement:L})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{cashierUserManagement:L}})),alert(`âœ… Cashier User Management ${L?"ENABLED":"DISABLED"}`)):(I(!L),alert("âŒ Failed to save setting. Please try again."))},u=async()=>{const L=!b;v(L),await N({realTimeProductSync:L})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{realTimeProductSync:L}})),alert(`âœ… Real-time Product Sync ${L?"ENABLED":"DISABLED"}`)):(v(!L),alert("âŒ Failed to save setting. Please try again."))},A=async L=>{const E=L.target.files[0];if(E){const U=new FileReader;U.onloadend=async()=>{const J=U.result;m(J);try{await Ye.update({...o,logo:J}),c({...o,logo:J})}catch(te){console.error("Failed to save logo:",te)}},U.readAsDataURL(E)}},B=async L=>{const E=L.target.files[0];if(E){const U=new FileReader;U.onloadend=async()=>{const J=U.result;w(J);try{await i({...t,profilePicture:J})}catch(te){console.error("Failed to save profile picture:",te)}},U.readAsDataURL(E)}},z=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],H=async()=>{const L=z.find(U=>U.id===l),E=l==="ultra"?"admin":"cashier";await i({...t,role:E,plan:l,price:L.price}),j(!1),setTimeout(()=>window.location.href=E==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Pt,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[f?e.jsx("img",{src:f,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:t?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(Ft,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:B})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Le,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>j(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(At,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(He,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cashier User Management"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Cashier User Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow cashiers to add and remove users"})]}),e.jsx("button",{onClick:x,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${a?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${a?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${a?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:a?"âœ… Cashiers can add and remove users when enabled":"âŒ Cashiers cannot add or remove users when disabled"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Ps,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Real-time Product Sync"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Real-time Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync products between admin and cashier dashboards"})]}),e.jsx("button",{onClick:u,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${b?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${b?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${b?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:b?"âœ… Products will sync in real-time across all dashboards":"âŒ Products will not sync automatically across dashboards"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(ut,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(As,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[g&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:g,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(Ft,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:A})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:z.map(L=>e.jsxs("div",{onClick:()=>r(L.id),className:`card cursor-pointer transition-all ${l===L.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:L.name}),l===L.id&&e.jsx(pt,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",L.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:L.features.map((E,U)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(pt,{className:"w-4 h-4 text-green-600"}),E]},U))})]},L.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:H,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>j(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function da(){const[t,i]=s.useState([]),[p,j]=s.useState(!1),[l,r]=s.useState(null),[o,c]=s.useState({name:"",amount:"",description:"",active:!0});s.useEffect(()=>{g()},[]);const g=()=>{const a=JSON.parse(localStorage.getItem("serviceFees")||"[]");i(a)},m=a=>{localStorage.setItem("serviceFees",JSON.stringify(a)),i(a)},f=a=>{if(a.preventDefault(),l){const I=t.map(b=>b.id===l.id?{...o,id:b.id}:b);m(I)}else{const I={...o,id:Date.now(),createdAt:new Date().toISOString()};m([...t,I])}j(!1),r(null),c({name:"",amount:"",description:"",active:!0})},w=a=>{confirm("Delete this service fee?")&&m(t.filter(I=>I.id!==a))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{j(!0),r(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(a=>e.jsxs("div",{className:`card ${a.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(ze,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500",children:a.description})]})]}),e.jsx("span",{className:`badge ${a.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:a.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",a.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{r(a),c(a),j(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(Ue,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>w(a.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(ye,{className:"w-4 h-4 text-red-600"})})]})]})]},a.id))}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[l?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:o.name,onChange:a=>c({...o,name:a.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:o.amount,onChange:a=>c({...o,amount:a.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:o.description,onChange:a=>c({...o,description:a.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.active,onChange:a=>c({...o,active:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>j(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function ma(){const[t,i]=s.useState([]),[p,j]=s.useState([]),[l,r]=s.useState(!1),[o,c]=s.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});s.useEffect(()=>{g(),m()},[]);const g=async()=>{try{const b=localStorage.getItem("token"),v=await fetch(`${ee}/reminders`,{headers:{Authorization:`Bearer ${b}`}});if(!v.ok){console.error("API Error:",v.status,v.statusText),i([]);return}const y=await v.json();Array.isArray(y)?i(y):(console.error("Expected array but got:",typeof y,y),i([]))}catch(b){console.error("Failed to fetch reminders:",b),i([])}},m=async()=>{try{const b=localStorage.getItem("token"),v=await fetch(`${ee}/products`,{headers:{Authorization:`Bearer ${b}`}});if(!v.ok){console.error("API Error:",v.status,v.statusText),j([]);return}const y=await v.json();Array.isArray(y)?j(y):(console.error("Expected array but got:",typeof y,y),j([]))}catch(b){console.error("Failed to fetch products:",b),j([])}},f=async b=>{b.preventDefault();try{const v=localStorage.getItem("token"),y=await fetch(`${ee}/reminders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`},body:JSON.stringify(o)});if(!y.ok){const x=await y.json();console.error("Failed to create reminder:",x),alert(`Failed to create reminder: ${x.error||"Unknown error"}`);return}const N=await y.json();c({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),r(!1),g(),alert("Reminder created successfully!")}catch(v){console.error("Failed to create reminder:",v),alert("Failed to create reminder. Please try again.")}},w=async b=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const y=localStorage.getItem("token"),N=await fetch(`${ee}/reminders/${b}`,{method:"DELETE",headers:{Authorization:`Bearer ${y}`}});if(!N.ok){const x=await N.json();console.error("Failed to delete reminder:",x),alert(`Failed to delete reminder: ${x.error||"Unknown error"}`);return}g(),alert("Reminder deleted successfully!")}catch(v){console.error("Failed to delete reminder:",v),alert("Failed to delete reminder. Please try again.")}},a=b=>{o.days.includes(b)?c({...o,days:o.days.filter(v=>v!==b)}):c({...o,days:[...o.days,b]})},I=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(At,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("button",{onClick:()=>r(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(pe,{size:20}),"New Reminder"]})]}),e.jsx("div",{className:"grid gap-4",children:t.map(b=>{const v=p.find(y=>y.id===b.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${b.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:b.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",v?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",b.frequency]}),b.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",b.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(ht,{size:16}),"Next: ",new Date(b.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${b.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:b.status}),e.jsx("button",{onClick:()=>w(b.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(ye,{size:20})})]})]})},b.id)})}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:o.customerName,onChange:b=>c({...o,customerName:b.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:o.productId,onChange:b=>c({...o,productId:parseInt(b.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),p.map(b=>e.jsx("option",{value:b.id,children:b.name},b.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:o.frequency,onChange:b=>c({...o,frequency:b.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),o.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(b=>e.jsx("button",{type:"button",onClick:()=>a(b),className:`px-4 py-2 rounded-lg font-medium transition ${o.days.includes(b)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:b},b))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:o.nextDate,onChange:b=>c({...o,nextDate:b.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>r(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})}function xa(){const[t,i]=s.useState([]),[p,j]=s.useState(!1),[l,r]=s.useState(null),[o,c]=s.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});s.useEffect(()=>{g()},[]);const g=async()=>{try{const a=await Ge.getAll();i(a)}catch(a){console.error("Failed to load discounts:",a)}},m=async a=>{a.preventDefault();try{l?await Ge.update(l.id,o):await Ge.create(o),j(!1),r(null),c({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),g()}catch(I){console.error("Failed to save discount:",I)}},f=async a=>{if(confirm("Delete this discount?"))try{await Ge.delete(a),g()}catch(I){console.error("Failed to delete discount:",I)}},w=a=>{const I=new Date,b=new Date(a.validFrom),v=new Date(a.validTo);return a.active&&b<=I&&v>=I};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{j(!0),r(null),c({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(a=>e.jsxs("div",{className:`card ${w(a)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${w(a)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(kt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[a.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${w(a)?"badge-success":"bg-gray-200 text-gray-600"}`,children:w(a)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ht,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(a.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ht,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(a.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{r(a),c(a),j(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(Ue,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>f(a.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(ye,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},a.id)),t.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(kt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[l?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:o.name,onChange:a=>c({...o,name:a.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:o.percentage,onChange:a=>c({...o,percentage:parseFloat(a.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:o.validFrom,onChange:a=>c({...o,validFrom:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:o.validTo,onChange:a=>c({...o,validTo:a.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.active,onChange:a=>c({...o,active:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>j(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function ua(){const[t,i]=s.useState([]),[p,j]=s.useState("all"),[l,r]=s.useState(null),[o,c]=s.useState(""),[g,m]=s.useState(!1),[f,w]=s.useState(null);s.useEffect(()=>{a();const u=setInterval(a,1e4);return()=>clearInterval(u)},[]);const a=async()=>{try{const u=await ct.getAll();i(u||[])}catch(u){console.error("Failed to load credit requests:",u)}},I=async u=>{r(u);try{await ct.update(u,{status:"approved"}),console.log("âœ… Credit request approved"),a()}catch(A){console.error("Failed to approve request:",A),alert("Failed to approve request: "+(A.message||"Unknown error"))}finally{r(null)}},b=u=>{w(u),m(!0)},v=async()=>{if(f){r(f.id);try{await ct.update(f.id,{status:"rejected",rejectionReason:o}),console.log("âœ… Credit request rejected"),m(!1),c(""),w(null),a()}catch(u){console.error("Failed to reject request:",u),alert("Failed to reject request: "+(u.message||"Unknown error"))}finally{r(null)}}},y=t.filter(u=>p==="all"?!0:u.status===p),N=u=>{switch(u){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},x=u=>{switch(u){case"pending":return e.jsx(tt,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(_e,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(ot,{className:"w-6 h-6 text-red-600"});default:return e.jsx(Le,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(u=>e.jsxs("button",{onClick:()=>j(u),className:`px-4 py-2 rounded-lg font-medium transition ${p===u?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[u.charAt(0).toUpperCase()+u.slice(1),u==="pending"&&t.filter(A=>A.status==="pending").length>0&&e.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1",children:t.filter(A=>A.status==="pending").length})]},u))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[y.map(u=>e.jsx("div",{className:`card border-l-4 ${N(u.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${u.status==="pending"?"bg-orange-600":u.status==="approved"?"bg-green-600":"bg-red-600"}`,children:x(u.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:u.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Requested by: ",u.cashierName]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",u.amount?.toLocaleString()]})]}),u.reason&&e.jsxs("span",{children:["Reason: ",e.jsx("strong",{children:u.reason.replace(/_/g," ")})]})]}),u.notes&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Notes: ",u.notes]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(u.createdAt).toLocaleString()]}),u.approvalDate&&e.jsxs("p",{className:"text-xs text-gray-500",children:[u.status==="approved"?"Approved":"Processed",": ",new Date(u.approvalDate).toLocaleString(),u.approvedBy&&` by ${u.approvedBy}`]}),u.rejectionReason&&e.jsxs("p",{className:"text-xs text-red-600 mt-2",children:["Rejection reason: ",u.rejectionReason]})]})]}),u.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>I(u.id),disabled:l===u.id,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition disabled:opacity-50",children:[e.jsx(_e,{size:16}),l===u.id?"Approving...":"Approve"]}),e.jsxs("button",{onClick:()=>b(u),disabled:l===u.id,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition disabled:opacity-50",children:[e.jsx(ot,{size:16}),l===u.id?"Rejecting...":"Reject"]})]}),u.status!=="pending"&&e.jsx("span",{className:`badge ${u.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:u.status.toUpperCase()})]})},u.id)),y.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(Le,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",p!=="all"?p:""," credit requests found."]})]})]}),g&&f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-red-500 to-red-600 p-6 text-white flex items-center gap-3",children:[e.jsx(Ze,{className:"w-6 h-6"}),e.jsx("h3",{className:"text-xl font-bold",children:"Reject Credit Request"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Are you sure you want to reject this credit request from ",e.jsx("strong",{children:f.customerName})," for ",e.jsxs("strong",{children:["KSH ",f.amount?.toLocaleString()]}),"?"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Rejection Reason"}),e.jsx("textarea",{placeholder:"Enter reason for rejection...",value:o,onChange:u=>c(u.target.value),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-red-500",rows:"4"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:v,disabled:l!==null,className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-bold transition disabled:opacity-50",children:l?"Rejecting...":"Confirm Rejection"}),e.jsx("button",{onClick:()=>{m(!1),c(""),w(null)},disabled:l!==null,className:"flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400 transition disabled:opacity-50",children:"Cancel"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[y.map(u=>e.jsx("div",{className:`card border-l-4 ${N(u.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${u.status==="pending"?"bg-orange-600":u.status==="approved"?"bg-green-600":"bg-red-600"}`,children:x(u.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:u.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:getProductName(u.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:u.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",u.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(u.createdAt).toLocaleString()]}),u.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(u.approvedAt).toLocaleString()]})]})]}),u.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>I(u.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(_e,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>handleReject(u.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(ot,{size:16}),"Reject"]})]}),u.status!=="pending"&&e.jsx("span",{className:`badge ${u.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:u.status.toUpperCase()})]})},u.id)),y.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(Le,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",p!=="all"?p:""," credit requests found."]})]})]})]})}function ha(){const[t,i]=s.useState([]),[p,j]=s.useState(!0),[l,r]=s.useState(!1),[o,c]=s.useState(null),[g,m]=s.useState(""),[f,w]=s.useState({name:"",email:"",phone:"",address:"",city:"",country:"",products:""});s.useEffect(()=>{a()},[]);const a=async()=>{try{j(!0);const x=localStorage.getItem("token"),u=await fetch(`${ee}/vendors`,{headers:{Authorization:`Bearer ${x}`}});if(u.ok){const A=await u.json();i(Array.isArray(A)?A:[])}}catch(x){console.error("Failed to load vendors:",x),i([])}finally{j(!1)}},I=()=>{c(null),w({name:"",email:"",phone:"",address:"",city:"",country:"",products:""}),r(!0)},b=x=>{c(x),w(x),r(!0)},v=async x=>{if(window.confirm("Are you sure you want to delete this vendor?"))try{const u=localStorage.getItem("token");(await fetch(`${ee}/vendors/${x}`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`}})).ok?(i(t.filter(B=>B.id!==x)),alert("Vendor deleted successfully")):alert("Failed to delete vendor")}catch(u){console.error("Failed to delete vendor:",u),alert("Failed to delete vendor")}},y=async x=>{x.preventDefault();try{const u=localStorage.getItem("token"),A=o?"PUT":"POST",B=o?`${ee}/vendors/${o.id}`:`${ee}/vendors`,z=await fetch(B,{method:A,headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(z.ok){const H=await z.json();i(o?t.map(L=>L.id===H.id?H:L):[...t,H]),r(!1),alert(o?"Vendor updated":"Vendor added")}else alert("Failed to save vendor")}catch(u){console.error("Failed to save vendor:",u),alert("Failed to save vendor")}},N=t.filter(x=>x.name?.toLowerCase().includes(g.toLowerCase())||x.email?.toLowerCase().includes(g.toLowerCase()));return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Vendors"}),e.jsxs("button",{onClick:I,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(pe,{className:"w-5 h-5"}),"Add Vendor"]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(yt,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search vendors...",value:g,onChange:x=>m(x.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"})]})}),p?e.jsx("div",{className:"text-center py-8",children:"Loading vendors..."}):N.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["No vendors found. ",t.length===0&&"Add your first vendor to get started."]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map(x=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:x.name}),e.jsx("p",{className:"text-sm text-gray-500",children:x.products})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(x),className:"p-2 text-blue-600 hover:bg-blue-50 rounded",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>v(x.id),className:"p-2 text-red-600 hover:bg-red-50 rounded",children:e.jsx(ye,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[x.email&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(gt,{className:"w-4 h-4"}),e.jsx("a",{href:`mailto:${x.email}`,children:x.email})]}),x.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Is,{className:"w-4 h-4"}),e.jsx("a",{href:`tel:${x.phone}`,children:x.phone})]}),x.address&&e.jsxs("div",{className:"flex items-start gap-2 text-gray-600",children:[e.jsx(Ds,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[x.address,x.city&&`, ${x.city}`,x.country&&`, ${x.country}`]})]})]})]},x.id))}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:o?"Edit Vendor":"Add Vendor"}),e.jsx("button",{onClick:()=>r(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(Ce,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vendor Name *"}),e.jsx("input",{type:"text",required:!0,value:f.name,onChange:x=>w({...f,name:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g., ABC Supplies"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Products/Services"}),e.jsx("input",{type:"text",value:f.products,onChange:x=>w({...f,products:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g., Vegetables, Fruits"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:f.email,onChange:x=>w({...f,email:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"vendor@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:f.phone,onChange:x=>w({...f,phone:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"+1 (555) 000-0000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("input",{type:"text",value:f.address,onChange:x=>w({...f,address:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Street address"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",value:f.city,onChange:x=>w({...f,city:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"City"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Country"}),e.jsx("input",{type:"text",value:f.country,onChange:x=>w({...f,country:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Country"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),className:"flex-1 px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"flex-1 px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700",children:[o?"Update":"Add"," Vendor"]})]})]})]})})]})}function ns({onClose:t}){const[i,p]=s.useState([]),[j,l]=s.useState(!0),r=s.useRef({data:null,timestamp:null}),o=3e4;s.useEffect(()=>{c()},[]);const c=async()=>{try{const m=Date.now();if(r.current.data&&r.current.timestamp&&m-r.current.timestamp<o){console.log("ðŸ“¦ Using cached reminders"),p(r.current.data),l(!1);return}const f=localStorage.getItem("token"),w=await fetch(`${ee}/reminders/today`,{headers:{Authorization:`Bearer ${f}`}});if(!w.ok){console.error("API Error:",w.status,w.statusText),p([]),l(!1);return}const a=await w.json();Array.isArray(a)?(r.current.data=a,r.current.timestamp=Date.now(),p(a)):(console.error("Expected array but got:",typeof a,a),p([]))}catch(m){console.error("Failed to fetch reminders:",m),p([])}finally{l(!1)}},g=async m=>{try{const f=localStorage.getItem("token");await fetch(`${ee}/reminders/${m}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`},body:JSON.stringify({status:"fulfilled"})}),r.current={data:null,timestamp:null},c()}catch(f){console.error("Failed to update reminder:",f)}};return j?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:t,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(Ce,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ze,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):i.map(m=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:m.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",m.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:m.frequency})]}),e.jsxs("button",{onClick:()=>g(m.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(_e,{size:18}),"Mark Done"]})]},m.id))})]})})}function is({onUnlock:t,userType:i="user"}){const[p,j]=s.useState(""),[l,r]=s.useState(""),[o,c]=s.useState("password"),[g,m]=s.useState(!1),[f,w]=s.useState(""),[a,I]=s.useState(!1),[b,v]=s.useState("2005"),y=JSON.parse(localStorage.getItem("user")||"{}");s.useEffect(()=>{(async()=>{try{const A=await Ye.get();A?.screenLockPassword&&v(A.screenLockPassword)}catch(A){console.warn("Failed to load settings, using default password:",A)}})()},[]),s.useEffect(()=>{const u=document.getElementById(o==="password"?"unlock-password":"unlock-pin");u&&u.focus()},[o]);const N=async u=>{u.preventDefault(),u.stopPropagation(),I(!0),w("");try{const A=localStorage.getItem("token");if(!A)throw new Error("No authentication token found");const B=await fetch("https://posifine22.onrender.com/api/auth/unlock-screen",{method:"POST",headers:{Authorization:`Bearer ${A}`,"Content-Type":"application/json"},body:JSON.stringify({pin:l})});if(!B.ok){const H=await B.json();throw B.status===429?new Error(H.message||"Too many failed attempts. Try again later."):B.status===401?new Error(H.message||"Incorrect PIN"):new Error(H.message||"Unlock failed")}const z=await B.json();z.token&&localStorage.setItem("token",z.token),r(""),j(""),t(z)}catch(A){w(A.message||"Unlock failed")}finally{I(!1)}},x=u=>{const A=u.replace(/\D/g,"").slice(0,4);r(A)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:u=>u.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${i==="main_admin"?"bg-gradient-to-br from-red-600 to-orange-600":"bg-gradient-to-br from-blue-600 to-purple-600"}`,children:e.jsx(he,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-gray-600",children:i==="main_admin"?"Main Admin":y.name||"User"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Enter your ",o," to continue"]})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter PIN to unlock"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",id:"unlock-pin",value:l,onChange:u=>x(u.target.value),placeholder:"0000",maxLength:"4",className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-center tracking-widest text-2xl",disabled:a})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"ðŸ”’ PIN validated securely on server"})]}),f&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-red-700 text-sm font-medium",children:[f.includes("Too many")?"âŒ ":"âš ï¸ ",f]})}),e.jsx("button",{type:"submit",disabled:a||l.length<4,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 rounded-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"}),"Verifying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-5 h-5"}),"Unlock Screen"]})})]})]})})}function os(t=6e4){const[i,p]=s.useState(!1),j=s.useRef(Date.now()),l=s.useCallback(()=>{j.current=Date.now(),p(!1)},[]),r=s.useCallback(()=>{p(!1),j.current=Date.now()},[]);return s.useEffect(()=>{const o=["mousedown","mousemove","keypress","scroll","touchstart","click"],c=()=>{j.current=Date.now(),i&&p(!1)};o.forEach(m=>{document.addEventListener(m,c,!0)});const g=setInterval(()=>{Date.now()-j.current>t&&!i&&p(!0)},5e3);return()=>{o.forEach(m=>{document.removeEventListener(m,c,!0)}),clearInterval(g)}},[t,i]),[i,r,l]}function pa(){const{user:t,logout:i,isCashierUserManagementEnabled:p}=Ne(),j=Je(),l=zt(),[r,o]=s.useState(!0),[c,g]=s.useState(!1),[m,f]=s.useState({}),[w,a]=os(45e3);s.useEffect(()=>{const N=()=>{const u=localStorage.getItem("user");if(u){const A=JSON.parse(u);let B=!1;(A.plan==="ultra"||A.role==="admin")&&(A.active||(A.active=!0,B=!0),A.plan==="ultra"&&A.role!=="admin"&&(A.role="admin",B=!0),A.plan==="ultra"&&(!A.price||A.price!==1600)&&(A.price=1600,B=!0),B&&(localStorage.setItem("user",JSON.stringify(A)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};N(),setTimeout(N,100);const x=setTimeout(()=>{g(!0)},1e3);return I(),()=>clearTimeout(x)},[]);const I=async()=>{try{const N=await Ye.get();f(N)}catch(N){console.error("Failed to load settings:",N)}},b=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses data? This action cannot be undone."))try{const N=localStorage.getItem("token"),u=await fetch(`${ee}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!u.ok){const A=await u.json();throw new Error(A.message||"Failed to clear data")}alert("Data cleared successfully!"),window.location.reload()}catch(N){console.error("Failed to clear data:",N),alert("Failed to clear data: "+N.message)}},v=[{id:"overview",label:"Dashboard",icon:Ts,path:"/admin"},{id:"sales",label:"Sales",icon:Jt,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:Oe,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:Gt,path:"/admin/recipes"},{id:"expenses",label:"Expenses",icon:xt,path:"/admin/expenses"},{id:"vendors",label:"Vendors",icon:Es,path:"/admin/vendors"},...p()?[{id:"users",label:"Users",icon:He,path:"/admin/users"}]:[],{id:"time",label:"Time Tracking",icon:tt,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:At,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:ze,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:kt,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:Le,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:$s,path:"/admin/settings"}],y=N=>N==="/admin"?l.pathname==="/admin":l.pathname.startsWith(N);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${r?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[r&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>o(!r),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r?e.jsx(Ce,{className:"w-5 h-5"}):e.jsx(Ls,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:v.map(N=>{const x=N.icon;return e.jsxs("button",{onClick:()=>j(N.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${y(N.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(x,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:N.label})]},N.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(Os,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:i,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(It,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Logout"})]}),e.jsxs("button",{onClick:b,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors",children:[e.jsx(Ce,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Clear Data"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:v.find(N=>y(N.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:t?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(Ht,{children:[e.jsx(Z,{path:"/",element:e.jsx(ea,{})}),e.jsx(Z,{path:"/sales",element:e.jsx(la,{})}),e.jsx(Z,{path:"/inventory",element:e.jsx(aa,{})}),e.jsx(Z,{path:"/recipes",element:e.jsx(ra,{})}),e.jsx(Z,{path:"/expenses",element:e.jsx(na,{})}),e.jsx(Z,{path:"/vendors",element:e.jsx(ha,{})}),e.jsx(Z,{path:"/reminders",element:e.jsx(ma,{})}),e.jsx(Z,{path:"/service-fees",element:e.jsx(da,{})}),e.jsx(Z,{path:"/discounts",element:e.jsx(xa,{})}),e.jsx(Z,{path:"/credit-requests",element:e.jsx(ua,{})}),e.jsx(Z,{path:"/users",element:e.jsx(ia,{})}),e.jsx(Z,{path:"/time",element:e.jsx(oa,{})}),e.jsx(Z,{path:"/settings",element:e.jsx(ca,{})})]})})]}),c&&e.jsx(ns,{onClose:()=>g(!1)}),w&&e.jsx(is,{onUnlock:a,logo:m.logo})]})}function ga(){const t=Je(),[i,p]=s.useState(!1),[j,l]=s.useState(0),r=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 1,600 - 1 Cashier) or Ultra (KSH 3,000 - Unlimited) package",image:"ðŸ“",details:"First user becomes Admin automatically. Basic supports 1 cashier. Ultra supports unlimited cashiers with full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],o=[{icon:Oe,title:"Smart Inventory",desc:"Track raw materials & composite products with automatic stock deduction"},{icon:Gt,title:"Recipe Builder",desc:"Create bundled products with BOM and auto-calculate COGS"},{icon:Qe,title:"Real-time Analytics",desc:"Monitor sales, profit margins, and expenses in real-time"},{icon:He,title:"User Management",desc:"Add cashiers with custom permissions and role-based access"},{icon:ut,title:"Secure & Reliable",desc:"JWT authentication with role-based security"},{icon:Ct,title:"Advanced Reports",desc:"Daily, weekly summaries with profit/loss tracking"}],c=[{name:"Ultra",price:3e3,icon:Yt,popular:!0,features:["Admin + Cashier Dashboard","Full Inventory Management","Recipe/BOM Builder","Auto Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Unlimited Cashiers","Priority Support"]},{name:"Basic",price:1600,icon:Zt,popular:!1,features:["Cashier Dashboard","Basic Inventory","Sales Tracking","Daily/Weekly Reports","Basic Profit/Loss View","Email Support","1 Cashier Only"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/auth/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(Us,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(lt,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>p(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(Qt,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 30-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ct,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:o.map((g,m)=>{const f=g.icon;return e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(f,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:g.title}),e.jsx("p",{className:"text-gray-600",children:g.desc})]},m)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:c.map((g,m)=>{const f=g.icon;return e.jsxs("div",{className:`relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${g.popular?"ring-4 ring-blue-600":""}`,children:[g.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${g.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(f,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:g.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",g.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:g.features.map((w,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(pt,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:w})]},a))}),e.jsx("button",{onClick:()=>t("/plans"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${g.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},m)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(lt,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{p(!1),l(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Ce,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",j+1," of ",r.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((j+1)/r.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(j+1)/r.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:r[j].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:r[j].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:r[j].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:r[j].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>l(Math.max(0,j-1)),disabled:j===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),j<r.length-1?e.jsxs("button",{onClick:()=>l(j+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(lt,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{p(!1),l(0),t("/plans")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(lt,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:r.map((g,m)=>e.jsx("button",{onClick:()=>l(m),className:`w-2 h-2 rounded-full transition-all ${m===j?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},m))})]})]})})]})}function _t(){const t=zt(),[i,p]=s.useState(t.pathname==="/auth/login"),[j,l]=s.useState("password"),[r,o]=s.useState({email:"",password:"",pin:"",name:"",newPassword:"",confirmPassword:""}),[c,g]=s.useState(""),[m,f]=s.useState(!1),[w,a]=s.useState(!1),I=Je(),{login:b}=Ne(),v=()=>{try{return JSON.parse(localStorage.getItem("selectedPlan")||"null")}catch(N){return console.warn("Invalid selectedPlan in localStorage:",N),null}},y=async N=>{N.preventDefault(),g(""),f(!0);try{if(w){if(r.newPassword!==r.confirmPassword){g("Passwords do not match"),f(!1);return}if(r.newPassword.length<6){g("Password must be at least 6 characters"),f(!1);return}const z=await Be.login({email:r.email,newPassword:r.newPassword});z.token&&z.user&&(await b(z),I("/dashboard"));return}if(i){if(j==="pin"){if(!r.pin||r.pin.length!==4){g("Please enter a valid 4-digit PIN"),f(!1);return}}else if(!r.password){g("Please enter your password"),f(!1);return}}let x;if(i)if(j==="pin")try{x=await Be.pinLogin({email:r.email,pin:r.pin})}catch(z){if(z.message.includes("PIN not set"))g("PIN not set for this user. Please use password login.");else if(z.message.includes("Invalid PIN"))g("Invalid PIN. Please try again.");else throw z;f(!1);return}else x=await Be.login({email:r.email,password:r.password});else{const z=v(),H=localStorage.getItem("planId")||z?.id||"basic";x=await Be.signup({...r,planId:H})}if(x.needsPasswordSetup){a(!0),o({...r,email:x.email}),g(""),f(!1);return}if(!x||!x.user||!x.token)throw new Error("Authentication failed. Please try again.");const u={id:Date.now(),type:i?"login":"signup",user:{id:x.user.id,name:x.user.name,email:x.user.email,role:x.user.role,plan:x.user.plan},timestamp:new Date().toISOString(),ip:"Unknown",userAgent:navigator.userAgent},A=JSON.parse(localStorage.getItem("authActivities")||"[]");A.unshift(u),A.splice(50),localStorage.setItem("authActivities",JSON.stringify(A)),await b(x);const B=i?"logged in":"signed up";console.log(`âœ… User ${x.user.name} ${B} successfully`),x.user.role==="admin"?I("/admin"):x.user.role==="cashier"||x.user.plan==="basic"?I("/dashboard/cashier"):I("/admin")}catch(x){console.error("Authentication error:",x);let u=x.message||"Authentication failed. Please try again.";x.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),u="Invalid credentials. Please try again."),g(u)}finally{f(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:i?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600",children:i?"Login to your account":"Create your account"})]}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[w?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.newPassword,onChange:N=>o({...r,newPassword:N.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.confirmPassword,onChange:N=>o({...r,confirmPassword:N.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!i&&e.jsxs("div",{className:"relative",children:[e.jsx(Pt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.name,onChange:N=>o({...r,name:N.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(gt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.email,onChange:N=>o({...r,email:N.target.value}),required:!0})]}),i&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Login Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>l("password"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${j==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Password"}),e.jsx("button",{type:"button",onClick:()=>l("pin"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${j==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"pin"})]})]}),i&&j==="password"&&e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.password,onChange:N=>o({...r,password:N.target.value}),required:!0})]}),i&&j==="pin"&&e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.pin,onChange:N=>o({...r,pin:N.target.value.replace(/\D/g,"").slice(0,4)}),maxLength:4,required:!0})]}),!i&&e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.password,onChange:N=>o({...r,password:N.target.value}),required:!0})]})]}),c&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:c}),e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50",children:m?"Please wait...":w?"Set Password":i?"Login":"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{p(!i),g(""),a(!1)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:i?"Don't have an account? Sign up":"Already have an account? Login"})})]})})}function fa(){const[t,i]=s.useState("ultra"),[p,j]=s.useState(!1),[l,r]=s.useState({name:"",email:"",company:""}),o=Je(),c=[{id:"ultra",name:"Ultra Package (Unlimited)",price:3e3,icon:Yt,color:"from-blue-600 to-purple-600",popular:!0,features:["Admin Dashboard + Cashier POS","Full Inventory Management","Recipe/BOM Builder","Composite Products Support","Automatic Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Advanced Analytics","Unlimited Cashiers","Priority Support"]},{id:"basic",name:"Basic Package",price:1600,icon:Zt,color:"from-green-500 to-teal-600",popular:!1,features:["Admin Dashboard + Cashier POS","Basic Inventory Management","Sales Tracking","Daily/Weekly Sales Summaries","Basic Profit/Loss View","Email Notifications","Record Products Sold","1 Cashier Only"]}],g=async m=>{m.preventDefault();try{await fetch(`${ee}/demo-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),alert("Demo request submitted! Admin will review and contact you."),j(!1),r({name:"",email:"",company:""})}catch(f){console.error("Demo request failed:",f),alert("Failed to submit demo request. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:()=>o("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition",children:[e.jsx(Fs,{size:20}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mb-8 md:mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Select the perfect plan for your business needs"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6 md:mb-8",children:c.map(m=>{const f=m.icon;return e.jsxs("div",{onClick:()=>i(m.id),className:`card cursor-pointer transition-all transform hover:scale-105 relative ${t===m.id?"ring-4 ring-blue-600 shadow-2xl bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-xl"}`,children:[m.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 md:mb-4",children:[e.jsx("div",{className:`w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br ${m.color} flex items-center justify-center`,children:e.jsx(f,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:m.name})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("span",{className:"text-3xl md:text-4xl font-bold",children:["KSH ",m.price]}),e.jsx("span",{className:"text-gray-600 text-sm md:text-base",children:"/month"})]}),e.jsx("ul",{className:"space-y-2 md:space-y-3",children:m.features.map((w,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(pt,{className:"w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs md:text-sm",children:w})]},a))})]},m.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center animate-fade-in",children:[e.jsx("button",{onClick:()=>{console.log("Get Started clicked with plan:",t);const m=c.find(f=>f.id===t);console.log("Selected plan:",m),localStorage.setItem("selectedPlan",JSON.stringify(m)),o("/auth/signup")},className:"btn-primary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all",children:"Get Started"}),e.jsx("button",{onClick:()=>j(!0),className:"btn-secondary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg border-2 border-gray-300 hover:border-gray-400 transition-all",children:"Request Free Demo"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-3 md:mt-4 text-center",children:"Secure payment â€¢ Cancel anytime"}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Free Demo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"We'll contact you to schedule a demo"})]}),e.jsxs("form",{onSubmit:g,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:l.name,onChange:m=>r({...l,name:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:l.email,onChange:m=>r({...l,email:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:l.company,onChange:m=>r({...l,company:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition",children:"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>j(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})})}function ba({isLocked:t,onUnlock:i,userPin:p,userName:j="Cashier"}){const[l,r]=s.useState(""),[o,c]=s.useState(""),[g,m]=s.useState(0),[f,w]=s.useState(!1);s.useEffect(()=>{t&&(c(""),r(""),m(0),w(!1))},[t]),s.useEffect(()=>{g>=3&&(w(!0),setTimeout(()=>{w(!1),m(0)},3e4))},[g]);const a=v=>{f||l.length<4&&(r(y=>y+v),c(""))},I=()=>{f||(r(v=>v.slice(0,-1)),c(""))},b=()=>{if(f){c("Too many attempts. Please wait.");return}if(l.length!==4){c("PIN must be 4 digits");return}String(l)===String(p)?(r(""),c(""),i()):(c("Incorrect PIN"),m(v=>v+1),r(""))};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[9999] backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-96 max-w-full mx-4",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"bg-red-100 p-4 rounded-full",children:e.jsx(he,{className:"w-12 h-12 text-red-600"})})}),e.jsx("h1",{className:"text-2xl font-bold text-center text-gray-800 mb-2",children:"Screen Locked"}),e.jsxs("p",{className:"text-center text-gray-600 mb-6",children:[j,", enter your PIN to continue"]}),e.jsx("div",{className:"bg-gray-100 rounded-lg p-4 mb-6 flex justify-center gap-2",children:[0,1,2,3].map(v=>e.jsx("div",{className:"w-12 h-12 bg-white border-2 border-gray-300 rounded-lg flex items-center justify-center font-bold text-xl text-gray-800",children:l[v]?"â—":""},v))}),o&&e.jsxs("div",{className:`text-center text-sm font-medium mb-4 p-2 rounded ${o.includes("Incorrect")?"bg-red-100 text-red-700":o.includes("must be")?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[o,g>0&&g<3&&e.jsxs("p",{className:"text-xs mt-1",children:[3-g," attempt",3-g!==1?"s":""," remaining"]}),f&&e.jsx("p",{className:"text-xs mt-1",children:"Locked. Try again in 30 seconds."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[[1,2,3,4,5,6,7,8,9].map(v=>e.jsx("button",{onClick:()=>a(String(v)),disabled:f||l.length>=4,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors text-lg",children:v},v)),e.jsx("button",{onClick:()=>a("0"),disabled:f||l.length>=4,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors col-span-1 text-lg",children:"0"}),e.jsxs("button",{onClick:I,disabled:f||l.length===0,className:"bg-red-500 hover:bg-red-600 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors col-span-2 flex items-center justify-center gap-2",children:[e.jsx(Ce,{size:16}),"Back"]})]}),e.jsx("button",{onClick:b,disabled:f||l.length!==4,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors mb-3",children:f?"Locked":"Unlock"}),e.jsx("p",{className:"text-center text-xs text-gray-500 mt-4",children:"Enter your 4-digit PIN"})]})}):null}function ya(){const{user:t,logout:i}=Ne(),{products:p,refreshProducts:j}=Dt(),{isLocked:l,lock:r,unlock:o}=ls(),[c,g]=s.useState([]),[m,f]=s.useState([]),[w,a]=s.useState([]),[I,b]=s.useState("cash"),[v,y]=s.useState("pos"),[N,x]=s.useState({sales:[],expenses:[],stats:{}}),[u,A]=s.useState(""),[B,z]=s.useState(!1),[H,L]=s.useState(!1),[E,U]=s.useState(null),[J,te]=s.useState({name:"",price:"",cost:"",category:"finished",image:""}),[se,ge]=s.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[de,je]=s.useState(!1),[Ie,me]=s.useState(!1),[ae,xe]=s.useState({customerName:"",amount:"",reason:"",notes:""}),[S,h]=s.useState(!1),[k,D]=s.useState({description:"",amount:"",category:""}),[O,_]=s.useState(""),[F,Y]=s.useState([]),[M,Pe]=s.useState(null),[re,Fe]=s.useState("exclusive"),[X,De]=s.useState(!1),[Tt,Re]=s.useState(null),[st,Te]=s.useState(null),[We,at]=s.useState({}),[Ke,qe]=s.useState(!1),[Et,rt]=s.useState(!1),[$t,ve]=s.useState(!1),[d,C]=s.useState(Date.now()),[R,V]=s.useState(0);s.useEffect(()=>{we(),j();const n=localStorage.getItem(`cart_${t?.id}`),P=localStorage.getItem(`paymentMethod_${t?.id}`),T=localStorage.getItem(`selectedDiscount_${t?.id}`),q=localStorage.getItem(`taxType_${t?.id}`);if(n)try{a(JSON.parse(n))}catch(K){console.warn("Failed to restore cart:",K)}if(P&&b(P),q&&Fe(q),T)try{Pe(JSON.parse(T))}catch{}ke();const W=localStorage.getItem("token");W&&Se.connect(W,K=>{if(console.log("ðŸ“¡ WebSocket callback received:",K),K&&K.allProducts){console.log(`ðŸ“¦ Merging ${K.allProducts.length} products from WebSocket`);const Q=K.allProducts.filter(ue=>ue.visibleToCashier!==!1&&!ue.expenseOnly);g(Q)}K&&K.productId!==void 0&&K.newQuantity!==void 0&&(console.log(`ðŸ“¦ Stock update for product ${K.productId}: ${K.newQuantity}${K.unit||""}`),g(Q=>Q.map(fe=>fe.id===K.productId?{...fe,quantity:K.newQuantity}:fe))),K&&K.discounts&&(console.log("ðŸ“Š Discount list updated"),Y(K.discounts)),K&&K.sale&&(console.log("ðŸ’° Sale detected, reloading stats"),we())}).catch(K=>{console.warn("âš ï¸ WebSocket connection failed:",K)});const ne=Bt(K=>{try{if(!K)return;console.log("ðŸ“¨ Product subscription message:",K.type),(K.type==="initial"||K.type==="products_snapshot"||K.type==="product_created"||K.type==="product_updated"||K.type==="product_deleted")&&ce.getAll().then(Q=>{const ue=Q.filter(fe=>fe.visibleToCashier!==!1&&!fe.expenseOnly);console.log(`âœ… Subscription update: ${ue.length} products`),g(ue)}).catch(Q=>{console.error("Failed to fetch products from subscription:",Q)})}catch(Q){console.error("âŒ Product subscription handler error",Q)}}),Me=setInterval(()=>{console.log("ðŸ”„ Auto-refreshing products..."),rt(!0),j().finally(()=>rt(!1))},3e4);return()=>{clearInterval(Me);try{ne()}catch{}Se.disconnect()}},[t?.id]),s.useEffect(()=>{if(p){const n=p.filter(P=>P.visibleToCashier!==!1&&!P.expenseOnly&&!P.pendingDelete);g(n),C(Date.now()),V(P=>P+1)}},[p]),s.useEffect(()=>{const n=localStorage.getItem("token");n&&Se.connect(n,T=>{if(console.log("ðŸ“¡ WebSocket callback received:",T),T&&T.allProducts){console.log(`ðŸ“¦ Merging ${T.allProducts.length} products from WebSocket`);const q=T.allProducts.filter(W=>W.visibleToCashier!==!1&&!W.expenseOnly);g(q)}T&&T.productId!==void 0&&T.newQuantity!==void 0&&(console.log(`ðŸ“¦ Stock update for product ${T.productId}: ${T.newQuantity}${T.unit||""}`),g(q=>q.map(ne=>ne.id===T.productId?{...ne,quantity:T.newQuantity}:ne))),T&&T.discounts&&(console.log("ðŸ“Š Discount list updated"),Y(T.discounts)),T&&T.sale&&(console.log("ðŸ’° Sale detected, reloading stats"),we())}).catch(T=>{console.warn("âš ï¸ WebSocket connection failed:",T)});const P=Bt(T=>{try{if(!T)return;console.log("ðŸ“¨ Product subscription message:",T.type),(T.type==="initial"||T.type==="products_snapshot"||T.type==="product_created"||T.type==="product_updated"||T.type==="product_deleted")&&ce.getAll().then(q=>{const W=q.filter(ne=>ne.visibleToCashier!==!1&&!ne.expenseOnly);console.log(`âœ… Subscription update: ${W.length} products`),g(W)}).catch(q=>{console.error("Failed to fetch products from subscription:",q)})}catch(q){console.error("âŒ Product subscription handler error",q)}});return()=>{try{P()}catch{}Se.disconnect()}},[]),s.useEffect(()=>{(w.length>0||I||re)&&G()},[w,I,re,M,t?.id]);const G=()=>{localStorage.setItem(`cart_${t?.id}`,JSON.stringify(w)),localStorage.setItem(`paymentMethod_${t?.id}`,I),localStorage.setItem(`taxType_${t?.id}`,re),M&&localStorage.setItem(`selectedDiscount_${t?.id}`,JSON.stringify(M))},le=async()=>{try{ve(!0);const n=await dt.create("clock_in");Re(n),De(!0);const P=new Date(n.clockInTime);Te(P),localStorage.setItem(`clockIn_${t?.id}_${new Date().toDateString()}`,P.toISOString()),console.log("âœ… Clocked in successfully"),alert("âœ… Clocked in successfully at "+P.toLocaleTimeString())}catch(n){console.error("Clock in failed:",n),alert("âŒ Clock in failed: "+(n.message||"Unknown error"))}finally{ve(!1)}},Ae=async()=>{try{ve(!0);const n=await dt.create("clock_out");Re(n),De(!1),Te(null),localStorage.removeItem(`clockIn_${t?.id}_${new Date().toDateString()}`),console.log("âœ… Clocked out successfully");const P=n.duration?`${n.duration} minutes`:"unknown duration";alert("âœ… Clocked out successfully. Duration: "+P)}catch(n){console.error("Clock out failed:",n),alert("âŒ Clock out failed: "+(n.message||"Unknown error"))}finally{ve(!1)}},ke=async()=>{try{const n=await dt.getStatus();n.isClockedIn?(De(!0),Te(new Date(n.clockInTime)),Re(n),console.log("âœ… User is clocked in since:",n.clockInTime)):(De(!1),Te(null),Re(null),console.log("User is not clocked in"))}catch(n){console.warn("Failed to check clock status:",n),De(!1),Te(null)}},we=async()=>{try{const[n,P,T,q,W,ne]=await Promise.all([ce.getAll(),et.getAll(),ft.getAll(),ts.get(),bt.getAll(),Ge.getAll().catch(()=>[])]);g(n.filter(Me=>Me.visibleToCashier!==!1&&!Me.expenseOnly)),x({sales:P,expenses:T,stats:q}),f(W),Y(ne||[])}catch(n){console.error("Failed to load data:",n)}},jt=(n,P=!0)=>{const T=n.target.files[0];if(T){const q=new FileReader;q.onload=W=>{const ne=W.target.result;_(ne),P&&te({...J,image:ne})},q.readAsDataURL(T)}},Ee=n=>m.filter(T=>T.productId===n&&T.quantity>0).reduce((T,q)=>T+q.quantity,0),cs=n=>{const P=Ee(n.id);if(P<=0){alert("Product is out of stock!");return}const T=w.find(W=>W.id===n.id);if((T?T.quantity:0)>=P){alert(`Only ${P} units available in stock!`);return}a(T?w.map(W=>W.id===n.id?{...W,quantity:W.quantity+1}:W):[...w,{...n,quantity:1}])},Nt=(n,P)=>{c.find(q=>q.id===n);const T=Ee(n);a(w.map(q=>{if(q.id===n){const W=q.quantity+P;return W>T?(alert(`Only ${T} units available!`),q):{...q,quantity:Math.max(1,W)}}return q}).filter(q=>q.quantity>0))},ds=n=>{a(w.filter(P=>P.id!==n))},ie=w.reduce((n,P)=>n+P.price*P.quantity,0),ms=async()=>{if(!(w.length===0||Ke)){qe(!0),ve(!0);try{const n=M?M.type==="percentage"?ie*M.value/100:M.value:0,P=ie*.16,T=re==="inclusive"?ie-n:ie-n+P,q=w.map(Q=>({productId:Q.id,quantity:Q.quantity,unit:We[Q.id]||Q.unit||"piece",price:Q.price}));console.log("ðŸ“¤ Creating sale with items:",q);const W=await et.create({items:q,total:T,discount:n,tax:P,taxType:re,paymentMethod:I});if(console.log("âœ… Sale created successfully:",W),!W||!W.saleId)throw new Error("Invalid sale response - no saleId returned");const ne=W.saleId;console.log(`âœ… Sale ID: ${ne}, Stock deductions:`,W.stockDeductions);const Me={id:ne,items:q,total:T,discount:n,tax:P,taxType:re,paymentMethod:I,accountId:t?.accountId,cashierId:t?.id,cashierName:t?.name||"Cashier",stockDeductions:W.stockDeductions||{products:[],expenses:[]},createdAt:new Date().toISOString()};if(W.stockDeductions?.products){const Q=c.map(ue=>{const fe=W.stockDeductions.products.find(fs=>fs.id===ue.id);return fe?{...ue,quantity:fe.after}:ue});g(Q),console.log("âœ… Product quantities updated immediately with stock deductions")}x(Q=>({...Q,sales:[Me,...Q.sales]})),console.log("âœ… Sale added to UI immediately"),a([]),at({}),Pe(null),Fe("exclusive"),qe(!1),ve(!1);const K=W.stockDeductions?.products?.map(Q=>`${Q.name}: -${Q.deducted}${Q.unit}`).join(`
`)||"None";console.log("âœ… Sale completed successfully!"),alert(`âœ… SALE COMPLETE!
Sale ID: #${ne}
Amount: KSH ${T.toLocaleString()}

Stock Deducted:
${K}`),console.log("ðŸ”„ Refreshing product inventory in background..."),(async()=>{try{const Q=await ce.getAll();console.log(`ðŸ“¦ Received ${Q.length} products from server`);const ue=Q.filter(fe=>fe.visibleToCashier!==!1&&!fe.expenseOnly);console.log(`âœ… Filtered to ${ue.length} visible products`),g(ue)}catch(Q){console.warn("Background product refresh failed:",Q)}})()}catch(n){console.error("âŒ Checkout failed:",n.message,n),qe(!1),ve(!1),alert(`âŒ Sale failed: ${n.message||"Unknown error occurred"}`)}finally{qe(!1),ve(!1)}}},xs=async n=>{n.preventDefault();try{console.log("âž• Creating new product:",J.name);const P=await ce.create({...J,price:parseFloat(J.price),cost:parseFloat(J.cost||0),quantity:0});console.log("âœ… Product created:",P),te({name:"",price:"",cost:"",category:"finished",image:""}),_(""),z(!1),console.log("ðŸ”„ Reloading data..."),await we(),console.log("âœ… Product added successfully!"),alert("âœ… Product added successfully!")}catch(P){console.error("âŒ Failed to add product:",P.message,P),alert(`âŒ Failed to add product: ${P.message||"Unknown error"}`)}},us=async n=>{n.preventDefault();try{const P=Array.isArray(m)?m:[],q={id:P.length>0?Math.max(...P.map(W=>W.id||0))+1:1,productId:E.id,quantity:parseInt(se.quantity),expiryDate:se.expiryDate,batchNumber:se.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(se.cost||E.cost||0)};f(W=>[...W,q]),await bt.create({productId:E.id,quantity:parseInt(se.quantity),expiryDate:se.expiryDate,batchNumber:se.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(se.cost||E.cost||0)}),ge({quantity:"",expiryDate:"",batchNumber:"",cost:""}),L(!1),U(null),await we(),alert("Stock added successfully!")}catch(P){console.error("Failed to add stock:",P),alert("Failed to add stock")}},hs=async n=>{n.preventDefault();try{await ft.create({...k,amount:parseFloat(k.amount)}),D({description:"",amount:"",category:""}),je(!1),await we()}catch(P){console.error("Failed to add expense:",P),alert("Failed to add expense")}},ps=async n=>{if(n.preventDefault(),!ae.customerName||!ae.amount){alert("Please fill in all required fields");return}h(!0);try{const P=await ct.create({customerName:ae.customerName,amount:parseFloat(ae.amount),reason:ae.reason,notes:ae.notes});console.log("âœ… Credit request submitted:",P),xe({customerName:"",amount:"",reason:"",notes:""}),me(!1),alert("âœ… Credit request submitted successfully!")}catch(P){console.error("Failed to submit credit request:",P),alert("âŒ Failed to submit credit request: "+(P.message||"Unknown error"))}finally{h(!1)}},gs=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses? This action cannot be undone."))try{const n=localStorage.getItem("token"),T=await fetch(`${ee}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!T.ok){const q=await T.json();throw new Error(q.message||"Failed to clear data")}x({sales:[],expenses:[],stats:{totalSales:0,totalExpenses:0,profit:0}}),a([]),alert("Data cleared successfully!"),await we()}catch(n){console.error("Failed to clear data:",n),alert("Failed to clear data: "+n.message)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Cashier Dashboard"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cashier Plan - KSH 900/month"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),X&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-green-600 font-semibold",children:"ðŸŸ¢ Clocked In"}),e.jsxs("button",{onClick:Ae,className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-600 hover:bg-red-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(Rs,{className:"w-4 h-4"}),"Clock Out"]})]}),!X&&e.jsxs("button",{onClick:le,className:"px-4 py-2 rounded-lg font-medium transition-all bg-green-600 hover:bg-green-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(Qt,{className:"w-4 h-4"}),"Clock In"]}),e.jsxs("button",{onClick:()=>{G(),i()},className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-100 hover:bg-red-200 text-red-600 border border-red-300 flex items-center gap-2",children:[e.jsx(It,{className:"w-4 h-4"}),"Logout"]}),e.jsxs("button",{onClick:gs,className:"px-4 py-2 rounded-lg font-medium transition-all bg-orange-100 hover:bg-orange-200 text-orange-600 border border-orange-300 flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Clear"]}),e.jsxs("button",{onClick:()=>me(!0),className:"px-4 py-2 rounded-lg font-medium transition-all bg-blue-100 hover:bg-blue-200 text-blue-600 border border-blue-300 flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4"}),"Request Credit"]}),X&&st&&e.jsx("div",{className:"ml-auto text-right text-xs",children:e.jsxs("p",{className:"text-green-600 font-semibold flex items-center gap-1",children:[e.jsx(tt,{className:"w-4 h-4"}),"Clocked In: ",st.toLocaleTimeString()]})})]})]})}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>y("pos"),className:`px-6 py-2 rounded-lg font-medium transition-all ${v==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(it,{className:"w-4 h-4 inline mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>y("monitor"),className:`px-6 py-2 rounded-lg font-medium transition-all ${v==="monitor"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ct,{className:"w-4 h-4 inline mr-2"}),"Monitor"]}),e.jsxs("button",{onClick:()=>y("products"),className:`px-6 py-2 rounded-lg font-medium transition-all ${v==="products"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Oe,{className:"w-4 h-4 inline mr-2"}),"Products"]}),e.jsxs("button",{onClick:()=>y("expenses"),className:`px-6 py-2 rounded-lg font-medium transition-all ${v==="expenses"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(xt,{className:"w-4 h-4 inline mr-2"}),"Expenses"]})]}),v==="pos"&&e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:u,onChange:n=>A(n.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:c.filter(n=>n.name?.toLowerCase().includes(u.toLowerCase())).map(n=>{const P=Ee(n.id),T=P<10,q=P<=0;return e.jsxs("button",{onClick:()=>cs(n),disabled:q,className:`card text-left hover:shadow-xl transition-all transform hover:scale-105 relative ${q?"opacity-50 cursor-not-allowed bg-gray-100":"bg-gradient-to-br from-white to-gray-50"}`,children:[n.image&&e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:n.image,alt:n.name,className:"w-full h-full object-cover"})}),T&&!q&&e.jsx("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white p-1 rounded-full",children:e.jsx(Xe,{className:"w-4 h-4"})}),q&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"OUT"}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-900",children:n.name}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["KSH ",n.price?.toLocaleString()]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:`text-xs font-medium ${q?"text-red-600":T?"text-yellow-600":"text-gray-500"}`,children:["Stock: ",P]}),T&&!q&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium",children:"Low Stock"})]})]},n.id)})})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-gray-200 p-6 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(it,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[w.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:w.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(it,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:w.map(n=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:n.name}),e.jsx("button",{onClick:()=>ds(n.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(ye,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Nt(n.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(qs,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-semibold",children:n.quantity}),e.jsx("button",{onClick:()=>Nt(n.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(pe,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(n.price*n.quantity).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2 items-center mt-2",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-600",children:"Unit:"}),e.jsxs("select",{value:We[n.id]||n.unit||"piece",onChange:P=>{at({...We,[n.id]:P.target.value})},className:"text-xs px-2 py-1 border border-gray-300 rounded bg-white",children:[e.jsx("option",{value:"piece",children:"Piece"}),e.jsx("option",{value:"kg",children:"Kilogram (kg)"}),e.jsx("option",{value:"g",children:"Grams (g)"}),e.jsx("option",{value:"l",children:"Liters (L)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",max:"999",placeholder:"qty",defaultValue:n.quantity,className:"text-xs px-2 py-1 border border-gray-300 rounded w-16",onChange:P=>{const T=parseFloat(P.target.value);!isNaN(T)&&T>0&&Nt(n.id,T-n.quantity)}})]})]},n.id))})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"text-gray-700",children:["KSH ",ie.toLocaleString()]})]}),M&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-KSH ",(M.type==="percentage"?ie*M.value/100:M.value).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-orange-600",children:[e.jsxs("span",{children:["Tax (",re==="exclusive"?"Added":"Included","):"]}),e.jsxs("span",{children:[re==="exclusive"?"+":"","KSH ",((ie-(M?M.type==="percentage"?ie*M.value/100:M.value:0))*.16).toLocaleString()]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Final Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(re==="exclusive"?ie-(M?M.type==="percentage"?ie*M.value/100:M.value:0)+(ie-(M?M.type==="percentage"?ie*M.value/100:M.value:0))*.16:ie-(M?M.type==="percentage"?ie*M.value/100:M.value:0)).toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Discount (Optional)"}),e.jsxs("select",{value:M?.id||"",onChange:n=>{n.target.value?Pe(F.find(P=>P.id===parseInt(n.target.value))):Pe(null)},className:"input",children:[e.jsx("option",{value:"",children:"No Discount"}),F.filter(n=>n.active).map(n=>e.jsxs("option",{value:n.id,children:[n.name," - ",n.type==="percentage"?`${n.value}%`:`KSH ${n.value}`]},n.id))]}),M&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Discount: KSH ",(M.type==="percentage"?ie*M.value/100:M.value).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tax Type"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"exclusive",checked:re==="exclusive",onChange:n=>Fe(n.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Exclusive (16% added)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"inclusive",checked:re==="inclusive",onChange:n=>Fe(n.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Inclusive"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:I,onChange:n=>b(n.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:ms,disabled:w.length===0||Ke,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:Ke?"â³ Processing Sale...":"Complete Sale"})]})]})]}),v==="monitor"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",N.stats.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(ze,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",N.stats.totalExpenses?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(xt,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",N.stats.profit?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(ze,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Sales"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock Deducted"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"})]})}),e.jsx("tbody",{children:N.sales&&N.sales.slice(-15).reverse().map((n,P)=>{const T=n.stockDeductions?.products?.slice(0,2).map(q=>`${q.name}: -${q.deducted}${q.unit}`).join(", ")+(n.stockDeductions?.products?.length>2?"...":"")||"None";return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:new Date(n.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[n.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:n.paymentMethod||"cash"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-orange-600 font-semibold",children:T}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",n.total?.toLocaleString()]})]},P)})})]})})]}),e.jsxs("div",{className:"card shadow-lg mt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-orange-600"}),"Stock Deductions Log"]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-orange-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Sale ID"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Before"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Deducted"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"After"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Unit"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Time"})]})}),e.jsx("tbody",{children:N.sales&&N.sales.slice(-20).reverse().map(n=>n.stockDeductions?.products?.map((P,T)=>e.jsxs("tr",{className:"border-t border-orange-100 hover:bg-orange-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 font-medium text-blue-600",children:["#",n.id]}),e.jsx("td",{className:"px-4 py-3",children:P.name}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:P.before}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-red-600",children:["-",P.deducted]}),e.jsx("td",{className:"px-4 py-3 font-semibold text-green-600",children:P.after}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:P.unit}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-500",children:new Date(n.createdAt).toLocaleTimeString()})]},`${n.id}-${T}`)))})]}),(!N.sales||N.sales.length===0||!N.sales.some(n=>n.stockDeductions?.products?.length>0))&&e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No stock deductions yet"})]})]})]}),e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Manage Products & Stock"}),e.jsxs("button",{onClick:()=>z(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700",children:[e.jsx(pe,{className:"w-4 h-4"}),"Add Product"]})]}),B&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl border-2 border-green-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Product"}),e.jsxs("form",{onSubmit:xs,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:J.name,onChange:n=>te({...J,name:n.target.value}),required:!0}),e.jsxs("select",{className:"input",value:J.category,onChange:n=>te({...J,category:n.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsx("input",{type:"number",placeholder:"Selling Price",className:"input",value:J.price,onChange:n=>te({...J,price:n.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Cost Price (Optional)",className:"input",value:J.cost,onChange:n=>te({...J,cost:n.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:n=>jt(n,!0),className:"input"}),e.jsx(Wt,{className:"w-5 h-5 text-gray-400"})]}),O&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:O,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{z(!1),_(""),te({name:"",price:"",cost:"",category:"finished",image:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),H&&E&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"font-semibold mb-4 text-lg",children:["Add Stock for ",E.name]}),e.jsxs("form",{onSubmit:us,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:se.quantity,onChange:n=>ge({...se,quantity:n.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:se.expiryDate,onChange:n=>ge({...se,expiryDate:n.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:se.batchNumber,onChange:n=>ge({...se,batchNumber:n.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per Unit",className:"input",value:se.cost,onChange:n=>ge({...se,cost:n.target.value})}),e.jsxs("div",{className:"flex gap-2 md:col-span-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{L(!1),U(null),ge({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:c.map(n=>{const P=Ee(n.id),T=m.filter(W=>W.productId===n.id&&W.quantity>0),q=P<10;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[n.image&&e.jsx("img",{src:n.image,alt:n.name,className:"w-10 h-10 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:n.name}),e.jsx("div",{className:"text-xs text-gray-500",children:n.category})]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",n.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium ${P===0?"text-red-600":q?"text-yellow-600":"text-gray-900"}`,children:P}),q&&P>0&&e.jsx(Xe,{className:"w-4 h-4 text-yellow-500"}),P===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"text-gray-600",children:[T.length," active"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{U(n),L(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-green-50 rounded-lg text-green-600 transition-colors",title:"Edit Product",children:e.jsx(Ue,{className:"w-4 h-4"})})]})})]},n.id)})})]})})]})}),")}",v==="expenses"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Track Expenses"}),e.jsxs("button",{onClick:()=>je(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700",children:[e.jsx(pe,{className:"w-4 h-4"}),"Add Expense"]})]}),de&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border-2 border-red-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Expense"}),e.jsxs("form",{onSubmit:hs,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:k.description,onChange:n=>D({...k,description:n.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Amount",className:"input",value:k.amount,onChange:n=>D({...k,amount:n.target.value}),required:!0}),e.jsx("input",{type:"text",placeholder:"Category",className:"input",value:k.category,onChange:n=>D({...k,category:n.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>je(!1),className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:N.expenses.slice().reverse().map((n,P)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(n.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:n.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:n.category||"General"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",n.amount?.toLocaleString()]})]},P))})]})})]})}),Ie&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 p-6 text-white flex justify-between items-center sticky top-0",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Le,{}),"Request Credit"]}),e.jsx("button",{onClick:()=>me(!1),className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(Ce,{size:24})})]}),e.jsxs("form",{onSubmit:ps,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name *"}),e.jsx("input",{type:"text",placeholder:"Enter customer name",value:ae.customerName,onChange:n=>xe({...ae,customerName:n.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:S})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Amount (KES) *"}),e.jsx("input",{type:"number",placeholder:"0.00",value:ae.amount,onChange:n=>xe({...ae,amount:n.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"0",step:"0.01",required:!0,disabled:S})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Reason"}),e.jsxs("select",{value:ae.reason,onChange:n=>xe({...ae,reason:n.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:S,children:[e.jsx("option",{value:"",children:"Select reason..."}),e.jsx("option",{value:"regular_customer",children:"Regular Customer"}),e.jsx("option",{value:"emergency",children:"Emergency"}),e.jsx("option",{value:"bulk_order",children:"Bulk Order"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),e.jsx("textarea",{placeholder:"Add any additional notes...",value:ae.notes,onChange:n=>xe({...ae,notes:n.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3",disabled:S})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"submit",disabled:S,className:"flex-1 bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 rounded-lg font-bold hover:shadow-lg transition disabled:opacity-50 disabled:cursor-not-allowed",children:S?"Submitting...":"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>me(!1),disabled:S,className:"flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition disabled:opacity-50",children:"Cancel"})]})]})]})}),e.jsx(ba,{isLocked:l,onUnlock:o,userPin:t?.pin||"1234",userName:t?.name})]})}function ja(){const[t,i]=s.useState([]),[p,j]=s.useState([]),[l,r]=s.useState("all"),[o,c]=s.useState(""),[g,m]=s.useState(!1),[f,w]=s.useState([]),[a,I]=s.useState({subject:"",message:""}),[b,v]=s.useState(!0),[y,N]=s.useState(null),[x,u]=s.useState(!0),[A,B]=s.useState(null),z=Je(),[H,L]=s.useState({totalUsers:0,activeUsers:0,lockedUsers:0,totalRevenue:0,pendingPayments:0,overduePayments:0}),[E,U]=s.useState([]);s.useEffect(()=>{const S=localStorage.getItem("token")||localStorage.getItem("mainAdminToken"),h=localStorage.getItem("user")||localStorage.getItem("mainAdminUser");if(!S||!h){z("/main-admin/login");return}try{if(JSON.parse(h).role!=="owner"){z("/main-admin/login");return}}catch{z("/main-admin/login");return}J().finally(()=>v(!1));const k=JSON.parse(localStorage.getItem("authActivities")||"[]");U(k.slice(0,10));const D=setInterval(()=>{const O=JSON.parse(localStorage.getItem("authActivities")||"[]");U(O.slice(0,10))},5e3);return()=>clearInterval(D)},[z]);const J=async()=>{try{N(null);let S=[],h=!0;try{S=await wt.getUsers()}catch(k){console.warn("MainAdmin API not available, falling back to regular users API:",k.message);try{S=await $e.getAll()}catch(D){console.warn("Users API also failed:",D.message),h=!1}}S.length===0&&!h&&(S=se()),i(S),u(h),de(S,[])}catch(S){console.error("Failed to load data:",S),N("Failed to load dashboard data");const h=se();i(h),j(ge(h)),u(!1),de(h,[])}},te=()=>{localStorage.removeItem("mainAdminToken"),localStorage.removeItem("mainAdminUser"),z("/main-admin/login")},se=()=>{const S=localStorage.getItem("user"),h=[];if(S){const D=JSON.parse(S);h.push({...D,id:D.id||"real-user"})}return[{name:"John Doe",email:"john@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Jane Smith",email:"jane@example.com",plan:"basic",price:900,active:!0,locked:!1,role:"cashier"},{name:"Bob Wilson",email:"bob@example.com",plan:"ultra",price:1600,active:!1,locked:!1,role:"admin"},{name:"Alice Brown",email:"alice@example.com",plan:"basic",price:900,active:!0,locked:!0,role:"cashier"},{name:"Mike Johnson",email:"mike@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Sarah Davis",email:"sarah@example.com",plan:"basic",price:900,active:!1,locked:!1,role:"cashier"}].forEach((D,O)=>{h.push({id:`demo-${O+1}`,...D,createdAt:new Date(Date.now()-O*864e5).toISOString(),lastLogin:new Date(Date.now()-Math.random()*864e5).toISOString()})}),h},ge=S=>S.flatMap(h=>[{id:`payment-${h.id}-1`,userId:h.id,amount:h.plan==="ultra"?1600:900,status:Math.random()>.3?"paid":"pending",createdAt:new Date(Date.now()-30*864e5).toISOString(),dueDate:new Date(Date.now()+5*864e5).toISOString()},{id:`payment-${h.id}-2`,userId:h.id,amount:h.plan==="ultra"?1600:900,status:Math.random()>.7?"paid":Math.random()>.5?"pending":"overdue",createdAt:new Date(Date.now()-60*864e5).toISOString(),dueDate:new Date(Date.now()-5*864e5).toISOString()}]),de=(S,h)=>{const k=S.length,D=S.filter(M=>M.active).length,O=S.filter(M=>M.locked).length,_=h.filter(M=>M.status==="paid").reduce((M,Pe)=>M+Pe.amount,0),F=h.filter(M=>M.status==="pending").length,Y=h.filter(M=>M.status==="overdue").length;L({totalUsers:k,activeUsers:D,lockedUsers:O,totalRevenue:_,pendingPayments:F,overduePayments:Y})},je=async(S,h)=>{try{B(S);const k=!h;try{await wt.lockUser(S,k);const D=t.map(F=>F.id===S?{...F,locked:k,active:!k}:F);i(D),de(D,p);const O=t.find(F=>F.id===S),_=k?"locked":"unlocked";alert(`âœ… ${O?.name||`User ${S}`} has been ${_} successfully!`)}catch(D){console.error("API lock failed:",D);const O=t.map(Y=>Y.id===S?{...Y,locked:k,active:!k}:Y);i(O),de(O,p);const _=t.find(Y=>Y.id===S),F=k?"locked":"unlocked";alert(`âš ï¸ Backend not available. ${_?.name||`User ${S}`} ${F} locally. Changes will sync when backend is available.`)}}catch(k){console.error("Failed to toggle lock:",k),alert(`âŒ Failed to update user status: ${k.message}`)}finally{B(null)}},Ie=async(S,h,k)=>{try{v(!0);try{await wt.sendEmail({userIds:S,subject:h,message:k}),alert("Emails sent successfully!"),m(!1),w([]),I({subject:"",message:""});return}catch(_){console.warn("Backend email operation failed, simulating email send:",_.message)}const D=t.filter(_=>S.includes(_.id)),O=JSON.parse(localStorage.getItem("emailLogs")||"[]");O.push({timestamp:new Date().toISOString(),recipients:D.map(_=>({id:_.id,name:_.name,email:_.email})),subject:h,message:k,status:"simulated"}),localStorage.setItem("emailLogs",JSON.stringify(O)),alert(`âœ… Email simulation successful!

ðŸ“§ Sent to ${D.length} user(s):
${D.map(_=>`${_.name} (${_.email})`).join(`
`)}

${x?"":`ðŸ“Œ Backend not deployed - this was a simulation.
`}ðŸ’¡ Deploy backend to send real emails.`),m(!1),w([]),I({subject:"",message:""})}catch(D){console.error("Failed to send email:",D),alert("Failed to process email request.")}finally{v(!1)}},me=async S=>{const h=t.find(k=>k.id===S);h&&await Ie([S],"Payment Reminder - Subscription",`Dear ${h.name},

This is a friendly reminder about your pending subscription payment for ${h.plan?.toUpperCase()} plan (KSH ${h.price}).

Please complete your payment to continue enjoying our services.

Thank you!`)},ae=t.filter(S=>{const h=S.name?.toLowerCase().includes(o.toLowerCase())||S.email?.toLowerCase().includes(o.toLowerCase());if(l==="all")return h;if(l==="active")return h&&S.active&&!S.locked;if(l==="locked")return h&&S.locked;if(l==="trial")return h&&(!S.active||!S.plan);if(l==="pending-payment"){const k=p.filter(D=>D.userId===S.id&&D.status==="pending");return h&&k.length>0}if(l==="overdue"){const k=p.filter(D=>D.userId===S.id&&D.status==="overdue");return h&&k.length>0}return h}),xe=S=>{const h=p.filter(_=>_.userId===S),k=h.filter(_=>_.status==="pending").length,D=h.filter(_=>_.status==="overdue").length,O=h.filter(_=>_.status==="paid").length;return{pending:k,overdue:D,paid:O,total:h.length}};return b&&t.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-white mx-auto mb-4"}),e.jsx("p",{className:"text-white text-xl",children:"Loading Main Admin Dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900",children:[!x&&e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm md:text-base font-semibold",children:["âš ï¸ Demo Mode: Backend not available. Actions are simulated locally.",e.jsx("a",{href:"/BACKEND_NOT_DEPLOYED.md",className:"underline ml-2",children:"Deploy Backend â†’"})]})}),y&&e.jsx("div",{className:"bg-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm font-semibold",children:["âš ï¸ ",y]})}),e.jsx("header",{className:"bg-black/30 backdrop-blur-lg border-b border-white/10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Main Admin Dashboard"}),e.jsx("p",{className:"text-gray-300",children:"Monitor all users, payments, and system activity"})]}),e.jsxs("button",{onClick:te,className:"flex items-center gap-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 px-4 py-2 rounded-lg transition-colors",children:[e.jsx(It,{className:"w-4 h-4"}),"Logout"]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(He,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:H.totalUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(_e,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:H.activeUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Active Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(he,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:H.lockedUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Locked Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ze,{className:"w-8 h-8 text-yellow-400"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:["KSH ",H.totalRevenue.toLocaleString()]})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Xe,{className:"w-8 h-8 text-orange-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:H.pendingPayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Pending Payments"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ot,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:H.overduePayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Overdue Payments"})]})]}),e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 flex-1 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-80",children:[e.jsx(yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",value:o,onChange:S=>c(S.target.value)})]}),e.jsxs("select",{value:l,onChange:S=>r(S.target.value),className:"px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"locked",children:"Locked"}),e.jsx("option",{value:"trial",children:"Free Trial"}),e.jsx("option",{value:"pending-payment",children:"Pending Payment"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsxs("button",{onClick:()=>m(!0),disabled:f.length===0||b,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-3 rounded-lg font-bold flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(gt,{className:"w-5 h-5"}),"Send Email to Selected (",f.length,")"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"xl:col-span-2 bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"All Users"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left",children:e.jsx("input",{type:"checkbox",checked:f.length===ae.length&&ae.length>0,onChange:S=>{S.target.checked?w(ae.map(h=>h.id)):w([])},className:"w-5 h-5 rounded"})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Actions"})]})}),e.jsxs("tbody",{children:[ae.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:"5",className:"px-4 py-12 text-center",children:[e.jsx(He,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:o||l!=="all"?"Try adjusting your filters":"Users will appear here once they sign up"})]})}),ae.map(S=>(xe(S.id),e.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:f.includes(S.id),onChange:h=>{h.target.checked?w([...f,S.id]):w(f.filter(k=>k!==S.id))},className:"w-5 h-5 rounded"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[S.profilePicture?e.jsx("img",{src:S.profilePicture,alt:S.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:S.name?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:S.name}),e.jsx("p",{className:"text-sm text-gray-400",children:S.email})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${S.plan==="ultra"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"}`,children:[S.plan?.toUpperCase()," - KSH ",S.price]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"flex items-center gap-2",children:S.locked?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-300 flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"}),"Locked"]}):S.active?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-300 flex items-center gap-1",children:[e.jsx(_e,{className:"w-3 h-3"}),"Active"]}):e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-500/20 text-gray-300",children:"Inactive"})})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>je(S.id,S.locked),disabled:A===S.id,className:`p-2 rounded-lg transition ${S.locked?"bg-green-500/20 hover:bg-green-500/30 text-green-300":"bg-red-500/20 hover:bg-red-500/30 text-red-300"} ${A===S.id?"opacity-50 cursor-not-allowed":""}`,title:S.locked?"Unlock User":"Lock User",children:A===S.id?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):S.locked?e.jsx(Ms,{className:"w-4 h-4"}):e.jsx(he,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>me(S.id),disabled:b,className:"p-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 transition",title:"Send Payment Reminder",children:e.jsx(Bs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{S.role==="cashier"?window.open("/dashboard/cashier","_blank"):window.open("/admin","_blank")},className:"p-2 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 transition",title:"View User Dashboard",children:e.jsx(Vt,{className:"w-4 h-4"})})]})})]},S.id)))]})]})})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl border border-white/20",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5"}),"Recent Activity"]})}),e.jsx("div",{className:"p-4 space-y-3 max-h-96 overflow-y-auto",children:E.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"No recent activity"}):E.map(S=>e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${S.type==="login"?"bg-green-400":"bg-blue-400"}`}),e.jsx("span",{className:"text-white font-medium",children:S.user.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${S.type==="login"?"bg-green-500/20 text-green-300":"bg-blue-500/20 text-blue-300"}`,children:S.type})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:S.user.email}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:new Date(S.timestamp).toLocaleString()})]},S.id))})]})]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-purple-900 rounded-2xl shadow-2xl max-w-2xl w-full border border-white/20",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(gt,{}),"Send Email to ",f.length," User(s)"]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Subject"}),e.jsx("input",{type:"text",value:a.subject,onChange:S=>I({...a,subject:S.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email subject..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Message"}),e.jsx("textarea",{value:a.message,onChange:S=>I({...a,message:S.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 h-40",placeholder:"Email message..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Ie(f,a.subject,a.message),disabled:b,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white py-3 rounded-lg font-bold transition disabled:opacity-50",children:b?"Sending...":"Send Email"}),e.jsx("button",{onClick:()=>m(!1),className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-lg font-bold transition",children:"Cancel"})]})]})]})})]})}function Na({user:t}){const[i,p]=s.useState(!1);if(i||!t)return null;const j=t?.serviceStartDate?new Date(t.serviceStartDate):null,l=t?.daysUsed||0,r=t?.plan||"",c=Math.max(0,30-l);return c>7?null:e.jsxs("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-3 md:p-4 flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(Ze,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-amber-900",children:c===0?`Your ${r} plan has expired. Please renew to continue.`:`Your ${r} plan expires in ${c} day${c!==1?"s":""}. Consider upgrading.`}),e.jsxs("p",{className:"text-xs text-amber-700 mt-1",children:["Service started: ",j?.toLocaleDateString()||"Unknown"]})]})]}),e.jsx("button",{onClick:()=>p(!0),className:"flex-shrink-0 text-amber-600 hover:text-amber-900",children:e.jsx(Ce,{className:"w-5 h-5"})})]})}function va(){const{refreshProducts:t}=Dt();return s.useEffect(()=>{const i=l=>{console.log(" Stock update received:",l.detail),t()},p=l=>{console.log(" Sale completed, refreshing stock:",l.detail),t()},j=l=>{console.log(" Products sync event:",l.detail)};return window.addEventListener("stockUpdate",i),window.addEventListener("saleComplete",p),window.addEventListener("productsSync",j),()=>{window.removeEventListener("stockUpdate",i),window.removeEventListener("saleComplete",p),window.removeEventListener("productsSync",j)}},[t]),null}function St({children:t,adminOnly:i=!1,ultraOnly:p=!1,ownerOnly:j=!1}){const{user:l,loading:r}=Ne(),{isLocked:o,lock:c,unlock:g}=ls(),[m,f]=s.useState(!1),w=os(6e4),a=w?.[0]||o||!1,I=s.useCallback(()=>{w?.[1]?.(),g()},[w,g]),[b,v]=s.useState({});if(s.useEffect(()=>{l&&!j&&((async()=>{try{const x=localStorage.getItem("token"),A=await fetch(`${ee}/settings`,{headers:{Authorization:`Bearer ${x}`}});if(A.ok){const B=await A.json();v(B)}}catch(x){console.error("Failed to load settings:",x)}})(),sessionStorage.getItem("reminderShown")||(f(!0),sessionStorage.setItem("reminderShown","true")))},[l,j]),s.useEffect(()=>{const N=x=>{console.log("ðŸ”’ Admin locked screen:",x.detail),c("admin")};return window.addEventListener("admin_locked_user_screen",N),()=>window.removeEventListener("admin_locked_user_screen",N)},[c]),r&&!j)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(j){const N=localStorage.getItem("ownerToken"),x=localStorage.getItem("ownerUser");if(!N||!x)return e.jsx(oe,{to:"/main.admin"});try{if(JSON.parse(x).type!=="main_admin")return e.jsx(oe,{to:"/main.admin"})}catch{return e.jsx(oe,{to:"/main.admin"})}}else{if(!l)return e.jsx(oe,{to:"/auth/login"});if(!l.active)return e.jsx(oe,{to:"/plans"});if(i&&l.role!=="admin")return e.jsx(oe,{to:"/dashboard"});if(p&&(l.role!=="admin"||l.plan!=="ultra"))return e.jsx(oe,{to:"/dashboard"})}const y=j?"owner":"user";return e.jsxs(e.Fragment,{children:[e.jsx(Na,{}),e.jsx(va,{}),a&&e.jsx(is,{onUnlock:I,userType:y}),m&&e.jsx(ns,{onClose:()=>f(!1)}),t]})}function wa(){const{user:t}=Ne();return!t||!t.active?e.jsx(oe,{to:"/plans"}):t.role==="admin"?e.jsx(oe,{to:"/admin"}):e.jsx(oe,{to:"/dashboard/cashier"})}function Sa(){return e.jsx(Qs,{children:e.jsx(Ys,{children:e.jsx(Xs,{children:e.jsx(Ns,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(Ht,{children:[e.jsx(Z,{path:"/",element:e.jsx(ga,{})}),e.jsx(Z,{path:"/auth/login",element:e.jsx(_t,{})}),e.jsx(Z,{path:"/auth/signup",element:e.jsx(_t,{})}),e.jsx(Z,{path:"/plans",element:e.jsx(fa,{})}),e.jsx(Z,{path:"/main.admin/*",element:e.jsx(ja,{})}),e.jsx(Z,{path:"/dashboard",element:e.jsx(St,{children:e.jsx(wa,{})})}),e.jsx(Z,{path:"/dashboard/cashier",element:e.jsx(St,{children:e.jsx(ya,{})})}),e.jsx(Z,{path:"/admin/*",element:e.jsx(St,{adminOnly:!0,children:e.jsx(pa,{})})}),e.jsx(Z,{path:"/login",element:e.jsx(oe,{to:"/auth/login"})}),e.jsx(Z,{path:"/signup",element:e.jsx(oe,{to:"/auth/signup"})}),e.jsx(Z,{path:"/subscription",element:e.jsx(oe,{to:"/plans"})}),e.jsx(Z,{path:"/payment",element:e.jsx(oe,{to:"/plans"})}),e.jsx(Z,{path:"/cashier",element:e.jsx(oe,{to:"/dashboard/cashier"})})]})})})})})}Ws.createRoot(document.getElementById("root")).render(e.jsx(vs.StrictMode,{children:e.jsx(Sa,{})}));
