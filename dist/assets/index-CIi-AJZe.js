import{a as Es,b as Ds,g as $s,r as s,u as he,c as ts,R as ss,d as Z,B as Ls,N as xe,e as Os}from"./vendor-Ct1st1Nj.js";import{C as Re,D as Xe,T as De,P as Me,S as as,a as dt,b as mt,c as je,d as Fs,e as Us,f as Ze,g as Je,h as ve,i as rs,j as Rs,k as ls,l as Ms,L as be,U as _t,m as Wt,n as Nt,E as ns,M as Ht,o as et,X as Ie,p as $e,q as ot,r as Ut,s as vt,t as Jt,u as He,B as Rt,R as qs,I as Bs,v as tt,w as Lt,x as Qe,y as ft,z as wt,A as zs,F as _s,G as Ws,H as Hs,J as Js,K as Ks,N as Gs,O as Vs,Q as Ae,V as Ys,W as nt,Y as is,Z as Ot,_ as Ue,$ as Ft,a0 as os,a1 as Qs,a2 as Xs,a3 as Zs,a4 as ea,a5 as ta,a6 as sa,a7 as aa,a8 as ra,a9 as la,aa as na,ab as ia,ac as oa}from"./icons-I09nBQzQ.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&d(a)}).observe(document,{childList:!0,subtree:!0});function c(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function d(n){if(n.ep)return;n.ep=!0;const i=c(n);fetch(n.href,i)}})();var Tt={exports:{}},lt={};var Kt;function ca(){if(Kt)return lt;Kt=1;var t=Es(),l=Symbol.for("react.element"),c=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function a(o,p,h){var x,g={},r=null,C=null;h!==void 0&&(r=""+h),p.key!==void 0&&(r=""+p.key),p.ref!==void 0&&(C=p.ref);for(x in p)d.call(p,x)&&!i.hasOwnProperty(x)&&(g[x]=p[x]);if(o&&o.defaultProps)for(x in p=o.defaultProps,p)g[x]===void 0&&(g[x]=p[x]);return{$$typeof:l,type:o,key:r,ref:C,props:g,_owner:n.current}}return lt.Fragment=c,lt.jsx=a,lt.jsxs=a,lt}var Gt;function da(){return Gt||(Gt=1,Tt.exports=ca()),Tt.exports}var e=da(),gt={},Vt;function ma(){if(Vt)return gt;Vt=1;var t=Ds();return gt.createRoot=t.createRoot,gt.hydrateRoot=t.hydrateRoot,gt}var xa=ma();const ua=$s(xa),ha=()=>"https://universal-backend-w0x1.onrender.com/api",ae=ha(),cs=()=>localStorage.getItem("token"),ds=async(t,l={},c=0,d=3)=>{const n=cs(),i=t.startsWith("/")?t:`/${t}`,a={...l,headers:{"Content-Type":"application/json",...n&&!(i.startsWith("/auth")&&i!=="/auth/me")&&!i.includes("/main-admin/auth/login")&&{Authorization:`Bearer ${n}`},...l.headers}};try{const o=await fetch(`${ae}${i}`,a);if(o.status===401){if(i.includes("/auth/login")||i.includes("/main-admin/auth/login")){const C=await o.json().catch(()=>({error:"Unauthorized"}));throw new Error(C.error||"Invalid credentials")}localStorage.removeItem("token"),localStorage.removeItem("user");const h=window.location.pathname||"";if(!["/","/get-started","/choose-subscription","/plans","/subscription","/build-pos","/login","/signup","/auth","/main.admin"].some(C=>h===C||h.startsWith(C)))try{window.location.href="/auth/login"}catch{}const r=new Error("Unauthorized");throw r.status=401,r}if(o.status===500)throw new Error("Server error 500 - Backend unavailable");if(o.ok)return o.status===204?{success:!0}:await o.json();const p=await o.json().catch(()=>({error:"Network error"}));throw new Error(p.error||`HTTP ${o.status}: ${o.statusText}`)}catch(o){if(o.name==="TypeError"&&o.message.includes("fetch")){if(console.error(`API Fetch Error (attempt ${c+1}/${d+1}):`,o),console.error("Attempted URL:",`${ae}${i}`),c<d){const p=Math.min(1e3*Math.pow(2,c),1e4);return console.log(`Retrying in ${p}ms...`),await new Promise(h=>setTimeout(h,p)),ds(t,l,c+1,d)}throw new Error("Cannot connect to server. The server may be waking up. Please try again in a moment.")}throw o}},O=(t,l={})=>ds(t,l,0,3),Ye={login:t=>O("/auth/login",{method:"POST",body:JSON.stringify(t)}),pinLogin:t=>O("/auth/pin-login",{method:"POST",body:JSON.stringify(t)}),signup:t=>O("/auth/signup",{method:"POST",body:JSON.stringify(t)}),signupWithPayment:t=>O("/signup-with-payment",{method:"POST",body:JSON.stringify(t)}),me:()=>O("/auth/me"),updatePin:t=>O("/auth/update-pin",{method:"POST",body:JSON.stringify({pin:t})})},We={getAll:()=>O("/users"),create:t=>O("/users",{method:"POST",body:JSON.stringify(t)}),update:(t,l)=>O(`/users/${t}`,{method:"PUT",body:JSON.stringify(l)}),delete:t=>O(`/users/${t}`,{method:"DELETE"}),setPin:(t,l)=>O(`/users/${t}/set-pin`,{method:"POST",body:JSON.stringify({pin:l})}),lock:(t,l)=>O(`/users/${t}/lock`,{method:"POST",body:JSON.stringify({locked:l})})},ue={getAll:()=>O("/products"),create:t=>O("/products",{method:"POST",body:JSON.stringify(t)}),update:(t,l)=>O(`/products/${t}`,{method:"PUT",body:JSON.stringify(l)}),delete:t=>O(`/products/${t}`,{method:"DELETE"}),getLowStockWarnings:()=>O("/products/low-stock-warnings"),updateStock:(t,l)=>O(`/products/${t}/stock`,{method:"PUT",body:JSON.stringify(l)}),getMaxProducible:t=>O(`/products/${t}/max-producible`),getWeightPricing:t=>O(`/products/${t}/weight-pricing`),addWeightPrice:(t,l,c)=>O(`/products/${t}/weight-pricing`,{method:"POST",body:JSON.stringify({weight:l,price:c})}),updateWeightPrice:(t,l,c)=>O(`/products/${t}/weight-pricing`,{method:"PUT",body:JSON.stringify({weight:l,price:c})}),deleteWeightPrice:(t,l)=>O(`/products/${t}/weight-pricing`,{method:"DELETE",body:JSON.stringify({weight:l})})},Ct={getAll:()=>O("/sales"),create:t=>O("/sales",{method:"POST",body:JSON.stringify(t)}),delete:t=>O(`/sales/${t}`,{method:"DELETE"}),adminComplete:t=>O("/admin-complete-sale",{method:"POST",body:JSON.stringify(t)})},St={getAll:()=>O("/expenses"),create:t=>O("/expenses",{method:"POST",body:JSON.stringify(t)}),update:(t,l)=>O(`/expenses/${t}`,{method:"PUT",body:JSON.stringify(l)}),delete:t=>O(`/expenses/${t}`,{method:"DELETE"})},ms={get:()=>O("/stats")},it={getAll:()=>O("/discounts"),create:t=>O("/discounts",{method:"POST",body:JSON.stringify(t)}),update:(t,l)=>O(`/discounts/${t}`,{method:"PUT",body:JSON.stringify(l)}),delete:t=>O(`/discounts/${t}`,{method:"DELETE"})},bt={getAll:()=>O("/credit-requests"),create:t=>O("/credit-requests",{method:"POST",body:JSON.stringify(t)}),update:(t,l)=>O(`/credit-requests/${t}`,{method:"PUT",body:JSON.stringify(l)}),approve:t=>O(`/credit-requests/${t}/approve`,{method:"POST"}),reject:t=>O(`/credit-requests/${t}/reject`,{method:"POST"})},ct={get:()=>O("/settings"),update:t=>O("/settings",{method:"PUT",body:JSON.stringify(t)})},jt={getAll:()=>O("/time-entries"),getStatus:()=>O("/clock-status"),create:t=>O("/time-entries",{method:"POST",body:JSON.stringify({action:t})}),update:(t,l)=>O(`/time-entries/${t}`,{method:"PUT",body:JSON.stringify(l)}),delete:t=>O(`/time-entries/${t}`,{method:"DELETE"})},kt={getAll:t=>{const l=t?`/batches?productId=${t}`:"/batches";return O(l)},create:t=>O("/batches",{method:"POST",body:JSON.stringify(t)})},Et={login:t=>O("/main-admin/auth/login",{method:"POST",body:JSON.stringify(t)}),getUsers:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/users",{headers:{Authorization:`Bearer ${t}`}})},getStats:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/stats",{headers:{Authorization:`Bearer ${t}`}})},getActivities:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/activities",{headers:{Authorization:`Bearer ${t}`}})},getSalesAll:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/sales-all",{headers:{Authorization:`Bearer ${t}`}})},getTimeEntriesAll:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/time-entries-all",{headers:{Authorization:`Bearer ${t}`}})},lockUser:(t,l)=>{const c=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O(`/main-admin/users/${t}/lock`,{method:"POST",headers:{Authorization:`Bearer ${c}`},body:JSON.stringify({locked:l})})},changePlan:(t,l)=>{const c=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O(`/main-admin/users/${t}/plan`,{method:"POST",headers:{Authorization:`Bearer ${c}`},body:JSON.stringify({plan:l})})},clearData:t=>{const l=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/system/clear-data",{method:"POST",headers:{Authorization:`Bearer ${l}`},body:JSON.stringify({type:t})})},getSubscribers:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/subscribers",{headers:{Authorization:`Bearer ${t}`}})},getSubscribersAnalytics:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/subscribers/analytics",{headers:{Authorization:`Bearer ${t}`}})},getUsersWithSubscriptions:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/users-with-subscriptions",{headers:{Authorization:`Bearer ${t}`}})}};let Ne=null,yt=new Set;function pa(){const t=ae.replace(/\/api$/,"");return`${t.startsWith("https")?"wss":"ws"}://${t.replace(/^https?:\/\//,"")}/api/ws/products`}function ga(){if(Ne&&(Ne.readyState===WebSocket.OPEN||Ne.readyState===WebSocket.CONNECTING))return;const t=cs(),l=pa()+(t?`?token=${encodeURIComponent(t)}`:"");Ne=new WebSocket(l),Ne.onopen=()=>{console.debug("Products WS connected")},Ne.onmessage=c=>{let d=null;try{d=JSON.parse(c.data)}catch{return}yt.forEach(n=>{try{n(d)}catch(i){console.error("ws callback error",i)}})},Ne.onclose=()=>{console.debug("Products WS closed"),Ne=null},Ne.onerror=c=>{console.error("Products WS error",c)}}function Yt(t){if(typeof t!="function")throw new Error("subscribeProducts requires a callback");return yt.add(t),ga(),()=>{if(yt.delete(t),Ne&&yt.size===0){try{Ne.close()}catch{}Ne=null}}}const xs=s.createContext(),oe=()=>s.useContext(xs),fa=({children:t})=>{const[l,c]=s.useState(null),[d,n]=s.useState(!0),[i,a]=s.useState(!1),[o,p]=s.useState({});s.useEffect(()=>{h()},[]),s.useEffect(()=>{const I=()=>{const F=localStorage.getItem("user");if(F)try{const K=JSON.parse(F);c(K)}catch(K){console.warn("Failed to parse user from localStorage",K)}else c(null)};return window.addEventListener("storage",I),window.addEventListener("localStorageUpdated",I),()=>{window.removeEventListener("storage",I),window.removeEventListener("localStorageUpdated",I)}},[]);const h=async()=>{try{const I=localStorage.getItem("token"),F=localStorage.getItem("user");if(I)try{const K=await fetch(`${ae}/auth/me`,{headers:{Authorization:`Bearer ${I}`,"Content-Type":"application/json"}});if(K.ok){const ce=await K.json();c(ce),localStorage.setItem("user",JSON.stringify(ce))}else throw new Error("Invalid token")}catch(K){console.warn("Auth check failed:",K),localStorage.removeItem("token"),localStorage.removeItem("user")}}catch(I){console.error("Error initializing auth:",I),localStorage.removeItem("token"),localStorage.removeItem("user"),c(null)}finally{n(!1),a(!0)}},x=async I=>{try{if(I&&I.token&&I.user)return localStorage.setItem("token",I.token),localStorage.setItem("user",JSON.stringify(I.user)),c(I.user),I;const F=await Ye.login(I);if(F.token&&F.user)return localStorage.setItem("token",F.token),localStorage.setItem("user",JSON.stringify(F.user)),c(F.user),F;throw new Error("Invalid response from server")}catch(F){throw console.error("Login failed:",F),F}},g=async I=>{try{const F=await Ye.signup(I);if(F.token&&F.user)return localStorage.setItem("token",F.token),localStorage.setItem("user",JSON.stringify(F.user)),c(F.user),F;throw new Error("Invalid response from server")}catch(F){throw console.error("Signup failed:",F),F}},r=async I=>{try{if(localStorage.setItem("user",JSON.stringify(I)),c(I),window.dispatchEvent(new Event("localStorageUpdated")),I&&I.id)try{await We.update(I.id,I)}catch(F){console.warn("Failed to persist updated user to backend",F)}return I}catch(F){throw console.error("updateUser failed:",F),F}},C=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),c(null),window.location.href="/auth/login"},y=()=>!!l&&!!localStorage.getItem("token"),N=I=>l&&l.role===I,v=()=>l&&l.role==="owner",w=()=>l&&(l.role==="admin"||l.role==="main-admin"),f=()=>l&&l.role==="cashier",b=(I=null)=>{const F=I||l?.role;return F==="owner"?"/main-admin":F==="admin"?"/admin":F==="cashier"?"/cashier":"/dashboard"},A=()=>l&&l.plan==="ultra",z=()=>l&&l.plan==="basic",W=()=>l&&(l.role==="admin"||l.role==="cashier"),_=()=>l&&l.role==="admin"&&l.plan==="ultra",L=()=>l&&l.role==="admin",H=()=>!0,$=()=>!0;return l?.locked?e.jsx(LockedAccount,{}):e.jsx(xs.Provider,{value:{user:l,loading:d,isInitialized:i,appSettings:o,login:x,signup:g,updateUser:r,logout:C,isAuthenticated:y,hasRole:N,isOwner:v,isAdmin:w,isCashier:f,getDashboardUrl:b,isUltraPackage:A,isBasicPackage:z,canEditStock:W,canManageUsers:_,canViewAnalytics:L,isRealTimeProductSyncEnabled:H,isCashierUserManagementEnabled:$},children:t})};new Date().toISOString();const us=s.createContext(),Mt=()=>s.useContext(us),ba=({children:t})=>{const{user:l}=oe(),[c,d]=s.useState([]),[n,i]=s.useState(!0),[a,o]=s.useState(null),[p,h]=s.useState(Date.now()),x=s.useCallback(async()=>{if(!localStorage.getItem("token"))return i(!1),[];try{const r=await ue.getAll(),y=(Array.isArray(r)?r:[]).filter(N=>!N.pendingDelete);return d(y),o(null),window.dispatchEvent(new CustomEvent("productsSync",{detail:{products:y,timestamp:Date.now()}})),y}catch(r){return console.error("Failed to fetch products:",r),o(`Failed to load products: ${r.message}`),d([]),[]}finally{i(!1),h(Date.now())}},[]);s.useEffect(()=>{x()},[]),s.useEffect(()=>{const r=()=>{console.log("ðŸ”„ Data cleared event received - forcing products refresh"),d([]),o(null),x()};return window.addEventListener("dataCleared",r),window.addEventListener("productsCleared",r),()=>{window.removeEventListener("dataCleared",r),window.removeEventListener("productsCleared",r)}},[]);const g=async()=>(i(!0),await x());return e.jsx(us.Provider,{value:{products:c,loading:n,error:a,lastUpdated:p,refreshProducts:g},children:t})},hs=s.createContext(),ps=()=>s.useContext(hs),ja=900*1e3,ya=({children:t})=>{const{user:l}=oe(),[c,d]=s.useState(!1),n=s.useRef(null),i=s.useRef(Date.now()),a=s.useCallback(()=>{i.current=Date.now(),n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{d(!0),console.log("ðŸ”’ Screen locked due to inactivity")},ja)},[]);s.useEffect(()=>{const x=["mousedown","keydown","click","touchstart"];return x.forEach(g=>{document.addEventListener(g,a)}),a(),()=>{x.forEach(g=>{document.removeEventListener(g,a)}),n.current&&clearTimeout(n.current)}},[a]);const o=s.useCallback(()=>{d(!0),console.log("ðŸ”’ Screen manually locked")},[]),p=s.useCallback(()=>{d(!1),a(),console.log("ðŸ”“ Screen unlocked")},[a]),h={isLocked:c,lock:o,unlock:p};return e.jsx(hs.Provider,{value:h,children:t})};function Na(){const[t,l]=s.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[c,d]=s.useState(!0),[n,i]=s.useState(null);s.useEffect(()=>{a()},[]);const a=async()=>{try{i(null);const[h,x]=await Promise.all([ms.get(),Ct.getAll()]),g={totalSales:h?.totalSales||0,totalExpenses:h?.totalExpenses||0,profit:h?.profit||0,grossProfit:h?.grossProfit||0,netProfit:h?.netProfit||0,totalCOGS:h?.totalCOGS||0,dailySales:h?.dailySales||0,weeklySales:h?.weeklySales||0,productCount:h?.productCount||0},r=Array.isArray(x)?x:[];l({stats:g,recentSales:r.slice(-10).reverse()})}catch(h){console.error("Failed to load data:",h),i(h.message),l({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{d(!1)}};if(c)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(n&&t.stats.totalSales===0&&t.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Re,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:n}),e.jsx("button",{onClick:a,className:"btn-primary",children:"Retry"})]})});const o=[{label:"Total Sales",value:`KSH ${t.stats.totalSales?.toLocaleString()||0}`,icon:Xe,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${t.stats.grossProfit?.toLocaleString()||0}`,icon:De,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${t.stats.totalCOGS?.toLocaleString()||0}`,icon:Me,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${t.stats.netProfit?.toLocaleString()||0}`,icon:De,color:"from-purple-500 to-pink-600",change:"+15.3%"}],p=[{label:"Daily Sales",value:`KSH ${t.stats.dailySales?.toLocaleString()||0}`,icon:as,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${t.stats.weeklySales?.toLocaleString()||0}`,icon:De,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${t.stats.totalExpenses?.toLocaleString()||0}`,icon:dt,color:"bg-red-50 text-red-600"},{label:"Products",value:t.stats.productCount||0,icon:Me,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(o||[]).map((h,x)=>{const g=h?.icon;return g?e.jsxs("div",{className:`card bg-gradient-to-br ${h.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(g,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:h.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:h.label}),e.jsx("p",{className:"text-2xl font-bold",children:h.value})]},x):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(p||[]).map((h,x)=>{const g=h?.icon;return g?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${h.color} flex items-center justify-center`,children:e.jsx(g,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:h.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:h.value})]})]})},x):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!t.recentSales||t.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Re,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(t.recentSales||[]).map(h=>h?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:h.createdAt?new Date(h.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(h.items)?h.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:h.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",h.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",h.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",h.profit?.toLocaleString()||0]})]},h.id||Math.random()):null)})]})})]})]})}const va=()=>"https://universal-backend-w0x1.onrender.com/api".replace("https://","wss://").replace("http://","ws://");class wa{constructor(){this.ws=null,this.listeners={stock_updated:[],sale_completed:[],admin_sale_completed:[],product_created:[],product_updated:[],product_deleted:[],heartbeat:[],initial:[],error:[]},this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.isManualClose=!1}connect(l,c){return new Promise((d,n)=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){d();return}if(!l){n(new Error("No token provided for WebSocket connection"));return}const i=`${va()}/ws/products?token=${encodeURIComponent(l)}`;try{this.ws=new WebSocket(i),this.ws.onopen=()=>{console.log("âœ… WebSocket connected for real-time updates"),this.reconnectAttempts=0,d()},this.ws.onmessage=a=>{try{const o=JSON.parse(a.data),p=o.type?o.type.toLowerCase():"unknown";p==="stock_updated"?(console.log("ðŸ“¦ Stock update received:",o.data),c&&c(o.data),this.emit("stock_updated",o.data)):p==="sale_completed"?(console.log("ðŸ’° Sale completed - stock deducted:",o.data),this.emit("sale_completed",o.data),c&&o.data.updatedProducts&&c({allProducts:o.data.updatedProducts})):p==="admin_sale_completed"?(console.log("ðŸ‘¨â€ðŸ’¼ Admin sale completed:",o.data),this.emit("admin_sale_completed",o.data),this.emit("sale_completed",o.data),c&&o.data.updatedProducts&&c({allProducts:o.data.updatedProducts})):p==="product_created"?(console.log("âœ¨ Product created:",o.data),this.emit("product_created",o.data)):p==="product_updated"?(console.log("ðŸ“ Product updated:",o.data),this.emit("product_updated",o.data),c&&o.data.allProducts&&c({allProducts:o.data.allProducts})):p==="product_deleted"?(console.log("ðŸ—‘ï¸ Product deleted:",o.data),this.emit("product_deleted",o.data),c&&o.data.allProducts&&c({allProducts:o.data.allProducts})):p==="initial"?(console.log("ðŸ“¦ Initial products loaded via WebSocket"),this.emit("initial",o.products)):p==="heartbeat"?this.emit("heartbeat",o):(console.log(`ðŸ“¨ Message received (${p}):`,o.data),p!=="unknown"&&this.emit(p,o.data))}catch(o){console.error("Error parsing WebSocket message:",o)}},this.ws.onerror=a=>{console.error("âŒ WebSocket error:",a),this.emit("error",a),n(a)},this.ws.onclose=()=>{console.log("ðŸ”Œ WebSocket disconnected"),this.isManualClose||this.attemptReconnect(l,c)}}catch(a){console.error("Failed to create WebSocket:",a),n(a)}})}attemptReconnect(l,c){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Max reconnection attempts reached");return}this.reconnectAttempts++;const d=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`ðŸ”„ Reconnecting in ${d}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect(l,c).catch(n=>{console.error("Reconnection failed:",n)})},d)}on(l,c){this.listeners[l]||(this.listeners[l]=[]),this.listeners[l].push(c)}emit(l,c){this.listeners[l]&&this.listeners[l].forEach(d=>{try{d(c)}catch(n){console.error(`Error in ${l} listener:`,n)}})}disconnect(){this.isManualClose=!0,this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}}const Pe=new wa;function Sa(){const{user:t,isUltraPackage:l,isRealTimeProductSyncEnabled:c}=oe(),{products:d,refreshProducts:n}=Mt(),[i,a]=s.useState([]),[o,p]=s.useState([]),[h,x]=s.useState(!1),[g,r]=s.useState("all"),[C,y]=s.useState(""),[N,v]=s.useState(!1),[w,f]=s.useState(!1),[b,A]=s.useState(!1),[z,W]=s.useState(!1),[_,L]=s.useState(null),[H,$]=s.useState({}),[I,F]=s.useState({weight:"",price:""}),[K,ce]=s.useState(null),[me,te]=s.useState(null),[ke,pe]=s.useState(!1),[re,ge]=s.useState(null),[S,j]=s.useState(""),[k,E]=s.useState({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),[U,J]=s.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[M,ee]=s.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0}),B=async()=>{try{console.log("ðŸ“¦ Loading inventory data..."),await n();const u=await kt.getAll();p(u),console.log("âœ… Inventory data loaded")}catch(u){console.error("âŒ Failed to load data:",u),se("Failed to load inventory data","error")}};s.useEffect(()=>{h||(B(),x(!0));const u=localStorage.getItem("token");return u&&(Pe.connect(u,P=>{P&&P.allProducts&&P.allProducts.length>0&&(console.log("ðŸ“¦ WebSocket stock update received:",P.allProducts.length,"products"),a(R=>{if(R.length===0)return P.allProducts;const X=new Map(R.map(V=>[V.id,V]));return P.allProducts.forEach(V=>{const le=X.get(V.id);le?X.set(V.id,{...le,quantity:V.quantity}):X.set(V.id,V)}),Array.from(X.values())}))}).catch(P=>{console.warn("WebSocket connection failed:",P)}),Pe.on("sale_completed",P=>{if(console.log("ðŸ”„ Sale completed - updating inventory display:",P),P.updatedProducts&&P.updatedProducts.length>0&&(console.log(`âœ… Updating ${P.updatedProducts.length} products from sale`),a(P.updatedProducts),se(`âœ… Stock updated! Sale #${P.saleId} deducted inventory`,"success")),P.lowStockWarnings&&P.lowStockWarnings.length>0){const R=P.lowStockWarnings.map(X=>`${X.name}: ${X.current} left`).join(", ");se(`âš ï¸ Low stock alert: ${R}`,"warning")}})),()=>{Pe.disconnect()}},[h]),s.useEffect(()=>{d&&d.length>0&&i.length===0&&(console.log("ðŸ“¦ Initial sync from global context:",d.length,"products"),a(d))},[]);const Ce=(u,P=!0)=>{const R=u.target.files[0];if(R){if(R.size>2*1024*1024){se("Image must be smaller than 2MB","error");return}const X=new FileReader;X.onload=V=>{const le=V.target.result;j(le),P?E({...k,image:le}):(ee({...M,image:le}),M.id&&setTimeout(async()=>{try{await ue.update(M.id,{image:le}),se("âœ… Image saved","success")}catch(Fe){console.error("Failed to save image:",Fe)}},500))},X.readAsDataURL(R)}},ie=u=>o.filter(R=>R.productId===u&&R.quantity>0).reduce((R,X)=>R+X.quantity,0),Le=u=>o.filter(P=>P.productId===u&&P.quantity>0),se=(u,P="success")=>{te({message:u,type:P}),setTimeout(()=>te(null),5e3)},qe=async u=>{u.preventDefault();try{const P={...k,price:parseFloat(k.price),cost:parseFloat(k.cost||0),quantity:0,visibleToCashier:!k.expenseOnly&&k.visibleToCashier!==!1},R=await ue.create(P);E({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),j(""),v(!1),se(`âœ… Product "${R.name}" added successfully! ${R.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success"),B().catch(X=>console.warn("Background refresh failed:",X))}catch(P){console.error("Failed to create product:",P),alert(`Failed to create product: ${P.message||"Unknown error"}`)}},Pt=async u=>{u.preventDefault();try{const P={id:`batch-${Date.now()}`,productId:_.id,quantity:parseInt(U.quantity),expiryDate:U.expiryDate,batchNumber:U.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(U.cost||_.cost||0)};p(R=>[...R,P]),se("âš¡ Adding stock...","info");try{await kt.create({productId:_.id,quantity:parseInt(U.quantity),expiryDate:U.expiryDate,batchNumber:U.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(U.cost||_.cost||0)}),J({quantity:"",expiryDate:"",batchNumber:"",cost:""}),A(!1),L(null),se(`âœ… Stock added successfully for ${_.name}!`,"success"),B().catch(R=>console.warn("Background refresh failed:",R))}catch(R){throw p(X=>X.filter(V=>V.id!==P.id)),R}}catch(P){console.error("Failed to add stock:",P),se(`âŒ Failed to add stock: ${P.message||"Unknown error"}`,"error")}},Ke=async u=>{u.preventDefault();try{const P=i.find(V=>V.id===M.id);if(parseFloat(M.price)<P.price){alert("You cannot lower prices, only increase.");return}const R={...M,price:parseFloat(M.price),cost:parseFloat(M.cost),quantity:parseFloat(M.quantity)},X={...P,...R};a(V=>V.map(le=>le.id===M.id?X:le)),pe(!0),se("âš¡ Updating product...","info");try{const V=await ue.update(M.id,R);f(!1),c()?(window.dispatchEvent(new CustomEvent("productUpdated",{detail:{product:V,originalProduct:P,timestamp:new Date().toISOString(),type:"update"}})),se("âœ… Product updated and synced!","success")):se("âœ… Product updated successfully!","success"),ge(new Date)}catch(V){throw a(le=>le.map(Fe=>Fe.id===M.id?P:Fe)),V}finally{pe(!1)}}catch(P){console.error("Failed to update product:",P),se(`âŒ Update failed: ${P.message||"Unknown error"}`,"error")}},xt=async u=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const P=i.find(X=>X.id===u),R=await ue.delete(u);if(a(X=>X.filter(V=>V.id!==u)),c()&&P)pe(!0),window.dispatchEvent(new CustomEvent("productDeleted",{detail:{product:P,timestamp:new Date().toISOString(),type:"delete"}})),se(`ðŸ“¡ Product "${P.name}" deleted and synced to all dashboards!`,"success"),ge(new Date),setTimeout(()=>{pe(!1)},3e3);else{const X=R?.message||"Product deleted successfully!";alert(X)}await n()}catch(P){console.error("Failed to delete product:",P);let R="Failed to delete product";P.message.includes("Failed to execute")||P.message.includes("JSON")?R="Network error. Please check your connection and try again.":P.message.includes("401")||P.message.includes("unauthorized")?R="You are not authorized to delete this product.":P.message.includes("404")||P.message.includes("not found")?R="Product not found. It may have been deleted already.":P.message&&(R=`Failed to delete product: ${P.message}`),alert(R)}},Be=(i||[]).filter(u=>{if(!u)return!1;const P=u.name?.toLowerCase().includes(C.toLowerCase()),R=g==="all"||g==="raw"&&!u.recipe||g==="composite"&&u.recipe||g==="expense"&&u.expenseOnly||g==="low-stock"&&u.quantity<10;return P&&R}),Ge=(i||[]).filter(u=>u&&!u.recipe&&!u.expenseOnly),Ve=(i||[]).filter(u=>u&&u.recipe),at=(i||[]).filter(u=>u&&u.expenseOnly),ut=u=>{if(!u||!u.recipe)return 0;let P=1/0;return(u.recipe||[]).forEach(R=>{if(!R)return;const X=(i||[]).find(V=>V&&V.id===R.productId);if(X&&X.quantity>0&&R.quantity>0){const V=Math.floor(X.quantity/R.quantity);P=Math.min(P,V)}}),P===1/0?0:P},qt=u=>{if(!u)return 0;if(!u.recipe)return u.cost||0;let P=0;return(u.recipe||[]).forEach(R=>{if(!R)return;const X=(i||[]).find(V=>V&&V.id===R.productId);if(X&&X.quantity>0){const V=(X.cost||0)/X.quantity;P+=V*(R.quantity||0)}}),P},ht=async u=>{L(u);try{const P=await ue.getWeightPricing(u.id);$(P.weightPricing||{})}catch(P){console.error("Failed to load weight pricing:",P),$({})}W(!0)},Bt=async u=>{if(u.preventDefault(),!I.weight||!I.price){se("âŒ Please enter both weight and price","error");return}try{const P=parseFloat(I.weight),R=parseFloat(I.price);if(P*10%1!==0){se("âŒ Weight must be in 0.1kg increments (0.1, 0.2, 0.3, etc)","error");return}await ue.addWeightPrice(_.id,P,R),$({...H,[String(P)]:R}),F({weight:"",price:""}),se(`âœ… Weight price added for ${P}kg`,"success")}catch(P){se(`âŒ Failed to add weight price: ${P.message}`,"error")}},Oe=async u=>{if(confirm(`Delete pricing for ${u}kg?`))try{await ue.deleteWeightPrice(_.id,u);const P={...H};delete P[String(u)],$(P),se(`âœ… Weight price for ${u}kg deleted`,"success")}catch(P){se(`âŒ Failed to delete weight price: ${P.message}`,"error")}};return e.jsxs("div",{className:"p-6 space-y-6",children:[me&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${me.type==="success"?"bg-green-50 border border-green-200 text-green-800":me.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:me.message}),e.jsx("button",{onClick:()=>te(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(mt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:C,onChange:u=>y(u.target.value)})]}),e.jsxs("select",{value:g,onChange:u=>r(u.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>v(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:Ge.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:Ve.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:at.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(Be||[]).map(u=>{if(!u)return null;const P=qt(u),R=u.price?((u.price-P)/u.price*100).toFixed(1):0,X=ut(u),V=K===u.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[u.image?e.jsx("img",{src:u.image,alt:u.name,className:"w-12 h-12 object-cover rounded-lg",onError:le=>{le.target.style.display="none",le.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:u.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[u.recipe&&e.jsx("button",{onClick:()=>ce(V?null:u.id),className:"p-1 hover:bg-gray-200 rounded",children:V?e.jsx(Fs,{className:"w-4 h-4"}):e.jsx(Us,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:u.name}),u.quantity<10&&!u.recipe&&e.jsx(Ze,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${u.expenseOnly?"badge-warning":u.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:u.expenseOnly?"Expense":u.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",u.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",P.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${ie(u.id)===0?"text-red-600":ie(u.id)<10?"text-yellow-600":"text-gray-900"}`,children:[ie(u.id)," ",u.unit]}),ie(u.id)<10&&ie(u.id)>0&&e.jsx(Ze,{className:"w-4 h-4 text-yellow-500"}),ie(u.id)===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600",children:[Le(u.id).length," active"]}),e.jsx("button",{onClick:()=>{L(u),A(!0)},className:"p-1 hover:bg-blue-50 rounded text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(je,{className:"w-3 h-3"})})]})}),e.jsx("td",{className:"px-4 py-3",children:u.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[X," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${R>30?"text-green-600":R>15?"text-yellow-600":"text-red-600"}`,children:[R,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ht(u),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600 transition-colors",title:"Edit weight-based pricing",children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{ee(u),f(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(Je,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>xt(u.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(ve,{className:"w-4 h-4"})})]})})]},u.id),V&&u.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(u.recipe||[]).map((le,Fe)=>{if(!le)return null;const Te=(i||[]).find(ze=>ze&&ze.id===le.productId);if(!Te)return null;const Ee=(Te.cost||0)/(Te.quantity||1),It=Ee*(le.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:Te.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[le.quantity||0," ",Te.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[Te.quantity||0," ",Te.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",Ee.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",It.toFixed(2)]})]},Fe)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",P.toFixed(2)]})]})})]})]})})})]})})})]})})}),b&&_&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Add Stock for ",_.name]}),e.jsxs("form",{onSubmit:Pt,className:"space-y-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:U.quantity,onChange:u=>J({...U,quantity:u.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:U.expiryDate,onChange:u=>J({...U,expiryDate:u.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:U.batchNumber,onChange:u=>J({...U,batchNumber:u.target.value})}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost per Unit",className:"input",value:U.cost,onChange:u=>J({...U,cost:u.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{A(!1),L(null),J({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:qe,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:k.name,onChange:u=>E({...k,name:u.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:u=>Ce(u,!0),className:"input"}),e.jsx(rs,{className:"w-5 h-5 text-gray-400"})]}),(S||k.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:S||k.image,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:k.price,onChange:u=>E({...k,price:u.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:k.cost,onChange:u=>E({...k,cost:u.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:k.category,onChange:u=>E({...k,category:u.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsxs("select",{className:"input",value:k.unit,onChange:u=>E({...k,unit:u.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k.expenseOnly,onChange:u=>E({...k,expenseOnly:u.target.checked,visibleToCashier:!u.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!k.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k.visibleToCashier,onChange:u=>E({...k,visibleToCashier:u.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{v(!1),j(""),E({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0})},className:"btn-secondary",children:"Cancel"})]})]})]})}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:Ke,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:M.name,onChange:u=>ee({...M,name:u.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:M.image||"",onChange:u=>ee({...M,image:u.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:u=>{const P=u.target.files[0];if(P){const R=new FileReader;R.onloadend=()=>{ee({...M,image:R.result})},R.readAsDataURL(P)}}})]}),M.image&&e.jsx("img",{src:M.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:M.price||"",onChange:u=>ee({...M,price:u.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:M.cost||"",onChange:u=>ee({...M,cost:u.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:M.quantity||"",onChange:u=>ee({...M,quantity:u.target.value}),required:!0}),e.jsxs("select",{className:"input",value:M.unit||"pcs",onChange:u=>ee({...M,unit:u.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:M.category||"raw",onChange:u=>ee({...M,category:u.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:M.expenseOnly||!1,onChange:u=>ee({...M,expenseOnly:u.target.checked,visibleToCashier:!u.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!M.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:M.visibleToCashier!==!1,onChange:u=>ee({...M,visibleToCashier:u.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>f(!1),className:"btn-secondary",children:"Cancel"})]})]})]})}),z&&_&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-96 overflow-y-auto",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Weight-Based Pricing - ",_.name]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Set different prices for different weights (in 0.1kg increments)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700",children:"Add New Weight Price"}),e.jsxs("form",{onSubmit:Bt,className:"flex gap-3",children:[e.jsx("input",{type:"number",step:"0.1",min:"0.1",placeholder:"Weight (kg) - e.g., 0.1, 0.5, 1.0",className:"input flex-1",value:I.weight,onChange:u=>F({...I,weight:u.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Price (KSH)",className:"input flex-1",value:I.price,onChange:u=>F({...I,price:u.target.value}),required:!0}),e.jsx("button",{type:"submit",className:"btn-primary whitespace-nowrap",children:"Add Price"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Current Prices"}),Object.keys(H).length>0?e.jsx("div",{className:"space-y-2",children:Object.entries(H).sort(([u],[P])=>parseFloat(u)-parseFloat(P)).map(([u,P])=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-medium",children:[u," kg"]}),e.jsxs("span",{className:"text-gray-600 ml-4",children:["KSH ",parseFloat(P).toLocaleString()]})]}),e.jsx("button",{onClick:()=>Oe(u),className:"text-red-600 hover:bg-red-50 px-3 py-1 rounded text-sm font-medium transition-colors",children:"Delete"})]},u))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No weight-based pricing set. Add one above."})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Base price:"})," KSH ",_.price?.toLocaleString()]})})]}),e.jsx("div",{className:"flex gap-2 mt-6",children:e.jsx("button",{onClick:()=>{W(!1),L(null),$({}),F({weight:"",price:""})},className:"btn-secondary flex-1",children:"Done"})})]})})]})}function ka(){const[t,l]=s.useState([]),[c,d]=s.useState([]),[n,i]=s.useState(!1),[a,o]=s.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});s.useEffect(()=>{p()},[]);const p=async()=>{const N=await ue.getAll();l(N),d(N.filter(v=>!v.recipe))},h=()=>{o({...a,ingredients:[...a.ingredients,{name:"",quantity:"",unit:"pcs"}]})},x=(N,v,w)=>{const f=[...a.ingredients];f[N][v]=w,o({...a,ingredients:f})},g=N=>{o({...a,ingredients:a.ingredients.filter((v,w)=>w!==N)})},r=()=>a.ingredients.reduce((N,v)=>{const w=c.find(f=>f.name.toLowerCase()===v.name.toLowerCase());if(w&&v.quantity){const f=w.cost/w.quantity;return N+f*parseFloat(v.quantity)}return N},0),C=async N=>{N.preventDefault();const v=[];for(const f of a.ingredients){if(!f.name||!f.quantity)continue;const b=c.find(A=>A.name.toLowerCase()===f.name.toLowerCase());b?v.push({productId:b.id,quantity:parseFloat(f.quantity),unit:f.unit||"pcs"}):v.push({name:f.name,quantity:parseFloat(f.quantity),unit:f.unit||"pcs"})}if(v.length===0){alert("Please add at least one ingredient");return}const w=r();try{await ue.create({name:a.name,price:parseFloat(a.price),cost:w,quantity:0,unit:"pcs",category:"composite",recipe:v,image:a.image||"",visibleToCashier:a.visibleToCashier,expenseOnly:!1}),o({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),i(!1),p(),alert("Recipe created successfully!")}catch(f){console.error("Error creating recipe:",f),alert("Failed to create recipe. Please try again.")}},y=t.filter(N=>N.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>i(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",y.length,")"]}),y.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:y.map(N=>{const v=N.recipe.reduce((f,b)=>{if(b.productId){const A=t.find(z=>z.id===b.productId);if(A){const z=A.cost/A.quantity;return f+z*b.quantity}}else if(b.name){const A=t.find(z=>z.name.toLowerCase()===b.name.toLowerCase());if(A){const z=A.cost/A.quantity;return f+z*b.quantity}}return f},0),w=((N.price-v)/N.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:N.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",N.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",v.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${w>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",w,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(ve,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:N.recipe.map((f,b)=>{let A="",z=f.unit||"pcs";if(f.productId){const W=t.find(_=>_.id===f.productId);W&&(A=W.name,z=W.unit)}else f.name&&(A=f.name,z=f.unit||"pcs");return A?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:A}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[f.quantity," ",z]})]},b):null})})]})]},N.id)})})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:a.name,onChange:N=>o({...a,name:N.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:a.price,onChange:N=>o({...a,price:N.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:a.image,onChange:N=>o({...a,image:N.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.visibleToCashier,onChange:N=>o({...a,visibleToCashier:N.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:h,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:a.ingredients.map((N,v)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:N.name,onChange:w=>x(v,"name",w.target.value),required:!0,list:`ingredients-list-${v}`}),e.jsx("datalist",{id:`ingredients-list-${v}`,children:c.map(w=>e.jsxs("option",{value:w.name,children:[w.name," (",w.quantity," ",w.unit," available)"]},w.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:N.quantity,onChange:w=>x(v,"quantity",w.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:N.unit,onChange:w=>x(v,"unit",w.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>g(v),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(ve,{className:"w-4 h-4"})})]},v))}),a.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),a.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",r().toFixed(2)]})]}),a.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(a.price)-r())/parseFloat(a.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(Rs,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{i(!1),o({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ca(){const[t,l]=s.useState([]),[c,d]=s.useState("all"),[n,i]=s.useState([]),[a,o]=s.useState(!1);s.useEffect(()=>{p()},[]);const p=async()=>{const v=await Ct.getAll();l(v.reverse())},h=async v=>{if(window.confirm("Delete this sale? This action cannot be undone."))try{o(!0);const w=localStorage.getItem("token");if(!(await fetch(`${ae}/sales/${v}`,{method:"DELETE",headers:{Authorization:`Bearer ${w}`}})).ok)throw new Error("Failed to delete sale");l(t.filter(b=>b.id!==v)),alert("Sale deleted successfully")}catch(w){alert("Failed to delete sale: "+w.message)}finally{o(!1)}},x=async()=>{if(n.length===0){alert("No sales selected");return}if(window.confirm(`Delete ${n.length} sales? This action cannot be undone.`))try{o(!0);const v=localStorage.getItem("token");if(!(await fetch(`${ae}/sales/bulk-delete`,{method:"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:JSON.stringify({saleIds:n})})).ok)throw new Error("Failed to delete sales");l(t.filter(f=>!n.includes(f.id))),i([]),alert("Sales deleted successfully")}catch(v){alert("Failed to delete sales: "+v.message)}finally{o(!1)}},g=async()=>{if(window.confirm("Clear ALL sales data? This will delete everything and cannot be undone."))try{o(!0);const v=localStorage.getItem("token");if(!(await fetch(`${ae}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:JSON.stringify({type:"sales"})})).ok)throw new Error("Failed to clear sales");l([]),i([]),alert("All sales data cleared")}catch(v){alert("Failed to clear sales: "+v.message)}finally{o(!1)}},r=t.filter(v=>{if(c==="today")return new Date(v.createdAt).toDateString()===new Date().toDateString();if(c==="week"){const w=new Date;return w.setDate(w.getDate()-7),new Date(v.createdAt)>=w}return!0}),C=r.reduce((v,w)=>v+w.total,0),y=r.reduce((v,w)=>v+(w.cogs||0),0),N=C-y;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:c,onChange:v=>d(v.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]}),n.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[n.length," selected"]}),e.jsxs("button",{onClick:x,disabled:a,className:"px-3 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),"Delete Selected"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:g,disabled:a||t.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4"}),"Clear All Sales"]}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(Ms,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",C.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",y.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",N.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:n.length===r.length&&r.length>0,onChange:v=>{v.target.checked?i(r.map(w=>w.id)):i([])},className:"rounded"})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Action"})]})}),e.jsx("tbody",{children:r.map(v=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:n.includes(v.id),onChange:w=>{w.target.checked?i([...n,v.id]):i(n.filter(f=>f!==v.id))},className:"rounded"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",v.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(v.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[v.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:v.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",v.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",v.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",v.profit?.toLocaleString()||0]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("button",{onClick:()=>h(v.id),disabled:a,className:"px-3 py-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),"Delete"]})})]},v.id))})]})})]})]})}function Pa(){const[t,l]=s.useState([]),[c,d]=s.useState(!1),[n,i]=s.useState({description:"",amount:"",category:"general"}),[a,o]=s.useState(null);s.useEffect(()=>{h();const y=localStorage.getItem("token");return y&&(Pe.connect(y).catch(N=>{console.warn("WebSocket connection failed:",N)}),Pe.on("sale_completed",N=>{console.log("ðŸ’° Sale completed - updating expenses:",N),h(),N.saleId&&p(`âœ… Expenses updated from Sale #${N.saleId}`,"success")})),()=>{Pe.disconnect()}},[]);const p=(y,N)=>{o({message:y,type:N}),setTimeout(()=>o(null),3e3)},h=async()=>{const y=await St.getAll();l(y.reverse())},x=async y=>{y.preventDefault(),await St.create({...n,amount:parseFloat(n.amount)}),i({description:"",amount:"",category:"general"}),d(!1),h()},g=t.reduce((y,N)=>y+N.amount,0),r=t.filter(y=>!y.automatic),C=t.filter(y=>y.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[a&&e.jsx("div",{className:`fixed top-4 right-4 p-4 rounded-lg text-white font-medium z-50 ${a.type==="success"?"bg-green-600":"bg-blue-600"}`,children:a.message}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",g.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",r.reduce((y,N)=>y+N.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",C.reduce((y,N)=>y+N.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.map(y=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(y.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:y.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:y.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${y.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:y.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",y.amount?.toLocaleString()]})]},y.id))})]})})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:n.description,onChange:y=>i({...n,description:y.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:n.amount,onChange:y=>i({...n,amount:y.target.value}),required:!0}),e.jsxs("select",{className:"input",value:n.category,onChange:y=>i({...n,category:y.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>d(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ia(){const{isCashierUserManagementEnabled:t,isCashier:l}=oe(),[c,d]=s.useState([]),[n,i]=s.useState(!0),[a,o]=s.useState(!1),[p,h]=s.useState(null),[x,g]=s.useState(null),[r,C]=s.useState(null),[y,N]=s.useState(0),[v,w]=s.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),[f,b]=s.useState(!1),[A,z]=s.useState(null),[W,_]=s.useState("");s.useEffect(()=>{L()},[]),s.useEffect(()=>()=>{r?.intervalId&&clearInterval(r.intervalId)},[r]);const L=async()=>{try{i(!0);const j=await We.getAll();d(Array.isArray(j)?j:[])}catch(j){console.error("Error loading users:",j),d([])}finally{i(!1)}},H=()=>Math.floor(1e3+Math.random()*9e3).toString(),$=async j=>{if(j.preventDefault(),console.log("Form submitted with data:",v),!v.name?.trim()||!v.email?.trim()||!v.password?.trim()){alert("Please fill in all required fields");return}if(v.password.length<6){alert("Password must be at least 6 characters long");return}try{i(!0);const k=H(),E={name:v.name.trim(),email:v.email.trim().toLowerCase(),password:v.password.trim(),pin:k};console.log("Sending user data:",E);const U=await We.create(E);console.log("User creation result:",U),await L();const J=`âœ… Cashier added successfully!

ðŸ“§ Email: ${E.email}
ðŸ”‘ Password: ${E.password}
ðŸ”¢ PIN: ${k}

ðŸ’¡ LOGIN OPTIONS:
1. Email + Password: Use email and password above
2. PIN Login: Use email + ${k}

Please share these credentials securely with the new cashier.`;alert(J),w({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),o(!1)}catch(k){console.error("Error creating cashier:",k);let E="Failed to add cashier";k.message.includes("Current user not found")?E="Authentication error. Please refresh the page and try again.":k.message.includes("email")?E="Email already exists. Please use a different email.":k.message.includes("network")||k.message.includes("fetch")?E="Network error. Please check your connection and try again.":k.message&&(E=`Failed to add cashier: ${k.message}`),alert(E)}finally{i(!1)}},I=async(j,k)=>{try{i(!0),await We.update(j,{permissions:k}),await L(),h(null)}catch(E){console.error("Error updating permissions:",E),alert("Failed to update permissions: "+E.message)}finally{i(!1)}},F=async(j,k)=>{try{i(!0);const E=!k,U=await fetch(`${ae}/users/${j}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({active:E})});if(!U.ok){const J=await U.json().catch(()=>({error:"Network error"}));throw new Error(J.error||`HTTP ${U.status}: ${U.statusText}`)}await L()}catch(E){console.error("Error updating user status:",E),alert("Failed to update user status: "+E.message)}finally{i(!1)}},K=async(j,k)=>{try{i(!0);const E=!k,U=await fetch(`${ae}/users/${j}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({locked:E})});if(!U.ok){const J=await U.json().catch(()=>({error:"Network error"}));throw new Error(J.error||`HTTP ${U.status}: ${U.statusText}`)}await L()}catch(E){console.error("Error updating user lock status:",E),alert("Failed to update user lock status: "+E.message)}finally{i(!1)}},ce=async j=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{i(!0),await We.delete(j),await L()}catch(k){console.error("Error deleting user:",k),alert("Failed to delete user: "+k.message)}finally{i(!1)}},me=async()=>{if(window.confirm("Clear ALL users data? This will delete all users and cannot be undone."))try{i(!0);const j=localStorage.getItem("token");if(!(await fetch(`${ae}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"},body:JSON.stringify({type:"users"})})).ok)throw new Error("Failed to clear users");d([]),alert("All users data cleared")}catch(j){alert("Failed to clear users: "+j.message)}finally{i(!1)}},te=j=>{z(j),_(H()),b(!0)},ke=async()=>{try{i(!0),await We.update(A.id,{cashierPIN:W}),await L(),b(!1),z(null),_(""),alert(`âœ… PIN reset successfully!

ðŸ”¢ New PIN for ${A.name}: ${W}

Please share this PIN securely with the cashier.`)}catch(j){console.error("Error resetting PIN:",j),alert("Failed to reset PIN: "+j.message)}finally{i(!1)}},pe=j=>{g(j),C({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const k=setInterval(()=>{ge(j)},3e3);C(E=>({...E,intervalId:k})),ge(j)},re=()=>{r?.intervalId&&clearInterval(r.intervalId),g(null),C(null)},ge=async j=>{try{const k=await Ct.getAll(),U=(Array.isArray(k)?k:[]).filter(M=>M.cashierId===j.id).sort((M,ee)=>new Date(ee.createdAt)-new Date(M.createdAt)).slice(0,10),J={isActive:Math.random()>.3,currentCart:U.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:U.reduce((M,ee)=>M+ee.total,0),salesCount:U.length,lastActivity:U.length>0?new Date(U[0].createdAt).toLocaleTimeString():"No recent activity"};C(J)}catch(k){console.error("Error loading live view data:",k)}},S=(c||[]).filter(j=>j.role==="cashier");return n&&c.length===0?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),e.jsx("div",{className:"flex items-center gap-2",children:t()&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:me,disabled:n||c.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4"}),"Clear All Users"]}),e.jsxs("button",{onClick:()=>o(!0),className:"btn-primary flex items-center gap-2",disabled:n,children:[e.jsx(je,{className:"w-4 h-4"}),"Add Cashier"]})]})})]}),l()&&!t()&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(be,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"User Management Restricted"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The admin has disabled cashier user management. You cannot add, edit, or remove users at this time."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:c.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:S.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:c.filter(j=>j.active).length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(c||[]).map(j=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:j.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:j.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${j.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:j.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:j.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:j.role==="cashier"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:j.pin||j.cashierPIN||"----"}),e.jsx("button",{onClick:()=>te(j),className:"p-1 hover:bg-yellow-50 rounded text-yellow-600",title:"Reset PIN",disabled:n,children:e.jsx(Je,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${j.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:j.active?e.jsxs(e.Fragment,{children:[e.jsx(_t,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(Wt,{className:"w-3 h-3"}),"Inactive"]})}),j.locked&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:[e.jsx(Nt,{className:"w-3 h-3"}),"Locked"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>F(j.id,j.active),className:`p-2 rounded-lg transition ${j.active?"hover:bg-red-50 text-red-600":"hover:bg-green-50 text-green-600"}`,title:j.active?"Deactivate User":"Activate User",disabled:n,children:j.active?e.jsx(Wt,{className:"w-4 h-4"}):e.jsx(_t,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>K(j.id,j.locked||!1),className:`p-2 rounded-lg transition ${j.locked?"hover:bg-green-50 text-green-600":"hover:bg-red-50 text-red-600"}`,title:j.locked?"Unlock User":"Lock User",disabled:n,children:e.jsx(Nt,{className:"w-4 h-4"})})]}),j.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",j.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(ns,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>pe(j),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(Ht,{className:"w-4 h-4"})})]}),t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>h(j),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600",title:"Edit Permissions",children:e.jsx(Je,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ce(j.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",title:"Delete User",disabled:n,children:e.jsx(ve,{className:"w-4 h-4"})})]})]})})]},j.id))})]}),c.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(et,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first cashier to get started"})]})]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:v.name||"",onChange:j=>{console.log("Name input changed:",j.target.value),w({...v,name:j.target.value})},required:!0,disabled:n}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:v.email||"",onChange:j=>{console.log("Email input changed:",j.target.value),w({...v,email:j.target.value})},required:!0,disabled:n}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:v.password||"",onChange:j=>{console.log("Password input changed:",j.target.value),w({...v,password:j.target.value})},required:!0,minLength:6,disabled:n}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(v.permissions).map(([j,k])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:E=>w({...v,permissions:{...v.permissions,[j]:E.target.checked}}),disabled:n}),e.jsx("span",{className:"text-sm capitalize",children:j.replace(/([A-Z])/g," $1").trim()})]},j))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:n,children:n?"Adding...":"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>o(!1),className:"btn-secondary",disabled:n,children:"Cancel"})]})]})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",p.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(p.permissions||{}).map(([j,k])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:E=>h({...p,permissions:{...p.permissions,[j]:E.target.checked}}),disabled:n}),e.jsx("span",{className:"text-sm capitalize",children:j.replace(/([A-Z])/g," $1").trim()})]},j))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>I(p.id,p.permissions),className:"btn-primary flex-1",disabled:n,children:n?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>h(null),className:"btn-secondary",disabled:n,children:"Cancel"})]})]})}),x&&r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(Ht,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",x.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:re,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(Ie,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${r.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:r.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx($e,{className:"w-4 h-4"}),"Last Activity: ",r.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ot,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(r.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(r.currentCart||[]).map((j,k)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[j.name," x",j.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",j.price.toLocaleString()]})]},k)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(r.currentCart||[]).reduce((j,k)=>j+k.price*k.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:r.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",r.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",r.salesCount>0?Math.round(r.totalSalesToday/r.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})}),f&&A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Reset PIN for ",A.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate a new 4-digit PIN for this cashier. The old PIN will be invalid."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"New PIN:"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-mono text-3xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:W})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>_(H()),className:"btn-secondary flex-1",disabled:n,children:"Generate New PIN"}),e.jsx("button",{onClick:ke,className:"btn-primary flex-1",disabled:n,children:n?"Updating...":"Confirm & Update"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>{b(!1),z(null),_("")},className:"btn-secondary w-full",disabled:n,children:"Cancel"})})]})})]})}function Aa(){const{user:t}=oe(),[l,c]=s.useState([]),[d,n]=s.useState("all"),[i,a]=s.useState(!0);s.useEffect(()=>{o();const r=setInterval(o,3e4);return()=>clearInterval(r)},[]);const o=async()=>{try{a(!0);const r=await jt.getAll();Array.isArray(r)&&(c(r.reverse()),console.log(`âœ… Loaded ${r.length} clock records from backend`))}catch(r){console.error("Failed to load clock records:",r),c([])}finally{a(!1)}},p=new Date().toDateString(),h=d==="all"?l:l.filter(r=>{try{return new Date(r.date||r.clockInTime).toDateString()===p}catch{return!1}}),x=l.filter(r=>{try{return new Date(r.date||r.clockInTime).toDateString()===p&&r.duration}catch{return!1}}).reduce((r,C)=>r+(C.duration||0),0)/60,g=r=>{let C=typeof r=="number"?r<120?r:Math.floor(r/60):0;const y=Math.floor(C/60),N=C%60;return`${y}h ${N}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx($e,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[x.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(Ut,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers Today"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(l.filter(r=>{try{return new Date(r.date||r.clockInTime).toDateString()===new Date().toDateString()}catch{return!1}}).map(r=>r.cashierId||r.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(vt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:l.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>n("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${d==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>n("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${d==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"}),e.jsx("button",{onClick:o,disabled:i,className:"px-4 py-2 rounded-lg text-sm font-medium bg-green-100 text-green-600 hover:bg-green-200 disabled:opacity-50",children:i?"Loading...":"Refresh"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:i?"Loading records...":"No records found"})}):h.map((r,C)=>{const y=new Date(r.clockInTime),N=r.clockOutTime?new Date(r.clockOutTime):null;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:r.cashierName||r.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:y.toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:y.toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:N?N.toLocaleTimeString():"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:r.duration?g(r.duration):"-"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${r.status==="clocked_in"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:r.status==="clocked_in"?"ðŸŸ¢ Clocked In":"âœ“ Clocked Out"})})]},C)})})]})})]})]})}function Ta(){const{user:t,updateUser:l}=oe();he();const[c,d]=s.useState(!1),[n,i]=s.useState(t?.plan||"ultra"),[a,o]=s.useState({}),[p,h]=s.useState(null),[x,g]=s.useState(t?.profilePicture||null),[r,C]=s.useState(!0),[y,N]=s.useState(!0);s.useEffect(()=>{v()},[]);const v=async()=>{try{const L=await ct.get();o(L),L.logo&&h(L.logo),C(L.cashierUserManagement!==!1),N(L.realTimeProductSync!==!1)}catch(L){console.error("Failed to load settings:",L)}},w=async L=>{try{const H={...a,...L};return await ct.update(H),o(H),!0}catch(H){return console.error("Failed to save settings:",H),!1}},f=async()=>{const L=!r;C(L),await w({cashierUserManagement:L})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{cashierUserManagement:L}})),alert(`âœ… Cashier User Management ${L?"ENABLED":"DISABLED"}`)):(C(!L),alert("âŒ Failed to save setting. Please try again."))},b=async()=>{const L=!y;N(L),await w({realTimeProductSync:L})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{realTimeProductSync:L}})),alert(`âœ… Real-time Product Sync ${L?"ENABLED":"DISABLED"}`)):(N(!L),alert("âŒ Failed to save setting. Please try again."))},A=async L=>{const H=L.target.files[0];if(H){const $=new FileReader;$.onloadend=async()=>{const I=$.result;h(I);try{await ct.update({...a,logo:I}),o({...a,logo:I})}catch(F){console.error("Failed to save logo:",F)}},$.readAsDataURL(H)}},z=async L=>{const H=L.target.files[0];if(H){const $=new FileReader;$.onloadend=async()=>{const I=$.result;g(I);try{await l({...t,profilePicture:I})}catch(F){console.error("Failed to save profile picture:",F)}},$.readAsDataURL(H)}},W=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],_=async()=>{const L=W.find($=>$.id===n),H=n==="ultra"?"admin":"cashier";await l({...t,role:H,plan:n,price:L.price}),d(!1),setTimeout(()=>window.location.href=H==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Ut,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[x?e.jsx("img",{src:x,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:t?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(Jt,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:z})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(He,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>d(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(Rt,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(et,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cashier User Management"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Cashier User Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow cashiers to add and remove users"})]}),e.jsx("button",{onClick:f,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${r?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${r?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${r?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:r?"âœ… Cashiers can add and remove users when enabled":"âŒ Cashiers cannot add or remove users when disabled"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(qs,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Real-time Product Sync"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Real-time Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync products between admin and cashier dashboards"})]}),e.jsx("button",{onClick:b,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${y?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${y?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${y?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:y?"âœ… Products will sync in real-time across all dashboards":"âŒ Products will not sync automatically across dashboards"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(Nt,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Bs,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[p&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:p,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(Jt,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:A})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:W.map(L=>e.jsxs("div",{onClick:()=>i(L.id),className:`card cursor-pointer transition-all ${n===L.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:L.name}),n===L.id&&e.jsx(tt,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",L.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:L.features.map((H,$)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(tt,{className:"w-4 h-4 text-green-600"}),H]},$))})]},L.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:_,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>d(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function Ea(){const[t,l]=s.useState([]),[c,d]=s.useState(!1),[n,i]=s.useState(null),[a,o]=s.useState({name:"",amount:"",description:"",active:!0});s.useEffect(()=>{p()},[]);const p=()=>{const r=JSON.parse(localStorage.getItem("serviceFees")||"[]");l(r)},h=r=>{localStorage.setItem("serviceFees",JSON.stringify(r)),l(r)},x=r=>{if(r.preventDefault(),n){const C=t.map(y=>y.id===n.id?{...a,id:y.id}:y);h(C)}else{const C={...a,id:Date.now(),createdAt:new Date().toISOString()};h([...t,C])}d(!1),i(null),o({name:"",amount:"",description:"",active:!0})},g=r=>{confirm("Delete this service fee?")&&h(t.filter(C=>C.id!==r))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{d(!0),i(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(r=>e.jsxs("div",{className:`card ${r.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Xe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:r.name}),e.jsx("p",{className:"text-xs text-gray-500",children:r.description})]})]}),e.jsx("span",{className:`badge ${r.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:r.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",r.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{i(r),o(r),d(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(Je,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>g(r.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(ve,{className:"w-4 h-4 text-red-600"})})]})]})]},r.id))}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:a.name,onChange:r=>o({...a,name:r.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:a.amount,onChange:r=>o({...a,amount:r.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:a.description,onChange:r=>o({...a,description:r.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.active,onChange:r=>o({...a,active:r.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>d(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Da(){const[t,l]=s.useState([]),[c,d]=s.useState([]),[n,i]=s.useState(!1),[a,o]=s.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});s.useEffect(()=>{p(),h()},[]);const p=async()=>{try{const y=localStorage.getItem("token"),N=await fetch(`${ae}/reminders`,{headers:{Authorization:`Bearer ${y}`}});if(!N.ok){console.error("API Error:",N.status,N.statusText),l([]);return}const v=await N.json();Array.isArray(v)?l(v):(console.error("Expected array but got:",typeof v,v),l([]))}catch(y){console.error("Failed to fetch reminders:",y),l([])}},h=async()=>{try{const y=localStorage.getItem("token"),N=await fetch(`${ae}/products`,{headers:{Authorization:`Bearer ${y}`}});if(!N.ok){console.error("API Error:",N.status,N.statusText),d([]);return}const v=await N.json();Array.isArray(v)?d(v):(console.error("Expected array but got:",typeof v,v),d([]))}catch(y){console.error("Failed to fetch products:",y),d([])}},x=async y=>{y.preventDefault();try{const N=localStorage.getItem("token"),v=await fetch(`${ae}/reminders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${N}`},body:JSON.stringify(a)});if(!v.ok){const f=await v.json();console.error("Failed to create reminder:",f),alert(`Failed to create reminder: ${f.error||"Unknown error"}`);return}const w=await v.json();o({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),i(!1),p(),alert("Reminder created successfully!")}catch(N){console.error("Failed to create reminder:",N),alert("Failed to create reminder. Please try again.")}},g=async y=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const v=localStorage.getItem("token"),w=await fetch(`${ae}/reminders/${y}`,{method:"DELETE",headers:{Authorization:`Bearer ${v}`}});if(!w.ok){const f=await w.json();console.error("Failed to delete reminder:",f),alert(`Failed to delete reminder: ${f.error||"Unknown error"}`);return}p(),alert("Reminder deleted successfully!")}catch(N){console.error("Failed to delete reminder:",N),alert("Failed to delete reminder. Please try again.")}},r=y=>{a.days.includes(y)?o({...a,days:a.days.filter(N=>N!==y)}):o({...a,days:[...a.days,y]})},C=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(Rt,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("button",{onClick:()=>i(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(je,{size:20}),"New Reminder"]})]}),e.jsx("div",{className:"grid gap-4",children:t.map(y=>{const N=c.find(v=>v.id===y.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${y.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:y.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",N?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",y.frequency]}),y.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",y.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(vt,{size:16}),"Next: ",new Date(y.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${y.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:y.status}),e.jsx("button",{onClick:()=>g(y.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(ve,{size:20})})]})]})},y.id)})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:x,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:a.customerName,onChange:y=>o({...a,customerName:y.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:a.productId,onChange:y=>o({...a,productId:parseInt(y.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),c.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:a.frequency,onChange:y=>o({...a,frequency:y.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),a.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:C.map(y=>e.jsx("button",{type:"button",onClick:()=>r(y),className:`px-4 py-2 rounded-lg font-medium transition ${a.days.includes(y)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:y},y))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:a.nextDate,onChange:y=>o({...a,nextDate:y.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>i(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})}function $a(){const[t,l]=s.useState([]),[c,d]=s.useState(!1),[n,i]=s.useState(null),[a,o]=s.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});s.useEffect(()=>{p()},[]);const p=async()=>{try{const r=await it.getAll();l(r)}catch(r){console.error("Failed to load discounts:",r)}},h=async r=>{r.preventDefault();try{n?await it.update(n.id,a):await it.create(a),d(!1),i(null),o({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),p()}catch(C){console.error("Failed to save discount:",C)}},x=async r=>{if(confirm("Delete this discount?"))try{await it.delete(r),p()}catch(C){console.error("Failed to delete discount:",C)}},g=r=>{const C=new Date,y=new Date(r.validFrom),N=new Date(r.validTo);return r.active&&y<=C&&N>=C};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{d(!0),i(null),o({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(r=>e.jsxs("div",{className:`card ${g(r)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${g(r)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(Lt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:r.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[r.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${g(r)?"badge-success":"bg-gray-200 text-gray-600"}`,children:g(r)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(r.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(r.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{i(r),o(r),d(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(Je,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>x(r.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(ve,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},r.id)),t.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(Lt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:a.name,onChange:r=>o({...a,name:r.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:a.percentage,onChange:r=>o({...a,percentage:parseFloat(r.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:a.validFrom,onChange:r=>o({...a,validFrom:r.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:a.validTo,onChange:r=>o({...a,validTo:r.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.active,onChange:r=>o({...a,active:r.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>d(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function La(){const[t,l]=s.useState([]),[c,d]=s.useState("all"),[n,i]=s.useState(null),[a,o]=s.useState(""),[p,h]=s.useState(!1),[x,g]=s.useState(null);s.useEffect(()=>{r();const b=setInterval(r,1e4);return()=>clearInterval(b)},[]);const r=async()=>{try{const b=await bt.getAll();l(b||[])}catch(b){console.error("Failed to load credit requests:",b)}},C=async b=>{i(b);try{await bt.update(b,{status:"approved"}),console.log("âœ… Credit request approved"),r()}catch(A){console.error("Failed to approve request:",A),alert("Failed to approve request: "+(A.message||"Unknown error"))}finally{i(null)}},y=b=>{g(b),h(!0)},N=async()=>{if(x){i(x.id);try{await bt.update(x.id,{status:"rejected",rejectionReason:a}),console.log("âœ… Credit request rejected"),h(!1),o(""),g(null),r()}catch(b){console.error("Failed to reject request:",b),alert("Failed to reject request: "+(b.message||"Unknown error"))}finally{i(null)}}},v=t.filter(b=>c==="all"?!0:b.status===c),w=b=>{switch(b){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},f=b=>{switch(b){case"pending":return e.jsx($e,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(Qe,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(ft,{className:"w-6 h-6 text-red-600"});default:return e.jsx(He,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(b=>e.jsxs("button",{onClick:()=>d(b),className:`px-4 py-2 rounded-lg font-medium transition ${c===b?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[b.charAt(0).toUpperCase()+b.slice(1),b==="pending"&&t.filter(A=>A.status==="pending").length>0&&e.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1",children:t.filter(A=>A.status==="pending").length})]},b))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[v.map(b=>e.jsx("div",{className:`card border-l-4 ${w(b.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${b.status==="pending"?"bg-orange-600":b.status==="approved"?"bg-green-600":"bg-red-600"}`,children:f(b.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:b.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Requested by: ",b.cashierName]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",b.amount?.toLocaleString()]})]}),b.reason&&e.jsxs("span",{children:["Reason: ",e.jsx("strong",{children:b.reason.replace(/_/g," ")})]})]}),b.notes&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Notes: ",b.notes]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(b.createdAt).toLocaleString()]}),b.approvalDate&&e.jsxs("p",{className:"text-xs text-gray-500",children:[b.status==="approved"?"Approved":"Processed",": ",new Date(b.approvalDate).toLocaleString(),b.approvedBy&&` by ${b.approvedBy}`]}),b.rejectionReason&&e.jsxs("p",{className:"text-xs text-red-600 mt-2",children:["Rejection reason: ",b.rejectionReason]})]})]}),b.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>C(b.id),disabled:n===b.id,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition disabled:opacity-50",children:[e.jsx(Qe,{size:16}),n===b.id?"Approving...":"Approve"]}),e.jsxs("button",{onClick:()=>y(b),disabled:n===b.id,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition disabled:opacity-50",children:[e.jsx(ft,{size:16}),n===b.id?"Rejecting...":"Reject"]})]}),b.status!=="pending"&&e.jsx("span",{className:`badge ${b.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:b.status.toUpperCase()})]})},b.id)),v.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(He,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",c!=="all"?c:""," credit requests found."]})]})]}),p&&x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-red-500 to-red-600 p-6 text-white flex items-center gap-3",children:[e.jsx(Re,{className:"w-6 h-6"}),e.jsx("h3",{className:"text-xl font-bold",children:"Reject Credit Request"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Are you sure you want to reject this credit request from ",e.jsx("strong",{children:x.customerName})," for ",e.jsxs("strong",{children:["KSH ",x.amount?.toLocaleString()]}),"?"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Rejection Reason"}),e.jsx("textarea",{placeholder:"Enter reason for rejection...",value:a,onChange:b=>o(b.target.value),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-red-500",rows:"4"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:N,disabled:n!==null,className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-bold transition disabled:opacity-50",children:n?"Rejecting...":"Confirm Rejection"}),e.jsx("button",{onClick:()=>{h(!1),o(""),g(null)},disabled:n!==null,className:"flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400 transition disabled:opacity-50",children:"Cancel"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[v.map(b=>e.jsx("div",{className:`card border-l-4 ${w(b.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${b.status==="pending"?"bg-orange-600":b.status==="approved"?"bg-green-600":"bg-red-600"}`,children:f(b.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:b.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:getProductName(b.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:b.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",b.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(b.createdAt).toLocaleString()]}),b.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(b.approvedAt).toLocaleString()]})]})]}),b.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>C(b.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Qe,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>handleReject(b.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(ft,{size:16}),"Reject"]})]}),b.status!=="pending"&&e.jsx("span",{className:`badge ${b.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:b.status.toUpperCase()})]})},b.id)),v.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(He,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",c!=="all"?c:""," credit requests found."]})]})]})]})}function Oa(){const[t,l]=s.useState([]),[c,d]=s.useState(!0),[n,i]=s.useState(!1),[a,o]=s.useState(null),[p,h]=s.useState(""),[x,g]=s.useState({name:"",email:"",phone:"",address:"",city:"",country:"",products:""});s.useEffect(()=>{r()},[]);const r=async()=>{try{d(!0);const f=localStorage.getItem("token"),b=await fetch(`${ae}/vendors`,{headers:{Authorization:`Bearer ${f}`}});if(b.ok){const A=await b.json();l(Array.isArray(A)?A:[])}}catch(f){console.error("Failed to load vendors:",f),l([])}finally{d(!1)}},C=()=>{o(null),g({name:"",email:"",phone:"",address:"",city:"",country:"",products:""}),i(!0)},y=f=>{o(f),g(f),i(!0)},N=async f=>{if(window.confirm("Are you sure you want to delete this vendor?"))try{const b=localStorage.getItem("token");(await fetch(`${ae}/vendors/${f}`,{method:"DELETE",headers:{Authorization:`Bearer ${b}`}})).ok?(l(t.filter(z=>z.id!==f)),alert("Vendor deleted successfully")):alert("Failed to delete vendor")}catch(b){console.error("Failed to delete vendor:",b),alert("Failed to delete vendor")}},v=async f=>{f.preventDefault();try{const b=localStorage.getItem("token"),A=a?"PUT":"POST",z=a?`${ae}/vendors/${a.id}`:`${ae}/vendors`,W=await fetch(z,{method:A,headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"},body:JSON.stringify(x)});if(W.ok){const _=await W.json();l(a?t.map(L=>L.id===_.id?_:L):[...t,_]),i(!1),alert(a?"Vendor updated":"Vendor added")}else alert("Failed to save vendor")}catch(b){console.error("Failed to save vendor:",b),alert("Failed to save vendor")}},w=t.filter(f=>f.name?.toLowerCase().includes(p.toLowerCase())||f.email?.toLowerCase().includes(p.toLowerCase()));return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Vendors"}),e.jsxs("button",{onClick:C,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(je,{className:"w-5 h-5"}),"Add Vendor"]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(mt,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search vendors...",value:p,onChange:f=>h(f.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"})]})}),c?e.jsx("div",{className:"text-center py-8",children:"Loading vendors..."}):w.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["No vendors found. ",t.length===0&&"Add your first vendor to get started."]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:w.map(f=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:f.name}),e.jsx("p",{className:"text-sm text-gray-500",children:f.products})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(f),className:"p-2 text-blue-600 hover:bg-blue-50 rounded",children:e.jsx(Je,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>N(f.id),className:"p-2 text-red-600 hover:bg-red-50 rounded",children:e.jsx(ve,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[f.email&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(wt,{className:"w-4 h-4"}),e.jsx("a",{href:`mailto:${f.email}`,children:f.email})]}),f.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(zs,{className:"w-4 h-4"}),e.jsx("a",{href:`tel:${f.phone}`,children:f.phone})]}),f.address&&e.jsxs("div",{className:"flex items-start gap-2 text-gray-600",children:[e.jsx(_s,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[f.address,f.city&&`, ${f.city}`,f.country&&`, ${f.country}`]})]})]})]},f.id))}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:a?"Edit Vendor":"Add Vendor"}),e.jsx("button",{onClick:()=>i(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(Ie,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vendor Name *"}),e.jsx("input",{type:"text",required:!0,value:x.name,onChange:f=>g({...x,name:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g., ABC Supplies"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Products/Services"}),e.jsx("input",{type:"text",value:x.products,onChange:f=>g({...x,products:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g., Vegetables, Fruits"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:x.email,onChange:f=>g({...x,email:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"vendor@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:x.phone,onChange:f=>g({...x,phone:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"+1 (555) 000-0000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("input",{type:"text",value:x.address,onChange:f=>g({...x,address:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Street address"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",value:x.city,onChange:f=>g({...x,city:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"City"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Country"}),e.jsx("input",{type:"text",value:x.country,onChange:f=>g({...x,country:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Country"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),className:"flex-1 px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"flex-1 px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700",children:[a?"Update":"Add"," Vendor"]})]})]})]})})]})}function gs({onClose:t}){const[l,c]=s.useState([]),[d,n]=s.useState(!0),i=s.useRef({data:null,timestamp:null}),a=3e4;s.useEffect(()=>{o()},[]);const o=async()=>{try{const h=Date.now();if(i.current.data&&i.current.timestamp&&h-i.current.timestamp<a){console.log("ðŸ“¦ Using cached reminders"),c(i.current.data),n(!1);return}const x=localStorage.getItem("token"),g=await fetch(`${ae}/reminders/today`,{headers:{Authorization:`Bearer ${x}`}});if(!g.ok){console.error("API Error:",g.status,g.statusText),c([]),n(!1);return}const r=await g.json();Array.isArray(r)?(i.current.data=r,i.current.timestamp=Date.now(),c(r)):(console.error("Expected array but got:",typeof r,r),c([]))}catch(h){console.error("Failed to fetch reminders:",h),c([])}finally{n(!1)}},p=async h=>{try{const x=localStorage.getItem("token");await fetch(`${ae}/reminders/${h}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify({status:"fulfilled"})}),i.current={data:null,timestamp:null},o()}catch(x){console.error("Failed to update reminder:",x)}};return d?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:t,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(Ie,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Re,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):l.map(h=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:h.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",h.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:h.frequency})]}),e.jsxs("button",{onClick:()=>p(h.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Qe,{size:18}),"Mark Done"]})]},h.id))})]})})}function fs({onUnlock:t,userType:l="user"}){const[c,d]=s.useState(""),[n,i]=s.useState(""),[a,o]=s.useState("password"),[p,h]=s.useState(!1),[x,g]=s.useState(""),[r,C]=s.useState(!1),[y,N]=s.useState("2005"),v=JSON.parse(localStorage.getItem("user")||"{}");s.useEffect(()=>{(async()=>{try{const A=await ct.get();A?.screenLockPassword&&N(A.screenLockPassword)}catch(A){console.warn("Failed to load settings, using default password:",A)}})()},[]),s.useEffect(()=>{const b=document.getElementById(a==="password"?"unlock-password":"unlock-pin");b&&b.focus()},[a]);const w=async b=>{b.preventDefault(),b.stopPropagation(),C(!0),g("");try{const A=localStorage.getItem("token");if(!A)throw new Error("No authentication token found");const z=await fetch("https://universal-backend-w0x1.onrender.com/api/auth/unlock-screen",{method:"POST",headers:{Authorization:`Bearer ${A}`,"Content-Type":"application/json"},body:JSON.stringify({pin:n})});if(!z.ok){const _=await z.json();throw z.status===429?new Error(_.message||"Too many failed attempts. Try again later."):z.status===401?new Error(_.message||"Incorrect PIN"):new Error(_.message||"Unlock failed")}const W=await z.json();W.token&&localStorage.setItem("token",W.token),i(""),d(""),t(W)}catch(A){g(A.message||"Unlock failed")}finally{C(!1)}},f=b=>{const A=b.replace(/\D/g,"").slice(0,4);i(A)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:b=>b.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8",onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${l==="main_admin"?"bg-gradient-to-br from-red-600 to-orange-600":"bg-gradient-to-br from-blue-600 to-purple-600"}`,children:e.jsx(be,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-gray-600",children:l==="main_admin"?"Main Admin":v.name||"User"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Enter your ",a," to continue"]})]}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter PIN to unlock"}),e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",id:"unlock-pin",value:n,onChange:b=>f(b.target.value),placeholder:"0000",maxLength:"4",className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-center tracking-widest text-2xl",disabled:r})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"ðŸ”’ PIN validated securely on server"})]}),x&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-red-700 text-sm font-medium",children:[x.includes("Too many")?"âŒ ":"âš ï¸ ",x]})}),e.jsx("button",{type:"submit",disabled:r||n.length<4,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 rounded-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"}),"Verifying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-5 h-5"}),"Unlock Screen"]})})]})]})})}function bs(t=6e4){const[l,c]=s.useState(!1),d=s.useRef(Date.now()),n=s.useCallback(()=>{d.current=Date.now(),c(!1)},[]),i=s.useCallback(()=>{c(!1),d.current=Date.now()},[]);return s.useEffect(()=>{const a=["mousedown","mousemove","keypress","scroll","touchstart","click"],o=()=>{d.current=Date.now(),l&&c(!1)};a.forEach(h=>{document.addEventListener(h,o,!0)});const p=setInterval(()=>{Date.now()-d.current>t&&!l&&c(!0)},5e3);return()=>{a.forEach(h=>{document.removeEventListener(h,o,!0)}),clearInterval(p)}},[t,l]),[l,i,n]}function Qt(){const{user:t,logout:l,isCashierUserManagementEnabled:c}=oe(),d=he(),n=ts(),[i,a]=s.useState(!0),[o,p]=s.useState(!1),[h,x]=s.useState({}),[g,r]=bs(45e3);s.useEffect(()=>{const w=()=>{const b=localStorage.getItem("user");if(b){const A=JSON.parse(b);let z=!1;(A.plan==="ultra"||A.role==="admin")&&(A.active||(A.active=!0,z=!0),A.plan==="ultra"&&A.role!=="admin"&&(A.role="admin",z=!0),A.plan==="ultra"&&(!A.price||A.price!==1600)&&(A.price=1600,z=!0),z&&(localStorage.setItem("user",JSON.stringify(A)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};w(),setTimeout(w,100);const f=setTimeout(()=>{p(!0)},1e3);return C(),()=>clearTimeout(f)},[]);const C=async()=>{try{const w=await ct.get();x(w)}catch(w){console.error("Failed to load settings:",w)}},y=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses data? This action cannot be undone."))try{const w=localStorage.getItem("token"),b=await fetch(`${ae}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${w}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!b.ok){const A=await b.json();throw new Error(A.message||"Failed to clear data")}alert("Data cleared successfully!"),window.location.reload()}catch(w){console.error("Failed to clear data:",w),alert("Failed to clear data: "+w.message)}},N=[{id:"overview",label:"Dashboard",icon:Ws,path:"/admin"},{id:"sales",label:"Sales",icon:as,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:Me,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:Hs,path:"/admin/recipes"},{id:"expenses",label:"Expenses",icon:dt,path:"/admin/expenses"},{id:"vendors",label:"Vendors",icon:Js,path:"/admin/vendors"},...c()?[{id:"users",label:"Users",icon:et,path:"/admin/users"}]:[],{id:"time",label:"Time Tracking",icon:$e,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:Rt,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:Xe,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:Lt,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:He,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:Ks,path:"/admin/settings"}],v=w=>w==="/admin"?n.pathname==="/admin":n.pathname.startsWith(w);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${i?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[i&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>a(!i),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i?e.jsx(Ie,{className:"w-5 h-5"}):e.jsx(Gs,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:N.map(w=>{const f=w.icon;return e.jsxs("button",{onClick:()=>d(w.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${v(w.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(f,{className:"w-5 h-5 flex-shrink-0"}),i&&e.jsx("span",{className:"font-medium",children:w.label})]},w.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(Vs,{className:"w-5 h-5 flex-shrink-0"}),i&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:l,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(Ae,{className:"w-5 h-5 flex-shrink-0"}),i&&e.jsx("span",{className:"font-medium",children:"Logout"})]}),e.jsxs("button",{onClick:y,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors",children:[e.jsx(Ie,{className:"w-5 h-5 flex-shrink-0"}),i&&e.jsx("span",{className:"font-medium",children:"Clear Data"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:N.find(w=>v(w.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:t?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(ss,{children:[e.jsx(Z,{path:"/",element:e.jsx(Na,{})}),e.jsx(Z,{path:"/sales",element:e.jsx(Ca,{})}),e.jsx(Z,{path:"/inventory",element:e.jsx(Sa,{})}),e.jsx(Z,{path:"/recipes",element:e.jsx(ka,{})}),e.jsx(Z,{path:"/expenses",element:e.jsx(Pa,{})}),e.jsx(Z,{path:"/vendors",element:e.jsx(Oa,{})}),e.jsx(Z,{path:"/reminders",element:e.jsx(Da,{})}),e.jsx(Z,{path:"/service-fees",element:e.jsx(Ea,{})}),e.jsx(Z,{path:"/discounts",element:e.jsx($a,{})}),e.jsx(Z,{path:"/credit-requests",element:e.jsx(La,{})}),e.jsx(Z,{path:"/users",element:e.jsx(Ia,{})}),e.jsx(Z,{path:"/time",element:e.jsx(Aa,{})}),e.jsx(Z,{path:"/settings",element:e.jsx(Ta,{})})]})})]}),o&&e.jsx(gs,{onClose:()=>p(!1)}),g&&e.jsx(fs,{onUnlock:r,logo:h.logo})]})}const Fa=`
  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideInDown {
    from {
      opacity: 0;
      transform: translateY(-30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeInScale {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes pulse-glow {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
    }
    50% {
      box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
    }
  }

  @keyframes float {
    0%, 100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-20px);
    }
  }

  @keyframes shimmer {
    0% {
      background-position: -1000px 0;
    }
    100% {
      background-position: 1000px 0;
    }
  }

  @keyframes bounce-in {
    0% {
      opacity: 0;
      transform: scale(0.8);
    }
    50% {
      opacity: 1;
    }
    100% {
      transform: scale(1);
    }
  }

  @keyframes word-slide {
    0% {
      opacity: 0;
      transform: translateX(-30px);
    }
    100% {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .animate-slide-up {
    animation: slideInUp 0.8s ease-out forwards;
  }

  .animate-slide-down {
    animation: slideInDown 0.8s ease-out forwards;
  }

  .animate-fade-scale {
    animation: fadeInScale 0.6s ease-out forwards;
  }

  .animate-pulse-glow {
    animation: pulse-glow 2s infinite;
  }

  .animate-float {
    animation: float 3s ease-in-out infinite;
  }

  .animate-bounce-in {
    animation: bounce-in 0.6s ease-out forwards;
  }

  .feature-card {
    animation: slideInUp 0.8s ease-out forwards;
  }

  .feature-card:nth-child(1) { animation-delay: 0.1s; }
  .feature-card:nth-child(2) { animation-delay: 0.2s; }
  .feature-card:nth-child(3) { animation-delay: 0.3s; }
  .feature-card:nth-child(4) { animation-delay: 0.4s; }
  .feature-card:nth-child(5) { animation-delay: 0.5s; }
  .feature-card:nth-child(6) { animation-delay: 0.6s; }

  .plan-card {
    animation: fadeInScale 0.7s ease-out forwards;
  }

  .plan-card:nth-child(1) { animation-delay: 0.2s; }
  .plan-card:nth-child(2) { animation-delay: 0.4s; }

  .stat-item {
    animation: slideInUp 0.8s ease-out forwards;
  }

  .stat-item:nth-child(1) { animation-delay: 0.1s; }
  .stat-item:nth-child(2) { animation-delay: 0.2s; }
  .stat-item:nth-child(3) { animation-delay: 0.3s; }
  .stat-item:nth-child(4) { animation-delay: 0.4s; }

  .hero-text {
    opacity: 0;
  }

  .hero-text-1 { animation: word-slide 0.6s ease-out 0.2s forwards; }
  .hero-text-2 { animation: word-slide 0.6s ease-out 0.4s forwards; }
  .hero-text-3 { animation: word-slide 0.6s ease-out 0.6s forwards; }

  .btn-animate {
    animation: slideInUp 0.8s ease-out 0.8s forwards;
    opacity: 0;
  }

  .glow-border {
    animation: pulse-glow 2s infinite;
  }
`;function Ua(){const t=he(),{user:l,loading:c,isInitialized:d}=oe(),[n,i]=s.useState(!1),[a,o]=s.useState(0);if(s.useEffect(()=>{d&&!c&&l&&(l.role==="owner"?t("/main-admin",{replace:!0}):l.role==="admin"?t("/admin",{replace:!0}):l.role==="cashier"?t("/cashier",{replace:!0}):t("/dashboard",{replace:!0}))},[l,c,d,t]),s.useEffect(()=>{const g=document.createElement("style");return g.textContent=Fa,document.head.appendChild(g),()=>document.head.removeChild(g)},[]),c||!d)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-4 border-white mx-auto mb-4"}),e.jsx("p",{className:"text-white text-lg",children:"Loading..."})]})});const p=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 1,600 - 1 Cashier) or Ultra (KSH 3,000 - Unlimited) package",image:"ðŸ“",details:"First user becomes Admin automatically. Basic supports 1 cashier. Ultra supports unlimited cashiers with full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],h=[{icon:Ue,title:"âš¡ Atomic Sales",desc:"Complete sales instantly (3-4ms) - never hanging, always consistent stock"},{icon:De,title:"ðŸ“Š Live Analytics",desc:"Real-time dashboard updates every 5 seconds with instant totals"},{icon:Ue,title:"ðŸ”’ Zero Race Conditions",desc:"File-based locking prevents stock conflicts even with simultaneous sales"},{icon:Me,title:"âš ï¸ Low-Stock Alerts",desc:"Automatic warnings when inventory drops below threshold"},{icon:Nt,title:"ðŸ’¯ 99.99% Reliability",desc:"Atomic transactions guarantee data integrity, never lost sales"},{icon:Ot,title:"ðŸš€ Performance+",desc:"Sales 50x faster, Analytics 140x faster than legacy systems"}],x=[{name:"Basic",price:1e3,icon:Ue,popular:!1,features:["âœ“ Admin + Cashier Dashboard","âœ“ Basic Inventory","âœ“ Sales Tracking","âœ“ Daily/Weekly Reports","âœ“ Basic Profit/Loss View","âœ“ Email Support","âœ“ 1 Cashier Only"]},{name:"Ultra",price:2500,icon:Ft,popular:!0,features:["âœ“ Admin + Cashier Dashboard","âœ“ Full Inventory Management","âœ“ Automatic Stock Deduction","âœ“ User Management (Unlimited)","âœ“ Permission Controls","âœ“ Expense Tracking","âœ“ Advanced Analytics","âœ“ Priority Support"]},{name:"Pro",price:3400,icon:Ft,popular:!1,features:["âœ“ All Ultra Features","âœ“ Recipe/BOM Builder","âœ“ COGS Calculation","âœ“ Composite Products","âœ“ Advanced Reporting","âœ“ Multi-location Support","âœ“ API Access","âœ“ Dedicated Support"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/auth/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>t("/choose-subscription"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(Ys,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>t("/choose-subscription"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(nt,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>i(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(is,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 30-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ot,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:h.map((g,r)=>{const C=g.icon;return e.jsxs("div",{className:"feature-card bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(C,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:g.title}),e.jsx("p",{className:"text-gray-600",children:g.desc})]},r)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:x.map((g,r)=>{const C=g.icon;return e.jsxs("div",{className:`plan-card relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${g.popular?"ring-4 ring-blue-600":""}`,children:[g.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${g.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(C,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:g.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",g.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:g.features.map((y,N)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(tt,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:y})]},N))}),e.jsx("button",{onClick:()=>t("/choose-subscription"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${g.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},r)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>t("/choose-subscription"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(nt,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{i(!1),o(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Ie,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",a+1," of ",p.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((a+1)/p.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(a+1)/p.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:p[a].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:p[a].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:p[a].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:p[a].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>o(Math.max(0,a-1)),disabled:a===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),a<p.length-1?e.jsxs("button",{onClick:()=>o(a+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(nt,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{i(!1),o(0),t("/choose-subscription")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(nt,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:p.map((g,r)=>e.jsx("button",{onClick:()=>o(r),className:`w-2 h-2 rounded-full transition-all ${r===a?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},r))})]})]})})]})}function Xt(){const t=ts(),[l,c]=s.useState(t.pathname==="/auth/login"),[d,n]=s.useState("password"),[i,a]=s.useState({email:"",password:"",pin:"",name:"",newPassword:"",confirmPassword:""}),[o,p]=s.useState(""),[h,x]=s.useState(!1),[g,r]=s.useState(!1),C=he(),{login:y}=oe(),N=()=>{try{return JSON.parse(localStorage.getItem("selectedPlan")||"null")}catch(w){return console.warn("Invalid selectedPlan in localStorage:",w),null}},v=async w=>{w.preventDefault(),p(""),x(!0);try{if(g){if(i.newPassword!==i.confirmPassword){p("Passwords do not match"),x(!1);return}if(i.newPassword.length<6){p("Password must be at least 6 characters"),x(!1);return}const W=await Ye.login({email:i.email,newPassword:i.newPassword});W.token&&W.user&&(await y(W),C("/dashboard"));return}if(l){if(d==="pin"){if(!i.pin||i.pin.length!==4){p("Please enter a valid 4-digit PIN"),x(!1);return}}else if(!i.password){p("Please enter your password"),x(!1);return}}let f;if(l)if(d==="pin")try{f=await Ye.pinLogin({email:i.email,pin:i.pin})}catch(W){if(W.message.includes("PIN not set"))p("PIN not set for this user. Please use password login.");else if(W.message.includes("Invalid PIN"))p("Invalid PIN. Please try again.");else throw W;x(!1);return}else f=await Ye.login({email:i.email,password:i.password});else{const W=N(),_=localStorage.getItem("planId")||W?.id||"basic",L=localStorage.getItem("selectedBusinessType"),H=localStorage.getItem("selectedFeatures");f=await Ye.signup({email:i.email,password:i.password,name:i.name,plan:_,businessType:L,selectedFeatures:H?JSON.parse(H):[]})}if(f.needsPasswordSetup){r(!0),a({...i,email:f.email}),p(""),x(!1);return}if(!f||!f.user||!f.token)throw new Error("Authentication failed. Please try again.");const b={id:Date.now(),type:l?"login":"signup",user:{id:f.user.id,name:f.user.name,email:f.user.email,role:f.user.role,plan:f.user.plan||"free"},timestamp:new Date().toISOString(),ip:"Unknown",userAgent:navigator.userAgent},A=JSON.parse(localStorage.getItem("authActivities")||"[]");A.unshift(b),A.splice(50),localStorage.setItem("authActivities",JSON.stringify(A)),await y(f);const z=l?"logged in":"signed up";console.log(`âœ… User ${f.user.name} ${z} successfully`),console.log(`ðŸ“ Role: ${f.user.role}, Plan: ${f.user.plan}`),l?f.user.role==="owner"?(console.log("ðŸ”¹ Login as owner â†’ Redirecting to Main Admin Dashboard (/main-admin)"),C("/main-admin")):f.user.role==="admin"?(console.log("ðŸ”¹ Login as admin â†’ Redirecting to Admin Dashboard (/admin)"),C("/admin")):f.user.role==="cashier"?(console.log("ðŸ”¹ Login as cashier â†’ Redirecting to Cashier Dashboard (/cashier)"),C("/cashier")):(console.warn("âš ï¸ Unknown role, redirecting to default dashboard"),C("/dashboard")):(console.log("ðŸ”¹ Signup successful â†’ Redirecting to Admin Dashboard (/admin)"),C("/admin"))}catch(f){console.error("Authentication error:",f);let b=f.message||"Authentication failed. Please try again.";f.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),b="Invalid credentials. Please try again."),p(b)}finally{x(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:l?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600",children:l?"Login to your account":"Create your account"})]}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[g?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:i.newPassword,onChange:w=>a({...i,newPassword:w.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:i.confirmPassword,onChange:w=>a({...i,confirmPassword:w.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!l&&e.jsxs("div",{className:"relative",children:[e.jsx(Ut,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:i.name,onChange:w=>a({...i,name:w.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(wt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:i.email,onChange:w=>a({...i,email:w.target.value}),required:!0})]}),l&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Login Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n("password"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${d==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Password"}),e.jsx("button",{type:"button",onClick:()=>n("pin"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${d==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"pin"})]})]}),l&&d==="password"&&e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:i.password,onChange:w=>a({...i,password:w.target.value}),required:!0})]}),l&&d==="pin"&&e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:i.pin,onChange:w=>a({...i,pin:w.target.value.replace(/\D/g,"").slice(0,4)}),maxLength:4,required:!0})]}),!l&&e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:i.password,onChange:w=>a({...i,password:w.target.value}),required:!0})]})]}),o&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:o}),e.jsx("button",{type:"submit",disabled:h,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50",children:h?"Please wait...":g?"Set Password":l?"Login":"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{c(!l),p(""),r(!1)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:l?"Don't have an account? Sign up":"Already have an account? Login"})})]})})}function Ra(){const[t,l]=s.useState("ultra"),[c,d]=s.useState(!1),[n,i]=s.useState({name:"",email:"",company:""}),a=he();console.log("âœ… Subscription component mounted, navigate available:",typeof a);const o=[{id:"basic",name:"Basic",price:1e3,icon:Ue,color:"from-green-500 to-teal-600",popular:!1,features:["âœ“ Admin Dashboard + Cashier POS","âœ“ Basic Inventory Management","âœ“ Sales Tracking","âœ“ Daily/Weekly Reports","âœ“ Basic Profit/Loss View","âœ“ Email Support","âœ“ 1 Cashier Only"]},{id:"ultra",name:"Ultra",price:2500,icon:Ft,color:"from-blue-600 to-purple-600",popular:!0,features:["âœ“ Admin Dashboard + Cashier POS","âœ“ Full Inventory Management","âœ“ Automatic Stock Deduction","âœ“ User Management (Unlimited)","âœ“ Permission Controls","âœ“ Expense Tracking","âœ“ Advanced Analytics","âœ“ Priority Support"]}],p=x=>{x?.preventDefault?.(),console.log("[BUTTON] Get Started clicked, selected plan:",t),console.log("[BUTTON] Available plans:",o.map(r=>r.id));const g=o.find(r=>r.id===t);if(console.log("[BUTTON] Found plan:",g),!g){console.error("[BUTTON] Plan not found!"),alert("Please select a plan first");return}try{const r={id:g.id,name:g.name,price:g.price};localStorage.setItem("selectedPlan",JSON.stringify(r)),localStorage.setItem("planId",t),console.log("[BUTTON] Stored to localStorage, navigating..."),console.log("[BUTTON] Going to /auth/signup"),a("/auth/signup")}catch(r){console.error("[BUTTON] Error:",r),alert("Error: "+r.message)}},h=async x=>{x.preventDefault();try{await fetch(`${ae}/demo-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),alert("Demo request submitted! Admin will review and contact you."),d(!1),i({name:"",email:"",company:""})}catch(g){console.error("Demo request failed:",g),alert("Failed to submit demo request. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:()=>a("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition",children:[e.jsx(os,{size:20}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mb-12 md:mb-16",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Pick the perfect plan and unlock your POS potential"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8 mb-8 md:mb-12 max-w-5xl mx-auto",children:o.map(x=>{const g=x.icon;return e.jsxs("div",{onClick:()=>l(x.id),className:`card cursor-pointer transition-all transform ${t===x.id?"ring-4 ring-blue-600 shadow-2xl scale-105 bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-lg hover:scale-102"} relative`,children:[x.popular&&e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl bg-gradient-to-br ${x.color} flex items-center justify-center`,children:e.jsx(g,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"text-lg md:text-xl font-bold",children:x.name})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("span",{className:"text-2xl md:text-3xl font-bold",children:["KSH ",x.price]}),e.jsx("span",{className:"text-gray-600 text-xs md:text-sm",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:x.features.map((r,C)=>e.jsxs("li",{className:"flex items-start gap-2 text-xs md:text-sm",children:[e.jsx(tt,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:r})]},C))})]},x.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center mt-8",children:[e.jsx("button",{type:"button",onClick:p,className:"cursor-pointer px-8 md:px-12 py-3 md:py-4 text-base md:text-lg font-bold bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all active:scale-95",children:"Get Started"}),e.jsx("button",{type:"button",onClick:()=>d(!0),className:"cursor-pointer px-8 md:px-12 py-3 md:py-4 text-base md:text-lg font-bold border-2 border-gray-300 bg-white text-gray-700 rounded-lg hover:border-gray-400 transition-all",children:"Request Free Demo"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-4 text-center",children:"Secure payment â€¢ Cancel anytime"}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Free Demo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"We'll contact you to schedule a demo"})]}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:n.name,onChange:x=>i({...n,name:x.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:n.email,onChange:x=>i({...n,email:x.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:n.company,onChange:x=>i({...n,company:x.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition",children:"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})})}const Dt={bar:{id:"bar",name:"Bar / Alcohol Business",description:"Drinks, happy hour pricing, brand tracking, staff shifts",icon:"Wine",color:"amber",features:["Bottle size + brand management","Happy hour pricing rules","Staff shift tracking","Profit by brand","Low stock alerts","Age-check functionality"],productFields:["name","brand","size","category","price","cost","stock"],categories:["Beer","Wine","Spirits","Beverages","Mixers"],adminModules:["inventory","staff","shifts","pricing","reports"],cashierModules:["categories","quick-tap","age-check","shift-view"]},hospital:{id:"hospital",name:"Hospital / Clinic",description:"Patient billing, services, medicines, doctor commission",icon:"Heart",color:"red",features:["Services + medicines separation","Patient search + billing","Doctor commission tracking","Batch + expiry tracking","Medicine inventory","Invoice printing"],productFields:["name","type","category","price","batchNo","expiryDate","stock"],categories:["Services","Medicines","Lab Tests","Equipment"],adminModules:["patients","services","medicines","doctors","inventory"],cashierModules:["patient-search","add-services","add-medicines","print"]},school:{id:"school",name:"School",description:"Student billing, term fees, canteen, uniform/books",icon:"BookOpen",color:"blue",features:["Student management","Term fees tracking","Canteen inventory","Uniform + books stock","Fee payment receipts","Student balance"],productFields:["name","type","category","price","stock","description"],categories:["Fees","Canteen","Uniforms","Books","Supplies"],adminModules:["students","fees","canteen","inventory","reports"],cashierModules:["student-lookup","fee-payment","canteen-sales","receipts"]},kiosk:{id:"kiosk",name:"Kiosk / Small Shop",description:"Simple inventory, supplier tracking, fast POS",icon:"Store",color:"green",features:["Simple inventory management","Supplier tracking","Price rules","Profit reports","Low stock alerts","Fast checkout"],productFields:["name","category","price","cost","stock","supplier"],categories:["General","Electronics","Food","Drinks","Supplies"],adminModules:["inventory","suppliers","pricing","reports"],cashierModules:["search","quick-scan","low-stock-alerts"]},petrol:{id:"petrol",name:"Petrol / Gas Station",description:"Fuel types, pump tracking, tank stock, shift reconciliation",icon:"Fuel",color:"yellow",features:["Fuel type management","Pump tracking","Tank stock management","Shift reconciliation","Pump totals","Attendant management"],productFields:["name","fuelType","pricePerLiter","tankCapacity","pumpId","stock"],categories:["Petrol","Diesel","Premium","LPG"],adminModules:["fuel-types","pumps","tanks","staff","reconciliation"],cashierModules:["pump-selector","fuel-buttons","shift-totals","attendant-view"]},shoes:{id:"shoes",name:"Shoe / Clothing Store",description:"Size & color variants, margin tracking, returns/refunds",icon:"Shirt",color:"pink",features:["Size + color variants","Margin per product","Returns + refunds","Variant inventory","Barcode + search POS","Stock by variant"],productFields:["name","category","price","cost","size","color","stock","margin"],categories:["Shoes","Shirts","Pants","Dresses","Accessories"],adminModules:["variants","inventory","returns","pricing","reports"],cashierModules:["variant-selector","search","barcode","returns"]}};function Ma(){const t=he(),[l,c]=s.useState(null),[d,n]=s.useState(1),i=x=>{c(x),n(2)},a=()=>{if(!l){alert("Please select a business type");return}const x=Dt[l];localStorage.setItem("selectedBusinessType",l),localStorage.setItem("businessMetadata",JSON.stringify(x)),console.log("[BUILD POS] Selected business:",l),t("/auth/signup")},o=()=>{d===2?(n(1),c(null)):t("/plans")},p=l?Dt[l]:null,h=Object.entries(Dt).map(([x,g])=>({id:x,...g}));return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 py-8 px-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:o,className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition p-2 rounded-lg hover:bg-white",children:[e.jsx(os,{size:20}),"Back"]})}),d===1&&e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Business Type"}),e.jsx("p",{className:"text-gray-600 mb-12 text-lg",children:"Select the type that best matches your operation. We'll customize your dashboard accordingly."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(x=>e.jsxs("button",{onClick:()=>i(x.id),className:`text-left p-6 rounded-xl border-2 transition-all transform hover:scale-105 ${l===x.id?"border-blue-600 bg-blue-50 ring-2 ring-blue-400 shadow-lg":"border-gray-200 bg-white hover:border-gray-300 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:x.name}),e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${l===x.id?"bg-blue-600 border-blue-600":"border-gray-300"}`,children:l===x.id&&e.jsx(tt,{size:16,className:"text-white"})})]}),e.jsx("p",{className:"text-gray-600 mb-4 text-sm",children:x.description}),e.jsx("ul",{className:"space-y-2",children:x.features.slice(0,3).map((g,r)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[e.jsx("span",{className:"text-green-600 font-bold mt-0.5",children:"â€¢"}),e.jsx("span",{children:g})]},r))})]},x.id))})]}),d===2&&p&&e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-4xl font-bold mb-8 text-center",children:"Confirm Your Selection"}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 border-2 border-blue-600",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4 text-blue-600",children:p.name}),e.jsx("p",{className:"text-gray-600 mb-8 text-lg",children:p.description}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Your Dashboard Includes:"}),e.jsx("ul",{className:"space-y-3",children:p.features.map((x,g)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-green-600 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx(tt,{size:16,className:"text-white"})}),e.jsx("span",{className:"text-gray-700",children:x})]},g))})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-8",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-bold",children:"Custom Price:"})," 3,500 KES/month"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Your admin will be customized for ",p.name.toLowerCase(),". You can modify your selection later."]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>{n(1),c(null)},className:"flex-1 px-6 py-3 rounded-lg border-2 border-gray-300 font-bold text-gray-700 hover:bg-gray-50 transition",children:"Choose Different"}),e.jsxs("button",{onClick:a,className:"flex-1 px-6 py-3 rounded-lg bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold hover:shadow-lg transition flex items-center justify-center gap-2",children:["Continue to Sign Up",e.jsx(nt,{size:20})]})]})]})]})]})})}function qa({isLocked:t,onUnlock:l,userPin:c,userName:d="Cashier"}){const[n,i]=s.useState(""),[a,o]=s.useState(""),[p,h]=s.useState(0),[x,g]=s.useState(!1);s.useEffect(()=>{t&&(o(""),i(""),h(0),g(!1))},[t]),s.useEffect(()=>{p>=3&&(g(!0),setTimeout(()=>{g(!1),h(0)},3e4))},[p]);const r=N=>{x||n.length<4&&(i(v=>v+N),o(""))},C=()=>{x||(i(N=>N.slice(0,-1)),o(""))},y=()=>{if(x){o("Too many attempts. Please wait.");return}if(n.length!==4){o("PIN must be 4 digits");return}String(n)===String(c)?(i(""),o(""),l()):(o("Incorrect PIN"),h(N=>N+1),i(""))};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[9999] backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-96 max-w-full mx-4",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"bg-red-100 p-4 rounded-full",children:e.jsx(be,{className:"w-12 h-12 text-red-600"})})}),e.jsx("h1",{className:"text-2xl font-bold text-center text-gray-800 mb-2",children:"Screen Locked"}),e.jsxs("p",{className:"text-center text-gray-600 mb-6",children:[d,", enter your PIN to continue"]}),e.jsx("div",{className:"bg-gray-100 rounded-lg p-4 mb-6 flex justify-center gap-2",children:[0,1,2,3].map(N=>e.jsx("div",{className:"w-12 h-12 bg-white border-2 border-gray-300 rounded-lg flex items-center justify-center font-bold text-xl text-gray-800",children:n[N]?"â—":""},N))}),a&&e.jsxs("div",{className:`text-center text-sm font-medium mb-4 p-2 rounded ${a.includes("Incorrect")?"bg-red-100 text-red-700":a.includes("must be")?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[a,p>0&&p<3&&e.jsxs("p",{className:"text-xs mt-1",children:[3-p," attempt",3-p!==1?"s":""," remaining"]}),x&&e.jsx("p",{className:"text-xs mt-1",children:"Locked. Try again in 30 seconds."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[[1,2,3,4,5,6,7,8,9].map(N=>e.jsx("button",{onClick:()=>r(String(N)),disabled:x||n.length>=4,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors text-lg",children:N},N)),e.jsx("button",{onClick:()=>r("0"),disabled:x||n.length>=4,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors col-span-1 text-lg",children:"0"}),e.jsxs("button",{onClick:C,disabled:x||n.length===0,className:"bg-red-500 hover:bg-red-600 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors col-span-2 flex items-center justify-center gap-2",children:[e.jsx(Ie,{size:16}),"Back"]})]}),e.jsx("button",{onClick:y,disabled:x||n.length!==4,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors mb-3",children:x?"Locked":"Unlock"}),e.jsx("p",{className:"text-center text-xs text-gray-500 mt-4",children:"Enter your 4-digit PIN"})]})}):null}function Ba(){const[t,l]=s.useState([]),[c,d]=s.useState([]);s.useEffect(()=>{const a=async()=>{try{const p=await ue.getLowStockWarnings?.();p?.warnings&&l(p.warnings)}catch(p){console.warn("Failed to fetch low-stock warnings:",p)}};a();const o=setInterval(a,1e4);return()=>clearInterval(o)},[]);const n=t.filter(a=>!c.includes(a.id));if(n.length===0)return null;const i=a=>{d([...c,a])};return e.jsx("div",{className:"fixed top-24 right-6 max-w-md space-y-2 z-40",children:n.map(a=>e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded shadow-lg animate-pulse",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ze,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-900",children:"âš ï¸ Stock Warning"}),e.jsxs("p",{className:"text-sm text-red-800 mt-1",children:[e.jsx("strong",{children:a.name}),": ",a.quantity,a.unit," remaining"]}),e.jsxs("p",{className:"text-xs text-red-700 mt-0.5",children:["Threshold: ",a.threshold,a.unit]})]})]}),e.jsx("button",{onClick:()=>i(a.id),className:"text-red-600 hover:text-red-900 flex-shrink-0",children:e.jsx(Ie,{className:"w-4 h-4"})})]})},a.id))})}const za="http://localhost:5000";let $t=null;const _a=()=>($t||($t=localStorage.getItem("token")),$t),js=async(t,l={})=>{const c=performance.now(),d=_a();try{const n=await fetch(`${za}${t}`,{...l,headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`,...l.headers},keepalive:!0,priority:"high"});if(!n.ok){const o=await n.json().catch(()=>({error:"Request failed"}));throw new Error(o.error||`HTTP ${n.status}`)}const i=await n.json(),a=performance.now()-c;return a>200&&console.warn(`âš ï¸ Slow API request: ${t} took ${a.toFixed(1)}ms`),i}catch(n){const i=performance.now()-c;throw console.error(`âŒ API error (${i.toFixed(1)}ms): ${t}`,n),n}},ys=async(t,l,c,d)=>{const n=performance.now();let i=!1;try{console.log("ðŸš€ [Transaction] Starting sale transaction",{items:t.items?.length||0,total:t.total}),l&&(l({action:"SALE_PENDING",cartCleared:!0,message:"Processing sale...",timestamp:Date.now()}),i=!0,console.log("âœ… [Transaction] Optimistic update applied"));const a=performance.now(),o=await js("/api/v2/sales/complete",{method:"POST",body:JSON.stringify({items:t.items,total:t.total,discount:t.discount||0,tax:t.tax||0,taxType:t.taxType||"exclusive",paymentMethod:t.paymentMethod||"cash",shiftId:t.shiftId})}),p=performance.now()-a;console.log(`âœ… [Transaction] API completed in ${p.toFixed(1)}ms`);const h=performance.now()-n;if(!o.success||!o.saleId)throw new Error(o.error||"Invalid server response");const x={...o,clientElapsedMs:h,apiElapsedMs:p,performanceGrade:h<100?"ðŸš€ EXCELLENT":h<200?"âœ… GOOD":h<300?"âš ï¸ ACCEPTABLE":"âŒ SLOW",updatedProducts:o.updatedProducts||[],stockDeductions:o.stockDeductions||{},lowStockWarnings:o.lowStockWarnings||[]};return console.log(`âœ… [Transaction] Complete! Total: ${h.toFixed(1)}ms ${x.performanceGrade}`),c&&c(x),x}catch(a){const o=performance.now()-n;console.error(`âŒ [Transaction] Failed after ${o.toFixed(1)}ms:`,a);const p={error:a.message||"Transaction failed",elapsedMs:o,action:"SALE_FAILED",needsRollback:i,timestamp:Date.now()};throw d&&d(p),a}},Wa=async t=>{const l=performance.now();try{console.log("ðŸ• [ClockIn] Starting clock-in transaction");const c=await js("/api/v2/shifts/clock-in",{method:"POST"}),d=performance.now()-l;console.log(`âœ… [ClockIn] Completed in ${d.toFixed(1)}ms`);const n={...c,elapsedMs:d,performanceGrade:d<50?"ðŸš€":d<100?"âœ…":"âš ï¸"};return t&&t(n),n}catch(c){const d=performance.now()-l;throw console.error(`âŒ [ClockIn] Failed after ${d.toFixed(1)}ms:`,c),c}},Ha="products_cache_v2",Ns=()=>{sessionStorage.removeItem(Ha),console.log("ðŸ—‘ï¸ [Cache] Product cache invalidated")},Ja=(t,l)=>{if(!l||!Array.isArray(l.products))return t;const c=performance.now(),d=new Map;l.products.forEach(a=>{d.set(a.id,a.deducted||a.quantity)});const n=t.map(a=>{const o=d.get(a.id);return o!==void 0?{...a,quantity:Math.max(0,a.quantity-o)}:a}),i=performance.now()-c;return console.log(`âœ… [Optimistic] Inventory updated in ${i.toFixed(2)}ms`),n},Ka={sales:[],clockIns:[],clockOuts:[],record(t,l){const c=this[t];c&&(c.push({duration:l,timestamp:Date.now()}),c.length>100&&c.shift())},getStats(t){const l=this[t];if(!l||l.length===0)return{count:0,avg:0,min:0,max:0,p95:0};const c=l.map(a=>a.duration).sort((a,o)=>a-o),d=c.length,n=c.reduce((a,o)=>a+o,0),i=Math.floor(d*.95);return{count:d,avg:n/d,min:c[0],max:c[d-1],p95:c[i]||c[d-1]}},logReport(){console.group("ðŸ“Š Transaction Performance Report"),console.log("Sales:",this.getStats("sales")),console.log("Clock Ins:",this.getStats("clockIns")),console.log("Clock Outs:",this.getStats("clockOuts")),console.groupEnd()}};typeof window<"u"&&(window.__transactionMetrics=Ka);function Zt(){const{user:t,logout:l}=oe(),{products:c,refreshProducts:d}=Mt(),{isLocked:n,lock:i,unlock:a}=ps(),[o,p]=s.useState([]),[h,x]=s.useState([]),[g,r]=s.useState([]),[C,y]=s.useState("cash"),[N,v]=s.useState("pos"),[w,f]=s.useState({sales:[],expenses:[],stats:{}}),[b,A]=s.useState(""),[z,W]=s.useState(!1),[_,L]=s.useState(!1),[H,$]=s.useState(null),[I,F]=s.useState({name:"",price:"",cost:"",category:"finished",image:""}),[K,ce]=s.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[me,te]=s.useState(!1),[ke,pe]=s.useState(!1),[re,ge]=s.useState({customerName:"",amount:"",reason:"",notes:""}),[S,j]=s.useState(!1),[k,E]=s.useState({description:"",amount:"",category:""}),[U,J]=s.useState(""),[M,ee]=s.useState([]),[B,Ce]=s.useState(null),[ie,Le]=s.useState("exclusive"),[se,qe]=s.useState(!1),[Pt,Ke]=s.useState(null),[xt,Be]=s.useState(null),[Ge,Ve]=s.useState({}),[at,ut]=s.useState(!1),[qt,ht]=s.useState(!1),[Bt,Oe]=s.useState(!1),[u,P]=s.useState(Date.now()),[R,X]=s.useState(0);s.useEffect(()=>{Ee(),d();const m=localStorage.getItem(`cart_${t?.id}`),T=localStorage.getItem(`paymentMethod_${t?.id}`),D=localStorage.getItem(`selectedDiscount_${t?.id}`),q=localStorage.getItem(`taxType_${t?.id}`);if(m)try{r(JSON.parse(m))}catch(Q){console.warn("Failed to restore cart:",Q)}if(T&&y(T),q&&Le(q),D)try{Ce(JSON.parse(D))}catch{}Te();const Y=localStorage.getItem("token");Y&&Pe.connect(Y,Q=>{if(console.log("ðŸ“¡ WebSocket callback received:",Q),Q&&Q.allProducts){console.log(`ðŸ“¦ Merging ${Q.allProducts.length} products from WebSocket`);const fe=Q.allProducts.filter(_e=>_e.visibleToCashier!==!1&&!_e.expenseOnly);p(fe)}Q&&Q.productId!==void 0&&Q.newQuantity!==void 0&&(console.log(`ðŸ“¦ Stock update for product ${Q.productId}: ${Q.newQuantity}${Q.unit||""}`),p(fe=>fe.map(G=>G.id===Q.productId?{...G,quantity:Q.newQuantity}:G))),Q&&Q.discounts&&(console.log("ðŸ“Š Discount list updated"),ee(Q.discounts)),Q&&Q.sale&&(console.log("ðŸ’° Sale detected, reloading stats"),Ee())}).catch(Q=>{console.warn("âš ï¸ WebSocket connection failed:",Q)});const ne=Yt(Q=>{try{if(!Q)return;console.log("ðŸ“¨ Product subscription message:",Q.type),(Q.type==="initial"||Q.type==="products_snapshot"||Q.type==="product_created"||Q.type==="product_updated"||Q.type==="product_deleted")&&ue.getAll().then(fe=>{const _e=fe.filter(G=>G.visibleToCashier!==!1&&!G.expenseOnly);console.log(`âœ… Subscription update: ${_e.length} products`),p(_e)}).catch(fe=>{console.error("Failed to fetch products from subscription:",fe)})}catch(fe){console.error("âŒ Product subscription handler error",fe)}}),Se=setInterval(()=>{console.log("ðŸ”„ Auto-refreshing products..."),ht(!0),d().finally(()=>ht(!1))},3e4);return()=>{clearInterval(Se);try{ne()}catch{}Pe.disconnect()}},[t?.id]),s.useEffect(()=>{if(c){const m=c.filter(T=>T.visibleToCashier!==!1&&!T.expenseOnly&&!T.pendingDelete);p(m),P(Date.now()),X(T=>T+1)}},[c]),s.useEffect(()=>{const m=localStorage.getItem("token");m&&Pe.connect(m,D=>{if(console.log("ðŸ“¡ WebSocket callback received:",D),D&&D.allProducts){console.log(`ðŸ“¦ Merging ${D.allProducts.length} products from WebSocket`);const q=D.allProducts.filter(Y=>Y.visibleToCashier!==!1&&!Y.expenseOnly);p(q)}D&&D.productId!==void 0&&D.newQuantity!==void 0&&(console.log(`ðŸ“¦ Stock update for product ${D.productId}: ${D.newQuantity}${D.unit||""}`),p(q=>q.map(ne=>ne.id===D.productId?{...ne,quantity:D.newQuantity}:ne))),D&&D.discounts&&(console.log("ðŸ“Š Discount list updated"),ee(D.discounts)),D&&D.sale&&(console.log("ðŸ’° Sale detected, reloading stats"),Ee())}).catch(D=>{console.warn("âš ï¸ WebSocket connection failed:",D)});const T=Yt(D=>{try{if(!D)return;console.log("ðŸ“¨ Product subscription message:",D.type),(D.type==="initial"||D.type==="products_snapshot"||D.type==="product_created"||D.type==="product_updated"||D.type==="product_deleted")&&ue.getAll().then(q=>{const Y=q.filter(ne=>ne.visibleToCashier!==!1&&!ne.expenseOnly);console.log(`âœ… Subscription update: ${Y.length} products`),p(Y)}).catch(q=>{console.error("Failed to fetch products from subscription:",q)})}catch(q){console.error("âŒ Product subscription handler error",q)}});return()=>{try{T()}catch{}Pe.disconnect()}},[]),s.useEffect(()=>{(g.length>0||C||ie)&&V()},[g,C,ie,B,t?.id]);const V=()=>{localStorage.setItem(`cart_${t?.id}`,JSON.stringify(g)),localStorage.setItem(`paymentMethod_${t?.id}`,C),localStorage.setItem(`taxType_${t?.id}`,ie),B&&localStorage.setItem(`selectedDiscount_${t?.id}`,JSON.stringify(B))},le=async()=>{try{Oe(!0);const m=await jt.create("clock_in");Ke(m),qe(!0);const T=new Date(m.clockInTime);Be(T),localStorage.setItem(`clockIn_${t?.id}_${new Date().toDateString()}`,T.toISOString()),console.log("âœ… Clocked in successfully"),alert("âœ… Clocked in successfully at "+T.toLocaleTimeString())}catch(m){console.error("Clock in failed:",m),alert("âŒ Clock in failed: "+(m.message||"Unknown error"))}finally{Oe(!1)}},Fe=async()=>{try{Oe(!0);const m=await jt.create("clock_out");Ke(m),qe(!1),Be(null),localStorage.removeItem(`clockIn_${t?.id}_${new Date().toDateString()}`),console.log("âœ… Clocked out successfully");const T=m.duration?`${m.duration} minutes`:"unknown duration";alert("âœ… Clocked out successfully. Duration: "+T)}catch(m){console.error("Clock out failed:",m),alert("âŒ Clock out failed: "+(m.message||"Unknown error"))}finally{Oe(!1)}},Te=async()=>{try{const m=await jt.getStatus();m.isClockedIn?(qe(!0),Be(new Date(m.clockInTime)),Ke(m),console.log("âœ… User is clocked in since:",m.clockInTime)):(qe(!1),Be(null),Ke(null),console.log("User is not clocked in"))}catch(m){console.warn("Failed to check clock status:",m),qe(!1),Be(null)}},Ee=async()=>{try{const[m,T,D,q,Y,ne]=await Promise.all([ue.getAll(),Ct.getAll(),St.getAll(),ms.get(),kt.getAll(),it.getAll().catch(()=>[])]);p(m.filter(Se=>Se.visibleToCashier!==!1&&!Se.expenseOnly)),f({sales:T,expenses:D,stats:q}),x(Y),ee(ne||[])}catch(m){console.error("Failed to load data:",m)}},It=(m,T=!0)=>{const D=m.target.files[0];if(D){const q=new FileReader;q.onload=Y=>{const ne=Y.target.result;J(ne),T&&F({...I,image:ne})},q.readAsDataURL(D)}},ze=m=>h.filter(D=>D.productId===m&&D.quantity>0).reduce((D,q)=>D+q.quantity,0),vs=m=>{const T=ze(m.id);if(T<=0){alert("Product is out of stock!");return}const D=g.find(Y=>Y.id===m.id);if((D?D.quantity:0)>=T){alert(`Only ${T} units available in stock!`);return}r(D?g.map(Y=>Y.id===m.id?{...Y,quantity:Y.quantity+1}:Y):[...g,{...m,quantity:1}])},At=(m,T)=>{o.find(q=>q.id===m);const D=ze(m);r(g.map(q=>{if(q.id===m){const Y=q.quantity+T;return Y>D?(alert(`Only ${D} units available!`),q):{...q,quantity:Math.max(1,Y)}}return q}).filter(q=>q.quantity>0))},ws=m=>{r(g.filter(T=>T.id!==m))},we=g.reduce((m,T)=>m+T.price*T.quantity,0),Ss=async()=>{if(console.log("ðŸ›’ [Checkout] Starting optimized checkout flow"),g.length===0||at){console.log("âš ï¸ [Checkout] Blocked: cart empty or already processing");return}ut(!0),Oe(!0);const m=[...g],T={...Ge},D=B,q=ie;try{const Y=g.reduce((G,pt)=>G+pt.price*pt.quantity,0),ne=B?B.type==="percentage"?Y*B.value/100:B.value:0;let Se=0,Q=0;ie==="inclusive"?(Se=Y/1.16*.16,Q=Y-ne):(Se=(Y-ne)*.16,Q=Y-ne+Se);const fe=g.map(G=>({productId:G.id,quantity:G.quantity,unit:Ge[G.id]||G.unit||"piece",price:G.price,name:G.name}));console.log("ðŸ’³ [Checkout] Processing sale:",{items:fe.length,total:Q,discount:ne,tax:Se});const _e=await ys({items:fe,total:Q,discount:ne,tax:Se,taxType:ie,paymentMethod:C,shiftId:Pt?.id},G=>{console.log("âš¡ [Checkout] Optimistic update:",G.action),r([]),Ve({}),Ce(null),Le("exclusive")},G=>{if(console.log(`âœ… [Checkout] Sale completed in ${G.clientElapsedMs.toFixed(1)}ms ${G.performanceGrade}`),G.updatedProducts&&G.updatedProducts.length>0)p(G.updatedProducts),console.log("ðŸ“¦ [Checkout] Products updated from server");else{const de=Ja(o,G.stockDeductions);p(de),console.log("ðŸ“¦ [Checkout] Products updated optimistically")}Ns();const pt={id:G.saleId,items:fe,total:Q,discount:ne,tax:Se,taxType:ie,paymentMethod:C,accountId:t?.accountId,cashierId:t?.id,cashierName:t?.name||"Cashier",stockDeductions:G.stockDeductions||{},createdAt:G.timestamp||new Date().toISOString()};f(de=>({...de,sales:[pt,...de.sales]}));const Ts=G.stockDeductions?.products?.map?.(de=>`${de.name||de.productName}: -${de.quantity||de.deducted}${de.unit||""}`).join(`
`)||"Stock updated";if(alert(`âœ… SALE COMPLETE!

Sale ID: #${G.saleId}
Amount: KSH ${Q.toLocaleString()}
Time: ${G.processingTime||G.clientElapsedMs.toFixed(1)+"ms"}
Performance: ${G.performanceGrade}

Stock Deducted:
${Ts}`),G.lowStockWarnings&&G.lowStockWarnings.length>0){const de=G.lowStockWarnings.map(rt=>`âš ï¸ ${rt.name}: ${rt.quantity}${rt.unit} (Low Stock!)`).join(`
`);console.warn(`âš ï¸ [Checkout] Low stock warnings:
`+de),setTimeout(()=>alert(`Low Stock Alert:

`+de),1e3)}setTimeout(()=>{ue.getAll().then(de=>{const rt=de.filter(zt=>zt.visibleToCashier!==!1&&!zt.expenseOnly);p(rt),console.log("ðŸ”„ [Checkout] Background refresh complete")}).catch(de=>console.warn("Background refresh failed:",de))},100)},G=>{console.error(`âŒ [Checkout] Failed after ${G.elapsedMs.toFixed(1)}ms:`,G.error),G.needsRollback&&(r(m),Ve(T),Ce(D),Le(q),console.log("ðŸ”„ [Checkout] Rolled back to previous state")),alert(`âŒ Sale Failed:

${G.error}

Please try again.`)});console.log("âœ… [Checkout] Transaction completed successfully")}catch(Y){console.error("âŒ [Checkout] Unexpected error:",Y),r(m),Ve(T),Ce(D),Le(q),alert(`âŒ Checkout Failed:

${Y.message||"Unknown error occurred"}

Your cart has been restored.`)}finally{ut(!1),Oe(!1)}},ks=async m=>{m.preventDefault();try{console.log("âž• Creating new product:",I.name);const T=await ue.create({...I,price:parseFloat(I.price),cost:parseFloat(I.cost||0),quantity:0,visibleToCashier:!0,expenseOnly:!1});console.log("âœ… Product created:",T),T&&p(D=>[...D,T]),F({name:"",price:"",cost:"",category:"finished",image:""}),J(""),W(!1),console.log("âœ… Product added successfully and visible in POS!"),alert("âœ… Product added successfully!")}catch(T){console.error("âŒ Failed to add product:",T.message,T),alert(`âŒ Failed to add product: ${T.message||"Unknown error"}`)}},Cs=async m=>{m.preventDefault();try{const T=Array.isArray(h)?h:[],q={id:T.length>0?Math.max(...T.map(Y=>Y.id||0))+1:1,productId:H.id,quantity:parseInt(K.quantity),expiryDate:K.expiryDate,batchNumber:K.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(K.cost||H.cost||0)};x(Y=>[...Y,q]),await kt.create({productId:H.id,quantity:parseInt(K.quantity),expiryDate:K.expiryDate,batchNumber:K.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(K.cost||H.cost||0)}),ce({quantity:"",expiryDate:"",batchNumber:"",cost:""}),L(!1),$(null),await Ee(),alert("Stock added successfully!")}catch(T){console.error("Failed to add stock:",T),alert("Failed to add stock")}},Ps=async m=>{m.preventDefault();try{await St.create({...k,amount:parseFloat(k.amount)}),E({description:"",amount:"",category:""}),te(!1),await Ee()}catch(T){console.error("Failed to add expense:",T),alert("Failed to add expense")}},Is=async m=>{if(m.preventDefault(),!re.customerName||!re.amount){alert("Please fill in all required fields");return}j(!0);try{const T=await bt.create({customerName:re.customerName,amount:parseFloat(re.amount),reason:re.reason,notes:re.notes});console.log("âœ… Credit request submitted:",T),ge({customerName:"",amount:"",reason:"",notes:""}),pe(!1),alert("âœ… Credit request submitted successfully!")}catch(T){console.error("Failed to submit credit request:",T),alert("âŒ Failed to submit credit request: "+(T.message||"Unknown error"))}finally{j(!1)}},As=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses? This action cannot be undone."))try{const m=localStorage.getItem("token"),D=await fetch(`${ae}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!D.ok){const q=await D.json();throw new Error(q.message||"Failed to clear data")}f({sales:[],expenses:[],stats:{totalSales:0,totalExpenses:0,profit:0}}),r([]),alert("Data cleared successfully!"),await Ee()}catch(m){console.error("Failed to clear data:",m),alert("Failed to clear data: "+m.message)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[e.jsx(Ba,{}),e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Cashier Dashboard"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cashier Plan - KSH 900/month"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),se&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-green-600 font-semibold",children:"ðŸŸ¢ Clocked In"}),e.jsxs("button",{onClick:Fe,className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-600 hover:bg-red-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(Qs,{className:"w-4 h-4"}),"Clock Out"]})]}),!se&&e.jsxs("button",{onClick:le,className:"px-4 py-2 rounded-lg font-medium transition-all bg-green-600 hover:bg-green-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(is,{className:"w-4 h-4"}),"Clock In"]}),e.jsxs("button",{onClick:()=>{V(),l()},className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-100 hover:bg-red-200 text-red-600 border border-red-300 flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),"Logout"]}),e.jsxs("button",{onClick:As,className:"px-4 py-2 rounded-lg font-medium transition-all bg-orange-100 hover:bg-orange-200 text-orange-600 border border-orange-300 flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Clear"]}),e.jsxs("button",{onClick:()=>pe(!0),className:"px-4 py-2 rounded-lg font-medium transition-all bg-blue-100 hover:bg-blue-200 text-blue-600 border border-blue-300 flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),"Request Credit"]}),se&&xt&&e.jsx("div",{className:"ml-auto text-right text-xs",children:e.jsxs("p",{className:"text-green-600 font-semibold flex items-center gap-1",children:[e.jsx($e,{className:"w-4 h-4"}),"Clocked In: ",xt.toLocaleTimeString()]})})]})]})}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>v("pos"),className:`px-6 py-2 rounded-lg font-medium transition-all ${N==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(ot,{className:"w-4 h-4 inline mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>v("monitor"),className:`px-6 py-2 rounded-lg font-medium transition-all ${N==="monitor"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ot,{className:"w-4 h-4 inline mr-2"}),"Monitor"]}),e.jsxs("button",{onClick:()=>v("products"),className:`px-6 py-2 rounded-lg font-medium transition-all ${N==="products"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Me,{className:"w-4 h-4 inline mr-2"}),"Products"]}),e.jsxs("button",{onClick:()=>v("expenses"),className:`px-6 py-2 rounded-lg font-medium transition-all ${N==="expenses"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(dt,{className:"w-4 h-4 inline mr-2"}),"Expenses"]})]}),N==="pos"&&e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(mt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:b,onChange:m=>A(m.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:o.filter(m=>m.name?.toLowerCase().includes(b.toLowerCase())).map(m=>{const T=ze(m.id),D=T<10,q=T<=0;return e.jsxs("button",{onClick:()=>vs(m),disabled:q,className:`card text-left hover:shadow-xl transition-all transform hover:scale-105 relative ${q?"opacity-50 cursor-not-allowed bg-gray-100":"bg-gradient-to-br from-white to-gray-50"}`,children:[m.image&&e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:m.image,alt:m.name,className:"w-full h-full object-cover"})}),D&&!q&&e.jsx("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white p-1 rounded-full",children:e.jsx(Ze,{className:"w-4 h-4"})}),q&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"OUT"}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-900",children:m.name}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["KSH ",m.price?.toLocaleString()]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:`text-xs font-medium ${q?"text-red-600":D?"text-yellow-600":"text-gray-500"}`,children:["Stock: ",T]}),D&&!q&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium",children:"Low Stock"})]})]},m.id)})})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-gray-200 p-6 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(ot,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[g.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:g.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(ot,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:g.map(m=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:m.name}),e.jsx("button",{onClick:()=>ws(m.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(ve,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>At(m.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(Xs,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-semibold",children:m.quantity}),e.jsx("button",{onClick:()=>At(m.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(je,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(m.price*m.quantity).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2 items-center mt-2",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-600",children:"Unit:"}),e.jsxs("select",{value:Ge[m.id]||m.unit||"piece",onChange:T=>{Ve({...Ge,[m.id]:T.target.value})},className:"text-xs px-2 py-1 border border-gray-300 rounded bg-white",children:[e.jsx("option",{value:"piece",children:"Piece"}),e.jsx("option",{value:"kg",children:"Kilogram (kg)"}),e.jsx("option",{value:"g",children:"Grams (g)"}),e.jsx("option",{value:"l",children:"Liters (L)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",max:"999",placeholder:"qty",defaultValue:m.quantity,className:"text-xs px-2 py-1 border border-gray-300 rounded w-16",onChange:T=>{const D=parseFloat(T.target.value);!isNaN(D)&&D>0&&At(m.id,D-m.quantity)}})]})]},m.id))})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"text-gray-700",children:["KSH ",we.toLocaleString()]})]}),B&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-KSH ",(B.type==="percentage"?we*B.value/100:B.value).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-orange-600",children:[e.jsxs("span",{children:["Tax (",ie==="exclusive"?"Added":"Included","):"]}),e.jsxs("span",{children:[ie==="exclusive"?"+":"","KSH ",((we-(B?B.type==="percentage"?we*B.value/100:B.value:0))*.16).toLocaleString()]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Final Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(ie==="exclusive"?we-(B?B.type==="percentage"?we*B.value/100:B.value:0)+(we-(B?B.type==="percentage"?we*B.value/100:B.value:0))*.16:we-(B?B.type==="percentage"?we*B.value/100:B.value:0)).toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Discount (Optional)"}),e.jsxs("select",{value:B?.id||"",onChange:m=>{m.target.value?Ce(M.find(T=>T.id===parseInt(m.target.value))):Ce(null)},className:"input",children:[e.jsx("option",{value:"",children:"No Discount"}),M.filter(m=>m.active).map(m=>e.jsxs("option",{value:m.id,children:[m.name," - ",m.type==="percentage"?`${m.value}%`:`KSH ${m.value}`]},m.id))]}),B&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Discount: KSH ",(B.type==="percentage"?we*B.value/100:B.value).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tax Type"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"exclusive",checked:ie==="exclusive",onChange:m=>Le(m.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Exclusive (16% added)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"inclusive",checked:ie==="inclusive",onChange:m=>Le(m.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Inclusive"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:C,onChange:m=>y(m.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:()=>{try{console.log("ðŸ›’ Complete Sale button clicked"),Ss()}catch(m){console.error("âŒ Button handler error:",m),alert(`Error: ${m.message}`)}},disabled:g.length===0||at,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:at?"â³ Processing Sale...":"Complete Sale"})]})]})]}),N==="monitor"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",w.stats.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Xe,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",w.stats.totalExpenses?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(dt,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",w.stats.profit?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Xe,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Sales"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock Deducted"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"})]})}),e.jsx("tbody",{children:w.sales&&w.sales.slice(-15).reverse().map((m,T)=>{const D=m.stockDeductions?.products?.slice(0,2).map(q=>`${q.name}: -${q.deducted}${q.unit}`).join(", ")+(m.stockDeductions?.products?.length>2?"...":"")||"None";return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:new Date(m.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[m.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:m.paymentMethod||"cash"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-orange-600 font-semibold",children:D}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",m.total?.toLocaleString()]})]},T)})})]})})]}),e.jsxs("div",{className:"card shadow-lg mt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 text-orange-600"}),"Stock Deductions Log"]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-orange-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Sale ID"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Before"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Deducted"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"After"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Unit"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Time"})]})}),e.jsx("tbody",{children:w.sales&&w.sales.slice(-20).reverse().map(m=>m.stockDeductions?.products?.map((T,D)=>e.jsxs("tr",{className:"border-t border-orange-100 hover:bg-orange-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 font-medium text-blue-600",children:["#",m.id]}),e.jsx("td",{className:"px-4 py-3",children:T.name}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:T.before}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-red-600",children:["-",T.deducted]}),e.jsx("td",{className:"px-4 py-3 font-semibold text-green-600",children:T.after}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:T.unit}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-500",children:new Date(m.createdAt).toLocaleTimeString()})]},`${m.id}-${D}`)))})]}),(!w.sales||w.sales.length===0||!w.sales.some(m=>m.stockDeductions?.products?.length>0))&&e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No stock deductions yet"})]})]})]}),e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Manage Products & Stock"}),e.jsxs("button",{onClick:()=>W(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700",children:[e.jsx(je,{className:"w-4 h-4"}),"Add Product"]})]}),z&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl border-2 border-green-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Product"}),e.jsxs("form",{onSubmit:ks,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:I.name,onChange:m=>F({...I,name:m.target.value}),required:!0}),e.jsxs("select",{className:"input",value:I.category,onChange:m=>F({...I,category:m.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsx("input",{type:"number",placeholder:"Selling Price",className:"input",value:I.price,onChange:m=>F({...I,price:m.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Cost Price (Optional)",className:"input",value:I.cost,onChange:m=>F({...I,cost:m.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:m=>It(m,!0),className:"input"}),e.jsx(rs,{className:"w-5 h-5 text-gray-400"})]}),U&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:U,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{W(!1),J(""),F({name:"",price:"",cost:"",category:"finished",image:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),_&&H&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"font-semibold mb-4 text-lg",children:["Add Stock for ",H.name]}),e.jsxs("form",{onSubmit:Cs,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:K.quantity,onChange:m=>ce({...K,quantity:m.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:K.expiryDate,onChange:m=>ce({...K,expiryDate:m.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:K.batchNumber,onChange:m=>ce({...K,batchNumber:m.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per Unit",className:"input",value:K.cost,onChange:m=>ce({...K,cost:m.target.value})}),e.jsxs("div",{className:"flex gap-2 md:col-span-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{L(!1),$(null),ce({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:o.map(m=>{const T=ze(m.id),D=h.filter(Y=>Y.productId===m.id&&Y.quantity>0),q=T<10;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[m.image&&e.jsx("img",{src:m.image,alt:m.name,className:"w-10 h-10 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:m.name}),e.jsx("div",{className:"text-xs text-gray-500",children:m.category})]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",m.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium ${T===0?"text-red-600":q?"text-yellow-600":"text-gray-900"}`,children:T}),q&&T>0&&e.jsx(Ze,{className:"w-4 h-4 text-yellow-500"}),T===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"text-gray-600",children:[D.length," active"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{$(m),L(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-green-50 rounded-lg text-green-600 transition-colors",title:"Edit Product",children:e.jsx(Je,{className:"w-4 h-4"})})]})})]},m.id)})})]})})]})}),")}",N==="expenses"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Track Expenses"}),e.jsxs("button",{onClick:()=>te(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700",children:[e.jsx(je,{className:"w-4 h-4"}),"Add Expense"]})]}),me&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border-2 border-red-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Expense"}),e.jsxs("form",{onSubmit:Ps,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:k.description,onChange:m=>E({...k,description:m.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Amount",className:"input",value:k.amount,onChange:m=>E({...k,amount:m.target.value}),required:!0}),e.jsx("input",{type:"text",placeholder:"Category",className:"input",value:k.category,onChange:m=>E({...k,category:m.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>te(!1),className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:w.expenses.slice().reverse().map((m,T)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(m.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:m.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:m.category||"General"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",m.amount?.toLocaleString()]})]},T))})]})})]})}),ke&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 p-6 text-white flex justify-between items-center sticky top-0",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(He,{}),"Request Credit"]}),e.jsx("button",{onClick:()=>pe(!1),className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(Ie,{size:24})})]}),e.jsxs("form",{onSubmit:Is,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name *"}),e.jsx("input",{type:"text",placeholder:"Enter customer name",value:re.customerName,onChange:m=>ge({...re,customerName:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:S})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Amount (KES) *"}),e.jsx("input",{type:"number",placeholder:"0.00",value:re.amount,onChange:m=>ge({...re,amount:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"0",step:"0.01",required:!0,disabled:S})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Reason"}),e.jsxs("select",{value:re.reason,onChange:m=>ge({...re,reason:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:S,children:[e.jsx("option",{value:"",children:"Select reason..."}),e.jsx("option",{value:"regular_customer",children:"Regular Customer"}),e.jsx("option",{value:"emergency",children:"Emergency"}),e.jsx("option",{value:"bulk_order",children:"Bulk Order"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),e.jsx("textarea",{placeholder:"Add any additional notes...",value:re.notes,onChange:m=>ge({...re,notes:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3",disabled:S})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"submit",disabled:S,className:"flex-1 bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 rounded-lg font-bold hover:shadow-lg transition disabled:opacity-50 disabled:cursor-not-allowed",children:S?"Submitting...":"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>pe(!1),disabled:S,className:"flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition disabled:opacity-50",children:"Cancel"})]})]})]})}),e.jsx(qa,{isLocked:n,onUnlock:a,userPin:t?.pin||"1234",userName:t?.name})]})}function Ga(){const[t,l]=s.useState({totalSales:0,totalExpenses:0,netProfit:0,transactionCount:0}),[c,d]=s.useState(!0);return s.useEffect(()=>{const n=async()=>{try{const a=localStorage.getItem("token"),p=await(await fetch("http://localhost:5000/api/v2/monitor/stats",{headers:{Authorization:`Bearer ${a}`}})).json();l(p),d(!1)}catch(a){console.error("Failed to fetch stats:",a),d(!1)}};n();const i=setInterval(n,2e3);return()=>clearInterval(i)},[]),c?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin",children:e.jsx(Ue,{size:48,className:"text-blue-600"})}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading statistics..."})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-6 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Sales"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-2",children:t.totalSales.toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:[t.transactionCount," transactions"]})]}),e.jsx(De,{size:48,className:"text-green-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-red-50 to-red-100 rounded-lg p-6 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Expenses"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 mt-2",children:t.totalExpenses.toLocaleString()}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"Today's costs"})]}),e.jsx(dt,{size:48,className:"text-red-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Net Profit"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 mt-2",children:t.netProfit.toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:[t.totalSales>0?`${(t.netProfit/t.totalSales*100).toFixed(1)}%`:"0%"," margin"]})]}),e.jsx(Ue,{size:48,className:"text-blue-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-6 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Profit %"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-600 mt-2",children:[t.totalSales>0?(t.netProfit/t.totalSales*100).toFixed(1):"0","%"]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"Profitability"})]}),e.jsx(De,{size:48,className:"text-purple-600 opacity-50"})]})})]})}function Va({shiftId:t,onClockOut:l}){const[c,d]=s.useState(null),[n,i]=s.useState(!0),[a,o]=s.useState("00:00:00");s.useEffect(()=>{if(!t)return;(async()=>{try{const x=localStorage.getItem("token"),r=await(await fetch("http://localhost:5000/api/v2/shifts/current",{headers:{Authorization:`Bearer ${x}`}})).json();r.shift&&d(r.shift),i(!1)}catch(x){console.error("Failed to fetch shift:",x),i(!1)}})()},[t]),s.useEffect(()=>{if(!c||!c.clockInTime)return;const h=setInterval(()=>{const x=new Date(c.clockInTime),r=Math.floor((new Date-x)/1e3),C=Math.floor(r/3600),y=Math.floor(r%3600/60),N=r%60;o(`${String(C).padStart(2,"0")}:${String(y).padStart(2,"0")}:${String(N).padStart(2,"0")}`)},1e3);return()=>clearInterval(h)},[c]);const p=async()=>{if(t)try{const h=localStorage.getItem("token"),g=await(await fetch("http://localhost:5000/api/v2/shifts/clock-out",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({shiftId:t})})).json();g.success?(alert(`âœ… Clock Out Successful!

Total Sales: ${g.totalSales.toLocaleString()}
Total Expenses: ${g.totalExpenses.toLocaleString()}`),l()):alert(`âŒ Error: ${g.error}`)}catch(h){console.error("Clock out failed:",h),alert("Clock out failed")}};return n?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin",children:e.jsx($e,{size:48,className:"text-blue-600"})}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading shift information..."})]}):c?e.jsx("div",{className:"bg-white rounded-lg shadow-md p-8 max-w-md mx-auto",children:e.jsxs("div",{className:"text-center",children:[e.jsx($e,{size:64,className:"mx-auto text-blue-600 mb-6"}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-6 mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Shift Duration"}),e.jsx("p",{className:"text-5xl font-bold text-blue-600 font-mono",children:a}),e.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:["Started: ",new Date(c.clockInTime).toLocaleTimeString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Sales"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.totalSales.toLocaleString()})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Expenses"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:c.totalExpenses.toLocaleString()})]})]}),e.jsxs("button",{onClick:p,className:"w-full bg-red-600 text-white py-3 rounded-lg font-bold hover:bg-red-700 flex items-center justify-center gap-2 transition-colors",children:[e.jsx(Ae,{size:20}),"Clock Out"]})]})}):e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[e.jsx(Re,{size:48,className:"mx-auto text-yellow-600 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"No Active Shift"}),e.jsx("p",{className:"text-gray-600",children:"Please return to POS to start a new shift."})]})}function st(){const{user:t}=oe(),l=he(),[c,d]=s.useState("pos"),[n,i]=s.useState(null),[a,o]=s.useState([]),[p,h]=s.useState([]),[x,g]=s.useState(""),[r,C]=s.useState(0),[y,N]=s.useState(0),[v,w]=s.useState(!1);s.useEffect(()=>{(async()=>{try{console.log("ðŸ• [GenericPOS] Initiating clock-in..."),await Wa(I=>{I.success&&I.shiftId&&(i(I.shiftId),console.log(`âœ… [GenericPOS] Clocked in: Shift ${I.shiftId} (${I.elapsedMs.toFixed(1)}ms)`))})}catch(I){console.error("âŒ [GenericPOS] Clock-in failed:",I)}})()},[]),s.useEffect(()=>{(async()=>{try{const I=localStorage.getItem("token"),K=await(await fetch("http://localhost:5000/api/products",{headers:{Authorization:`Bearer ${I}`}})).json();h(K||[])}catch(I){console.error("Failed to fetch products:",I)}})()},[]);const f=p.filter($=>$.name.toLowerCase().includes(x.toLowerCase())),b=$=>{const I=a.find(F=>F.productId===$.id);I?(I.quantity+=1,o([...a])):o([...a,{productId:$.id,name:$.name,price:$.price,quantity:1}])},A=$=>{o(a.filter(I=>I.productId!==$))},z=async()=>{if(a.length===0){alert("Please add items to the sale");return}if(v){console.log("âš ï¸ [GenericPOS] Sale already in progress");return}w(!0);const $=[...a],I=r,F=y;try{const K=a.reduce((te,ke)=>te+ke.price*ke.quantity,0),ce=K*y/100,me=K+ce-r;console.log("ðŸ’³ [GenericPOS] Starting sale transaction"),await ys({items:a,total:me,discount:r,tax:ce,taxType:"exclusive",paymentMethod:"cash",shiftId:n},te=>{console.log("âš¡ [GenericPOS] Optimistic update:",te.action),o([]),C(0),N(0)},te=>{console.log(`âœ… [GenericPOS] Sale completed in ${te.clientElapsedMs.toFixed(1)}ms ${te.performanceGrade}`),Ns(),alert(`âœ… Sale Completed!

Sale ID: ${te.saleId}
Amount: KSH ${me.toLocaleString()}
Time: ${te.processingTime}
Performance: ${te.performanceGrade}`)},te=>{console.error(`âŒ [GenericPOS] Sale failed after ${te.elapsedMs.toFixed(1)}ms:`,te.error),te.needsRollback&&(o($),C(I),N(F),console.log("ðŸ”„ [GenericPOS] Rolled back to previous state")),alert(`âŒ Error: ${te.error}`)})}catch(K){console.error("âŒ [GenericPOS] Unexpected error:",K),o($),C(I),N(F),alert(`âŒ Sale failed: ${K.message||"Unknown error occurred"}`)}finally{w(!1)}};if(!t)return l("/auth/login"),null;const W=[{id:"pos",label:"POS",icon:ot},{id:"monitor",label:"Monitor",icon:De},{id:"shift",label:"Shift",icon:$e}],_=a.reduce(($,I)=>$+I.price*I.quantity,0),L=_*y/100,H=_+L-r;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Cashier POS"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Welcome, ",t.name]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Shift ID: ",n||"Not Started"]})})]})})}),e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4",children:e.jsx("div",{className:"flex gap-4",children:W.map($=>{const I=$.icon;return e.jsxs("button",{onClick:()=>d($.id),className:`flex items-center gap-2 px-4 py-3 font-medium transition-colors ${c===$.id?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(I,{size:18}),$.label]},$.id)})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[c==="pos"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsx("input",{type:"text",placeholder:"Search products...",value:x,onChange:$=>g($.target.value),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:f.map($=>e.jsxs("button",{onClick:()=>b($),className:"p-4 border rounded-lg hover:bg-blue-50 transition-colors text-left",children:[e.jsx("p",{className:"font-semibold text-sm",children:$.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Stock: ",$.quantity||0]}),e.jsx("p",{className:"text-lg font-bold text-blue-600 mt-2",children:$.price})]},$.id))}),f.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Re,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No products found"})]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 sticky top-24",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Cart"}),e.jsx("div",{className:"space-y-3 mb-6 max-h-96 overflow-y-auto",children:a.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No items selected"}):a.map($=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm",children:$.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:[$.quantity," Ã— ",$.price]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-bold text-sm",children:($.price*$.quantity).toLocaleString()}),e.jsx("button",{onClick:()=>A($.productId),className:"text-red-600 hover:text-red-700",children:"âœ•"})]})]},$.productId))}),e.jsxs("div",{className:"space-y-2 border-t pt-4 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{className:"font-semibold",children:_.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Discount:"}),e.jsx("input",{type:"number",value:r,onChange:$=>C(parseFloat($.target.value)||0),className:"w-24 px-2 py-1 border rounded"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Tax (%):"}),e.jsx("input",{type:"number",value:y,onChange:$=>N(parseFloat($.target.value)||0),className:"w-24 px-2 py-1 border rounded"})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[e.jsx("span",{children:"TOTAL:"}),e.jsx("span",{className:"text-green-600",children:H.toLocaleString()})]})]}),e.jsx("button",{onClick:z,disabled:v||a.length===0,className:"w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 disabled:bg-gray-400 transition-colors",children:v?"Processing...":"âœ“ Complete Sale"})]})})]}),c==="monitor"&&e.jsx(Ga,{}),c==="shift"&&e.jsx(Va,{shiftId:n,onClockOut:()=>l("/auth/login")})]})]})}function Ya(){const{user:t,logout:l}=oe(),c=he(),[d,n]=s.useState({sales:0,count:0});return s.useEffect(()=>{const i=JSON.parse(localStorage.getItem("dayStats")||'{"sales": 0, "count": 0}');n(i)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-900 to-amber-700",children:[e.jsx("div",{className:"bg-amber-900 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Zs,{size:32,className:"text-amber-300"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Bar POS"}),e.jsx("p",{className:"text-amber-200 text-sm",children:"Drinks & Beverages"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-amber-200 text-sm",children:"Today's Sales"}),e.jsxs("p",{className:"text-2xl font-bold text-green-400",children:[d.sales.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-amber-300 text-xs",children:[d.count," transactions"]})]}),e.jsxs("button",{onClick:()=>{l(),c("/auth/login")},className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition",children:[e.jsx(Ae,{size:20}),"Logout"]})]})]})})}),e.jsx("div",{className:"bg-amber-800 text-white border-b border-amber-700",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-amber-600 rounded-lg font-semibold",children:"ðŸº Beer"}),e.jsx("div",{className:"px-4 py-2 hover:bg-amber-700 rounded-lg cursor-pointer transition",children:"ðŸ· Wine"}),e.jsx("div",{className:"px-4 py-2 hover:bg-amber-700 rounded-lg cursor-pointer transition",children:"ðŸ¥ƒ Spirits"}),e.jsx("div",{className:"px-4 py-2 hover:bg-amber-700 rounded-lg cursor-pointer transition",children:"ðŸ§Š Mixers"}),e.jsx("div",{className:"px-4 py-2 hover:bg-amber-700 rounded-lg cursor-pointer transition",children:"ðŸ¸ Cocktails"})]})}),e.jsx("div",{className:"bg-amber-50",children:e.jsx(st,{businessType:"bar"})}),e.jsx("div",{className:"bg-amber-900 text-white py-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ue,{size:16,className:"text-yellow-400"}),e.jsx("p",{className:"text-sm",children:"Fast checkout â€¢ Age verification on premium items â€¢ Real-time inventory"})]})})]})}function Qa(){const{user:t,logout:l}=oe(),c=he(),[d,n]=s.useState(""),[i,a]=s.useState({revenue:0,patients:0});return s.useEffect(()=>{const o=JSON.parse(localStorage.getItem("dayStats")||'{"revenue": 0, "patients": 0}');a(o)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100",children:[e.jsx("div",{className:"bg-red-700 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ea,{size:32,className:"text-red-200"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Hospital POS"}),e.jsx("p",{className:"text-red-200 text-sm",children:"Patient Billing System"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-red-200 text-sm",children:"Daily Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-green-300",children:[i.revenue.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-red-200 text-xs",children:[i.patients," patients served"]})]}),e.jsxs("button",{onClick:()=>{l(),c("/auth/login")},className:"flex items-center gap-2 bg-red-900 hover:bg-red-950 px-4 py-2 rounded-lg transition",children:[e.jsx(Ae,{size:20}),"Logout"]})]})]})})}),e.jsx("div",{className:"bg-white border-b shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(mt,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search patient by ID or name...",value:d,onChange:o=>n(o.target.value),className:"w-full pl-10 pr-4 py-2 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"})]}),e.jsxs("button",{className:"bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg transition flex items-center gap-2",children:[e.jsx($e,{size:18}),"Recent Patients"]})]})})}),e.jsx("div",{className:"bg-gray-100 border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-red-600 text-white rounded-lg font-semibold",children:"ðŸ¥ Services"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ’Š Medicines"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ§ª Lab Tests"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ“‹ Procedures"})]})}),e.jsx("div",{className:"bg-white",children:e.jsx(st,{businessType:"hospital"})}),e.jsx("div",{className:"bg-red-700 text-white py-4 text-center",children:e.jsx("p",{className:"text-sm",children:"Patient records integrated â€¢ Invoice generation â€¢ Real-time inventory tracking"})})]})}function Xa(){const{user:t,logout:l}=oe(),c=he(),[d,n]=s.useState(""),[i,a]=s.useState({feesCollected:0,transactions:0});return s.useEffect(()=>{const o=JSON.parse(localStorage.getItem("dayStats")||'{"feesCollected": 0, "transactions": 0}');a(o)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-blue-100",children:[e.jsx("div",{className:"bg-blue-700 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ta,{size:32,className:"text-blue-200"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"School POS"}),e.jsx("p",{className:"text-blue-200 text-sm",children:"Student & Fee Management"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-blue-200 text-sm",children:"Fees Collected Today"}),e.jsxs("p",{className:"text-2xl font-bold text-green-300",children:[i.feesCollected.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-blue-200 text-xs",children:[i.transactions," transactions"]})]}),e.jsxs("button",{onClick:()=>{l(),c("/auth/login")},className:"flex items-center gap-2 bg-blue-900 hover:bg-blue-950 px-4 py-2 rounded-lg transition",children:[e.jsx(Ae,{size:20}),"Logout"]})]})]})})}),e.jsx("div",{className:"bg-white border-b shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(et,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search student by name, admission number, or class...",value:d,onChange:o=>n(o.target.value),className:"w-full pl-10 pr-4 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition flex items-center gap-2",children:[e.jsx(sa,{size:18}),"Fee Slip"]})]})})}),e.jsx("div",{className:"bg-gray-100 border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold",children:"ðŸ’° Term Fees"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ½ï¸ Canteen"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ‘• Uniforms"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ“š Books"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"âœï¸ Supplies"})]})}),e.jsx("div",{className:"bg-white",children:e.jsx(st,{businessType:"school"})}),e.jsx("div",{className:"bg-blue-700 text-white py-4 text-center",children:e.jsx("p",{className:"text-sm",children:"Student records linked â€¢ Receipt generation â€¢ Year-end reports"})})]})}function Za(){const{user:t,logout:l}=oe(),c=he(),[d,n]=s.useState({sales:0,itemsSold:0,lowStockItems:0});return s.useEffect(()=>{const i=JSON.parse(localStorage.getItem("dayStats")||'{"sales": 0, "itemsSold": 0, "lowStockItems": 0}');n(i)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-green-100",children:[e.jsx("div",{className:"bg-green-700 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(aa,{size:32,className:"text-green-200"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Kiosk POS"}),e.jsx("p",{className:"text-green-200 text-sm",children:"Fast & Simple Checkout"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-green-200 text-sm",children:"Today's Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-300",children:[d.sales.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-green-200 text-xs",children:[d.itemsSold," items sold"]})]}),e.jsxs("button",{onClick:()=>{l(),c("/auth/login")},className:"flex items-center gap-2 bg-green-900 hover:bg-green-950 px-4 py-2 rounded-lg transition",children:[e.jsx(Ae,{size:20}),"Logout"]})]})]})})}),d.lowStockItems>0&&e.jsx("div",{className:"bg-yellow-50 border-b border-yellow-200",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex items-center gap-2 text-yellow-800",children:[e.jsx(Re,{size:20}),e.jsxs("span",{className:"font-semibold",children:[d.lowStockItems," items running low on stock"]})]})}),e.jsx("div",{className:"bg-gray-100 border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-green-600 text-white rounded-lg font-semibold",children:"ðŸª All Items"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ”Œ Electronics"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸª Food"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ¥¤ Drinks"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ›’ Supplies"})]})}),e.jsx("div",{className:"bg-white",children:e.jsx(st,{businessType:"kiosk"})}),e.jsxs("div",{className:"bg-green-700 text-white py-4 text-center flex items-center justify-center gap-2",children:[e.jsx(Ue,{size:18,className:"text-yellow-300"}),e.jsx("p",{className:"text-sm",children:"Lightning-fast checkout â€¢ Low stock alerts â€¢ Real-time updates"})]})]})}function er(){const{user:t,logout:l}=oe(),c=he(),[d,n]=s.useState("1"),[i,a]=s.useState({revenue:0,liters:0,pumpTotal:0});return s.useEffect(()=>{const o=JSON.parse(localStorage.getItem("dayStats")||'{"revenue": 0, "liters": 0, "pumpTotal": 0}');a(o)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 to-yellow-100",children:[e.jsx("div",{className:"bg-gradient-to-r from-yellow-600 to-yellow-700 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ra,{size:32,className:"text-yellow-200"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Petrol POS"}),e.jsx("p",{className:"text-yellow-200 text-sm",children:"Fuel & Tank Management"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-yellow-200 text-sm",children:"Daily Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-green-300",children:[i.revenue.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-yellow-200 text-xs",children:[i.liters.toLocaleString()," liters sold"]})]}),e.jsxs("button",{onClick:()=>{l(),c("/auth/login")},className:"flex items-center gap-2 bg-yellow-900 hover:bg-yellow-950 px-4 py-2 rounded-lg transition",children:[e.jsx(Ae,{size:20}),"Logout"]})]})]})})}),e.jsx("div",{className:"bg-white border-b shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Select Pump:"}),e.jsx("div",{className:"flex gap-3",children:[1,2,3,4,5,6].map(o=>e.jsxs("button",{onClick:()=>n(o.toString()),className:`px-6 py-2 rounded-lg font-bold transition ${d===o.toString()?"bg-yellow-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(la,{size:18,className:"inline mr-2"}),"Pump ",o]},o))}),e.jsxs("div",{className:"ml-auto text-right",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Pump ",d," Total"]}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600",children:[i.pumpTotal.toLocaleString()," KES"]})]})]})})}),e.jsx("div",{className:"bg-gray-100 border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-yellow-600 text-white rounded-lg font-semibold",children:"â›½ Super"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"â›½ Regular"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"â›½ Diesel"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ›¢ï¸ LPG"})]})}),e.jsx("div",{className:"bg-white",children:e.jsx(st,{businessType:"petrol",pumpNumber:d})}),e.jsxs("div",{className:"bg-yellow-700 text-white py-4 text-center flex items-center justify-center gap-2",children:[e.jsx(De,{size:18}),e.jsx("p",{className:"text-sm",children:"Pump tracking â€¢ Tank management â€¢ Shift reconciliation â€¢ Real-time readings"})]})]})}function tr(){const{user:t,logout:l}=oe(),c=he(),[d,n]=s.useState({size:"",color:""}),[i,a]=s.useState({sales:0,pairs:0,topSize:""});s.useEffect(()=>{const h=JSON.parse(localStorage.getItem("dayStats")||'{"sales": 0, "pairs": 0, "topSize": ""}');a(h)},[]);const o=["5","6","7","8","9","10","11","12","13"],p=["Black","White","Brown","Blue","Red","Green","Pink","Gray"];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-purple-100",children:[e.jsx("div",{className:"bg-purple-700 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 text-purple-200",children:"ðŸ‘Ÿ"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Shoes POS"}),e.jsx("p",{className:"text-purple-200 text-sm",children:"Footwear & Variants"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-purple-200 text-sm",children:"Daily Sales"}),e.jsxs("p",{className:"text-2xl font-bold text-green-300",children:[i.sales.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-purple-200 text-xs",children:[i.pairs," pairs sold â€¢ Top: Size ",i.topSize]})]}),e.jsxs("button",{onClick:()=>{l(),c("/auth/login")},className:"flex items-center gap-2 bg-purple-900 hover:bg-purple-950 px-4 py-2 rounded-lg transition",children:[e.jsx(Ae,{size:20}),"Logout"]})]})]})})}),e.jsx("div",{className:"bg-white border-b shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx(na,{size:18,className:"inline mr-2"}),"Filter by Size"]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:o.map(h=>e.jsx("button",{onClick:()=>n({...d,size:h===d.size?"":h}),className:`w-10 h-10 rounded-lg font-bold transition ${d.size===h?"bg-purple-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:h},h))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx(Me,{size:18,className:"inline mr-2"}),"Filter by Color"]}),e.jsxs("select",{value:d.color,onChange:h=>n({...d,color:h.target.value}),className:"px-4 py-2 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Colors"}),p.map(h=>e.jsx("option",{value:h,children:h},h))]})]})]})})}),e.jsx("div",{className:"bg-gray-100 border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold",children:"ðŸ‘Ÿ All Shoes"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸƒ Sports"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ‘ž Formal"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ‘  Casual"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ‘¢ Boots"})]})}),e.jsx("div",{className:"bg-white",children:e.jsx(st,{businessType:"shoes",filters:d})}),e.jsx("div",{className:"bg-purple-700 text-white py-4 text-center",children:e.jsx("p",{className:"text-sm",children:"Variant management â€¢ Size & color tracking â€¢ Stock by variant â€¢ Real-time availability"})})]})}function es(){const[t,l]=s.useState([]),[c,d]=s.useState([]),[n,i]=s.useState("all"),[a,o]=s.useState(""),[p,h]=s.useState(!1),[x,g]=s.useState([]),[r,C]=s.useState({subject:"",message:""}),[y,N]=s.useState(!0),[v,w]=s.useState(null),[f,b]=s.useState(!0),[A,z]=s.useState(null),W=he(),[_,L]=s.useState({totalUsers:0,activeUsers:0,lockedUsers:0,totalRevenue:0,pendingPayments:0,overduePayments:0}),[H,$]=s.useState([]);s.useEffect(()=>{const S=localStorage.getItem("token")||localStorage.getItem("mainAdminToken"),j=localStorage.getItem("user")||localStorage.getItem("mainAdminUser");if(!S||!j){W("/main-admin/login");return}try{if(JSON.parse(j).role!=="owner"){W("/main-admin/login");return}}catch{W("/main-admin/login");return}I().finally(()=>N(!1));const k=JSON.parse(localStorage.getItem("authActivities")||"[]");$(k.slice(0,10));const E=setInterval(()=>{const U=JSON.parse(localStorage.getItem("authActivities")||"[]");$(U.slice(0,10))},5e3);return()=>clearInterval(E)},[W]);const I=async()=>{try{w(null);let S=[],j=!0;try{S=await Et.getUsers()}catch(k){console.warn("MainAdmin API not available, falling back to regular users API:",k.message);try{S=await We.getAll()}catch(E){console.warn("Users API also failed:",E.message),j=!1}}S.length===0&&!j&&(S=K()),l(S),b(j),me(S,[])}catch(S){console.error("Failed to load data:",S),w("Failed to load dashboard data");const j=K();l(j),d(ce(j)),b(!1),me(j,[])}},F=()=>{localStorage.removeItem("mainAdminToken"),localStorage.removeItem("mainAdminUser"),W("/main-admin/login")},K=()=>{const S=localStorage.getItem("user"),j=[];if(S){const E=JSON.parse(S);j.push({...E,id:E.id||"real-user"})}return[{name:"John Doe",email:"john@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Jane Smith",email:"jane@example.com",plan:"basic",price:900,active:!0,locked:!1,role:"cashier"},{name:"Bob Wilson",email:"bob@example.com",plan:"ultra",price:1600,active:!1,locked:!1,role:"admin"},{name:"Alice Brown",email:"alice@example.com",plan:"basic",price:900,active:!0,locked:!0,role:"cashier"},{name:"Mike Johnson",email:"mike@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Sarah Davis",email:"sarah@example.com",plan:"basic",price:900,active:!1,locked:!1,role:"cashier"}].forEach((E,U)=>{j.push({id:`demo-${U+1}`,...E,createdAt:new Date(Date.now()-U*864e5).toISOString(),lastLogin:new Date(Date.now()-Math.random()*864e5).toISOString()})}),j},ce=S=>S.flatMap(j=>[{id:`payment-${j.id}-1`,userId:j.id,amount:j.plan==="ultra"?1600:900,status:Math.random()>.3?"paid":"pending",createdAt:new Date(Date.now()-30*864e5).toISOString(),dueDate:new Date(Date.now()+5*864e5).toISOString()},{id:`payment-${j.id}-2`,userId:j.id,amount:j.plan==="ultra"?1600:900,status:Math.random()>.7?"paid":Math.random()>.5?"pending":"overdue",createdAt:new Date(Date.now()-60*864e5).toISOString(),dueDate:new Date(Date.now()-5*864e5).toISOString()}]),me=(S,j)=>{const k=S.length,E=S.filter(B=>B.active).length,U=S.filter(B=>B.locked).length,J=j.filter(B=>B.status==="paid").reduce((B,Ce)=>B+Ce.amount,0),M=j.filter(B=>B.status==="pending").length,ee=j.filter(B=>B.status==="overdue").length;L({totalUsers:k,activeUsers:E,lockedUsers:U,totalRevenue:J,pendingPayments:M,overduePayments:ee})},te=async(S,j)=>{try{z(S);const k=!j;try{await Et.lockUser(S,k);const E=t.map(M=>M.id===S?{...M,locked:k,active:!k}:M);l(E),me(E,c);const U=t.find(M=>M.id===S),J=k?"locked":"unlocked";alert(`âœ… ${U?.name||`User ${S}`} has been ${J} successfully!`)}catch(E){console.error("API lock failed:",E);const U=t.map(ee=>ee.id===S?{...ee,locked:k,active:!k}:ee);l(U),me(U,c);const J=t.find(ee=>ee.id===S),M=k?"locked":"unlocked";alert(`âš ï¸ Backend not available. ${J?.name||`User ${S}`} ${M} locally. Changes will sync when backend is available.`)}}catch(k){console.error("Failed to toggle lock:",k),alert(`âŒ Failed to update user status: ${k.message}`)}finally{z(null)}},ke=async(S,j,k)=>{try{N(!0);try{await Et.sendEmail({userIds:S,subject:j,message:k}),alert("Emails sent successfully!"),h(!1),g([]),C({subject:"",message:""});return}catch(J){console.warn("Backend email operation failed, simulating email send:",J.message)}const E=t.filter(J=>S.includes(J.id)),U=JSON.parse(localStorage.getItem("emailLogs")||"[]");U.push({timestamp:new Date().toISOString(),recipients:E.map(J=>({id:J.id,name:J.name,email:J.email})),subject:j,message:k,status:"simulated"}),localStorage.setItem("emailLogs",JSON.stringify(U)),alert(`âœ… Email simulation successful!

ðŸ“§ Sent to ${E.length} user(s):
${E.map(J=>`${J.name} (${J.email})`).join(`
`)}

${f?"":`ðŸ“Œ Backend not deployed - this was a simulation.
`}ðŸ’¡ Deploy backend to send real emails.`),h(!1),g([]),C({subject:"",message:""})}catch(E){console.error("Failed to send email:",E),alert("Failed to process email request.")}finally{N(!1)}},pe=async S=>{const j=t.find(k=>k.id===S);j&&await ke([S],"Payment Reminder - Subscription",`Dear ${j.name},

This is a friendly reminder about your pending subscription payment for ${j.plan?.toUpperCase()} plan (KSH ${j.price}).

Please complete your payment to continue enjoying our services.

Thank you!`)},re=t.filter(S=>{const j=S.name?.toLowerCase().includes(a.toLowerCase())||S.email?.toLowerCase().includes(a.toLowerCase());if(n==="all")return j;if(n==="active")return j&&S.active&&!S.locked;if(n==="locked")return j&&S.locked;if(n==="trial")return j&&(!S.active||!S.plan);if(n==="pending-payment"){const k=c.filter(E=>E.userId===S.id&&E.status==="pending");return j&&k.length>0}if(n==="overdue"){const k=c.filter(E=>E.userId===S.id&&E.status==="overdue");return j&&k.length>0}return j}),ge=S=>{const j=c.filter(J=>J.userId===S),k=j.filter(J=>J.status==="pending").length,E=j.filter(J=>J.status==="overdue").length,U=j.filter(J=>J.status==="paid").length;return{pending:k,overdue:E,paid:U,total:j.length}};return y&&t.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-white mx-auto mb-4"}),e.jsx("p",{className:"text-white text-xl",children:"Loading Main Admin Dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900",children:[!f&&e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm md:text-base font-semibold",children:["âš ï¸ Demo Mode: Backend not available. Actions are simulated locally.",e.jsx("a",{href:"/BACKEND_NOT_DEPLOYED.md",className:"underline ml-2",children:"Deploy Backend â†’"})]})}),v&&e.jsx("div",{className:"bg-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm font-semibold",children:["âš ï¸ ",v]})}),e.jsx("header",{className:"bg-black/30 backdrop-blur-lg border-b border-white/10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Main Admin Dashboard"}),e.jsx("p",{className:"text-gray-300",children:"Monitor all users, payments, and system activity"})]}),e.jsxs("button",{onClick:F,className:"flex items-center gap-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 px-4 py-2 rounded-lg transition-colors",children:[e.jsx(Ae,{className:"w-4 h-4"}),"Logout"]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(et,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:_.totalUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Qe,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:_.activeUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Active Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(be,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:_.lockedUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Locked Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Xe,{className:"w-8 h-8 text-yellow-400"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:["KSH ",_.totalRevenue.toLocaleString()]})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ze,{className:"w-8 h-8 text-orange-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:_.pendingPayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Pending Payments"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ft,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:_.overduePayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Overdue Payments"})]})]}),e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 flex-1 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-80",children:[e.jsx(mt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",value:a,onChange:S=>o(S.target.value)})]}),e.jsxs("select",{value:n,onChange:S=>i(S.target.value),className:"px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"locked",children:"Locked"}),e.jsx("option",{value:"trial",children:"Free Trial"}),e.jsx("option",{value:"pending-payment",children:"Pending Payment"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsxs("button",{onClick:()=>h(!0),disabled:x.length===0||y,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-3 rounded-lg font-bold flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(wt,{className:"w-5 h-5"}),"Send Email to Selected (",x.length,")"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"xl:col-span-2 bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"All Users"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left",children:e.jsx("input",{type:"checkbox",checked:x.length===re.length&&re.length>0,onChange:S=>{S.target.checked?g(re.map(j=>j.id)):g([])},className:"w-5 h-5 rounded"})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Actions"})]})}),e.jsxs("tbody",{children:[re.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:"5",className:"px-4 py-12 text-center",children:[e.jsx(et,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:a||n!=="all"?"Try adjusting your filters":"Users will appear here once they sign up"})]})}),re.map(S=>(ge(S.id),e.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:x.includes(S.id),onChange:j=>{j.target.checked?g([...x,S.id]):g(x.filter(k=>k!==S.id))},className:"w-5 h-5 rounded"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[S.profilePicture?e.jsx("img",{src:S.profilePicture,alt:S.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:S.name?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:S.name}),e.jsx("p",{className:"text-sm text-gray-400",children:S.email})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${S.plan==="ultra"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"}`,children:[S.plan?.toUpperCase()," - KSH ",S.price]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"flex items-center gap-2",children:S.locked?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-300 flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3"}),"Locked"]}):S.active?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-300 flex items-center gap-1",children:[e.jsx(Qe,{className:"w-3 h-3"}),"Active"]}):e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-500/20 text-gray-300",children:"Inactive"})})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>te(S.id,S.locked),disabled:A===S.id,className:`p-2 rounded-lg transition ${S.locked?"bg-green-500/20 hover:bg-green-500/30 text-green-300":"bg-red-500/20 hover:bg-red-500/30 text-red-300"} ${A===S.id?"opacity-50 cursor-not-allowed":""}`,title:S.locked?"Unlock User":"Lock User",children:A===S.id?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):S.locked?e.jsx(ia,{className:"w-4 h-4"}):e.jsx(be,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>pe(S.id),disabled:y,className:"p-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 transition",title:"Send Payment Reminder",children:e.jsx(oa,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{S.role==="cashier"?window.open("/dashboard/cashier","_blank"):window.open("/admin","_blank")},className:"p-2 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 transition",title:"View User Dashboard",children:e.jsx(ns,{className:"w-4 h-4"})})]})})]},S.id)))]})]})})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl border border-white/20",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5"}),"Recent Activity"]})}),e.jsx("div",{className:"p-4 space-y-3 max-h-96 overflow-y-auto",children:H.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"No recent activity"}):H.map(S=>e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${S.type==="login"?"bg-green-400":"bg-blue-400"}`}),e.jsx("span",{className:"text-white font-medium",children:S.user.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${S.type==="login"?"bg-green-500/20 text-green-300":"bg-blue-500/20 text-blue-300"}`,children:S.type})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:S.user.email}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:new Date(S.timestamp).toLocaleString()})]},S.id))})]})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-purple-900 rounded-2xl shadow-2xl max-w-2xl w-full border border-white/20",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(wt,{}),"Send Email to ",x.length," User(s)"]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Subject"}),e.jsx("input",{type:"text",value:r.subject,onChange:S=>C({...r,subject:S.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email subject..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Message"}),e.jsx("textarea",{value:r.message,onChange:S=>C({...r,message:S.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 h-40",placeholder:"Email message..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>ke(x,r.subject,r.message),disabled:y,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white py-3 rounded-lg font-bold transition disabled:opacity-50",children:y?"Sending...":"Send Email"}),e.jsx("button",{onClick:()=>h(!1),className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-lg font-bold transition",children:"Cancel"})]})]})]})})]})}function sr({user:t}){const[l,c]=s.useState(!1);if(l||!t)return null;const d=t?.serviceStartDate?new Date(t.serviceStartDate):null,n=t?.daysUsed||0,i=t?.plan||"",o=Math.max(0,30-n);return o>7?null:e.jsxs("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-3 md:p-4 flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(Re,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-amber-900",children:o===0?`Your ${i} plan has expired. Please renew to continue.`:`Your ${i} plan expires in ${o} day${o!==1?"s":""}. Consider upgrading.`}),e.jsxs("p",{className:"text-xs text-amber-700 mt-1",children:["Service started: ",d?.toLocaleDateString()||"Unknown"]})]})]}),e.jsx("button",{onClick:()=>c(!0),className:"flex-shrink-0 text-amber-600 hover:text-amber-900",children:e.jsx(Ie,{className:"w-5 h-5"})})]})}function ar(){const{refreshProducts:t}=Mt();return s.useEffect(()=>{const l=n=>{console.log(" Stock update received:",n.detail),t()},c=n=>{console.log(" Sale completed, refreshing stock:",n.detail),t()},d=n=>{console.log(" Products sync event:",n.detail)};return window.addEventListener("stockUpdate",l),window.addEventListener("saleComplete",c),window.addEventListener("productsSync",d),()=>{window.removeEventListener("stockUpdate",l),window.removeEventListener("saleComplete",c),window.removeEventListener("productsSync",d)}},[t]),null}function ye({children:t,adminOnly:l=!1,ultraOnly:c=!1,ownerOnly:d=!1}){const{user:n,loading:i}=oe(),{isLocked:a,lock:o,unlock:p}=ps(),[h,x]=s.useState(!1),g=bs(6e4),r=g?.[0]||a||!1,C=s.useCallback(()=>{g?.[1]?.(),p()},[g,p]),[y,N]=s.useState({});if(s.useEffect(()=>{n&&!d&&((async()=>{try{const f=localStorage.getItem("token"),A=await fetch(`${ae}/settings`,{headers:{Authorization:`Bearer ${f}`}});if(A.ok){const z=await A.json();N(z)}}catch(f){console.error("Failed to load settings:",f)}})(),sessionStorage.getItem("reminderShown")||(x(!0),sessionStorage.setItem("reminderShown","true")))},[n,d]),s.useEffect(()=>{const w=f=>{console.log("ðŸ”’ Admin locked screen:",f.detail),o("admin")};return window.addEventListener("admin_locked_user_screen",w),()=>window.removeEventListener("admin_locked_user_screen",w)},[o]),i&&!d)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(d){const w=localStorage.getItem("ownerToken"),f=localStorage.getItem("ownerUser");if(!w||!f)return e.jsx(xe,{to:"/main.admin"});try{if(JSON.parse(f).type!=="main_admin")return e.jsx(xe,{to:"/main.admin"})}catch{return e.jsx(xe,{to:"/main.admin"})}}else{if(!n)return e.jsx(xe,{to:"/auth/login"});if(!n.active)return e.jsx(xe,{to:"/choose-subscription"});if(l&&n.role!=="admin")return e.jsx(xe,{to:"/dashboard"});if(c&&(n.role!=="admin"||n.plan!=="ultra"))return e.jsx(xe,{to:"/dashboard"})}const v=d?"owner":"user";return e.jsxs(e.Fragment,{children:[e.jsx(sr,{}),e.jsx(ar,{}),r&&e.jsx(fs,{onUnlock:C,userType:v}),h&&e.jsx(gs,{onClose:()=>x(!1)}),t]})}function rr(){const{user:t}=oe();return!t||!t.active?e.jsx(xe,{to:"/choose-subscription"}):t.role==="admin"?e.jsx(xe,{to:"/admin"}):e.jsx(xe,{to:"/dashboard/cashier"})}function lr(){return e.jsx(fa,{children:e.jsx(ba,{children:e.jsx(ya,{children:e.jsx(Ls,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(ss,{children:[e.jsx(Z,{path:"/",element:e.jsx(xe,{to:"/get-started"})}),e.jsx(Z,{path:"/get-started",element:e.jsx(Ua,{})}),e.jsx(Z,{path:"/choose-subscription",element:e.jsx(Ra,{})}),e.jsx(Z,{path:"/auth/login",element:e.jsx(Xt,{})}),e.jsx(Z,{path:"/auth/signup",element:e.jsx(Xt,{})}),e.jsx(Z,{path:"/plans",element:e.jsx(xe,{to:"/choose-subscription"})}),e.jsx(Z,{path:"/build-pos",element:e.jsx(Ma,{})}),e.jsx(Z,{path:"/main.admin/*",element:e.jsx(es,{})}),e.jsx(Z,{path:"/main-admin",element:e.jsx(ye,{ownerOnly:!0,children:e.jsx(es,{})})}),e.jsx(Z,{path:"/dashboard",element:e.jsx(ye,{children:e.jsx(rr,{})})}),e.jsx(Z,{path:"/dashboard/cashier",element:e.jsx(ye,{children:e.jsx(Zt,{})})}),e.jsx(Z,{path:"/cashier/bar",element:e.jsx(ye,{children:e.jsx(Ya,{})})}),e.jsx(Z,{path:"/cashier/hospital",element:e.jsx(ye,{children:e.jsx(Qa,{})})}),e.jsx(Z,{path:"/cashier/school",element:e.jsx(ye,{children:e.jsx(Xa,{})})}),e.jsx(Z,{path:"/cashier/kiosk",element:e.jsx(ye,{children:e.jsx(Za,{})})}),e.jsx(Z,{path:"/cashier/petrol",element:e.jsx(ye,{children:e.jsx(er,{})})}),e.jsx(Z,{path:"/cashier/shoes",element:e.jsx(ye,{children:e.jsx(tr,{})})}),e.jsx(Z,{path:"/admin/*",element:e.jsx(ye,{adminOnly:!0,children:e.jsx(Qt,{})})}),e.jsx(Z,{path:"/admin",element:e.jsx(ye,{adminOnly:!0,children:e.jsx(Qt,{})})}),e.jsx(Z,{path:"/login",element:e.jsx(xe,{to:"/auth/login"})}),e.jsx(Z,{path:"/signup",element:e.jsx(xe,{to:"/auth/signup"})}),e.jsx(Z,{path:"/subscription",element:e.jsx(xe,{to:"/choose-subscription"})}),e.jsx(Z,{path:"/payment",element:e.jsx(xe,{to:"/choose-subscription"})}),e.jsx(Z,{path:"/cashier",element:e.jsx(ye,{children:e.jsx(Zt,{})})})]})})})})})}ua.createRoot(document.getElementById("root")).render(e.jsx(Os.StrictMode,{children:e.jsx(lr,{})}));
