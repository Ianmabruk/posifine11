import{a as dl,b as ul,g as ml,r as x,u as Te,c as Yr,R as Xr,d as ee,B as hl,N as ke,e as xl}from"./vendor-Ct1st1Nj.js";import{C as it,D as Lt,T as Ye,P as ot,S as Zr,a as ss,b as ls,c as Ie,d as pl,e as fl,f as Mt,g as Nt,h as Fe,i as Qr,j as gl,k as ei,l as yl,L as De,U as Sn,m as kn,n as Is,E as ti,M as Pn,o as Rt,X as _e,p as Ze,q as Yt,r as Ba,s as Es,t as Cn,u as jt,B as qa,R as bl,I as jl,v as Ot,w as fa,x as It,y as ws,z as Ls,A as vl,F as Nl,G as wl,H as Sl,J as kl,K as Pl,N as Cl,O as Tl,Q as He,V as Al,W as Kt,Y as si,Z as ga,_ as rt,$ as ya,a0 as ai,a1 as Dl,a2 as Il,a3 as El,a4 as Ll,a5 as Ml,a6 as Rl,a7 as Ol,a8 as Fl,a9 as Vl,aa as $l,ab as Ul,ac as Bl}from"./icons-I09nBQzQ.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}})();var Ys={exports:{}},Wt={};var Tn;function ql(){if(Tn)return Wt;Tn=1;var t=dl(),s=Symbol.for("react.element"),a=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,r=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(l,c,m){var d,h={},u=null,b=null;m!==void 0&&(u=""+m),c.key!==void 0&&(u=""+c.key),c.ref!==void 0&&(b=c.ref);for(d in c)n.call(c,d)&&!o.hasOwnProperty(d)&&(h[d]=c[d]);if(l&&l.defaultProps)for(d in c=l.defaultProps,c)h[d]===void 0&&(h[d]=c[d]);return{$$typeof:s,type:l,key:u,ref:b,props:h,_owner:r.current}}return Wt.Fragment=a,Wt.jsx=i,Wt.jsxs=i,Wt}var An;function zl(){return An||(An=1,Ys.exports=ql()),Ys.exports}var e=zl(),gs={},Dn;function Wl(){if(Dn)return gs;Dn=1;var t=ul();return gs.createRoot=t.createRoot,gs.hydrateRoot=t.hydrateRoot,gs}var _l=Wl();const Kl=ml(_l),Hl=()=>"https://universal-backend-w0x1.onrender.com/api",le=Hl(),ni=()=>localStorage.getItem("token"),ri=async(t,s={},a=0,n=3)=>{const r=ni(),o=t.startsWith("/")?t:`/${t}`,i={...s,headers:{"Content-Type":"application/json",...r&&!(o.startsWith("/auth")&&o!=="/auth/me")&&!o.includes("/main-admin/auth/login")&&{Authorization:`Bearer ${r}`},...s.headers}};try{const l=await fetch(`${le}${o}`,i);if(l.status===401){if(o.includes("/auth/login")||o.includes("/main-admin/auth/login")){const b=await l.json().catch(()=>({error:"Unauthorized"}));throw new Error(b.error||"Invalid credentials")}localStorage.removeItem("token"),localStorage.removeItem("user");const m=window.location.pathname||"";if(!["/","/get-started","/choose-subscription","/plans","/subscription","/build-pos","/login","/signup","/auth","/main.admin"].some(b=>m===b||m.startsWith(b)))try{window.location.href="/auth/login"}catch{}const u=new Error("Unauthorized");throw u.status=401,u}if(l.status===500)throw new Error("Server error 500 - Backend unavailable");if(l.ok)return l.status===204?{success:!0}:await l.json();const c=await l.json().catch(()=>({error:"Network error"}));throw new Error(c.error||`HTTP ${l.status}: ${l.statusText}`)}catch(l){if(l.name==="TypeError"&&l.message.includes("fetch")){if(console.error(`API Fetch Error (attempt ${a+1}/${n+1}):`,l),console.error("Attempted URL:",`${le}${o}`),a<n){const c=Math.min(1e3*Math.pow(2,a),1e4);return console.log(`Retrying in ${c}ms...`),await new Promise(m=>setTimeout(m,c)),ri(t,s,a+1,n)}throw new Error("Cannot connect to server. The server may be waking up. Please try again in a moment.")}throw l}},U=(t,s={})=>ri(t,s,0,3),Pt={login:t=>U("/auth/login",{method:"POST",body:JSON.stringify(t)}),pinLogin:t=>U("/auth/pin-login",{method:"POST",body:JSON.stringify(t)}),signup:t=>U("/auth/signup",{method:"POST",body:JSON.stringify(t)}),signupWithPayment:t=>U("/signup-with-payment",{method:"POST",body:JSON.stringify(t)}),me:()=>U("/auth/me"),updatePin:t=>U("/auth/update-pin",{method:"POST",body:JSON.stringify({pin:t})})},gt={getAll:()=>U("/users"),create:t=>U("/users",{method:"POST",body:JSON.stringify(t)}),update:(t,s)=>U(`/users/${t}`,{method:"PUT",body:JSON.stringify(s)}),delete:t=>U(`/users/${t}`,{method:"DELETE"}),setPin:(t,s)=>U(`/users/${t}/set-pin`,{method:"POST",body:JSON.stringify({pin:s})}),lock:(t,s)=>U(`/users/${t}/lock`,{method:"POST",body:JSON.stringify({locked:s})})},we={getAll:()=>U("/products"),create:t=>U("/products",{method:"POST",body:JSON.stringify(t)}),update:(t,s)=>U(`/products/${t}`,{method:"PUT",body:JSON.stringify(s)}),delete:t=>U(`/products/${t}`,{method:"DELETE"}),getLowStockWarnings:()=>U("/products/low-stock-warnings"),updateStock:(t,s)=>U(`/products/${t}/stock`,{method:"PUT",body:JSON.stringify(s)}),getMaxProducible:t=>U(`/products/${t}/max-producible`),getWeightPricing:t=>U(`/products/${t}/weight-pricing`),addWeightPrice:(t,s,a)=>U(`/products/${t}/weight-pricing`,{method:"POST",body:JSON.stringify({weight:s,price:a})}),updateWeightPrice:(t,s,a)=>U(`/products/${t}/weight-pricing`,{method:"PUT",body:JSON.stringify({weight:s,price:a})}),deleteWeightPrice:(t,s)=>U(`/products/${t}/weight-pricing`,{method:"DELETE",body:JSON.stringify({weight:s})})},zs={getAll:()=>U("/sales"),create:t=>U("/sales",{method:"POST",body:JSON.stringify(t)}),delete:t=>U(`/sales/${t}`,{method:"DELETE"}),adminComplete:t=>U("/admin-complete-sale",{method:"POST",body:JSON.stringify(t)})},Ms={getAll:()=>U("/expenses"),create:t=>U("/expenses",{method:"POST",body:JSON.stringify(t)}),update:(t,s)=>U(`/expenses/${t}`,{method:"PUT",body:JSON.stringify(s)}),delete:t=>U(`/expenses/${t}`,{method:"DELETE"})},ii={get:()=>U("/stats")},Ht={getAll:()=>U("/discounts"),create:t=>U("/discounts",{method:"POST",body:JSON.stringify(t)}),update:(t,s)=>U(`/discounts/${t}`,{method:"PUT",body:JSON.stringify(s)}),delete:t=>U(`/discounts/${t}`,{method:"DELETE"})},Ss={getAll:()=>U("/credit-requests"),create:t=>U("/credit-requests",{method:"POST",body:JSON.stringify(t)}),update:(t,s)=>U(`/credit-requests/${t}`,{method:"PUT",body:JSON.stringify(s)}),approve:t=>U(`/credit-requests/${t}/approve`,{method:"POST"}),reject:t=>U(`/credit-requests/${t}/reject`,{method:"POST"})},Xt={get:()=>U("/settings"),update:t=>U("/settings",{method:"PUT",body:JSON.stringify(t)})},ks={getAll:()=>U("/time-entries"),getStatus:()=>U("/clock-status"),create:t=>U("/time-entries",{method:"POST",body:JSON.stringify({action:t})}),update:(t,s)=>U(`/time-entries/${t}`,{method:"PUT",body:JSON.stringify(s)}),delete:t=>U(`/time-entries/${t}`,{method:"DELETE"})},Rs={getAll:t=>{const s=t?`/batches?productId=${t}`:"/batches";return U(s)},create:t=>U("/batches",{method:"POST",body:JSON.stringify(t)})},Xs={login:t=>U("/main-admin/auth/login",{method:"POST",body:JSON.stringify(t)}),getUsers:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return U("/main-admin/users",{headers:{Authorization:`Bearer ${t}`}})},getStats:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return U("/main-admin/stats",{headers:{Authorization:`Bearer ${t}`}})},getActivities:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return U("/main-admin/activities",{headers:{Authorization:`Bearer ${t}`}})},getSalesAll:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return U("/main-admin/sales-all",{headers:{Authorization:`Bearer ${t}`}})},getTimeEntriesAll:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return U("/main-admin/time-entries-all",{headers:{Authorization:`Bearer ${t}`}})},lockUser:(t,s)=>{const a=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return U(`/main-admin/users/${t}/lock`,{method:"POST",headers:{Authorization:`Bearer ${a}`},body:JSON.stringify({locked:s})})},changePlan:(t,s)=>{const a=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return U(`/main-admin/users/${t}/plan`,{method:"POST",headers:{Authorization:`Bearer ${a}`},body:JSON.stringify({plan:s})})},clearData:t=>{const s=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return U("/main-admin/system/clear-data",{method:"POST",headers:{Authorization:`Bearer ${s}`},body:JSON.stringify({type:t})})},getSubscribers:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return U("/main-admin/subscribers",{headers:{Authorization:`Bearer ${t}`}})},getSubscribersAnalytics:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return U("/main-admin/subscribers/analytics",{headers:{Authorization:`Bearer ${t}`}})},getUsersWithSubscriptions:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return U("/main-admin/users-with-subscriptions",{headers:{Authorization:`Bearer ${t}`}})}};let Me=null,Ps=new Set;function Gl(){const t=le.replace(/\/api$/,"");return`${t.startsWith("https")?"wss":"ws"}://${t.replace(/^https?:\/\//,"")}/api/ws/products`}function Jl(){if(Me&&(Me.readyState===WebSocket.OPEN||Me.readyState===WebSocket.CONNECTING))return;const t=ni(),s=Gl()+(t?`?token=${encodeURIComponent(t)}`:"");Me=new WebSocket(s),Me.onopen=()=>{console.debug("Products WS connected")},Me.onmessage=a=>{let n=null;try{n=JSON.parse(a.data)}catch{return}Ps.forEach(r=>{try{r(n)}catch(o){console.error("ws callback error",o)}})},Me.onclose=()=>{console.debug("Products WS closed"),Me=null},Me.onerror=a=>{console.error("Products WS error",a)}}function In(t){if(typeof t!="function")throw new Error("subscribeProducts requires a callback");return Ps.add(t),Jl(),()=>{if(Ps.delete(t),Me&&Ps.size===0){try{Me.close()}catch{}Me=null}}}const oi=x.createContext(),be=()=>x.useContext(oi),Yl=({children:t})=>{const[s,a]=x.useState(null),[n,r]=x.useState(!0),[o,i]=x.useState(!1),[l,c]=x.useState({});x.useEffect(()=>{m()},[]),x.useEffect(()=>{const D=()=>{const $=localStorage.getItem("user");if($)try{const G=JSON.parse($);a(G)}catch(G){console.warn("Failed to parse user from localStorage",G)}else a(null)};return window.addEventListener("storage",D),window.addEventListener("localStorageUpdated",D),()=>{window.removeEventListener("storage",D),window.removeEventListener("localStorageUpdated",D)}},[]);const m=async()=>{try{const D=localStorage.getItem("token"),$=localStorage.getItem("user");if(D)try{const G=await fetch(`${le}/auth/me`,{headers:{Authorization:`Bearer ${D}`,"Content-Type":"application/json"}});if(G.ok){const me=await G.json();a(me),localStorage.setItem("user",JSON.stringify(me))}else throw new Error("Invalid token")}catch(G){console.warn("Auth check failed:",G),localStorage.removeItem("token"),localStorage.removeItem("user")}}catch(D){console.error("Error initializing auth:",D),localStorage.removeItem("token"),localStorage.removeItem("user"),a(null)}finally{r(!1),i(!0)}},d=async D=>{try{if(D&&D.token&&D.user)return localStorage.setItem("token",D.token),localStorage.setItem("user",JSON.stringify(D.user)),a(D.user),D;const $=await Pt.login(D);if($.token&&$.user)return localStorage.setItem("token",$.token),localStorage.setItem("user",JSON.stringify($.user)),a($.user),$;throw new Error("Invalid response from server")}catch($){throw console.error("Login failed:",$),$}},h=async D=>{try{const $=await Pt.signup(D);if($.token&&$.user)return localStorage.setItem("token",$.token),localStorage.setItem("user",JSON.stringify($.user)),a($.user),$;throw new Error("Invalid response from server")}catch($){throw console.error("Signup failed:",$),$}},u=async D=>{try{if(localStorage.setItem("user",JSON.stringify(D)),a(D),window.dispatchEvent(new Event("localStorageUpdated")),D&&D.id)try{await gt.update(D.id,D)}catch($){console.warn("Failed to persist updated user to backend",$)}return D}catch($){throw console.error("updateUser failed:",$),$}},b=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),a(null),window.location.href="/auth/login"},p=()=>!!s&&!!localStorage.getItem("token"),y=D=>s&&s.role===D,j=()=>s&&s.role==="owner",v=()=>s&&(s.role==="admin"||s.role==="main-admin"),g=()=>s&&s.role==="cashier",f=(D=null)=>{const $=D||s?.role;return $==="owner"?"/main-admin":$==="admin"?"/admin":$==="cashier"?"/cashier":"/dashboard"},k=()=>s&&s.plan==="ultra",I=()=>s&&s.plan==="basic",O=()=>s&&(s.role==="admin"||s.role==="cashier"),F=()=>s&&s.role==="admin"&&s.plan==="ultra",C=()=>s&&s.role==="admin",B=()=>!0,E=()=>!0;return s?.locked?e.jsx(LockedAccount,{}):e.jsx(oi.Provider,{value:{user:s,loading:n,isInitialized:o,appSettings:l,login:d,signup:h,updateUser:u,logout:b,isAuthenticated:p,hasRole:y,isOwner:j,isAdmin:v,isCashier:g,getDashboardUrl:f,isUltraPackage:k,isBasicPackage:I,canEditStock:O,canManageUsers:F,canViewAnalytics:C,isRealTimeProductSyncEnabled:B,isCashierUserManagementEnabled:E},children:t})};new Date().toISOString();const li=x.createContext(),za=()=>x.useContext(li),Xl=({children:t})=>{const{user:s}=be(),[a,n]=x.useState([]),[r,o]=x.useState(!0),[i,l]=x.useState(null),[c,m]=x.useState(Date.now()),d=x.useCallback(async()=>{if(!localStorage.getItem("token"))return o(!1),[];try{const u=await we.getAll(),p=(Array.isArray(u)?u:[]).filter(y=>!y.pendingDelete);return n(p),l(null),window.dispatchEvent(new CustomEvent("productsSync",{detail:{products:p,timestamp:Date.now()}})),p}catch(u){return console.error("Failed to fetch products:",u),l(`Failed to load products: ${u.message}`),n([]),[]}finally{o(!1),m(Date.now())}},[]);x.useEffect(()=>{d()},[]),x.useEffect(()=>{const u=()=>{console.log("ðŸ”„ Data cleared event received - forcing products refresh"),n([]),l(null),d()};return window.addEventListener("dataCleared",u),window.addEventListener("productsCleared",u),()=>{window.removeEventListener("dataCleared",u),window.removeEventListener("productsCleared",u)}},[]);const h=async()=>(o(!0),await d());return e.jsx(li.Provider,{value:{products:a,loading:r,error:i,lastUpdated:c,refreshProducts:h},children:t})},ci=x.createContext(),di=()=>x.useContext(ci),Zl=900*1e3,Ql=({children:t})=>{const{user:s}=be(),[a,n]=x.useState(!1),r=x.useRef(null),o=x.useRef(Date.now()),i=x.useCallback(()=>{o.current=Date.now(),r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{n(!0),console.log("ðŸ”’ Screen locked due to inactivity")},Zl)},[]);x.useEffect(()=>{const d=["mousedown","keydown","click","touchstart"];return d.forEach(h=>{document.addEventListener(h,i)}),i(),()=>{d.forEach(h=>{document.removeEventListener(h,i)}),r.current&&clearTimeout(r.current)}},[i]);const l=x.useCallback(()=>{n(!0),console.log("ðŸ”’ Screen manually locked")},[]),c=x.useCallback(()=>{n(!1),i(),console.log("ðŸ”“ Screen unlocked")},[i]),m={isLocked:a,lock:l,unlock:c};return e.jsx(ci.Provider,{value:m,children:t})};function ec(){const[t,s]=x.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[a,n]=x.useState(!0),[r,o]=x.useState(null);x.useEffect(()=>{i()},[]);const i=async()=>{try{o(null);const[m,d]=await Promise.all([ii.get(),zs.getAll()]),h={totalSales:m?.totalSales||0,totalExpenses:m?.totalExpenses||0,profit:m?.profit||0,grossProfit:m?.grossProfit||0,netProfit:m?.netProfit||0,totalCOGS:m?.totalCOGS||0,dailySales:m?.dailySales||0,weeklySales:m?.weeklySales||0,productCount:m?.productCount||0},u=Array.isArray(d)?d:[];s({stats:h,recentSales:u.slice(-10).reverse()})}catch(m){console.error("Failed to load data:",m),o(m.message),s({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{n(!1)}};if(a)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(r&&t.stats.totalSales===0&&t.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(it,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:r}),e.jsx("button",{onClick:i,className:"btn-primary",children:"Retry"})]})});const l=[{label:"Total Sales",value:`KSH ${t.stats.totalSales?.toLocaleString()||0}`,icon:Lt,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${t.stats.grossProfit?.toLocaleString()||0}`,icon:Ye,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${t.stats.totalCOGS?.toLocaleString()||0}`,icon:ot,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${t.stats.netProfit?.toLocaleString()||0}`,icon:Ye,color:"from-purple-500 to-pink-600",change:"+15.3%"}],c=[{label:"Daily Sales",value:`KSH ${t.stats.dailySales?.toLocaleString()||0}`,icon:Zr,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${t.stats.weeklySales?.toLocaleString()||0}`,icon:Ye,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${t.stats.totalExpenses?.toLocaleString()||0}`,icon:ss,color:"bg-red-50 text-red-600"},{label:"Products",value:t.stats.productCount||0,icon:ot,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(l||[]).map((m,d)=>{const h=m?.icon;return h?e.jsxs("div",{className:`card bg-gradient-to-br ${m.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(h,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:m.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:m.label}),e.jsx("p",{className:"text-2xl font-bold",children:m.value})]},d):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(c||[]).map((m,d)=>{const h=m?.icon;return h?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${m.color} flex items-center justify-center`,children:e.jsx(h,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:m.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:m.value})]})]})},d):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!t.recentSales||t.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(it,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(t.recentSales||[]).map(m=>m?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:m.createdAt?new Date(m.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(m.items)?m.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:m.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",m.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",m.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",m.profit?.toLocaleString()||0]})]},m.id||Math.random()):null)})]})})]})]})}const tc=()=>"https://universal-backend-w0x1.onrender.com/api".replace("https://","wss://").replace("http://","ws://");class sc{constructor(){this.ws=null,this.listeners={stock_updated:[],sale_completed:[],admin_sale_completed:[],product_created:[],product_updated:[],product_deleted:[],heartbeat:[],initial:[],error:[]},this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.isManualClose=!1}connect(s,a){return new Promise((n,r)=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){n();return}if(!s){r(new Error("No token provided for WebSocket connection"));return}const o=`${tc()}/ws/products?token=${encodeURIComponent(s)}`;try{this.ws=new WebSocket(o),this.ws.onopen=()=>{console.log("âœ… WebSocket connected for real-time updates"),this.reconnectAttempts=0,n()},this.ws.onmessage=i=>{try{const l=JSON.parse(i.data),c=l.type?l.type.toLowerCase():"unknown";c==="stock_updated"?(console.log("ðŸ“¦ Stock update received:",l.data),a&&a(l.data),this.emit("stock_updated",l.data)):c==="sale_completed"?(console.log("ðŸ’° Sale completed - stock deducted:",l.data),this.emit("sale_completed",l.data),a&&l.data.updatedProducts&&a({allProducts:l.data.updatedProducts})):c==="admin_sale_completed"?(console.log("ðŸ‘¨â€ðŸ’¼ Admin sale completed:",l.data),this.emit("admin_sale_completed",l.data),this.emit("sale_completed",l.data),a&&l.data.updatedProducts&&a({allProducts:l.data.updatedProducts})):c==="product_created"?(console.log("âœ¨ Product created:",l.data),this.emit("product_created",l.data)):c==="product_updated"?(console.log("ðŸ“ Product updated:",l.data),this.emit("product_updated",l.data),a&&l.data.allProducts&&a({allProducts:l.data.allProducts})):c==="product_deleted"?(console.log("ðŸ—‘ï¸ Product deleted:",l.data),this.emit("product_deleted",l.data),a&&l.data.allProducts&&a({allProducts:l.data.allProducts})):c==="initial"?(console.log("ðŸ“¦ Initial products loaded via WebSocket"),this.emit("initial",l.products)):c==="heartbeat"?this.emit("heartbeat",l):(console.log(`ðŸ“¨ Message received (${c}):`,l.data),c!=="unknown"&&this.emit(c,l.data))}catch(l){console.error("Error parsing WebSocket message:",l)}},this.ws.onerror=i=>{console.error("âŒ WebSocket error:",i),this.emit("error",i),r(i)},this.ws.onclose=()=>{console.log("ðŸ”Œ WebSocket disconnected"),this.isManualClose||this.attemptReconnect(s,a)}}catch(i){console.error("Failed to create WebSocket:",i),r(i)}})}attemptReconnect(s,a){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Max reconnection attempts reached");return}this.reconnectAttempts++;const n=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`ðŸ”„ Reconnecting in ${n}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect(s,a).catch(r=>{console.error("Reconnection failed:",r)})},n)}on(s,a){this.listeners[s]||(this.listeners[s]=[]),this.listeners[s].push(a)}emit(s,a){this.listeners[s]&&this.listeners[s].forEach(n=>{try{n(a)}catch(r){console.error(`Error in ${s} listener:`,r)}})}disconnect(){this.isManualClose=!0,this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}}const ze=new sc;function ac(){const{user:t,isUltraPackage:s,isRealTimeProductSyncEnabled:a}=be(),{products:n,refreshProducts:r}=za(),[o,i]=x.useState([]),[l,c]=x.useState([]),[m,d]=x.useState(!1),[h,u]=x.useState("all"),[b,p]=x.useState(""),[y,j]=x.useState(!1),[v,g]=x.useState(!1),[f,k]=x.useState(!1),[I,O]=x.useState(!1),[F,C]=x.useState(null),[B,E]=x.useState({}),[D,$]=x.useState({weight:"",price:""}),[G,me]=x.useState(null),[fe,ae]=x.useState(null),[se,re]=x.useState(!1),[te,he]=x.useState(null),[P,S]=x.useState(""),[T,M]=x.useState({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),[q,H]=x.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[W,ne]=x.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0}),K=async()=>{try{console.log("ðŸ“¦ Loading inventory data..."),await r();const w=await Rs.getAll();c(w),console.log("âœ… Inventory data loaded")}catch(w){console.error("âŒ Failed to load data:",w),oe("Failed to load inventory data","error")}};x.useEffect(()=>{m||(K(),d(!0));const w=localStorage.getItem("token");return w&&(ze.connect(w,A=>{A&&A.allProducts&&A.allProducts.length>0&&(console.log("ðŸ“¦ WebSocket stock update received:",A.allProducts.length,"products"),i(z=>{if(z.length===0)return A.allProducts;const Q=new Map(z.map(Y=>[Y.id,Y]));return A.allProducts.forEach(Y=>{const de=Q.get(Y.id);de?Q.set(Y.id,{...de,quantity:Y.quantity}):Q.set(Y.id,Y)}),Array.from(Q.values())}))}).catch(A=>{console.warn("WebSocket connection failed:",A)}),ze.on("sale_completed",A=>{if(console.log("ðŸ”„ Sale completed - updating inventory display:",A),A.updatedProducts&&A.updatedProducts.length>0&&(console.log(`âœ… Updating ${A.updatedProducts.length} products from sale`),i(A.updatedProducts),oe(`âœ… Stock updated! Sale #${A.saleId} deducted inventory`,"success")),A.lowStockWarnings&&A.lowStockWarnings.length>0){const z=A.lowStockWarnings.map(Q=>`${Q.name}: ${Q.current} left`).join(", ");oe(`âš ï¸ Low stock alert: ${z}`,"warning")}})),()=>{ze.disconnect()}},[m]),x.useEffect(()=>{n&&n.length>0&&o.length===0&&(console.log("ðŸ“¦ Initial sync from global context:",n.length,"products"),i(n))},[]);const qe=(w,A=!0)=>{const z=w.target.files[0];if(z){if(z.size>2*1024*1024){oe("Image must be smaller than 2MB","error");return}const Q=new FileReader;Q.onload=Y=>{const de=Y.target.result;S(de),A?M({...T,image:de}):(ne({...W,image:de}),W.id&&setTimeout(async()=>{try{await we.update(W.id,{image:de}),oe("âœ… Image saved","success")}catch(st){console.error("Failed to save image:",st)}},500))},Q.readAsDataURL(z)}},ge=w=>l.filter(z=>z.productId===w&&z.quantity>0).reduce((z,Q)=>z+Q.quantity,0),et=w=>l.filter(A=>A.productId===w&&A.quantity>0),oe=(w,A="success")=>{ae({message:w,type:A}),setTimeout(()=>ae(null),5e3)},ut=async w=>{w.preventDefault();try{const A={...T,price:parseFloat(T.price),cost:parseFloat(T.cost||0),quantity:0,visibleToCashier:!T.expenseOnly&&T.visibleToCashier!==!1},z=await we.create(A);M({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),S(""),j(!1),oe(`âœ… Product "${z.name}" added successfully! ${z.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success"),K().catch(Q=>console.warn("Background refresh failed:",Q))}catch(A){console.error("Failed to create product:",A),alert(`Failed to create product: ${A.message||"Unknown error"}`)}},Hs=async w=>{w.preventDefault();try{const A={id:`batch-${Date.now()}`,productId:F.id,quantity:parseInt(q.quantity),expiryDate:q.expiryDate,batchNumber:q.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(q.cost||F.cost||0)};c(z=>[...z,A]),oe("âš¡ Adding stock...","info");try{await Rs.create({productId:F.id,quantity:parseInt(q.quantity),expiryDate:q.expiryDate,batchNumber:q.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(q.cost||F.cost||0)}),H({quantity:"",expiryDate:"",batchNumber:"",cost:""}),k(!1),C(null),oe(`âœ… Stock added successfully for ${F.name}!`,"success"),K().catch(z=>console.warn("Background refresh failed:",z))}catch(z){throw c(Q=>Q.filter(Y=>Y.id!==A.id)),z}}catch(A){console.error("Failed to add stock:",A),oe(`âŒ Failed to add stock: ${A.message||"Unknown error"}`,"error")}},wt=async w=>{w.preventDefault();try{const A=o.find(Y=>Y.id===W.id);if(parseFloat(W.price)<A.price){alert("You cannot lower prices, only increase.");return}const z={...W,price:parseFloat(W.price),cost:parseFloat(W.cost),quantity:A.quantity},Q={...A,...z};i(Y=>Y.map(de=>de.id===W.id?Q:de)),re(!0),oe("âš¡ Updating product...","info");try{const Y=await we.update(W.id,z);g(!1),a()?(window.dispatchEvent(new CustomEvent("productUpdated",{detail:{product:Y,originalProduct:A,timestamp:new Date().toISOString(),type:"update"}})),oe("âœ… Product updated and synced!","success")):oe("âœ… Product updated successfully!","success"),he(new Date)}catch(Y){throw i(de=>de.map(st=>st.id===W.id?A:st)),Y}finally{re(!1)}}catch(A){console.error("Failed to update product:",A),oe(`âŒ Update failed: ${A.message||"Unknown error"}`,"error")}},hs=async w=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const A=o.find(Q=>Q.id===w),z=await we.delete(w);if(i(Q=>Q.filter(Y=>Y.id!==w)),a()&&A)re(!0),window.dispatchEvent(new CustomEvent("productDeleted",{detail:{product:A,timestamp:new Date().toISOString(),type:"delete"}})),oe(`ðŸ“¡ Product "${A.name}" deleted and synced to all dashboards!`,"success"),he(new Date),setTimeout(()=>{re(!1)},3e3);else{const Q=z?.message||"Product deleted successfully!";alert(Q)}await r()}catch(A){console.error("Failed to delete product:",A);let z="Failed to delete product";A.message.includes("Failed to execute")||A.message.includes("JSON")?z="Network error. Please check your connection and try again.":A.message.includes("401")||A.message.includes("unauthorized")?z="You are not authorized to delete this product.":A.message.includes("404")||A.message.includes("not found")?z="Product not found. It may have been deleted already.":A.message&&(z=`Failed to delete product: ${A.message}`),alert(z)}},mt=(o||[]).filter(w=>{if(!w)return!1;const A=w.name?.toLowerCase().includes(b.toLowerCase()),z=h==="all"||h==="raw"&&!w.recipe||h==="composite"&&w.recipe||h==="expense"&&w.expenseOnly||h==="low-stock"&&w.quantity<10;return A&&z}),St=(o||[]).filter(w=>w&&!w.recipe&&!w.expenseOnly),kt=(o||[]).filter(w=>w&&w.recipe),qt=(o||[]).filter(w=>w&&w.expenseOnly),xs=w=>{if(!w||!w.recipe)return 0;let A=1/0;return(w.recipe||[]).forEach(z=>{if(!z)return;const Q=(o||[]).find(Y=>Y&&Y.id===z.productId);if(Q&&Q.quantity>0&&z.quantity>0){const Y=Math.floor(Q.quantity/z.quantity);A=Math.min(A,Y)}}),A===1/0?0:A},vn=w=>{if(!w)return 0;if(!w.recipe)return w.cost||0;let A=0;return(w.recipe||[]).forEach(z=>{if(!z)return;const Q=(o||[]).find(Y=>Y&&Y.id===z.productId);if(Q&&Q.quantity>0){const Y=(Q.cost||0)/Q.quantity;A+=Y*(z.quantity||0)}}),A},ps=async w=>{C(w);try{const A=await we.getWeightPricing(w.id);E(A.weightPricing||{})}catch(A){console.error("Failed to load weight pricing:",A),E({})}O(!0)},Nn=async w=>{if(w.preventDefault(),!D.weight||!D.price){oe("âŒ Please enter both weight and price","error");return}try{const A=parseFloat(D.weight),z=parseFloat(D.price);if(A*10%1!==0){oe("âŒ Weight must be in 0.1kg increments (0.1, 0.2, 0.3, etc)","error");return}await we.addWeightPrice(F.id,A,z),E({...B,[String(A)]:z}),$({weight:"",price:""}),oe(`âœ… Weight price added for ${A}kg`,"success")}catch(A){oe(`âŒ Failed to add weight price: ${A.message}`,"error")}},tt=async w=>{if(confirm(`Delete pricing for ${w}kg?`))try{await we.deleteWeightPrice(F.id,w);const A={...B};delete A[String(w)],E(A),oe(`âœ… Weight price for ${w}kg deleted`,"success")}catch(A){oe(`âŒ Failed to delete weight price: ${A.message}`,"error")}};return e.jsxs("div",{className:"p-6 space-y-6",children:[fe&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${fe.type==="success"?"bg-green-50 border border-green-200 text-green-800":fe.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:fe.message}),e.jsx("button",{onClick:()=>ae(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:b,onChange:w=>p(w.target.value)})]}),e.jsxs("select",{value:h,onChange:w=>u(w.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>j(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:St.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:kt.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:qt.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(mt||[]).map(w=>{if(!w)return null;const A=vn(w),z=w.price?((w.price-A)/w.price*100).toFixed(1):0,Q=xs(w),Y=G===w.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[w.image?e.jsx("img",{src:w.image,alt:w.name,className:"w-12 h-12 object-cover rounded-lg",onError:de=>{de.target.style.display="none",de.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:w.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[w.recipe&&e.jsx("button",{onClick:()=>me(Y?null:w.id),className:"p-1 hover:bg-gray-200 rounded",children:Y?e.jsx(pl,{className:"w-4 h-4"}):e.jsx(fl,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:w.name}),w.quantity<10&&!w.recipe&&e.jsx(Mt,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${w.expenseOnly?"badge-warning":w.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:w.expenseOnly?"Expense":w.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",w.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",A.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${ge(w.id)===0?"text-red-600":ge(w.id)<10?"text-yellow-600":"text-gray-900"}`,children:[ge(w.id)," ",w.unit]}),ge(w.id)<10&&ge(w.id)>0&&e.jsx(Mt,{className:"w-4 h-4 text-yellow-500"}),ge(w.id)===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600",children:[et(w.id).length," active"]}),e.jsx("button",{onClick:()=>{C(w),k(!0)},className:"p-1 hover:bg-blue-50 rounded text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(Ie,{className:"w-3 h-3"})})]})}),e.jsx("td",{className:"px-4 py-3",children:w.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[Q," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${z>30?"text-green-600":z>15?"text-yellow-600":"text-red-600"}`,children:[z,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ps(w),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600 transition-colors",title:"Edit weight-based pricing",children:e.jsx(ot,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{ne(w),g(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(Nt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>hs(w.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(Fe,{className:"w-4 h-4"})})]})})]},w.id),Y&&w.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(w.recipe||[]).map((de,st)=>{if(!de)return null;const Ge=(o||[]).find(ht=>ht&&ht.id===de.productId);if(!Ge)return null;const Je=(Ge.cost||0)/(Ge.quantity||1),Gs=Je*(de.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:Ge.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[de.quantity||0," ",Ge.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[Ge.quantity||0," ",Ge.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",Je.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",Gs.toFixed(2)]})]},st)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",A.toFixed(2)]})]})})]})]})})})]})})})]})})}),f&&F&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Add Stock for ",F.name]}),e.jsxs("form",{onSubmit:Hs,className:"space-y-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:q.quantity,onChange:w=>H({...q,quantity:w.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:q.expiryDate,onChange:w=>H({...q,expiryDate:w.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:q.batchNumber,onChange:w=>H({...q,batchNumber:w.target.value})}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost per Unit",className:"input",value:q.cost,onChange:w=>H({...q,cost:w.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{k(!1),C(null),H({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:ut,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:T.name,onChange:w=>M({...T,name:w.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:w=>qe(w,!0),className:"input"}),e.jsx(Qr,{className:"w-5 h-5 text-gray-400"})]}),(P||T.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:P||T.image,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:T.price,onChange:w=>M({...T,price:w.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:T.cost,onChange:w=>M({...T,cost:w.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:T.category,onChange:w=>M({...T,category:w.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsxs("select",{className:"input",value:T.unit,onChange:w=>M({...T,unit:w.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:T.expenseOnly,onChange:w=>M({...T,expenseOnly:w.target.checked,visibleToCashier:!w.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!T.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:T.visibleToCashier,onChange:w=>M({...T,visibleToCashier:w.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{j(!1),S(""),M({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0})},className:"btn-secondary",children:"Cancel"})]})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:wt,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:W.name,onChange:w=>ne({...W,name:w.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:W.image||"",onChange:w=>ne({...W,image:w.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:w=>{const A=w.target.files[0];if(A){const z=new FileReader;z.onloadend=()=>{ne({...W,image:z.result})},z.readAsDataURL(A)}}})]}),W.image&&e.jsx("img",{src:W.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:W.price||"",onChange:w=>ne({...W,price:w.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:W.cost||"",onChange:w=>ne({...W,cost:w.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input bg-gray-100 cursor-not-allowed",value:W.quantity||"",readOnly:!0,disabled:!0,title:"Use 'Add Stock' button to update quantity"}),e.jsx("span",{className:"absolute right-3 top-3 text-xs text-gray-500",children:"Read-only"})]}),e.jsxs("select",{className:"input",value:W.unit||"pcs",onChange:w=>ne({...W,unit:w.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:W.category||"raw",onChange:w=>ne({...W,category:w.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:W.expenseOnly||!1,onChange:w=>ne({...W,expenseOnly:w.target.checked,visibleToCashier:!w.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!W.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:W.visibleToCashier!==!1,onChange:w=>ne({...W,visibleToCashier:w.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]})]})]})}),I&&F&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-96 overflow-y-auto",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Weight-Based Pricing - ",F.name]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Set different prices for different weights (in 0.1kg increments)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700",children:"Add New Weight Price"}),e.jsxs("form",{onSubmit:Nn,className:"flex gap-3",children:[e.jsx("input",{type:"number",step:"0.1",min:"0.1",placeholder:"Weight (kg) - e.g., 0.1, 0.5, 1.0",className:"input flex-1",value:D.weight,onChange:w=>$({...D,weight:w.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Price (KSH)",className:"input flex-1",value:D.price,onChange:w=>$({...D,price:w.target.value}),required:!0}),e.jsx("button",{type:"submit",className:"btn-primary whitespace-nowrap",children:"Add Price"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Current Prices"}),Object.keys(B).length>0?e.jsx("div",{className:"space-y-2",children:Object.entries(B).sort(([w],[A])=>parseFloat(w)-parseFloat(A)).map(([w,A])=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-medium",children:[w," kg"]}),e.jsxs("span",{className:"text-gray-600 ml-4",children:["KSH ",parseFloat(A).toLocaleString()]})]}),e.jsx("button",{onClick:()=>tt(w),className:"text-red-600 hover:bg-red-50 px-3 py-1 rounded text-sm font-medium transition-colors",children:"Delete"})]},w))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No weight-based pricing set. Add one above."})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Base price:"})," KSH ",F.price?.toLocaleString()]})})]}),e.jsx("div",{className:"flex gap-2 mt-6",children:e.jsx("button",{onClick:()=>{O(!1),C(null),E({}),$({weight:"",price:""})},className:"btn-secondary flex-1",children:"Done"})})]})})]})}function nc(){const[t,s]=x.useState([]),[a,n]=x.useState([]),[r,o]=x.useState(!1),[i,l]=x.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});x.useEffect(()=>{c()},[]);const c=async()=>{const y=await we.getAll();s(y),n(y.filter(j=>!j.recipe))},m=()=>{l({...i,ingredients:[...i.ingredients,{name:"",quantity:"",unit:"pcs"}]})},d=(y,j,v)=>{const g=[...i.ingredients];g[y][j]=v,l({...i,ingredients:g})},h=y=>{l({...i,ingredients:i.ingredients.filter((j,v)=>v!==y)})},u=()=>i.ingredients.reduce((y,j)=>{const v=a.find(g=>g.name.toLowerCase()===j.name.toLowerCase());if(v&&j.quantity){const g=v.cost/v.quantity;return y+g*parseFloat(j.quantity)}return y},0),b=async y=>{y.preventDefault();const j=[];for(const g of i.ingredients){if(!g.name||!g.quantity)continue;const f=a.find(k=>k.name.toLowerCase()===g.name.toLowerCase());f?j.push({productId:f.id,quantity:parseFloat(g.quantity),unit:g.unit||"pcs"}):j.push({name:g.name,quantity:parseFloat(g.quantity),unit:g.unit||"pcs"})}if(j.length===0){alert("Please add at least one ingredient");return}const v=u();try{await we.create({name:i.name,price:parseFloat(i.price),cost:v,quantity:0,unit:"pcs",category:"composite",recipe:j,image:i.image||"",visibleToCashier:i.visibleToCashier,expenseOnly:!1}),l({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),o(!1),c(),alert("Recipe created successfully!")}catch(g){console.error("Error creating recipe:",g),alert("Failed to create recipe. Please try again.")}},p=t.filter(y=>y.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>o(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",p.length,")"]}),p.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:p.map(y=>{const j=y.recipe.reduce((g,f)=>{if(f.productId){const k=t.find(I=>I.id===f.productId);if(k){const I=k.cost/k.quantity;return g+I*f.quantity}}else if(f.name){const k=t.find(I=>I.name.toLowerCase()===f.name.toLowerCase());if(k){const I=k.cost/k.quantity;return g+I*f.quantity}}return g},0),v=((y.price-j)/y.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:y.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",y.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",j.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${v>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",v,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(Fe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:y.recipe.map((g,f)=>{let k="",I=g.unit||"pcs";if(g.productId){const O=t.find(F=>F.id===g.productId);O&&(k=O.name,I=O.unit)}else g.name&&(k=g.name,I=g.unit||"pcs");return k?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:k}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[g.quantity," ",I]})]},f):null})})]})]},y.id)})})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:i.name,onChange:y=>l({...i,name:y.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:i.price,onChange:y=>l({...i,price:y.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:i.image,onChange:y=>l({...i,image:y.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:i.visibleToCashier,onChange:y=>l({...i,visibleToCashier:y.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:m,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:i.ingredients.map((y,j)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:y.name,onChange:v=>d(j,"name",v.target.value),required:!0,list:`ingredients-list-${j}`}),e.jsx("datalist",{id:`ingredients-list-${j}`,children:a.map(v=>e.jsxs("option",{value:v.name,children:[v.name," (",v.quantity," ",v.unit," available)"]},v.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:y.quantity,onChange:v=>d(j,"quantity",v.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:y.unit,onChange:v=>d(j,"unit",v.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>h(j),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(Fe,{className:"w-4 h-4"})})]},j))}),i.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),i.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",u().toFixed(2)]})]}),i.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(i.price)-u())/parseFloat(i.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(gl,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{o(!1),l({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function rc(){const[t,s]=x.useState([]),[a,n]=x.useState("all"),[r,o]=x.useState([]),[i,l]=x.useState(!1);x.useEffect(()=>{c()},[]);const c=async()=>{const j=await zs.getAll();s(j.reverse())},m=async j=>{if(window.confirm("Delete this sale? This action cannot be undone."))try{l(!0);const v=localStorage.getItem("token");if(!(await fetch(`${le}/sales/${j}`,{method:"DELETE",headers:{Authorization:`Bearer ${v}`}})).ok)throw new Error("Failed to delete sale");s(t.filter(f=>f.id!==j)),alert("Sale deleted successfully")}catch(v){alert("Failed to delete sale: "+v.message)}finally{l(!1)}},d=async()=>{if(r.length===0){alert("No sales selected");return}if(window.confirm(`Delete ${r.length} sales? This action cannot be undone.`))try{l(!0);const j=localStorage.getItem("token");if(!(await fetch(`${le}/sales/bulk-delete`,{method:"POST",headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"},body:JSON.stringify({saleIds:r})})).ok)throw new Error("Failed to delete sales");s(t.filter(g=>!r.includes(g.id))),o([]),alert("Sales deleted successfully")}catch(j){alert("Failed to delete sales: "+j.message)}finally{l(!1)}},h=async()=>{if(window.confirm("Clear ALL sales data? This will delete everything and cannot be undone."))try{l(!0);const j=localStorage.getItem("token");if(!(await fetch(`${le}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"},body:JSON.stringify({type:"sales"})})).ok)throw new Error("Failed to clear sales");s([]),o([]),alert("All sales data cleared")}catch(j){alert("Failed to clear sales: "+j.message)}finally{l(!1)}},u=t.filter(j=>{if(a==="today")return new Date(j.createdAt).toDateString()===new Date().toDateString();if(a==="week"){const v=new Date;return v.setDate(v.getDate()-7),new Date(j.createdAt)>=v}return!0}),b=u.reduce((j,v)=>j+v.total,0),p=u.reduce((j,v)=>j+(v.cogs||0),0),y=b-p;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:a,onChange:j=>n(j.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]}),r.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[r.length," selected"]}),e.jsxs("button",{onClick:d,disabled:i,className:"px-3 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(Fe,{className:"w-4 h-4"}),"Delete Selected"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:h,disabled:i||t.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(ei,{className:"w-4 h-4"}),"Clear All Sales"]}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(yl,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",b.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",p.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",y.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:r.length===u.length&&u.length>0,onChange:j=>{j.target.checked?o(u.map(v=>v.id)):o([])},className:"rounded"})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Action"})]})}),e.jsx("tbody",{children:u.map(j=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:r.includes(j.id),onChange:v=>{v.target.checked?o([...r,j.id]):o(r.filter(g=>g!==j.id))},className:"rounded"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",j.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(j.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[j.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:j.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",j.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",j.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",j.profit?.toLocaleString()||0]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("button",{onClick:()=>m(j.id),disabled:i,className:"px-3 py-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(Fe,{className:"w-4 h-4"}),"Delete"]})})]},j.id))})]})})]})]})}function ic(){const[t,s]=x.useState([]),[a,n]=x.useState(!1),[r,o]=x.useState({description:"",amount:"",category:"general"}),[i,l]=x.useState(null);x.useEffect(()=>{m();const p=localStorage.getItem("token");return p&&(ze.connect(p).catch(y=>{console.warn("WebSocket connection failed:",y)}),ze.on("sale_completed",y=>{console.log("ðŸ’° Sale completed - updating expenses:",y),m(),y.saleId&&c(`âœ… Expenses updated from Sale #${y.saleId}`,"success")})),()=>{ze.disconnect()}},[]);const c=(p,y)=>{l({message:p,type:y}),setTimeout(()=>l(null),3e3)},m=async()=>{const p=await Ms.getAll();s(p.reverse())},d=async p=>{p.preventDefault(),await Ms.create({...r,amount:parseFloat(r.amount)}),o({description:"",amount:"",category:"general"}),n(!1),m()},h=t.reduce((p,y)=>p+y.amount,0),u=t.filter(p=>!p.automatic),b=t.filter(p=>p.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[i&&e.jsx("div",{className:`fixed top-4 right-4 p-4 rounded-lg text-white font-medium z-50 ${i.type==="success"?"bg-green-600":"bg-blue-600"}`,children:i.message}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("button",{onClick:()=>n(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",h.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",u.reduce((p,y)=>p+y.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",b.reduce((p,y)=>p+y.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.map(p=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(p.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:p.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:p.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${p.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:p.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",p.amount?.toLocaleString()]})]},p.id))})]})})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:r.description,onChange:p=>o({...r,description:p.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:r.amount,onChange:p=>o({...r,amount:p.target.value}),required:!0}),e.jsxs("select",{className:"input",value:r.category,onChange:p=>o({...r,category:p.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>n(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function oc(){const{isCashierUserManagementEnabled:t,isCashier:s}=be(),[a,n]=x.useState([]),[r,o]=x.useState(!0),[i,l]=x.useState(!1),[c,m]=x.useState(null),[d,h]=x.useState(null),[u,b]=x.useState(null),[p,y]=x.useState(0),[j,v]=x.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),[g,f]=x.useState(!1),[k,I]=x.useState(null),[O,F]=x.useState("");x.useEffect(()=>{C()},[]),x.useEffect(()=>()=>{u?.intervalId&&clearInterval(u.intervalId)},[u]);const C=async()=>{try{o(!0);const S=await gt.getAll();n(Array.isArray(S)?S:[])}catch(S){console.error("Error loading users:",S),n([])}finally{o(!1)}},B=()=>Math.floor(1e3+Math.random()*9e3).toString(),E=async S=>{if(S.preventDefault(),console.log("Form submitted with data:",j),!j.name?.trim()||!j.email?.trim()||!j.password?.trim()){alert("Please fill in all required fields");return}if(j.password.length<6){alert("Password must be at least 6 characters long");return}try{o(!0);const T=B(),M={name:j.name.trim(),email:j.email.trim().toLowerCase(),password:j.password.trim(),pin:T};console.log("Sending user data:",M);const q=await gt.create(M);console.log("User creation result:",q),await C();const H=`âœ… Cashier added successfully!

ðŸ“§ Email: ${M.email}
ðŸ”‘ Password: ${M.password}
ðŸ”¢ PIN: ${T}

ðŸ’¡ LOGIN OPTIONS:
1. Email + Password: Use email and password above
2. PIN Login: Use email + ${T}

Please share these credentials securely with the new cashier.`;alert(H),v({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),l(!1)}catch(T){console.error("Error creating cashier:",T);let M="Failed to add cashier";T.message.includes("Current user not found")?M="Authentication error. Please refresh the page and try again.":T.message.includes("email")?M="Email already exists. Please use a different email.":T.message.includes("network")||T.message.includes("fetch")?M="Network error. Please check your connection and try again.":T.message&&(M=`Failed to add cashier: ${T.message}`),alert(M)}finally{o(!1)}},D=async(S,T)=>{try{o(!0),await gt.update(S,{permissions:T}),await C(),m(null)}catch(M){console.error("Error updating permissions:",M),alert("Failed to update permissions: "+M.message)}finally{o(!1)}},$=async(S,T)=>{try{o(!0);const M=!T,q=await fetch(`${le}/users/${S}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({active:M})});if(!q.ok){const H=await q.json().catch(()=>({error:"Network error"}));throw new Error(H.error||`HTTP ${q.status}: ${q.statusText}`)}await C()}catch(M){console.error("Error updating user status:",M),alert("Failed to update user status: "+M.message)}finally{o(!1)}},G=async(S,T)=>{try{o(!0);const M=!T,q=await fetch(`${le}/users/${S}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({locked:M})});if(!q.ok){const H=await q.json().catch(()=>({error:"Network error"}));throw new Error(H.error||`HTTP ${q.status}: ${q.statusText}`)}await C()}catch(M){console.error("Error updating user lock status:",M),alert("Failed to update user lock status: "+M.message)}finally{o(!1)}},me=async S=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{o(!0),await gt.delete(S),await C()}catch(T){console.error("Error deleting user:",T),alert("Failed to delete user: "+T.message)}finally{o(!1)}},fe=async()=>{if(window.confirm("Clear ALL users data? This will delete all users and cannot be undone."))try{o(!0);const S=localStorage.getItem("token");if(!(await fetch(`${le}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${S}`,"Content-Type":"application/json"},body:JSON.stringify({type:"users"})})).ok)throw new Error("Failed to clear users");n([]),alert("All users data cleared")}catch(S){alert("Failed to clear users: "+S.message)}finally{o(!1)}},ae=S=>{I(S),F(B()),f(!0)},se=async()=>{try{o(!0),await gt.update(k.id,{cashierPIN:O}),await C(),f(!1),I(null),F(""),alert(`âœ… PIN reset successfully!

ðŸ”¢ New PIN for ${k.name}: ${O}

Please share this PIN securely with the cashier.`)}catch(S){console.error("Error resetting PIN:",S),alert("Failed to reset PIN: "+S.message)}finally{o(!1)}},re=S=>{h(S),b({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const T=setInterval(()=>{he(S)},3e3);b(M=>({...M,intervalId:T})),he(S)},te=()=>{u?.intervalId&&clearInterval(u.intervalId),h(null),b(null)},he=async S=>{try{const T=await zs.getAll(),q=(Array.isArray(T)?T:[]).filter(W=>W.cashierId===S.id).sort((W,ne)=>new Date(ne.createdAt)-new Date(W.createdAt)).slice(0,10),H={isActive:Math.random()>.3,currentCart:q.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:q.reduce((W,ne)=>W+ne.total,0),salesCount:q.length,lastActivity:q.length>0?new Date(q[0].createdAt).toLocaleTimeString():"No recent activity"};b(H)}catch(T){console.error("Error loading live view data:",T)}},P=(a||[]).filter(S=>S.role==="cashier");return r&&a.length===0?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),e.jsx("div",{className:"flex items-center gap-2",children:t()&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:fe,disabled:r||a.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(ei,{className:"w-4 h-4"}),"Clear All Users"]}),e.jsxs("button",{onClick:()=>l(!0),className:"btn-primary flex items-center gap-2",disabled:r,children:[e.jsx(Ie,{className:"w-4 h-4"}),"Add Cashier"]})]})})]}),s()&&!t()&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(De,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"User Management Restricted"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The admin has disabled cashier user management. You cannot add, edit, or remove users at this time."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:a.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:P.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:a.filter(S=>S.active).length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(a||[]).map(S=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:S.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:S.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${S.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:S.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:S.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:S.role==="cashier"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:S.pin||S.cashierPIN||"----"}),e.jsx("button",{onClick:()=>ae(S),className:"p-1 hover:bg-yellow-50 rounded text-yellow-600",title:"Reset PIN",disabled:r,children:e.jsx(Nt,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${S.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:S.active?e.jsxs(e.Fragment,{children:[e.jsx(Sn,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(kn,{className:"w-3 h-3"}),"Inactive"]})}),S.locked&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:[e.jsx(Is,{className:"w-3 h-3"}),"Locked"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>$(S.id,S.active),className:`p-2 rounded-lg transition ${S.active?"hover:bg-red-50 text-red-600":"hover:bg-green-50 text-green-600"}`,title:S.active?"Deactivate User":"Activate User",disabled:r,children:S.active?e.jsx(kn,{className:"w-4 h-4"}):e.jsx(Sn,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>G(S.id,S.locked||!1),className:`p-2 rounded-lg transition ${S.locked?"hover:bg-green-50 text-green-600":"hover:bg-red-50 text-red-600"}`,title:S.locked?"Unlock User":"Lock User",disabled:r,children:e.jsx(Is,{className:"w-4 h-4"})})]}),S.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",S.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(ti,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>re(S),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(Pn,{className:"w-4 h-4"})})]}),t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>m(S),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600",title:"Edit Permissions",children:e.jsx(Nt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>me(S.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",title:"Delete User",disabled:r,children:e.jsx(Fe,{className:"w-4 h-4"})})]})]})})]},S.id))})]}),a.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Rt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first cashier to get started"})]})]})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:j.name||"",onChange:S=>{console.log("Name input changed:",S.target.value),v({...j,name:S.target.value})},required:!0,disabled:r}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:j.email||"",onChange:S=>{console.log("Email input changed:",S.target.value),v({...j,email:S.target.value})},required:!0,disabled:r}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:j.password||"",onChange:S=>{console.log("Password input changed:",S.target.value),v({...j,password:S.target.value})},required:!0,minLength:6,disabled:r}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(j.permissions).map(([S,T])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:M=>v({...j,permissions:{...j.permissions,[S]:M.target.checked}}),disabled:r}),e.jsx("span",{className:"text-sm capitalize",children:S.replace(/([A-Z])/g," $1").trim()})]},S))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:r,children:r?"Adding...":"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>l(!1),className:"btn-secondary",disabled:r,children:"Cancel"})]})]})]})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",c.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(c.permissions||{}).map(([S,T])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:M=>m({...c,permissions:{...c.permissions,[S]:M.target.checked}}),disabled:r}),e.jsx("span",{className:"text-sm capitalize",children:S.replace(/([A-Z])/g," $1").trim()})]},S))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>D(c.id,c.permissions),className:"btn-primary flex-1",disabled:r,children:r?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>m(null),className:"btn-secondary",disabled:r,children:"Cancel"})]})]})}),d&&u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(Pn,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",d.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:te,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(_e,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${u.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:u.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Last Activity: ",u.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Yt,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(u.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(u.currentCart||[]).map((S,T)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[S.name," x",S.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",S.price.toLocaleString()]})]},T)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(u.currentCart||[]).reduce((S,T)=>S+T.price*T.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:u.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",u.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",u.salesCount>0?Math.round(u.totalSalesToday/u.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})}),g&&k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Reset PIN for ",k.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate a new 4-digit PIN for this cashier. The old PIN will be invalid."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"New PIN:"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-mono text-3xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:O})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>F(B()),className:"btn-secondary flex-1",disabled:r,children:"Generate New PIN"}),e.jsx("button",{onClick:se,className:"btn-primary flex-1",disabled:r,children:r?"Updating...":"Confirm & Update"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>{f(!1),I(null),F("")},className:"btn-secondary w-full",disabled:r,children:"Cancel"})})]})})]})}function lc(){const{user:t}=be(),[s,a]=x.useState([]),[n,r]=x.useState("all"),[o,i]=x.useState(!0);x.useEffect(()=>{l();const u=setInterval(l,3e4);return()=>clearInterval(u)},[]);const l=async()=>{try{i(!0);const u=await ks.getAll();Array.isArray(u)&&(a(u.reverse()),console.log(`âœ… Loaded ${u.length} clock records from backend`))}catch(u){console.error("Failed to load clock records:",u),a([])}finally{i(!1)}},c=new Date().toDateString(),m=n==="all"?s:s.filter(u=>{try{return new Date(u.date||u.clockInTime).toDateString()===c}catch{return!1}}),d=s.filter(u=>{try{return new Date(u.date||u.clockInTime).toDateString()===c&&u.duration}catch{return!1}}).reduce((u,b)=>u+(b.duration||0),0)/60,h=u=>{let b=typeof u=="number"?u<120?u:Math.floor(u/60):0;const p=Math.floor(b/60),y=b%60;return`${p}h ${y}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(Ze,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[d.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(Ba,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers Today"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(s.filter(u=>{try{return new Date(u.date||u.clockInTime).toDateString()===new Date().toDateString()}catch{return!1}}).map(u=>u.cashierId||u.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(Es,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:s.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${n==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>r("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${n==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"}),e.jsx("button",{onClick:l,disabled:o,className:"px-4 py-2 rounded-lg text-sm font-medium bg-green-100 text-green-600 hover:bg-green-200 disabled:opacity-50",children:o?"Loading...":"Refresh"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"})]})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:o?"Loading records...":"No records found"})}):m.map((u,b)=>{const p=new Date(u.clockInTime),y=u.clockOutTime?new Date(u.clockOutTime):null;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:u.cashierName||u.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:p.toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:p.toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:y?y.toLocaleTimeString():"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:u.duration?h(u.duration):"-"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${u.status==="clocked_in"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:u.status==="clocked_in"?"ðŸŸ¢ Clocked In":"âœ“ Clocked Out"})})]},b)})})]})})]})]})}function cc(){const{user:t,updateUser:s}=be();Te();const[a,n]=x.useState(!1),[r,o]=x.useState(t?.plan||"ultra"),[i,l]=x.useState({}),[c,m]=x.useState(null),[d,h]=x.useState(t?.profilePicture||null),[u,b]=x.useState(!0),[p,y]=x.useState(!0);x.useEffect(()=>{j()},[]);const j=async()=>{try{const C=await Xt.get();l(C),C.logo&&m(C.logo),b(C.cashierUserManagement!==!1),y(C.realTimeProductSync!==!1)}catch(C){console.error("Failed to load settings:",C)}},v=async C=>{try{const B={...i,...C};return await Xt.update(B),l(B),!0}catch(B){return console.error("Failed to save settings:",B),!1}},g=async()=>{const C=!u;b(C),await v({cashierUserManagement:C})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{cashierUserManagement:C}})),alert(`âœ… Cashier User Management ${C?"ENABLED":"DISABLED"}`)):(b(!C),alert("âŒ Failed to save setting. Please try again."))},f=async()=>{const C=!p;y(C),await v({realTimeProductSync:C})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{realTimeProductSync:C}})),alert(`âœ… Real-time Product Sync ${C?"ENABLED":"DISABLED"}`)):(y(!C),alert("âŒ Failed to save setting. Please try again."))},k=async C=>{const B=C.target.files[0];if(B){const E=new FileReader;E.onloadend=async()=>{const D=E.result;m(D);try{await Xt.update({...i,logo:D}),l({...i,logo:D})}catch($){console.error("Failed to save logo:",$)}},E.readAsDataURL(B)}},I=async C=>{const B=C.target.files[0];if(B){const E=new FileReader;E.onloadend=async()=>{const D=E.result;h(D);try{await s({...t,profilePicture:D})}catch($){console.error("Failed to save profile picture:",$)}},E.readAsDataURL(B)}},O=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],F=async()=>{const C=O.find(E=>E.id===r),B=r==="ultra"?"admin":"cashier";await s({...t,role:B,plan:r,price:C.price}),n(!1),setTimeout(()=>window.location.href=B==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Ba,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[d?e.jsx("img",{src:d,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:t?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(Cn,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:I})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(jt,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>n(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(qa,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Rt,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cashier User Management"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Cashier User Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow cashiers to add and remove users"})]}),e.jsx("button",{onClick:g,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${u?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${u?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${u?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:u?"âœ… Cashiers can add and remove users when enabled":"âŒ Cashiers cannot add or remove users when disabled"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(bl,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Real-time Product Sync"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Real-time Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync products between admin and cashier dashboards"})]}),e.jsx("button",{onClick:f,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${p?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${p?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${p?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:p?"âœ… Products will sync in real-time across all dashboards":"âŒ Products will not sync automatically across dashboards"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(Is,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(jl,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[c&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:c,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(Cn,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:k})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:O.map(C=>e.jsxs("div",{onClick:()=>o(C.id),className:`card cursor-pointer transition-all ${r===C.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:C.name}),r===C.id&&e.jsx(Ot,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",C.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:C.features.map((B,E)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ot,{className:"w-4 h-4 text-green-600"}),B]},E))})]},C.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:F,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>n(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function dc(){const[t,s]=x.useState([]),[a,n]=x.useState(!1),[r,o]=x.useState(null),[i,l]=x.useState({name:"",amount:"",description:"",active:!0});x.useEffect(()=>{c()},[]);const c=()=>{const u=JSON.parse(localStorage.getItem("serviceFees")||"[]");s(u)},m=u=>{localStorage.setItem("serviceFees",JSON.stringify(u)),s(u)},d=u=>{if(u.preventDefault(),r){const b=t.map(p=>p.id===r.id?{...i,id:p.id}:p);m(b)}else{const b={...i,id:Date.now(),createdAt:new Date().toISOString()};m([...t,b])}n(!1),o(null),l({name:"",amount:"",description:"",active:!0})},h=u=>{confirm("Delete this service fee?")&&m(t.filter(b=>b.id!==u))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{n(!0),o(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(u=>e.jsxs("div",{className:`card ${u.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Lt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:u.name}),e.jsx("p",{className:"text-xs text-gray-500",children:u.description})]})]}),e.jsx("span",{className:`badge ${u.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:u.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",u.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{o(u),l(u),n(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(Nt,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>h(u.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(Fe,{className:"w-4 h-4 text-red-600"})})]})]})]},u.id))}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[r?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:i.name,onChange:u=>l({...i,name:u.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:i.amount,onChange:u=>l({...i,amount:u.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:i.description,onChange:u=>l({...i,description:u.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:i.active,onChange:u=>l({...i,active:u.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>n(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function uc(){const[t,s]=x.useState([]),[a,n]=x.useState([]),[r,o]=x.useState(!1),[i,l]=x.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});x.useEffect(()=>{c(),m()},[]);const c=async()=>{try{const p=localStorage.getItem("token"),y=await fetch(`${le}/reminders`,{headers:{Authorization:`Bearer ${p}`}});if(!y.ok){console.error("API Error:",y.status,y.statusText),s([]);return}const j=await y.json();Array.isArray(j)?s(j):(console.error("Expected array but got:",typeof j,j),s([]))}catch(p){console.error("Failed to fetch reminders:",p),s([])}},m=async()=>{try{const p=localStorage.getItem("token"),y=await fetch(`${le}/products`,{headers:{Authorization:`Bearer ${p}`}});if(!y.ok){console.error("API Error:",y.status,y.statusText),n([]);return}const j=await y.json();Array.isArray(j)?n(j):(console.error("Expected array but got:",typeof j,j),n([]))}catch(p){console.error("Failed to fetch products:",p),n([])}},d=async p=>{p.preventDefault();try{const y=localStorage.getItem("token"),j=await fetch(`${le}/reminders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`},body:JSON.stringify(i)});if(!j.ok){const g=await j.json();console.error("Failed to create reminder:",g),alert(`Failed to create reminder: ${g.error||"Unknown error"}`);return}const v=await j.json();l({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),o(!1),c(),alert("Reminder created successfully!")}catch(y){console.error("Failed to create reminder:",y),alert("Failed to create reminder. Please try again.")}},h=async p=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const j=localStorage.getItem("token"),v=await fetch(`${le}/reminders/${p}`,{method:"DELETE",headers:{Authorization:`Bearer ${j}`}});if(!v.ok){const g=await v.json();console.error("Failed to delete reminder:",g),alert(`Failed to delete reminder: ${g.error||"Unknown error"}`);return}c(),alert("Reminder deleted successfully!")}catch(y){console.error("Failed to delete reminder:",y),alert("Failed to delete reminder. Please try again.")}},u=p=>{i.days.includes(p)?l({...i,days:i.days.filter(y=>y!==p)}):l({...i,days:[...i.days,p]})},b=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(qa,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("button",{onClick:()=>o(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(Ie,{size:20}),"New Reminder"]})]}),e.jsx("div",{className:"grid gap-4",children:t.map(p=>{const y=a.find(j=>j.id===p.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${p.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:p.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",y?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",p.frequency]}),p.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",p.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(Es,{size:16}),"Next: ",new Date(p.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${p.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:p.status}),e.jsx("button",{onClick:()=>h(p.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(Fe,{size:20})})]})]})},p.id)})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:d,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:i.customerName,onChange:p=>l({...i,customerName:p.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:i.productId,onChange:p=>l({...i,productId:parseInt(p.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),a.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:i.frequency,onChange:p=>l({...i,frequency:p.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),i.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(p=>e.jsx("button",{type:"button",onClick:()=>u(p),className:`px-4 py-2 rounded-lg font-medium transition ${i.days.includes(p)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:p},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:i.nextDate,onChange:p=>l({...i,nextDate:p.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>o(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})}function mc(){const[t,s]=x.useState([]),[a,n]=x.useState(!1),[r,o]=x.useState(null),[i,l]=x.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});x.useEffect(()=>{c()},[]);const c=async()=>{try{const u=await Ht.getAll();s(u)}catch(u){console.error("Failed to load discounts:",u)}},m=async u=>{u.preventDefault();try{r?await Ht.update(r.id,i):await Ht.create(i),n(!1),o(null),l({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),c()}catch(b){console.error("Failed to save discount:",b)}},d=async u=>{if(confirm("Delete this discount?"))try{await Ht.delete(u),c()}catch(b){console.error("Failed to delete discount:",b)}},h=u=>{const b=new Date,p=new Date(u.validFrom),y=new Date(u.validTo);return u.active&&p<=b&&y>=b};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{n(!0),o(null),l({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(u=>e.jsxs("div",{className:`card ${h(u)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${h(u)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(fa,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:u.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[u.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${h(u)?"badge-success":"bg-gray-200 text-gray-600"}`,children:h(u)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(u.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(u.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{o(u),l(u),n(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(Nt,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>d(u.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(Fe,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},u.id)),t.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(fa,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[r?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:i.name,onChange:u=>l({...i,name:u.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:i.percentage,onChange:u=>l({...i,percentage:parseFloat(u.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:i.validFrom,onChange:u=>l({...i,validFrom:u.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:i.validTo,onChange:u=>l({...i,validTo:u.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:i.active,onChange:u=>l({...i,active:u.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>n(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function hc(){const[t,s]=x.useState([]),[a,n]=x.useState("all"),[r,o]=x.useState(null),[i,l]=x.useState(""),[c,m]=x.useState(!1),[d,h]=x.useState(null);x.useEffect(()=>{u();const f=setInterval(u,1e4);return()=>clearInterval(f)},[]);const u=async()=>{try{const f=await Ss.getAll();s(f||[])}catch(f){console.error("Failed to load credit requests:",f)}},b=async f=>{o(f);try{await Ss.update(f,{status:"approved"}),console.log("âœ… Credit request approved"),u()}catch(k){console.error("Failed to approve request:",k),alert("Failed to approve request: "+(k.message||"Unknown error"))}finally{o(null)}},p=f=>{h(f),m(!0)},y=async()=>{if(d){o(d.id);try{await Ss.update(d.id,{status:"rejected",rejectionReason:i}),console.log("âœ… Credit request rejected"),m(!1),l(""),h(null),u()}catch(f){console.error("Failed to reject request:",f),alert("Failed to reject request: "+(f.message||"Unknown error"))}finally{o(null)}}},j=t.filter(f=>a==="all"?!0:f.status===a),v=f=>{switch(f){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},g=f=>{switch(f){case"pending":return e.jsx(Ze,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(It,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(ws,{className:"w-6 h-6 text-red-600"});default:return e.jsx(jt,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(f=>e.jsxs("button",{onClick:()=>n(f),className:`px-4 py-2 rounded-lg font-medium transition ${a===f?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[f.charAt(0).toUpperCase()+f.slice(1),f==="pending"&&t.filter(k=>k.status==="pending").length>0&&e.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1",children:t.filter(k=>k.status==="pending").length})]},f))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[j.map(f=>e.jsx("div",{className:`card border-l-4 ${v(f.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${f.status==="pending"?"bg-orange-600":f.status==="approved"?"bg-green-600":"bg-red-600"}`,children:g(f.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:f.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Requested by: ",f.cashierName]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",f.amount?.toLocaleString()]})]}),f.reason&&e.jsxs("span",{children:["Reason: ",e.jsx("strong",{children:f.reason.replace(/_/g," ")})]})]}),f.notes&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Notes: ",f.notes]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(f.createdAt).toLocaleString()]}),f.approvalDate&&e.jsxs("p",{className:"text-xs text-gray-500",children:[f.status==="approved"?"Approved":"Processed",": ",new Date(f.approvalDate).toLocaleString(),f.approvedBy&&` by ${f.approvedBy}`]}),f.rejectionReason&&e.jsxs("p",{className:"text-xs text-red-600 mt-2",children:["Rejection reason: ",f.rejectionReason]})]})]}),f.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>b(f.id),disabled:r===f.id,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition disabled:opacity-50",children:[e.jsx(It,{size:16}),r===f.id?"Approving...":"Approve"]}),e.jsxs("button",{onClick:()=>p(f),disabled:r===f.id,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition disabled:opacity-50",children:[e.jsx(ws,{size:16}),r===f.id?"Rejecting...":"Reject"]})]}),f.status!=="pending"&&e.jsx("span",{className:`badge ${f.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:f.status.toUpperCase()})]})},f.id)),j.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(jt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",a!=="all"?a:""," credit requests found."]})]})]}),c&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-red-500 to-red-600 p-6 text-white flex items-center gap-3",children:[e.jsx(it,{className:"w-6 h-6"}),e.jsx("h3",{className:"text-xl font-bold",children:"Reject Credit Request"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Are you sure you want to reject this credit request from ",e.jsx("strong",{children:d.customerName})," for ",e.jsxs("strong",{children:["KSH ",d.amount?.toLocaleString()]}),"?"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Rejection Reason"}),e.jsx("textarea",{placeholder:"Enter reason for rejection...",value:i,onChange:f=>l(f.target.value),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-red-500",rows:"4"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:y,disabled:r!==null,className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-bold transition disabled:opacity-50",children:r?"Rejecting...":"Confirm Rejection"}),e.jsx("button",{onClick:()=>{m(!1),l(""),h(null)},disabled:r!==null,className:"flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400 transition disabled:opacity-50",children:"Cancel"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[j.map(f=>e.jsx("div",{className:`card border-l-4 ${v(f.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${f.status==="pending"?"bg-orange-600":f.status==="approved"?"bg-green-600":"bg-red-600"}`,children:g(f.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:f.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:getProductName(f.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:f.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",f.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(f.createdAt).toLocaleString()]}),f.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(f.approvedAt).toLocaleString()]})]})]}),f.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>b(f.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(It,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>handleReject(f.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(ws,{size:16}),"Reject"]})]}),f.status!=="pending"&&e.jsx("span",{className:`badge ${f.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:f.status.toUpperCase()})]})},f.id)),j.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(jt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",a!=="all"?a:""," credit requests found."]})]})]})]})}function xc(){const[t,s]=x.useState([]),[a,n]=x.useState(!0),[r,o]=x.useState(!1),[i,l]=x.useState(null),[c,m]=x.useState(""),[d,h]=x.useState({name:"",email:"",phone:"",address:"",city:"",country:"",products:""});x.useEffect(()=>{u()},[]);const u=async()=>{try{n(!0);const g=localStorage.getItem("token"),f=await fetch(`${le}/vendors`,{headers:{Authorization:`Bearer ${g}`}});if(f.ok){const k=await f.json();s(Array.isArray(k)?k:[])}}catch(g){console.error("Failed to load vendors:",g),s([])}finally{n(!1)}},b=()=>{l(null),h({name:"",email:"",phone:"",address:"",city:"",country:"",products:""}),o(!0)},p=g=>{l(g),h(g),o(!0)},y=async g=>{if(window.confirm("Are you sure you want to delete this vendor?"))try{const f=localStorage.getItem("token");(await fetch(`${le}/vendors/${g}`,{method:"DELETE",headers:{Authorization:`Bearer ${f}`}})).ok?(s(t.filter(I=>I.id!==g)),alert("Vendor deleted successfully")):alert("Failed to delete vendor")}catch(f){console.error("Failed to delete vendor:",f),alert("Failed to delete vendor")}},j=async g=>{g.preventDefault();try{const f=localStorage.getItem("token"),k=i?"PUT":"POST",I=i?`${le}/vendors/${i.id}`:`${le}/vendors`,O=await fetch(I,{method:k,headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify(d)});if(O.ok){const F=await O.json();s(i?t.map(C=>C.id===F.id?F:C):[...t,F]),o(!1),alert(i?"Vendor updated":"Vendor added")}else alert("Failed to save vendor")}catch(f){console.error("Failed to save vendor:",f),alert("Failed to save vendor")}},v=t.filter(g=>g.name?.toLowerCase().includes(c.toLowerCase())||g.email?.toLowerCase().includes(c.toLowerCase()));return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Vendors"}),e.jsxs("button",{onClick:b,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(Ie,{className:"w-5 h-5"}),"Add Vendor"]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(ls,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search vendors...",value:c,onChange:g=>m(g.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"})]})}),a?e.jsx("div",{className:"text-center py-8",children:"Loading vendors..."}):v.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["No vendors found. ",t.length===0&&"Add your first vendor to get started."]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map(g=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:g.name}),e.jsx("p",{className:"text-sm text-gray-500",children:g.products})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p(g),className:"p-2 text-blue-600 hover:bg-blue-50 rounded",children:e.jsx(Nt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>y(g.id),className:"p-2 text-red-600 hover:bg-red-50 rounded",children:e.jsx(Fe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[g.email&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Ls,{className:"w-4 h-4"}),e.jsx("a",{href:`mailto:${g.email}`,children:g.email})]}),g.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(vl,{className:"w-4 h-4"}),e.jsx("a",{href:`tel:${g.phone}`,children:g.phone})]}),g.address&&e.jsxs("div",{className:"flex items-start gap-2 text-gray-600",children:[e.jsx(Nl,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[g.address,g.city&&`, ${g.city}`,g.country&&`, ${g.country}`]})]})]})]},g.id))}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:i?"Edit Vendor":"Add Vendor"}),e.jsx("button",{onClick:()=>o(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(_e,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vendor Name *"}),e.jsx("input",{type:"text",required:!0,value:d.name,onChange:g=>h({...d,name:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g., ABC Supplies"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Products/Services"}),e.jsx("input",{type:"text",value:d.products,onChange:g=>h({...d,products:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g., Vegetables, Fruits"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:d.email,onChange:g=>h({...d,email:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"vendor@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:d.phone,onChange:g=>h({...d,phone:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"+1 (555) 000-0000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("input",{type:"text",value:d.address,onChange:g=>h({...d,address:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Street address"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",value:d.city,onChange:g=>h({...d,city:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"City"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Country"}),e.jsx("input",{type:"text",value:d.country,onChange:g=>h({...d,country:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Country"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>o(!1),className:"flex-1 px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"flex-1 px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700",children:[i?"Update":"Add"," Vendor"]})]})]})]})})]})}function ui({onClose:t}){const[s,a]=x.useState([]),[n,r]=x.useState(!0),o=x.useRef({data:null,timestamp:null}),i=3e4;x.useEffect(()=>{l()},[]);const l=async()=>{try{const m=Date.now();if(o.current.data&&o.current.timestamp&&m-o.current.timestamp<i){console.log("ðŸ“¦ Using cached reminders"),a(o.current.data),r(!1);return}const d=localStorage.getItem("token"),h=await fetch(`${le}/reminders/today`,{headers:{Authorization:`Bearer ${d}`}});if(!h.ok){console.error("API Error:",h.status,h.statusText),a([]),r(!1);return}const u=await h.json();Array.isArray(u)?(o.current.data=u,o.current.timestamp=Date.now(),a(u)):(console.error("Expected array but got:",typeof u,u),a([]))}catch(m){console.error("Failed to fetch reminders:",m),a([])}finally{r(!1)}},c=async m=>{try{const d=localStorage.getItem("token");await fetch(`${le}/reminders/${m}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({status:"fulfilled"})}),o.current={data:null,timestamp:null},l()}catch(d){console.error("Failed to update reminder:",d)}};return n?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:t,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(_e,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(it,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):s.map(m=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:m.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",m.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:m.frequency})]}),e.jsxs("button",{onClick:()=>c(m.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(It,{size:18}),"Mark Done"]})]},m.id))})]})})}function mi({onUnlock:t,userType:s="user"}){const[a,n]=x.useState(""),[r,o]=x.useState(""),[i,l]=x.useState("password"),[c,m]=x.useState(!1),[d,h]=x.useState(""),[u,b]=x.useState(!1),[p,y]=x.useState("2005"),j=JSON.parse(localStorage.getItem("user")||"{}");x.useEffect(()=>{(async()=>{try{const k=await Xt.get();k?.screenLockPassword&&y(k.screenLockPassword)}catch(k){console.warn("Failed to load settings, using default password:",k)}})()},[]),x.useEffect(()=>{const f=document.getElementById(i==="password"?"unlock-password":"unlock-pin");f&&f.focus()},[i]);const v=async f=>{f.preventDefault(),f.stopPropagation(),b(!0),h("");try{const k=localStorage.getItem("token");if(!k)throw new Error("No authentication token found");const I=await fetch("https://universal-backend-w0x1.onrender.com/api/auth/unlock-screen",{method:"POST",headers:{Authorization:`Bearer ${k}`,"Content-Type":"application/json"},body:JSON.stringify({pin:r})});if(!I.ok){const F=await I.json();throw I.status===429?new Error(F.message||"Too many failed attempts. Try again later."):I.status===401?new Error(F.message||"Incorrect PIN"):new Error(F.message||"Unlock failed")}const O=await I.json();O.token&&localStorage.setItem("token",O.token),o(""),n(""),t(O)}catch(k){h(k.message||"Unlock failed")}finally{b(!1)}},g=f=>{const k=f.replace(/\D/g,"").slice(0,4);o(k)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:f=>f.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${s==="main_admin"?"bg-gradient-to-br from-red-600 to-orange-600":"bg-gradient-to-br from-blue-600 to-purple-600"}`,children:e.jsx(De,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-gray-600",children:s==="main_admin"?"Main Admin":j.name||"User"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Enter your ",i," to continue"]})]}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter PIN to unlock"}),e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",id:"unlock-pin",value:r,onChange:f=>g(f.target.value),placeholder:"0000",maxLength:"4",className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-center tracking-widest text-2xl",disabled:u})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"ðŸ”’ PIN validated securely on server"})]}),d&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-red-700 text-sm font-medium",children:[d.includes("Too many")?"âŒ ":"âš ï¸ ",d]})}),e.jsx("button",{type:"submit",disabled:u||r.length<4,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 rounded-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"}),"Verifying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-5 h-5"}),"Unlock Screen"]})})]})]})})}function hi(t=6e4){const[s,a]=x.useState(!1),n=x.useRef(Date.now()),r=x.useCallback(()=>{n.current=Date.now(),a(!1)},[]),o=x.useCallback(()=>{a(!1),n.current=Date.now()},[]);return x.useEffect(()=>{const i=["mousedown","mousemove","keypress","scroll","touchstart","click"],l=()=>{n.current=Date.now(),s&&a(!1)};i.forEach(m=>{document.addEventListener(m,l,!0)});const c=setInterval(()=>{Date.now()-n.current>t&&!s&&a(!0)},5e3);return()=>{i.forEach(m=>{document.removeEventListener(m,l,!0)}),clearInterval(c)}},[t,s]),[s,o,r]}function En(){const{user:t,logout:s,isCashierUserManagementEnabled:a}=be(),n=Te(),r=Yr(),[o,i]=x.useState(!0),[l,c]=x.useState(!1),[m,d]=x.useState({}),[h,u]=hi(45e3);x.useEffect(()=>{const v=()=>{const f=localStorage.getItem("user");if(f){const k=JSON.parse(f);let I=!1;(k.plan==="ultra"||k.role==="admin")&&(k.active||(k.active=!0,I=!0),k.plan==="ultra"&&k.role!=="admin"&&(k.role="admin",I=!0),k.plan==="ultra"&&(!k.price||k.price!==1600)&&(k.price=1600,I=!0),I&&(localStorage.setItem("user",JSON.stringify(k)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};v(),setTimeout(v,100);const g=setTimeout(()=>{c(!0)},1e3);return b(),()=>clearTimeout(g)},[]);const b=async()=>{try{const v=await Xt.get();d(v)}catch(v){console.error("Failed to load settings:",v)}},p=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses data? This action cannot be undone."))try{const v=localStorage.getItem("token"),f=await fetch(`${le}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!f.ok){const k=await f.json();throw new Error(k.message||"Failed to clear data")}alert("Data cleared successfully!"),window.location.reload()}catch(v){console.error("Failed to clear data:",v),alert("Failed to clear data: "+v.message)}},y=[{id:"overview",label:"Dashboard",icon:wl,path:"/admin"},{id:"sales",label:"Sales",icon:Zr,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:ot,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:Sl,path:"/admin/recipes"},{id:"expenses",label:"Expenses",icon:ss,path:"/admin/expenses"},{id:"vendors",label:"Vendors",icon:kl,path:"/admin/vendors"},...a()?[{id:"users",label:"Users",icon:Rt,path:"/admin/users"}]:[],{id:"time",label:"Time Tracking",icon:Ze,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:qa,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:Lt,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:fa,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:jt,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:Pl,path:"/admin/settings"}],j=v=>v==="/admin"?r.pathname==="/admin":r.pathname.startsWith(v);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${o?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[o&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>i(!o),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:o?e.jsx(_e,{className:"w-5 h-5"}):e.jsx(Cl,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:y.map(v=>{const g=v.icon;return e.jsxs("button",{onClick:()=>n(v.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${j(v.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(g,{className:"w-5 h-5 flex-shrink-0"}),o&&e.jsx("span",{className:"font-medium",children:v.label})]},v.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(Tl,{className:"w-5 h-5 flex-shrink-0"}),o&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:s,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(He,{className:"w-5 h-5 flex-shrink-0"}),o&&e.jsx("span",{className:"font-medium",children:"Logout"})]}),e.jsxs("button",{onClick:p,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors",children:[e.jsx(_e,{className:"w-5 h-5 flex-shrink-0"}),o&&e.jsx("span",{className:"font-medium",children:"Clear Data"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:y.find(v=>j(v.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:t?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(Xr,{children:[e.jsx(ee,{path:"/",element:e.jsx(ec,{})}),e.jsx(ee,{path:"/sales",element:e.jsx(rc,{})}),e.jsx(ee,{path:"/inventory",element:e.jsx(ac,{})}),e.jsx(ee,{path:"/recipes",element:e.jsx(nc,{})}),e.jsx(ee,{path:"/expenses",element:e.jsx(ic,{})}),e.jsx(ee,{path:"/vendors",element:e.jsx(xc,{})}),e.jsx(ee,{path:"/reminders",element:e.jsx(uc,{})}),e.jsx(ee,{path:"/service-fees",element:e.jsx(dc,{})}),e.jsx(ee,{path:"/discounts",element:e.jsx(mc,{})}),e.jsx(ee,{path:"/credit-requests",element:e.jsx(hc,{})}),e.jsx(ee,{path:"/users",element:e.jsx(oc,{})}),e.jsx(ee,{path:"/time",element:e.jsx(lc,{})}),e.jsx(ee,{path:"/settings",element:e.jsx(cc,{})})]})})]}),l&&e.jsx(ui,{onClose:()=>c(!1)}),h&&e.jsx(mi,{onUnlock:u,logo:m.logo})]})}const xi=x.createContext({});function pc(t){const s=x.useRef(null);return s.current===null&&(s.current=t()),s.current}const pi=typeof window<"u",fc=pi?x.useLayoutEffect:x.useEffect,Wa=x.createContext(null);function _a(t,s){t.indexOf(s)===-1&&t.push(s)}function Ka(t,s){const a=t.indexOf(s);a>-1&&t.splice(a,1)}const Ke=(t,s,a)=>a>s?s:a<t?t:a;let Ha=()=>{};const Qe={},fi=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function gi(t){return typeof t=="object"&&t!==null}const yi=t=>/^0[^.\s]+$/u.test(t);function Ga(t){let s;return()=>(s===void 0&&(s=t()),s)}const Oe=t=>t,gc=(t,s)=>a=>s(t(a)),cs=(...t)=>t.reduce(gc),as=(t,s,a)=>{const n=s-t;return n===0?1:(a-t)/n};class Ja{constructor(){this.subscriptions=[]}add(s){return _a(this.subscriptions,s),()=>Ka(this.subscriptions,s)}notify(s,a,n){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](s,a,n);else for(let o=0;o<r;o++){const i=this.subscriptions[o];i&&i(s,a,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Xe=t=>t*1e3,Re=t=>t/1e3;function bi(t,s){return s?t*(1e3/s):0}const ji=(t,s,a)=>(((1-3*a+3*s)*t+(3*a-6*s))*t+3*s)*t,yc=1e-7,bc=12;function jc(t,s,a,n,r){let o,i,l=0;do i=s+(a-s)/2,o=ji(i,n,r)-t,o>0?a=i:s=i;while(Math.abs(o)>yc&&++l<bc);return i}function ds(t,s,a,n){if(t===s&&a===n)return Oe;const r=o=>jc(o,0,1,t,a);return o=>o===0||o===1?o:ji(r(o),s,n)}const vi=t=>s=>s<=.5?t(2*s)/2:(2-t(2*(1-s)))/2,Ni=t=>s=>1-t(1-s),wi=ds(.33,1.53,.69,.99),Ya=Ni(wi),Si=vi(Ya),ki=t=>(t*=2)<1?.5*Ya(t):.5*(2-Math.pow(2,-10*(t-1))),Xa=t=>1-Math.sin(Math.acos(t)),Pi=Ni(Xa),Ci=vi(Xa),vc=ds(.42,0,1,1),Nc=ds(0,0,.58,1),Ti=ds(.42,0,.58,1),wc=t=>Array.isArray(t)&&typeof t[0]!="number",Ai=t=>Array.isArray(t)&&typeof t[0]=="number",Sc={linear:Oe,easeIn:vc,easeInOut:Ti,easeOut:Nc,circIn:Xa,circInOut:Ci,circOut:Pi,backIn:Ya,backInOut:Si,backOut:wi,anticipate:ki},kc=t=>typeof t=="string",Ln=t=>{if(Ai(t)){Ha(t.length===4);const[s,a,n,r]=t;return ds(s,a,n,r)}else if(kc(t))return Sc[t];return t},ys=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Pc(t,s){let a=new Set,n=new Set,r=!1,o=!1;const i=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(d){i.has(d)&&(m.schedule(d),t()),d(l)}const m={schedule:(d,h=!1,u=!1)=>{const p=u&&r?a:n;return h&&i.add(d),p.has(d)||p.add(d),d},cancel:d=>{n.delete(d),i.delete(d)},process:d=>{if(l=d,r){o=!0;return}r=!0,[a,n]=[n,a],a.forEach(c),a.clear(),r=!1,o&&(o=!1,m.process(d))}};return m}const Cc=40;function Di(t,s){let a=!1,n=!0;const r={delta:0,timestamp:0,isProcessing:!1},o=()=>a=!0,i=ys.reduce((f,k)=>(f[k]=Pc(o),f),{}),{setup:l,read:c,resolveKeyframes:m,preUpdate:d,update:h,preRender:u,render:b,postRender:p}=i,y=()=>{const f=Qe.useManualTiming?r.timestamp:performance.now();a=!1,Qe.useManualTiming||(r.delta=n?1e3/60:Math.max(Math.min(f-r.timestamp,Cc),1)),r.timestamp=f,r.isProcessing=!0,l.process(r),c.process(r),m.process(r),d.process(r),h.process(r),u.process(r),b.process(r),p.process(r),r.isProcessing=!1,a&&s&&(n=!1,t(y))},j=()=>{a=!0,n=!0,r.isProcessing||t(y)};return{schedule:ys.reduce((f,k)=>{const I=i[k];return f[k]=(O,F=!1,C=!1)=>(a||j(),I.schedule(O,F,C)),f},{}),cancel:f=>{for(let k=0;k<ys.length;k++)i[ys[k]].cancel(f)},state:r,steps:i}}const{schedule:ie,cancel:lt,state:ve,steps:Zs}=Di(typeof requestAnimationFrame<"u"?requestAnimationFrame:Oe,!0);let Cs;function Tc(){Cs=void 0}const Pe={now:()=>(Cs===void 0&&Pe.set(ve.isProcessing||Qe.useManualTiming?ve.timestamp:performance.now()),Cs),set:t=>{Cs=t,queueMicrotask(Tc)}},Ii=t=>s=>typeof s=="string"&&s.startsWith(t),Ei=Ii("--"),Ac=Ii("var(--"),Za=t=>Ac(t)?Dc.test(t.split("/*")[0].trim()):!1,Dc=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function Mn(t){return typeof t!="string"?!1:t.split("/*")[0].includes("var(--")}const Vt={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},ns={...Vt,transform:t=>Ke(0,1,t)},bs={...Vt,default:1},Zt=t=>Math.round(t*1e5)/1e5,Qa=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Ic(t){return t==null}const Ec=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,en=(t,s)=>a=>!!(typeof a=="string"&&Ec.test(a)&&a.startsWith(t)||s&&!Ic(a)&&Object.prototype.hasOwnProperty.call(a,s)),Li=(t,s,a)=>n=>{if(typeof n!="string")return n;const[r,o,i,l]=n.match(Qa);return{[t]:parseFloat(r),[s]:parseFloat(o),[a]:parseFloat(i),alpha:l!==void 0?parseFloat(l):1}},Lc=t=>Ke(0,255,t),Qs={...Vt,transform:t=>Math.round(Lc(t))},yt={test:en("rgb","red"),parse:Li("red","green","blue"),transform:({red:t,green:s,blue:a,alpha:n=1})=>"rgba("+Qs.transform(t)+", "+Qs.transform(s)+", "+Qs.transform(a)+", "+Zt(ns.transform(n))+")"};function Mc(t){let s="",a="",n="",r="";return t.length>5?(s=t.substring(1,3),a=t.substring(3,5),n=t.substring(5,7),r=t.substring(7,9)):(s=t.substring(1,2),a=t.substring(2,3),n=t.substring(3,4),r=t.substring(4,5),s+=s,a+=a,n+=n,r+=r),{red:parseInt(s,16),green:parseInt(a,16),blue:parseInt(n,16),alpha:r?parseInt(r,16)/255:1}}const ba={test:en("#"),parse:Mc,transform:yt.transform},us=t=>({test:s=>typeof s=="string"&&s.endsWith(t)&&s.split(" ").length===1,parse:parseFloat,transform:s=>`${s}${t}`}),at=us("deg"),We=us("%"),V=us("px"),Rc=us("vh"),Oc=us("vw"),Rn={...We,parse:t=>We.parse(t)/100,transform:t=>We.transform(t*100)},Ct={test:en("hsl","hue"),parse:Li("hue","saturation","lightness"),transform:({hue:t,saturation:s,lightness:a,alpha:n=1})=>"hsla("+Math.round(t)+", "+We.transform(Zt(s))+", "+We.transform(Zt(a))+", "+Zt(ns.transform(n))+")"},pe={test:t=>yt.test(t)||ba.test(t)||Ct.test(t),parse:t=>yt.test(t)?yt.parse(t):Ct.test(t)?Ct.parse(t):ba.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?yt.transform(t):Ct.transform(t),getAnimatableNone:t=>{const s=pe.parse(t);return s.alpha=0,pe.transform(s)}},Fc=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Vc(t){return isNaN(t)&&typeof t=="string"&&(t.match(Qa)?.length||0)+(t.match(Fc)?.length||0)>0}const Mi="number",Ri="color",$c="var",Uc="var(",On="${}",Bc=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function rs(t){const s=t.toString(),a=[],n={color:[],number:[],var:[]},r=[];let o=0;const l=s.replace(Bc,c=>(pe.test(c)?(n.color.push(o),r.push(Ri),a.push(pe.parse(c))):c.startsWith(Uc)?(n.var.push(o),r.push($c),a.push(c)):(n.number.push(o),r.push(Mi),a.push(parseFloat(c))),++o,On)).split(On);return{values:a,split:l,indexes:n,types:r}}function Oi(t){return rs(t).values}function Fi(t){const{split:s,types:a}=rs(t),n=s.length;return r=>{let o="";for(let i=0;i<n;i++)if(o+=s[i],r[i]!==void 0){const l=a[i];l===Mi?o+=Zt(r[i]):l===Ri?o+=pe.transform(r[i]):o+=r[i]}return o}}const qc=t=>typeof t=="number"?0:pe.test(t)?pe.getAnimatableNone(t):t;function zc(t){const s=Oi(t);return Fi(t)(s.map(qc))}const ct={test:Vc,parse:Oi,createTransformer:Fi,getAnimatableNone:zc};function ea(t,s,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?t+(s-t)*6*a:a<1/2?s:a<2/3?t+(s-t)*(2/3-a)*6:t}function Wc({hue:t,saturation:s,lightness:a,alpha:n}){t/=360,s/=100,a/=100;let r=0,o=0,i=0;if(!s)r=o=i=a;else{const l=a<.5?a*(1+s):a+s-a*s,c=2*a-l;r=ea(c,l,t+1/3),o=ea(c,l,t),i=ea(c,l,t-1/3)}return{red:Math.round(r*255),green:Math.round(o*255),blue:Math.round(i*255),alpha:n}}function Os(t,s){return a=>a>0?s:t}const ce=(t,s,a)=>t+(s-t)*a,ta=(t,s,a)=>{const n=t*t,r=a*(s*s-n)+n;return r<0?0:Math.sqrt(r)},_c=[ba,yt,Ct],Kc=t=>_c.find(s=>s.test(t));function Fn(t){const s=Kc(t);if(!s)return!1;let a=s.parse(t);return s===Ct&&(a=Wc(a)),a}const Vn=(t,s)=>{const a=Fn(t),n=Fn(s);if(!a||!n)return Os(t,s);const r={...a};return o=>(r.red=ta(a.red,n.red,o),r.green=ta(a.green,n.green,o),r.blue=ta(a.blue,n.blue,o),r.alpha=ce(a.alpha,n.alpha,o),yt.transform(r))},ja=new Set(["none","hidden"]);function Hc(t,s){return ja.has(t)?a=>a<=0?t:s:a=>a>=1?s:t}function Gc(t,s){return a=>ce(t,s,a)}function tn(t){return typeof t=="number"?Gc:typeof t=="string"?Za(t)?Os:pe.test(t)?Vn:Xc:Array.isArray(t)?Vi:typeof t=="object"?pe.test(t)?Vn:Jc:Os}function Vi(t,s){const a=[...t],n=a.length,r=t.map((o,i)=>tn(o)(o,s[i]));return o=>{for(let i=0;i<n;i++)a[i]=r[i](o);return a}}function Jc(t,s){const a={...t,...s},n={};for(const r in a)t[r]!==void 0&&s[r]!==void 0&&(n[r]=tn(t[r])(t[r],s[r]));return r=>{for(const o in n)a[o]=n[o](r);return a}}function Yc(t,s){const a=[],n={color:0,var:0,number:0};for(let r=0;r<s.values.length;r++){const o=s.types[r],i=t.indexes[o][n[o]],l=t.values[i]??0;a[r]=l,n[o]++}return a}const Xc=(t,s)=>{const a=ct.createTransformer(s),n=rs(t),r=rs(s);return n.indexes.var.length===r.indexes.var.length&&n.indexes.color.length===r.indexes.color.length&&n.indexes.number.length>=r.indexes.number.length?ja.has(t)&&!r.values.length||ja.has(s)&&!n.values.length?Hc(t,s):cs(Vi(Yc(n,r),r.values),a):Os(t,s)};function $i(t,s,a){return typeof t=="number"&&typeof s=="number"&&typeof a=="number"?ce(t,s,a):tn(t)(t,s)}const Zc=t=>{const s=({timestamp:a})=>t(a);return{start:(a=!0)=>ie.update(s,a),stop:()=>lt(s),now:()=>ve.isProcessing?ve.timestamp:Pe.now()}},Ui=(t,s,a=10)=>{let n="";const r=Math.max(Math.round(s/a),2);for(let o=0;o<r;o++)n+=Math.round(t(o/(r-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},Fs=2e4;function sn(t){let s=0;const a=50;let n=t.next(s);for(;!n.done&&s<Fs;)s+=a,n=t.next(s);return s>=Fs?1/0:s}function Qc(t,s=100,a){const n=a({...t,keyframes:[0,s]}),r=Math.min(sn(n),Fs);return{type:"keyframes",ease:o=>n.next(r*o).value/s,duration:Re(r)}}const ed=5;function Bi(t,s,a){const n=Math.max(s-ed,0);return bi(a-t(n),s-n)}const ue={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},sa=.001;function td({duration:t=ue.duration,bounce:s=ue.bounce,velocity:a=ue.velocity,mass:n=ue.mass}){let r,o,i=1-s;i=Ke(ue.minDamping,ue.maxDamping,i),t=Ke(ue.minDuration,ue.maxDuration,Re(t)),i<1?(r=m=>{const d=m*i,h=d*t,u=d-a,b=va(m,i),p=Math.exp(-h);return sa-u/b*p},o=m=>{const h=m*i*t,u=h*a+a,b=Math.pow(i,2)*Math.pow(m,2)*t,p=Math.exp(-h),y=va(Math.pow(m,2),i);return(-r(m)+sa>0?-1:1)*((u-b)*p)/y}):(r=m=>{const d=Math.exp(-m*t),h=(m-a)*t+1;return-sa+d*h},o=m=>{const d=Math.exp(-m*t),h=(a-m)*(t*t);return d*h});const l=5/t,c=ad(r,o,l);if(t=Xe(t),isNaN(c))return{stiffness:ue.stiffness,damping:ue.damping,duration:t};{const m=Math.pow(c,2)*n;return{stiffness:m,damping:i*2*Math.sqrt(n*m),duration:t}}}const sd=12;function ad(t,s,a){let n=a;for(let r=1;r<sd;r++)n=n-t(n)/s(n);return n}function va(t,s){return t*Math.sqrt(1-s*s)}const nd=["duration","bounce"],rd=["stiffness","damping","mass"];function $n(t,s){return s.some(a=>t[a]!==void 0)}function id(t){let s={velocity:ue.velocity,stiffness:ue.stiffness,damping:ue.damping,mass:ue.mass,isResolvedFromDuration:!1,...t};if(!$n(t,rd)&&$n(t,nd))if(t.visualDuration){const a=t.visualDuration,n=2*Math.PI/(a*1.2),r=n*n,o=2*Ke(.05,1,1-(t.bounce||0))*Math.sqrt(r);s={...s,mass:ue.mass,stiffness:r,damping:o}}else{const a=td(t);s={...s,...a,mass:ue.mass},s.isResolvedFromDuration=!0}return s}function Vs(t=ue.visualDuration,s=ue.bounce){const a=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:s}:t;let{restSpeed:n,restDelta:r}=a;const o=a.keyframes[0],i=a.keyframes[a.keyframes.length-1],l={done:!1,value:o},{stiffness:c,damping:m,mass:d,duration:h,velocity:u,isResolvedFromDuration:b}=id({...a,velocity:-Re(a.velocity||0)}),p=u||0,y=m/(2*Math.sqrt(c*d)),j=i-o,v=Re(Math.sqrt(c/d)),g=Math.abs(j)<5;n||(n=g?ue.restSpeed.granular:ue.restSpeed.default),r||(r=g?ue.restDelta.granular:ue.restDelta.default);let f;if(y<1){const I=va(v,y);f=O=>{const F=Math.exp(-y*v*O);return i-F*((p+y*v*j)/I*Math.sin(I*O)+j*Math.cos(I*O))}}else if(y===1)f=I=>i-Math.exp(-v*I)*(j+(p+v*j)*I);else{const I=v*Math.sqrt(y*y-1);f=O=>{const F=Math.exp(-y*v*O),C=Math.min(I*O,300);return i-F*((p+y*v*j)*Math.sinh(C)+I*j*Math.cosh(C))/I}}const k={calculatedDuration:b&&h||null,next:I=>{const O=f(I);if(b)l.done=I>=h;else{let F=I===0?p:0;y<1&&(F=I===0?Xe(p):Bi(f,I,O));const C=Math.abs(F)<=n,B=Math.abs(i-O)<=r;l.done=C&&B}return l.value=l.done?i:O,l},toString:()=>{const I=Math.min(sn(k),Fs),O=Ui(F=>k.next(I*F).value,I,30);return I+"ms "+O},toTransition:()=>{}};return k}Vs.applyToOptions=t=>{const s=Qc(t,100,Vs);return t.ease=s.ease,t.duration=Xe(s.duration),t.type="keyframes",t};function Na({keyframes:t,velocity:s=0,power:a=.8,timeConstant:n=325,bounceDamping:r=10,bounceStiffness:o=500,modifyTarget:i,min:l,max:c,restDelta:m=.5,restSpeed:d}){const h=t[0],u={done:!1,value:h},b=C=>l!==void 0&&C<l||c!==void 0&&C>c,p=C=>l===void 0?c:c===void 0||Math.abs(l-C)<Math.abs(c-C)?l:c;let y=a*s;const j=h+y,v=i===void 0?j:i(j);v!==j&&(y=v-h);const g=C=>-y*Math.exp(-C/n),f=C=>v+g(C),k=C=>{const B=g(C),E=f(C);u.done=Math.abs(B)<=m,u.value=u.done?v:E};let I,O;const F=C=>{b(u.value)&&(I=C,O=Vs({keyframes:[u.value,p(u.value)],velocity:Bi(f,C,u.value),damping:r,stiffness:o,restDelta:m,restSpeed:d}))};return F(0),{calculatedDuration:null,next:C=>{let B=!1;return!O&&I===void 0&&(B=!0,k(C),F(C)),I!==void 0&&C>=I?O.next(C-I):(!B&&k(C),u)}}}function od(t,s,a){const n=[],r=a||Qe.mix||$i,o=t.length-1;for(let i=0;i<o;i++){let l=r(t[i],t[i+1]);if(s){const c=Array.isArray(s)?s[i]||Oe:s;l=cs(c,l)}n.push(l)}return n}function ld(t,s,{clamp:a=!0,ease:n,mixer:r}={}){const o=t.length;if(Ha(o===s.length),o===1)return()=>s[0];if(o===2&&s[0]===s[1])return()=>s[1];const i=t[0]===t[1];t[0]>t[o-1]&&(t=[...t].reverse(),s=[...s].reverse());const l=od(s,n,r),c=l.length,m=d=>{if(i&&d<t[0])return s[0];let h=0;if(c>1)for(;h<t.length-2&&!(d<t[h+1]);h++);const u=as(t[h],t[h+1],d);return l[h](u)};return a?d=>m(Ke(t[0],t[o-1],d)):m}function cd(t,s){const a=t[t.length-1];for(let n=1;n<=s;n++){const r=as(0,s,n);t.push(ce(a,1,r))}}function dd(t){const s=[0];return cd(s,t.length-1),s}function ud(t,s){return t.map(a=>a*s)}function md(t,s){return t.map(()=>s||Ti).splice(0,t.length-1)}function Qt({duration:t=300,keyframes:s,times:a,ease:n="easeInOut"}){const r=wc(n)?n.map(Ln):Ln(n),o={done:!1,value:s[0]},i=ud(a&&a.length===s.length?a:dd(s),t),l=ld(i,s,{ease:Array.isArray(r)?r:md(s,r)});return{calculatedDuration:t,next:c=>(o.value=l(c),o.done=c>=t,o)}}const hd=t=>t!==null;function an(t,{repeat:s,repeatType:a="loop"},n,r=1){const o=t.filter(hd),l=r<0||s&&a!=="loop"&&s%2===1?0:o.length-1;return!l||n===void 0?o[l]:n}const xd={decay:Na,inertia:Na,tween:Qt,keyframes:Qt,spring:Vs};function qi(t){typeof t.type=="string"&&(t.type=xd[t.type])}class nn{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(s=>{this.resolve=s})}notifyFinished(){this.resolve()}then(s,a){return this.finished.then(s,a)}}const pd=t=>t/100;class rn extends nn{constructor(s){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:a}=this.options;a&&a.updatedAt!==Pe.now()&&this.tick(Pe.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=s,this.initAnimation(),this.play(),s.autoplay===!1&&this.pause()}initAnimation(){const{options:s}=this;qi(s);const{type:a=Qt,repeat:n=0,repeatDelay:r=0,repeatType:o,velocity:i=0}=s;let{keyframes:l}=s;const c=a||Qt;c!==Qt&&typeof l[0]!="number"&&(this.mixKeyframes=cs(pd,$i(l[0],l[1])),l=[0,100]);const m=c({...s,keyframes:l});o==="mirror"&&(this.mirroredGenerator=c({...s,keyframes:[...l].reverse(),velocity:-i})),m.calculatedDuration===null&&(m.calculatedDuration=sn(m));const{calculatedDuration:d}=m;this.calculatedDuration=d,this.resolvedDuration=d+r,this.totalDuration=this.resolvedDuration*(n+1)-r,this.generator=m}updateTime(s){const a=Math.round(s-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=a}tick(s,a=!1){const{generator:n,totalDuration:r,mixKeyframes:o,mirroredGenerator:i,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return n.next(0);const{delay:m=0,keyframes:d,repeat:h,repeatType:u,repeatDelay:b,type:p,onUpdate:y,finalKeyframe:j}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,s):this.speed<0&&(this.startTime=Math.min(s-r/this.speed,this.startTime)),a?this.currentTime=s:this.updateTime(s);const v=this.currentTime-m*(this.playbackSpeed>=0?1:-1),g=this.playbackSpeed>=0?v<0:v>r;this.currentTime=Math.max(v,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=r);let f=this.currentTime,k=n;if(h){const C=Math.min(this.currentTime,r)/l;let B=Math.floor(C),E=C%1;!E&&C>=1&&(E=1),E===1&&B--,B=Math.min(B,h+1),!!(B%2)&&(u==="reverse"?(E=1-E,b&&(E-=b/l)):u==="mirror"&&(k=i)),f=Ke(0,1,E)*l}const I=g?{done:!1,value:d[0]}:k.next(f);o&&(I.value=o(I.value));let{done:O}=I;!g&&c!==null&&(O=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const F=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&O);return F&&p!==Na&&(I.value=an(d,this.options,j,this.speed)),y&&y(I.value),F&&this.finish(),I}then(s,a){return this.finished.then(s,a)}get duration(){return Re(this.calculatedDuration)}get iterationDuration(){const{delay:s=0}=this.options||{};return this.duration+Re(s)}get time(){return Re(this.currentTime)}set time(s){s=Xe(s),this.currentTime=s,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=s:this.driver&&(this.startTime=this.driver.now()-s/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(s){this.updateTime(Pe.now());const a=this.playbackSpeed!==s;this.playbackSpeed=s,a&&(this.time=Re(this.currentTime))}play(){if(this.isStopped)return;const{driver:s=Zc,startTime:a}=this.options;this.driver||(this.driver=s(r=>this.tick(r))),this.options.onPlay?.();const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=a??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Pe.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(s){return this.startTime=0,this.tick(s,!0)}attachTimeline(s){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),s.observe(this)}}function fd(t){for(let s=1;s<t.length;s++)t[s]??(t[s]=t[s-1])}const bt=t=>t*180/Math.PI,wa=t=>{const s=bt(Math.atan2(t[1],t[0]));return Sa(s)},gd={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:wa,rotateZ:wa,skewX:t=>bt(Math.atan(t[1])),skewY:t=>bt(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},Sa=t=>(t=t%360,t<0&&(t+=360),t),Un=wa,Bn=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),qn=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),yd={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Bn,scaleY:qn,scale:t=>(Bn(t)+qn(t))/2,rotateX:t=>Sa(bt(Math.atan2(t[6],t[5]))),rotateY:t=>Sa(bt(Math.atan2(-t[2],t[0]))),rotateZ:Un,rotate:Un,skewX:t=>bt(Math.atan(t[4])),skewY:t=>bt(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function ka(t){return t.includes("scale")?1:0}function Pa(t,s){if(!t||t==="none")return ka(s);const a=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,r;if(a)n=yd,r=a;else{const l=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=gd,r=l}if(!r)return ka(s);const o=n[s],i=r[1].split(",").map(jd);return typeof o=="function"?o(i):i[o]}const bd=(t,s)=>{const{transform:a="none"}=getComputedStyle(t);return Pa(a,s)};function jd(t){return parseFloat(t.trim())}const $t=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Ut=new Set($t),zn=t=>t===Vt||t===V,vd=new Set(["x","y","z"]),Nd=$t.filter(t=>!vd.has(t));function wd(t){const s=[];return Nd.forEach(a=>{const n=t.getValue(a);n!==void 0&&(s.push([a,n.get()]),n.set(a.startsWith("scale")?1:0))}),s}const nt={width:({x:t},{paddingLeft:s="0",paddingRight:a="0"})=>t.max-t.min-parseFloat(s)-parseFloat(a),height:({y:t},{paddingTop:s="0",paddingBottom:a="0"})=>t.max-t.min-parseFloat(s)-parseFloat(a),top:(t,{top:s})=>parseFloat(s),left:(t,{left:s})=>parseFloat(s),bottom:({y:t},{top:s})=>parseFloat(s)+(t.max-t.min),right:({x:t},{left:s})=>parseFloat(s)+(t.max-t.min),x:(t,{transform:s})=>Pa(s,"x"),y:(t,{transform:s})=>Pa(s,"y")};nt.translateX=nt.x;nt.translateY=nt.y;const vt=new Set;let Ca=!1,Ta=!1,Aa=!1;function zi(){if(Ta){const t=Array.from(vt).filter(n=>n.needsMeasurement),s=new Set(t.map(n=>n.element)),a=new Map;s.forEach(n=>{const r=wd(n);r.length&&(a.set(n,r),n.render())}),t.forEach(n=>n.measureInitialState()),s.forEach(n=>{n.render();const r=a.get(n);r&&r.forEach(([o,i])=>{n.getValue(o)?.set(i)})}),t.forEach(n=>n.measureEndState()),t.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}Ta=!1,Ca=!1,vt.forEach(t=>t.complete(Aa)),vt.clear()}function Wi(){vt.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Ta=!0)})}function Sd(){Aa=!0,Wi(),zi(),Aa=!1}class on{constructor(s,a,n,r,o,i=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...s],this.onComplete=a,this.name=n,this.motionValue=r,this.element=o,this.isAsync=i}scheduleResolve(){this.state="scheduled",this.isAsync?(vt.add(this),Ca||(Ca=!0,ie.read(Wi),ie.resolveKeyframes(zi))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:s,name:a,element:n,motionValue:r}=this;if(s[0]===null){const o=r?.get(),i=s[s.length-1];if(o!==void 0)s[0]=o;else if(n&&a){const l=n.readValue(a,i);l!=null&&(s[0]=l)}s[0]===void 0&&(s[0]=i),r&&o===void 0&&r.set(s[0])}fd(s)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(s=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,s),vt.delete(this)}cancel(){this.state==="scheduled"&&(vt.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const kd=t=>t.startsWith("--");function Pd(t,s,a){kd(s)?t.style.setProperty(s,a):t.style[s]=a}const Cd=Ga(()=>window.ScrollTimeline!==void 0),Td={};function Ad(t,s){const a=Ga(t);return()=>Td[s]??a()}const _i=Ad(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Gt=([t,s,a,n])=>`cubic-bezier(${t}, ${s}, ${a}, ${n})`,Wn={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Gt([0,.65,.55,1]),circOut:Gt([.55,0,1,.45]),backIn:Gt([.31,.01,.66,-.59]),backOut:Gt([.33,1.53,.69,.99])};function Ki(t,s){if(t)return typeof t=="function"?_i()?Ui(t,s):"ease-out":Ai(t)?Gt(t):Array.isArray(t)?t.map(a=>Ki(a,s)||Wn.easeOut):Wn[t]}function Dd(t,s,a,{delay:n=0,duration:r=300,repeat:o=0,repeatType:i="loop",ease:l="easeOut",times:c}={},m=void 0){const d={[s]:a};c&&(d.offset=c);const h=Ki(l,r);Array.isArray(h)&&(d.easing=h);const u={delay:n,duration:r,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:o+1,direction:i==="reverse"?"alternate":"normal"};return m&&(u.pseudoElement=m),t.animate(d,u)}function Hi(t){return typeof t=="function"&&"applyToOptions"in t}function Id({type:t,...s}){return Hi(t)&&_i()?t.applyToOptions(s):(s.duration??(s.duration=300),s.ease??(s.ease="easeOut"),s)}class Ed extends nn{constructor(s){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!s)return;const{element:a,name:n,keyframes:r,pseudoElement:o,allowFlatten:i=!1,finalKeyframe:l,onComplete:c}=s;this.isPseudoElement=!!o,this.allowFlatten=i,this.options=s,Ha(typeof s.type!="string");const m=Id(s);this.animation=Dd(a,n,r,m,o),m.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!o){const d=an(r,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(d):Pd(a,n,d),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:s}=this;s==="idle"||s==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const s=this.animation.effect?.getComputedTiming?.().duration||0;return Re(Number(s))}get iterationDuration(){const{delay:s=0}=this.options||{};return this.duration+Re(s)}get time(){return Re(Number(this.animation.currentTime)||0)}set time(s){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=Xe(s)}get speed(){return this.animation.playbackRate}set speed(s){s<0&&(this.finishedTime=null),this.animation.playbackRate=s}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(s){this.manualStartTime=this.animation.startTime=s}attachTimeline({timeline:s,observe:a}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,s&&Cd()?(this.animation.timeline=s,Oe):a(this)}}const Gi={anticipate:ki,backInOut:Si,circInOut:Ci};function Ld(t){return t in Gi}function Md(t){typeof t.ease=="string"&&Ld(t.ease)&&(t.ease=Gi[t.ease])}const aa=10;class Rd extends Ed{constructor(s){Md(s),qi(s),super(s),s.startTime!==void 0&&(this.startTime=s.startTime),this.options=s}updateMotionValue(s){const{motionValue:a,onUpdate:n,onComplete:r,element:o,...i}=this.options;if(!a)return;if(s!==void 0){a.set(s);return}const l=new rn({...i,autoplay:!1}),c=Math.max(aa,Pe.now()-this.startTime),m=Ke(0,aa,c-aa);a.setWithVelocity(l.sample(Math.max(0,c-m)).value,l.sample(c).value,m),l.stop()}}const _n=(t,s)=>s==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(ct.test(t)||t==="0")&&!t.startsWith("url("));function Od(t){const s=t[0];if(t.length===1)return!0;for(let a=0;a<t.length;a++)if(t[a]!==s)return!0}function Fd(t,s,a,n){const r=t[0];if(r===null)return!1;if(s==="display"||s==="visibility")return!0;const o=t[t.length-1],i=_n(r,s),l=_n(o,s);return!i||!l?!1:Od(t)||(a==="spring"||Hi(a))&&n}function Da(t){t.duration=0,t.type="keyframes"}const Vd=new Set(["opacity","clipPath","filter","transform"]),$d=Ga(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Ud(t){const{motionValue:s,name:a,repeatDelay:n,repeatType:r,damping:o,type:i}=t;if(!(s?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:m}=s.owner.getProps();return $d()&&a&&Vd.has(a)&&(a!=="transform"||!m)&&!c&&!n&&r!=="mirror"&&o!==0&&i!=="inertia"}const Bd=40;class qd extends nn{constructor({autoplay:s=!0,delay:a=0,type:n="keyframes",repeat:r=0,repeatDelay:o=0,repeatType:i="loop",keyframes:l,name:c,motionValue:m,element:d,...h}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Pe.now();const u={autoplay:s,delay:a,type:n,repeat:r,repeatDelay:o,repeatType:i,name:c,motionValue:m,element:d,...h},b=d?.KeyframeResolver||on;this.keyframeResolver=new b(l,(p,y,j)=>this.onKeyframesResolved(p,y,u,!j),c,m,d),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(s,a,n,r){this.keyframeResolver=void 0;const{name:o,type:i,velocity:l,delay:c,isHandoff:m,onUpdate:d}=n;this.resolvedAt=Pe.now(),Fd(s,o,i,l)||((Qe.instantAnimations||!c)&&d?.(an(s,n,a)),s[0]=s[s.length-1],Da(n),n.repeat=0);const u={startTime:r?this.resolvedAt?this.resolvedAt-this.createdAt>Bd?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:a,...n,keyframes:s},b=!m&&Ud(u),p=u.motionValue?.owner?.current,y=b?new Rd({...u,element:p}):new rn(u);y.finished.then(()=>{this.notifyFinished()}).catch(Oe),this.pendingTimeline&&(this.stopTimeline=y.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=y}get finished(){return this._animation?this.animation.finished:this._finished}then(s,a){return this.finished.finally(s).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),Sd()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(s){this.animation.time=s}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(s){this.animation.speed=s}get startTime(){return this.animation.startTime}attachTimeline(s){return this._animation?this.stopTimeline=this.animation.attachTimeline(s):this.pendingTimeline=s,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}function Ji(t,s,a,n=0,r=1){const o=Array.from(t).sort((m,d)=>m.sortNodePosition(d)).indexOf(s),i=t.size,l=(i-1)*n;return typeof a=="function"?a(o,i):r===1?o*n:l-o*n}const zd=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Wd(t){const s=zd.exec(t);if(!s)return[,];const[,a,n,r]=s;return[`--${a??n}`,r]}function Yi(t,s,a=1){const[n,r]=Wd(t);if(!n)return;const o=window.getComputedStyle(s).getPropertyValue(n);if(o){const i=o.trim();return fi(i)?parseFloat(i):i}return Za(r)?Yi(r,s,a+1):r}const _d={type:"spring",stiffness:500,damping:25,restSpeed:10},Kd=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),Hd={type:"keyframes",duration:.8},Gd={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Jd=(t,{keyframes:s})=>s.length>2?Hd:Ut.has(t)?t.startsWith("scale")?Kd(s[1]):_d:Gd,Yd=t=>t!==null;function Xd(t,{repeat:s,repeatType:a="loop"},n){const r=t.filter(Yd),o=s&&a!=="loop"&&s%2===1?0:r.length-1;return r[o]}function ln(t,s){return t?.[s]??t?.default??t}function Zd({when:t,delay:s,delayChildren:a,staggerChildren:n,staggerDirection:r,repeat:o,repeatType:i,repeatDelay:l,from:c,elapsed:m,...d}){return!!Object.keys(d).length}const cn=(t,s,a,n={},r,o)=>i=>{const l=ln(n,t)||{},c=l.delay||n.delay||0;let{elapsed:m=0}=n;m=m-Xe(c);const d={keyframes:Array.isArray(a)?a:[null,a],ease:"easeOut",velocity:s.getVelocity(),...l,delay:-m,onUpdate:u=>{s.set(u),l.onUpdate&&l.onUpdate(u)},onComplete:()=>{i(),l.onComplete&&l.onComplete()},name:t,motionValue:s,element:o?void 0:r};Zd(l)||Object.assign(d,Jd(t,d)),d.duration&&(d.duration=Xe(d.duration)),d.repeatDelay&&(d.repeatDelay=Xe(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let h=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(Da(d),d.delay===0&&(h=!0)),(Qe.instantAnimations||Qe.skipAnimations)&&(h=!0,Da(d),d.delay=0),d.allowFlatten=!l.type&&!l.ease,h&&!o&&s.get()!==void 0){const u=Xd(d.keyframes,l);if(u!==void 0){ie.update(()=>{d.onUpdate(u),d.onComplete()});return}}return l.isSync?new rn(d):new qd(d)};function Kn(t){const s=[{},{}];return t?.values.forEach((a,n)=>{s[0][n]=a.get(),s[1][n]=a.getVelocity()}),s}function dn(t,s,a,n){if(typeof s=="function"){const[r,o]=Kn(n);s=s(a!==void 0?a:t.custom,r,o)}if(typeof s=="string"&&(s=t.variants&&t.variants[s]),typeof s=="function"){const[r,o]=Kn(n);s=s(a!==void 0?a:t.custom,r,o)}return s}function Et(t,s,a){const n=t.getProps();return dn(n,s,a!==void 0?a:n.custom,t)}const Xi=new Set(["width","height","top","left","right","bottom",...$t]),Hn=30,Qd=t=>!isNaN(parseFloat(t));class eu{constructor(s,a={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{const r=Pe.now();if(this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const o of this.dependents)o.dirty()},this.hasAnimated=!1,this.setCurrent(s),this.owner=a.owner}setCurrent(s){this.current=s,this.updatedAt=Pe.now(),this.canTrackVelocity===null&&s!==void 0&&(this.canTrackVelocity=Qd(this.current))}setPrevFrameValue(s=this.current){this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt}onChange(s){return this.on("change",s)}on(s,a){this.events[s]||(this.events[s]=new Ja);const n=this.events[s].add(a);return s==="change"?()=>{n(),ie.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const s in this.events)this.events[s].clear()}attach(s,a){this.passiveEffect=s,this.stopPassiveEffect=a}set(s){this.passiveEffect?this.passiveEffect(s,this.updateAndNotify):this.updateAndNotify(s)}setWithVelocity(s,a,n){this.set(a),this.prev=void 0,this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt-n}jump(s,a=!0){this.updateAndNotify(s),this.prev=s,this.prevUpdatedAt=this.prevFrameValue=void 0,a&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(s){this.dependents||(this.dependents=new Set),this.dependents.add(s)}removeDependent(s){this.dependents&&this.dependents.delete(s)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const s=Pe.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||s-this.updatedAt>Hn)return 0;const a=Math.min(this.updatedAt-this.prevUpdatedAt,Hn);return bi(parseFloat(this.current)-parseFloat(this.prevFrameValue),a)}start(s){return this.stop(),new Promise(a=>{this.hasAnimated=!0,this.animation=s(a),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Ft(t,s){return new eu(t,s)}const Ia=t=>Array.isArray(t);function tu(t,s,a){t.hasValue(s)?t.getValue(s).set(a):t.addValue(s,Ft(a))}function su(t){return Ia(t)?t[t.length-1]||0:t}function au(t,s){const a=Et(t,s);let{transitionEnd:n={},transition:r={},...o}=a||{};o={...o,...n};for(const i in o){const l=su(o[i]);tu(t,i,l)}}const Se=t=>!!(t&&t.getVelocity);function nu(t){return!!(Se(t)&&t.add)}function Ea(t,s){const a=t.getValue("willChange");if(nu(a))return a.add(s);if(!a&&Qe.WillChange){const n=new Qe.WillChange("auto");t.addValue("willChange",n),n.add(s)}}function un(t){return t.replace(/([A-Z])/g,s=>`-${s.toLowerCase()}`)}const ru="framerAppearId",Zi="data-"+un(ru);function Qi(t){return t.props[Zi]}function iu({protectedKeys:t,needsAnimating:s},a){const n=t.hasOwnProperty(a)&&s[a]!==!0;return s[a]=!1,n}function eo(t,s,{delay:a=0,transitionOverride:n,type:r}={}){let{transition:o=t.getDefaultTransition(),transitionEnd:i,...l}=s;n&&(o=n);const c=[],m=r&&t.animationState&&t.animationState.getState()[r];for(const d in l){const h=t.getValue(d,t.latestValues[d]??null),u=l[d];if(u===void 0||m&&iu(m,d))continue;const b={delay:a,...ln(o||{},d)},p=h.get();if(p!==void 0&&!h.isAnimating&&!Array.isArray(u)&&u===p&&!b.velocity)continue;let y=!1;if(window.MotionHandoffAnimation){const v=Qi(t);if(v){const g=window.MotionHandoffAnimation(v,d,ie);g!==null&&(b.startTime=g,y=!0)}}Ea(t,d),h.start(cn(d,h,u,t.shouldReduceMotion&&Xi.has(d)?{type:!1}:b,t,y));const j=h.animation;j&&c.push(j)}return i&&Promise.all(c).then(()=>{ie.update(()=>{i&&au(t,i)})}),c}function La(t,s,a={}){const n=Et(t,s,a.type==="exit"?t.presenceContext?.custom:void 0);let{transition:r=t.getDefaultTransition()||{}}=n||{};a.transitionOverride&&(r=a.transitionOverride);const o=n?()=>Promise.all(eo(t,n,a)):()=>Promise.resolve(),i=t.variantChildren&&t.variantChildren.size?(c=0)=>{const{delayChildren:m=0,staggerChildren:d,staggerDirection:h}=r;return ou(t,s,c,m,d,h,a)}:()=>Promise.resolve(),{when:l}=r;if(l){const[c,m]=l==="beforeChildren"?[o,i]:[i,o];return c().then(()=>m())}else return Promise.all([o(),i(a.delay)])}function ou(t,s,a=0,n=0,r=0,o=1,i){const l=[];for(const c of t.variantChildren)c.notify("AnimationStart",s),l.push(La(c,s,{...i,delay:a+(typeof n=="function"?0:n)+Ji(t.variantChildren,c,n,r,o)}).then(()=>c.notify("AnimationComplete",s)));return Promise.all(l)}function lu(t,s,a={}){t.notify("AnimationStart",s);let n;if(Array.isArray(s)){const r=s.map(o=>La(t,o,a));n=Promise.all(r)}else if(typeof s=="string")n=La(t,s,a);else{const r=typeof s=="function"?Et(t,s,a.custom):s;n=Promise.all(eo(t,r,a))}return n.then(()=>{t.notify("AnimationComplete",s)})}const cu={test:t=>t==="auto",parse:t=>t},to=t=>s=>s.test(t),so=[Vt,V,We,at,Oc,Rc,cu],Gn=t=>so.find(to(t));function du(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||yi(t):!0}const uu=new Set(["brightness","contrast","saturate","opacity"]);function mu(t){const[s,a]=t.slice(0,-1).split("(");if(s==="drop-shadow")return t;const[n]=a.match(Qa)||[];if(!n)return t;const r=a.replace(n,"");let o=uu.has(s)?1:0;return n!==a&&(o*=100),s+"("+o+r+")"}const hu=/\b([a-z-]*)\(.*?\)/gu,Ma={...ct,getAnimatableNone:t=>{const s=t.match(hu);return s?s.map(mu).join(" "):t}},Jn={...Vt,transform:Math.round},xu={rotate:at,rotateX:at,rotateY:at,rotateZ:at,scale:bs,scaleX:bs,scaleY:bs,scaleZ:bs,skew:at,skewX:at,skewY:at,distance:V,translateX:V,translateY:V,translateZ:V,x:V,y:V,z:V,perspective:V,transformPerspective:V,opacity:ns,originX:Rn,originY:Rn,originZ:V},mn={borderWidth:V,borderTopWidth:V,borderRightWidth:V,borderBottomWidth:V,borderLeftWidth:V,borderRadius:V,borderTopLeftRadius:V,borderTopRightRadius:V,borderBottomRightRadius:V,borderBottomLeftRadius:V,width:V,maxWidth:V,height:V,maxHeight:V,top:V,right:V,bottom:V,left:V,inset:V,insetBlock:V,insetBlockStart:V,insetBlockEnd:V,insetInline:V,insetInlineStart:V,insetInlineEnd:V,padding:V,paddingTop:V,paddingRight:V,paddingBottom:V,paddingLeft:V,paddingBlock:V,paddingBlockStart:V,paddingBlockEnd:V,paddingInline:V,paddingInlineStart:V,paddingInlineEnd:V,margin:V,marginTop:V,marginRight:V,marginBottom:V,marginLeft:V,marginBlock:V,marginBlockStart:V,marginBlockEnd:V,marginInline:V,marginInlineStart:V,marginInlineEnd:V,fontSize:V,backgroundPositionX:V,backgroundPositionY:V,...xu,zIndex:Jn,fillOpacity:ns,strokeOpacity:ns,numOctaves:Jn},pu={...mn,color:pe,backgroundColor:pe,outlineColor:pe,fill:pe,stroke:pe,borderColor:pe,borderTopColor:pe,borderRightColor:pe,borderBottomColor:pe,borderLeftColor:pe,filter:Ma,WebkitFilter:Ma},ao=t=>pu[t];function no(t,s){let a=ao(t);return a!==Ma&&(a=ct),a.getAnimatableNone?a.getAnimatableNone(s):void 0}const fu=new Set(["auto","none","0"]);function gu(t,s,a){let n=0,r;for(;n<t.length&&!r;){const o=t[n];typeof o=="string"&&!fu.has(o)&&rs(o).values.length&&(r=t[n]),n++}if(r&&a)for(const o of s)t[o]=no(a,r)}class yu extends on{constructor(s,a,n,r,o){super(s,a,n,r,o,!0)}readKeyframes(){const{unresolvedKeyframes:s,element:a,name:n}=this;if(!a||!a.current)return;super.readKeyframes();for(let d=0;d<s.length;d++){let h=s[d];if(typeof h=="string"&&(h=h.trim(),Za(h))){const u=Yi(h,a.current);u!==void 0&&(s[d]=u),d===s.length-1&&(this.finalKeyframe=h)}}if(this.resolveNoneKeyframes(),!Xi.has(n)||s.length!==2)return;const[r,o]=s,i=Gn(r),l=Gn(o),c=Mn(r),m=Mn(o);if(c!==m&&nt[n]){this.needsMeasurement=!0;return}if(i!==l)if(zn(i)&&zn(l))for(let d=0;d<s.length;d++){const h=s[d];typeof h=="string"&&(s[d]=parseFloat(h))}else nt[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:s,name:a}=this,n=[];for(let r=0;r<s.length;r++)(s[r]===null||du(s[r]))&&n.push(r);n.length&&gu(s,n,a)}measureInitialState(){const{element:s,unresolvedKeyframes:a,name:n}=this;if(!s||!s.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=nt[n](s.measureViewportBox(),window.getComputedStyle(s.current)),a[0]=this.measuredOrigin;const r=a[a.length-1];r!==void 0&&s.getValue(n,r).jump(r,!1)}measureEndState(){const{element:s,name:a,unresolvedKeyframes:n}=this;if(!s||!s.current)return;const r=s.getValue(a);r&&r.jump(this.measuredOrigin,!1);const o=n.length-1,i=n[o];n[o]=nt[a](s.measureViewportBox(),window.getComputedStyle(s.current)),i!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=i),this.removedTransforms?.length&&this.removedTransforms.forEach(([l,c])=>{s.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function ro(t,s,a){if(t==null)return[];if(t instanceof EventTarget)return[t];if(typeof t=="string"){const r=document.querySelectorAll(t);return r?Array.from(r):[]}return Array.from(t).filter(n=>n!=null)}const io=(t,s)=>s&&typeof t=="number"?s.transform(t):t;function bu(t){return gi(t)&&"offsetHeight"in t}const{schedule:hn}=Di(queueMicrotask,!1),Be={x:!1,y:!1};function oo(){return Be.x||Be.y}function ju(t){return t==="x"||t==="y"?Be[t]?null:(Be[t]=!0,()=>{Be[t]=!1}):Be.x||Be.y?null:(Be.x=Be.y=!0,()=>{Be.x=Be.y=!1})}function lo(t,s){const a=ro(t),n=new AbortController,r={passive:!0,...s,signal:n.signal};return[a,r,()=>n.abort()]}function Yn(t){return!(t.pointerType==="touch"||oo())}function vu(t,s,a={}){const[n,r,o]=lo(t,a),i=l=>{if(!Yn(l))return;const{target:c}=l,m=s(c,l);if(typeof m!="function"||!c)return;const d=h=>{Yn(h)&&(m(h),c.removeEventListener("pointerleave",d))};c.addEventListener("pointerleave",d,r)};return n.forEach(l=>{l.addEventListener("pointerenter",i,r)}),o}const co=(t,s)=>s?t===s?!0:co(t,s.parentElement):!1,xn=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,Nu=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function uo(t){return Nu.has(t.tagName)||t.isContentEditable===!0}const Ts=new WeakSet;function Xn(t){return s=>{s.key==="Enter"&&t(s)}}function na(t,s){t.dispatchEvent(new PointerEvent("pointer"+s,{isPrimary:!0,bubbles:!0}))}const wu=(t,s)=>{const a=t.currentTarget;if(!a)return;const n=Xn(()=>{if(Ts.has(a))return;na(a,"down");const r=Xn(()=>{na(a,"up")}),o=()=>na(a,"cancel");a.addEventListener("keyup",r,s),a.addEventListener("blur",o,s)});a.addEventListener("keydown",n,s),a.addEventListener("blur",()=>a.removeEventListener("keydown",n),s)};function Zn(t){return xn(t)&&!oo()}function Su(t,s,a={}){const[n,r,o]=lo(t,a),i=l=>{const c=l.currentTarget;if(!Zn(l))return;Ts.add(c);const m=s(c,l),d=(b,p)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",u),Ts.has(c)&&Ts.delete(c),Zn(b)&&typeof m=="function"&&m(b,{success:p})},h=b=>{d(b,c===window||c===document||a.useGlobalTarget||co(c,b.target))},u=b=>{d(b,!1)};window.addEventListener("pointerup",h,r),window.addEventListener("pointercancel",u,r)};return n.forEach(l=>{(a.useGlobalTarget?window:l).addEventListener("pointerdown",i,r),bu(l)&&(l.addEventListener("focus",m=>wu(m,r)),!uo(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),o}function mo(t){return gi(t)&&"ownerSVGElement"in t}function ku(t){return mo(t)&&t.tagName==="svg"}const Pu=[...so,pe,ct],Cu=t=>Pu.find(to(t)),Qn=()=>({translate:0,scale:1,origin:0,originPoint:0}),Tt=()=>({x:Qn(),y:Qn()}),er=()=>({min:0,max:0}),ye=()=>({x:er(),y:er()}),Ra={current:null},ho={current:!1},Tu=typeof window<"u";function Au(){if(ho.current=!0,!!Tu)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),s=()=>Ra.current=t.matches;t.addEventListener("change",s),s()}else Ra.current=!1}const Du=new WeakMap;function Ws(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function is(t){return typeof t=="string"||Array.isArray(t)}const pn=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],fn=["initial",...pn];function _s(t){return Ws(t.animate)||fn.some(s=>is(t[s]))}function xo(t){return!!(_s(t)||t.variants)}function Iu(t,s,a){for(const n in s){const r=s[n],o=a[n];if(Se(r))t.addValue(n,r);else if(Se(o))t.addValue(n,Ft(r,{owner:t}));else if(o!==r)if(t.hasValue(n)){const i=t.getValue(n);i.liveStyle===!0?i.jump(r):i.hasAnimated||i.set(r)}else{const i=t.getStaticValue(n);t.addValue(n,Ft(i!==void 0?i:r,{owner:t}))}}for(const n in a)s[n]===void 0&&t.removeValue(n);return s}const tr=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let $s={};function po(t){$s=t}function Eu(){return $s}class Lu{scrapeMotionValuesFromProps(s,a,n){return{}}constructor({parent:s,props:a,presenceContext:n,reducedMotionConfig:r,blockInitialAnimation:o,visualState:i},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=on,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const u=Pe.now();this.renderScheduledAt<u&&(this.renderScheduledAt=u,ie.render(this.render,!1,!0))};const{latestValues:c,renderState:m}=i;this.latestValues=c,this.baseTarget={...c},this.initialValues=a.initial?{...c}:{},this.renderState=m,this.parent=s,this.props=a,this.presenceContext=n,this.depth=s?s.depth+1:0,this.reducedMotionConfig=r,this.options=l,this.blockInitialAnimation=!!o,this.isControllingVariants=_s(a),this.isVariantNode=xo(a),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(s&&s.current);const{willChange:d,...h}=this.scrapeMotionValuesFromProps(a,{},this);for(const u in h){const b=h[u];c[u]!==void 0&&Se(b)&&b.set(c[u])}}mount(s){this.current=s,Du.set(s,this),this.projection&&!this.projection.instance&&this.projection.mount(s),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((a,n)=>this.bindToMotionValue(n,a)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(ho.current||Au(),this.shouldReduceMotion=Ra.current),this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),lt(this.notifyUpdate),lt(this.render),this.valueSubscriptions.forEach(s=>s()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const s in this.events)this.events[s].clear();for(const s in this.features){const a=this.features[s];a&&(a.unmount(),a.isMounted=!1)}this.current=null}addChild(s){this.children.add(s),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(s)}removeChild(s){this.children.delete(s),this.enteringChildren&&this.enteringChildren.delete(s)}bindToMotionValue(s,a){this.valueSubscriptions.has(s)&&this.valueSubscriptions.get(s)();const n=Ut.has(s);n&&this.onBindTransform&&this.onBindTransform();const r=a.on("change",i=>{this.latestValues[s]=i,this.props.onUpdate&&ie.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let o;typeof window<"u"&&window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,s,a)),this.valueSubscriptions.set(s,()=>{r(),o&&o(),a.owner&&a.stop()})}sortNodePosition(s){return!this.current||!this.sortInstanceNodePosition||this.type!==s.type?0:this.sortInstanceNodePosition(this.current,s.current)}updateFeatures(){let s="animation";for(s in $s){const a=$s[s];if(!a)continue;const{isEnabled:n,Feature:r}=a;if(!this.features[s]&&r&&n(this.props)&&(this.features[s]=new r(this)),this.features[s]){const o=this.features[s];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ye()}getStaticValue(s){return this.latestValues[s]}setStaticValue(s,a){this.latestValues[s]=a}update(s,a){(s.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=s,this.prevPresenceContext=this.presenceContext,this.presenceContext=a;for(let n=0;n<tr.length;n++){const r=tr[n];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const o="on"+r,i=s[o];i&&(this.propEventSubscriptions[r]=this.on(r,i))}this.prevMotionValues=Iu(this,this.scrapeMotionValuesFromProps(s,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(s){return this.props.variants?this.props.variants[s]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(s){const a=this.getClosestVariantNode();if(a)return a.variantChildren&&a.variantChildren.add(s),()=>a.variantChildren.delete(s)}addValue(s,a){const n=this.values.get(s);a!==n&&(n&&this.removeValue(s),this.bindToMotionValue(s,a),this.values.set(s,a),this.latestValues[s]=a.get())}removeValue(s){this.values.delete(s);const a=this.valueSubscriptions.get(s);a&&(a(),this.valueSubscriptions.delete(s)),delete this.latestValues[s],this.removeValueFromRenderState(s,this.renderState)}hasValue(s){return this.values.has(s)}getValue(s,a){if(this.props.values&&this.props.values[s])return this.props.values[s];let n=this.values.get(s);return n===void 0&&a!==void 0&&(n=Ft(a===null?void 0:a,{owner:this}),this.addValue(s,n)),n}readValue(s,a){let n=this.latestValues[s]!==void 0||!this.current?this.latestValues[s]:this.getBaseTargetFromProps(this.props,s)??this.readValueFromInstance(this.current,s,this.options);return n!=null&&(typeof n=="string"&&(fi(n)||yi(n))?n=parseFloat(n):!Cu(n)&&ct.test(a)&&(n=no(s,a)),this.setBaseTarget(s,Se(n)?n.get():n)),Se(n)?n.get():n}setBaseTarget(s,a){this.baseTarget[s]=a}getBaseTarget(s){const{initial:a}=this.props;let n;if(typeof a=="string"||typeof a=="object"){const o=dn(this.props,a,this.presenceContext?.custom);o&&(n=o[s])}if(a&&n!==void 0)return n;const r=this.getBaseTargetFromProps(this.props,s);return r!==void 0&&!Se(r)?r:this.initialValues[s]!==void 0&&n===void 0?void 0:this.baseTarget[s]}on(s,a){return this.events[s]||(this.events[s]=new Ja),this.events[s].add(a)}notify(s,...a){this.events[s]&&this.events[s].notify(...a)}scheduleRenderMicrotask(){hn.render(this.render)}}class fo extends Lu{constructor(){super(...arguments),this.KeyframeResolver=yu}sortInstanceNodePosition(s,a){return s.compareDocumentPosition(a)&2?1:-1}getBaseTargetFromProps(s,a){const n=s.style;return n?n[a]:void 0}removeValueFromRenderState(s,{vars:a,style:n}){delete a[s],delete n[s]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:s}=this.props;Se(s)&&(this.childSubscription=s.on("change",a=>{this.current&&(this.current.textContent=`${a}`)}))}}class dt{constructor(s){this.isMounted=!1,this.node=s}update(){}}function go({top:t,left:s,right:a,bottom:n}){return{x:{min:s,max:a},y:{min:t,max:n}}}function Mu({x:t,y:s}){return{top:s.min,right:t.max,bottom:s.max,left:t.min}}function Ru(t,s){if(!s)return t;const a=s({x:t.left,y:t.top}),n=s({x:t.right,y:t.bottom});return{top:a.y,left:a.x,bottom:n.y,right:n.x}}function ra(t){return t===void 0||t===1}function Oa({scale:t,scaleX:s,scaleY:a}){return!ra(t)||!ra(s)||!ra(a)}function ft(t){return Oa(t)||yo(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function yo(t){return sr(t.x)||sr(t.y)}function sr(t){return t&&t!=="0%"}function Us(t,s,a){const n=t-a,r=s*n;return a+r}function ar(t,s,a,n,r){return r!==void 0&&(t=Us(t,r,n)),Us(t,a,n)+s}function Fa(t,s=0,a=1,n,r){t.min=ar(t.min,s,a,n,r),t.max=ar(t.max,s,a,n,r)}function bo(t,{x:s,y:a}){Fa(t.x,s.translate,s.scale,s.originPoint),Fa(t.y,a.translate,a.scale,a.originPoint)}const nr=.999999999999,rr=1.0000000000001;function Ou(t,s,a,n=!1){const r=a.length;if(!r)return;s.x=s.y=1;let o,i;for(let l=0;l<r;l++){o=a[l],i=o.projectionDelta;const{visualElement:c}=o.options;c&&c.props.style&&c.props.style.display==="contents"||(n&&o.options.layoutScroll&&o.scroll&&o!==o.root&&Dt(t,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),i&&(s.x*=i.x.scale,s.y*=i.y.scale,bo(t,i)),n&&ft(o.latestValues)&&Dt(t,o.latestValues))}s.x<rr&&s.x>nr&&(s.x=1),s.y<rr&&s.y>nr&&(s.y=1)}function At(t,s){t.min=t.min+s,t.max=t.max+s}function ir(t,s,a,n,r=.5){const o=ce(t.min,t.max,r);Fa(t,s,a,o,n)}function Dt(t,s){ir(t.x,s.x,s.scaleX,s.scale,s.originX),ir(t.y,s.y,s.scaleY,s.scale,s.originY)}function jo(t,s){return go(Ru(t.getBoundingClientRect(),s))}function Fu(t,s,a){const n=jo(t,a),{scroll:r}=s;return r&&(At(n.x,r.offset.x),At(n.y,r.offset.y)),n}const Vu={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},$u=$t.length;function Uu(t,s,a){let n="",r=!0;for(let o=0;o<$u;o++){const i=$t[o],l=t[i];if(l===void 0)continue;let c=!0;if(typeof l=="number")c=l===(i.startsWith("scale")?1:0);else{const m=parseFloat(l);c=i.startsWith("scale")?m===1:m===0}if(!c||a){const m=io(l,mn[i]);if(!c){r=!1;const d=Vu[i]||i;n+=`${d}(${m}) `}a&&(s[i]=m)}}return n=n.trim(),a?n=a(s,r?"":n):r&&(n="none"),n}function gn(t,s,a){const{style:n,vars:r,transformOrigin:o}=t;let i=!1,l=!1;for(const c in s){const m=s[c];if(Ut.has(c)){i=!0;continue}else if(Ei(c)){r[c]=m;continue}else{const d=io(m,mn[c]);c.startsWith("origin")?(l=!0,o[c]=d):n[c]=d}}if(s.transform||(i||a?n.transform=Uu(s,t.transform,a):n.transform&&(n.transform="none")),l){const{originX:c="50%",originY:m="50%",originZ:d=0}=o;n.transformOrigin=`${c} ${m} ${d}`}}function vo(t,{style:s,vars:a},n,r){const o=t.style;let i;for(i in s)o[i]=s[i];r?.applyProjectionStyles(o,n);for(i in a)o.setProperty(i,a[i])}function or(t,s){return s.max===s.min?0:t/(s.max-s.min)*100}const _t={correct:(t,s)=>{if(!s.target)return t;if(typeof t=="string")if(V.test(t))t=parseFloat(t);else return t;const a=or(t,s.target.x),n=or(t,s.target.y);return`${a}% ${n}%`}},Bu={correct:(t,{treeScale:s,projectionDelta:a})=>{const n=t,r=ct.parse(t);if(r.length>5)return n;const o=ct.createTransformer(t),i=typeof r[0]!="number"?1:0,l=a.x.scale*s.x,c=a.y.scale*s.y;r[0+i]/=l,r[1+i]/=c;const m=ce(l,c,.5);return typeof r[2+i]=="number"&&(r[2+i]/=m),typeof r[3+i]=="number"&&(r[3+i]/=m),o(r)}},Va={borderRadius:{..._t,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:_t,borderTopRightRadius:_t,borderBottomLeftRadius:_t,borderBottomRightRadius:_t,boxShadow:Bu};function No(t,{layout:s,layoutId:a}){return Ut.has(t)||t.startsWith("origin")||(s||a!==void 0)&&(!!Va[t]||t==="opacity")}function yn(t,s,a){const n=t.style,r=s?.style,o={};if(!n)return o;for(const i in n)(Se(n[i])||r&&Se(r[i])||No(i,t)||a?.getValue(i)?.liveStyle!==void 0)&&(o[i]=n[i]);return o}function qu(t){return window.getComputedStyle(t)}class zu extends fo{constructor(){super(...arguments),this.type="html",this.renderInstance=vo}readValueFromInstance(s,a){if(Ut.has(a))return this.projection?.isProjecting?ka(a):bd(s,a);{const n=qu(s),r=(Ei(a)?n.getPropertyValue(a):n[a])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(s,{transformPagePoint:a}){return jo(s,a)}build(s,a,n){gn(s,a,n.transformTemplate)}scrapeMotionValuesFromProps(s,a,n){return yn(s,a,n)}}const Wu={offset:"stroke-dashoffset",array:"stroke-dasharray"},_u={offset:"strokeDashoffset",array:"strokeDasharray"};function Ku(t,s,a=1,n=0,r=!0){t.pathLength=1;const o=r?Wu:_u;t[o.offset]=`${-n}`,t[o.array]=`${s} ${a}`}const Hu=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function wo(t,{attrX:s,attrY:a,attrScale:n,pathLength:r,pathSpacing:o=1,pathOffset:i=0,...l},c,m,d){if(gn(t,l,m),c){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:u}=t;h.transform&&(u.transform=h.transform,delete h.transform),(u.transform||h.transformOrigin)&&(u.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),u.transform&&(u.transformBox=d?.transformBox??"fill-box",delete h.transformBox);for(const b of Hu)h[b]!==void 0&&(u[b]=h[b],delete h[b]);s!==void 0&&(h.x=s),a!==void 0&&(h.y=a),n!==void 0&&(h.scale=n),r!==void 0&&Ku(h,r,o,i,!1)}const So=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),ko=t=>typeof t=="string"&&t.toLowerCase()==="svg";function Gu(t,s,a,n){vo(t,s,void 0,n);for(const r in s.attrs)t.setAttribute(So.has(r)?r:un(r),s.attrs[r])}function Po(t,s,a){const n=yn(t,s,a);for(const r in t)if(Se(t[r])||Se(s[r])){const o=$t.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;n[o]=t[r]}return n}class Ju extends fo{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ye}getBaseTargetFromProps(s,a){return s[a]}readValueFromInstance(s,a){if(Ut.has(a)){const n=ao(a);return n&&n.default||0}return a=So.has(a)?a:un(a),s.getAttribute(a)}scrapeMotionValuesFromProps(s,a,n){return Po(s,a,n)}build(s,a,n){wo(s,a,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(s,a,n,r){Gu(s,a,n,r)}mount(s){this.isSVGTag=ko(s.tagName),super.mount(s)}}const Yu=fn.length;function Co(t){if(!t)return;if(!t.isControllingVariants){const a=t.parent?Co(t.parent)||{}:{};return t.props.initial!==void 0&&(a.initial=t.props.initial),a}const s={};for(let a=0;a<Yu;a++){const n=fn[a],r=t.props[n];(is(r)||r===!1)&&(s[n]=r)}return s}function To(t,s){if(!Array.isArray(s))return!1;const a=s.length;if(a!==t.length)return!1;for(let n=0;n<a;n++)if(s[n]!==t[n])return!1;return!0}const Xu=[...pn].reverse(),Zu=pn.length;function Qu(t){return s=>Promise.all(s.map(({animation:a,options:n})=>lu(t,a,n)))}function em(t){let s=Qu(t),a=lr(),n=!0;const r=c=>(m,d)=>{const h=Et(t,d,c==="exit"?t.presenceContext?.custom:void 0);if(h){const{transition:u,transitionEnd:b,...p}=h;m={...m,...p,...b}}return m};function o(c){s=c(t)}function i(c){const{props:m}=t,d=Co(t.parent)||{},h=[],u=new Set;let b={},p=1/0;for(let j=0;j<Zu;j++){const v=Xu[j],g=a[v],f=m[v]!==void 0?m[v]:d[v],k=is(f),I=v===c?g.isActive:null;I===!1&&(p=j);let O=f===d[v]&&f!==m[v]&&k;if(O&&n&&t.manuallyAnimateOnMount&&(O=!1),g.protectedKeys={...b},!g.isActive&&I===null||!f&&!g.prevProp||Ws(f)||typeof f=="boolean")continue;const F=tm(g.prevProp,f);let C=F||v===c&&g.isActive&&!O&&k||j>p&&k,B=!1;const E=Array.isArray(f)?f:[f];let D=E.reduce(r(v),{});I===!1&&(D={});const{prevResolvedValues:$={}}=g,G={...$,...D},me=se=>{C=!0,u.has(se)&&(B=!0,u.delete(se)),g.needsAnimating[se]=!0;const re=t.getValue(se);re&&(re.liveStyle=!1)};for(const se in G){const re=D[se],te=$[se];if(b.hasOwnProperty(se))continue;let he=!1;Ia(re)&&Ia(te)?he=!To(re,te):he=re!==te,he?re!=null?me(se):u.add(se):re!==void 0&&u.has(se)?me(se):g.protectedKeys[se]=!0}g.prevProp=f,g.prevResolvedValues=D,g.isActive&&(b={...b,...D}),n&&t.blockInitialAnimation&&(C=!1);const fe=O&&F;C&&(!fe||B)&&h.push(...E.map(se=>{const re={type:v};if(typeof se=="string"&&n&&!fe&&t.manuallyAnimateOnMount&&t.parent){const{parent:te}=t,he=Et(te,se);if(te.enteringChildren&&he){const{delayChildren:P}=he.transition||{};re.delay=Ji(te.enteringChildren,t,P)}}return{animation:se,options:re}}))}if(u.size){const j={};if(typeof m.initial!="boolean"){const v=Et(t,Array.isArray(m.initial)?m.initial[0]:m.initial);v&&v.transition&&(j.transition=v.transition)}u.forEach(v=>{const g=t.getBaseTarget(v),f=t.getValue(v);f&&(f.liveStyle=!0),j[v]=g??null}),h.push({animation:j})}let y=!!h.length;return n&&(m.initial===!1||m.initial===m.animate)&&!t.manuallyAnimateOnMount&&(y=!1),n=!1,y?s(h):Promise.resolve()}function l(c,m){if(a[c].isActive===m)return Promise.resolve();t.variantChildren?.forEach(h=>h.animationState?.setActive(c,m)),a[c].isActive=m;const d=i(c);for(const h in a)a[h].protectedKeys={};return d}return{animateChanges:i,setActive:l,setAnimateFunction:o,getState:()=>a,reset:()=>{a=lr()}}}function tm(t,s){return typeof s=="string"?s!==t:Array.isArray(s)?!To(s,t):!1}function pt(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function lr(){return{animate:pt(!0),whileInView:pt(),whileHover:pt(),whileTap:pt(),whileDrag:pt(),whileFocus:pt(),exit:pt()}}function cr(t,s){t.min=s.min,t.max=s.max}function Ue(t,s){cr(t.x,s.x),cr(t.y,s.y)}function dr(t,s){t.translate=s.translate,t.scale=s.scale,t.originPoint=s.originPoint,t.origin=s.origin}const Ao=1e-4,sm=1-Ao,am=1+Ao,Do=.01,nm=0-Do,rm=0+Do;function Ce(t){return t.max-t.min}function im(t,s,a){return Math.abs(t-s)<=a}function ur(t,s,a,n=.5){t.origin=n,t.originPoint=ce(s.min,s.max,t.origin),t.scale=Ce(a)/Ce(s),t.translate=ce(a.min,a.max,t.origin)-t.originPoint,(t.scale>=sm&&t.scale<=am||isNaN(t.scale))&&(t.scale=1),(t.translate>=nm&&t.translate<=rm||isNaN(t.translate))&&(t.translate=0)}function es(t,s,a,n){ur(t.x,s.x,a.x,n?n.originX:void 0),ur(t.y,s.y,a.y,n?n.originY:void 0)}function mr(t,s,a){t.min=a.min+s.min,t.max=t.min+Ce(s)}function om(t,s,a){mr(t.x,s.x,a.x),mr(t.y,s.y,a.y)}function hr(t,s,a){t.min=s.min-a.min,t.max=t.min+Ce(s)}function Bs(t,s,a){hr(t.x,s.x,a.x),hr(t.y,s.y,a.y)}function xr(t,s,a,n,r){return t-=s,t=Us(t,1/a,n),r!==void 0&&(t=Us(t,1/r,n)),t}function lm(t,s=0,a=1,n=.5,r,o=t,i=t){if(We.test(s)&&(s=parseFloat(s),s=ce(i.min,i.max,s/100)-i.min),typeof s!="number")return;let l=ce(o.min,o.max,n);t===o&&(l-=s),t.min=xr(t.min,s,a,l,r),t.max=xr(t.max,s,a,l,r)}function pr(t,s,[a,n,r],o,i){lm(t,s[a],s[n],s[r],s.scale,o,i)}const cm=["x","scaleX","originX"],dm=["y","scaleY","originY"];function fr(t,s,a,n){pr(t.x,s,cm,a?a.x:void 0,n?n.x:void 0),pr(t.y,s,dm,a?a.y:void 0,n?n.y:void 0)}function gr(t){return t.translate===0&&t.scale===1}function Io(t){return gr(t.x)&&gr(t.y)}function yr(t,s){return t.min===s.min&&t.max===s.max}function um(t,s){return yr(t.x,s.x)&&yr(t.y,s.y)}function br(t,s){return Math.round(t.min)===Math.round(s.min)&&Math.round(t.max)===Math.round(s.max)}function Eo(t,s){return br(t.x,s.x)&&br(t.y,s.y)}function jr(t){return Ce(t.x)/Ce(t.y)}function vr(t,s){return t.translate===s.translate&&t.scale===s.scale&&t.originPoint===s.originPoint}function Le(t){return[t("x"),t("y")]}function mm(t,s,a){let n="";const r=t.x.translate/s.x,o=t.y.translate/s.y,i=a?.z||0;if((r||o||i)&&(n=`translate3d(${r}px, ${o}px, ${i}px) `),(s.x!==1||s.y!==1)&&(n+=`scale(${1/s.x}, ${1/s.y}) `),a){const{transformPerspective:m,rotate:d,rotateX:h,rotateY:u,skewX:b,skewY:p}=a;m&&(n=`perspective(${m}px) ${n}`),d&&(n+=`rotate(${d}deg) `),h&&(n+=`rotateX(${h}deg) `),u&&(n+=`rotateY(${u}deg) `),b&&(n+=`skewX(${b}deg) `),p&&(n+=`skewY(${p}deg) `)}const l=t.x.scale*s.x,c=t.y.scale*s.y;return(l!==1||c!==1)&&(n+=`scale(${l}, ${c})`),n||"none"}const Lo=["TopLeft","TopRight","BottomLeft","BottomRight"],hm=Lo.length,Nr=t=>typeof t=="string"?parseFloat(t):t,wr=t=>typeof t=="number"||V.test(t);function xm(t,s,a,n,r,o){r?(t.opacity=ce(0,a.opacity??1,pm(n)),t.opacityExit=ce(s.opacity??1,0,fm(n))):o&&(t.opacity=ce(s.opacity??1,a.opacity??1,n));for(let i=0;i<hm;i++){const l=`border${Lo[i]}Radius`;let c=Sr(s,l),m=Sr(a,l);if(c===void 0&&m===void 0)continue;c||(c=0),m||(m=0),c===0||m===0||wr(c)===wr(m)?(t[l]=Math.max(ce(Nr(c),Nr(m),n),0),(We.test(m)||We.test(c))&&(t[l]+="%")):t[l]=m}(s.rotate||a.rotate)&&(t.rotate=ce(s.rotate||0,a.rotate||0,n))}function Sr(t,s){return t[s]!==void 0?t[s]:t.borderRadius}const pm=Mo(0,.5,Pi),fm=Mo(.5,.95,Oe);function Mo(t,s,a){return n=>n<t?0:n>s?1:a(as(t,s,n))}function gm(t,s,a){const n=Se(t)?t:Ft(t);return n.start(cn("",n,s,a)),n.animation}function os(t,s,a,n={passive:!0}){return t.addEventListener(s,a,n),()=>t.removeEventListener(s,a)}const ym=(t,s)=>t.depth-s.depth;class bm{constructor(){this.children=[],this.isDirty=!1}add(s){_a(this.children,s),this.isDirty=!0}remove(s){Ka(this.children,s),this.isDirty=!0}forEach(s){this.isDirty&&this.children.sort(ym),this.isDirty=!1,this.children.forEach(s)}}function jm(t,s){const a=Pe.now(),n=({timestamp:r})=>{const o=r-a;o>=s&&(lt(n),t(o-s))};return ie.setup(n,!0),()=>lt(n)}function As(t){return Se(t)?t.get():t}class vm{constructor(){this.members=[]}add(s){_a(this.members,s),s.scheduleRender()}remove(s){if(Ka(this.members,s),s===this.prevLead&&(this.prevLead=void 0),s===this.lead){const a=this.members[this.members.length-1];a&&this.promote(a)}}relegate(s){const a=this.members.findIndex(r=>s===r);if(a===0)return!1;let n;for(let r=a;r>=0;r--){const o=this.members[r];if(o.isPresent!==!1){n=o;break}}return n?(this.promote(n),!0):!1}promote(s,a){const n=this.lead;if(s!==n&&(this.prevLead=n,this.lead=s,s.show(),n)){n.instance&&n.scheduleRender(),s.scheduleRender();const r=n.options.layoutDependency,o=s.options.layoutDependency;r!==void 0&&o!==void 0&&r===o||(s.resumeFrom=n,a&&(s.resumeFrom.preserveOpacity=!0),n.snapshot&&(s.snapshot=n.snapshot,s.snapshot.latestValues=n.animationValues||n.latestValues),s.root&&s.root.isUpdating&&(s.isLayoutDirty=!0));const{crossfade:l}=s.options;l===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(s=>{const{options:a,resumingFrom:n}=s;a.onExitComplete&&a.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(s=>{s.instance&&s.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Ds={hasAnimatedSinceResize:!0,hasEverUpdated:!1},ia=["","X","Y","Z"],Nm=1e3;let wm=0;function oa(t,s,a,n){const{latestValues:r}=s;r[t]&&(a[t]=r[t],s.setStaticValue(t,0),n&&(n[t]=0))}function Ro(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:s}=t.options;if(!s)return;const a=Qi(s);if(window.MotionHasOptimisedAnimation(a,"transform")){const{layout:r,layoutId:o}=t.options;window.MotionCancelOptimisedAnimation(a,"transform",ie,!(r||o))}const{parent:n}=t;n&&!n.hasCheckedOptimisedAppear&&Ro(n)}function Oo({attachResizeListener:t,defaultParent:s,measureScroll:a,checkIsScrollRoot:n,resetTransform:r}){return class{constructor(i={},l=s?.()){this.id=wm++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Pm),this.nodes.forEach(Dm),this.nodes.forEach(Im),this.nodes.forEach(Cm)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=i,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new bm)}addEventListener(i,l){return this.eventHandlers.has(i)||this.eventHandlers.set(i,new Ja),this.eventHandlers.get(i).add(l)}notifyListeners(i,...l){const c=this.eventHandlers.get(i);c&&c.notify(...l)}hasListeners(i){return this.eventHandlers.has(i)}mount(i){if(this.instance)return;this.isSVG=mo(i)&&!ku(i),this.instance=i;const{layoutId:l,layout:c,visualElement:m}=this.options;if(m&&!m.current&&m.mount(i),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),t){let d,h=0;const u=()=>this.root.updateBlockedByResize=!1;ie.read(()=>{h=window.innerWidth}),t(i,()=>{const b=window.innerWidth;b!==h&&(h=b,this.root.updateBlockedByResize=!0,d&&d(),d=jm(u,250),Ds.hasAnimatedSinceResize&&(Ds.hasAnimatedSinceResize=!1,this.nodes.forEach(Cr)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&m&&(l||c)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:h,hasRelativeLayoutChanged:u,layout:b})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const p=this.options.transition||m.getDefaultTransition()||Om,{onLayoutAnimationStart:y,onLayoutAnimationComplete:j}=m.getProps(),v=!this.targetLayout||!Eo(this.targetLayout,b),g=!h&&u;if(this.options.layoutRoot||this.resumeFrom||g||h&&(v||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const f={...ln(p,"layout"),onPlay:y,onComplete:j};(m.shouldReduceMotion||this.options.layoutRoot)&&(f.delay=0,f.type=!1),this.startAnimation(f),this.setAnimationOrigin(d,g)}else h||Cr(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=b})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const i=this.getStack();i&&i.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),lt(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Em),this.animationId++)}getTransformTemplate(){const{visualElement:i}=this.options;return i&&i.getProps().transformTemplate}willUpdate(i=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Ro(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const h=this.path[d];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const m=this.getTransformTemplate();this.prevTransformTemplateValue=m?m(this.latestValues,""):void 0,this.updateSnapshot(),i&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(kr);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Pr);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Am),this.nodes.forEach(Sm),this.nodes.forEach(km)):this.nodes.forEach(Pr),this.clearAllSnapshots();const l=Pe.now();ve.delta=Ke(0,1e3/60,l-ve.timestamp),ve.timestamp=l,ve.isProcessing=!0,Zs.update.process(ve),Zs.preRender.process(ve),Zs.render.process(ve),ve.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,hn.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Tm),this.sharedNodes.forEach(Lm)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ie.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ie.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Ce(this.snapshot.measuredBox.x)&&!Ce(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const i=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=ye(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,i?i.layoutBox:void 0)}updateScroll(i="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===i&&(l=!1),l&&this.instance){const c=n(this.instance);this.scroll={animationId:this.root.animationId,phase:i,isRoot:c,offset:a(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!r)return;const i=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!Io(this.projectionDelta),c=this.getTransformTemplate(),m=c?c(this.latestValues,""):void 0,d=m!==this.prevTransformTemplateValue;i&&this.instance&&(l||ft(this.latestValues)||d)&&(r(this.instance,m),this.shouldResetTransform=!1,this.scheduleRender())}measure(i=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return i&&(c=this.removeTransform(c)),Fm(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:i}=this.options;if(!i)return ye();const l=i.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(Vm))){const{scroll:m}=this.root;m&&(At(l.x,m.offset.x),At(l.y,m.offset.y))}return l}removeElementScroll(i){const l=ye();if(Ue(l,i),this.scroll?.wasRoot)return l;for(let c=0;c<this.path.length;c++){const m=this.path[c],{scroll:d,options:h}=m;m!==this.root&&d&&h.layoutScroll&&(d.wasRoot&&Ue(l,i),At(l.x,d.offset.x),At(l.y,d.offset.y))}return l}applyTransform(i,l=!1){const c=ye();Ue(c,i);for(let m=0;m<this.path.length;m++){const d=this.path[m];!l&&d.options.layoutScroll&&d.scroll&&d!==d.root&&Dt(c,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),ft(d.latestValues)&&Dt(c,d.latestValues)}return ft(this.latestValues)&&Dt(c,this.latestValues),c}removeTransform(i){const l=ye();Ue(l,i);for(let c=0;c<this.path.length;c++){const m=this.path[c];if(!m.instance||!ft(m.latestValues))continue;Oa(m.latestValues)&&m.updateSnapshot();const d=ye(),h=m.measurePageBox();Ue(d,h),fr(l,m.latestValues,m.snapshot?m.snapshot.layoutBox:void 0,d)}return ft(this.latestValues)&&fr(l,this.latestValues),l}setTargetDelta(i){this.targetDelta=i,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(i){this.options={...this.options,...i,crossfade:i.crossfade!==void 0?i.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ve.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(i=!1){const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(i||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:h}=this.options;if(!this.layout||!(d||h))return;this.resolvedRelativeTargetAt=ve.timestamp;const u=this.getClosestProjectingParent();u&&this.linkedParentVersion!==u.layoutVersion&&!u.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(u&&u.layout?this.createRelativeTarget(u,this.layout.layoutBox,u.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ye(),this.targetWithTransforms=ye()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),om(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ue(this.target,this.layout.layoutBox),bo(this.target,this.targetDelta)):Ue(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,u&&!!u.resumingFrom==!!this.resumingFrom&&!u.options.layoutScroll&&u.target&&this.animationProgress!==1?this.createRelativeTarget(u,this.target,u.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||Oa(this.parent.latestValues)||yo(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(i,l,c){this.relativeParent=i,this.linkedParentVersion=i.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ye(),this.relativeTargetOrigin=ye(),Bs(this.relativeTargetOrigin,l,c),Ue(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const i=this.getLead(),l=!!this.resumingFrom||this!==i;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===ve.timestamp&&(c=!1),c)return;const{layout:m,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(m||d))return;Ue(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,u=this.treeScale.y;Ou(this.layoutCorrected,this.treeScale,this.path,l),i.layout&&!i.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(i.target=i.layout.layoutBox,i.targetWithTransforms=ye());const{target:b}=i;if(!b){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(dr(this.prevProjectionDelta.x,this.projectionDelta.x),dr(this.prevProjectionDelta.y,this.projectionDelta.y)),es(this.projectionDelta,this.layoutCorrected,b,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==u||!vr(this.projectionDelta.x,this.prevProjectionDelta.x)||!vr(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",b))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(i=!0){if(this.options.visualElement?.scheduleRender(),i){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Tt(),this.projectionDelta=Tt(),this.projectionDeltaWithTransform=Tt()}setAnimationOrigin(i,l=!1){const c=this.snapshot,m=c?c.latestValues:{},d={...this.latestValues},h=Tt();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const u=ye(),b=c?c.source:void 0,p=this.layout?this.layout.source:void 0,y=b!==p,j=this.getStack(),v=!j||j.members.length<=1,g=!!(y&&!v&&this.options.crossfade===!0&&!this.path.some(Rm));this.animationProgress=0;let f;this.mixTargetDelta=k=>{const I=k/1e3;Tr(h.x,i.x,I),Tr(h.y,i.y,I),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Bs(u,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Mm(this.relativeTarget,this.relativeTargetOrigin,u,I),f&&um(this.relativeTarget,f)&&(this.isProjectionDirty=!1),f||(f=ye()),Ue(f,this.relativeTarget)),y&&(this.animationValues=d,xm(d,m,this.latestValues,I,g,v)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=I},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(i){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(lt(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ie.update(()=>{Ds.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Ft(0)),this.currentAnimation=gm(this.motionValue,[0,1e3],{...i,velocity:0,isSync:!0,onUpdate:l=>{this.mixTargetDelta(l),i.onUpdate&&i.onUpdate(l)},onStop:()=>{},onComplete:()=>{i.onComplete&&i.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const i=this.getStack();i&&i.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Nm),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const i=this.getLead();let{targetWithTransforms:l,target:c,layout:m,latestValues:d}=i;if(!(!l||!c||!m)){if(this!==i&&this.layout&&m&&Fo(this.options.animationType,this.layout.layoutBox,m.layoutBox)){c=this.target||ye();const h=Ce(this.layout.layoutBox.x);c.x.min=i.target.x.min,c.x.max=c.x.min+h;const u=Ce(this.layout.layoutBox.y);c.y.min=i.target.y.min,c.y.max=c.y.min+u}Ue(l,c),Dt(l,d),es(this.projectionDeltaWithTransform,this.layoutCorrected,l,d)}}registerSharedNode(i,l){this.sharedNodes.has(i)||this.sharedNodes.set(i,new vm),this.sharedNodes.get(i).add(l);const m=l.options.initialPromotionConfig;l.promote({transition:m?m.transition:void 0,preserveFollowOpacity:m&&m.shouldPreserveFollowOpacity?m.shouldPreserveFollowOpacity(l):void 0})}isLead(){const i=this.getStack();return i?i.lead===this:!0}getLead(){const{layoutId:i}=this.options;return i?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:i}=this.options;return i?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:i}=this.options;if(i)return this.root.sharedNodes.get(i)}promote({needsReset:i,transition:l,preserveFollowOpacity:c}={}){const m=this.getStack();m&&m.promote(this,c),i&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const i=this.getStack();return i?i.relegate(this):!1}resetSkewAndRotation(){const{visualElement:i}=this.options;if(!i)return;let l=!1;const{latestValues:c}=i;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const m={};c.z&&oa("z",i,m,this.animationValues);for(let d=0;d<ia.length;d++)oa(`rotate${ia[d]}`,i,m,this.animationValues),oa(`skew${ia[d]}`,i,m,this.animationValues);i.render();for(const d in m)i.setStaticValue(d,m[d]),this.animationValues&&(this.animationValues[d]=m[d]);i.scheduleRender()}applyProjectionStyles(i,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){i.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,i.visibility="",i.opacity="",i.pointerEvents=As(l?.pointerEvents)||"",i.transform=c?c(this.latestValues,""):"none";return}const m=this.getLead();if(!this.projectionDelta||!this.layout||!m.target){this.options.layoutId&&(i.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,i.pointerEvents=As(l?.pointerEvents)||""),this.hasProjected&&!ft(this.latestValues)&&(i.transform=c?c({},""):"none",this.hasProjected=!1);return}i.visibility="";const d=m.animationValues||m.latestValues;this.applyTransformsToTarget();let h=mm(this.projectionDeltaWithTransform,this.treeScale,d);c&&(h=c(d,h)),i.transform=h;const{x:u,y:b}=this.projectionDelta;i.transformOrigin=`${u.origin*100}% ${b.origin*100}% 0`,m.animationValues?i.opacity=m===this?d.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:i.opacity=m===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const p in Va){if(d[p]===void 0)continue;const{correct:y,applyTo:j,isCSSVariable:v}=Va[p],g=h==="none"?d[p]:y(d[p],m);if(j){const f=j.length;for(let k=0;k<f;k++)i[j[k]]=g}else v?this.options.visualElement.renderState.vars[p]=g:i[p]=g}this.options.layoutId&&(i.pointerEvents=m===this?As(l?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(i=>i.currentAnimation?.stop()),this.root.nodes.forEach(kr),this.root.sharedNodes.clear()}}}function Sm(t){t.updateLayout()}function km(t){const s=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&s&&t.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:n}=t.layout,{animationType:r}=t.options,o=s.source!==t.layout.source;r==="size"?Le(d=>{const h=o?s.measuredBox[d]:s.layoutBox[d],u=Ce(h);h.min=a[d].min,h.max=h.min+u}):Fo(r,s.layoutBox,a)&&Le(d=>{const h=o?s.measuredBox[d]:s.layoutBox[d],u=Ce(a[d]);h.max=h.min+u,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[d].max=t.relativeTarget[d].min+u)});const i=Tt();es(i,a,s.layoutBox);const l=Tt();o?es(l,t.applyTransform(n,!0),s.measuredBox):es(l,a,s.layoutBox);const c=!Io(i);let m=!1;if(!t.resumeFrom){const d=t.getClosestProjectingParent();if(d&&!d.resumeFrom){const{snapshot:h,layout:u}=d;if(h&&u){const b=ye();Bs(b,s.layoutBox,h.layoutBox);const p=ye();Bs(p,a,u.layoutBox),Eo(b,p)||(m=!0),d.options.layoutRoot&&(t.relativeTarget=p,t.relativeTargetOrigin=b,t.relativeParent=d)}}}t.notifyListeners("didUpdate",{layout:a,snapshot:s,delta:l,layoutDelta:i,hasLayoutChanged:c,hasRelativeLayoutChanged:m})}else if(t.isLead()){const{onExitComplete:a}=t.options;a&&a()}t.options.transition=void 0}function Pm(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function Cm(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function Tm(t){t.clearSnapshot()}function kr(t){t.clearMeasurements()}function Pr(t){t.isLayoutDirty=!1}function Am(t){const{visualElement:s}=t.options;s&&s.getProps().onBeforeLayoutMeasure&&s.notify("BeforeLayoutMeasure"),t.resetTransform()}function Cr(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function Dm(t){t.resolveTargetDelta()}function Im(t){t.calcProjection()}function Em(t){t.resetSkewAndRotation()}function Lm(t){t.removeLeadSnapshot()}function Tr(t,s,a){t.translate=ce(s.translate,0,a),t.scale=ce(s.scale,1,a),t.origin=s.origin,t.originPoint=s.originPoint}function Ar(t,s,a,n){t.min=ce(s.min,a.min,n),t.max=ce(s.max,a.max,n)}function Mm(t,s,a,n){Ar(t.x,s.x,a.x,n),Ar(t.y,s.y,a.y,n)}function Rm(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const Om={duration:.45,ease:[.4,0,.1,1]},Dr=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),Ir=Dr("applewebkit/")&&!Dr("chrome/")?Math.round:Oe;function Er(t){t.min=Ir(t.min),t.max=Ir(t.max)}function Fm(t){Er(t.x),Er(t.y)}function Fo(t,s,a){return t==="position"||t==="preserve-aspect"&&!im(jr(s),jr(a),.2)}function Vm(t){return t!==t.root&&t.scroll?.wasRoot}const $m=Oo({attachResizeListener:(t,s)=>os(t,"resize",s),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body?.scrollLeft||0,y:document.documentElement.scrollTop||document.body?.scrollTop||0}),checkIsScrollRoot:()=>!0}),la={current:void 0},Vo=Oo({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!la.current){const t=new $m({});t.mount(window),t.setOptions({layoutScroll:!0}),la.current=t}return la.current},resetTransform:(t,s)=>{t.style.transform=s!==void 0?s:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),$o=x.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function Um(t=!0){const s=x.useContext(Wa);if(s===null)return[!0,null];const{isPresent:a,onExitComplete:n,register:r}=s,o=x.useId();x.useEffect(()=>{if(t)return r(o)},[t]);const i=x.useCallback(()=>t&&n&&n(o),[o,n,t]);return!a&&n?[!1,i]:[!0]}const Uo=x.createContext({strict:!1}),Lr={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let Mr=!1;function Bm(){if(Mr)return;const t={};for(const s in Lr)t[s]={isEnabled:a=>Lr[s].some(n=>!!a[n])};po(t),Mr=!0}function Bo(){return Bm(),Eu()}function qm(t){const s=Bo();for(const a in t)s[a]={...s[a],...t[a]};po(s)}const zm=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function qs(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||zm.has(t)}let qo=t=>!qs(t);function Wm(t){typeof t=="function"&&(qo=s=>s.startsWith("on")?!qs(s):t(s))}try{Wm(require("@emotion/is-prop-valid").default)}catch{}function _m(t,s,a){const n={};for(const r in t)r==="values"&&typeof t.values=="object"||(qo(r)||a===!0&&qs(r)||!s&&!qs(r)||t.draggable&&r.startsWith("onDrag"))&&(n[r]=t[r]);return n}const Ks=x.createContext({});function Km(t,s){if(_s(t)){const{initial:a,animate:n}=t;return{initial:a===!1||is(a)?a:void 0,animate:is(n)?n:void 0}}return t.inherit!==!1?s:{}}function Hm(t){const{initial:s,animate:a}=Km(t,x.useContext(Ks));return x.useMemo(()=>({initial:s,animate:a}),[Rr(s),Rr(a)])}function Rr(t){return Array.isArray(t)?t.join(" "):t}const bn=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function zo(t,s,a){for(const n in s)!Se(s[n])&&!No(n,a)&&(t[n]=s[n])}function Gm({transformTemplate:t},s){return x.useMemo(()=>{const a=bn();return gn(a,s,t),Object.assign({},a.vars,a.style)},[s])}function Jm(t,s){const a=t.style||{},n={};return zo(n,a,t),Object.assign(n,Gm(t,s)),n}function Ym(t,s){const a={},n=Jm(t,s);return t.drag&&t.dragListener!==!1&&(a.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(a.tabIndex=0),a.style=n,a}const Wo=()=>({...bn(),attrs:{}});function Xm(t,s,a,n){const r=x.useMemo(()=>{const o=Wo();return wo(o,s,ko(n),t.transformTemplate,t.style),{...o.attrs,style:{...o.style}}},[s]);if(t.style){const o={};zo(o,t.style,t),r.style={...o,...r.style}}return r}const Zm=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function jn(t){return typeof t!="string"||t.includes("-")?!1:!!(Zm.indexOf(t)>-1||/[A-Z]/u.test(t))}function Qm(t,s,a,{latestValues:n},r,o=!1,i){const c=(i??jn(t)?Xm:Ym)(s,n,r,t),m=_m(s,typeof t=="string",o),d=t!==x.Fragment?{...m,...c,ref:a}:{},{children:h}=s,u=x.useMemo(()=>Se(h)?h.get():h,[h]);return x.createElement(t,{...d,children:u})}function eh({scrapeMotionValuesFromProps:t,createRenderState:s},a,n,r){return{latestValues:th(a,n,r,t),renderState:s()}}function th(t,s,a,n){const r={},o=n(t,{});for(const u in o)r[u]=As(o[u]);let{initial:i,animate:l}=t;const c=_s(t),m=xo(t);s&&m&&!c&&t.inherit!==!1&&(i===void 0&&(i=s.initial),l===void 0&&(l=s.animate));let d=a?a.initial===!1:!1;d=d||i===!1;const h=d?l:i;if(h&&typeof h!="boolean"&&!Ws(h)){const u=Array.isArray(h)?h:[h];for(let b=0;b<u.length;b++){const p=dn(t,u[b]);if(p){const{transitionEnd:y,transition:j,...v}=p;for(const g in v){let f=v[g];if(Array.isArray(f)){const k=d?f.length-1:0;f=f[k]}f!==null&&(r[g]=f)}for(const g in y)r[g]=y[g]}}}return r}const _o=t=>(s,a)=>{const n=x.useContext(Ks),r=x.useContext(Wa),o=()=>eh(t,s,n,r);return a?o():pc(o)},sh=_o({scrapeMotionValuesFromProps:yn,createRenderState:bn}),ah=_o({scrapeMotionValuesFromProps:Po,createRenderState:Wo}),nh=Symbol.for("motionComponentSymbol");function rh(t,s,a){const n=x.useRef(a);x.useInsertionEffect(()=>{n.current=a});const r=x.useRef(null);return x.useCallback(o=>{o&&t.onMount?.(o),s&&(o?s.mount(o):s.unmount());const i=n.current;if(typeof i=="function")if(o){const l=i(o);typeof l=="function"&&(r.current=l)}else r.current?(r.current(),r.current=null):i(o);else i&&(i.current=o)},[s])}const Ko=x.createContext({});function Jt(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function ih(t,s,a,n,r,o){const{visualElement:i}=x.useContext(Ks),l=x.useContext(Uo),c=x.useContext(Wa),m=x.useContext($o).reducedMotion,d=x.useRef(null),h=x.useRef(!1);n=n||l.renderer,!d.current&&n&&(d.current=n(t,{visualState:s,parent:i,props:a,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:m,isSVG:o}),h.current&&d.current&&(d.current.manuallyAnimateOnMount=!0));const u=d.current,b=x.useContext(Ko);u&&!u.projection&&r&&(u.type==="html"||u.type==="svg")&&oh(d.current,a,r,b);const p=x.useRef(!1);x.useInsertionEffect(()=>{u&&p.current&&u.update(a,c)});const y=a[Zi],j=x.useRef(!!y&&!window.MotionHandoffIsComplete?.(y)&&window.MotionHasOptimisedAnimation?.(y));return fc(()=>{h.current=!0,u&&(p.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),j.current&&u.animationState&&u.animationState.animateChanges())}),x.useEffect(()=>{u&&(!j.current&&u.animationState&&u.animationState.animateChanges(),j.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(y)}),j.current=!1),u.enteringChildren=void 0)}),u}function oh(t,s,a,n){const{layoutId:r,layout:o,drag:i,dragConstraints:l,layoutScroll:c,layoutRoot:m,layoutCrossfade:d}=s;t.projection=new a(t.latestValues,s["data-framer-portal-id"]?void 0:Ho(t.parent)),t.projection.setOptions({layoutId:r,layout:o,alwaysMeasureLayout:!!i||l&&Jt(l),visualElement:t,animationType:typeof o=="string"?o:"both",initialPromotionConfig:n,crossfade:d,layoutScroll:c,layoutRoot:m})}function Ho(t){if(t)return t.options.allowProjection!==!1?t.projection:Ho(t.parent)}function ca(t,{forwardMotionProps:s=!1,type:a}={},n,r){n&&qm(n);const o=a?a==="svg":jn(t),i=o?ah:sh;function l(m,d){let h;const u={...x.useContext($o),...m,layoutId:lh(m)},{isStatic:b}=u,p=Hm(m),y=i(m,b);if(!b&&pi){ch();const j=dh(u);h=j.MeasureLayout,p.visualElement=ih(t,y,u,r,j.ProjectionNode,o)}return e.jsxs(Ks.Provider,{value:p,children:[h&&p.visualElement?e.jsx(h,{visualElement:p.visualElement,...u}):null,Qm(t,m,rh(y,p.visualElement,d),y,b,s,o)]})}l.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const c=x.forwardRef(l);return c[nh]=t,c}function lh({layoutId:t}){const s=x.useContext(xi).id;return s&&t!==void 0?s+"-"+t:t}function ch(t,s){x.useContext(Uo).strict}function dh(t){const s=Bo(),{drag:a,layout:n}=s;if(!a&&!n)return{};const r={...a,...n};return{MeasureLayout:a?.isEnabled(t)||n?.isEnabled(t)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function uh(t,s){if(typeof Proxy>"u")return ca;const a=new Map,n=(o,i)=>ca(o,i,t,s),r=(o,i)=>n(o,i);return new Proxy(r,{get:(o,i)=>i==="create"?n:(a.has(i)||a.set(i,ca(i,void 0,t,s)),a.get(i))})}const mh=(t,s)=>s.isSVG??jn(t)?new Ju(s):new zu(s,{allowProjection:t!==x.Fragment});class hh extends dt{constructor(s){super(s),s.animationState||(s.animationState=em(s))}updateAnimationControlsSubscription(){const{animate:s}=this.node.getProps();Ws(s)&&(this.unmountControls=s.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:s}=this.node.getProps(),{animate:a}=this.node.prevProps||{};s!==a&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let xh=0;class ph extends dt{constructor(){super(...arguments),this.id=xh++}update(){if(!this.node.presenceContext)return;const{isPresent:s,onExitComplete:a}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||s===n)return;const r=this.node.animationState.setActive("exit",!s);a&&!s&&r.then(()=>{a(this.id)})}mount(){const{register:s,onExitComplete:a}=this.node.presenceContext||{};a&&a(this.id),s&&(this.unmount=s(this.id))}unmount(){}}const fh={animation:{Feature:hh},exit:{Feature:ph}};function ms(t){return{point:{x:t.pageX,y:t.pageY}}}const gh=t=>s=>xn(s)&&t(s,ms(s));function ts(t,s,a,n){return os(t,s,gh(a),n)}const Go=({current:t})=>t?t.ownerDocument.defaultView:null,Or=(t,s)=>Math.abs(t-s);function yh(t,s){const a=Or(t.x,s.x),n=Or(t.y,s.y);return Math.sqrt(a**2+n**2)}const Fr=new Set(["auto","scroll"]);class Jo{constructor(s,a,{transformPagePoint:n,contextWindow:r=window,dragSnapToOrigin:o=!1,distanceThreshold:i=3,element:l}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=b=>{this.handleScroll(b.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const b=ua(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,y=yh(b.offset,{x:0,y:0})>=this.distanceThreshold;if(!p&&!y)return;const{point:j}=b,{timestamp:v}=ve;this.history.push({...j,timestamp:v});const{onStart:g,onMove:f}=this.handlers;p||(g&&g(this.lastMoveEvent,b),this.startEvent=this.lastMoveEvent),f&&f(this.lastMoveEvent,b)},this.handlePointerMove=(b,p)=>{this.lastMoveEvent=b,this.lastMoveEventInfo=da(p,this.transformPagePoint),ie.update(this.updatePoint,!0)},this.handlePointerUp=(b,p)=>{this.end();const{onEnd:y,onSessionEnd:j,resumeAnimation:v}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&v&&v(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=ua(b.type==="pointercancel"?this.lastMoveEventInfo:da(p,this.transformPagePoint),this.history);this.startEvent&&y&&y(b,g),j&&j(b,g)},!xn(s))return;this.dragSnapToOrigin=o,this.handlers=a,this.transformPagePoint=n,this.distanceThreshold=i,this.contextWindow=r||window;const c=ms(s),m=da(c,this.transformPagePoint),{point:d}=m,{timestamp:h}=ve;this.history=[{...d,timestamp:h}];const{onSessionStart:u}=a;u&&u(s,ua(m,this.history)),this.removeListeners=cs(ts(this.contextWindow,"pointermove",this.handlePointerMove),ts(this.contextWindow,"pointerup",this.handlePointerUp),ts(this.contextWindow,"pointercancel",this.handlePointerUp)),l&&this.startScrollTracking(l)}startScrollTracking(s){let a=s.parentElement;for(;a;){const n=getComputedStyle(a);(Fr.has(n.overflowX)||Fr.has(n.overflowY))&&this.scrollPositions.set(a,{x:a.scrollLeft,y:a.scrollTop}),a=a.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(s){const a=this.scrollPositions.get(s);if(!a)return;const n=s===window,r=n?{x:window.scrollX,y:window.scrollY}:{x:s.scrollLeft,y:s.scrollTop},o={x:r.x-a.x,y:r.y-a.y};o.x===0&&o.y===0||(n?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=o.x,this.lastMoveEventInfo.point.y+=o.y):this.history.length>0&&(this.history[0].x-=o.x,this.history[0].y-=o.y),this.scrollPositions.set(s,r),ie.update(this.updatePoint,!0))}updateHandlers(s){this.handlers=s}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),lt(this.updatePoint)}}function da(t,s){return s?{point:s(t.point)}:t}function Vr(t,s){return{x:t.x-s.x,y:t.y-s.y}}function ua({point:t},s){return{point:t,delta:Vr(t,Yo(s)),offset:Vr(t,bh(s)),velocity:jh(s,.1)}}function bh(t){return t[0]}function Yo(t){return t[t.length-1]}function jh(t,s){if(t.length<2)return{x:0,y:0};let a=t.length-1,n=null;const r=Yo(t);for(;a>=0&&(n=t[a],!(r.timestamp-n.timestamp>Xe(s)));)a--;if(!n)return{x:0,y:0};const o=Re(r.timestamp-n.timestamp);if(o===0)return{x:0,y:0};const i={x:(r.x-n.x)/o,y:(r.y-n.y)/o};return i.x===1/0&&(i.x=0),i.y===1/0&&(i.y=0),i}function vh(t,{min:s,max:a},n){return s!==void 0&&t<s?t=n?ce(s,t,n.min):Math.max(t,s):a!==void 0&&t>a&&(t=n?ce(a,t,n.max):Math.min(t,a)),t}function $r(t,s,a){return{min:s!==void 0?t.min+s:void 0,max:a!==void 0?t.max+a-(t.max-t.min):void 0}}function Nh(t,{top:s,left:a,bottom:n,right:r}){return{x:$r(t.x,a,r),y:$r(t.y,s,n)}}function Ur(t,s){let a=s.min-t.min,n=s.max-t.max;return s.max-s.min<t.max-t.min&&([a,n]=[n,a]),{min:a,max:n}}function wh(t,s){return{x:Ur(t.x,s.x),y:Ur(t.y,s.y)}}function Sh(t,s){let a=.5;const n=Ce(t),r=Ce(s);return r>n?a=as(s.min,s.max-n,t.min):n>r&&(a=as(t.min,t.max-r,s.min)),Ke(0,1,a)}function kh(t,s){const a={};return s.min!==void 0&&(a.min=s.min-t.min),s.max!==void 0&&(a.max=s.max-t.min),a}const $a=.35;function Ph(t=$a){return t===!1?t=0:t===!0&&(t=$a),{x:Br(t,"left","right"),y:Br(t,"top","bottom")}}function Br(t,s,a){return{min:qr(t,s),max:qr(t,a)}}function qr(t,s){return typeof t=="number"?t:t[s]||0}const Ch=new WeakMap;class Th{constructor(s){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ye(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=s}start(s,{snapToCursor:a=!1,distanceThreshold:n}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const o=h=>{a?(this.stopAnimation(),this.snapToCursor(ms(h).point)):this.pauseAnimation()},i=(h,u)=>{this.stopAnimation();const{drag:b,dragPropagation:p,onDragStart:y}=this.getProps();if(b&&!p&&(this.openDragLock&&this.openDragLock(),this.openDragLock=ju(b),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=u,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Le(v=>{let g=this.getAxisMotionValue(v).get()||0;if(We.test(g)){const{projection:f}=this.visualElement;if(f&&f.layout){const k=f.layout.layoutBox[v];k&&(g=Ce(k)*(parseFloat(g)/100))}}this.originPoint[v]=g}),y&&ie.postRender(()=>y(h,u)),Ea(this.visualElement,"transform");const{animationState:j}=this.visualElement;j&&j.setActive("whileDrag",!0)},l=(h,u)=>{this.latestPointerEvent=h,this.latestPanInfo=u;const{dragPropagation:b,dragDirectionLock:p,onDirectionLock:y,onDrag:j}=this.getProps();if(!b&&!this.openDragLock)return;const{offset:v}=u;if(p&&this.currentDirection===null){this.currentDirection=Ah(v),this.currentDirection!==null&&y&&y(this.currentDirection);return}this.updateAxis("x",u.point,v),this.updateAxis("y",u.point,v),this.visualElement.render(),j&&j(h,u)},c=(h,u)=>{this.latestPointerEvent=h,this.latestPanInfo=u,this.stop(h,u),this.latestPointerEvent=null,this.latestPanInfo=null},m=()=>Le(h=>this.getAnimationState(h)==="paused"&&this.getAxisMotionValue(h).animation?.play()),{dragSnapToOrigin:d}=this.getProps();this.panSession=new Jo(s,{onSessionStart:o,onStart:i,onMove:l,onSessionEnd:c,resumeAnimation:m},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,distanceThreshold:n,contextWindow:Go(this.visualElement),element:this.visualElement.current})}stop(s,a){const n=s||this.latestPointerEvent,r=a||this.latestPanInfo,o=this.isDragging;if(this.cancel(),!o||!r||!n)return;const{velocity:i}=r;this.startAnimation(i);const{onDragEnd:l}=this.getProps();l&&ie.postRender(()=>l(n,r))}cancel(){this.isDragging=!1;const{projection:s,animationState:a}=this.visualElement;s&&(s.isAnimationBlocked=!1),this.endPanSession();const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),a&&a.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(s,a,n){const{drag:r}=this.getProps();if(!n||!js(s,r,this.currentDirection))return;const o=this.getAxisMotionValue(s);let i=this.originPoint[s]+n[s];this.constraints&&this.constraints[s]&&(i=vh(i,this.constraints[s],this.elastic[s])),o.set(i)}resolveConstraints(){const{dragConstraints:s,dragElastic:a}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,r=this.constraints;s&&Jt(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&n?this.constraints=Nh(n.layoutBox,s):this.constraints=!1,this.elastic=Ph(a),r!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&Le(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=kh(n.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:s,onMeasureDragConstraints:a}=this.getProps();if(!s||!Jt(s))return!1;const n=s.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const o=Fu(n,r.root,this.visualElement.getTransformPagePoint());let i=wh(r.layout.layoutBox,o);if(a){const l=a(Mu(i));this.hasMutatedConstraints=!!l,l&&(i=go(l))}return i}startAnimation(s){const{drag:a,dragMomentum:n,dragElastic:r,dragTransition:o,dragSnapToOrigin:i,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},m=Le(d=>{if(!js(d,a,this.currentDirection))return;let h=c&&c[d]||{};i&&(h={min:0,max:0});const u=r?200:1e6,b=r?40:1e7,p={type:"inertia",velocity:n?s[d]:0,bounceStiffness:u,bounceDamping:b,timeConstant:750,restDelta:1,restSpeed:10,...o,...h};return this.startAxisValueAnimation(d,p)});return Promise.all(m).then(l)}startAxisValueAnimation(s,a){const n=this.getAxisMotionValue(s);return Ea(this.visualElement,s),n.start(cn(s,n,0,a,this.visualElement,!1))}stopAnimation(){Le(s=>this.getAxisMotionValue(s).stop())}pauseAnimation(){Le(s=>this.getAxisMotionValue(s).animation?.pause())}getAnimationState(s){return this.getAxisMotionValue(s).animation?.state}getAxisMotionValue(s){const a=`_drag${s.toUpperCase()}`,n=this.visualElement.getProps(),r=n[a];return r||this.visualElement.getValue(s,(n.initial?n.initial[s]:void 0)||0)}snapToCursor(s){Le(a=>{const{drag:n}=this.getProps();if(!js(a,n,this.currentDirection))return;const{projection:r}=this.visualElement,o=this.getAxisMotionValue(a);if(r&&r.layout){const{min:i,max:l}=r.layout.layoutBox[a],c=o.get()||0;o.set(s[a]-ce(i,l,.5)+c)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:s,dragConstraints:a}=this.getProps(),{projection:n}=this.visualElement;if(!Jt(a)||!n||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Le(i=>{const l=this.getAxisMotionValue(i);if(l&&this.constraints!==!1){const c=l.get();r[i]=Sh({min:c,max:c},this.constraints[i])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Le(i=>{if(!js(i,s,null))return;const l=this.getAxisMotionValue(i),{min:c,max:m}=this.constraints[i];l.set(ce(c,m,r[i]))})}addListeners(){if(!this.visualElement.current)return;Ch.set(this.visualElement,this);const s=this.visualElement.current,a=ts(s,"pointerdown",c=>{const{drag:m,dragListener:d=!0}=this.getProps(),h=c.target,u=h!==s&&uo(h);m&&d&&!u&&this.start(c)}),n=()=>{const{dragConstraints:c}=this.getProps();Jt(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,o=r.addEventListener("measure",n);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),ie.read(n);const i=os(window,"resize",()=>this.scalePositionWithinConstraints()),l=r.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:m})=>{this.isDragging&&m&&(Le(d=>{const h=this.getAxisMotionValue(d);h&&(this.originPoint[d]+=c[d].translate,h.set(h.get()+c[d].translate))}),this.visualElement.render())}));return()=>{i(),a(),o(),l&&l()}}getProps(){const s=this.visualElement.getProps(),{drag:a=!1,dragDirectionLock:n=!1,dragPropagation:r=!1,dragConstraints:o=!1,dragElastic:i=$a,dragMomentum:l=!0}=s;return{...s,drag:a,dragDirectionLock:n,dragPropagation:r,dragConstraints:o,dragElastic:i,dragMomentum:l}}}function js(t,s,a){return(s===!0||s===t)&&(a===null||a===t)}function Ah(t,s=10){let a=null;return Math.abs(t.y)>s?a="y":Math.abs(t.x)>s&&(a="x"),a}class Dh extends dt{constructor(s){super(s),this.removeGroupControls=Oe,this.removeListeners=Oe,this.controls=new Th(s)}mount(){const{dragControls:s}=this.node.getProps();s&&(this.removeGroupControls=s.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Oe}update(){const{dragControls:s}=this.node.getProps(),{dragControls:a}=this.node.prevProps||{};s!==a&&(this.removeGroupControls(),s&&(this.removeGroupControls=s.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}}const zr=t=>(s,a)=>{t&&ie.postRender(()=>t(s,a))};class Ih extends dt{constructor(){super(...arguments),this.removePointerDownListener=Oe}onPointerDown(s){this.session=new Jo(s,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Go(this.node)})}createPanHandlers(){const{onPanSessionStart:s,onPanStart:a,onPan:n,onPanEnd:r}=this.node.getProps();return{onSessionStart:zr(s),onStart:zr(a),onMove:n,onEnd:(o,i)=>{delete this.session,r&&ie.postRender(()=>r(o,i))}}}mount(){this.removePointerDownListener=ts(this.node.current,"pointerdown",s=>this.onPointerDown(s))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let ma=!1;class Eh extends x.Component{componentDidMount(){const{visualElement:s,layoutGroup:a,switchLayoutGroup:n,layoutId:r}=this.props,{projection:o}=s;o&&(a.group&&a.group.add(o),n&&n.register&&r&&n.register(o),ma&&o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),Ds.hasEverUpdated=!0}getSnapshotBeforeUpdate(s){const{layoutDependency:a,visualElement:n,drag:r,isPresent:o}=this.props,{projection:i}=n;return i&&(i.isPresent=o,s.layoutDependency!==a&&i.setOptions({...i.options,layoutDependency:a}),ma=!0,r||s.layoutDependency!==a||a===void 0||s.isPresent!==o?i.willUpdate():this.safeToRemove(),s.isPresent!==o&&(o?i.promote():i.relegate()||ie.postRender(()=>{const l=i.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:s}=this.props.visualElement;s&&(s.root.didUpdate(),hn.postRender(()=>{!s.currentAnimation&&s.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:s,layoutGroup:a,switchLayoutGroup:n}=this.props,{projection:r}=s;ma=!0,r&&(r.scheduleCheckAfterUnmount(),a&&a.group&&a.group.remove(r),n&&n.deregister&&n.deregister(r))}safeToRemove(){const{safeToRemove:s}=this.props;s&&s()}render(){return null}}function Xo(t){const[s,a]=Um(),n=x.useContext(xi);return e.jsx(Eh,{...t,layoutGroup:n,switchLayoutGroup:x.useContext(Ko),isPresent:s,safeToRemove:a})}const Lh={pan:{Feature:Ih},drag:{Feature:Dh,ProjectionNode:Vo,MeasureLayout:Xo}};function Wr(t,s,a){const{props:n}=t;t.animationState&&n.whileHover&&t.animationState.setActive("whileHover",a==="Start");const r="onHover"+a,o=n[r];o&&ie.postRender(()=>o(s,ms(s)))}class Mh extends dt{mount(){const{current:s}=this.node;s&&(this.unmount=vu(s,(a,n)=>(Wr(this.node,n,"Start"),r=>Wr(this.node,r,"End"))))}unmount(){}}class Rh extends dt{constructor(){super(...arguments),this.isActive=!1}onFocus(){let s=!1;try{s=this.node.current.matches(":focus-visible")}catch{s=!0}!s||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=cs(os(this.node.current,"focus",()=>this.onFocus()),os(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function _r(t,s,a){const{props:n}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&n.whileTap&&t.animationState.setActive("whileTap",a==="Start");const r="onTap"+(a==="End"?"":a),o=n[r];o&&ie.postRender(()=>o(s,ms(s)))}class Oh extends dt{mount(){const{current:s}=this.node;s&&(this.unmount=Su(s,(a,n)=>(_r(this.node,n,"Start"),(r,{success:o})=>_r(this.node,r,o?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Ua=new WeakMap,ha=new WeakMap,Fh=t=>{const s=Ua.get(t.target);s&&s(t)},Vh=t=>{t.forEach(Fh)};function $h({root:t,...s}){const a=t||document;ha.has(a)||ha.set(a,{});const n=ha.get(a),r=JSON.stringify(s);return n[r]||(n[r]=new IntersectionObserver(Vh,{root:t,...s})),n[r]}function Uh(t,s,a){const n=$h(s);return Ua.set(t,a),n.observe(t),()=>{Ua.delete(t),n.unobserve(t)}}const Bh={some:0,all:1};class qh extends dt{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:s={}}=this.node.getProps(),{root:a,margin:n,amount:r="some",once:o}=s,i={root:a?a.current:void 0,rootMargin:n,threshold:typeof r=="number"?r:Bh[r]},l=c=>{const{isIntersecting:m}=c;if(this.isInView===m||(this.isInView=m,o&&!m&&this.hasEnteredView))return;m&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",m);const{onViewportEnter:d,onViewportLeave:h}=this.node.getProps(),u=m?d:h;u&&u(c)};return Uh(this.node.current,i,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:s,prevProps:a}=this.node;["amount","margin","root"].some(zh(s,a))&&this.startObserver()}unmount(){}}function zh({viewport:t={}},{viewport:s={}}={}){return a=>t[a]!==s[a]}const Wh={inView:{Feature:qh},tap:{Feature:Oh},focus:{Feature:Rh},hover:{Feature:Mh}},_h={layout:{ProjectionNode:Vo,MeasureLayout:Xo}},Kh={...fh,...Wh,...Lh,..._h},Ne=uh(Kh,mh),Hh={some:0,all:1};function Gh(t,s,{root:a,margin:n,amount:r="some"}={}){const o=ro(t),i=new WeakMap,l=m=>{m.forEach(d=>{const h=i.get(d.target);if(d.isIntersecting!==!!h)if(d.isIntersecting){const u=s(d.target,d);typeof u=="function"?i.set(d.target,u):c.unobserve(d.target)}else typeof h=="function"&&(h(d),i.delete(d.target))})},c=new IntersectionObserver(l,{root:a,rootMargin:n,threshold:typeof r=="number"?r:Hh[r]});return o.forEach(m=>c.observe(m)),()=>c.disconnect()}function Jh(t,{root:s,margin:a,amount:n,once:r=!1,initial:o=!1}={}){const[i,l]=x.useState(o);return x.useEffect(()=>{if(!t.current||r&&i)return;const c=()=>(l(!0),r?void 0:()=>l(!1)),m={root:s&&s.current||void 0,margin:a,amount:n};return Gh(t.current,c,m)},[s,t,a,r,n]),i}const Yh=`
  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideInDown {
    from {
      opacity: 0;
      transform: translateY(-30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeInScale {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes pulse-glow {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
    }
    50% {
      box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
    }
  }

  @keyframes float {
    0%, 100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-20px);
    }
  }

  @keyframes shimmer {
    0% {
      background-position: -1000px 0;
    }
    100% {
      background-position: 1000px 0;
    }
  }

  @keyframes bounce-in {
    0% {
      opacity: 0;
      transform: scale(0.8);
    }
    50% {
      opacity: 1;
    }
    100% {
      transform: scale(1);
    }
  }

  @keyframes word-slide {
    0% {
      opacity: 0;
      transform: translateX(-30px);
    }
    100% {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .animate-slide-up {
    animation: slideInUp 0.8s ease-out forwards;
  }

  .animate-slide-down {
    animation: slideInDown 0.8s ease-out forwards;
  }

  .animate-fade-scale {
    animation: fadeInScale 0.6s ease-out forwards;
  }

  .animate-pulse-glow {
    animation: pulse-glow 2s infinite;
  }

  .animate-float {
    animation: float 3s ease-in-out infinite;
  }

  .animate-bounce-in {
    animation: bounce-in 0.6s ease-out forwards;
  }

  .feature-card {
    animation: slideInUp 0.8s ease-out forwards;
  }

  .feature-card:nth-child(1) { animation-delay: 0.1s; }
  .feature-card:nth-child(2) { animation-delay: 0.2s; }
  .feature-card:nth-child(3) { animation-delay: 0.3s; }
  .feature-card:nth-child(4) { animation-delay: 0.4s; }
  .feature-card:nth-child(5) { animation-delay: 0.5s; }
  .feature-card:nth-child(6) { animation-delay: 0.6s; }

  .plan-card {
    animation: fadeInScale 0.7s ease-out forwards;
  }

  .plan-card:nth-child(1) { animation-delay: 0.2s; }
  .plan-card:nth-child(2) { animation-delay: 0.4s; }

  .stat-item {
    animation: slideInUp 0.8s ease-out forwards;
  }

  .stat-item:nth-child(1) { animation-delay: 0.1s; }
  .stat-item:nth-child(2) { animation-delay: 0.2s; }
  .stat-item:nth-child(3) { animation-delay: 0.3s; }
  .stat-item:nth-child(4) { animation-delay: 0.4s; }

  .hero-text {
    opacity: 0;
  }

  .hero-text-1 { animation: word-slide 0.6s ease-out 0.2s forwards; }
  .hero-text-2 { animation: word-slide 0.6s ease-out 0.4s forwards; }
  .hero-text-3 { animation: word-slide 0.6s ease-out 0.6s forwards; }

  .btn-animate {
    animation: slideInUp 0.8s ease-out 0.8s forwards;
    opacity: 0;
  }

  .glow-border {
    animation: pulse-glow 2s infinite;
  }

  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
`,vs=({children:t,delay:s=0})=>e.jsx(Ne.span,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:s},className:"inline-block",children:t}),Ns=({children:t,delay:s=0})=>{const a=x.useRef(null),n=Jh(a,{once:!0,margin:"-100px"});return e.jsx(Ne.div,{ref:a,initial:{opacity:0,y:50},animate:n?{opacity:1,y:0}:{opacity:0,y:50},transition:{duration:.6,delay:s},children:t})},Xh=()=>{const t=["Retail","Restaurants","Clinics","Supermarkets","Bakeries","Hotels"],[s,a]=x.useState(0);return x.useEffect(()=>{const n=setInterval(()=>{a(r=>(r+1)%t.length)},2e3);return()=>clearInterval(n)},[]),e.jsx(Ne.span,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5},className:"text-blue-400 font-bold",children:t[s]},s)};function Kr(){const t=Te(),{user:s,loading:a,isInitialized:n}=be(),[r,o]=x.useState(!1),[i,l]=x.useState(0);if(x.useEffect(()=>{if(!n){console.log("Landing: Auth not initialized yet");return}if(a){console.log("Landing: Still loading auth");return}s&&s.email?(console.log("Landing: User logged in, redirecting to dashboard",s.role),s.role==="owner"?t("/main-admin",{replace:!0}):s.role==="admin"?t("/admin",{replace:!0}):s.role==="cashier"?t("/cashier",{replace:!0}):t("/dashboard",{replace:!0})):console.log("Landing: No user, staying on landing page")},[s,a,n,t]),x.useEffect(()=>{const h=document.createElement("style");return h.textContent=Yh,document.head.appendChild(h),()=>document.head.removeChild(h)},[]),a&&!n)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-4 border-white mx-auto mb-4"}),e.jsx("p",{className:"text-white text-lg",children:"Loading..."})]})});const c=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 1,600 - 1 Cashier) or Ultra (KSH 3,000 - Unlimited) package",image:"ðŸ“",details:"First user becomes Admin automatically. Basic supports 1 cashier. Ultra supports unlimited cashiers with full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],m=[{icon:rt,title:"âš¡ Atomic Sales",desc:"Complete sales instantly (3-4ms) - never hanging, always consistent stock"},{icon:Ye,title:"ðŸ“Š Live Analytics",desc:"Real-time dashboard updates every 5 seconds with instant totals"},{icon:rt,title:"ðŸ”’ Zero Race Conditions",desc:"File-based locking prevents stock conflicts even with simultaneous sales"},{icon:ot,title:"âš ï¸ Low-Stock Alerts",desc:"Automatic warnings when inventory drops below threshold"},{icon:Is,title:"ðŸ’¯ 99.99% Reliability",desc:"Atomic transactions guarantee data integrity, never lost sales"},{icon:ga,title:"ðŸš€ Performance+",desc:"Sales 50x faster, Analytics 140x faster than legacy systems"}],d=[{name:"Basic",price:1e3,icon:rt,popular:!1,features:["âœ“ Admin + Cashier Dashboard","âœ“ Basic Inventory","âœ“ Sales Tracking","âœ“ Daily/Weekly Reports","âœ“ Basic Profit/Loss View","âœ“ Email Support","âœ“ 1 Cashier Only"]},{name:"Ultra",price:2500,icon:ya,popular:!0,features:["âœ“ Admin + Cashier Dashboard","âœ“ Full Inventory Management","âœ“ Automatic Stock Deduction","âœ“ User Management (Unlimited)","âœ“ Permission Controls","âœ“ Expense Tracking","âœ“ Advanced Analytics","âœ“ Priority Support"]},{name:"Pro",price:3400,icon:ya,popular:!1,features:["âœ“ All Ultra Features","âœ“ Recipe/BOM Builder","âœ“ COGS Calculation","âœ“ Composite Products","âœ“ Advanced Reporting","âœ“ Multi-location Support","âœ“ API Access","âœ“ Dedicated Support"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/auth/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>t("/choose-subscription"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(Al,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:[e.jsx(vs,{delay:.2,children:"The"})," ",e.jsx(vs,{delay:.3,children:e.jsx("span",{className:"bg-gradient-to-r from-yellow-300 via-pink-300 to-blue-300 bg-clip-text text-transparent",children:"Smart"})})," ",e.jsx(vs,{delay:.4,children:"POS"})," ",e.jsx(vs,{delay:.5,children:"for"}),e.jsx("br",{}),e.jsx(Xh,{})]}),e.jsxs(Ne.p,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8,delay:.8},className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:[e.jsx("span",{className:"font-bold text-white",children:"All-in-One"})," inventory management with recipe builder,",e.jsx("span",{className:"font-bold text-white",children:" fast"})," automatic stock deduction, and",e.jsx("span",{className:"font-bold text-white",children:" secure"})," real-time analytics. Everything you need to run your business efficiently."]}),e.jsxs(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:1},className:"flex items-center justify-center gap-4",children:[e.jsxs(Ne.button,{whileHover:{scale:1.05,boxShadow:"0 20px 40px rgba(0,0,0,0.3)"},whileTap:{scale:.95},onClick:()=>t("/choose-subscription"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(Kt,{className:"w-5 h-5"})]}),e.jsxs(Ne.button,{whileHover:{scale:1.05,backgroundColor:"rgba(255,255,255,0.1)"},whileTap:{scale:.95},onClick:()=>o(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg transition-all flex items-center gap-2",children:[e.jsx(si,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx(Ne.p,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:1.2},className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 30-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ga,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(Ns,{children:e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Built for Your Business"})}),e.jsxs("p",{className:"text-xl text-gray-600",children:["Powerful features to ",e.jsx("span",{className:"font-bold text-blue-600",children:"streamline"})," your operations"]})]})}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:m.map((h,u)=>{const b=h.icon;return e.jsx(Ns,{delay:u*.1,children:e.jsxs(Ne.div,{whileHover:{y:-8,boxShadow:"0 20px 40px rgba(0,0,0,0.1)"},className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all cursor-pointer h-full",children:[e.jsx(Ne.div,{whileHover:{rotate:360,scale:1.1},transition:{duration:.6},className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(b,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:h.title}),e.jsx("p",{className:"text-gray-600",children:h.desc})]})},u)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(Ns,{children:e.jsxs("div",{className:"text-center mb-16",children:[e.jsxs("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:["Simple, ",e.jsx("span",{className:"bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent",children:"Transparent"})," Pricing"]}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]})}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:d.map((h,u)=>{const b=h.icon;return e.jsx(Ns,{delay:u*.2,children:e.jsxs(Ne.div,{whileHover:{scale:1.05,y:-10},transition:{duration:.3},className:`relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all ${h.popular?"ring-4 ring-blue-600":""}`,children:[h.popular&&e.jsx(Ne.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5,duration:.5},className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Ne.div,{whileHover:{rotate:360},transition:{duration:.6},className:`w-12 h-12 rounded-xl flex items-center justify-center ${h.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(b,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:h.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",h.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:h.features.map((p,y)=>e.jsxs(Ne.li,{initial:{opacity:0,x:-20},whileInView:{opacity:1,x:0},transition:{delay:y*.1},className:"flex items-start gap-2",children:[e.jsx(Ot,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:p})]},y))}),e.jsx(Ne.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>t("/choose-subscription"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${h.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]})},u)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>t("/choose-subscription"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(Kt,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{o(!1),l(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(_e,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",i+1," of ",c.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((i+1)/c.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(i+1)/c.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:c[i].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:c[i].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:c[i].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:c[i].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>l(Math.max(0,i-1)),disabled:i===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),i<c.length-1?e.jsxs("button",{onClick:()=>l(i+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(Kt,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{o(!1),l(0),t("/choose-subscription")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(Kt,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:c.map((h,u)=>e.jsx("button",{onClick:()=>l(u),className:`w-2 h-2 rounded-full transition-all ${u===i?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},u))})]})]})})]})}function Hr(){const t=Yr(),[s,a]=x.useState(t.pathname==="/auth/login"),[n,r]=x.useState("password"),[o,i]=x.useState({email:"",password:"",pin:"",name:"",newPassword:"",confirmPassword:""}),[l,c]=x.useState(""),[m,d]=x.useState(!1),[h,u]=x.useState(!1),b=Te(),{login:p}=be(),y=()=>{try{return JSON.parse(localStorage.getItem("selectedPlan")||"null")}catch(v){return console.warn("Invalid selectedPlan in localStorage:",v),null}},j=async v=>{v.preventDefault(),c(""),d(!0);try{if(h){if(o.newPassword!==o.confirmPassword){c("Passwords do not match"),d(!1);return}if(o.newPassword.length<6){c("Password must be at least 6 characters"),d(!1);return}const O=await Pt.login({email:o.email,newPassword:o.newPassword});O.token&&O.user&&(await p(O),b("/dashboard"));return}if(s){if(n==="pin"){if(!o.pin||o.pin.length!==4){c("Please enter a valid 4-digit PIN"),d(!1);return}}else if(!o.password){c("Please enter your password"),d(!1);return}}let g;if(s)if(n==="pin")try{g=await Pt.pinLogin({email:o.email,pin:o.pin})}catch(O){if(O.message.includes("PIN not set"))c("PIN not set for this user. Please use password login.");else if(O.message.includes("Invalid PIN"))c("Invalid PIN. Please try again.");else throw O;d(!1);return}else g=await Pt.login({email:o.email,password:o.password});else{const O=y(),F=localStorage.getItem("planId")||O?.id||"basic",C=localStorage.getItem("selectedBusinessType"),B=localStorage.getItem("selectedFeatures");g=await Pt.signup({email:o.email,password:o.password,name:o.name,plan:F,businessType:C,selectedFeatures:B?JSON.parse(B):[]})}if(g.needsPasswordSetup){u(!0),i({...o,email:g.email}),c(""),d(!1);return}if(!g||!g.user||!g.token)throw new Error("Authentication failed. Please try again.");const f={id:Date.now(),type:s?"login":"signup",user:{id:g.user.id,name:g.user.name,email:g.user.email,role:g.user.role,plan:g.user.plan||"free"},timestamp:new Date().toISOString(),ip:"Unknown",userAgent:navigator.userAgent},k=JSON.parse(localStorage.getItem("authActivities")||"[]");k.unshift(f),k.splice(50),localStorage.setItem("authActivities",JSON.stringify(k)),await p(g);const I=s?"logged in":"signed up";console.log(`âœ… User ${g.user.name} ${I} successfully`),console.log(`ðŸ“ Role: ${g.user.role}, Plan: ${g.user.plan}`),s?g.user.role==="owner"?(console.log("ðŸ”¹ Login as owner â†’ Redirecting to Main Admin Dashboard (/main-admin)"),b("/main-admin")):g.user.role==="admin"?(console.log("ðŸ”¹ Login as admin â†’ Redirecting to Admin Dashboard (/admin)"),b("/admin")):g.user.role==="cashier"?(console.log("ðŸ”¹ Login as cashier â†’ Redirecting to Cashier Dashboard (/cashier)"),b("/cashier")):(console.warn("âš ï¸ Unknown role, redirecting to default dashboard"),b("/dashboard")):(console.log("ðŸ”¹ Signup successful â†’ Redirecting to Admin Dashboard (/admin)"),b("/admin"))}catch(g){console.error("Authentication error:",g);let f=g.message||"Authentication failed. Please try again.";g.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),f="Invalid credentials. Please try again."),c(f)}finally{d(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:s?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600",children:s?"Login to your account":"Create your account"})]}),e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[h?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:o.newPassword,onChange:v=>i({...o,newPassword:v.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:o.confirmPassword,onChange:v=>i({...o,confirmPassword:v.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!s&&e.jsxs("div",{className:"relative",children:[e.jsx(Ba,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:o.name,onChange:v=>i({...o,name:v.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:o.email,onChange:v=>i({...o,email:v.target.value}),required:!0})]}),s&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Login Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>r("password"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${n==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Password"}),e.jsx("button",{type:"button",onClick:()=>r("pin"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${n==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"pin"})]})]}),s&&n==="password"&&e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:o.password,onChange:v=>i({...o,password:v.target.value}),required:!0})]}),s&&n==="pin"&&e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:o.pin,onChange:v=>i({...o,pin:v.target.value.replace(/\D/g,"").slice(0,4)}),maxLength:4,required:!0})]}),!s&&e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:o.password,onChange:v=>i({...o,password:v.target.value}),required:!0})]})]}),l&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:l}),e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50",children:m?"Please wait...":h?"Set Password":s?"Login":"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{a(!s),c(""),u(!1)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:s?"Don't have an account? Sign up":"Already have an account? Login"})})]})})}function Zh(){const[t,s]=x.useState("ultra"),[a,n]=x.useState(!1),[r,o]=x.useState({name:"",email:"",company:""}),i=Te();console.log("âœ… Subscription component mounted, navigate available:",typeof i);const l=[{id:"basic",name:"Basic",price:1e3,icon:rt,color:"from-green-500 to-teal-600",popular:!1,features:["âœ“ Admin Dashboard + Cashier POS","âœ“ Basic Inventory Management","âœ“ Sales Tracking","âœ“ Daily/Weekly Reports","âœ“ Basic Profit/Loss View","âœ“ Email Support","âœ“ 1 Cashier Only"]},{id:"ultra",name:"Ultra",price:2500,icon:ya,color:"from-blue-600 to-purple-600",popular:!0,features:["âœ“ Admin Dashboard + Cashier POS","âœ“ Full Inventory Management","âœ“ Automatic Stock Deduction","âœ“ User Management (Unlimited)","âœ“ Permission Controls","âœ“ Expense Tracking","âœ“ Advanced Analytics","âœ“ Priority Support"]}],c=d=>{d?.preventDefault?.(),console.log("[BUTTON] Get Started clicked, selected plan:",t),console.log("[BUTTON] Available plans:",l.map(u=>u.id));const h=l.find(u=>u.id===t);if(console.log("[BUTTON] Found plan:",h),!h){console.error("[BUTTON] Plan not found!"),alert("Please select a plan first");return}try{const u={id:h.id,name:h.name,price:h.price};localStorage.setItem("selectedPlan",JSON.stringify(u)),localStorage.setItem("planId",t),console.log("[BUTTON] Stored to localStorage, navigating..."),console.log("[BUTTON] Going to /auth/signup"),i("/auth/signup")}catch(u){console.error("[BUTTON] Error:",u),alert("Error: "+u.message)}},m=async d=>{d.preventDefault();try{await fetch(`${le}/demo-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),alert("Demo request submitted! Admin will review and contact you."),n(!1),o({name:"",email:"",company:""})}catch(h){console.error("Demo request failed:",h),alert("Failed to submit demo request. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:()=>i("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition",children:[e.jsx(ai,{size:20}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mb-12 md:mb-16",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Pick the perfect plan and unlock your POS potential"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8 mb-8 md:mb-12 max-w-5xl mx-auto",children:l.map(d=>{const h=d.icon;return e.jsxs("div",{onClick:()=>s(d.id),className:`card cursor-pointer transition-all transform ${t===d.id?"ring-4 ring-blue-600 shadow-2xl scale-105 bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-lg hover:scale-102"} relative`,children:[d.popular&&e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl bg-gradient-to-br ${d.color} flex items-center justify-center`,children:e.jsx(h,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"text-lg md:text-xl font-bold",children:d.name})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("span",{className:"text-2xl md:text-3xl font-bold",children:["KSH ",d.price]}),e.jsx("span",{className:"text-gray-600 text-xs md:text-sm",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:d.features.map((u,b)=>e.jsxs("li",{className:"flex items-start gap-2 text-xs md:text-sm",children:[e.jsx(Ot,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:u})]},b))})]},d.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center mt-8",children:[e.jsx("button",{type:"button",onClick:c,className:"cursor-pointer px-8 md:px-12 py-3 md:py-4 text-base md:text-lg font-bold bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all active:scale-95",children:"Get Started"}),e.jsx("button",{type:"button",onClick:()=>n(!0),className:"cursor-pointer px-8 md:px-12 py-3 md:py-4 text-base md:text-lg font-bold border-2 border-gray-300 bg-white text-gray-700 rounded-lg hover:border-gray-400 transition-all",children:"Request Free Demo"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-4 text-center",children:"Secure payment â€¢ Cancel anytime"}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Free Demo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"We'll contact you to schedule a demo"})]}),e.jsxs("form",{onSubmit:m,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:r.name,onChange:d=>o({...r,name:d.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:r.email,onChange:d=>o({...r,email:d.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:r.company,onChange:d=>o({...r,company:d.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition",children:"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>n(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})})}const xa={bar:{id:"bar",name:"Bar / Alcohol Business",description:"Drinks, happy hour pricing, brand tracking, staff shifts",icon:"Wine",color:"amber",features:["Bottle size + brand management","Happy hour pricing rules","Staff shift tracking","Profit by brand","Low stock alerts","Age-check functionality"],productFields:["name","brand","size","category","price","cost","stock"],categories:["Beer","Wine","Spirits","Beverages","Mixers"],adminModules:["inventory","staff","shifts","pricing","reports"],cashierModules:["categories","quick-tap","age-check","shift-view"]},hospital:{id:"hospital",name:"Hospital / Clinic",description:"Patient billing, services, medicines, doctor commission",icon:"Heart",color:"red",features:["Services + medicines separation","Patient search + billing","Doctor commission tracking","Batch + expiry tracking","Medicine inventory","Invoice printing"],productFields:["name","type","category","price","batchNo","expiryDate","stock"],categories:["Services","Medicines","Lab Tests","Equipment"],adminModules:["patients","services","medicines","doctors","inventory"],cashierModules:["patient-search","add-services","add-medicines","print"]},school:{id:"school",name:"School",description:"Student billing, term fees, canteen, uniform/books",icon:"BookOpen",color:"blue",features:["Student management","Term fees tracking","Canteen inventory","Uniform + books stock","Fee payment receipts","Student balance"],productFields:["name","type","category","price","stock","description"],categories:["Fees","Canteen","Uniforms","Books","Supplies"],adminModules:["students","fees","canteen","inventory","reports"],cashierModules:["student-lookup","fee-payment","canteen-sales","receipts"]},kiosk:{id:"kiosk",name:"Kiosk / Small Shop",description:"Simple inventory, supplier tracking, fast POS",icon:"Store",color:"green",features:["Simple inventory management","Supplier tracking","Price rules","Profit reports","Low stock alerts","Fast checkout"],productFields:["name","category","price","cost","stock","supplier"],categories:["General","Electronics","Food","Drinks","Supplies"],adminModules:["inventory","suppliers","pricing","reports"],cashierModules:["search","quick-scan","low-stock-alerts"]},petrol:{id:"petrol",name:"Petrol / Gas Station",description:"Fuel types, pump tracking, tank stock, shift reconciliation",icon:"Fuel",color:"yellow",features:["Fuel type management","Pump tracking","Tank stock management","Shift reconciliation","Pump totals","Attendant management"],productFields:["name","fuelType","pricePerLiter","tankCapacity","pumpId","stock"],categories:["Petrol","Diesel","Premium","LPG"],adminModules:["fuel-types","pumps","tanks","staff","reconciliation"],cashierModules:["pump-selector","fuel-buttons","shift-totals","attendant-view"]},shoes:{id:"shoes",name:"Shoe / Clothing Store",description:"Size & color variants, margin tracking, returns/refunds",icon:"Shirt",color:"pink",features:["Size + color variants","Margin per product","Returns + refunds","Variant inventory","Barcode + search POS","Stock by variant"],productFields:["name","category","price","cost","size","color","stock","margin"],categories:["Shoes","Shirts","Pants","Dresses","Accessories"],adminModules:["variants","inventory","returns","pricing","reports"],cashierModules:["variant-selector","search","barcode","returns"]}};function Qh(){const t=Te(),[s,a]=x.useState(null),[n,r]=x.useState(1),o=d=>{a(d),r(2)},i=()=>{if(!s){alert("Please select a business type");return}const d=xa[s];localStorage.setItem("selectedBusinessType",s),localStorage.setItem("businessMetadata",JSON.stringify(d)),console.log("[BUILD POS] Selected business:",s),t("/auth/signup")},l=()=>{n===2?(r(1),a(null)):t("/plans")},c=s?xa[s]:null,m=Object.entries(xa).map(([d,h])=>({id:d,...h}));return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 py-8 px-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:l,className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition p-2 rounded-lg hover:bg-white",children:[e.jsx(ai,{size:20}),"Back"]})}),n===1&&e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Business Type"}),e.jsx("p",{className:"text-gray-600 mb-12 text-lg",children:"Select the type that best matches your operation. We'll customize your dashboard accordingly."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(d=>e.jsxs("button",{onClick:()=>o(d.id),className:`text-left p-6 rounded-xl border-2 transition-all transform hover:scale-105 ${s===d.id?"border-blue-600 bg-blue-50 ring-2 ring-blue-400 shadow-lg":"border-gray-200 bg-white hover:border-gray-300 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:d.name}),e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${s===d.id?"bg-blue-600 border-blue-600":"border-gray-300"}`,children:s===d.id&&e.jsx(Ot,{size:16,className:"text-white"})})]}),e.jsx("p",{className:"text-gray-600 mb-4 text-sm",children:d.description}),e.jsx("ul",{className:"space-y-2",children:d.features.slice(0,3).map((h,u)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[e.jsx("span",{className:"text-green-600 font-bold mt-0.5",children:"â€¢"}),e.jsx("span",{children:h})]},u))})]},d.id))})]}),n===2&&c&&e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-4xl font-bold mb-8 text-center",children:"Confirm Your Selection"}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 border-2 border-blue-600",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4 text-blue-600",children:c.name}),e.jsx("p",{className:"text-gray-600 mb-8 text-lg",children:c.description}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Your Dashboard Includes:"}),e.jsx("ul",{className:"space-y-3",children:c.features.map((d,h)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-green-600 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx(Ot,{size:16,className:"text-white"})}),e.jsx("span",{className:"text-gray-700",children:d})]},h))})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-8",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-bold",children:"Custom Price:"})," 3,500 KES/month"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Your admin will be customized for ",c.name.toLowerCase(),". You can modify your selection later."]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>{r(1),a(null)},className:"flex-1 px-6 py-3 rounded-lg border-2 border-gray-300 font-bold text-gray-700 hover:bg-gray-50 transition",children:"Choose Different"}),e.jsxs("button",{onClick:i,className:"flex-1 px-6 py-3 rounded-lg bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold hover:shadow-lg transition flex items-center justify-center gap-2",children:["Continue to Sign Up",e.jsx(Kt,{size:20})]})]})]})]})]})})}function ex({isLocked:t,onUnlock:s,userPin:a,userName:n="Cashier"}){const[r,o]=x.useState(""),[i,l]=x.useState(""),[c,m]=x.useState(0),[d,h]=x.useState(!1);x.useEffect(()=>{t&&(l(""),o(""),m(0),h(!1))},[t]),x.useEffect(()=>{c>=3&&(h(!0),setTimeout(()=>{h(!1),m(0)},3e4))},[c]);const u=y=>{d||r.length<4&&(o(j=>j+y),l(""))},b=()=>{d||(o(y=>y.slice(0,-1)),l(""))},p=()=>{if(d){l("Too many attempts. Please wait.");return}if(r.length!==4){l("PIN must be 4 digits");return}String(r)===String(a)?(o(""),l(""),s()):(l("Incorrect PIN"),m(y=>y+1),o(""))};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[9999] backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-96 max-w-full mx-4",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"bg-red-100 p-4 rounded-full",children:e.jsx(De,{className:"w-12 h-12 text-red-600"})})}),e.jsx("h1",{className:"text-2xl font-bold text-center text-gray-800 mb-2",children:"Screen Locked"}),e.jsxs("p",{className:"text-center text-gray-600 mb-6",children:[n,", enter your PIN to continue"]}),e.jsx("div",{className:"bg-gray-100 rounded-lg p-4 mb-6 flex justify-center gap-2",children:[0,1,2,3].map(y=>e.jsx("div",{className:"w-12 h-12 bg-white border-2 border-gray-300 rounded-lg flex items-center justify-center font-bold text-xl text-gray-800",children:r[y]?"â—":""},y))}),i&&e.jsxs("div",{className:`text-center text-sm font-medium mb-4 p-2 rounded ${i.includes("Incorrect")?"bg-red-100 text-red-700":i.includes("must be")?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[i,c>0&&c<3&&e.jsxs("p",{className:"text-xs mt-1",children:[3-c," attempt",3-c!==1?"s":""," remaining"]}),d&&e.jsx("p",{className:"text-xs mt-1",children:"Locked. Try again in 30 seconds."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[[1,2,3,4,5,6,7,8,9].map(y=>e.jsx("button",{onClick:()=>u(String(y)),disabled:d||r.length>=4,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors text-lg",children:y},y)),e.jsx("button",{onClick:()=>u("0"),disabled:d||r.length>=4,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors col-span-1 text-lg",children:"0"}),e.jsxs("button",{onClick:b,disabled:d||r.length===0,className:"bg-red-500 hover:bg-red-600 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors col-span-2 flex items-center justify-center gap-2",children:[e.jsx(_e,{size:16}),"Back"]})]}),e.jsx("button",{onClick:p,disabled:d||r.length!==4,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors mb-3",children:d?"Locked":"Unlock"}),e.jsx("p",{className:"text-center text-xs text-gray-500 mt-4",children:"Enter your 4-digit PIN"})]})}):null}function tx(){const[t,s]=x.useState([]),[a,n]=x.useState([]);x.useEffect(()=>{const i=async()=>{try{const c=await we.getLowStockWarnings?.();c?.warnings&&s(c.warnings)}catch(c){console.warn("Failed to fetch low-stock warnings:",c)}};i();const l=setInterval(i,1e4);return()=>clearInterval(l)},[]);const r=t.filter(i=>!a.includes(i.id));if(r.length===0)return null;const o=i=>{n([...a,i])};return e.jsx("div",{className:"fixed top-24 right-6 max-w-md space-y-2 z-40",children:r.map(i=>e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded shadow-lg animate-pulse",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Mt,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-900",children:"âš ï¸ Stock Warning"}),e.jsxs("p",{className:"text-sm text-red-800 mt-1",children:[e.jsx("strong",{children:i.name}),": ",i.quantity,i.unit," remaining"]}),e.jsxs("p",{className:"text-xs text-red-700 mt-0.5",children:["Threshold: ",i.threshold,i.unit]})]})]}),e.jsx("button",{onClick:()=>o(i.id),className:"text-red-600 hover:text-red-900 flex-shrink-0",children:e.jsx(_e,{className:"w-4 h-4"})})]})},i.id))})}const sx="http://localhost:5000";let pa=null;const ax=()=>(pa||(pa=localStorage.getItem("token")),pa),Zo=async(t,s={})=>{const a=performance.now(),n=ax();try{const r=await fetch(`${sx}${t}`,{...s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`,...s.headers},keepalive:!0,priority:"high"});if(!r.ok){const l=await r.json().catch(()=>({error:"Request failed"}));throw new Error(l.error||`HTTP ${r.status}`)}const o=await r.json(),i=performance.now()-a;return i>200&&console.warn(`âš ï¸ Slow API request: ${t} took ${i.toFixed(1)}ms`),o}catch(r){const o=performance.now()-a;throw console.error(`âŒ API error (${o.toFixed(1)}ms): ${t}`,r),r}},Qo=async(t,s,a,n)=>{const r=performance.now();let o=!1;try{console.log("ðŸš€ [Transaction] Starting sale transaction",{items:t.items?.length||0,total:t.total}),s&&(s({action:"SALE_PENDING",cartCleared:!0,message:"Processing sale...",timestamp:Date.now()}),o=!0,console.log("âœ… [Transaction] Optimistic update applied"));const i=performance.now(),l=await Zo("/api/v2/sales/complete",{method:"POST",body:JSON.stringify({items:t.items,total:t.total,discount:t.discount||0,tax:t.tax||0,taxType:t.taxType||"exclusive",paymentMethod:t.paymentMethod||"cash",shiftId:t.shiftId})}),c=performance.now()-i;console.log(`âœ… [Transaction] API completed in ${c.toFixed(1)}ms`);const m=performance.now()-r;if(!l.success||!l.saleId)throw new Error(l.error||"Invalid server response");const d={...l,clientElapsedMs:m,apiElapsedMs:c,performanceGrade:m<100?"ðŸš€ EXCELLENT":m<200?"âœ… GOOD":m<300?"âš ï¸ ACCEPTABLE":"âŒ SLOW",updatedProducts:l.updatedProducts||[],stockDeductions:l.stockDeductions||{},lowStockWarnings:l.lowStockWarnings||[]};return console.log(`âœ… [Transaction] Complete! Total: ${m.toFixed(1)}ms ${d.performanceGrade}`),a&&a(d),d}catch(i){const l=performance.now()-r;console.error(`âŒ [Transaction] Failed after ${l.toFixed(1)}ms:`,i);const c={error:i.message||"Transaction failed",elapsedMs:l,action:"SALE_FAILED",needsRollback:o,timestamp:Date.now()};throw n&&n(c),i}},nx=async t=>{const s=performance.now();try{console.log("ðŸ• [ClockIn] Starting clock-in transaction");const a=await Zo("/api/v2/shifts/clock-in",{method:"POST"}),n=performance.now()-s;console.log(`âœ… [ClockIn] Completed in ${n.toFixed(1)}ms`);const r={...a,elapsedMs:n,performanceGrade:n<50?"ðŸš€":n<100?"âœ…":"âš ï¸"};return t&&t(r),r}catch(a){const n=performance.now()-s;throw console.error(`âŒ [ClockIn] Failed after ${n.toFixed(1)}ms:`,a),a}},rx="products_cache_v2",el=()=>{sessionStorage.removeItem(rx),console.log("ðŸ—‘ï¸ [Cache] Product cache invalidated")},ix=(t,s)=>{if(!s||!Array.isArray(s.products))return t;const a=performance.now(),n=new Map;s.products.forEach(i=>{n.set(i.id,i.deducted||i.quantity)});const r=t.map(i=>{const l=n.get(i.id);return l!==void 0?{...i,quantity:Math.max(0,i.quantity-l)}:i}),o=performance.now()-a;return console.log(`âœ… [Optimistic] Inventory updated in ${o.toFixed(2)}ms`),r},ox={sales:[],clockIns:[],clockOuts:[],record(t,s){const a=this[t];a&&(a.push({duration:s,timestamp:Date.now()}),a.length>100&&a.shift())},getStats(t){const s=this[t];if(!s||s.length===0)return{count:0,avg:0,min:0,max:0,p95:0};const a=s.map(i=>i.duration).sort((i,l)=>i-l),n=a.length,r=a.reduce((i,l)=>i+l,0),o=Math.floor(n*.95);return{count:n,avg:r/n,min:a[0],max:a[n-1],p95:a[o]||a[n-1]}},logReport(){console.group("ðŸ“Š Transaction Performance Report"),console.log("Sales:",this.getStats("sales")),console.log("Clock Ins:",this.getStats("clockIns")),console.log("Clock Outs:",this.getStats("clockOuts")),console.groupEnd()}};typeof window<"u"&&(window.__transactionMetrics=ox);function Gr(){const{user:t,logout:s}=be(),{products:a,refreshProducts:n}=za(),{isLocked:r,lock:o,unlock:i}=di(),[l,c]=x.useState([]),[m,d]=x.useState([]),[h,u]=x.useState([]),[b,p]=x.useState("cash"),[y,j]=x.useState("pos"),[v,g]=x.useState({sales:[],expenses:[],stats:{}}),[f,k]=x.useState(""),[I,O]=x.useState(!1),[F,C]=x.useState(!1),[B,E]=x.useState(null),[D,$]=x.useState({name:"",price:"",cost:"",category:"finished",image:""}),[G,me]=x.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[fe,ae]=x.useState(!1),[se,re]=x.useState(!1),[te,he]=x.useState({customerName:"",amount:"",reason:"",notes:""}),[P,S]=x.useState(!1),[T,M]=x.useState({description:"",amount:"",category:""}),[q,H]=x.useState(""),[W,ne]=x.useState([]),[K,qe]=x.useState(null),[ge,et]=x.useState("exclusive"),[oe,ut]=x.useState(!1),[Hs,wt]=x.useState(null),[hs,mt]=x.useState(null),[St,kt]=x.useState({}),[qt,xs]=x.useState(!1),[vn,ps]=x.useState(!1),[Nn,tt]=x.useState(!1),[w,A]=x.useState(Date.now()),[z,Q]=x.useState(0);x.useEffect(()=>{Je(),n();const N=localStorage.getItem(`cart_${t?.id}`),L=localStorage.getItem(`paymentMethod_${t?.id}`),R=localStorage.getItem(`selectedDiscount_${t?.id}`),_=localStorage.getItem(`taxType_${t?.id}`);if(N)try{u(JSON.parse(N))}catch(Z){console.warn("Failed to restore cart:",Z)}if(L&&p(L),_&&et(_),R)try{qe(JSON.parse(R))}catch{}Ge();const X=localStorage.getItem("token");X&&ze.connect(X,Z=>{if(console.log("ðŸ“¡ WebSocket callback received:",Z),Z&&Z.allProducts){console.log(`ðŸ“¦ Merging ${Z.allProducts.length} products from WebSocket`);const Ae=Z.allProducts.filter(xt=>xt.visibleToCashier!==!1&&!xt.expenseOnly);c(Ae)}Z&&Z.productId!==void 0&&Z.newQuantity!==void 0&&(console.log(`ðŸ“¦ Stock update for product ${Z.productId}: ${Z.newQuantity}${Z.unit||""}`),c(Ae=>Ae.map(J=>J.id===Z.productId?{...J,quantity:Z.newQuantity}:J))),Z&&Z.discounts&&(console.log("ðŸ“Š Discount list updated"),ne(Z.discounts)),Z&&Z.sale&&(console.log("ðŸ’° Sale detected, reloading stats"),Je())}).catch(Z=>{console.warn("âš ï¸ WebSocket connection failed:",Z)});const xe=In(Z=>{try{if(!Z)return;console.log("ðŸ“¨ Product subscription message:",Z.type),(Z.type==="initial"||Z.type==="products_snapshot"||Z.type==="product_created"||Z.type==="product_updated"||Z.type==="product_deleted")&&we.getAll().then(Ae=>{const xt=Ae.filter(J=>J.visibleToCashier!==!1&&!J.expenseOnly);console.log(`âœ… Subscription update: ${xt.length} products`),c(xt)}).catch(Ae=>{console.error("Failed to fetch products from subscription:",Ae)})}catch(Ae){console.error("âŒ Product subscription handler error",Ae)}}),$e=setInterval(()=>{console.log("ðŸ”„ Auto-refreshing products..."),ps(!0),n().finally(()=>ps(!1))},3e4);return()=>{clearInterval($e);try{xe()}catch{}ze.disconnect()}},[t?.id]),x.useEffect(()=>{if(a){const N=a.filter(L=>L.visibleToCashier!==!1&&!L.expenseOnly&&!L.pendingDelete);c(N),A(Date.now()),Q(L=>L+1)}},[a]),x.useEffect(()=>{const N=localStorage.getItem("token");N&&ze.connect(N,R=>{if(console.log("ðŸ“¡ WebSocket callback received:",R),R&&R.allProducts){console.log(`ðŸ“¦ Merging ${R.allProducts.length} products from WebSocket`);const _=R.allProducts.filter(X=>X.visibleToCashier!==!1&&!X.expenseOnly);c(_)}R&&R.productId!==void 0&&R.newQuantity!==void 0&&(console.log(`ðŸ“¦ Stock update for product ${R.productId}: ${R.newQuantity}${R.unit||""}`),c(_=>_.map(xe=>xe.id===R.productId?{...xe,quantity:R.newQuantity}:xe))),R&&R.discounts&&(console.log("ðŸ“Š Discount list updated"),ne(R.discounts)),R&&R.sale&&(console.log("ðŸ’° Sale detected, reloading stats"),Je())}).catch(R=>{console.warn("âš ï¸ WebSocket connection failed:",R)});const L=In(R=>{try{if(!R)return;console.log("ðŸ“¨ Product subscription message:",R.type),(R.type==="initial"||R.type==="products_snapshot"||R.type==="product_created"||R.type==="product_updated"||R.type==="product_deleted")&&we.getAll().then(_=>{const X=_.filter(xe=>xe.visibleToCashier!==!1&&!xe.expenseOnly);console.log(`âœ… Subscription update: ${X.length} products`),c(X)}).catch(_=>{console.error("Failed to fetch products from subscription:",_)})}catch(_){console.error("âŒ Product subscription handler error",_)}});return()=>{try{L()}catch{}ze.disconnect()}},[]),x.useEffect(()=>{(h.length>0||b||ge)&&Y()},[h,b,ge,K,t?.id]);const Y=()=>{localStorage.setItem(`cart_${t?.id}`,JSON.stringify(h)),localStorage.setItem(`paymentMethod_${t?.id}`,b),localStorage.setItem(`taxType_${t?.id}`,ge),K&&localStorage.setItem(`selectedDiscount_${t?.id}`,JSON.stringify(K))},de=async()=>{try{tt(!0);const N=await ks.create("clock_in");wt(N),ut(!0);const L=new Date(N.clockInTime);mt(L),localStorage.setItem(`clockIn_${t?.id}_${new Date().toDateString()}`,L.toISOString()),console.log("âœ… Clocked in successfully"),alert("âœ… Clocked in successfully at "+L.toLocaleTimeString())}catch(N){console.error("Clock in failed:",N),alert("âŒ Clock in failed: "+(N.message||"Unknown error"))}finally{tt(!1)}},st=async()=>{try{tt(!0);const N=await ks.create("clock_out");wt(N),ut(!1),mt(null),localStorage.removeItem(`clockIn_${t?.id}_${new Date().toDateString()}`),console.log("âœ… Clocked out successfully");const L=N.duration?`${N.duration} minutes`:"unknown duration";alert("âœ… Clocked out successfully. Duration: "+L)}catch(N){console.error("Clock out failed:",N),alert("âŒ Clock out failed: "+(N.message||"Unknown error"))}finally{tt(!1)}},Ge=async()=>{try{const N=await ks.getStatus();N.isClockedIn?(ut(!0),mt(new Date(N.clockInTime)),wt(N),console.log("âœ… User is clocked in since:",N.clockInTime)):(ut(!1),mt(null),wt(null),console.log("User is not clocked in"))}catch(N){console.warn("Failed to check clock status:",N),ut(!1),mt(null)}},Je=async()=>{try{const[N,L,R,_,X,xe]=await Promise.all([we.getAll(),zs.getAll(),Ms.getAll(),ii.get(),Rs.getAll(),Ht.getAll().catch(()=>[])]);c(N.filter($e=>$e.visibleToCashier!==!1&&!$e.expenseOnly)),g({sales:L,expenses:R,stats:_}),d(X),ne(xe||[])}catch(N){console.error("Failed to load data:",N)}},Gs=(N,L=!0)=>{const R=N.target.files[0];if(R){const _=new FileReader;_.onload=X=>{const xe=X.target.result;H(xe),L&&$({...D,image:xe})},_.readAsDataURL(R)}},ht=N=>m.filter(R=>R.productId===N&&R.quantity>0).reduce((R,_)=>R+_.quantity,0),tl=N=>{const L=ht(N.id);if(L<=0){alert("Product is out of stock!");return}const R=h.find(X=>X.id===N.id);if((R?R.quantity:0)>=L){alert(`Only ${L} units available in stock!`);return}u(R?h.map(X=>X.id===N.id?{...X,quantity:X.quantity+1}:X):[...h,{...N,quantity:1}])},Js=(N,L)=>{l.find(_=>_.id===N);const R=ht(N);u(h.map(_=>{if(_.id===N){const X=_.quantity+L;return X>R?(alert(`Only ${R} units available!`),_):{..._,quantity:Math.max(1,X)}}return _}).filter(_=>_.quantity>0))},sl=N=>{u(h.filter(L=>L.id!==N))},Ve=h.reduce((N,L)=>N+L.price*L.quantity,0),al=async()=>{if(console.log("ðŸ›’ [Checkout] Starting optimized checkout flow"),h.length===0||qt){console.log("âš ï¸ [Checkout] Blocked: cart empty or already processing");return}xs(!0),tt(!0);const N=[...h],L={...St},R=K,_=ge;try{const X=h.reduce((J,fs)=>J+fs.price*fs.quantity,0),xe=K?K.type==="percentage"?X*K.value/100:K.value:0;let $e=0,Z=0;ge==="inclusive"?($e=X/1.16*.16,Z=X-xe):($e=(X-xe)*.16,Z=X-xe+$e);const Ae=h.map(J=>({productId:J.id,quantity:J.quantity,unit:St[J.id]||J.unit||"piece",price:J.price,name:J.name}));console.log("ðŸ’³ [Checkout] Processing sale:",{items:Ae.length,total:Z,discount:xe,tax:$e});const xt=await Qo({items:Ae,total:Z,discount:xe,tax:$e,taxType:ge,paymentMethod:b,shiftId:Hs?.id},J=>{console.log("âš¡ [Checkout] Optimistic update:",J.action),u([]),kt({}),qe(null),et("exclusive")},J=>{if(console.log(`âœ… [Checkout] Sale completed in ${J.clientElapsedMs.toFixed(1)}ms ${J.performanceGrade}`),J.updatedProducts&&J.updatedProducts.length>0)c(J.updatedProducts),console.log("ðŸ“¦ [Checkout] Products updated from server");else{const je=ix(l,J.stockDeductions);c(je),console.log("ðŸ“¦ [Checkout] Products updated optimistically")}el();const fs={id:J.saleId,items:Ae,total:Z,discount:xe,tax:$e,taxType:ge,paymentMethod:b,accountId:t?.accountId,cashierId:t?.id,cashierName:t?.name||"Cashier",stockDeductions:J.stockDeductions||{},createdAt:J.timestamp||new Date().toISOString()};g(je=>({...je,sales:[fs,...je.sales]}));const cl=J.stockDeductions?.products?.map?.(je=>`${je.name||je.productName}: -${je.quantity||je.deducted}${je.unit||""}`).join(`
`)||"Stock updated";if(alert(`âœ… SALE COMPLETE!

Sale ID: #${J.saleId}
Amount: KSH ${Z.toLocaleString()}
Time: ${J.processingTime||J.clientElapsedMs.toFixed(1)+"ms"}
Performance: ${J.performanceGrade}

Stock Deducted:
${cl}`),J.lowStockWarnings&&J.lowStockWarnings.length>0){const je=J.lowStockWarnings.map(zt=>`âš ï¸ ${zt.name}: ${zt.quantity}${zt.unit} (Low Stock!)`).join(`
`);console.warn(`âš ï¸ [Checkout] Low stock warnings:
`+je),setTimeout(()=>alert(`Low Stock Alert:

`+je),1e3)}setTimeout(()=>{we.getAll().then(je=>{const zt=je.filter(wn=>wn.visibleToCashier!==!1&&!wn.expenseOnly);c(zt),console.log("ðŸ”„ [Checkout] Background refresh complete")}).catch(je=>console.warn("Background refresh failed:",je))},100)},J=>{console.error(`âŒ [Checkout] Failed after ${J.elapsedMs.toFixed(1)}ms:`,J.error),J.needsRollback&&(u(N),kt(L),qe(R),et(_),console.log("ðŸ”„ [Checkout] Rolled back to previous state")),alert(`âŒ Sale Failed:

${J.error}

Please try again.`)});console.log("âœ… [Checkout] Transaction completed successfully")}catch(X){console.error("âŒ [Checkout] Unexpected error:",X),u(N),kt(L),qe(R),et(_),alert(`âŒ Checkout Failed:

${X.message||"Unknown error occurred"}

Your cart has been restored.`)}finally{xs(!1),tt(!1)}},nl=async N=>{N.preventDefault();try{console.log("âž• Creating new product:",D.name);const L=await we.create({...D,price:parseFloat(D.price),cost:parseFloat(D.cost||0),quantity:0,visibleToCashier:!0,expenseOnly:!1});console.log("âœ… Product created:",L),L&&c(R=>[...R,L]),$({name:"",price:"",cost:"",category:"finished",image:""}),H(""),O(!1),console.log("âœ… Product added successfully and visible in POS!"),alert("âœ… Product added successfully!")}catch(L){console.error("âŒ Failed to add product:",L.message,L),alert(`âŒ Failed to add product: ${L.message||"Unknown error"}`)}},rl=async N=>{N.preventDefault();try{const L=Array.isArray(m)?m:[],_={id:L.length>0?Math.max(...L.map(X=>X.id||0))+1:1,productId:B.id,quantity:parseInt(G.quantity),expiryDate:G.expiryDate,batchNumber:G.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(G.cost||B.cost||0)};d(X=>[...X,_]),await Rs.create({productId:B.id,quantity:parseInt(G.quantity),expiryDate:G.expiryDate,batchNumber:G.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(G.cost||B.cost||0)}),me({quantity:"",expiryDate:"",batchNumber:"",cost:""}),C(!1),E(null),await Je(),alert("Stock added successfully!")}catch(L){console.error("Failed to add stock:",L),alert("Failed to add stock")}},il=async N=>{N.preventDefault();try{await Ms.create({...T,amount:parseFloat(T.amount)}),M({description:"",amount:"",category:""}),ae(!1),await Je()}catch(L){console.error("Failed to add expense:",L),alert("Failed to add expense")}},ol=async N=>{if(N.preventDefault(),!te.customerName||!te.amount){alert("Please fill in all required fields");return}S(!0);try{const L=await Ss.create({customerName:te.customerName,amount:parseFloat(te.amount),reason:te.reason,notes:te.notes});console.log("âœ… Credit request submitted:",L),he({customerName:"",amount:"",reason:"",notes:""}),re(!1),alert("âœ… Credit request submitted successfully!")}catch(L){console.error("Failed to submit credit request:",L),alert("âŒ Failed to submit credit request: "+(L.message||"Unknown error"))}finally{S(!1)}},ll=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses? This action cannot be undone."))try{const N=localStorage.getItem("token"),R=await fetch(`${le}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!R.ok){const _=await R.json();throw new Error(_.message||"Failed to clear data")}g({sales:[],expenses:[],stats:{totalSales:0,totalExpenses:0,profit:0}}),u([]),alert("Data cleared successfully!"),await Je()}catch(N){console.error("Failed to clear data:",N),alert("Failed to clear data: "+N.message)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[e.jsx(tx,{}),e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Cashier Dashboard"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cashier Plan - KSH 900/month"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),oe&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-green-600 font-semibold",children:"ðŸŸ¢ Clocked In"}),e.jsxs("button",{onClick:st,className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-600 hover:bg-red-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(Dl,{className:"w-4 h-4"}),"Clock Out"]})]}),!oe&&e.jsxs("button",{onClick:de,className:"px-4 py-2 rounded-lg font-medium transition-all bg-green-600 hover:bg-green-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(si,{className:"w-4 h-4"}),"Clock In"]}),e.jsxs("button",{onClick:()=>{Y(),s()},className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-100 hover:bg-red-200 text-red-600 border border-red-300 flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),"Logout"]}),e.jsxs("button",{onClick:ll,className:"px-4 py-2 rounded-lg font-medium transition-all bg-orange-100 hover:bg-orange-200 text-orange-600 border border-orange-300 flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),"Clear"]}),e.jsxs("button",{onClick:()=>re(!0),className:"px-4 py-2 rounded-lg font-medium transition-all bg-blue-100 hover:bg-blue-200 text-blue-600 border border-blue-300 flex items-center gap-2",children:[e.jsx(jt,{className:"w-4 h-4"}),"Request Credit"]}),oe&&hs&&e.jsx("div",{className:"ml-auto text-right text-xs",children:e.jsxs("p",{className:"text-green-600 font-semibold flex items-center gap-1",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Clocked In: ",hs.toLocaleTimeString()]})})]})]})}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>j("pos"),className:`px-6 py-2 rounded-lg font-medium transition-all ${y==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Yt,{className:"w-4 h-4 inline mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>j("monitor"),className:`px-6 py-2 rounded-lg font-medium transition-all ${y==="monitor"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(ga,{className:"w-4 h-4 inline mr-2"}),"Monitor"]}),e.jsxs("button",{onClick:()=>j("products"),className:`px-6 py-2 rounded-lg font-medium transition-all ${y==="products"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(ot,{className:"w-4 h-4 inline mr-2"}),"Products"]}),e.jsxs("button",{onClick:()=>j("expenses"),className:`px-6 py-2 rounded-lg font-medium transition-all ${y==="expenses"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(ss,{className:"w-4 h-4 inline mr-2"}),"Expenses"]})]}),y==="pos"&&e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:f,onChange:N=>k(N.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:l.filter(N=>N.name?.toLowerCase().includes(f.toLowerCase())).map(N=>{const L=ht(N.id),R=L<10,_=L<=0;return e.jsxs("button",{onClick:()=>tl(N),disabled:_,className:`card text-left hover:shadow-xl transition-all transform hover:scale-105 relative ${_?"opacity-50 cursor-not-allowed bg-gray-100":"bg-gradient-to-br from-white to-gray-50"}`,children:[N.image&&e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:N.image,alt:N.name,className:"w-full h-full object-cover"})}),R&&!_&&e.jsx("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white p-1 rounded-full",children:e.jsx(Mt,{className:"w-4 h-4"})}),_&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"OUT"}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-900",children:N.name}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["KSH ",N.price?.toLocaleString()]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:`text-xs font-medium ${_?"text-red-600":R?"text-yellow-600":"text-gray-500"}`,children:["Stock: ",L]}),R&&!_&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium",children:"Low Stock"})]})]},N.id)})})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-gray-200 p-6 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(Yt,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[h.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:h.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(Yt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:h.map(N=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:N.name}),e.jsx("button",{onClick:()=>sl(N.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(Fe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Js(N.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(Il,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-semibold",children:N.quantity}),e.jsx("button",{onClick:()=>Js(N.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(Ie,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(N.price*N.quantity).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2 items-center mt-2",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-600",children:"Unit:"}),e.jsxs("select",{value:St[N.id]||N.unit||"piece",onChange:L=>{kt({...St,[N.id]:L.target.value})},className:"text-xs px-2 py-1 border border-gray-300 rounded bg-white",children:[e.jsx("option",{value:"piece",children:"Piece"}),e.jsx("option",{value:"kg",children:"Kilogram (kg)"}),e.jsx("option",{value:"g",children:"Grams (g)"}),e.jsx("option",{value:"l",children:"Liters (L)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",max:"999",placeholder:"qty",defaultValue:N.quantity,className:"text-xs px-2 py-1 border border-gray-300 rounded w-16",onChange:L=>{const R=parseFloat(L.target.value);!isNaN(R)&&R>0&&Js(N.id,R-N.quantity)}})]})]},N.id))})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"text-gray-700",children:["KSH ",Ve.toLocaleString()]})]}),K&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-KSH ",(K.type==="percentage"?Ve*K.value/100:K.value).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-orange-600",children:[e.jsxs("span",{children:["Tax (",ge==="exclusive"?"Added":"Included","):"]}),e.jsxs("span",{children:[ge==="exclusive"?"+":"","KSH ",((Ve-(K?K.type==="percentage"?Ve*K.value/100:K.value:0))*.16).toLocaleString()]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Final Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(ge==="exclusive"?Ve-(K?K.type==="percentage"?Ve*K.value/100:K.value:0)+(Ve-(K?K.type==="percentage"?Ve*K.value/100:K.value:0))*.16:Ve-(K?K.type==="percentage"?Ve*K.value/100:K.value:0)).toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Discount (Optional)"}),e.jsxs("select",{value:K?.id||"",onChange:N=>{N.target.value?qe(W.find(L=>L.id===parseInt(N.target.value))):qe(null)},className:"input",children:[e.jsx("option",{value:"",children:"No Discount"}),W.filter(N=>N.active).map(N=>e.jsxs("option",{value:N.id,children:[N.name," - ",N.type==="percentage"?`${N.value}%`:`KSH ${N.value}`]},N.id))]}),K&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Discount: KSH ",(K.type==="percentage"?Ve*K.value/100:K.value).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tax Type"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"exclusive",checked:ge==="exclusive",onChange:N=>et(N.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Exclusive (16% added)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"inclusive",checked:ge==="inclusive",onChange:N=>et(N.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Inclusive"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:b,onChange:N=>p(N.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:()=>{try{console.log("ðŸ›’ Complete Sale button clicked"),al()}catch(N){console.error("âŒ Button handler error:",N),alert(`Error: ${N.message}`)}},disabled:h.length===0||qt,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:qt?"â³ Processing Sale...":"Complete Sale"})]})]})]}),y==="monitor"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",v.stats.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Lt,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",v.stats.totalExpenses?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(ss,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",v.stats.profit?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Lt,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Sales"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock Deducted"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"})]})}),e.jsx("tbody",{children:v.sales&&v.sales.slice(-15).reverse().map((N,L)=>{const R=N.stockDeductions?.products?.slice(0,2).map(_=>`${_.name}: -${_.deducted}${_.unit}`).join(", ")+(N.stockDeductions?.products?.length>2?"...":"")||"None";return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:new Date(N.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[N.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:N.paymentMethod||"cash"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-orange-600 font-semibold",children:R}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",N.total?.toLocaleString()]})]},L)})})]})})]}),e.jsxs("div",{className:"card shadow-lg mt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ot,{className:"w-5 h-5 text-orange-600"}),"Stock Deductions Log"]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-orange-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Sale ID"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Before"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Deducted"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"After"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Unit"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Time"})]})}),e.jsx("tbody",{children:v.sales&&v.sales.slice(-20).reverse().map(N=>N.stockDeductions?.products?.map((L,R)=>e.jsxs("tr",{className:"border-t border-orange-100 hover:bg-orange-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 font-medium text-blue-600",children:["#",N.id]}),e.jsx("td",{className:"px-4 py-3",children:L.name}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:L.before}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-red-600",children:["-",L.deducted]}),e.jsx("td",{className:"px-4 py-3 font-semibold text-green-600",children:L.after}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:L.unit}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-500",children:new Date(N.createdAt).toLocaleTimeString()})]},`${N.id}-${R}`)))})]}),(!v.sales||v.sales.length===0||!v.sales.some(N=>N.stockDeductions?.products?.length>0))&&e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No stock deductions yet"})]})]})]}),e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Manage Products & Stock"}),e.jsxs("button",{onClick:()=>O(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Add Product"]})]}),I&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl border-2 border-green-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Product"}),e.jsxs("form",{onSubmit:nl,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:D.name,onChange:N=>$({...D,name:N.target.value}),required:!0}),e.jsxs("select",{className:"input",value:D.category,onChange:N=>$({...D,category:N.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsx("input",{type:"number",placeholder:"Selling Price",className:"input",value:D.price,onChange:N=>$({...D,price:N.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Cost Price (Optional)",className:"input",value:D.cost,onChange:N=>$({...D,cost:N.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:N=>Gs(N,!0),className:"input"}),e.jsx(Qr,{className:"w-5 h-5 text-gray-400"})]}),q&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:q,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{O(!1),H(""),$({name:"",price:"",cost:"",category:"finished",image:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),F&&B&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"font-semibold mb-4 text-lg",children:["Add Stock for ",B.name]}),e.jsxs("form",{onSubmit:rl,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:G.quantity,onChange:N=>me({...G,quantity:N.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:G.expiryDate,onChange:N=>me({...G,expiryDate:N.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:G.batchNumber,onChange:N=>me({...G,batchNumber:N.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per Unit",className:"input",value:G.cost,onChange:N=>me({...G,cost:N.target.value})}),e.jsxs("div",{className:"flex gap-2 md:col-span-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{C(!1),E(null),me({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:l.map(N=>{const L=ht(N.id),R=m.filter(X=>X.productId===N.id&&X.quantity>0),_=L<10;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[N.image&&e.jsx("img",{src:N.image,alt:N.name,className:"w-10 h-10 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:N.name}),e.jsx("div",{className:"text-xs text-gray-500",children:N.category})]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",N.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium ${L===0?"text-red-600":_?"text-yellow-600":"text-gray-900"}`,children:L}),_&&L>0&&e.jsx(Mt,{className:"w-4 h-4 text-yellow-500"}),L===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"text-gray-600",children:[R.length," active"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{E(N),C(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-green-50 rounded-lg text-green-600 transition-colors",title:"Edit Product",children:e.jsx(Nt,{className:"w-4 h-4"})})]})})]},N.id)})})]})})]})}),")}",y==="expenses"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Track Expenses"}),e.jsxs("button",{onClick:()=>ae(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Add Expense"]})]}),fe&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border-2 border-red-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Expense"}),e.jsxs("form",{onSubmit:il,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:T.description,onChange:N=>M({...T,description:N.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Amount",className:"input",value:T.amount,onChange:N=>M({...T,amount:N.target.value}),required:!0}),e.jsx("input",{type:"text",placeholder:"Category",className:"input",value:T.category,onChange:N=>M({...T,category:N.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>ae(!1),className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:v.expenses.slice().reverse().map((N,L)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(N.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:N.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:N.category||"General"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",N.amount?.toLocaleString()]})]},L))})]})})]})}),se&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 p-6 text-white flex justify-between items-center sticky top-0",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(jt,{}),"Request Credit"]}),e.jsx("button",{onClick:()=>re(!1),className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(_e,{size:24})})]}),e.jsxs("form",{onSubmit:ol,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name *"}),e.jsx("input",{type:"text",placeholder:"Enter customer name",value:te.customerName,onChange:N=>he({...te,customerName:N.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:P})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Amount (KES) *"}),e.jsx("input",{type:"number",placeholder:"0.00",value:te.amount,onChange:N=>he({...te,amount:N.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"0",step:"0.01",required:!0,disabled:P})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Reason"}),e.jsxs("select",{value:te.reason,onChange:N=>he({...te,reason:N.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:P,children:[e.jsx("option",{value:"",children:"Select reason..."}),e.jsx("option",{value:"regular_customer",children:"Regular Customer"}),e.jsx("option",{value:"emergency",children:"Emergency"}),e.jsx("option",{value:"bulk_order",children:"Bulk Order"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),e.jsx("textarea",{placeholder:"Add any additional notes...",value:te.notes,onChange:N=>he({...te,notes:N.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3",disabled:P})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"submit",disabled:P,className:"flex-1 bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 rounded-lg font-bold hover:shadow-lg transition disabled:opacity-50 disabled:cursor-not-allowed",children:P?"Submitting...":"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>re(!1),disabled:P,className:"flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition disabled:opacity-50",children:"Cancel"})]})]})]})}),e.jsx(ex,{isLocked:r,onUnlock:i,userPin:t?.pin||"1234",userName:t?.name})]})}function lx(){const[t,s]=x.useState({totalSales:0,totalExpenses:0,netProfit:0,transactionCount:0}),[a,n]=x.useState(!0);return x.useEffect(()=>{const r=async()=>{try{const i=localStorage.getItem("token"),c=await(await fetch("http://localhost:5000/api/v2/monitor/stats",{headers:{Authorization:`Bearer ${i}`}})).json();s(c),n(!1)}catch(i){console.error("Failed to fetch stats:",i),n(!1)}};r();const o=setInterval(r,2e3);return()=>clearInterval(o)},[]),a?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin",children:e.jsx(rt,{size:48,className:"text-blue-600"})}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading statistics..."})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-6 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Sales"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-2",children:t.totalSales.toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:[t.transactionCount," transactions"]})]}),e.jsx(Ye,{size:48,className:"text-green-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-red-50 to-red-100 rounded-lg p-6 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Expenses"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 mt-2",children:t.totalExpenses.toLocaleString()}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"Today's costs"})]}),e.jsx(ss,{size:48,className:"text-red-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Net Profit"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 mt-2",children:t.netProfit.toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:[t.totalSales>0?`${(t.netProfit/t.totalSales*100).toFixed(1)}%`:"0%"," margin"]})]}),e.jsx(rt,{size:48,className:"text-blue-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-6 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Profit %"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-600 mt-2",children:[t.totalSales>0?(t.netProfit/t.totalSales*100).toFixed(1):"0","%"]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"Profitability"})]}),e.jsx(Ye,{size:48,className:"text-purple-600 opacity-50"})]})})]})}function cx({shiftId:t,onClockOut:s}){const[a,n]=x.useState(null),[r,o]=x.useState(!0),[i,l]=x.useState("00:00:00");x.useEffect(()=>{if(!t)return;(async()=>{try{const d=localStorage.getItem("token"),u=await(await fetch("http://localhost:5000/api/v2/shifts/current",{headers:{Authorization:`Bearer ${d}`}})).json();u.shift&&n(u.shift),o(!1)}catch(d){console.error("Failed to fetch shift:",d),o(!1)}})()},[t]),x.useEffect(()=>{if(!a||!a.clockInTime)return;const m=setInterval(()=>{const d=new Date(a.clockInTime),u=Math.floor((new Date-d)/1e3),b=Math.floor(u/3600),p=Math.floor(u%3600/60),y=u%60;l(`${String(b).padStart(2,"0")}:${String(p).padStart(2,"0")}:${String(y).padStart(2,"0")}`)},1e3);return()=>clearInterval(m)},[a]);const c=async()=>{if(t)try{const m=localStorage.getItem("token"),h=await(await fetch("http://localhost:5000/api/v2/shifts/clock-out",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({shiftId:t})})).json();h.success?(alert(`âœ… Clock Out Successful!

Total Sales: ${h.totalSales.toLocaleString()}
Total Expenses: ${h.totalExpenses.toLocaleString()}`),s()):alert(`âŒ Error: ${h.error}`)}catch(m){console.error("Clock out failed:",m),alert("Clock out failed")}};return r?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin",children:e.jsx(Ze,{size:48,className:"text-blue-600"})}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading shift information..."})]}):a?e.jsx("div",{className:"bg-white rounded-lg shadow-md p-8 max-w-md mx-auto",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{size:64,className:"mx-auto text-blue-600 mb-6"}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-6 mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Shift Duration"}),e.jsx("p",{className:"text-5xl font-bold text-blue-600 font-mono",children:i}),e.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:["Started: ",new Date(a.clockInTime).toLocaleTimeString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Sales"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.totalSales.toLocaleString()})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Expenses"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:a.totalExpenses.toLocaleString()})]})]}),e.jsxs("button",{onClick:c,className:"w-full bg-red-600 text-white py-3 rounded-lg font-bold hover:bg-red-700 flex items-center justify-center gap-2 transition-colors",children:[e.jsx(He,{size:20}),"Clock Out"]})]})}):e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[e.jsx(it,{size:48,className:"mx-auto text-yellow-600 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"No Active Shift"}),e.jsx("p",{className:"text-gray-600",children:"Please return to POS to start a new shift."})]})}function Bt(){const{user:t}=be(),s=Te(),[a,n]=x.useState("pos"),[r,o]=x.useState(null),[i,l]=x.useState([]),[c,m]=x.useState([]),[d,h]=x.useState(""),[u,b]=x.useState(0),[p,y]=x.useState(0),[j,v]=x.useState(!1);x.useEffect(()=>{(async()=>{try{console.log("ðŸ• [GenericPOS] Initiating clock-in..."),await nx(D=>{D.success&&D.shiftId&&(o(D.shiftId),console.log(`âœ… [GenericPOS] Clocked in: Shift ${D.shiftId} (${D.elapsedMs.toFixed(1)}ms)`))})}catch(D){console.error("âŒ [GenericPOS] Clock-in failed:",D)}})()},[]),x.useEffect(()=>{(async()=>{try{const D=localStorage.getItem("token"),G=await(await fetch("http://localhost:5000/api/products",{headers:{Authorization:`Bearer ${D}`}})).json();m(G||[])}catch(D){console.error("Failed to fetch products:",D)}})()},[]);const g=c.filter(E=>E.name.toLowerCase().includes(d.toLowerCase())),f=E=>{const D=i.find($=>$.productId===E.id);D?(D.quantity+=1,l([...i])):l([...i,{productId:E.id,name:E.name,price:E.price,quantity:1}])},k=E=>{l(i.filter(D=>D.productId!==E))},I=async()=>{if(i.length===0){alert("Please add items to the sale");return}if(j){console.log("âš ï¸ [GenericPOS] Sale already in progress");return}v(!0);const E=[...i],D=u,$=p;try{const G=i.reduce((ae,se)=>ae+se.price*se.quantity,0),me=G*p/100,fe=G+me-u;console.log("ðŸ’³ [GenericPOS] Starting sale transaction"),await Qo({items:i,total:fe,discount:u,tax:me,taxType:"exclusive",paymentMethod:"cash",shiftId:r},ae=>{console.log("âš¡ [GenericPOS] Optimistic update:",ae.action),l([]),b(0),y(0)},ae=>{console.log(`âœ… [GenericPOS] Sale completed in ${ae.clientElapsedMs.toFixed(1)}ms ${ae.performanceGrade}`),el(),alert(`âœ… Sale Completed!

Sale ID: ${ae.saleId}
Amount: KSH ${fe.toLocaleString()}
Time: ${ae.processingTime}
Performance: ${ae.performanceGrade}`)},ae=>{console.error(`âŒ [GenericPOS] Sale failed after ${ae.elapsedMs.toFixed(1)}ms:`,ae.error),ae.needsRollback&&(l(E),b(D),y($),console.log("ðŸ”„ [GenericPOS] Rolled back to previous state")),alert(`âŒ Error: ${ae.error}`)})}catch(G){console.error("âŒ [GenericPOS] Unexpected error:",G),l(E),b(D),y($),alert(`âŒ Sale failed: ${G.message||"Unknown error occurred"}`)}finally{v(!1)}};if(!t)return s("/auth/login"),null;const O=[{id:"pos",label:"POS",icon:Yt},{id:"monitor",label:"Monitor",icon:Ye},{id:"shift",label:"Shift",icon:Ze}],F=i.reduce((E,D)=>E+D.price*D.quantity,0),C=F*p/100,B=F+C-u;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Cashier POS"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Welcome, ",t.name]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Shift ID: ",r||"Not Started"]})})]})})}),e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4",children:e.jsx("div",{className:"flex gap-4",children:O.map(E=>{const D=E.icon;return e.jsxs("button",{onClick:()=>n(E.id),className:`flex items-center gap-2 px-4 py-3 font-medium transition-colors ${a===E.id?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(D,{size:18}),E.label]},E.id)})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[a==="pos"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsx("input",{type:"text",placeholder:"Search products...",value:d,onChange:E=>h(E.target.value),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:g.map(E=>e.jsxs("button",{onClick:()=>f(E),className:"p-4 border rounded-lg hover:bg-blue-50 transition-colors text-left",children:[e.jsx("p",{className:"font-semibold text-sm",children:E.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Stock: ",E.quantity||0]}),e.jsx("p",{className:"text-lg font-bold text-blue-600 mt-2",children:E.price})]},E.id))}),g.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(it,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No products found"})]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 sticky top-24",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Cart"}),e.jsx("div",{className:"space-y-3 mb-6 max-h-96 overflow-y-auto",children:i.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No items selected"}):i.map(E=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm",children:E.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:[E.quantity," Ã— ",E.price]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-bold text-sm",children:(E.price*E.quantity).toLocaleString()}),e.jsx("button",{onClick:()=>k(E.productId),className:"text-red-600 hover:text-red-700",children:"âœ•"})]})]},E.productId))}),e.jsxs("div",{className:"space-y-2 border-t pt-4 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{className:"font-semibold",children:F.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Discount:"}),e.jsx("input",{type:"number",value:u,onChange:E=>b(parseFloat(E.target.value)||0),className:"w-24 px-2 py-1 border rounded"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Tax (%):"}),e.jsx("input",{type:"number",value:p,onChange:E=>y(parseFloat(E.target.value)||0),className:"w-24 px-2 py-1 border rounded"})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[e.jsx("span",{children:"TOTAL:"}),e.jsx("span",{className:"text-green-600",children:B.toLocaleString()})]})]}),e.jsx("button",{onClick:I,disabled:j||i.length===0,className:"w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 disabled:bg-gray-400 transition-colors",children:j?"Processing...":"âœ“ Complete Sale"})]})})]}),a==="monitor"&&e.jsx(lx,{}),a==="shift"&&e.jsx(cx,{shiftId:r,onClockOut:()=>s("/auth/login")})]})]})}function dx(){const{user:t,logout:s}=be(),a=Te(),[n,r]=x.useState({sales:0,count:0});return x.useEffect(()=>{const o=JSON.parse(localStorage.getItem("dayStats")||'{"sales": 0, "count": 0}');r(o)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-900 to-amber-700",children:[e.jsx("div",{className:"bg-amber-900 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(El,{size:32,className:"text-amber-300"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Bar POS"}),e.jsx("p",{className:"text-amber-200 text-sm",children:"Drinks & Beverages"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-amber-200 text-sm",children:"Today's Sales"}),e.jsxs("p",{className:"text-2xl font-bold text-green-400",children:[n.sales.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-amber-300 text-xs",children:[n.count," transactions"]})]}),e.jsxs("button",{onClick:()=>{s(),a("/auth/login")},className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition",children:[e.jsx(He,{size:20}),"Logout"]})]})]})})}),e.jsx("div",{className:"bg-amber-800 text-white border-b border-amber-700",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-amber-600 rounded-lg font-semibold",children:"ðŸº Beer"}),e.jsx("div",{className:"px-4 py-2 hover:bg-amber-700 rounded-lg cursor-pointer transition",children:"ðŸ· Wine"}),e.jsx("div",{className:"px-4 py-2 hover:bg-amber-700 rounded-lg cursor-pointer transition",children:"ðŸ¥ƒ Spirits"}),e.jsx("div",{className:"px-4 py-2 hover:bg-amber-700 rounded-lg cursor-pointer transition",children:"ðŸ§Š Mixers"}),e.jsx("div",{className:"px-4 py-2 hover:bg-amber-700 rounded-lg cursor-pointer transition",children:"ðŸ¸ Cocktails"})]})}),e.jsx("div",{className:"bg-amber-50",children:e.jsx(Bt,{businessType:"bar"})}),e.jsx("div",{className:"bg-amber-900 text-white py-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(rt,{size:16,className:"text-yellow-400"}),e.jsx("p",{className:"text-sm",children:"Fast checkout â€¢ Age verification on premium items â€¢ Real-time inventory"})]})})]})}function ux(){const{user:t,logout:s}=be(),a=Te(),[n,r]=x.useState(""),[o,i]=x.useState({revenue:0,patients:0});return x.useEffect(()=>{const l=JSON.parse(localStorage.getItem("dayStats")||'{"revenue": 0, "patients": 0}');i(l)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100",children:[e.jsx("div",{className:"bg-red-700 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ll,{size:32,className:"text-red-200"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Hospital POS"}),e.jsx("p",{className:"text-red-200 text-sm",children:"Patient Billing System"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-red-200 text-sm",children:"Daily Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-green-300",children:[o.revenue.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-red-200 text-xs",children:[o.patients," patients served"]})]}),e.jsxs("button",{onClick:()=>{s(),a("/auth/login")},className:"flex items-center gap-2 bg-red-900 hover:bg-red-950 px-4 py-2 rounded-lg transition",children:[e.jsx(He,{size:20}),"Logout"]})]})]})})}),e.jsx("div",{className:"bg-white border-b shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ls,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search patient by ID or name...",value:n,onChange:l=>r(l.target.value),className:"w-full pl-10 pr-4 py-2 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"})]}),e.jsxs("button",{className:"bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg transition flex items-center gap-2",children:[e.jsx(Ze,{size:18}),"Recent Patients"]})]})})}),e.jsx("div",{className:"bg-gray-100 border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-red-600 text-white rounded-lg font-semibold",children:"ðŸ¥ Services"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ’Š Medicines"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ§ª Lab Tests"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ“‹ Procedures"})]})}),e.jsx("div",{className:"bg-white",children:e.jsx(Bt,{businessType:"hospital"})}),e.jsx("div",{className:"bg-red-700 text-white py-4 text-center",children:e.jsx("p",{className:"text-sm",children:"Patient records integrated â€¢ Invoice generation â€¢ Real-time inventory tracking"})})]})}function mx(){const{user:t,logout:s}=be(),a=Te(),[n,r]=x.useState(""),[o,i]=x.useState({feesCollected:0,transactions:0});return x.useEffect(()=>{const l=JSON.parse(localStorage.getItem("dayStats")||'{"feesCollected": 0, "transactions": 0}');i(l)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-blue-100",children:[e.jsx("div",{className:"bg-blue-700 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ml,{size:32,className:"text-blue-200"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"School POS"}),e.jsx("p",{className:"text-blue-200 text-sm",children:"Student & Fee Management"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-blue-200 text-sm",children:"Fees Collected Today"}),e.jsxs("p",{className:"text-2xl font-bold text-green-300",children:[o.feesCollected.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-blue-200 text-xs",children:[o.transactions," transactions"]})]}),e.jsxs("button",{onClick:()=>{s(),a("/auth/login")},className:"flex items-center gap-2 bg-blue-900 hover:bg-blue-950 px-4 py-2 rounded-lg transition",children:[e.jsx(He,{size:20}),"Logout"]})]})]})})}),e.jsx("div",{className:"bg-white border-b shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Rt,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search student by name, admission number, or class...",value:n,onChange:l=>r(l.target.value),className:"w-full pl-10 pr-4 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition flex items-center gap-2",children:[e.jsx(Rl,{size:18}),"Fee Slip"]})]})})}),e.jsx("div",{className:"bg-gray-100 border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold",children:"ðŸ’° Term Fees"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ½ï¸ Canteen"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ‘• Uniforms"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ“š Books"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"âœï¸ Supplies"})]})}),e.jsx("div",{className:"bg-white",children:e.jsx(Bt,{businessType:"school"})}),e.jsx("div",{className:"bg-blue-700 text-white py-4 text-center",children:e.jsx("p",{className:"text-sm",children:"Student records linked â€¢ Receipt generation â€¢ Year-end reports"})})]})}function hx(){const{user:t,logout:s}=be(),a=Te(),[n,r]=x.useState({sales:0,itemsSold:0,lowStockItems:0});return x.useEffect(()=>{const o=JSON.parse(localStorage.getItem("dayStats")||'{"sales": 0, "itemsSold": 0, "lowStockItems": 0}');r(o)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-green-100",children:[e.jsx("div",{className:"bg-green-700 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ol,{size:32,className:"text-green-200"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Kiosk POS"}),e.jsx("p",{className:"text-green-200 text-sm",children:"Fast & Simple Checkout"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-green-200 text-sm",children:"Today's Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-300",children:[n.sales.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-green-200 text-xs",children:[n.itemsSold," items sold"]})]}),e.jsxs("button",{onClick:()=>{s(),a("/auth/login")},className:"flex items-center gap-2 bg-green-900 hover:bg-green-950 px-4 py-2 rounded-lg transition",children:[e.jsx(He,{size:20}),"Logout"]})]})]})})}),n.lowStockItems>0&&e.jsx("div",{className:"bg-yellow-50 border-b border-yellow-200",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex items-center gap-2 text-yellow-800",children:[e.jsx(it,{size:20}),e.jsxs("span",{className:"font-semibold",children:[n.lowStockItems," items running low on stock"]})]})}),e.jsx("div",{className:"bg-gray-100 border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-green-600 text-white rounded-lg font-semibold",children:"ðŸª All Items"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ”Œ Electronics"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸª Food"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ¥¤ Drinks"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ›’ Supplies"})]})}),e.jsx("div",{className:"bg-white",children:e.jsx(Bt,{businessType:"kiosk"})}),e.jsxs("div",{className:"bg-green-700 text-white py-4 text-center flex items-center justify-center gap-2",children:[e.jsx(rt,{size:18,className:"text-yellow-300"}),e.jsx("p",{className:"text-sm",children:"Lightning-fast checkout â€¢ Low stock alerts â€¢ Real-time updates"})]})]})}function xx(){const{user:t,logout:s}=be(),a=Te(),[n,r]=x.useState("1"),[o,i]=x.useState({revenue:0,liters:0,pumpTotal:0});return x.useEffect(()=>{const l=JSON.parse(localStorage.getItem("dayStats")||'{"revenue": 0, "liters": 0, "pumpTotal": 0}');i(l)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 to-yellow-100",children:[e.jsx("div",{className:"bg-gradient-to-r from-yellow-600 to-yellow-700 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fl,{size:32,className:"text-yellow-200"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Petrol POS"}),e.jsx("p",{className:"text-yellow-200 text-sm",children:"Fuel & Tank Management"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-yellow-200 text-sm",children:"Daily Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-green-300",children:[o.revenue.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-yellow-200 text-xs",children:[o.liters.toLocaleString()," liters sold"]})]}),e.jsxs("button",{onClick:()=>{s(),a("/auth/login")},className:"flex items-center gap-2 bg-yellow-900 hover:bg-yellow-950 px-4 py-2 rounded-lg transition",children:[e.jsx(He,{size:20}),"Logout"]})]})]})})}),e.jsx("div",{className:"bg-white border-b shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Select Pump:"}),e.jsx("div",{className:"flex gap-3",children:[1,2,3,4,5,6].map(l=>e.jsxs("button",{onClick:()=>r(l.toString()),className:`px-6 py-2 rounded-lg font-bold transition ${n===l.toString()?"bg-yellow-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(Vl,{size:18,className:"inline mr-2"}),"Pump ",l]},l))}),e.jsxs("div",{className:"ml-auto text-right",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Pump ",n," Total"]}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600",children:[o.pumpTotal.toLocaleString()," KES"]})]})]})})}),e.jsx("div",{className:"bg-gray-100 border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-yellow-600 text-white rounded-lg font-semibold",children:"â›½ Super"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"â›½ Regular"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"â›½ Diesel"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ›¢ï¸ LPG"})]})}),e.jsx("div",{className:"bg-white",children:e.jsx(Bt,{businessType:"petrol",pumpNumber:n})}),e.jsxs("div",{className:"bg-yellow-700 text-white py-4 text-center flex items-center justify-center gap-2",children:[e.jsx(Ye,{size:18}),e.jsx("p",{className:"text-sm",children:"Pump tracking â€¢ Tank management â€¢ Shift reconciliation â€¢ Real-time readings"})]})]})}function px(){const{user:t,logout:s}=be(),a=Te(),[n,r]=x.useState({size:"",color:""}),[o,i]=x.useState({sales:0,pairs:0,topSize:""});x.useEffect(()=>{const m=JSON.parse(localStorage.getItem("dayStats")||'{"sales": 0, "pairs": 0, "topSize": ""}');i(m)},[]);const l=["5","6","7","8","9","10","11","12","13"],c=["Black","White","Brown","Blue","Red","Green","Pink","Gray"];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-purple-100",children:[e.jsx("div",{className:"bg-purple-700 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 text-purple-200",children:"ðŸ‘Ÿ"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Shoes POS"}),e.jsx("p",{className:"text-purple-200 text-sm",children:"Footwear & Variants"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-purple-200 text-sm",children:"Daily Sales"}),e.jsxs("p",{className:"text-2xl font-bold text-green-300",children:[o.sales.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-purple-200 text-xs",children:[o.pairs," pairs sold â€¢ Top: Size ",o.topSize]})]}),e.jsxs("button",{onClick:()=>{s(),a("/auth/login")},className:"flex items-center gap-2 bg-purple-900 hover:bg-purple-950 px-4 py-2 rounded-lg transition",children:[e.jsx(He,{size:20}),"Logout"]})]})]})})}),e.jsx("div",{className:"bg-white border-b shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx($l,{size:18,className:"inline mr-2"}),"Filter by Size"]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:l.map(m=>e.jsx("button",{onClick:()=>r({...n,size:m===n.size?"":m}),className:`w-10 h-10 rounded-lg font-bold transition ${n.size===m?"bg-purple-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:m},m))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx(ot,{size:18,className:"inline mr-2"}),"Filter by Color"]}),e.jsxs("select",{value:n.color,onChange:m=>r({...n,color:m.target.value}),className:"px-4 py-2 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Colors"}),c.map(m=>e.jsx("option",{value:m,children:m},m))]})]})]})})}),e.jsx("div",{className:"bg-gray-100 border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold",children:"ðŸ‘Ÿ All Shoes"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸƒ Sports"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ‘ž Formal"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ‘  Casual"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ‘¢ Boots"})]})}),e.jsx("div",{className:"bg-white",children:e.jsx(Bt,{businessType:"shoes",filters:n})}),e.jsx("div",{className:"bg-purple-700 text-white py-4 text-center",children:e.jsx("p",{className:"text-sm",children:"Variant management â€¢ Size & color tracking â€¢ Stock by variant â€¢ Real-time availability"})})]})}function Jr(){const[t,s]=x.useState([]),[a,n]=x.useState([]),[r,o]=x.useState("all"),[i,l]=x.useState(""),[c,m]=x.useState(!1),[d,h]=x.useState([]),[u,b]=x.useState({subject:"",message:""}),[p,y]=x.useState(!0),[j,v]=x.useState(null),[g,f]=x.useState(!0),[k,I]=x.useState(null),O=Te(),[F,C]=x.useState({totalUsers:0,activeUsers:0,lockedUsers:0,totalRevenue:0,pendingPayments:0,overduePayments:0}),[B,E]=x.useState([]);x.useEffect(()=>{const P=localStorage.getItem("token")||localStorage.getItem("mainAdminToken"),S=localStorage.getItem("user")||localStorage.getItem("mainAdminUser");if(!P||!S){O("/main-admin/login");return}try{if(JSON.parse(S).role!=="owner"){O("/main-admin/login");return}}catch{O("/main-admin/login");return}D().finally(()=>y(!1));const T=JSON.parse(localStorage.getItem("authActivities")||"[]");E(T.slice(0,10));const M=setInterval(()=>{const q=JSON.parse(localStorage.getItem("authActivities")||"[]");E(q.slice(0,10))},5e3);return()=>clearInterval(M)},[O]);const D=async()=>{try{v(null);let P=[],S=!0;try{P=await Xs.getUsers()}catch(T){console.warn("MainAdmin API not available, falling back to regular users API:",T.message);try{P=await gt.getAll()}catch(M){console.warn("Users API also failed:",M.message),S=!1}}P.length===0&&!S&&(P=G()),s(P),f(S),fe(P,[])}catch(P){console.error("Failed to load data:",P),v("Failed to load dashboard data");const S=G();s(S),n(me(S)),f(!1),fe(S,[])}},$=()=>{localStorage.removeItem("mainAdminToken"),localStorage.removeItem("mainAdminUser"),O("/main-admin/login")},G=()=>{const P=localStorage.getItem("user"),S=[];if(P){const M=JSON.parse(P);S.push({...M,id:M.id||"real-user"})}return[{name:"John Doe",email:"john@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Jane Smith",email:"jane@example.com",plan:"basic",price:900,active:!0,locked:!1,role:"cashier"},{name:"Bob Wilson",email:"bob@example.com",plan:"ultra",price:1600,active:!1,locked:!1,role:"admin"},{name:"Alice Brown",email:"alice@example.com",plan:"basic",price:900,active:!0,locked:!0,role:"cashier"},{name:"Mike Johnson",email:"mike@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Sarah Davis",email:"sarah@example.com",plan:"basic",price:900,active:!1,locked:!1,role:"cashier"}].forEach((M,q)=>{S.push({id:`demo-${q+1}`,...M,createdAt:new Date(Date.now()-q*864e5).toISOString(),lastLogin:new Date(Date.now()-Math.random()*864e5).toISOString()})}),S},me=P=>P.flatMap(S=>[{id:`payment-${S.id}-1`,userId:S.id,amount:S.plan==="ultra"?1600:900,status:Math.random()>.3?"paid":"pending",createdAt:new Date(Date.now()-30*864e5).toISOString(),dueDate:new Date(Date.now()+5*864e5).toISOString()},{id:`payment-${S.id}-2`,userId:S.id,amount:S.plan==="ultra"?1600:900,status:Math.random()>.7?"paid":Math.random()>.5?"pending":"overdue",createdAt:new Date(Date.now()-60*864e5).toISOString(),dueDate:new Date(Date.now()-5*864e5).toISOString()}]),fe=(P,S)=>{const T=P.length,M=P.filter(K=>K.active).length,q=P.filter(K=>K.locked).length,H=S.filter(K=>K.status==="paid").reduce((K,qe)=>K+qe.amount,0),W=S.filter(K=>K.status==="pending").length,ne=S.filter(K=>K.status==="overdue").length;C({totalUsers:T,activeUsers:M,lockedUsers:q,totalRevenue:H,pendingPayments:W,overduePayments:ne})},ae=async(P,S)=>{try{I(P);const T=!S;try{await Xs.lockUser(P,T);const M=t.map(W=>W.id===P?{...W,locked:T,active:!T}:W);s(M),fe(M,a);const q=t.find(W=>W.id===P),H=T?"locked":"unlocked";alert(`âœ… ${q?.name||`User ${P}`} has been ${H} successfully!`)}catch(M){console.error("API lock failed:",M);const q=t.map(ne=>ne.id===P?{...ne,locked:T,active:!T}:ne);s(q),fe(q,a);const H=t.find(ne=>ne.id===P),W=T?"locked":"unlocked";alert(`âš ï¸ Backend not available. ${H?.name||`User ${P}`} ${W} locally. Changes will sync when backend is available.`)}}catch(T){console.error("Failed to toggle lock:",T),alert(`âŒ Failed to update user status: ${T.message}`)}finally{I(null)}},se=async(P,S,T)=>{try{y(!0);try{await Xs.sendEmail({userIds:P,subject:S,message:T}),alert("Emails sent successfully!"),m(!1),h([]),b({subject:"",message:""});return}catch(H){console.warn("Backend email operation failed, simulating email send:",H.message)}const M=t.filter(H=>P.includes(H.id)),q=JSON.parse(localStorage.getItem("emailLogs")||"[]");q.push({timestamp:new Date().toISOString(),recipients:M.map(H=>({id:H.id,name:H.name,email:H.email})),subject:S,message:T,status:"simulated"}),localStorage.setItem("emailLogs",JSON.stringify(q)),alert(`âœ… Email simulation successful!

ðŸ“§ Sent to ${M.length} user(s):
${M.map(H=>`${H.name} (${H.email})`).join(`
`)}

${g?"":`ðŸ“Œ Backend not deployed - this was a simulation.
`}ðŸ’¡ Deploy backend to send real emails.`),m(!1),h([]),b({subject:"",message:""})}catch(M){console.error("Failed to send email:",M),alert("Failed to process email request.")}finally{y(!1)}},re=async P=>{const S=t.find(T=>T.id===P);S&&await se([P],"Payment Reminder - Subscription",`Dear ${S.name},

This is a friendly reminder about your pending subscription payment for ${S.plan?.toUpperCase()} plan (KSH ${S.price}).

Please complete your payment to continue enjoying our services.

Thank you!`)},te=t.filter(P=>{const S=P.name?.toLowerCase().includes(i.toLowerCase())||P.email?.toLowerCase().includes(i.toLowerCase());if(r==="all")return S;if(r==="active")return S&&P.active&&!P.locked;if(r==="locked")return S&&P.locked;if(r==="trial")return S&&(!P.active||!P.plan);if(r==="pending-payment"){const T=a.filter(M=>M.userId===P.id&&M.status==="pending");return S&&T.length>0}if(r==="overdue"){const T=a.filter(M=>M.userId===P.id&&M.status==="overdue");return S&&T.length>0}return S}),he=P=>{const S=a.filter(H=>H.userId===P),T=S.filter(H=>H.status==="pending").length,M=S.filter(H=>H.status==="overdue").length,q=S.filter(H=>H.status==="paid").length;return{pending:T,overdue:M,paid:q,total:S.length}};return p&&t.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-white mx-auto mb-4"}),e.jsx("p",{className:"text-white text-xl",children:"Loading Main Admin Dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900",children:[!g&&e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm md:text-base font-semibold",children:["âš ï¸ Demo Mode: Backend not available. Actions are simulated locally.",e.jsx("a",{href:"/BACKEND_NOT_DEPLOYED.md",className:"underline ml-2",children:"Deploy Backend â†’"})]})}),j&&e.jsx("div",{className:"bg-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm font-semibold",children:["âš ï¸ ",j]})}),e.jsx("header",{className:"bg-black/30 backdrop-blur-lg border-b border-white/10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Main Admin Dashboard"}),e.jsx("p",{className:"text-gray-300",children:"Monitor all users, payments, and system activity"})]}),e.jsxs("button",{onClick:$,className:"flex items-center gap-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 px-4 py-2 rounded-lg transition-colors",children:[e.jsx(He,{className:"w-4 h-4"}),"Logout"]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Rt,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:F.totalUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(It,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:F.activeUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Active Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(De,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:F.lockedUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Locked Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Lt,{className:"w-8 h-8 text-yellow-400"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:["KSH ",F.totalRevenue.toLocaleString()]})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Mt,{className:"w-8 h-8 text-orange-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:F.pendingPayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Pending Payments"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ws,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:F.overduePayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Overdue Payments"})]})]}),e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 flex-1 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-80",children:[e.jsx(ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",value:i,onChange:P=>l(P.target.value)})]}),e.jsxs("select",{value:r,onChange:P=>o(P.target.value),className:"px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"locked",children:"Locked"}),e.jsx("option",{value:"trial",children:"Free Trial"}),e.jsx("option",{value:"pending-payment",children:"Pending Payment"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsxs("button",{onClick:()=>m(!0),disabled:d.length===0||p,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-3 rounded-lg font-bold flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ls,{className:"w-5 h-5"}),"Send Email to Selected (",d.length,")"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"xl:col-span-2 bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"All Users"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left",children:e.jsx("input",{type:"checkbox",checked:d.length===te.length&&te.length>0,onChange:P=>{P.target.checked?h(te.map(S=>S.id)):h([])},className:"w-5 h-5 rounded"})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Actions"})]})}),e.jsxs("tbody",{children:[te.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:"5",className:"px-4 py-12 text-center",children:[e.jsx(Rt,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:i||r!=="all"?"Try adjusting your filters":"Users will appear here once they sign up"})]})}),te.map(P=>(he(P.id),e.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:d.includes(P.id),onChange:S=>{S.target.checked?h([...d,P.id]):h(d.filter(T=>T!==P.id))},className:"w-5 h-5 rounded"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[P.profilePicture?e.jsx("img",{src:P.profilePicture,alt:P.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:P.name?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:P.name}),e.jsx("p",{className:"text-sm text-gray-400",children:P.email})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${P.plan==="ultra"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"}`,children:[P.plan?.toUpperCase()," - KSH ",P.price]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"flex items-center gap-2",children:P.locked?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-300 flex items-center gap-1",children:[e.jsx(De,{className:"w-3 h-3"}),"Locked"]}):P.active?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-300 flex items-center gap-1",children:[e.jsx(It,{className:"w-3 h-3"}),"Active"]}):e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-500/20 text-gray-300",children:"Inactive"})})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ae(P.id,P.locked),disabled:k===P.id,className:`p-2 rounded-lg transition ${P.locked?"bg-green-500/20 hover:bg-green-500/30 text-green-300":"bg-red-500/20 hover:bg-red-500/30 text-red-300"} ${k===P.id?"opacity-50 cursor-not-allowed":""}`,title:P.locked?"Unlock User":"Lock User",children:k===P.id?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):P.locked?e.jsx(Ul,{className:"w-4 h-4"}):e.jsx(De,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>re(P.id),disabled:p,className:"p-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 transition",title:"Send Payment Reminder",children:e.jsx(Bl,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{P.role==="cashier"?window.open("/dashboard/cashier","_blank"):window.open("/admin","_blank")},className:"p-2 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 transition",title:"View User Dashboard",children:e.jsx(ti,{className:"w-4 h-4"})})]})})]},P.id)))]})]})})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl border border-white/20",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5"}),"Recent Activity"]})}),e.jsx("div",{className:"p-4 space-y-3 max-h-96 overflow-y-auto",children:B.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"No recent activity"}):B.map(P=>e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${P.type==="login"?"bg-green-400":"bg-blue-400"}`}),e.jsx("span",{className:"text-white font-medium",children:P.user.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${P.type==="login"?"bg-green-500/20 text-green-300":"bg-blue-500/20 text-blue-300"}`,children:P.type})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:P.user.email}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:new Date(P.timestamp).toLocaleString()})]},P.id))})]})]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-purple-900 rounded-2xl shadow-2xl max-w-2xl w-full border border-white/20",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Ls,{}),"Send Email to ",d.length," User(s)"]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Subject"}),e.jsx("input",{type:"text",value:u.subject,onChange:P=>b({...u,subject:P.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email subject..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Message"}),e.jsx("textarea",{value:u.message,onChange:P=>b({...u,message:P.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 h-40",placeholder:"Email message..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>se(d,u.subject,u.message),disabled:p,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white py-3 rounded-lg font-bold transition disabled:opacity-50",children:p?"Sending...":"Send Email"}),e.jsx("button",{onClick:()=>m(!1),className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-lg font-bold transition",children:"Cancel"})]})]})]})})]})}function fx({user:t}){const[s,a]=x.useState(!1);if(s||!t)return null;const n=t?.serviceStartDate?new Date(t.serviceStartDate):null,r=t?.daysUsed||0,o=t?.plan||"",l=Math.max(0,30-r);return l>7?null:e.jsxs("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-3 md:p-4 flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(it,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-amber-900",children:l===0?`Your ${o} plan has expired. Please renew to continue.`:`Your ${o} plan expires in ${l} day${l!==1?"s":""}. Consider upgrading.`}),e.jsxs("p",{className:"text-xs text-amber-700 mt-1",children:["Service started: ",n?.toLocaleDateString()||"Unknown"]})]})]}),e.jsx("button",{onClick:()=>a(!0),className:"flex-shrink-0 text-amber-600 hover:text-amber-900",children:e.jsx(_e,{className:"w-5 h-5"})})]})}function gx(){const{refreshProducts:t}=za();return x.useEffect(()=>{const s=r=>{console.log(" Stock update received:",r.detail),t()},a=r=>{console.log(" Sale completed, refreshing stock:",r.detail),t()},n=r=>{console.log(" Products sync event:",r.detail)};return window.addEventListener("stockUpdate",s),window.addEventListener("saleComplete",a),window.addEventListener("productsSync",n),()=>{window.removeEventListener("stockUpdate",s),window.removeEventListener("saleComplete",a),window.removeEventListener("productsSync",n)}},[t]),null}function Ee({children:t,adminOnly:s=!1,ultraOnly:a=!1,ownerOnly:n=!1}){const{user:r,loading:o}=be(),{isLocked:i,lock:l,unlock:c}=di(),[m,d]=x.useState(!1),h=hi(6e4),u=h?.[0]||i||!1,b=x.useCallback(()=>{h?.[1]?.(),c()},[h,c]),[p,y]=x.useState({});if(x.useEffect(()=>{r&&!n&&((async()=>{try{const g=localStorage.getItem("token"),k=await fetch(`${le}/settings`,{headers:{Authorization:`Bearer ${g}`}});if(k.ok){const I=await k.json();y(I)}}catch(g){console.error("Failed to load settings:",g)}})(),sessionStorage.getItem("reminderShown")||(d(!0),sessionStorage.setItem("reminderShown","true")))},[r,n]),x.useEffect(()=>{const v=g=>{console.log("ðŸ”’ Admin locked screen:",g.detail),l("admin")};return window.addEventListener("admin_locked_user_screen",v),()=>window.removeEventListener("admin_locked_user_screen",v)},[l]),o&&!n)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(n){const v=localStorage.getItem("ownerToken"),g=localStorage.getItem("ownerUser");if(!v||!g)return e.jsx(ke,{to:"/main.admin"});try{if(JSON.parse(g).type!=="main_admin")return e.jsx(ke,{to:"/main.admin"})}catch{return e.jsx(ke,{to:"/main.admin"})}}else{if(!r)return e.jsx(ke,{to:"/auth/login"});if(!r.active)return e.jsx(ke,{to:"/choose-subscription"});if(s&&r.role!=="admin")return e.jsx(ke,{to:"/dashboard"});if(a&&(r.role!=="admin"||r.plan!=="ultra"))return e.jsx(ke,{to:"/dashboard"})}const j=n?"owner":"user";return e.jsxs(e.Fragment,{children:[e.jsx(fx,{}),e.jsx(gx,{}),u&&e.jsx(mi,{onUnlock:b,userType:j}),m&&e.jsx(ui,{onClose:()=>d(!1)}),t]})}function yx(){const{user:t}=be();return!t||!t.active?e.jsx(ke,{to:"/choose-subscription"}):t.role==="admin"?e.jsx(ke,{to:"/admin"}):e.jsx(ke,{to:"/dashboard/cashier"})}function bx(){return e.jsx(Yl,{children:e.jsx(Xl,{children:e.jsx(Ql,{children:e.jsx(hl,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(Xr,{children:[e.jsx(ee,{path:"/",element:e.jsx(Kr,{})}),e.jsx(ee,{path:"/get-started",element:e.jsx(Kr,{})}),e.jsx(ee,{path:"/choose-subscription",element:e.jsx(Zh,{})}),e.jsx(ee,{path:"/auth/login",element:e.jsx(Hr,{})}),e.jsx(ee,{path:"/auth/signup",element:e.jsx(Hr,{})}),e.jsx(ee,{path:"/plans",element:e.jsx(ke,{to:"/choose-subscription"})}),e.jsx(ee,{path:"/build-pos",element:e.jsx(Qh,{})}),e.jsx(ee,{path:"/main.admin/*",element:e.jsx(Jr,{})}),e.jsx(ee,{path:"/main-admin",element:e.jsx(Ee,{ownerOnly:!0,children:e.jsx(Jr,{})})}),e.jsx(ee,{path:"/dashboard",element:e.jsx(Ee,{children:e.jsx(yx,{})})}),e.jsx(ee,{path:"/dashboard/cashier",element:e.jsx(Ee,{children:e.jsx(Gr,{})})}),e.jsx(ee,{path:"/cashier/bar",element:e.jsx(Ee,{children:e.jsx(dx,{})})}),e.jsx(ee,{path:"/cashier/hospital",element:e.jsx(Ee,{children:e.jsx(ux,{})})}),e.jsx(ee,{path:"/cashier/school",element:e.jsx(Ee,{children:e.jsx(mx,{})})}),e.jsx(ee,{path:"/cashier/kiosk",element:e.jsx(Ee,{children:e.jsx(hx,{})})}),e.jsx(ee,{path:"/cashier/petrol",element:e.jsx(Ee,{children:e.jsx(xx,{})})}),e.jsx(ee,{path:"/cashier/shoes",element:e.jsx(Ee,{children:e.jsx(px,{})})}),e.jsx(ee,{path:"/admin/*",element:e.jsx(Ee,{adminOnly:!0,children:e.jsx(En,{})})}),e.jsx(ee,{path:"/admin",element:e.jsx(Ee,{adminOnly:!0,children:e.jsx(En,{})})}),e.jsx(ee,{path:"/login",element:e.jsx(ke,{to:"/auth/login"})}),e.jsx(ee,{path:"/signup",element:e.jsx(ke,{to:"/auth/signup"})}),e.jsx(ee,{path:"/subscription",element:e.jsx(ke,{to:"/choose-subscription"})}),e.jsx(ee,{path:"/payment",element:e.jsx(ke,{to:"/choose-subscription"})}),e.jsx(ee,{path:"/cashier",element:e.jsx(Ee,{children:e.jsx(Gr,{})})})]})})})})})}Kl.createRoot(document.getElementById("root")).render(e.jsx(xl.StrictMode,{children:e.jsx(bx,{})}));
