import{a as Xt,b as Zt,g as es,r as a,u as Me,c as Et,R as Tt,d as ne,B as ts,N as be,e as ss}from"./vendor-Ct1st1Nj.js";import{L as ye,M as et,P as as,C as tt,D as $e,T as Le,a as Fe,S as Lt,b as st,c as gt,d as Ne,e as rs,f as ls,g as Oe,h as Ue,i as De,j as $t,k as ns,l as Ot,m as yt,U as Nt,n as vt,o as at,E as Qe,p as wt,q as Ie,X as Re,r as qe,s as Xe,t as ft,u as ze,v as St,w as rt,B as bt,R as is,I as os,x as lt,y as kt,z as Ut,A as ht,F as Ae,G as nt,H as Ft,J as cs,K as Rt,N as ds,O as ms,Q as xs,V as jt,W as us,Y as We,Z as Mt,_ as pt,$ as qt,a0 as _t,a1 as hs,a2 as ps,a3 as gs,a4 as fs}from"./icons-D28dctJ3.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))u(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&u(i)}).observe(document,{childList:!0,subtree:!0});function h(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function u(n){if(n.ep)return;n.ep=!0;const o=h(n);fetch(n.href,o)}})();var mt={exports:{}},_e={};var Ct;function bs(){if(Ct)return _e;Ct=1;var t=Xt(),l=Symbol.for("react.element"),h=Symbol.for("react.fragment"),u=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(r,x,d){var g,f={},s=null,v=null;d!==void 0&&(s=""+d),x.key!==void 0&&(s=""+x.key),x.ref!==void 0&&(v=x.ref);for(g in x)u.call(x,g)&&!o.hasOwnProperty(g)&&(f[g]=x[g]);if(r&&r.defaultProps)for(g in x=r.defaultProps,x)f[g]===void 0&&(f[g]=x[g]);return{$$typeof:l,type:r,key:s,ref:v,props:f,_owner:n.current}}return _e.Fragment=h,_e.jsx=i,_e.jsxs=i,_e}var Pt;function js(){return Pt||(Pt=1,mt.exports=bs()),mt.exports}var e=js(),Ge={},Dt;function ys(){if(Dt)return Ge;Dt=1;var t=Zt();return Ge.createRoot=t.createRoot,Ge.hydrateRoot=t.hydrateRoot,Ge}var Ns=ys();const vs=es(Ns),ws=()=>"https://posifine22.onrender.com/api",ue=ws(),Bt=()=>localStorage.getItem("token"),Jt=async(t,l={},h=0,u=3)=>{const n=Bt(),o=t.startsWith("/")?t:`/${t}`,i={...l,headers:{"Content-Type":"application/json",...n&&!(o.startsWith("/auth")&&o!=="/auth/me")&&!o.includes("/main-admin/auth/login")&&{Authorization:`Bearer ${n}`},...l.headers}};try{const r=await fetch(`${ue}${o}`,i);if(r.status===401){localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser");const d=window.location.pathname||"";if(!d.includes("/login")&&!d.includes("/signup")&&!d.includes("/auth")&&!d.includes("/main.admin"))try{window.location.href="/login"}catch{}const g=new Error("Unauthorized");throw g.status=401,g}if(r.status===423){const d=await r.json().catch(()=>({error:"Screen locked"})),g=new Error(d.error||"Screen locked");throw g.status=423,g.isScreenLocked=!0,g}if(r.status===500)throw new Error("Server error 500 - Backend unavailable");if(r.ok)return r.status===204?{success:!0}:await r.json();const x=await r.json().catch(()=>({error:"Network error"}));throw new Error(x.error||`HTTP ${r.status}: ${r.statusText}`)}catch(r){if(r.name==="TypeError"&&r.message.includes("fetch")){if(console.error(`API Fetch Error (attempt ${h+1}/${u+1}):`,r),console.error("Attempted URL:",`${ue}${o}`),h<u){const x=Math.min(1e3*Math.pow(2,h),1e4);return console.log(`Retrying in ${x}ms...`),await new Promise(d=>setTimeout(d,x)),Jt(t,l,h+1,u)}throw new Error("Cannot connect to server. The server may be waking up. Please try again in a moment.")}throw r}},R=(t,l={})=>Jt(t,l,0,3),Te={login:t=>R("/auth/login",{method:"POST",body:JSON.stringify(t)}),pinLogin:t=>R("/auth/pin-login",{method:"POST",body:JSON.stringify(t)}),signup:t=>R("/auth/signup",{method:"POST",body:JSON.stringify(t)}),signupWithPayment:t=>R("/signup-with-payment",{method:"POST",body:JSON.stringify(t)}),me:()=>R("/auth/me"),getSubscriptionStatus:()=>R("/user/subscription-status"),renewSubscription:(t=30)=>R("/subscriptions/renew",{method:"POST",body:JSON.stringify({duration_days:t})})},At={getPlans:()=>R("/subscriptions/plans"),getOverview:()=>{const t=localStorage.getItem("ownerToken");return R("/subscriptions/overview",{headers:t?{Authorization:`Bearer ${t}`}:{}})},checkExpiry:()=>{const t=localStorage.getItem("ownerToken");return R("/subscriptions/check-expiry",{headers:t?{Authorization:`Bearer ${t}`}:{}})},getUserSubscriptionStatus:t=>{const l=localStorage.getItem("ownerToken");return R("/user/subscription-status",{headers:l?{Authorization:`Bearer ${l}`}:{}})}},Ee={getAll:()=>R("/users"),create:t=>R("/users",{method:"POST",body:JSON.stringify(t)}),update:(t,l)=>R(`/users/${t}`,{method:"PUT",body:JSON.stringify(l)}),delete:t=>R(`/users/${t}`,{method:"DELETE"}),setPin:(t,l)=>R(`/users/${t}/set-pin`,{method:"POST",body:JSON.stringify({pin:l})}),lock:(t,l)=>R(`/users/${t}/lock`,{method:"POST",body:JSON.stringify({locked:l})})},je={getAll:()=>R("/products"),create:t=>R("/products",{method:"POST",body:JSON.stringify(t)}),update:(t,l)=>R(`/products/${t}`,{method:"PUT",body:JSON.stringify(l)}),delete:t=>R(`/products/${t}`,{method:"DELETE"}),updateStock:(t,l)=>R(`/products/${t}/stock`,{method:"PUT",body:JSON.stringify(l)}),getMaxProducible:t=>R(`/products/${t}/max-producible`),getStockStatus:()=>R("/products/stock-status")},He={getAll:()=>R("/sales"),create:t=>R("/sales",{method:"POST",body:JSON.stringify(t)}),delete:t=>R(`/sales/${t}`,{method:"DELETE"})},it={getAll:()=>R("/expenses"),create:t=>R("/expenses",{method:"POST",body:JSON.stringify(t)}),update:(t,l)=>R(`/expenses/${t}`,{method:"PUT",body:JSON.stringify(l)}),delete:t=>R(`/expenses/${t}`,{method:"DELETE"})},zt={get:()=>R("/stats")},Ye={getAll:()=>R("/discounts"),create:t=>R("/discounts",{method:"POST",body:JSON.stringify(t)}),update:(t,l)=>R(`/discounts/${t}`,{method:"PUT",body:JSON.stringify(l)}),delete:t=>R(`/discounts/${t}`,{method:"DELETE"})},xt={getAll:()=>R("/credit-requests"),create:t=>R("/credit-requests",{method:"POST",body:JSON.stringify(t)}),approve:t=>R(`/credit-requests/${t}/approve`,{method:"POST"}),reject:t=>R(`/credit-requests/${t}/reject`,{method:"POST"})},Je={get:async()=>({screenLockPassword:"2005",businessName:"My Business"}),update:async t=>t},ot={getAll:t=>{const l=t?`/batches?productId=${t}`:"/batches";return R(l)},create:t=>R("/batches",{method:"POST",body:JSON.stringify(t)})},Ht={clearData:(t="all")=>R("/clear-data",{method:"POST",body:JSON.stringify({type:t})})},Be={login:t=>R("/main-admin/auth/login",{method:"POST",body:JSON.stringify(t)}),getUsers:()=>{const t=localStorage.getItem("ownerToken");return R("/main-admin/users",{headers:{Authorization:`Bearer ${t}`,"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}})},getStats:()=>{const t=localStorage.getItem("ownerToken");return R("/main-admin/stats",{headers:{Authorization:`Bearer ${t}`,"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}})},getActivities:()=>{const t=localStorage.getItem("ownerToken");return R("/main-admin/activities",{headers:{Authorization:`Bearer ${t}`}})},getSalesAll:()=>{const t=localStorage.getItem("ownerToken");return R("/main-admin/sales-all",{headers:{Authorization:`Bearer ${t}`}})},getTimeEntriesAll:()=>{const t=localStorage.getItem("ownerToken");return R("/main-admin/time-entries-all",{headers:{Authorization:`Bearer ${t}`}})},lockUser:(t,l)=>{const h=localStorage.getItem("ownerToken");return R(`/main-admin/users/${t}/lock`,{method:"POST",headers:{Authorization:`Bearer ${h}`},body:JSON.stringify({locked:l})})},changePlan:(t,l)=>{const h=localStorage.getItem("ownerToken");return R(`/main-admin/users/${t}/plan`,{method:"POST",headers:{Authorization:`Bearer ${h}`},body:JSON.stringify({plan:l})})},deleteUser:t=>{const l=localStorage.getItem("ownerToken");return R(`/main-admin/users/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}})},clearData:t=>{const l=localStorage.getItem("ownerToken");return R("/main-admin/system/clear-data",{method:"POST",headers:{Authorization:`Bearer ${l}`},body:JSON.stringify({type:t})})},lockUserScreen:t=>{const l=localStorage.getItem("ownerToken");return R(`/admin/lock-user-screen/${t}`,{method:"POST",headers:{Authorization:`Bearer ${l}`}})}};let Se=null,Ze=new Set;function Ss(){const t=ue.replace(/\/api$/,"");return`${t.startsWith("https")?"wss":"ws"}://${t.replace(/^https?:\/\//,"")}/api/ws/products`}function ks(){if(Se&&(Se.readyState===WebSocket.OPEN||Se.readyState===WebSocket.CONNECTING))return;const t=Bt(),l=Ss()+(t?`?token=${encodeURIComponent(t)}`:"");Se=new WebSocket(l),Se.onopen=()=>{console.debug("Products WS connected")},Se.onmessage=h=>{let u=null;try{u=JSON.parse(h.data)}catch{return}Ze.forEach(n=>{try{n(u)}catch(o){console.error("ws callback error",o)}})},Se.onclose=()=>{console.debug("Products WS closed"),Se=null},Se.onerror=h=>{console.error("Products WS error",h)}}function Cs(t){if(typeof t!="function")throw new Error("subscribeProducts requires a callback");return Ze.add(t),ks(),()=>{if(Ze.delete(t),Se&&Ze.size===0){try{Se.close()}catch{}Se=null}}}function Ps(){return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 text-center border border-red-200",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-500 to-orange-500 rounded-full mx-auto mb-6 flex items-center justify-center",children:e.jsx(ye,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Account Suspended"}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[e.jsx("p",{className:"text-red-700 font-medium mb-2",children:"Out of credit"}),e.jsx("p",{className:"text-red-600 text-sm",children:"Your account has been temporarily suspended. Please reach out to the developer to resolve this issue."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-600",children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Contact: support@universal.com"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-600",children:[e.jsx(as,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Phone: +254 XXX XXX XXX"})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["Account ID: ",localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")).id:"Unknown"]})})]})})}const Kt=a.createContext(),Ce=()=>a.useContext(Kt),Ds=({children:t})=>{const[l,h]=a.useState(null),[u,n]=a.useState(!0),[o,i]=a.useState(!1),[r,x]=a.useState({});a.useEffect(()=>{g()},[]),a.useEffect(()=>{const C=()=>{const K=localStorage.getItem("user");if(K)try{const V=JSON.parse(K);h(V)}catch(V){console.warn("Failed to parse user from localStorage",V)}else h(null)},I=K=>{const V=K.detail?.userId,de=l||JSON.parse(localStorage.getItem("user")||"{}");de&&de.id===V&&(alert("âš ï¸ Your account has been locked by the system administrator. You will be logged out."),localStorage.removeItem("token"),localStorage.removeItem("user"),h(null),setTimeout(()=>{window.location.href="/auth/login?reason=account_locked"},1e3))};return window.addEventListener("storage",C),window.addEventListener("localStorageUpdated",C),window.addEventListener("accountLocked",I),()=>{window.removeEventListener("storage",C),window.removeEventListener("localStorageUpdated",C),window.removeEventListener("accountLocked",I)}},[l]);const d=()=>{["products","sales","expenses","activities","timeEntries","dashboardCache","inventoryCache","analyticsCache"].forEach(I=>{try{localStorage.removeItem(I),sessionStorage.removeItem(I)}catch(K){console.warn(`Failed to clear ${I}`,K)}})},g=async()=>{try{d();const C=localStorage.getItem("token"),I=localStorage.getItem("user");if(C&&I)try{const K=JSON.parse(I);if(K.locked){localStorage.removeItem("token"),localStorage.removeItem("user"),h(null),i(!0),n(!1);return}h(K),fetch(`${ue}/auth/me`,{headers:{Authorization:`Bearer ${C}`,"Content-Type":"application/json"}}).then(V=>{if(V.ok)return V.json().then(de=>{de.locked?(localStorage.removeItem("token"),localStorage.removeItem("user"),h(null)):(h(de),localStorage.setItem("user",JSON.stringify(de)))});throw new Error("Invalid token")}).catch(V=>{console.warn("Auth check failed:",V),localStorage.removeItem("token"),localStorage.removeItem("user")})}catch(K){console.warn("Auth initialization failed:",K),localStorage.removeItem("token"),localStorage.removeItem("user")}}catch(C){console.error("Error initializing auth:",C),localStorage.removeItem("token"),localStorage.removeItem("user"),h(null)}finally{i(!0),n(!1)}},f=async C=>{try{if(C&&C.token&&C.user)return localStorage.setItem("token",C.token),localStorage.setItem("user",JSON.stringify(C.user)),h(C.user),C;const I=await Te.login(C);if(I.token&&I.user)return localStorage.setItem("token",I.token),localStorage.setItem("user",JSON.stringify(I.user)),h(I.user),I;throw new Error("Invalid response from server")}catch(I){throw console.error("Login failed:",I),I}},s=async C=>{try{const I=await Te.signup(C);if(I.token&&I.user)return localStorage.setItem("token",I.token),localStorage.setItem("user",JSON.stringify(I.user)),h(I.user),I;throw new Error("Invalid response from server")}catch(I){throw console.error("Signup failed:",I),I}},v=async C=>{try{if(localStorage.setItem("user",JSON.stringify(C)),h(C),window.dispatchEvent(new Event("localStorageUpdated")),C&&C.id)try{await Ee.update(C.id,C)}catch(I){console.warn("Failed to persist updated user to backend",I)}return C}catch(I){throw console.error("updateUser failed:",I),I}},b=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),h(null),window.location.href="/login"},j=()=>!!l&&!!localStorage.getItem("token"),y=C=>l&&l.role===C,P=()=>l&&(l.role==="admin"||l.role==="main-admin"),E=()=>l&&l.role==="cashier",S=()=>l&&l.plan==="ultra",T=()=>l&&l.plan==="basic",k=()=>l&&(l.role==="admin"||l.role==="cashier"),F=()=>l&&l.role==="admin"&&l.plan==="ultra",$=()=>l&&l.role==="admin",D=()=>!0,N=()=>!0;return l?.locked?e.jsx(Ps,{}):e.jsx(Kt.Provider,{value:{user:l,loading:u,isInitialized:o,appSettings:r,login:f,signup:s,updateUser:v,logout:b,isAuthenticated:j,hasRole:y,isAdmin:P,isCashier:E,isUltraPackage:S,isBasicPackage:T,canEditStock:k,canManageUsers:F,canViewAnalytics:$,isRealTimeProductSyncEnabled:D,isCashierUserManagementEnabled:N},children:t})};new Date().toISOString();const Vt=a.createContext(),As=()=>a.useContext(Vt),Is=({children:t})=>{const{user:l}=Ce(),[h,u]=a.useState([]),[n,o]=a.useState(!0),[i,r]=a.useState(null),[x,d]=a.useState(Date.now()),g=a.useCallback(async()=>{if(!localStorage.getItem("token")){o(!1);return}try{const s=await je.getAll(),b=(Array.isArray(s)?s:[]).filter(j=>!j.pendingDelete);u(b),r(null),window.dispatchEvent(new CustomEvent("productsSync",{detail:{products:b,timestamp:Date.now()}}))}catch(s){console.error("Failed to fetch products:",s),r(`Failed to load products: ${s.message}`),u([])}finally{o(!1),d(Date.now())}},[]);a.useEffect(()=>{g()},[]),a.useEffect(()=>{const s=setInterval(()=>{g()},6e4);return()=>clearInterval(s)},[]),a.useEffect(()=>{const s=()=>{console.log("ðŸ”„ Data cleared event received - forcing products refresh"),u([]),r(null),g()};return window.addEventListener("dataCleared",s),window.addEventListener("productsCleared",s),()=>{window.removeEventListener("dataCleared",s),window.removeEventListener("productsCleared",s)}},[]);const f=async()=>{o(!0),await g()};return e.jsx(Vt.Provider,{value:{products:h,loading:n,error:i,lastUpdated:x,refreshProducts:f},children:t})},Wt=a.createContext();function Es({children:t}){const[l,h]=a.useState(!1),[u,n]=a.useState(""),o=a.useCallback((r="timeout")=>{h(!0),n(r),console.log(`ðŸ”’ Screen locked by: ${r}`)},[]),i=a.useCallback(()=>{h(!1),n(""),console.log("ðŸ”“ Screen unlocked")},[]);return e.jsx(Wt.Provider,{value:{isLocked:l,lockReason:u,lock:o,unlock:i},children:t})}function Ts(){const t=a.useContext(Wt);if(!t)throw new Error("useScreenLock must be used within ScreenLockProvider");return t}function Ls(){const[t,l]=a.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[h,u]=a.useState(!0),[n,o]=a.useState(null);a.useEffect(()=>{i()},[]);const i=async()=>{try{o(null);const[d,g]=await Promise.all([zt.get(),He.getAll()]),f={totalSales:d?.totalSales||0,totalExpenses:d?.totalExpenses||0,profit:d?.profit||0,grossProfit:d?.grossProfit||0,netProfit:d?.netProfit||0,totalCOGS:d?.totalCOGS||0,dailySales:d?.dailySales||0,weeklySales:d?.weeklySales||0,productCount:d?.productCount||0},s=Array.isArray(g)?g:[];l({stats:f,recentSales:s.slice(-10).reverse()})}catch(d){console.error("Failed to load data:",d),o(d.message),l({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{u(!1)}};if(h)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(n&&t.stats.totalSales===0&&t.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(tt,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:n}),e.jsx("button",{onClick:i,className:"btn-primary",children:"Retry"})]})});const r=[{label:"Total Sales",value:`KSH ${t.stats.totalSales?.toLocaleString()||0}`,icon:$e,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${t.stats.grossProfit?.toLocaleString()||0}`,icon:Le,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${t.stats.totalCOGS?.toLocaleString()||0}`,icon:Fe,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${t.stats.netProfit?.toLocaleString()||0}`,icon:Le,color:"from-purple-500 to-pink-600",change:"+15.3%"}],x=[{label:"Daily Sales",value:`KSH ${t.stats.dailySales?.toLocaleString()||0}`,icon:Lt,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${t.stats.weeklySales?.toLocaleString()||0}`,icon:Le,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${t.stats.totalExpenses?.toLocaleString()||0}`,icon:st,color:"bg-red-50 text-red-600"},{label:"Products",value:t.stats.productCount||0,icon:Fe,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(r||[]).map((d,g)=>{const f=d?.icon;return f?e.jsxs("div",{className:`card bg-gradient-to-br ${d.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(f,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:d.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:d.label}),e.jsx("p",{className:"text-2xl font-bold",children:d.value})]},g):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(x||[]).map((d,g)=>{const f=d?.icon;return f?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${d.color} flex items-center justify-center`,children:e.jsx(f,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:d.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:d.value})]})]})},g):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!t.recentSales||t.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(tt,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(t.recentSales||[]).map(d=>d?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:d.createdAt?new Date(d.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(d.items)?d.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:d.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",d.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",d.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",d.profit?.toLocaleString()||0]})]},d.id||Math.random()):null)})]})})]})]})}const $s=()=>"https://posifine22.onrender.com/api".replace("https://","wss://").replace("http://","ws://");class Os{constructor(){this.ws=null,this.listeners={stock_updated:[],heartbeat:[],initial:[],error:[],sale_deleted:[],sale_created:[],product_deleted:[],product_created:[],product_updated:[],user_deleted:[],data_cleared:[],products_cleared:[],cashier_clocked_in:[],cashier_clocked_out:[]},this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.isManualClose=!1}connect(l,h){return new Promise((u,n)=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){u();return}if(!l){n(new Error("No token provided for WebSocket connection"));return}const o=`${$s()}/ws/products?token=${encodeURIComponent(l)}`;try{this.ws=new WebSocket(o),this.ws.onopen=()=>{console.log("âœ… WebSocket connected for real-time updates"),this.reconnectAttempts=0,u()},this.ws.onmessage=i=>{try{const r=JSON.parse(i.data);r.type==="stock_updated"?(console.log("ðŸ“¦ Stock update received:",r.data),h&&h(r.data),this.emit("stock_updated",r.data)):r.type==="product_created"?(console.log("âœ¨ New product created:",r.data.product),this.emit("product_created",r.data),window.dispatchEvent(new Event("productCreated"))):r.type==="product_updated"?(console.log("ðŸ“ Product updated:",r.data.product),this.emit("product_updated",r.data),window.dispatchEvent(new Event("productUpdated"))):r.type==="initial"?(console.log("ðŸ“¦ Initial products loaded via WebSocket"),this.emit("initial",r.products)):r.type==="heartbeat"?this.emit("heartbeat",r):r.type==="sale_deleted"?(console.log("ðŸ—‘ï¸ Sale deleted:",r.data),this.emit("sale_deleted",r.data),window.dispatchEvent(new Event("saleDeleted"))):r.type==="product_deleted"?(console.log("ðŸ—‘ï¸ Product deleted:",r.data),this.emit("product_deleted",r.data),window.dispatchEvent(new Event("dataUpdated"))):r.type==="user_deleted"?(console.log("ðŸ—‘ï¸ User deleted:",r.data),this.emit("user_deleted",r.data),window.dispatchEvent(new Event("userDeleted"))):r.type==="data_cleared"?(console.log("ðŸ—‘ï¸ Data cleared:",r.data),this.emit("data_cleared",r.data),window.dispatchEvent(new Event("dataUpdated"))):r.type==="products_cleared"?(console.log("ðŸ—‘ï¸ Products cleared:",r.data),this.emit("products_cleared",r.data),window.dispatchEvent(new CustomEvent("productsCleared",{detail:r.data}))):r.type==="sale_created"?(console.log("ðŸ’° New sale recorded:",r.data.sale),this.emit("sale_created",r.data),window.dispatchEvent(new CustomEvent("saleCreated",{detail:r.data}))):r.type==="cashier_clocked_in"?(console.log("â° Cashier clocked in:",r.data.entry),this.emit("cashier_clocked_in",r.data),window.dispatchEvent(new CustomEvent("cashierClockIn",{detail:r.data}))):r.type==="cashier_clocked_out"&&(console.log("â° Cashier clocked out:",r.data.entry),this.emit("cashier_clocked_out",r.data),window.dispatchEvent(new CustomEvent("cashierClockOut",{detail:r.data})))}catch(r){console.error("Error parsing WebSocket message:",r)}},this.ws.onerror=i=>{console.error("âŒ WebSocket error:",i),this.emit("error",i),n(i)},this.ws.onclose=()=>{console.log("ðŸ”Œ WebSocket disconnected"),this.isManualClose||this.attemptReconnect(l,h)}}catch(i){console.error("Failed to create WebSocket:",i),n(i)}})}attemptReconnect(l,h){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Max reconnection attempts reached");return}this.reconnectAttempts++;const u=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`ðŸ”„ Reconnecting in ${u}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect(l,h).catch(n=>{console.error("Reconnection failed:",n)})},u)}on(l,h){this.listeners[l]||(this.listeners[l]=[]),this.listeners[l].push(h)}emit(l,h){this.listeners[l]&&this.listeners[l].forEach(u=>{try{u(h)}catch(n){console.error(`Error in ${l} listener:`,n)}})}disconnect(){this.isManualClose=!0,this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}}const ct=new Os;function Us(){const{user:t,isUltraPackage:l,isRealTimeProductSyncEnabled:h}=Ce(),{products:u,refreshProducts:n}=As(),[o,i]=a.useState([]),[r,x]=a.useState([]),[d,g]=a.useState("all"),[f,s]=a.useState(""),[v,b]=a.useState(!1),[j,y]=a.useState(!1),[P,E]=a.useState(!1),[S,T]=a.useState(null),[k,F]=a.useState(null),[$,D]=a.useState(null),[N,C]=a.useState(!1),[I,K]=a.useState(null),[V,de]=a.useState(""),[G,he]=a.useState({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),[ie,H]=a.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[B,re]=a.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0});a.useEffect(()=>{w();const m=localStorage.getItem("token");return m&&ct.connect(m,A=>{A&&A.allProducts&&i(A.allProducts)}).catch(A=>{console.warn("WebSocket connection failed:",A)}),()=>{ct.disconnect()}},[]);const w=async()=>{try{await n();const m=await ot.getAll();x(m)}catch(m){console.error("Failed to load data:",m)}};a.useEffect(()=>{u&&i(u)},[u]);const z=(m,A=!0)=>{const U=m.target.files[0];if(U){if(U.size>2*1024*1024){se("Image must be smaller than 2MB","error");return}const te=new FileReader;te.onload=Z=>{const W=Z.target.result;de(W),A?he({...G,image:W}):(re({...B,image:W}),B.id&&setTimeout(async()=>{try{await je.update(B.id,{image:W}),se("âœ… Image saved","success")}catch(Pe){console.error("Failed to save image:",Pe)}},500))},te.readAsDataURL(U)}},J=m=>r.filter(U=>U.productId===m&&U.quantity>0).reduce((U,te)=>U+te.quantity,0),ce=m=>r.filter(A=>A.productId===m&&A.quantity>0),fe=(m,A)=>!A||!m?m:["kg","g","gram","grams","kilogram","kilograms"].includes(A.toLowerCase())?m>=1?`${m.toFixed(2)}`:`${m.toFixed(3)}`.replace(/\.?0+$/,""):Math.round(m).toString(),se=(m,A="success")=>{D({message:m,type:A}),setTimeout(()=>D(null),5e3)},ve=async m=>{m.preventDefault(),console.log("ðŸ”µ handleAddProduct triggered",{newProduct:G});try{if(!G.name||!G.name.trim()){se("âŒ Product name is required","error");return}if(!G.price||isNaN(parseFloat(G.price))){se("âŒ Valid product price is required","error");return}const A={...G,price:parseFloat(G.price),cost:parseFloat(G.cost||0),quantity:0,visibleToCashier:!G.expenseOnly&&G.visibleToCashier!==!1};console.log("ðŸ“ Sending product data to API:",A);const U=await je.create(A);console.log("âœ… Product created successfully:",U),he({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),de(""),b(!1),console.log("ðŸ”„ Refreshing product list..."),await w(),se(`âœ… Product "${U.name}" added successfully! ${U.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success")}catch(A){console.error("âŒ Failed to create product:",A),console.error("Error details:",{message:A.message,status:A.status,stack:A.stack}),se(`âŒ Failed to create product: ${A.message||"Unknown error"}`,"error")}},p=async m=>{m.preventDefault();try{const A=parseFloat(ie.quantity);if(isNaN(A)||A<=0){se("âŒ Please enter a valid quantity","error");return}const te=S.unit&&["kg","g","gram","grams","kilogram","kilograms"].includes(S.unit.toLowerCase())?.01:1;if(A<te){se(`âŒ Minimum quantity is ${te} ${S.unit}`,"error");return}const Z={id:`batch-${Date.now()}`,productId:S.id,quantity:A,expiryDate:ie.expiryDate,batchNumber:ie.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(ie.cost||S.cost||0)};x(W=>[...W,Z]),se("âš¡ Adding stock...","info");try{await ot.create({productId:S.id,quantity:A,expiryDate:ie.expiryDate,batchNumber:ie.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(ie.cost||S.cost||0)}),H({quantity:"",expiryDate:"",batchNumber:"",cost:""}),E(!1),T(null),await w(),se(`âœ… Stock added successfully for ${S.name}!`,"success")}catch(W){throw x(Pe=>Pe.filter(ke=>ke.id!==Z.id)),W}}catch(A){console.error("Failed to add stock:",A),se(`âŒ Failed to add stock: ${A.message||"Unknown error"}`,"error")}},O=async m=>{m.preventDefault();try{const A=o.find(Z=>Z.id===B.id);if(parseFloat(B.price)<A.price){alert("You cannot lower prices, only increase.");return}const U={...B,price:parseFloat(B.price),cost:parseFloat(B.cost),quantity:parseFloat(B.quantity)},te={...A,...U};i(Z=>Z.map(W=>W.id===B.id?te:W)),C(!0),se("âš¡ Updating product...","info");try{const Z=await je.update(B.id,U);y(!1),h()?(window.dispatchEvent(new CustomEvent("productUpdated",{detail:{product:Z,originalProduct:A,timestamp:new Date().toISOString(),type:"update"}})),se("âœ… Product updated and synced!","success")):se("âœ… Product updated successfully!","success"),K(new Date)}catch(Z){throw i(W=>W.map(Pe=>Pe.id===B.id?A:Pe)),Z}finally{C(!1)}}catch(A){console.error("Failed to update product:",A),se(`âŒ Update failed: ${A.message||"Unknown error"}`,"error")}},q=async m=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const A=o.find(te=>te.id===m),U=await je.delete(m);if(i(te=>te.filter(Z=>Z.id!==m)),h()&&A)C(!0),window.dispatchEvent(new CustomEvent("productDeleted",{detail:{product:A,timestamp:new Date().toISOString(),type:"delete"}})),se(`ðŸ“¡ Product "${A.name}" deleted and synced to all dashboards!`,"success"),K(new Date),setTimeout(()=>{C(!1)},3e3);else{const te=U?.message||"Product deleted successfully!";alert(te)}await n()}catch(A){console.error("Failed to delete product:",A);let U="Failed to delete product";A.message.includes("Failed to execute")||A.message.includes("JSON")?U="Network error. Please check your connection and try again.":A.message.includes("401")||A.message.includes("unauthorized")?U="You are not authorized to delete this product.":A.message.includes("404")||A.message.includes("not found")?U="Product not found. It may have been deleted already.":A.message&&(U=`Failed to delete product: ${A.message}`),alert(U)}},X=(o||[]).filter(m=>{if(!m)return!1;const A=m.name?.toLowerCase().includes(f.toLowerCase()),U=d==="all"||d==="raw"&&!m.recipe||d==="composite"&&m.recipe||d==="expense"&&m.expenseOnly||d==="low-stock"&&m.quantity<10;return A&&U}),oe=(o||[]).filter(m=>m&&!m.recipe&&!m.expenseOnly),ae=(o||[]).filter(m=>m&&m.recipe),Q=(o||[]).filter(m=>m&&m.expenseOnly),me=m=>{if(!m||!m.recipe)return 0;let A=1/0;return(m.recipe||[]).forEach(U=>{if(!U)return;const te=(o||[]).find(Z=>Z&&Z.id===U.productId);if(te&&te.quantity>0&&U.quantity>0){const Z=Math.floor(te.quantity/U.quantity);A=Math.min(A,Z)}}),A===1/0?0:A},ge=m=>{if(!m)return 0;if(!m.recipe)return m.cost||0;let A=0;return(m.recipe||[]).forEach(U=>{if(!U)return;const te=(o||[]).find(Z=>Z&&Z.id===U.productId);if(te&&te.quantity>0){const Z=(te.cost||0)/te.quantity;A+=Z*(U.quantity||0)}}),A};return e.jsxs("div",{className:"p-6 space-y-6",children:[$&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${$.type==="success"?"bg-green-50 border border-green-200 text-green-800":$.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:$.message}),e.jsx("button",{onClick:()=>D(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(gt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:f,onChange:m=>s(m.target.value)})]}),e.jsxs("select",{value:d,onChange:m=>g(m.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>b(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:oe.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:ae.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:Q.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(X||[]).map(m=>{if(!m)return null;const A=ge(m),U=m.price?((m.price-A)/m.price*100).toFixed(1):0,te=me(m),Z=k===m.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[m.image?e.jsx("img",{src:m.image,alt:m.name,className:"w-12 h-12 object-cover rounded-lg",onError:W=>{W.target.style.display="none",W.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:m.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[m.recipe&&e.jsx("button",{onClick:()=>F(Z?null:m.id),className:"p-1 hover:bg-gray-200 rounded",children:Z?e.jsx(rs,{className:"w-4 h-4"}):e.jsx(ls,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:m.name}),m.quantity<10&&!m.recipe&&e.jsx(Oe,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${m.expenseOnly?"badge-warning":m.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:m.expenseOnly?"Expense":m.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",m.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",A.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${J(m.id)===0?"text-red-600":J(m.id)<10?"text-yellow-600":"text-gray-900"}`,children:[fe(J(m.id),m.unit)," ",m.unit]}),J(m.id)<10&&J(m.id)>0&&e.jsx(Oe,{className:"w-4 h-4 text-yellow-500"}),J(m.id)===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600",children:[ce(m.id).length," active"]}),e.jsx("button",{onClick:()=>{T(m),E(!0)},className:"p-1 hover:bg-blue-50 rounded text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(Ne,{className:"w-3 h-3"})})]})}),e.jsx("td",{className:"px-4 py-3",children:m.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[te," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${U>30?"text-green-600":U>15?"text-yellow-600":"text-red-600"}`,children:[U,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{re(m),y(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>q(m.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(De,{className:"w-4 h-4"})})]})})]},m.id),Z&&m.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(m.recipe||[]).map((W,Pe)=>{if(!W)return null;const ke=(o||[]).find(Ve=>Ve&&Ve.id===W.productId);if(!ke)return null;const Ke=(ke.cost||0)/(ke.quantity||1),dt=Ke*(W.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:ke.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[W.quantity||0," ",ke.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[ke.quantity||0," ",ke.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",Ke.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",dt.toFixed(2)]})]},Pe)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",A.toFixed(2)]})]})})]})]})})})]})})})]})})}),P&&S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-2",children:["Add Stock for ",S.name]}),e.jsxs("p",{className:"text-xs text-gray-600 mb-4",children:["Unit: ",e.jsx("span",{className:"font-semibold",children:S.unit}),["kg","g","gram","grams","kilogram","kilograms"].includes(S.unit?.toLowerCase())&&e.jsx("span",{className:"ml-2 text-blue-600",children:"ðŸ”¹ Supports decimals (e.g., 0.5 kg, 250 g)"})]}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Quantity ",["kg","g","gram","grams","kilogram","kilograms"].includes(S.unit?.toLowerCase())?"(decimal allowed)":"(whole numbers)"]}),e.jsx("input",{type:"number",step:["kg","g","gram","grams","kilogram","kilograms"].includes(S.unit?.toLowerCase())?"0.01":"1",min:["kg","g","gram","grams","kilogram","kilograms"].includes(S.unit?.toLowerCase())?"0.01":"1",placeholder:["kg","g","gram","grams","kilogram","kilograms"].includes(S.unit?.toLowerCase())?"e.g., 0.5, 1.25":"e.g., 100, 500",className:"input",value:ie.quantity,onChange:m=>H({...ie,quantity:m.target.value}),required:!0})]}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:ie.expiryDate,onChange:m=>H({...ie,expiryDate:m.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:ie.batchNumber,onChange:m=>H({...ie,batchNumber:m.target.value})}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Cost per Unit",className:"input",value:ie.cost,onChange:m=>H({...ie,cost:m.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{E(!1),T(null),H({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:ve,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:G.name,onChange:m=>he({...G,name:m.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:m=>z(m,!0),className:"input"}),e.jsx($t,{className:"w-5 h-5 text-gray-400"})]}),(V||G.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:V||G.image,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:G.price,onChange:m=>he({...G,price:m.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:G.cost,onChange:m=>he({...G,cost:m.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:G.category,onChange:m=>he({...G,category:m.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsxs("select",{className:"input",value:G.unit,onChange:m=>he({...G,unit:m.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:G.expenseOnly,onChange:m=>he({...G,expenseOnly:m.target.checked,visibleToCashier:!m.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!G.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:G.visibleToCashier,onChange:m=>he({...G,visibleToCashier:m.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{b(!1),de(""),he({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0})},className:"btn-secondary",children:"Cancel"})]})]})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:B.name,onChange:m=>re({...B,name:m.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:B.image||"",onChange:m=>re({...B,image:m.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:m=>{const A=m.target.files[0];if(A){const U=new FileReader;U.onloadend=()=>{re({...B,image:U.result})},U.readAsDataURL(A)}}})]}),B.image&&e.jsx("img",{src:B.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:B.price||"",onChange:m=>re({...B,price:m.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:B.cost||"",onChange:m=>re({...B,cost:m.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:B.quantity||"",onChange:m=>re({...B,quantity:m.target.value}),required:!0}),e.jsxs("select",{className:"input",value:B.unit||"pcs",onChange:m=>re({...B,unit:m.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:B.category||"raw",onChange:m=>re({...B,category:m.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:B.expenseOnly||!1,onChange:m=>re({...B,expenseOnly:m.target.checked,visibleToCashier:!m.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!B.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:B.visibleToCashier!==!1,onChange:m=>re({...B,visibleToCashier:m.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>y(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Fs(){const[t,l]=a.useState([]),[h,u]=a.useState([]),[n,o]=a.useState(!1),[i,r]=a.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});a.useEffect(()=>{x()},[]);const x=async()=>{const j=await je.getAll();l(j),u(j.filter(y=>!y.recipe))},d=()=>{r({...i,ingredients:[...i.ingredients,{name:"",quantity:"",unit:"pcs"}]})},g=(j,y,P)=>{const E=[...i.ingredients];E[j][y]=P,r({...i,ingredients:E})},f=j=>{r({...i,ingredients:i.ingredients.filter((y,P)=>P!==j)})},s=()=>i.ingredients.reduce((j,y)=>{const P=h.find(E=>E.name.toLowerCase()===y.name.toLowerCase());if(P&&y.quantity){const E=P.cost/P.quantity;return j+E*parseFloat(y.quantity)}return j},0),v=async j=>{j.preventDefault();const y=[];for(const E of i.ingredients){if(!E.name||!E.quantity)continue;const S=h.find(T=>T.name.toLowerCase()===E.name.toLowerCase());S?y.push({productId:S.id,quantity:parseFloat(E.quantity),unit:E.unit||"pcs"}):y.push({name:E.name,quantity:parseFloat(E.quantity),unit:E.unit||"pcs"})}if(y.length===0){alert("Please add at least one ingredient");return}const P=s();try{await je.create({name:i.name,price:parseFloat(i.price),cost:P,quantity:0,unit:"pcs",category:"composite",recipe:y,image:i.image||"",visibleToCashier:i.visibleToCashier,expenseOnly:!1}),r({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),o(!1),x(),alert("Recipe created successfully!")}catch(E){console.error("Error creating recipe:",E),alert("Failed to create recipe. Please try again.")}},b=t.filter(j=>j.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>o(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",b.length,")"]}),b.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:b.map(j=>{const y=j.recipe.reduce((E,S)=>{if(S.productId){const T=t.find(k=>k.id===S.productId);if(T){const k=T.cost/T.quantity;return E+k*S.quantity}}else if(S.name){const T=t.find(k=>k.name.toLowerCase()===S.name.toLowerCase());if(T){const k=T.cost/T.quantity;return E+k*S.quantity}}return E},0),P=((j.price-y)/j.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:j.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",j.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",y.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${P>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",P,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(De,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:j.recipe.map((E,S)=>{let T="",k=E.unit||"pcs";if(E.productId){const F=t.find($=>$.id===E.productId);F&&(T=F.name,k=F.unit)}else E.name&&(T=E.name,k=E.unit||"pcs");return T?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:T}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[E.quantity," ",k]})]},S):null})})]})]},j.id)})})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:i.name,onChange:j=>r({...i,name:j.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:i.price,onChange:j=>r({...i,price:j.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:i.image,onChange:j=>r({...i,image:j.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:i.visibleToCashier,onChange:j=>r({...i,visibleToCashier:j.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:d,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:i.ingredients.map((j,y)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:j.name,onChange:P=>g(y,"name",P.target.value),required:!0,list:`ingredients-list-${y}`}),e.jsx("datalist",{id:`ingredients-list-${y}`,children:h.map(P=>e.jsxs("option",{value:P.name,children:[P.name," (",P.quantity," ",P.unit," available)"]},P.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:j.quantity,onChange:P=>g(y,"quantity",P.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:j.unit,onChange:P=>g(y,"unit",P.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>f(y),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(De,{className:"w-4 h-4"})})]},y))}),i.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),i.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",s().toFixed(2)]})]}),i.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(i.price)-s())/parseFloat(i.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{o(!1),r({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Rs(){const[t,l]=a.useState([]),[h,u]=a.useState("all"),[n,o]=a.useState(!0);a.useEffect(()=>{i();const s=()=>{console.log("Sales data cleared - refreshing"),l([])};return window.addEventListener("dataCleared",s),()=>{window.removeEventListener("dataCleared",s)}},[]);const i=async()=>{try{o(!0);const s=await He.getAll();l(Array.isArray(s)?s.reverse():[])}catch(s){console.error("Failed to load sales:",s),l([])}finally{o(!1)}},r=async()=>{if(window.confirm(`âš ï¸ Are you sure you want to clear ALL sales data?

This action CANNOT be undone!`))try{await Ht.clearData("sales"),l([]),alert("âœ… All sales cleared successfully!")}catch(s){console.error("Failed to clear sales:",s),alert("âŒ Failed to clear sales: "+s.message)}},x=t.filter(s=>{if(h==="today")return new Date(s.createdAt).toDateString()===new Date().toDateString();if(h==="week"){const v=new Date;return v.setDate(v.getDate()-7),new Date(s.createdAt)>=v}return!0}),d=x.reduce((s,v)=>s+v.total,0),g=x.reduce((s,v)=>s+(v.cogs||0),0),f=d-g;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("select",{value:h,onChange:s=>u(s.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:r,className:"btn-secondary flex items-center gap-2 hover:bg-red-50 hover:text-red-600 hover:border-red-200",children:[e.jsx(Ot,{className:"w-4 h-4"}),"Clear All Sales"]}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(yt,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",d.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",g.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",f.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:x.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(yt,{className:"w-8 h-8 text-gray-400"})}),e.jsx("p",{className:"text-gray-600 font-medium text-lg",children:"No sales yet"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Your sales transactions will appear here once processed"})]})})}):x.map(s=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",s.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(s.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[s.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:s.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",s.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",s.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",s.profit?.toLocaleString()||0]})]},s.id))})]})})]})]})}function Ms(){const[t,l]=a.useState([]),[h,u]=a.useState(!1),[n,o]=a.useState({description:"",amount:"",category:"general"});a.useEffect(()=>{i();const s=()=>{console.log("Expenses data cleared - refreshing"),l([])};return window.addEventListener("dataCleared",s),()=>{window.removeEventListener("dataCleared",s)}},[]);const i=async()=>{try{const s=await it.getAll();l(Array.isArray(s)?s.reverse():[])}catch(s){console.error("Failed to load expenses:",s),l([])}},r=async()=>{if(window.confirm(`âš ï¸ Are you sure you want to clear ALL expenses data?

This action CANNOT be undone!`))try{if(!localStorage.getItem("token")){alert("âŒ Not authenticated. Please login again.");return}await Ht.clearData("expenses"),l([]),localStorage.removeItem("expenses"),window.dispatchEvent(new Event("expensesCleared")),alert("âœ… All expenses cleared successfully!")}catch(s){console.error("Failed to clear expenses:",s),alert("âŒ Failed to clear expenses: "+s.message)}},x=async s=>{s.preventDefault(),await it.create({...n,amount:parseFloat(n.amount)}),o({description:"",amount:"",category:"general"}),u(!1),i()},d=t.reduce((s,v)=>s+v.amount,0),g=t.filter(s=>!s.automatic),f=t.filter(s=>s.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:r,className:"btn-secondary flex items-center gap-2 hover:bg-red-50 hover:text-red-600 hover:border-red-200",children:[e.jsx(Ot,{className:"w-4 h-4"}),"Clear All"]}),e.jsxs("button",{onClick:()=>u(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Add Expense"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",d.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",g.reduce((s,v)=>s+v.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",f.reduce((s,v)=>s+v.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.map(s=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:s.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:s.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${s.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:s.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",s.amount?.toLocaleString()]})]},s.id))})]})})]}),h&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:n.description,onChange:s=>o({...n,description:s.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:n.amount,onChange:s=>o({...n,amount:s.target.value}),required:!0}),e.jsxs("select",{className:"input",value:n.category,onChange:s=>o({...n,category:s.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function qs(){const{isCashierUserManagementEnabled:t,isCashier:l}=Ce(),[h,u]=a.useState([]),[n,o]=a.useState(!0),[i,r]=a.useState(!1),[x,d]=a.useState(null),[g,f]=a.useState(null),[s,v]=a.useState(null),[b,j]=a.useState(0),[y,P]=a.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),[E,S]=a.useState(!1),[T,k]=a.useState(null),[F,$]=a.useState("");a.useEffect(()=>{D()},[]),a.useEffect(()=>()=>{s?.intervalId&&clearInterval(s.intervalId)},[s]);const D=async()=>{try{o(!0);const w=await Ee.getAll();u(Array.isArray(w)?w:[])}catch(w){console.error("Error loading users:",w),u([])}finally{o(!1)}},N=()=>Math.floor(1e3+Math.random()*9e3).toString(),C=async w=>{if(w.preventDefault(),console.log("Form submitted with data:",y),!y.name?.trim()||!y.email?.trim()||!y.password?.trim()){alert("Please fill in all required fields");return}if(y.password.length<6){alert("Password must be at least 6 characters long");return}try{o(!0);const z=N(),J={name:y.name.trim(),email:y.email.trim().toLowerCase(),password:y.password.trim(),pin:z};console.log("Sending user data:",J);const ce=await Ee.create(J);console.log("User creation result:",ce),await D();const fe=`âœ… Cashier added successfully!

ðŸ“§ Email: ${J.email}
ðŸ”‘ Password: ${J.password}
ðŸ”¢ PIN: ${z}

ðŸ’¡ LOGIN OPTIONS:
1. Email + Password: Use email and password above
2. PIN Login: Use email + ${z}

Please share these credentials securely with the new cashier.`;alert(fe),P({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),r(!1)}catch(z){console.error("Error creating cashier:",z);let J="Failed to add cashier";z.message.includes("Current user not found")?J="Authentication error. Please refresh the page and try again.":z.message.includes("email")?J="Email already exists. Please use a different email.":z.message.includes("network")||z.message.includes("fetch")?J="Network error. Please check your connection and try again.":z.message&&(J=`Failed to add cashier: ${z.message}`),alert(J)}finally{o(!1)}},I=async(w,z)=>{try{o(!0),await Ee.update(w,{permissions:z}),await D(),d(null)}catch(J){console.error("Error updating permissions:",J),alert("Failed to update permissions: "+J.message)}finally{o(!1)}},K=async(w,z)=>{try{o(!0);const J=!z,ce=await fetch(`${ue}/users/${w}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({active:J})});if(!ce.ok){const fe=await ce.json().catch(()=>({error:"Network error"}));throw new Error(fe.error||`HTTP ${ce.status}: ${ce.statusText}`)}await D()}catch(J){console.error("Error updating user status:",J),alert("Failed to update user status: "+J.message)}finally{o(!1)}},V=async(w,z)=>{try{o(!0);const J=!z,ce=await fetch(`${ue}/users/${w}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({locked:J})});if(!ce.ok){const fe=await ce.json().catch(()=>({error:"Network error"}));throw new Error(fe.error||`HTTP ${ce.status}: ${ce.statusText}`)}await D()}catch(J){console.error("Error updating user lock status:",J),alert("Failed to update user lock status: "+J.message)}finally{o(!1)}},de=async w=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{o(!0),await Ee.delete(w),await D()}catch(z){console.error("Error deleting user:",z),alert("Failed to delete user: "+z.message)}finally{o(!1)}},G=w=>{k(w),$(N()),S(!0)},he=async()=>{try{o(!0),await Ee.update(T.id,{cashierPIN:F}),await D(),S(!1),k(null),$(""),alert(`âœ… PIN reset successfully!

ðŸ”¢ New PIN for ${T.name}: ${F}

Please share this PIN securely with the cashier.`)}catch(w){console.error("Error resetting PIN:",w),alert("Failed to reset PIN: "+w.message)}finally{o(!1)}},ie=w=>{f(w),v({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const z=setInterval(()=>{B(w)},3e3);v(J=>({...J,intervalId:z})),B(w)},H=()=>{s?.intervalId&&clearInterval(s.intervalId),f(null),v(null)},B=async w=>{try{const z=await He.getAll(),ce=(Array.isArray(z)?z:[]).filter(se=>se.cashierId===w.id).sort((se,ve)=>new Date(ve.createdAt)-new Date(se.createdAt)).slice(0,10),fe={isActive:Math.random()>.3,currentCart:ce.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:ce.reduce((se,ve)=>se+ve.total,0),salesCount:ce.length,lastActivity:ce.length>0?new Date(ce[0].createdAt).toLocaleTimeString():"No recent activity"};v(fe)}catch(z){console.error("Error loading live view data:",z)}},re=(h||[]).filter(w=>w.role==="cashier");return n&&h.length===0?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),t()&&e.jsxs("button",{onClick:()=>r(!0),className:"btn-primary flex items-center gap-2",disabled:n,children:[e.jsx(Ne,{className:"w-4 h-4"}),"Add Cashier"]})]}),l()&&!t()&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(ye,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"User Management Restricted"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The admin has disabled cashier user management. You cannot add, edit, or remove users at this time."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:h.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:re.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:h.filter(w=>w.active).length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(h||[]).map(w=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:w.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:w.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${w.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:w.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:w.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:w.role==="cashier"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:w.pin||w.cashierPIN||"----"}),e.jsx("button",{onClick:()=>G(w),className:"p-1 hover:bg-yellow-50 rounded text-yellow-600",title:"Reset PIN",disabled:n,children:e.jsx(Ue,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${w.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:w.active?e.jsxs(e.Fragment,{children:[e.jsx(Nt,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(vt,{className:"w-3 h-3"}),"Inactive"]})}),w.locked&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:[e.jsx(at,{className:"w-3 h-3"}),"Locked"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>K(w.id,w.active),className:`p-2 rounded-lg transition ${w.active?"hover:bg-red-50 text-red-600":"hover:bg-green-50 text-green-600"}`,title:w.active?"Deactivate User":"Activate User",disabled:n,children:w.active?e.jsx(vt,{className:"w-4 h-4"}):e.jsx(Nt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>V(w.id,w.locked||!1),className:`p-2 rounded-lg transition ${w.locked?"hover:bg-green-50 text-green-600":"hover:bg-red-50 text-red-600"}`,title:w.locked?"Unlock User":"Lock User",disabled:n,children:e.jsx(at,{className:"w-4 h-4"})})]}),w.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",w.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(Qe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ie(w),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(wt,{className:"w-4 h-4"})})]}),t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>d(w),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600",title:"Edit Permissions",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>de(w.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",title:"Delete User",disabled:n,children:e.jsx(De,{className:"w-4 h-4"})})]})]})})]},w.id))})]}),h.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ie,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first cashier to get started"})]})]})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:y.name||"",onChange:w=>{console.log("Name input changed:",w.target.value),P({...y,name:w.target.value})},required:!0,disabled:n}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:y.email||"",onChange:w=>{console.log("Email input changed:",w.target.value),P({...y,email:w.target.value})},required:!0,disabled:n}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:y.password||"",onChange:w=>{console.log("Password input changed:",w.target.value),P({...y,password:w.target.value})},required:!0,minLength:6,disabled:n}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(y.permissions).map(([w,z])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:z,onChange:J=>P({...y,permissions:{...y.permissions,[w]:J.target.checked}}),disabled:n}),e.jsx("span",{className:"text-sm capitalize",children:w.replace(/([A-Z])/g," $1").trim()})]},w))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:n,children:n?"Adding...":"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>r(!1),className:"btn-secondary",disabled:n,children:"Cancel"})]})]})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",x.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(x.permissions||{}).map(([w,z])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:z,onChange:J=>d({...x,permissions:{...x.permissions,[w]:J.target.checked}}),disabled:n}),e.jsx("span",{className:"text-sm capitalize",children:w.replace(/([A-Z])/g," $1").trim()})]},w))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>I(x.id,x.permissions),className:"btn-primary flex-1",disabled:n,children:n?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>d(null),className:"btn-secondary",disabled:n,children:"Cancel"})]})]})}),g&&s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(wt,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",g.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:H,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(Re,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${s.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:s.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(qe,{className:"w-4 h-4"}),"Last Activity: ",s.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Xe,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(s.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(s.currentCart||[]).map((w,z)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[w.name," x",w.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",w.price.toLocaleString()]})]},z)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(s.currentCart||[]).reduce((w,z)=>w+z.price*z.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:s.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",s.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",s.salesCount>0?Math.round(s.totalSalesToday/s.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})}),E&&T&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Reset PIN for ",T.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate a new 4-digit PIN for this cashier. The old PIN will be invalid."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"New PIN:"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-mono text-3xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:F})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>$(N()),className:"btn-secondary flex-1",disabled:n,children:"Generate New PIN"}),e.jsx("button",{onClick:he,className:"btn-primary flex-1",disabled:n,children:n?"Updating...":"Confirm & Update"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>{S(!1),k(null),$("")},className:"btn-secondary w-full",disabled:n,children:"Cancel"})})]})})]})}function _s(){const[t,l]=a.useState([]),[h,u]=a.useState("all");a.useEffect(()=>{n()},[]);const n=()=>{const x=JSON.parse(localStorage.getItem("clockRecords")||"[]");l(x.reverse())},o=h==="all"?t:t.filter(x=>x.date===new Date().toDateString()),i=o.filter(x=>x.date===new Date().toDateString()).reduce((x,d)=>x+d.duration,0)/60,r=x=>{const d=Math.floor(x/60),g=x%60;return`${d}h ${g}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(qe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[i.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(ft,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(o.filter(x=>x.date===new Date().toDateString()).map(x=>x.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(ze,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:t.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${h==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>u("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${h==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"})]})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-gray-500",children:"No records found"})}):o.map((x,d)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:x.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.clockIn).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.clockIn).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.clockOut).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:r(x.duration)})})]},d))})]})})]})]})}function Bs(){const{user:t,updateUser:l}=Ce();Me();const[h,u]=a.useState(!1),[n,o]=a.useState(t?.plan||"ultra"),[i,r]=a.useState({}),[x,d]=a.useState(null),[g,f]=a.useState(t?.profilePicture||null),[s,v]=a.useState(!0),[b,j]=a.useState(!0);a.useEffect(()=>{y()},[]);const y=async()=>{try{const D=await Je.get();r(D),D.logo&&d(D.logo),v(D.cashierUserManagement!==!1),j(D.realTimeProductSync!==!1)}catch(D){console.error("Failed to load settings:",D)}},P=async D=>{try{const N={...i,...D};return await Je.update(N),r(N),!0}catch(N){return console.error("Failed to save settings:",N),!1}},E=async()=>{const D=!s;v(D),await P({cashierUserManagement:D})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{cashierUserManagement:D}})),alert(`âœ… Cashier User Management ${D?"ENABLED":"DISABLED"}`)):(v(!D),alert("âŒ Failed to save setting. Please try again."))},S=async()=>{const D=!b;j(D),await P({realTimeProductSync:D})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{realTimeProductSync:D}})),alert(`âœ… Real-time Product Sync ${D?"ENABLED":"DISABLED"}`)):(j(!D),alert("âŒ Failed to save setting. Please try again."))},T=async D=>{const N=D.target.files[0];if(N){const C=new FileReader;C.onloadend=async()=>{const I=C.result;d(I);try{await Je.update({...i,logo:I}),r({...i,logo:I})}catch(K){console.error("Failed to save logo:",K)}},C.readAsDataURL(N)}},k=async D=>{const N=D.target.files[0];if(N){const C=new FileReader;C.onloadend=async()=>{const I=C.result;f(I);try{await l({...t,profilePicture:I})}catch(K){console.error("Failed to save profile picture:",K)}},C.readAsDataURL(N)}},F=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],$=async()=>{const D=F.find(C=>C.id===n),N=n==="ultra"?"admin":"cashier";await l({...t,role:N,plan:n,price:D.price}),u(!1),setTimeout(()=>window.location.href=N==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(ft,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[g?e.jsx("img",{src:g,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:t?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(St,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:k})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(rt,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>u(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(bt,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cashier User Management"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Cashier User Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow cashiers to add and remove users"})]}),e.jsx("button",{onClick:E,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${s?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${s?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${s?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:s?"âœ… Cashiers can add and remove users when enabled":"âŒ Cashiers cannot add or remove users when disabled"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(is,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Real-time Product Sync"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Real-time Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync products between admin and cashier dashboards"})]}),e.jsx("button",{onClick:S,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${b?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${b?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${b?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:b?"âœ… Products will sync in real-time across all dashboards":"âŒ Products will not sync automatically across dashboards"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(at,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(os,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[x&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:x,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(St,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:T})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),h&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:F.map(D=>e.jsxs("div",{onClick:()=>o(D.id),className:`card cursor-pointer transition-all ${n===D.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:D.name}),n===D.id&&e.jsx(lt,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",D.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:D.features.map((N,C)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(lt,{className:"w-4 h-4 text-green-600"}),N]},C))})]},D.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:$,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>u(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function Js(){const[t,l]=a.useState([]),[h,u]=a.useState(!1),[n,o]=a.useState(null),[i,r]=a.useState({name:"",amount:"",description:"",active:!0});a.useEffect(()=>{x()},[]);const x=()=>{const s=JSON.parse(localStorage.getItem("serviceFees")||"[]");l(s)},d=s=>{localStorage.setItem("serviceFees",JSON.stringify(s)),l(s)},g=s=>{if(s.preventDefault(),n){const v=t.map(b=>b.id===n.id?{...i,id:b.id}:b);d(v)}else{const v={...i,id:Date.now(),createdAt:new Date().toISOString()};d([...t,v])}u(!1),o(null),r({name:"",amount:"",description:"",active:!0})},f=s=>{confirm("Delete this service fee?")&&d(t.filter(v=>v.id!==s))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{u(!0),o(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(s=>e.jsxs("div",{className:`card ${s.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx($e,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.description})]})]}),e.jsx("span",{className:`badge ${s.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:s.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",s.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{o(s),r(s),u(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(Ue,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>f(s.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(De,{className:"w-4 h-4 text-red-600"})})]})]})]},s.id))}),h&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:i.name,onChange:s=>r({...i,name:s.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:i.amount,onChange:s=>r({...i,amount:s.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:i.description,onChange:s=>r({...i,description:s.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:i.active,onChange:s=>r({...i,active:s.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function zs(){const{user:t}=Ce(),[l,h]=a.useState([]),[u,n]=a.useState([]),[o,i]=a.useState(!1),[r,x]=a.useState(!1),[d,g]=a.useState([]),[f,s]=a.useState(""),[v,b]=a.useState("all"),[j,y]=a.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});a.useEffect(()=>{P(),E(),F();const N=()=>{F()};return window.addEventListener("messageReceived",N),()=>window.removeEventListener("messageReceived",N)},[]);const P=async()=>{try{const N=localStorage.getItem("token"),C=await fetch(`${ue}/reminders`,{headers:{Authorization:`Bearer ${N}`}});if(!C.ok){console.error("API Error:",C.status,C.statusText),h([]);return}const I=await C.json();Array.isArray(I)?h(I):(console.error("Expected array but got:",typeof I,I),h([]))}catch(N){console.error("Failed to fetch reminders:",N),h([])}},E=async()=>{try{const N=localStorage.getItem("token"),C=await fetch(`${ue}/products`,{headers:{Authorization:`Bearer ${N}`}});if(!C.ok){console.error("API Error:",C.status,C.statusText),n([]);return}const I=await C.json();Array.isArray(I)?n(I):(console.error("Expected array but got:",typeof I,I),n([]))}catch(N){console.error("Failed to fetch products:",N),n([])}},S=async N=>{N.preventDefault();try{const C=localStorage.getItem("token"),I=await fetch(`${ue}/reminders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C}`},body:JSON.stringify(j)});if(!I.ok){const V=await I.json();console.error("Failed to create reminder:",V),alert(`Failed to create reminder: ${V.error||"Unknown error"}`);return}const K=await I.json();y({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),i(!1),P(),alert("Reminder created successfully!")}catch(C){console.error("Failed to create reminder:",C),alert("Failed to create reminder. Please try again.")}},T=async N=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const I=localStorage.getItem("token"),K=await fetch(`${ue}/reminders/${N}`,{method:"DELETE",headers:{Authorization:`Bearer ${I}`}});if(!K.ok){const V=await K.json();console.error("Failed to delete reminder:",V),alert(`Failed to delete reminder: ${V.error||"Unknown error"}`);return}P(),alert("Reminder deleted successfully!")}catch(C){console.error("Failed to delete reminder:",C),alert("Failed to delete reminder. Please try again.")}},k=N=>{j.days.includes(N)?y({...j,days:j.days.filter(C=>C!==N)}):y({...j,days:[...j.days,N]})},F=()=>{const N=`adminMessages_${t?.email||"default"}`,C=JSON.parse(localStorage.getItem(N)||"[]");g(C)},$=N=>{if(N.preventDefault(),!f.trim())return;const C={id:Date.now(),sender:"admin",recipient:v,text:f,timestamp:new Date().toISOString(),read:!1},I=`adminMessages_${t?.email||"default"}`,K=JSON.parse(localStorage.getItem(I)||"[]");K.push(C),localStorage.setItem(I,JSON.stringify(K));const V=`cashierMessages_${t?.email||"default"}`,de=JSON.parse(localStorage.getItem(V)||"[]");de.push(C),localStorage.setItem(V,JSON.stringify(de)),g(K),s(""),window.dispatchEvent(new CustomEvent("newAdminMessage",{detail:C})),alert("Message sent to cashier(s)!")},D=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(bt,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>x(!0),className:"bg-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-purple-700 transition flex items-center gap-2",children:[e.jsx(kt,{size:20}),"Message Cashier"]}),e.jsxs("button",{onClick:()=>i(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(Ne,{size:20}),"New Reminder"]})]})]}),e.jsx("div",{className:"grid gap-4",children:l.map(N=>{const C=u.find(I=>I.id===N.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${N.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:N.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",C?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",N.frequency]}),N.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",N.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(ze,{size:16}),"Next: ",new Date(N.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${N.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:N.status}),e.jsx("button",{onClick:()=>T(N.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(De,{size:20})})]})]})},N.id)})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:S,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:j.customerName,onChange:N=>y({...j,customerName:N.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:j.productId,onChange:N=>y({...j,productId:parseInt(N.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),u.map(N=>e.jsx("option",{value:N.id,children:N.name},N.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:j.frequency,onChange:N=>y({...j,frequency:N.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),j.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:D.map(N=>e.jsx("button",{type:"button",onClick:()=>k(N),className:`px-4 py-2 rounded-lg font-medium transition ${j.days.includes(N)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:N},N))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:j.nextDate,onChange:N=>y({...j,nextDate:N.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>i(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-96 flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 p-6 text-white rounded-t-2xl",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(kt,{size:24}),"Send Message to Cashier"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:d.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No messages yet. Start a conversation!"}):d.map(N=>e.jsxs("div",{className:`p-4 rounded-lg ${N.sender==="admin"?"bg-blue-50 ml-8":"bg-gray-50 mr-8"}`,children:[e.jsx("p",{className:"text-sm font-semibold text-gray-600 mb-1",children:N.sender==="admin"?"You":"Cashier"}),e.jsx("p",{className:"text-gray-800",children:N.text}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:new Date(N.timestamp).toLocaleTimeString()})]},N.id))}),e.jsxs("form",{onSubmit:$,className:"p-4 border-t space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Send To"}),e.jsxs("select",{value:v,onChange:N=>b(N.target.value),className:"w-full px-4 py-2 rounded-lg border focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"all",children:"All Cashiers"}),e.jsx("option",{value:"cashier",children:"Primary Cashier"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",value:f,onChange:N=>s(N.target.value),placeholder:"Type your message...",className:"flex-1 px-4 py-3 rounded-lg border focus:ring-2 focus:ring-purple-500"}),e.jsx("button",{type:"submit",className:"bg-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-purple-700 transition flex items-center gap-2",children:e.jsx(Ut,{size:18})})]})]}),e.jsx("button",{onClick:()=>x(!1),className:"w-full py-2 bg-gray-200 text-gray-700 font-bold hover:bg-gray-300 transition rounded-b-2xl",children:"Close"})]})})]})}function Hs(){const[t,l]=a.useState([]),[h,u]=a.useState(!1),[n,o]=a.useState(null),[i,r]=a.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});a.useEffect(()=>{x()},[]);const x=async()=>{try{const s=await Ye.getAll();l(s)}catch(s){console.error("Failed to load discounts:",s)}},d=async s=>{s.preventDefault();try{n?await Ye.update(n.id,i):await Ye.create(i),u(!1),o(null),r({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),x()}catch(v){console.error("Failed to save discount:",v)}},g=async s=>{if(confirm("Delete this discount?"))try{await Ye.delete(s),x()}catch(v){console.error("Failed to delete discount:",v)}},f=s=>{const v=new Date,b=new Date(s.validFrom),j=new Date(s.validTo);return s.active&&b<=v&&j>=v};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{u(!0),o(null),r({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(s=>e.jsxs("div",{className:`card ${f(s)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${f(s)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(ht,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[s.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${f(s)?"badge-success":"bg-gray-200 text-gray-600"}`,children:f(s)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(s.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(s.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{o(s),r(s),u(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(Ue,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>g(s.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(De,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},s.id)),t.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(ht,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),h&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:i.name,onChange:s=>r({...i,name:s.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:i.percentage,onChange:s=>r({...i,percentage:parseFloat(s.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:i.validFrom,onChange:s=>r({...i,validFrom:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:i.validTo,onChange:s=>r({...i,validTo:s.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:i.active,onChange:s=>r({...i,active:s.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ks(){const[t,l]=a.useState([]),[h,u]=a.useState([]),[n,o]=a.useState("all");a.useEffect(()=>{i(),r()},[]);const i=async()=>{try{const b=await xt.getAll();l(b)}catch(b){console.error("Failed to load credit requests:",b)}},r=async()=>{try{const b=await je.getAll();u(b)}catch(b){console.error("Failed to load products:",b)}},x=async b=>{try{await xt.approve(b),i()}catch(j){console.error("Failed to approve request:",j)}},d=async b=>{try{await xt.reject(b),i()}catch(j){console.error("Failed to reject request:",j)}},g=b=>{const j=h.find(y=>y.id===b);return j?j.name:"Unknown Product"},f=t.filter(b=>n==="all"?!0:b.status===n),s=b=>{switch(b){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},v=b=>{switch(b){case"pending":return e.jsx(qe,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(Ae,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(nt,{className:"w-6 h-6 text-red-600"});default:return e.jsx(rt,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(b=>e.jsx("button",{onClick:()=>o(b),className:`px-4 py-2 rounded-lg font-medium transition ${n===b?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:b.charAt(0).toUpperCase()+b.slice(1)},b))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[f.map(b=>e.jsx("div",{className:`card border-l-4 ${s(b.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${b.status==="pending"?"bg-orange-600":b.status==="approved"?"bg-green-600":"bg-red-600"}`,children:v(b.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:b.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:g(b.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:b.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",b.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(b.createdAt).toLocaleString()]}),b.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(b.approvedAt).toLocaleString()]})]})]}),b.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>x(b.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Ae,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>d(b.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(nt,{size:16}),"Reject"]})]}),b.status!=="pending"&&e.jsx("span",{className:`badge ${b.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:b.status.toUpperCase()})]})},b.id)),f.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(rt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",n!=="all"?n:""," credit requests found."]})]})]})]})}function Vs(){const{user:t}=Ce(),[l,h]=a.useState([]),[u,n]=a.useState(!1),[o,i]=a.useState(!1),[r,x]=a.useState(null),[d,g]=a.useState(null),[f,s]=a.useState(""),[v,b]=a.useState({supplierName:"",details:"",orderDate:"",expectedDelivery:"",amount:""}),j=(k,F="success")=>{g({message:k,type:F}),setTimeout(()=>g(null),3e3)};a.useEffect(()=>{y()},[t]);const y=()=>{try{const k=`vendors_${t?.email||"default"}`,F=JSON.parse(localStorage.getItem(k)||"[]");h(F)}catch(k){console.error("Failed to load vendors:",k),h([])}},P=async k=>{k.preventDefault();try{if(!v.supplierName.trim()){j("âŒ Supplier name is required","error");return}const F={id:Math.random().toString(36).substr(2,9),supplierName:v.supplierName,details:v.details,orderDate:v.orderDate,expectedDelivery:v.expectedDelivery,amount:parseFloat(v.amount||0),createdBy:t?.id||t?.name||"Unknown",createdAt:new Date().toISOString()},$=`vendors_${t?.email||"default"}`,D=JSON.parse(localStorage.getItem($)||"[]");D.push(F),localStorage.setItem($,JSON.stringify(D)),b({supplierName:"",details:"",orderDate:"",expectedDelivery:"",amount:""}),n(!1),y(),j(`âœ… Vendor "${F.supplierName}" added successfully!`,"success")}catch(F){console.error("Failed to add vendor:",F),j(`âŒ Failed to add vendor: ${F.message}`,"error")}},E=async k=>{k.preventDefault();try{if(!r.supplierName.trim()){j("âŒ Supplier name is required","error");return}const F=`vendors_${t?.email||"default"}`,$=JSON.parse(localStorage.getItem(F)||"[]"),D=$.findIndex(N=>N.id===r.id);D!==-1&&($[D]={...r,amount:parseFloat(r.amount||0)},localStorage.setItem(F,JSON.stringify($))),i(!1),x(null),y(),j(`âœ… Vendor "${r.supplierName}" updated successfully!`,"success")}catch(F){console.error("Failed to update vendor:",F),j(`âŒ Failed to update vendor: ${F.message}`,"error")}},S=async(k,F)=>{if(confirm(`Are you sure you want to delete vendor "${F}"?`))try{const $=`vendors_${t?.email||"default"}`,N=JSON.parse(localStorage.getItem($)||"[]").filter(C=>C.id!==k);localStorage.setItem($,JSON.stringify(N)),y(),j(`âœ… Vendor "${F}" deleted successfully!`,"success")}catch($){console.error("Failed to delete vendor:",$),j(`âŒ Failed to delete vendor: ${$.message}`,"error")}},T=l.filter(k=>k.supplierName?.toLowerCase().includes(f.toLowerCase())||k.details?.toLowerCase().includes(f.toLowerCase()));return e.jsxs("div",{className:"p-6",children:[d&&e.jsx("div",{className:`mb-4 p-4 rounded-lg ${d.type==="error"?"bg-red-50 text-red-800":"bg-green-50 text-green-800"}`,children:d.message}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Ft,{className:"w-6 h-6 text-blue-600"}),"Vendor Management"]}),e.jsxs("button",{onClick:()=>n(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Add Vendor"]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search vendors by name or details...",value:f,onChange:k=>s(k.target.value),className:"input w-full"})}),e.jsx("div",{className:"card overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Supplier Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Details"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Order Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Expected Delivery"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount (KSH)"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Created By"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:T&&T.length>0?T.slice().reverse().map(k=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-semibold",children:k.supplierName}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:k.details||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:k.orderDate?new Date(k.orderDate).toLocaleDateString():"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:k.expectedDelivery?new Date(k.expectedDelivery).toLocaleDateString():"-"}),e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-orange-600",children:k.amount?k.amount.toLocaleString():"0"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:k.createdBy}),e.jsxs("td",{className:"px-4 py-3 text-sm flex gap-2",children:[e.jsx("button",{onClick:()=>{x(k),i(!0)},className:"text-blue-600 hover:text-blue-800 transition-colors",title:"Edit vendor",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S(k.id,k.supplierName),className:"text-red-600 hover:text-red-800 transition-colors",title:"Delete vendor",children:e.jsx(De,{className:"w-4 h-4"})})]})]},k.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:f?"No vendors match your search":"No vendors added yet"})})})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Vendor"}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Supplier Name",value:v.supplierName,onChange:k=>b({...v,supplierName:k.target.value}),className:"input w-full",required:!0}),e.jsx("textarea",{placeholder:"Details (optional)",value:v.details,onChange:k=>b({...v,details:k.target.value}),className:"input w-full",rows:"2"}),e.jsx("input",{type:"date",value:v.orderDate,onChange:k=>b({...v,orderDate:k.target.value}),className:"input w-full"}),e.jsx("input",{type:"date",value:v.expectedDelivery,onChange:k=>b({...v,expectedDelivery:k.target.value}),className:"input w-full"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount (KSH)",value:v.amount,onChange:k=>b({...v,amount:k.target.value}),className:"input w-full"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Vendor"}),e.jsx("button",{type:"button",onClick:()=>{n(!1),b({supplierName:"",details:"",orderDate:"",expectedDelivery:"",amount:""})},className:"btn-secondary flex-1",children:"Cancel"})]})]})]})}),o&&r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Vendor"}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Supplier Name",value:r.supplierName,onChange:k=>x({...r,supplierName:k.target.value}),className:"input w-full",required:!0}),e.jsx("textarea",{placeholder:"Details (optional)",value:r.details,onChange:k=>x({...r,details:k.target.value}),className:"input w-full",rows:"2"}),e.jsx("input",{type:"date",value:r.orderDate,onChange:k=>x({...r,orderDate:k.target.value}),className:"input w-full"}),e.jsx("input",{type:"date",value:r.expectedDelivery,onChange:k=>x({...r,expectedDelivery:k.target.value}),className:"input w-full"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount (KSH)",value:r.amount,onChange:k=>x({...r,amount:k.target.value}),className:"input w-full"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Vendor"}),e.jsx("button",{type:"button",onClick:()=>{i(!1),x(null)},className:"btn-secondary flex-1",children:"Cancel"})]})]})]})})]})}function Gt({onClose:t}){const[l,h]=a.useState([]),[u,n]=a.useState(!0),o=a.useRef({data:null,timestamp:null}),i=3e4;a.useEffect(()=>{r()},[]);const r=async()=>{try{const d=Date.now();if(o.current.data&&o.current.timestamp&&d-o.current.timestamp<i){console.log("ðŸ“¦ Using cached reminders"),h(o.current.data),n(!1);return}const g=localStorage.getItem("token"),f=await fetch(`${ue}/reminders/today`,{headers:{Authorization:`Bearer ${g}`}});if(!f.ok){console.error("API Error:",f.status,f.statusText),h([]),n(!1);return}const s=await f.json();Array.isArray(s)?(o.current.data=s,o.current.timestamp=Date.now(),h(s)):(console.error("Expected array but got:",typeof s,s),h([]))}catch(d){console.error("Failed to fetch reminders:",d),h([])}finally{n(!1)}},x=async d=>{try{const g=localStorage.getItem("token");await fetch(`${ue}/reminders/${d}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify({status:"fulfilled"})}),o.current={data:null,timestamp:null},r()}catch(g){console.error("Failed to update reminder:",g)}};return u?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:t,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(Re,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(tt,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):l.map(d=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:d.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",d.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:d.frequency})]}),e.jsxs("button",{onClick:()=>x(d.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Ae,{size:18}),"Mark Done"]})]},d.id))})]})})}function Yt({onUnlock:t,userType:l="user"}){const[h,u]=a.useState(""),[n,o]=a.useState(""),[i,r]=a.useState("password"),[x,d]=a.useState(!1),[g,f]=a.useState(""),[s,v]=a.useState(!1),[b,j]=a.useState("2005"),y=JSON.parse(localStorage.getItem("user")||"{}");a.useEffect(()=>{(async()=>{try{const T=await Je.get();T?.screenLockPassword&&j(T.screenLockPassword)}catch(T){console.warn("Failed to load settings, using default password:",T)}})()},[]),a.useEffect(()=>{const S=document.getElementById(i==="password"?"unlock-password":"unlock-pin");S&&S.focus()},[i]);const P=async S=>{S.preventDefault(),S.stopPropagation(),v(!0),f("");try{const T=localStorage.getItem("token");if(!T)throw new Error("No authentication token found");const k=await fetch("https://posifine22.onrender.com/api/auth/unlock-screen",{method:"POST",headers:{Authorization:`Bearer ${T}`,"Content-Type":"application/json"},body:JSON.stringify({pin:n})});if(!k.ok){const $=await k.json();throw k.status===429?new Error($.message||"Too many failed attempts. Try again later."):k.status===401?new Error($.message||"Incorrect PIN"):new Error($.message||"Unlock failed")}const F=await k.json();F.token&&localStorage.setItem("token",F.token),o(""),u(""),t(F)}catch(T){f(T.message||"Unlock failed")}finally{v(!1)}},E=S=>{const T=S.replace(/\D/g,"").slice(0,4);o(T)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:S=>S.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${l==="main_admin"?"bg-gradient-to-br from-red-600 to-orange-600":"bg-gradient-to-br from-blue-600 to-purple-600"}`,children:e.jsx(ye,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-gray-600",children:l==="main_admin"?"Main Admin":y.name||"User"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Enter your ",i," to continue"]})]}),e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter PIN to unlock"}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",id:"unlock-pin",value:n,onChange:S=>E(S.target.value),placeholder:"0000",maxLength:"4",className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-center tracking-widest text-2xl",disabled:s})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"ðŸ”’ PIN validated securely on server"})]}),g&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-red-700 text-sm font-medium",children:[g.includes("Too many")?"âŒ ":"âš ï¸ ",g]})}),e.jsx("button",{type:"submit",disabled:s||n.length<4,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 rounded-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"}),"Verifying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-5 h-5"}),"Unlock Screen"]})})]})]})})}function Qt(t=6e4){const[l,h]=a.useState(!1),u=a.useRef(Date.now()),n=a.useCallback(()=>{u.current=Date.now(),h(!1)},[]),o=a.useCallback(()=>{h(!1),u.current=Date.now()},[]);return a.useEffect(()=>{const i=["mousedown","mousemove","keypress","scroll","touchstart","click"],r=()=>{u.current=Date.now(),l&&h(!1)};i.forEach(d=>{document.addEventListener(d,r,!0)});const x=setInterval(()=>{Date.now()-u.current>t&&!l&&h(!0)},5e3);return()=>{i.forEach(d=>{document.removeEventListener(d,r,!0)}),clearInterval(x)}},[t,l]),[l,o,n]}function Ws(){const{user:t,logout:l,isCashierUserManagementEnabled:h}=Ce(),u=Me(),n=Et(),[o,i]=a.useState(!0),[r,x]=a.useState(!1),[d,g]=a.useState({}),[f,s]=Qt(45e3);a.useEffect(()=>{f&&console.log("ðŸ”’ Screen locked - navigation disabled")},[f]),a.useEffect(()=>{(async()=>{try{const P=localStorage.getItem("user");if(!P){u("/auth/login");return}const E=JSON.parse(P);if(E.role!=="admin"&&E.plan!=="ultra"){console.warn("âš ï¸ User does not have admin access"),u("/dashboard");return}try{const T=await Je.get();g(T)}catch(T){console.error("Failed to load settings:",T)}sessionStorage.getItem("adminReminderShown")||setTimeout(()=>{x(!0),sessionStorage.setItem("adminReminderShown","true")},1e3)}catch(P){console.error("Dashboard initialization error:",P)}})()},[]);const v=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses data? This action cannot be undone."))try{const y=localStorage.getItem("token"),E=await fetch(`${ue}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!E.ok){const S=await E.json();throw console.error("Clear data error:",S),new Error(S.message||"Failed to clear data")}localStorage.removeItem("products"),localStorage.removeItem("sales"),localStorage.removeItem("expenses"),localStorage.removeItem("users"),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new CustomEvent("dataCleared")),alert("âœ… Data cleared successfully! Refreshing..."),setTimeout(()=>{window.location.href="/admin"},500)}catch(y){console.error("Failed to clear data:",y),alert("âŒ Failed to clear data: "+y.message)}},b=[{id:"overview",label:"Dashboard",icon:cs,path:"/admin"},{id:"sales",label:"Sales",icon:Lt,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:Fe,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:Rt,path:"/admin/recipes"},{id:"vendors",label:"Vendors",icon:Ft,path:"/admin/vendors"},{id:"expenses",label:"Expenses",icon:st,path:"/admin/expenses"},...h()?[{id:"users",label:"Users",icon:Ie,path:"/admin/users"}]:[],{id:"time",label:"Time Tracking",icon:qe,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:bt,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:$e,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:ht,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:rt,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:ds,path:"/admin/settings"}],j=y=>y==="/admin"?n.pathname==="/admin":n.pathname.startsWith(y);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${o?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[o&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>i(!o),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:o?e.jsx(Re,{className:"w-5 h-5"}):e.jsx(ms,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:b.map(y=>{const P=y.icon;return e.jsxs("button",{onClick:()=>u(y.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${j(y.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(P,{className:"w-5 h-5 flex-shrink-0"}),o&&e.jsx("span",{className:"font-medium",children:y.label})]},y.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(xs,{className:"w-5 h-5 flex-shrink-0"}),o&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:l,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(jt,{className:"w-5 h-5 flex-shrink-0"}),o&&e.jsx("span",{className:"font-medium",children:"Logout"})]}),e.jsxs("button",{onClick:v,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors",children:[e.jsx(Re,{className:"w-5 h-5 flex-shrink-0"}),o&&e.jsx("span",{className:"font-medium",children:"Clear Data"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:b.find(y=>j(y.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:t?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(Tt,{children:[e.jsx(ne,{path:"/",element:e.jsx(Ls,{})}),e.jsx(ne,{path:"/sales",element:e.jsx(Rs,{})}),e.jsx(ne,{path:"/inventory",element:e.jsx(Us,{})}),e.jsx(ne,{path:"/recipes",element:e.jsx(Fs,{})}),e.jsx(ne,{path:"/vendors",element:e.jsx(Vs,{})}),e.jsx(ne,{path:"/expenses",element:e.jsx(Ms,{})}),e.jsx(ne,{path:"/reminders",element:e.jsx(zs,{})}),e.jsx(ne,{path:"/service-fees",element:e.jsx(Js,{})}),e.jsx(ne,{path:"/discounts",element:e.jsx(Hs,{})}),e.jsx(ne,{path:"/credit-requests",element:e.jsx(Ks,{})}),e.jsx(ne,{path:"/users",element:e.jsx(qs,{})}),e.jsx(ne,{path:"/time",element:e.jsx(_s,{})}),e.jsx(ne,{path:"/settings",element:e.jsx(Bs,{})})]})})]}),r&&e.jsx(Gt,{onClose:()=>x(!1)}),f&&e.jsx(Yt,{onUnlock:s,logo:d.logo})]})}function Gs(){const t=Me(),[l,h]=a.useState(!1),[u,n]=a.useState(0),o=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 900) or Ultra (KSH 1,600) package",image:"ðŸ“",details:"First user becomes Admin automatically. Choose Ultra for full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],i=[{icon:Fe,title:"Smart Inventory",desc:"Track raw materials & composite products with automatic stock deduction"},{icon:Rt,title:"Recipe Builder",desc:"Create bundled products with BOM and auto-calculate COGS"},{icon:Le,title:"Real-time Analytics",desc:"Monitor sales, profit margins, and expenses in real-time"},{icon:Ie,title:"User Management",desc:"Add cashiers with custom permissions and role-based access"},{icon:at,title:"Secure & Reliable",desc:"JWT authentication with role-based security"},{icon:pt,title:"Advanced Reports",desc:"Daily, weekly summaries with profit/loss tracking"}],r=[{name:"Basic",price:900,icon:qt,popular:!1,features:["Cashier Dashboard","Basic Inventory","Sales Tracking","Daily/Weekly Reports","Single User","Email Support"]},{name:"Ultra",price:1600,icon:_t,popular:!0,features:["Admin + Cashier Dashboard","Full Inventory Management","Recipe/BOM Builder","Auto Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Unlimited Users","Priority Support"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/auth/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(us,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(We,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(Mt,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 30-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(pt,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:i.map((x,d)=>{const g=x.icon;return e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(g,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:x.title}),e.jsx("p",{className:"text-gray-600",children:x.desc})]},d)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:r.map((x,d)=>{const g=x.icon;return e.jsxs("div",{className:`relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${x.popular?"ring-4 ring-blue-600":""}`,children:[x.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${x.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(g,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:x.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",x.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:x.features.map((f,s)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(lt,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:f})]},s))}),e.jsx("button",{onClick:()=>t("/plans"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${x.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},d)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(We,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{h(!1),n(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Re,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",u+1," of ",o.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((u+1)/o.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(u+1)/o.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:o[u].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:o[u].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:o[u].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:o[u].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>n(Math.max(0,u-1)),disabled:u===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),u<o.length-1?e.jsxs("button",{onClick:()=>n(u+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(We,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{h(!1),n(0),t("/plans")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(We,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:o.map((x,d)=>e.jsx("button",{onClick:()=>n(d),className:`w-2 h-2 rounded-full transition-all ${d===u?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},d))})]})]})})]})}function It(){const t=Et(),[l,h]=a.useState(t.pathname==="/auth/login"),[u,n]=a.useState("password"),[o,i]=a.useState({email:"",password:"",pin:"",name:"",newPassword:"",confirmPassword:""}),[r,x]=a.useState(""),[d,g]=a.useState(!1),[f,s]=a.useState(!1),v=Me(),{login:b}=Ce(),j=()=>{try{return JSON.parse(localStorage.getItem("selectedPlan")||"null")}catch(P){return console.warn("Invalid selectedPlan in localStorage:",P),null}},y=async P=>{P.preventDefault(),x(""),g(!0);const E=performance.now();try{if(f){if(o.newPassword!==o.confirmPassword){x("Passwords do not match"),g(!1);return}if(o.newPassword.length<6){x("Password must be at least 6 characters"),g(!1);return}const $=await Te.login({email:o.email,newPassword:o.newPassword});$.token&&$.user&&(await b($),v("/dashboard"));return}if(l){if(u==="pin"){if(!o.pin||o.pin.length!==4){x("Please enter a valid 4-digit PIN"),g(!1);return}}else if(!o.password){x("Please enter your password"),g(!1);return}}let S;if(l)if(u==="pin")try{S=await Te.pinLogin({email:o.email,pin:o.pin})}catch($){if($.message.includes("PIN not set"))x("PIN not set for this user. Please use password login.");else if($.message.includes("Invalid PIN"))x("Invalid PIN. Please try again.");else throw $;g(!1);return}else S=await Te.login({email:o.email,password:o.password});else{const $=j();S=await Te.signup({...o,plan:$?.id||"basic"})}if(S.needsPasswordSetup){s(!0),i({...o,email:S.email}),x(""),g(!1);return}if(!S||!S.user||!S.token)throw new Error("Authentication failed. Please try again.");if(S.user?.locked){x("Your account has been locked by the administrator."),g(!1);return}await b(S);const T={id:Date.now(),type:l?"login":"signup",user:{id:S.user.id,name:S.user.name,email:S.user.email,role:S.user.role,plan:S.user.plan},timestamp:new Date().toISOString()};Promise.resolve().then(()=>{const $=JSON.parse(localStorage.getItem("authActivities")||"[]");$.unshift(T),$.splice(50),localStorage.setItem("authActivities",JSON.stringify($))});const k=l?"logged in":"signed up";console.log(`âœ… User ${S.user.name} ${k} successfully`);const F=performance.now()-E;console.log(`âš¡ Auth completed in ${F.toFixed(0)}ms`),S.user.role==="admin"?v("/admin"):(S.user.role==="cashier"||console.log("No role detected, defaulting to cashier"),v("/dashboard/cashier"))}catch(S){console.error("Authentication error:",S);let T=S.message||"Authentication failed. Please try again.";S.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),T="Invalid credentials. Please try again."),x(T)}finally{g(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:l?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600",children:l?"Login to your account":"Create your account"})]}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[f?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:o.newPassword,onChange:P=>i({...o,newPassword:P.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:o.confirmPassword,onChange:P=>i({...o,confirmPassword:P.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!l&&e.jsxs("div",{className:"relative",children:[e.jsx(ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:o.name,onChange:P=>i({...o,name:P.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(et,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:o.email,onChange:P=>i({...o,email:P.target.value}),required:!0})]}),l&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Login Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n("password"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${u==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Password"}),e.jsx("button",{type:"button",onClick:()=>n("pin"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${u==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"pin"})]})]}),l&&u==="password"&&e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:o.password,onChange:P=>i({...o,password:P.target.value}),required:!0})]}),l&&u==="pin"&&e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:o.pin,onChange:P=>i({...o,pin:P.target.value.replace(/\D/g,"").slice(0,4)}),maxLength:4,required:!0})]}),!l&&e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:o.password,onChange:P=>i({...o,password:P.target.value}),required:!0})]})]}),r&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:r}),e.jsx("button",{type:"submit",disabled:d,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50",children:d?"Please wait...":f?"Set Password":l?"Login":"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{h(!l),x(""),s(!1)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:l?"Don't have an account? Sign up":"Already have an account? Login"})})]})})}function Ys(){const[t,l]=a.useState("ultra"),[h,u]=a.useState(!1),[n,o]=a.useState({name:"",email:"",company:""}),i=Me(),r=[{id:"basic",name:"Professional Package",price:1500,icon:qt,color:"from-green-500 to-teal-600",features:["Admin Dashboard + Cashier POS","Basic Inventory Management","Sales Tracking","Daily/Weekly Sales Summaries","Basic Profit/Loss View","Limited Email Notifications","Record Products Sold","Up to 2 Users","Vendor Management","Basic Expense Tracking","Limited Analytics"]},{id:"ultra",name:"Ultra Package (Enterprise)",price:3e3,icon:_t,color:"from-blue-600 to-purple-600",popular:!0,features:["Admin Dashboard + Cashier POS","Full Inventory Management","Recipe/BOM Builder","Composite Products Support","Automatic Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Advanced Analytics","Unlimited Users","Vendor Management","Advanced Reporting","Priority Support"]}],x=async d=>{d.preventDefault();try{await fetch(`${ue}/demo-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),alert("Demo request submitted! Admin will review and contact you."),u(!1),o({name:"",email:"",company:""})}catch(g){console.error("Demo request failed:",g),alert("Failed to submit demo request. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:()=>i("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition",children:[e.jsx(hs,{size:20}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mb-8 md:mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Select the perfect plan for your business needs"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6 md:mb-8",children:r.map(d=>{const g=d.icon;return e.jsxs("div",{onClick:()=>l(d.id),className:`card cursor-pointer transition-all transform hover:scale-105 relative ${t===d.id?"ring-4 ring-blue-600 shadow-2xl bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-xl"}`,children:[d.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 md:mb-4",children:[e.jsx("div",{className:`w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br ${d.color} flex items-center justify-center`,children:e.jsx(g,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:d.name})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("span",{className:"text-3xl md:text-4xl font-bold",children:["KSH ",d.price]}),e.jsx("span",{className:"text-gray-600 text-sm md:text-base",children:"/month"})]}),e.jsx("ul",{className:"space-y-2 md:space-y-3",children:d.features.map((f,s)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(lt,{className:"w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs md:text-sm",children:f})]},s))})]},d.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center animate-fade-in",children:[e.jsx("button",{onClick:()=>{console.log("Get Started clicked with plan:",t);const d=r.find(g=>g.id===t);console.log("Selected plan:",d),localStorage.setItem("selectedPlan",JSON.stringify(d)),i("/auth/signup")},className:"btn-primary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all",children:"Get Started"}),e.jsx("button",{onClick:()=>u(!0),className:"btn-secondary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg border-2 border-gray-300 hover:border-gray-400 transition-all",children:"Request Free Demo"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-3 md:mt-4 text-center",children:"Secure payment â€¢ Cancel anytime"}),h&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Free Demo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"We'll contact you to schedule a demo"})]}),e.jsxs("form",{onSubmit:x,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:n.name,onChange:d=>o({...n,name:d.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:n.email,onChange:d=>o({...n,email:d.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:n.company,onChange:d=>o({...n,company:d.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition",children:"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})})}function Qs(){const{user:t,logout:l}=Ce(),[h,u]=a.useState([]),[n,o]=a.useState([]),[i,r]=a.useState([]),[x,d]=a.useState("cash"),[g,f]=a.useState("pos"),[s,v]=a.useState({sales:[],expenses:[],stats:{}}),[b,j]=a.useState(""),[y,P]=a.useState(!1),[E,S]=a.useState(!1),[T,k]=a.useState(null),[F,$]=a.useState({name:"",price:"",cost:"",category:"finished",image:""}),[D,N]=a.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[C,I]=a.useState(!1),[K,V]=a.useState({description:"",amount:"",category:""}),[de,G]=a.useState(""),[he,ie]=a.useState([]),[H,B]=a.useState(null),[re,w]=a.useState("exclusive"),[z,J]=a.useState(!1),[ce,fe]=a.useState(null),[se,ve]=a.useState(null),[p,O]=a.useState(!1);a.useEffect(()=>{Q();const c=localStorage.getItem(`cart_${t?.id}`),L=localStorage.getItem(`paymentMethod_${t?.id}`),M=localStorage.getItem(`selectedDiscount_${t?.id}`),_=localStorage.getItem(`taxType_${t?.id}`),le=localStorage.getItem(`clockStatus_${t?.id}`),Y=localStorage.getItem(`clockInTime_${t?.id}`);if(c)try{r(JSON.parse(c))}catch(xe){console.warn("Failed to restore cart:",xe)}if(L&&d(L),_&&w(_),M)try{B(JSON.parse(M))}catch{}le==="clocked_in"&&(J(!0),Y&&ve(new Date(Y))),ae()},[t?.id]),a.useEffect(()=>{const c=localStorage.getItem("token");c&&ct.connect(c,ee=>{if(ee&&ee.allProducts){const pe=ee.allProducts.filter(we=>we.visibleToCashier!==!1&&!we.expenseOnly);u(pe)}ee&&ee.discounts&&ie(ee.discounts),ee&&ee.sale&&Q()}).catch(ee=>{console.warn("WebSocket connection failed:",ee)});const L=Cs(ee=>{try{if(!ee)return;(ee.type==="initial"||ee.type==="products_snapshot"||ee.type==="product_created"||ee.type==="product_updated"||ee.type==="product_deleted")&&je.getAll().then(pe=>u(pe.filter(we=>we.visibleToCashier!==!1&&!we.expenseOnly))).catch(()=>{})}catch(pe){console.error("Product subscription handler error",pe)}}),M=()=>{console.log("ðŸŽ‰ Product created event detected - refreshing product list"),je.getAll().then(ee=>u(ee.filter(pe=>pe.visibleToCashier!==!1&&!pe.expenseOnly))).catch(()=>{})},_=()=>{console.log("ðŸ“ Product updated event detected - refreshing product list"),je.getAll().then(ee=>u(ee.filter(pe=>pe.visibleToCashier!==!1&&!pe.expenseOnly))).catch(()=>{})},le=ee=>{const pe=ee.detail?.userId,we=t?.id;pe===we&&(console.log("ðŸ”’ Screen locked by admin"),O(!0))},Y=ee=>{const pe=ee.detail?.userId,we=t?.id;pe===we&&(console.log("ðŸ”“ Screen unlocked"),O(!1))},xe=ee=>{console.log("ðŸ’° Sale created - refreshing inventory"),je.getAll().then(pe=>u(pe.filter(we=>we.visibleToCashier!==!1&&!we.expenseOnly))).catch(()=>{}),Q()};return window.addEventListener("productCreated",M),window.addEventListener("productUpdated",_),window.addEventListener("screenLocked",le),window.addEventListener("screenUnlocked",Y),window.addEventListener("saleCreated",xe),()=>{try{L()}catch{}window.removeEventListener("productCreated",M),window.removeEventListener("productUpdated",_),window.removeEventListener("screenLocked",le),window.removeEventListener("screenUnlocked",Y),window.removeEventListener("saleCreated",xe),ct.disconnect()}},[]),a.useEffect(()=>{(i.length>0||x||re)&&q()},[i,x,re,H,t?.id]);const q=()=>{localStorage.setItem(`cart_${t?.id}`,JSON.stringify(i)),localStorage.setItem(`paymentMethod_${t?.id}`,x),localStorage.setItem(`taxType_${t?.id}`,re),H&&localStorage.setItem(`selectedDiscount_${t?.id}`,JSON.stringify(H))},X=async()=>{try{const c=await fetch(`${ue}/clock-in`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({})});if(c.ok){const L=await c.json();fe(L),J(!0);const M=new Date;ve(M),localStorage.setItem(`clockStatus_${t?.id}`,"clocked_in"),localStorage.setItem(`clockInTime_${t?.id}`,M.toISOString()),alert("â° Clocked in successfully! Your shift has started.")}else{const L=await c.json();alert(`âŒ Clock-in failed: ${L.error}`)}}catch(c){console.error("Clock in failed:",c),alert("Failed to clock in. Please check your connection.")}},oe=async()=>{try{const c=await fetch(`${ue}/clock-out`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({})});if(c.ok){const L=await c.json();fe(L),J(!1),ve(null),localStorage.removeItem(`clockStatus_${t?.id}`),localStorage.removeItem(`clockInTime_${t?.id}`);const M=Math.floor(L.duration/60),_=L.duration%60;alert(`â° Clocked out successfully! Total time: ${M}h ${_}m`)}else{const L=await c.json();alert(`âŒ Clock-out failed: ${L.error}`)}}catch(c){console.error("Clock out failed:",c),alert("Failed to clock out. Please check your connection.")}},ae=async()=>{try{const c=await fetch(`${ue}/time-entries/today`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(c.ok){const M=(await c.json()).find(_=>_.cashierId===t?.id&&_.status==="clocked_in");M&&(fe(M),J(!0),ve(new Date(M.clockInTime)))}}catch(c){console.warn("Failed to check clock status:",c)}},Q=async()=>{try{const[c,L,M,_,le]=await Promise.all([je.getAll(),He.getAll(),it.getAll(),zt.get(),ot.getAll()]);u(c.filter(Y=>Y.visibleToCashier!==!1&&!Y.expenseOnly)),v({sales:L,expenses:M,stats:_}),o(le);try{const Y=await fetch(`${ue}/discounts`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(xe=>xe.json());ie(Y||[])}catch(Y){console.warn("Failed to load discounts:",Y)}}catch(c){console.error("Failed to load data:",c)}},me=(c,L=!0)=>{const M=c.target.files[0];if(M){const _=new FileReader;_.onload=le=>{const Y=le.target.result;G(Y),L&&$({...F,image:Y})},_.readAsDataURL(M)}},ge=c=>n.filter(M=>M.productId===c&&M.quantity>0).reduce((M,_)=>M+_.quantity,0),m=(c,L)=>!L||!c?c:["kg","g","gram","grams","kilogram","kilograms"].includes(L.toLowerCase())?c>=1?`${c.toFixed(2)}`:`${c.toFixed(3)}`.replace(/\.?0+$/,""):Math.round(c).toString(),A=c=>c.unit&&["kg","g","gram","grams","kilogram","kilograms"].includes(c.unit.toLowerCase()),U=c=>{const L=ge(c.id);if(L<=0){alert("Product is out of stock!");return}const M=i.find(le=>le.id===c.id),_=M?M.quantity:0;if(A(c)){const le=prompt(`Enter quantity to add (${c.unit}):

Available: ${m(L,c.unit)} ${c.unit}
Current in cart: ${m(_,c.unit)} ${c.unit}`,"0.1");if(le===null)return;const Y=parseFloat(le);if(isNaN(Y)||Y<=0){alert("Please enter a valid quantity");return}if(_+Y>L){alert(`Only ${m(L-_,c.unit)} ${c.unit} more available!`);return}r(M?i.map(xe=>xe.id===c.id?{...xe,quantity:xe.quantity+Y}:xe):[...i,{...c,quantity:Y}])}else{if(_>=L){alert(`Only ${L} units available in stock!`);return}r(M?i.map(le=>le.id===c.id?{...le,quantity:le.quantity+1}:le):[...i,{...c,quantity:1}])}},te=(c,L)=>{const M=h.find(Y=>Y.id===c),_=ge(c),le=i.find(Y=>Y.id===c);if(A(M)){const Y=prompt(`Update quantity (${M.unit}):

Available: ${m(_,M.unit)} ${M.unit}`,m(le?.quantity||0,M.unit));if(Y===null)return;const xe=parseFloat(Y);if(isNaN(xe)||xe<=0){alert("Please enter a valid quantity");return}if(xe>_){alert(`Only ${m(_,M.unit)} ${M.unit} available!`);return}r(i.map(ee=>ee.id===c?{...ee,quantity:xe}:ee).filter(ee=>ee.quantity>0))}else r(i.map(Y=>{if(Y.id===c){const xe=Y.quantity+L;return xe>_?(alert(`Only ${_} units available!`),Y):{...Y,quantity:Math.max(1,xe)}}return Y}).filter(Y=>Y.quantity>0))},Z=c=>{r(i.filter(L=>L.id!==c))},W=i.reduce((c,L)=>c+L.price*L.quantity,0),Pe=async()=>{if(i.length!==0)try{const c=H?H.type==="percentage"?W*H.value/100:H.value:0,L=W*.16,M=re==="inclusive"?W-c:W-c+L;await He.create({items:i.map(_=>({productId:_.id,quantity:_.quantity,price:_.price})),total:M,discount:c,tax:L,taxType:re,paymentMethod:x}),r([]),B(null),w("exclusive"),await Q(),alert("Sale completed successfully!")}catch(c){console.error("Checkout failed:",c),alert("Sale failed. Please try again.")}},ke=async c=>{c.preventDefault();try{await je.create({...F,price:parseFloat(F.price),cost:parseFloat(F.cost||0),quantity:0}),$({name:"",price:"",cost:"",category:"finished",image:""}),G(""),P(!1),await Q(),alert("Product added successfully!")}catch(L){console.error("Failed to add product:",L),alert("Failed to add product")}},Ke=async c=>{c.preventDefault();try{const L=Array.isArray(n)?n:[],_={id:L.length>0?Math.max(...L.map(le=>le.id||0))+1:1,productId:T.id,quantity:parseInt(D.quantity),expiryDate:D.expiryDate,batchNumber:D.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(D.cost||T.cost||0)};o(le=>[...le,_]),await ot.create({productId:T.id,quantity:parseInt(D.quantity),expiryDate:D.expiryDate,batchNumber:D.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(D.cost||T.cost||0)}),N({quantity:"",expiryDate:"",batchNumber:"",cost:""}),S(!1),k(null),await Q(),alert("Stock added successfully!")}catch(L){console.error("Failed to add stock:",L),alert("Failed to add stock")}},dt=async c=>{c.preventDefault();try{await it.create({...K,amount:parseFloat(K.amount)}),V({description:"",amount:"",category:""}),I(!1),await Q()}catch(L){console.error("Failed to add expense:",L),alert("Failed to add expense")}},Ve=async()=>{if(window.confirm("Are you sure you want to clear all sales and data? This action cannot be undone."))try{const c=localStorage.getItem("token");if(!c){alert("âŒ Not authenticated. Please login again.");return}const M=await fetch(`${ue}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!M.ok){const _=await M.json();throw new Error(_.message||"Failed to clear data")}localStorage.removeItem("sales"),localStorage.removeItem("expenses"),localStorage.removeItem("products"),localStorage.removeItem("cart"),v({sales:[],expenses:[],stats:{totalSales:0,totalExpenses:0,profit:0},products:[]}),r([]),setActiveTab("dashboard"),window.dispatchEvent(new Event("dataCleared")),window.dispatchEvent(new Event("storage")),alert("âœ… Data cleared successfully! Refreshing..."),setTimeout(()=>{window.location.href="/dashboard/cashier"},500)}catch(c){console.error("Failed to clear data:",c),alert("âŒ Failed to clear data: "+c.message)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("svg",{className:"w-12 h-12 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm6-10V7a3 3 0 00-3-3m3 3V7a3 3 0 013 3m-6-3a3 3 0 013-3m0 0V7m0 0a3 3 0 00-3 3m6-3V7m0 0a3 3 0 00-3 3"})})}),e.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"Screen Locked"}),e.jsx("p",{className:"text-xl text-gray-300 mb-2",children:"Your account has been locked by the administrator"}),e.jsx("p",{className:"text-gray-400 mb-8",children:"Please contact your administrator to unlock your account"}),e.jsx("button",{onClick:l,className:"px-6 py-3 bg-white text-red-600 font-bold rounded-lg hover:bg-gray-100 transition",children:"Logout"})]})}),e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Cashier Dashboard"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cashier Plan - KSH 900/month"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),z&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-green-600 font-semibold",children:"ðŸŸ¢ Clocked In"}),e.jsxs("button",{onClick:oe,className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-600 hover:bg-red-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(ps,{className:"w-4 h-4"}),"Clock Out"]})]}),!z&&e.jsxs("button",{onClick:X,className:"px-4 py-2 rounded-lg font-medium transition-all bg-green-600 hover:bg-green-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(Mt,{className:"w-4 h-4"}),"Clock In"]}),e.jsxs("button",{onClick:()=>{q(),l()},className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-100 hover:bg-red-200 text-red-600 border border-red-300 flex items-center gap-2",children:[e.jsx(jt,{className:"w-4 h-4"}),"Logout"]}),e.jsxs("button",{onClick:Ve,className:"px-4 py-2 rounded-lg font-medium transition-all bg-orange-100 hover:bg-orange-200 text-orange-600 border border-orange-300 flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),"Clear"]}),z&&se&&e.jsx("div",{className:"ml-auto text-right text-xs",children:e.jsxs("p",{className:"text-green-600 font-semibold flex items-center gap-1",children:[e.jsx(qe,{className:"w-4 h-4"}),"Clocked In: ",se.toLocaleTimeString()]})})]})]})}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>f("pos"),className:`px-6 py-2 rounded-lg font-medium transition-all ${g==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Xe,{className:"w-4 h-4 inline mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>f("monitor"),className:`px-6 py-2 rounded-lg font-medium transition-all ${g==="monitor"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(pt,{className:"w-4 h-4 inline mr-2"}),"Monitor"]}),e.jsxs("button",{onClick:()=>f("products"),className:`px-6 py-2 rounded-lg font-medium transition-all ${g==="products"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Fe,{className:"w-4 h-4 inline mr-2"}),"Products"]}),e.jsxs("button",{onClick:()=>f("expenses"),className:`px-6 py-2 rounded-lg font-medium transition-all ${g==="expenses"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(st,{className:"w-4 h-4 inline mr-2"}),"Expenses"]})]}),g==="pos"&&e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(gt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:b,onChange:c=>j(c.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:h.filter(c=>c.name?.toLowerCase().includes(b.toLowerCase())).map(c=>{const L=ge(c.id),M=L<10,_=L<=0;return e.jsxs("button",{onClick:()=>U(c),disabled:_,className:`card text-left hover:shadow-xl transition-all transform hover:scale-105 relative ${_?"opacity-50 cursor-not-allowed bg-gray-100":"bg-gradient-to-br from-white to-gray-50"}`,children:[c.image&&e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:c.image,alt:c.name,className:"w-full h-full object-cover"})}),M&&!_&&e.jsx("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white p-1 rounded-full",children:e.jsx(Oe,{className:"w-4 h-4"})}),_&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"OUT"}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-900",children:c.name}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["KSH ",c.price?.toLocaleString()]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:`text-xs font-medium ${_?"text-red-600":M?"text-yellow-600":"text-gray-500"}`,children:["Stock: ",L]}),M&&!_&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium",children:"Low Stock"})]})]},c.id)})})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-gray-200 p-6 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(Xe,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[i.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:i.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(Xe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:i.map(c=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:c.name}),e.jsx("button",{onClick:()=>Z(c.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(De,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>te(c.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(gs,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-12 text-center font-semibold text-sm",children:m(c.quantity,c.unit)}),e.jsx("span",{className:"text-xs text-gray-600 w-8",children:c.unit}),e.jsx("button",{onClick:()=>te(c.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(Ne,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(c.price*c.quantity).toLocaleString()]})]})]},c.id))})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"text-gray-700",children:["KSH ",W.toLocaleString()]})]}),H&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-KSH ",(H.type==="percentage"?W*H.value/100:H.value).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-orange-600",children:[e.jsxs("span",{children:["Tax (",re==="exclusive"?"Added":"Included","):"]}),e.jsxs("span",{children:[re==="exclusive"?"+":"","KSH ",((W-(H?H.type==="percentage"?W*H.value/100:H.value:0))*.16).toLocaleString()]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Final Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(re==="exclusive"?W-(H?H.type==="percentage"?W*H.value/100:H.value:0)+(W-(H?H.type==="percentage"?W*H.value/100:H.value:0))*.16:W-(H?H.type==="percentage"?W*H.value/100:H.value:0)).toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Discount (Optional)"}),e.jsxs("select",{value:H?.id||"",onChange:c=>{c.target.value?B(he.find(L=>L.id===parseInt(c.target.value))):B(null)},className:"input",children:[e.jsx("option",{value:"",children:"No Discount"}),he.filter(c=>c.active).map(c=>e.jsxs("option",{value:c.id,children:[c.name," - ",c.type==="percentage"?`${c.value}%`:`KSH ${c.value}`]},c.id))]}),H&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Discount: KSH ",(H.type==="percentage"?W*H.value/100:H.value).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tax Type"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"exclusive",checked:re==="exclusive",onChange:c=>w(c.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Exclusive (16% added)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"inclusive",checked:re==="inclusive",onChange:c=>w(c.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Inclusive"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:x,onChange:c=>d(c.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:Pe,disabled:i.length===0,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg",children:"Complete Sale"})]})]})]}),g==="monitor"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",s.stats.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx($e,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",s.stats.totalExpenses?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(st,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",s.stats.profit?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx($e,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Sales"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"})]})}),e.jsx("tbody",{children:s.sales.slice(-15).reverse().map((c,L)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(c.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[c.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:c.paymentMethod||"cash"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",c.total?.toLocaleString()]})]},L))})]})})]})]}),g==="products"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Manage Products & Stock"}),e.jsxs("button",{onClick:()=>P(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Add Product"]})]}),y&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl border-2 border-green-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Product"}),e.jsxs("form",{onSubmit:ke,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:F.name,onChange:c=>$({...F,name:c.target.value}),required:!0}),e.jsxs("select",{className:"input",value:F.category,onChange:c=>$({...F,category:c.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsx("input",{type:"number",placeholder:"Selling Price",className:"input",value:F.price,onChange:c=>$({...F,price:c.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Cost Price (Optional)",className:"input",value:F.cost,onChange:c=>$({...F,cost:c.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:c=>me(c,!0),className:"input"}),e.jsx($t,{className:"w-5 h-5 text-gray-400"})]}),de&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:de,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{P(!1),G(""),$({name:"",price:"",cost:"",category:"finished",image:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),E&&T&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"font-semibold mb-4 text-lg",children:["Add Stock for ",T.name]}),e.jsxs("form",{onSubmit:Ke,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:D.quantity,onChange:c=>N({...D,quantity:c.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:D.expiryDate,onChange:c=>N({...D,expiryDate:c.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:D.batchNumber,onChange:c=>N({...D,batchNumber:c.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per Unit",className:"input",value:D.cost,onChange:c=>N({...D,cost:c.target.value})}),e.jsxs("div",{className:"flex gap-2 md:col-span-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{S(!1),k(null),N({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:h.map(c=>{const L=ge(c.id),M=n.filter(le=>le.productId===c.id&&le.quantity>0),_=L<10;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[c.image&&e.jsx("img",{src:c.image,alt:c.name,className:"w-10 h-10 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:c.name}),e.jsx("div",{className:"text-xs text-gray-500",children:c.category})]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",c.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium ${L===0?"text-red-600":_?"text-yellow-600":"text-gray-900"}`,children:L}),_&&L>0&&e.jsx(Oe,{className:"w-4 h-4 text-yellow-500"}),L===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"text-gray-600",children:[M.length," active"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{k(c),S(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-green-50 rounded-lg text-green-600 transition-colors",title:"Edit Product",children:e.jsx(Ue,{className:"w-4 h-4"})})]})})]},c.id)})})]})})]})}),g==="expenses"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Track Expenses"}),e.jsxs("button",{onClick:()=>I(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Add Expense"]})]}),C&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border-2 border-red-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Expense"}),e.jsxs("form",{onSubmit:dt,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:K.description,onChange:c=>V({...K,description:c.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Amount",className:"input",value:K.amount,onChange:c=>V({...K,amount:c.target.value}),required:!0}),e.jsx("input",{type:"text",placeholder:"Category",className:"input",value:K.category,onChange:c=>V({...K,category:c.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>I(!1),className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:s.expenses.slice().reverse().map((c,L)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(c.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:c.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:c.category||"General"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",c.amount?.toLocaleString()]})]},L))})]})})]})})]})}function Xs(){const[t,l]=a.useState(null),[h,u]=a.useState([]),[n,o]=a.useState(!0),[i,r]=a.useState(""),[x,d]=a.useState("overview");a.useEffect(()=>{g();const f=setInterval(g,600*1e3);return()=>clearInterval(f)},[]);const g=async()=>{try{r(""),o(!0);const[f,s]=await Promise.all([At.getOverview(),At.getPlans()]);l(f),u(s)}catch(f){console.error("Failed to load subscription data:",f),r("Failed to load subscription data")}finally{o(!1)}};return n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Subscription Management"}),e.jsx("button",{onClick:g,className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Refresh"})]}),i&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:i}),t&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Subscribers"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900 mt-1",children:t.totalSubscribers})]}),e.jsx(Ie,{className:"w-12 h-12 text-blue-300"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Active Subscriptions"}),e.jsx("p",{className:"text-3xl font-bold text-green-900 mt-1",children:t.totalActiveSubscriptions})]}),e.jsx(Ae,{className:"w-12 h-12 text-green-300"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Total Revenue"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-900 mt-1",children:["KSH ",t.totalRevenue?.toLocaleString()]})]}),e.jsx($e,{className:"w-12 h-12 text-purple-300"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-600 font-medium",children:"Available Plans"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900 mt-1",children:h.length})]}),e.jsx(Le,{className:"w-12 h-12 text-orange-300"})]})})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>d("plans"),className:`px-4 py-2 font-medium border-b-2 transition ${x==="plans"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Plans"}),e.jsx("button",{onClick:()=>d("users"),className:`px-4 py-2 font-medium border-b-2 transition ${x==="users"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Subscriptions"})]})}),x==="plans"&&e.jsx("div",{className:"space-y-4",children:t?.plans?.map(f=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:f.planName}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[f.durationDays," days â€¢ KSH ",f.price?.toLocaleString(),"/cycle"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:f.activeSubscribers}),e.jsx("p",{className:"text-xs text-gray-600",children:"Active"})]})]})}),e.jsxs("div",{className:"p-4 grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded p-3",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:f.activeSubscribers})]}),e.jsxs("div",{className:"bg-red-50 rounded p-3",children:[e.jsx("p",{className:"text-xs text-red-600 font-medium",children:"Expired"}),e.jsx("p",{className:"text-2xl font-bold text-red-900 mt-1",children:f.expiredSubscribers})]}),e.jsxs("div",{className:"bg-green-50 rounded p-3",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium",children:"Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-green-900 mt-1",children:["KSH ",f.totalRevenue?.toLocaleString()]})]}),e.jsxs("div",{className:"bg-purple-50 rounded p-3",children:[e.jsx("p",{className:"text-xs text-purple-600 font-medium",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900 mt-1",children:f.activeSubscribers+f.expiredSubscribers})]})]}),f.features&&f.features.length>0&&e.jsxs("div",{className:"p-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Features:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:f.features.map((s,v)=>e.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-600",children:[e.jsx(Ae,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:s})]},v))})]})]},f.planId))}),x==="users"&&e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"User"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Days Used"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Days Remaining"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"End Date"})]})}),e.jsx("tbody",{children:t?.plans?.flatMap(f=>f.activeSubscriptions?.map(s=>e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.userName}),e.jsx("p",{className:"text-xs text-gray-500",children:s.email})]})}),e.jsx("td",{className:"px-4 py-3",children:f.planName}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[s.daysUsed," days"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:s.daysRemaining<=1?"text-red-600 font-medium":"",children:[s.daysRemaining," days"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${s.daysRemaining<=1?"bg-red-100 text-red-700":s.daysRemaining<=7?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700"}`,children:[s.daysRemaining<=1?e.jsx(tt,{className:"w-3 h-3"}):e.jsx(Ae,{className:"w-3 h-3"}),s.status]})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:new Date(s.endDate).toLocaleDateString()})]},`${f.planId}-${s.userId}`)))})]})})})]})}function Zs(){const[t,l]=a.useState([]),[h,u]=a.useState([]),[n,o]=a.useState("all"),[i,r]=a.useState(""),[x,d]=a.useState(!1),[g,f]=a.useState(!1),[s,v]=a.useState("users"),[b,j]=a.useState([]),[y,P]=a.useState({subject:"",message:""}),[E,S]=a.useState(!0),[T,k]=a.useState(null),[F,$]=a.useState(!0),[D,N]=a.useState(null),[C,I]=a.useState([]),K=Me(),[V,de]=a.useState({totalUsers:0,activeUsers:0,lockedUsers:0,totalRevenue:0,pendingPayments:0,overduePayments:0,activeDays:0,downDays:0}),[G,he]=a.useState([]);a.useEffect(()=>{const p=localStorage.getItem("mainAdminToken"),O=localStorage.getItem("mainAdminUser");if(!p||!O){K("/main-admin/login");return}ie().finally(()=>S(!1));const q=JSON.parse(localStorage.getItem("authActivities")||"[]");he(q.slice(0,10));const X=JSON.parse(localStorage.getItem("adminReminders")||"[]");I(X.filter(Q=>Q.status==="pending"));const oe=Q=>{const me=Q.detail;I(ge=>[me,...ge])};window.addEventListener("subscriptionReminderCreated",oe);const ae=setInterval(()=>{const Q=JSON.parse(localStorage.getItem("authActivities")||"[]");he(Q.slice(0,10));const me=JSON.parse(localStorage.getItem("adminReminders")||"[]");I(me.filter(ge=>ge.status==="pending"))},5e3);return()=>{clearInterval(ae),window.removeEventListener("subscriptionReminderCreated",oe)}},[K]);const ie=async()=>{try{k(null);let p=[],O=[],q=!0;try{p=await Be.getUsers(),O=await Be.getPayments()}catch(X){console.warn("MainAdmin API not available, falling back to regular users API:",X.message);try{p=await Ee.getAll()}catch(oe){console.warn("Users API also failed:",oe.message),q=!1}q||(O=[],$(!1))}p.length===0&&!q&&(p=B(),O=re(p)),l(p),u(O),$(q),w(p,O)}catch(p){console.error("Failed to load data:",p),k("Failed to load dashboard data");const O=B();l(O),u(re(O)),$(!1),w(O,[])}},H=()=>{localStorage.removeItem("mainAdminToken"),localStorage.removeItem("mainAdminUser"),K("/main-admin/login")},B=()=>{const p=localStorage.getItem("user"),O=[];if(p){const X=JSON.parse(p);O.push({...X,id:X.id||"real-user"})}return[{name:"John Doe",email:"john@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Jane Smith",email:"jane@example.com",plan:"basic",price:900,active:!0,locked:!1,role:"cashier"},{name:"Bob Wilson",email:"bob@example.com",plan:"ultra",price:1600,active:!1,locked:!1,role:"admin"},{name:"Alice Brown",email:"alice@example.com",plan:"basic",price:900,active:!0,locked:!0,role:"cashier"},{name:"Mike Johnson",email:"mike@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Sarah Davis",email:"sarah@example.com",plan:"basic",price:900,active:!1,locked:!1,role:"cashier"}].forEach((X,oe)=>{O.push({id:`demo-${oe+1}`,...X,createdAt:new Date(Date.now()-oe*864e5).toISOString(),lastLogin:new Date(Date.now()-Math.random()*864e5).toISOString()})}),O},re=p=>p.flatMap(O=>[{id:`payment-${O.id}-1`,userId:O.id,amount:O.plan==="ultra"?1600:900,status:Math.random()>.3?"paid":"pending",createdAt:new Date(Date.now()-30*864e5).toISOString(),dueDate:new Date(Date.now()+5*864e5).toISOString()},{id:`payment-${O.id}-2`,userId:O.id,amount:O.plan==="ultra"?1600:900,status:Math.random()>.7?"paid":Math.random()>.5?"pending":"overdue",createdAt:new Date(Date.now()-60*864e5).toISOString(),dueDate:new Date(Date.now()-5*864e5).toISOString()}]),w=(p,O)=>{const q=p.length,X=p.filter(U=>U.active).length,oe=p.filter(U=>U.locked).length,ae=O.filter(U=>U.status==="paid").reduce((U,te)=>U+te.amount,0),Q=O.filter(U=>U.status==="pending").length,me=O.filter(U=>U.status==="overdue").length,ge=localStorage.getItem("appCreatedDate");let m=0,A=0;if(ge){const U=new Date(ge),Z=Math.floor((new Date-U)/(1e3*60*60*24)),W=parseFloat(localStorage.getItem("uptimePercentage")||"99.5");m=Math.floor(Z*W/100),A=Z-m}else localStorage.setItem("appCreatedDate",new Date().toISOString()),m=0,A=0;de({totalUsers:q,activeUsers:X,lockedUsers:oe,totalRevenue:ae,pendingPayments:Q,overduePayments:me,activeDays:m,downDays:A})},z=async(p,O)=>{try{N(p);const q=!O;try{if(await Be.lockUser(p,q),q){const Q=t.find(me=>me.id===p);if(localStorage.setItem(`lockNotification_${p}`,JSON.stringify({type:"account_locked",message:"Your account has been locked by the system administrator.",lockedAt:new Date().toISOString(),reason:"Admin account lock"})),Q){const me={id:Date.now(),type:"subscription_renewal",title:"Subscription Renewal Notice",description:`Account for ${Q.name} (${Q.email}) has been locked. Plan: ${Q.plan?.toUpperCase()||"UNKNOWN"} - ${Q.price?"KSH "+Q.price:"Free"}. Please contact user to renew subscription.`,priority:"high",targetUser:Q.name,targetEmail:Q.email,dueDate:new Date(Date.now()+2592e5).toISOString(),createdAt:new Date().toISOString(),status:"pending"},ge=JSON.parse(localStorage.getItem("adminReminders")||"[]");ge.push(me),localStorage.setItem("adminReminders",JSON.stringify(ge)),window.dispatchEvent(new CustomEvent("subscriptionReminderCreated",{detail:me}))}window.dispatchEvent(new CustomEvent("accountLocked",{detail:{userId:p}}))}const X=t.map(Q=>Q.id===p?{...Q,locked:q,active:!q}:Q);l(X),w(X,h);const oe=t.find(Q=>Q.id===p),ae=q?"locked":"unlocked";alert(`âœ… ${oe?.name||`User ${p}`} has been ${ae} successfully!${q?" Subscription renewal reminder created and user will be logged out immediately.":""}`)}catch(X){console.error("API lock failed:",X);const oe=t.map(me=>me.id===p?{...me,locked:q,active:!q}:me);l(oe),w(oe,h);const ae=t.find(me=>me.id===p),Q=q?"locked":"unlocked";alert(`âš ï¸ Backend not available. ${ae?.name||`User ${p}`} ${Q} locally. Changes will sync when backend is available.`)}}catch(q){console.error("Failed to toggle lock:",q),alert(`âŒ Failed to update user status: ${q.message}`)}finally{N(null)}},J=async(p,O,q)=>{try{S(!0);try{await Be.sendEmail({userIds:p,subject:O,message:q}),alert("Emails sent successfully!"),d(!1),j([]),P({subject:"",message:""});return}catch(ae){console.warn("Backend email operation failed, simulating email send:",ae.message)}const X=t.filter(ae=>p.includes(ae.id)),oe=JSON.parse(localStorage.getItem("emailLogs")||"[]");oe.push({timestamp:new Date().toISOString(),recipients:X.map(ae=>({id:ae.id,name:ae.name,email:ae.email})),subject:O,message:q,status:"simulated"}),localStorage.setItem("emailLogs",JSON.stringify(oe)),alert(`âœ… Email simulation successful!

ðŸ“§ Sent to ${X.length} user(s):
${X.map(ae=>`${ae.name} (${ae.email})`).join(`
`)}

${F?"":`ðŸ“Œ Backend not deployed - this was a simulation.
`}ðŸ’¡ Deploy backend to send real emails.`),d(!1),j([]),P({subject:"",message:""})}catch(X){console.error("Failed to send email:",X),alert("Failed to process email request.")}finally{S(!1)}},ce=async(p,O)=>{try{N(p);const q=await Be.lockUserScreen(p);(q.success||q.message)&&(alert(`âœ… Screen locked for ${O}. They will see the PIN unlock screen immediately.`),setTimeout(()=>{ie()},1e3))}catch(q){console.error("Failed to lock screen:",q),alert(`âŒ Failed to lock screen: ${q.message}`)}finally{N(null)}},fe=async p=>{const O=t.find(q=>q.id===p);O&&await J([p],"Payment Reminder - Subscription",`Dear ${O.name},

This is a friendly reminder about your pending subscription payment for ${O.plan?.toUpperCase()} plan (KSH ${O.price}).

Please complete your payment to continue enjoying our services.

Thank you!`)},se=t.filter(p=>{const O=p.name?.toLowerCase().includes(i.toLowerCase())||p.email?.toLowerCase().includes(i.toLowerCase());if(n==="all")return O;if(n==="active")return O&&p.active&&!p.locked;if(n==="locked")return O&&p.locked;if(n==="trial")return O&&(!p.active||!p.plan);if(n==="pending-payment"){const q=h.filter(X=>X.userId===p.id&&X.status==="pending");return O&&q.length>0}if(n==="overdue"){const q=h.filter(X=>X.userId===p.id&&X.status==="overdue");return O&&q.length>0}return O}),ve=p=>{const O=h.filter(ae=>ae.userId===p),q=O.filter(ae=>ae.status==="pending").length,X=O.filter(ae=>ae.status==="overdue").length,oe=O.filter(ae=>ae.status==="paid").length;return{pending:q,overdue:X,paid:oe,total:O.length}};return E&&t.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-white mx-auto mb-4"}),e.jsx("p",{className:"text-white text-xl",children:"Loading Main Admin Dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900",children:[!F&&e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm md:text-base font-semibold",children:["âš ï¸ Demo Mode: Backend not available. Actions are simulated locally.",e.jsx("a",{href:"/BACKEND_NOT_DEPLOYED.md",className:"underline ml-2",children:"Deploy Backend â†’"})]})}),T&&e.jsx("div",{className:"bg-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm font-semibold",children:["âš ï¸ ",T]})}),C.length>0&&e.jsx("div",{className:"bg-gradient-to-r from-orange-500/20 to-red-500/20 border-l-4 border-orange-500 px-6 py-4 mx-6 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(Oe,{className:"w-5 h-5 text-orange-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-white font-bold mb-2",children:[C.length," Subscription Renewal Reminder",C.length!==1?"s":""]}),e.jsx("div",{className:"space-y-2",children:C.slice(0,3).map(p=>e.jsxs("p",{className:"text-orange-100 text-sm",children:["â€¢ ",e.jsx("span",{className:"font-semibold",children:p.targetUser})," (",p.targetEmail,") - ",p.description.split("-")[1]?.trim()]},p.id))}),C.length>3&&e.jsxs("p",{className:"text-orange-100 text-sm mt-2",children:["... and ",C.length-3," more pending reminder",C.length-3!==1?"s":""]})]})]})}),T&&e.jsx("div",{className:"bg-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm font-semibold",children:["âš ï¸ ",T]})}),e.jsx("header",{className:"bg-black/30 backdrop-blur-lg border-b border-white/10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Main Admin Dashboard"}),e.jsx("p",{className:"text-gray-300",children:"Monitor all users, payments, and system activity"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 bg-green-500/20 hover:bg-green-500/30 text-green-300 px-4 py-2 rounded-lg transition-colors",children:[e.jsx(Qe,{className:"w-4 h-4"}),"View Analytics"]}),e.jsxs("button",{onClick:H,className:"flex items-center gap-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 px-4 py-2 rounded-lg transition-colors",children:[e.jsx(jt,{className:"w-4 h-4"}),"Logout"]})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ie,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:V.totalUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ae,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:V.activeUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Active Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ye,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:V.lockedUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Locked Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx($e,{className:"w-8 h-8 text-yellow-400"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:["KSH ",V.totalRevenue.toLocaleString()]})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Oe,{className:"w-8 h-8 text-orange-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:V.pendingPayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Pending Payments"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(nt,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:V.overduePayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Overdue Payments"})]})]}),e.jsx("div",{className:"border-b border-white/10",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsx("button",{onClick:()=>v("users"),className:`px-4 py-3 font-medium border-b-2 transition ${s==="users"?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Users & Management"]})}),e.jsx("button",{onClick:()=>v("subscriptions"),className:`px-4 py-3 font-medium border-b-2 transition ${s==="subscriptions"?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4"}),"Subscriptions"]})})]})}),s==="subscriptions"&&e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:e.jsx(Xs,{})}),s==="users"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 flex-1 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-80",children:[e.jsx(gt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",value:i,onChange:p=>r(p.target.value)})]}),e.jsxs("select",{value:n,onChange:p=>o(p.target.value),className:"px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"locked",children:"Locked"}),e.jsx("option",{value:"trial",children:"Free Trial"}),e.jsx("option",{value:"pending-payment",children:"Pending Payment"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsxs("button",{onClick:()=>d(!0),disabled:b.length===0||E,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-3 rounded-lg font-bold flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(et,{className:"w-5 h-5"}),"Send Email to Selected (",b.length,")"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"xl:col-span-2 bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"All Users"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left",children:e.jsx("input",{type:"checkbox",checked:b.length===se.length&&se.length>0,onChange:p=>{p.target.checked?j(se.map(O=>O.id)):j([])},className:"w-5 h-5 rounded"})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Trial Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Signup Details"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Actions"})]})}),e.jsxs("tbody",{children:[se.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"px-4 py-12 text-center",children:[e.jsx(Ie,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:i||n!=="all"?"Try adjusting your filters":"Users will appear here once they sign up"})]})}),se.map(p=>(ve(p.id),e.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:b.includes(p.id),onChange:O=>{O.target.checked?j([...b,p.id]):j(b.filter(q=>q!==p.id))},className:"w-5 h-5 rounded"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[p.profilePicture?e.jsx("img",{src:p.profilePicture,alt:p.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:p.name?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:p.name}),e.jsx("p",{className:"text-sm text-gray-400",children:p.email})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${p.plan==="ultra"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"}`,children:[p.plan?.toUpperCase()||"FREE"," ",p.price?`- KSH ${p.price}`:""]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"flex flex-col gap-1",children:p.plan==="trial"||!p.plan||p.isFreeTrial?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"px-2 py-1 rounded text-xs font-bold bg-yellow-500/20 text-yellow-300",children:"FREE TRIAL"}),p.trialDaysLeft!==void 0&&e.jsxs("span",{className:"text-xs text-gray-400",children:[p.trialDaysLeft," days left"]}),p.trialExpiry&&e.jsxs("span",{className:"text-xs text-gray-400",children:["Expires: ",new Date(p.trialExpiry).toLocaleDateString()]})]}):e.jsx("span",{className:"px-2 py-1 rounded text-xs font-bold bg-green-500/20 text-green-300",children:"PAID PLAN"})})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{className:"font-semibold text-gray-300",children:["Joined: ",new Date(p.createdAt).toLocaleDateString()]}),p.signupDetails?.company&&e.jsxs("div",{className:"text-gray-400",children:[e.jsx("span",{className:"text-gray-500",children:"Co:"})," ",p.signupDetails.company]}),p.signupDetails?.industry&&e.jsxs("div",{className:"text-gray-400",children:[e.jsx("span",{className:"text-gray-500",children:"Industry:"})," ",p.signupDetails.industry]}),p.signupDetails?.country&&e.jsxs("div",{className:"text-gray-400",children:[e.jsx("span",{className:"text-gray-500",children:"Country:"})," ",p.signupDetails.country]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"flex items-center gap-2",children:p.locked?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-300 flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),"Locked"]}):p.active?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-300 flex items-center gap-1",children:[e.jsx(Ae,{className:"w-3 h-3"}),"Active"]}):e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-500/20 text-gray-300",children:"Inactive"})})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>z(p.id,p.locked),disabled:D===p.id,className:`p-2 rounded-lg transition ${p.locked?"bg-green-500/20 hover:bg-green-500/30 text-green-300":"bg-red-500/20 hover:bg-red-500/30 text-red-300"} ${D===p.id?"opacity-50 cursor-not-allowed":""}`,title:p.locked?"Unlock User":"Lock User",children:D===p.id?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):p.locked?e.jsx(fs,{className:"w-4 h-4"}):e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ce(p.id,p.name),disabled:D===p.id,className:`p-2 rounded-lg bg-orange-500/20 hover:bg-orange-500/30 text-orange-300 transition ${D===p.id?"opacity-50 cursor-not-allowed":""}`,title:"Lock Screen (Prevents user interaction until PIN is entered)",children:D===p.id?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm6-10V7a3 3 0 00-3-3m3 3V7a3 3 0 013 3m-6-3a3 3 0 013-3m0 0V7m0 0a3 3 0 00-3 3m6-3V7m0 0a3 3 0 00-3 3"})})}),e.jsx("button",{onClick:()=>fe(p.id),disabled:E,className:"p-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 transition",title:"Send Payment Reminder",children:e.jsx(Ut,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{p.role==="cashier"?window.open("/dashboard/cashier","_blank"):window.open("/admin","_blank")},className:"p-2 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 transition",title:"View User Dashboard",children:e.jsx(Qe,{className:"w-4 h-4"})})]})})]},p.id)))]})]})})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl border border-white/20",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5"}),"Recent Activity"]})}),e.jsx("div",{className:"p-4 space-y-3 max-h-96 overflow-y-auto",children:G.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"No recent activity"}):G.map(p=>e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${p.type==="login"?"bg-green-400":"bg-blue-400"}`}),e.jsx("span",{className:"text-white font-medium",children:p.user.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${p.type==="login"?"bg-green-500/20 text-green-300":"bg-blue-500/20 text-blue-300"}`,children:p.type})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:p.user.email}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:new Date(p.timestamp).toLocaleString()})]},p.id))})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-purple-900 rounded-2xl shadow-2xl max-w-2xl w-full border border-white/20",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(et,{}),"Send Email to ",b.length," User(s)"]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Subject"}),e.jsx("input",{type:"text",value:y.subject,onChange:p=>P({...y,subject:p.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email subject..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Message"}),e.jsx("textarea",{value:y.message,onChange:p=>P({...y,message:p.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 h-40",placeholder:"Email message..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>J(b,y.subject,y.message),disabled:E,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white py-3 rounded-lg font-bold transition disabled:opacity-50",children:E?"Sending...":"Send Email"}),e.jsx("button",{onClick:()=>d(!1),className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-lg font-bold transition",children:"Cancel"})]})]})]})})]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-purple-900 rounded-2xl shadow-2xl max-w-2xl w-full border border-white/20",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5"}),"Website Analytics & Uptime"]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-white/10 rounded-lg p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center",children:e.jsx(Ae,{className:"w-6 h-6 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Active Days"}),e.jsx("p",{className:"text-3xl font-bold text-white",children:V.activeDays})]})]})}),e.jsx("div",{className:"bg-white/10 rounded-lg p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-red-500/20 rounded-lg flex items-center justify-center",children:e.jsx(nt,{className:"w-6 h-6 text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Down Days"}),e.jsx("p",{className:"text-3xl font-bold text-white",children:V.downDays})]})]})})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-6 border border-white/20",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"System Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"Uptime Percentage"}),e.jsxs("span",{className:"text-2xl font-bold text-green-400",children:[parseFloat(localStorage.getItem("uptimePercentage")||"99.5").toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full",style:{width:`${parseFloat(localStorage.getItem("uptimePercentage")||"99.5")}%`}})})]})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-6 border border-white/20",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Key Metrics"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"Total Users"}),e.jsx("span",{className:"text-white font-semibold",children:V.totalUsers})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"Active Users"}),e.jsx("span",{className:"text-green-400 font-semibold",children:V.activeUsers})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"Total Revenue"}),e.jsxs("span",{className:"text-yellow-400 font-semibold",children:["KSH ",V.totalRevenue.toLocaleString()]})]})]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>f(!1),className:"flex-1 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white py-3 rounded-lg font-bold transition",children:"Close"})})]})]})})]})}function ea({userId:t=null}){const[l,h]=a.useState(null),[u,n]=a.useState(!1),[o,i]=a.useState(!0);if(a.useEffect(()=>{const f=async()=>{try{const s=await Te.getSubscriptionStatus?.();if(!s){i(!1);return}const{status:v,days_remaining:b,is_active:j,reminder_needed:y}=s;y&&b===1&&j?h({message:`âš ï¸ Your subscription expires ${b===1?"tomorrow":`in ${b} days`}. Renew now to avoid platform closure.`,status:v,daysRemaining:b,expiryDate:s.subscription_end}):v==="expired"&&!j?h({message:"âŒ Your subscription has expired. Please renew to continue using the platform.",status:"expired",daysRemaining:0,type:"error"}):v==="expiring"&&h({message:`âš ï¸ Your subscription expires in ${b} days. Renew now to avoid disruption.`,status:v,daysRemaining:b}),i(!1)}catch(s){console.warn("Failed to check subscription status:",s),i(!1)}};if(!u){f();const s=setInterval(f,300*1e3);return()=>clearInterval(s)}},[u]),a.useEffect(()=>{const f=s=>{console.log("Subscription renewed:",s.detail),n(!0),h(null)};return window.addEventListener("subscription_renewed",f),window.addEventListener("subscription_reminder_day29",f),()=>{window.removeEventListener("subscription_renewed",f),window.removeEventListener("subscription_reminder_day29",f)}},[]),!l||u||o)return null;const r=l.type==="error"||l.status==="expired",x=r?"bg-red-50 border-red-200":"bg-orange-50 border-orange-200",d=r?"text-red-800":"text-orange-800",g=r?"text-red-500":"text-orange-500";return e.jsx("div",{className:`fixed top-0 left-0 right-0 border-b ${x} shadow-lg z-40`,children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(Oe,{className:`w-5 h-5 flex-shrink-0 ${g}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm font-medium ${d}`,children:l.message}),l.expiryDate&&e.jsxs("p",{className:`text-xs ${d} opacity-75 mt-1`,children:["Expires on: ",new Date(l.expiryDate).toLocaleDateString()]})]})]}),e.jsx("button",{onClick:()=>{r?n(!0):window.location.href="/plans"},className:`px-3 py-1 rounded text-sm font-medium whitespace-nowrap flex-shrink-0 ${r?"bg-red-200 text-red-900 hover:bg-red-300":"bg-orange-200 text-orange-900 hover:bg-orange-300"} transition-colors`,children:r?"Dismiss":"Renew Now"}),e.jsx("button",{onClick:()=>n(!0),className:`p-1 hover:opacity-75 transition-opacity ${d}`,title:"Dismiss",children:e.jsx(Re,{className:"w-5 h-5"})})]})})}function ta(){const[t,l]=a.useState([]),[h,u]=a.useState(!1),[n,o]=a.useState(null),[i,r]=a.useState(0),x=3;if(a.useEffect(()=>{let s=null,v=null;const b=()=>{try{if(i>=x){console.warn("âš ï¸ Max reconnection attempts reached - giving up");return}s=new WebSocket(`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.host}/api/live`),s.onopen=()=>{console.log("âœ… Real-time stock listener connected"),r(0)},s.onmessage=j=>{try{const y=JSON.parse(j.data);if(y.type==="STOCK_UPDATED"){console.log("ðŸ“¦ Stock updated:",y.deductions),l(y.deductions||[]),u(!0),n&&clearTimeout(n);const P=setTimeout(()=>{u(!1)},8e3);o(P)}}catch(y){console.error("Error parsing WebSocket message:",y)}},s.onerror=j=>{console.error("WebSocket error:",j)},s.onclose=()=>{if(console.log("âš ï¸ Real-time stock listener disconnected"),i<x){const j=Math.min(1e3*Math.pow(2,i),3e4);console.log(`ðŸ”„ Reconnecting in ${j}ms... (attempt ${i+1})`),v=setTimeout(()=>{r(y=>y+1),b()},j)}}}catch(j){console.error("Failed to create WebSocket:",j)}};return b(),()=>{n&&clearTimeout(n),v&&clearTimeout(v),s&&s.readyState===WebSocket.OPEN&&s.close()}},[]),!h||t.length===0)return null;const d=t.products||[],g=t.expenses||[],f=d.length+g.length;return e.jsx("div",{className:"fixed bottom-4 right-4 max-w-sm z-40 animate-slideIn",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border-l-4 border-blue-500",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 p-3 border-b border-blue-200 flex items-start gap-3",children:[e.jsx(Fe,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-blue-900 text-sm",children:"Stock Updated"}),e.jsxs("p",{className:"text-xs text-blue-700 mt-0.5",children:[f," item",f!==1?"s":""," deducted atomically"]})]}),e.jsx("button",{onClick:()=>u(!1),className:"text-blue-700 hover:text-blue-900 text-xl flex-shrink-0 ml-1",children:"Ã—"})]}),e.jsxs("div",{className:"p-3 space-y-2 max-h-48 overflow-y-auto",children:[d.length>0&&e.jsxs("div",{className:"space-y-1.5",children:[d.slice(0,3).map((s,v)=>e.jsxs("div",{className:"text-xs bg-blue-50 rounded p-2 border border-blue-100",children:[e.jsx("p",{className:"font-medium text-gray-800",children:s.name}),e.jsxs("p",{className:"text-blue-600",children:["-",s.deducted," ",s.unit," (",s.before_qty," â†’ ",s.after_qty,")"]})]},v)),d.length>3&&e.jsxs("p",{className:"text-xs text-gray-600 italic p-2",children:["+",d.length-3," more product",d.length-3!==1?"s":""]})]}),g.length>0&&e.jsxs("div",{className:"space-y-1.5",children:[g.slice(0,2).map((s,v)=>e.jsxs("div",{className:"text-xs bg-amber-50 rounded p-2 border border-amber-200",children:[e.jsx("p",{className:"font-medium text-gray-800",children:s.name}),e.jsxs("p",{className:"text-amber-600",children:["-",s.deducted," ",s.unit," (expense)"]})]},v)),g.length>2&&e.jsxs("p",{className:"text-xs text-gray-600 italic p-2",children:["+",g.length-2," more expense",g.length-2!==1?"s":""]})]})]}),e.jsxs("div",{className:"bg-blue-50 border-t border-blue-200 p-2 flex items-center gap-2 text-xs",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-gray-700",children:"Inventory synchronized across dashboards"})]})]})})}function ut({children:t,adminOnly:l=!1,ultraOnly:h=!1,ownerOnly:u=!1}){const{user:n,loading:o}=Ce(),{isLocked:i,lock:r,unlock:x}=Ts(),[d,g]=a.useState(!1),f=Qt(6e4),s=f?.[0]||i||!1,v=a.useCallback(()=>{f?.[1]?.(),x()},[f,x]),[b,j]=a.useState({});if(a.useEffect(()=>{n&&!u&&((async()=>{try{const E=localStorage.getItem("token"),T=await fetch(`${ue}/settings`,{headers:{Authorization:`Bearer ${E}`}});if(T.ok){const k=await T.json();j(k)}}catch(E){console.error("Failed to load settings:",E)}})(),sessionStorage.getItem("reminderShown")||(g(!0),sessionStorage.setItem("reminderShown","true")))},[n,u]),a.useEffect(()=>{const P=E=>{console.log("ðŸ”’ Admin locked screen:",E.detail),r("admin")};return window.addEventListener("admin_locked_user_screen",P),()=>window.removeEventListener("admin_locked_user_screen",P)},[r]),o&&!u)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(u){const P=localStorage.getItem("ownerToken"),E=localStorage.getItem("ownerUser");if(!P||!E)return e.jsx(be,{to:"/main.admin"});try{if(JSON.parse(E).type!=="main_admin")return e.jsx(be,{to:"/main.admin"})}catch{return e.jsx(be,{to:"/main.admin"})}}else{if(!n)return e.jsx(be,{to:"/auth/login"});if(!n.active)return e.jsx(be,{to:"/plans"});if(l&&n.role!=="admin")return e.jsx(be,{to:"/dashboard"});if(h&&(n.role!=="admin"||n.plan!=="ultra"))return e.jsx(be,{to:"/dashboard"})}const y=u?"owner":"user";return e.jsxs(e.Fragment,{children:[e.jsx(ea,{}),e.jsx(ta,{}),s&&e.jsx(Yt,{onUnlock:v,userType:y}),d&&e.jsx(Gt,{onClose:()=>g(!1)}),t]})}function sa(){const{user:t}=Ce();return!t||!t.active?e.jsx(be,{to:"/plans"}):t.role==="admin"?e.jsx(be,{to:"/admin"}):e.jsx(be,{to:"/dashboard/cashier"})}function aa(){return e.jsx(Ds,{children:e.jsx(Is,{children:e.jsx(Es,{children:e.jsx(ts,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(Tt,{children:[e.jsx(ne,{path:"/",element:e.jsx(Gs,{})}),e.jsx(ne,{path:"/auth/login",element:e.jsx(It,{})}),e.jsx(ne,{path:"/auth/signup",element:e.jsx(It,{})}),e.jsx(ne,{path:"/plans",element:e.jsx(Ys,{})}),e.jsx(ne,{path:"/main.admin/*",element:e.jsx(Zs,{})}),e.jsx(ne,{path:"/dashboard",element:e.jsx(ut,{children:e.jsx(sa,{})})}),e.jsx(ne,{path:"/dashboard/cashier",element:e.jsx(ut,{children:e.jsx(Qs,{})})}),e.jsx(ne,{path:"/admin/*",element:e.jsx(ut,{adminOnly:!0,children:e.jsx(Ws,{})})}),e.jsx(ne,{path:"/login",element:e.jsx(be,{to:"/auth/login"})}),e.jsx(ne,{path:"/signup",element:e.jsx(be,{to:"/auth/signup"})}),e.jsx(ne,{path:"/subscription",element:e.jsx(be,{to:"/plans"})}),e.jsx(ne,{path:"/payment",element:e.jsx(be,{to:"/plans"})}),e.jsx(ne,{path:"/cashier",element:e.jsx(be,{to:"/dashboard/cashier"})})]})})})})})}vs.createRoot(document.getElementById("root")).render(e.jsx(ss.StrictMode,{children:e.jsx(aa,{})}));
