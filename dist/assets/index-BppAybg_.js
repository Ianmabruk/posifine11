import{a as _t,b as Ht,g as zt,r as a,u as Ne,c as xt,R as St,d as G,B as Kt,N as ae,e as Jt}from"./vendor-Ct1st1Nj.js";import{C as ze,D as je,T as Ee,P as Ue,S as kt,a as Ke,b as Ct,c as ce,d as Wt,e as Gt,f as Ae,g as Te,h as me,i as Pt,j as Vt,k as Yt,L as ie,U as nt,l as bt,m as ke,E as mt,M as ft,n as fe,X as $e,o as ye,p as _e,q as ht,r as we,s as jt,t as Je,B as ut,R as At,I as Qt,u as We,v as it,w as Se,x as ct,y as Tt,z as Zt,A as It,F as ot,G as Xt,H as es,J as Qe,K as ts,N as Me,O as Dt,Q as dt,Z as pt,V as gt,W as Et,Y as ss,_ as as,$ as rs,a0 as at,a1 as Lt,a2 as ls,a3 as ns,a4 as is}from"./icons-DVKsO3YW.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))f(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&f(r)}).observe(document,{childList:!0,subtree:!0});function g(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function f(n){if(n.ep)return;n.ep=!0;const l=g(n);fetch(n.href,l)}})();var rt={exports:{}},Ie={};var yt;function cs(){if(yt)return Ie;yt=1;var t=_t(),c=Symbol.for("react.element"),g=Symbol.for("react.fragment"),f=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function r(h,x,i){var p,j={},o=null,U=null;i!==void 0&&(o=""+i),x.key!==void 0&&(o=""+x.key),x.ref!==void 0&&(U=x.ref);for(p in x)f.call(x,p)&&!l.hasOwnProperty(p)&&(j[p]=x[p]);if(h&&h.defaultProps)for(p in x=h.defaultProps,x)j[p]===void 0&&(j[p]=x[p]);return{$$typeof:c,type:h,key:o,ref:U,props:j,_owner:n.current}}return Ie.Fragment=g,Ie.jsx=r,Ie.jsxs=r,Ie}var Nt;function os(){return Nt||(Nt=1,rt.exports=cs()),rt.exports}var e=os(),qe={},vt;function ds(){if(vt)return qe;vt=1;var t=Ht();return qe.createRoot=t.createRoot,qe.hydrateRoot=t.hydrateRoot,qe}var xs=ds();const ms=zt(xs),hs=()=>"https://posifine22.onrender.com/api",Y=hs(),Ut=()=>localStorage.getItem("token"),$t=async(t,c={},g=0,f=3)=>{const n=Ut(),l=t.startsWith("/")?t:`/${t}`,r={...c,headers:{"Content-Type":"application/json",...n&&!(l.startsWith("/auth")&&l!=="/auth/me")&&!l.includes("/main-admin/auth/login")&&{Authorization:`Bearer ${n}`},...c.headers}};try{const h=await fetch(`${Y}${l}`,r);if(h.status===401){localStorage.removeItem("token"),localStorage.removeItem("user");const i=window.location.pathname||"";if(!i.includes("/login")&&!i.includes("/signup")&&!i.includes("/auth")&&!i.includes("/main.admin"))try{window.location.href="/login"}catch{}const p=new Error("Unauthorized");throw p.status=401,p}if(h.status===500)throw new Error("Server error 500 - Backend unavailable");if(h.ok)return h.status===204?{success:!0}:await h.json();const x=await h.json().catch(()=>({error:"Network error"}));throw new Error(x.error||`HTTP ${h.status}: ${h.statusText}`)}catch(h){if(h.name==="TypeError"&&h.message.includes("fetch")){if(console.error(`API Fetch Error (attempt ${g+1}/${f+1}):`,h),console.error("Attempted URL:",`${Y}${l}`),g<f){const x=Math.min(1e3*Math.pow(2,g),1e4);return console.log(`Retrying in ${x}ms...`),await new Promise(i=>setTimeout(i,x)),$t(t,c,g+1,f)}throw new Error("Cannot connect to server. The server may be waking up. Please try again in a moment.")}throw h}},H=(t,c={})=>$t(t,c,0,3),Pe={login:t=>H("/auth/login",{method:"POST",body:JSON.stringify(t)}),pinLogin:t=>H("/auth/pin-login",{method:"POST",body:JSON.stringify(t)}),signup:t=>H("/auth/signup",{method:"POST",body:JSON.stringify(t)}),signupWithPayment:t=>H("/signup-with-payment",{method:"POST",body:JSON.stringify(t)}),me:()=>H("/auth/me")},ve={getAll:()=>H("/users"),create:t=>H("/users",{method:"POST",body:JSON.stringify(t)}),update:(t,c)=>H(`/users/${t}`,{method:"PUT",body:JSON.stringify(c)}),delete:t=>H(`/users/${t}`,{method:"DELETE"}),setPin:(t,c)=>H(`/users/${t}/set-pin`,{method:"POST",body:JSON.stringify({pin:c})}),lock:(t,c)=>H(`/users/${t}/lock`,{method:"POST",body:JSON.stringify({locked:c})})},oe={getAll:()=>H("/products"),create:t=>H("/products",{method:"POST",body:JSON.stringify(t)}),update:(t,c)=>H(`/products/${t}`,{method:"PUT",body:JSON.stringify(c)}),delete:t=>H(`/products/${t}`,{method:"DELETE"}),updateStock:(t,c)=>H(`/products/${t}/stock`,{method:"PUT",body:JSON.stringify(c)}),getMaxProducible:t=>H(`/products/${t}/max-producible`)},Oe={getAll:async()=>[{id:1,total:450,items:[{name:"Coffee",quantity:2}],createdAt:new Date().toISOString()}],create:async t=>({id:Date.now(),...t,createdAt:new Date().toISOString()})},Ge={getAll:async()=>[{id:1,description:"Office supplies",amount:150,createdAt:new Date().toISOString()}],create:async t=>({id:Date.now(),...t,createdAt:new Date().toISOString()})},Ot={get:async()=>({totalSales:1500,totalExpenses:300,profit:1200,productCount:5})},Be={getAll:()=>H("/discounts"),create:t=>H("/discounts",{method:"POST",body:JSON.stringify(t)}),update:(t,c)=>H(`/discounts/${t}`,{method:"PUT",body:JSON.stringify(c)}),delete:t=>H(`/discounts/${t}`,{method:"DELETE"})},lt={getAll:()=>H("/credit-requests"),create:t=>H("/credit-requests",{method:"POST",body:JSON.stringify(t)}),approve:t=>H(`/credit-requests/${t}/approve`,{method:"POST"}),reject:t=>H(`/credit-requests/${t}/reject`,{method:"POST"})},Le={get:async()=>({screenLockPassword:"2005",businessName:"My Business"}),update:async t=>t},Ve={getAll:t=>{const c=t?`/batches?productId=${t}`:"/batches";return H(c)},create:t=>H("/batches",{method:"POST",body:JSON.stringify(t)})},be={login:t=>H("/main-admin/auth/login",{method:"POST",body:JSON.stringify(t)}),getUsers:()=>{const t=localStorage.getItem("ownerToken");return H("/main-admin/users",{headers:{Authorization:`Bearer ${t}`}})},getStats:()=>{const t=localStorage.getItem("ownerToken");return H("/main-admin/stats",{headers:{Authorization:`Bearer ${t}`}})},getActivities:()=>{const t=localStorage.getItem("ownerToken");return H("/main-admin/activities",{headers:{Authorization:`Bearer ${t}`}})},getSalesAll:()=>{const t=localStorage.getItem("ownerToken");return H("/main-admin/sales-all",{headers:{Authorization:`Bearer ${t}`}})},getTimeEntriesAll:()=>{const t=localStorage.getItem("ownerToken");return H("/main-admin/time-entries-all",{headers:{Authorization:`Bearer ${t}`}})},lockUser:(t,c)=>{const g=localStorage.getItem("ownerToken");return H(`/main-admin/users/${t}/lock`,{method:"POST",headers:{Authorization:`Bearer ${g}`},body:JSON.stringify({locked:c})})},changePlan:(t,c)=>{const g=localStorage.getItem("ownerToken");return H(`/main-admin/users/${t}/plan`,{method:"POST",headers:{Authorization:`Bearer ${g}`},body:JSON.stringify({plan:c})})},clearData:t=>{const c=localStorage.getItem("ownerToken");return H("/main-admin/system/clear-data",{method:"POST",headers:{Authorization:`Bearer ${c}`},body:JSON.stringify({type:t})})}};let ne=null,He=new Set;function us(){const t=Y.replace(/\/api$/,"");return`${t.startsWith("https")?"wss":"ws"}://${t.replace(/^https?:\/\//,"")}/api/ws/products`}function ps(){if(ne&&(ne.readyState===WebSocket.OPEN||ne.readyState===WebSocket.CONNECTING))return;const t=Ut(),c=us()+(t?`?token=${encodeURIComponent(t)}`:"");ne=new WebSocket(c),ne.onopen=()=>{console.debug("Products WS connected")},ne.onmessage=g=>{let f=null;try{f=JSON.parse(g.data)}catch{return}He.forEach(n=>{try{n(f)}catch(l){console.error("ws callback error",l)}})},ne.onclose=()=>{console.debug("Products WS closed"),ne=null},ne.onerror=g=>{console.error("Products WS error",g)}}function gs(t){if(typeof t!="function")throw new Error("subscribeProducts requires a callback");return He.add(t),ps(),()=>{if(He.delete(t),ne&&He.size===0){try{ne.close()}catch{}ne=null}}}const Ft=a.createContext(),pe=()=>a.useContext(Ft),bs=({children:t})=>{const[c,g]=a.useState(null),[f,n]=a.useState(!0),[l,r]=a.useState(!1),[h,x]=a.useState({});a.useEffect(()=>{i()},[]),a.useEffect(()=>{const N=()=>{const C=localStorage.getItem("user");if(C)try{const T=JSON.parse(C);g(T)}catch(T){console.warn("Failed to parse user from localStorage",T)}else g(null)};return window.addEventListener("storage",N),window.addEventListener("localStorageUpdated",N),()=>{window.removeEventListener("storage",N),window.removeEventListener("localStorageUpdated",N)}},[]);const i=async()=>{try{const N=localStorage.getItem("token"),C=localStorage.getItem("user");if(N)try{const T=await fetch(`${Y}/auth/me`,{headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"}});if(T.ok){const B=await T.json();g(B),localStorage.setItem("user",JSON.stringify(B))}else throw new Error("Invalid token")}catch(T){console.warn("Auth check failed:",T),localStorage.removeItem("token"),localStorage.removeItem("user")}}catch(N){console.error("Error initializing auth:",N),localStorage.removeItem("token"),localStorage.removeItem("user"),g(null)}finally{n(!1),r(!0)}},p=async N=>{try{if(N&&N.token&&N.user)return localStorage.setItem("token",N.token),localStorage.setItem("user",JSON.stringify(N.user)),g(N.user),N;const C=await Pe.login(N);if(C.token&&C.user)return localStorage.setItem("token",C.token),localStorage.setItem("user",JSON.stringify(C.user)),g(C.user),C;throw new Error("Invalid response from server")}catch(C){throw console.error("Login failed:",C),C}},j=async N=>{try{const C=await Pe.signup(N);if(C.token&&C.user)return localStorage.setItem("token",C.token),localStorage.setItem("user",JSON.stringify(C.user)),g(C.user),C;throw new Error("Invalid response from server")}catch(C){throw console.error("Signup failed:",C),C}},o=async N=>{try{if(localStorage.setItem("user",JSON.stringify(N)),g(N),window.dispatchEvent(new Event("localStorageUpdated")),N&&N.id)try{await ve.update(N.id,N)}catch(C){console.warn("Failed to persist updated user to backend",C)}return N}catch(C){throw console.error("updateUser failed:",C),C}},U=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),g(null),window.location.href="/login"},u=()=>!!c&&!!localStorage.getItem("token"),y=N=>c&&c.role===N,v=()=>c&&(c.role==="admin"||c.role==="main-admin"),w=()=>c&&c.role==="cashier",k=()=>c&&c.plan==="ultra",I=()=>c&&c.plan==="basic",P=()=>c&&(c.role==="admin"||c.role==="cashier"),_=()=>c&&c.role==="admin"&&c.plan==="ultra",b=()=>c&&c.role==="admin",$=()=>!0,s=()=>!0;return c?.locked?e.jsx(LockedAccount,{}):e.jsx(Ft.Provider,{value:{user:c,loading:f,isInitialized:l,appSettings:h,login:p,signup:j,updateUser:o,logout:U,isAuthenticated:u,hasRole:y,isAdmin:v,isCashier:w,isUltraPackage:k,isBasicPackage:I,canEditStock:P,canManageUsers:_,canViewAnalytics:b,isRealTimeProductSyncEnabled:$,isCashierUserManagementEnabled:s},children:t})};new Date().toISOString();const Rt=a.createContext(),fs=()=>a.useContext(Rt),js=({children:t})=>{const{user:c}=pe(),[g,f]=a.useState([]),[n,l]=a.useState(!0),[r,h]=a.useState(null),[x,i]=a.useState(Date.now()),p=a.useCallback(async()=>{if(!localStorage.getItem("token")){l(!1);return}try{const o=await oe.getAll(),u=(Array.isArray(o)?o:[]).filter(y=>c?.role==="admin"?!0:!y.expenseOnly&&!y.pendingDelete&&y.visibleToCashier!==!1);f(u),h(null),window.dispatchEvent(new CustomEvent("productsSync",{detail:{products:u,timestamp:Date.now()}}))}catch(o){console.error("Failed to fetch products:",o),h(`Failed to load products: ${o.message}`),f([])}finally{l(!1),i(Date.now())}},[c]);a.useEffect(()=>{p()},[p,c]),a.useEffect(()=>{const o=setInterval(()=>{p()},2e3);return()=>clearInterval(o)},[p]);const j=async()=>{l(!0),await p()};return e.jsx(Rt.Provider,{value:{products:g,loading:n,error:r,lastUpdated:x,refreshProducts:j},children:t})};function ys(){const[t,c]=a.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[g,f]=a.useState(!0),[n,l]=a.useState(null);a.useEffect(()=>{r()},[]);const r=async()=>{try{l(null);const[i,p]=await Promise.all([Ot.get(),Oe.getAll()]),j={totalSales:i?.totalSales||0,totalExpenses:i?.totalExpenses||0,profit:i?.profit||0,grossProfit:i?.grossProfit||0,netProfit:i?.netProfit||0,totalCOGS:i?.totalCOGS||0,dailySales:i?.dailySales||0,weeklySales:i?.weeklySales||0,productCount:i?.productCount||0},o=Array.isArray(p)?p:[];c({stats:j,recentSales:o.slice(-10).reverse()})}catch(i){console.error("Failed to load data:",i),l(i.message),c({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{f(!1)}};if(g)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(n&&t.stats.totalSales===0&&t.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(ze,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:n}),e.jsx("button",{onClick:r,className:"btn-primary",children:"Retry"})]})});const h=[{label:"Total Sales",value:`KSH ${t.stats.totalSales?.toLocaleString()||0}`,icon:je,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${t.stats.grossProfit?.toLocaleString()||0}`,icon:Ee,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${t.stats.totalCOGS?.toLocaleString()||0}`,icon:Ue,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${t.stats.netProfit?.toLocaleString()||0}`,icon:Ee,color:"from-purple-500 to-pink-600",change:"+15.3%"}],x=[{label:"Daily Sales",value:`KSH ${t.stats.dailySales?.toLocaleString()||0}`,icon:kt,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${t.stats.weeklySales?.toLocaleString()||0}`,icon:Ee,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${t.stats.totalExpenses?.toLocaleString()||0}`,icon:Ke,color:"bg-red-50 text-red-600"},{label:"Products",value:t.stats.productCount||0,icon:Ue,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(h||[]).map((i,p)=>{const j=i?.icon;return j?e.jsxs("div",{className:`card bg-gradient-to-br ${i.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(j,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:i.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:i.label}),e.jsx("p",{className:"text-2xl font-bold",children:i.value})]},p):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(x||[]).map((i,p)=>{const j=i?.icon;return j?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${i.color} flex items-center justify-center`,children:e.jsx(j,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:i.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:i.value})]})]})},p):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!t.recentSales||t.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ze,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(t.recentSales||[]).map(i=>i?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:i.createdAt?new Date(i.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(i.items)?i.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:i.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",i.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",i.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",i.profit?.toLocaleString()||0]})]},i.id||Math.random()):null)})]})})]})]})}const Ns=()=>"https://posifine22.onrender.com/api".replace("https://","wss://").replace("http://","ws://");class vs{constructor(){this.ws=null,this.listeners={stock_updated:[],heartbeat:[],initial:[],error:[]},this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.isManualClose=!1}connect(c,g){return new Promise((f,n)=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){f();return}if(!c){n(new Error("No token provided for WebSocket connection"));return}const l=`${Ns()}/ws/products?token=${encodeURIComponent(c)}`;try{this.ws=new WebSocket(l),this.ws.onopen=()=>{console.log("âœ… WebSocket connected for real-time updates"),this.reconnectAttempts=0,f()},this.ws.onmessage=r=>{try{const h=JSON.parse(r.data);h.type==="stock_updated"?(console.log("ðŸ“¦ Stock update received:",h.data),g&&g(h.data),this.emit("stock_updated",h.data)):h.type==="initial"?(console.log("ðŸ“¦ Initial products loaded via WebSocket"),this.emit("initial",h.products)):h.type==="heartbeat"&&this.emit("heartbeat",h)}catch(h){console.error("Error parsing WebSocket message:",h)}},this.ws.onerror=r=>{console.error("âŒ WebSocket error:",r),this.emit("error",r),n(r)},this.ws.onclose=()=>{console.log("ðŸ”Œ WebSocket disconnected"),this.isManualClose||this.attemptReconnect(c,g)}}catch(r){console.error("Failed to create WebSocket:",r),n(r)}})}attemptReconnect(c,g){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Max reconnection attempts reached");return}this.reconnectAttempts++;const f=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`ðŸ”„ Reconnecting in ${f}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect(c,g).catch(n=>{console.error("Reconnection failed:",n)})},f)}on(c,g){this.listeners[c]||(this.listeners[c]=[]),this.listeners[c].push(g)}emit(c,g){this.listeners[c]&&this.listeners[c].forEach(f=>{try{f(g)}catch(n){console.error(`Error in ${c} listener:`,n)}})}disconnect(){this.isManualClose=!0,this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}}const Ye=new vs;function ws(){const{user:t,isUltraPackage:c,isRealTimeProductSyncEnabled:g}=pe(),{products:f,refreshProducts:n}=fs(),[l,r]=a.useState([]),[h,x]=a.useState([]),[i,p]=a.useState("all"),[j,o]=a.useState(""),[U,u]=a.useState(!1),[y,v]=a.useState(!1),[w,k]=a.useState(!1),[I,P]=a.useState(null),[_,b]=a.useState(null),[$,s]=a.useState(null),[N,C]=a.useState(!1),[T,B]=a.useState(null),[te,re]=a.useState(""),[z,se]=a.useState({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),[Z,q]=a.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[F,V]=a.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0});a.useEffect(()=>{S();const m=localStorage.getItem("token");return m&&Ye.connect(m,A=>{A&&A.allProducts&&r(A.allProducts)}).catch(A=>{console.warn("WebSocket connection failed:",A)}),()=>{Ye.disconnect()}},[]);const S=async()=>{try{await n();const m=await Ve.getAll();x(m)}catch(m){console.error("Failed to load data:",m)}};a.useEffect(()=>{f&&r(f)},[f]);const R=(m,A=!0)=>{const D=m.target.files[0];if(D){if(D.size>2*1024*1024){Q("Image must be smaller than 2MB","error");return}const W=new FileReader;W.onload=K=>{const ee=K.target.result;re(ee),A?se({...z,image:ee}):(V({...F,image:ee}),F.id&&setTimeout(async()=>{try{await oe.update(F.id,{image:ee}),Q("âœ… Image saved","success")}catch(ge){console.error("Failed to save image:",ge)}},500))},W.readAsDataURL(D)}},M=m=>h.filter(D=>D.productId===m&&D.quantity>0).reduce((D,W)=>D+W.quantity,0),X=m=>h.filter(A=>A.productId===m&&A.quantity>0),Q=(m,A="success")=>{s({message:m,type:A}),setTimeout(()=>s(null),5e3)},de=async m=>{m.preventDefault();try{const A={...z,price:parseFloat(z.price),cost:parseFloat(z.cost||0),quantity:0,visibleToCashier:!z.expenseOnly&&z.visibleToCashier!==!1},D=await oe.create(A);se({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),re(""),u(!1),await S(),Q(`âœ… Product "${D.name}" added successfully! ${D.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success")}catch(A){console.error("Failed to create product:",A),alert(`Failed to create product: ${A.message||"Unknown error"}`)}},xe=async m=>{m.preventDefault();try{const A={id:`batch-${Date.now()}`,productId:I.id,quantity:parseInt(Z.quantity),expiryDate:Z.expiryDate,batchNumber:Z.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(Z.cost||I.cost||0)};x(D=>[...D,A]),Q("âš¡ Adding stock...","info");try{await Ve.create({productId:I.id,quantity:parseInt(Z.quantity),expiryDate:Z.expiryDate,batchNumber:Z.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(Z.cost||I.cost||0)}),q({quantity:"",expiryDate:"",batchNumber:"",cost:""}),k(!1),P(null),await S(),Q(`âœ… Stock added successfully for ${I.name}!`,"success")}catch(D){throw x(W=>W.filter(K=>K.id!==A.id)),D}}catch(A){console.error("Failed to add stock:",A),Q(`âŒ Failed to add stock: ${A.message||"Unknown error"}`,"error")}},Fe=async m=>{m.preventDefault();try{const A=l.find(K=>K.id===F.id);if(parseFloat(F.price)<A.price){alert("You cannot lower prices, only increase.");return}const D={...F,price:parseFloat(F.price),cost:parseFloat(F.cost),quantity:parseFloat(F.quantity)},W={...A,...D};r(K=>K.map(ee=>ee.id===F.id?W:ee)),C(!0),Q("âš¡ Updating product...","info");try{const K=await oe.update(F.id,D);v(!1),g()?(window.dispatchEvent(new CustomEvent("productUpdated",{detail:{product:K,originalProduct:A,timestamp:new Date().toISOString(),type:"update"}})),Q("âœ… Product updated and synced!","success")):Q("âœ… Product updated successfully!","success"),B(new Date)}catch(K){throw r(ee=>ee.map(ge=>ge.id===F.id?A:ge)),K}finally{C(!1)}}catch(A){console.error("Failed to update product:",A),Q(`âŒ Update failed: ${A.message||"Unknown error"}`,"error")}},Ze=async m=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const A=l.find(W=>W.id===m),D=await oe.delete(m);if(r(W=>W.filter(K=>K.id!==m)),g()&&A)C(!0),window.dispatchEvent(new CustomEvent("productDeleted",{detail:{product:A,timestamp:new Date().toISOString(),type:"delete"}})),Q(`ðŸ“¡ Product "${A.name}" deleted and synced to all dashboards!`,"success"),B(new Date),setTimeout(()=>{C(!1)},3e3);else{const W=D?.message||"Product deleted successfully!";alert(W)}await n()}catch(A){console.error("Failed to delete product:",A);let D="Failed to delete product";A.message.includes("Failed to execute")||A.message.includes("JSON")?D="Network error. Please check your connection and try again.":A.message.includes("401")||A.message.includes("unauthorized")?D="You are not authorized to delete this product.":A.message.includes("404")||A.message.includes("not found")?D="Product not found. It may have been deleted already.":A.message&&(D=`Failed to delete product: ${A.message}`),alert(D)}},Xe=(l||[]).filter(m=>{if(!m)return!1;const A=m.name?.toLowerCase().includes(j.toLowerCase()),D=i==="all"||i==="raw"&&!m.recipe||i==="composite"&&m.recipe||i==="expense"&&m.expenseOnly||i==="low-stock"&&m.quantity<10;return A&&D}),et=(l||[]).filter(m=>m&&!m.recipe&&!m.expenseOnly),he=(l||[]).filter(m=>m&&m.recipe),tt=(l||[]).filter(m=>m&&m.expenseOnly),Ce=m=>{if(!m||!m.recipe)return 0;let A=1/0;return(m.recipe||[]).forEach(D=>{if(!D)return;const W=(l||[]).find(K=>K&&K.id===D.productId);if(W&&W.quantity>0&&D.quantity>0){const K=Math.floor(W.quantity/D.quantity);A=Math.min(A,K)}}),A===1/0?0:A},st=m=>{if(!m)return 0;if(!m.recipe)return m.cost||0;let A=0;return(m.recipe||[]).forEach(D=>{if(!D)return;const W=(l||[]).find(K=>K&&K.id===D.productId);if(W&&W.quantity>0){const K=(W.cost||0)/W.quantity;A+=K*(D.quantity||0)}}),A};return e.jsxs("div",{className:"p-6 space-y-6",children:[$&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${$.type==="success"?"bg-green-50 border border-green-200 text-green-800":$.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:$.message}),e.jsx("button",{onClick:()=>s(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ct,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:j,onChange:m=>o(m.target.value)})]}),e.jsxs("select",{value:i,onChange:m=>p(m.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>u(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:et.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:he.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:tt.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(Xe||[]).map(m=>{if(!m)return null;const A=st(m),D=m.price?((m.price-A)/m.price*100).toFixed(1):0,W=Ce(m),K=_===m.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[m.image?e.jsx("img",{src:m.image,alt:m.name,className:"w-12 h-12 object-cover rounded-lg",onError:ee=>{ee.target.style.display="none",ee.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:m.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[m.recipe&&e.jsx("button",{onClick:()=>b(K?null:m.id),className:"p-1 hover:bg-gray-200 rounded",children:K?e.jsx(Wt,{className:"w-4 h-4"}):e.jsx(Gt,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:m.name}),m.quantity<10&&!m.recipe&&e.jsx(Ae,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${m.expenseOnly?"badge-warning":m.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:m.expenseOnly?"Expense":m.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",m.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",A.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${M(m.id)===0?"text-red-600":M(m.id)<10?"text-yellow-600":"text-gray-900"}`,children:[M(m.id)," ",m.unit]}),M(m.id)<10&&M(m.id)>0&&e.jsx(Ae,{className:"w-4 h-4 text-yellow-500"}),M(m.id)===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600",children:[X(m.id).length," active"]}),e.jsx("button",{onClick:()=>{P(m),k(!0)},className:"p-1 hover:bg-blue-50 rounded text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(ce,{className:"w-3 h-3"})})]})}),e.jsx("td",{className:"px-4 py-3",children:m.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[W," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${D>30?"text-green-600":D>15?"text-yellow-600":"text-red-600"}`,children:[D,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{V(m),v(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(Te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ze(m.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(me,{className:"w-4 h-4"})})]})})]},m.id),K&&m.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(m.recipe||[]).map((ee,ge)=>{if(!ee)return null;const ue=(l||[]).find(E=>E&&E.id===ee.productId);if(!ue)return null;const d=(ue.cost||0)/(ue.quantity||1),L=d*(ee.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:ue.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[ee.quantity||0," ",ue.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[ue.quantity||0," ",ue.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",d.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",L.toFixed(2)]})]},ge)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",A.toFixed(2)]})]})})]})]})})})]})})})]})})}),w&&I&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Add Stock for ",I.name]}),e.jsxs("form",{onSubmit:xe,className:"space-y-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:Z.quantity,onChange:m=>q({...Z,quantity:m.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:Z.expiryDate,onChange:m=>q({...Z,expiryDate:m.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:Z.batchNumber,onChange:m=>q({...Z,batchNumber:m.target.value})}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost per Unit",className:"input",value:Z.cost,onChange:m=>q({...Z,cost:m.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{k(!1),P(null),q({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]})}),U&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:de,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:z.name,onChange:m=>se({...z,name:m.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:m=>R(m,!0),className:"input"}),e.jsx(Pt,{className:"w-5 h-5 text-gray-400"})]}),(te||z.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:te||z.image,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:z.price,onChange:m=>se({...z,price:m.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:z.cost,onChange:m=>se({...z,cost:m.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:z.category,onChange:m=>se({...z,category:m.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsxs("select",{className:"input",value:z.unit,onChange:m=>se({...z,unit:m.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:z.expenseOnly,onChange:m=>se({...z,expenseOnly:m.target.checked,visibleToCashier:!m.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!z.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:z.visibleToCashier,onChange:m=>se({...z,visibleToCashier:m.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{u(!1),re(""),se({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0})},className:"btn-secondary",children:"Cancel"})]})]})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:Fe,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:F.name,onChange:m=>V({...F,name:m.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:F.image||"",onChange:m=>V({...F,image:m.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:m=>{const A=m.target.files[0];if(A){const D=new FileReader;D.onloadend=()=>{V({...F,image:D.result})},D.readAsDataURL(A)}}})]}),F.image&&e.jsx("img",{src:F.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:F.price||"",onChange:m=>V({...F,price:m.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:F.cost||"",onChange:m=>V({...F,cost:m.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:F.quantity||"",onChange:m=>V({...F,quantity:m.target.value}),required:!0}),e.jsxs("select",{className:"input",value:F.unit||"pcs",onChange:m=>V({...F,unit:m.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:F.category||"raw",onChange:m=>V({...F,category:m.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:F.expenseOnly||!1,onChange:m=>V({...F,expenseOnly:m.target.checked,visibleToCashier:!m.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!F.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:F.visibleToCashier!==!1,onChange:m=>V({...F,visibleToCashier:m.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>v(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ss(){const[t,c]=a.useState([]),[g,f]=a.useState([]),[n,l]=a.useState(!1),[r,h]=a.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});a.useEffect(()=>{x()},[]);const x=async()=>{const y=await oe.getAll();c(y),f(y.filter(v=>!v.recipe))},i=()=>{h({...r,ingredients:[...r.ingredients,{name:"",quantity:"",unit:"pcs"}]})},p=(y,v,w)=>{const k=[...r.ingredients];k[y][v]=w,h({...r,ingredients:k})},j=y=>{h({...r,ingredients:r.ingredients.filter((v,w)=>w!==y)})},o=()=>r.ingredients.reduce((y,v)=>{const w=g.find(k=>k.name.toLowerCase()===v.name.toLowerCase());if(w&&v.quantity){const k=w.cost/w.quantity;return y+k*parseFloat(v.quantity)}return y},0),U=async y=>{y.preventDefault();const v=[];for(const k of r.ingredients){if(!k.name||!k.quantity)continue;const I=g.find(P=>P.name.toLowerCase()===k.name.toLowerCase());I?v.push({productId:I.id,quantity:parseFloat(k.quantity),unit:k.unit||"pcs"}):v.push({name:k.name,quantity:parseFloat(k.quantity),unit:k.unit||"pcs"})}if(v.length===0){alert("Please add at least one ingredient");return}const w=o();try{await oe.create({name:r.name,price:parseFloat(r.price),cost:w,quantity:0,unit:"pcs",category:"composite",recipe:v,image:r.image||"",visibleToCashier:r.visibleToCashier,expenseOnly:!1}),h({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),l(!1),x(),alert("Recipe created successfully!")}catch(k){console.error("Error creating recipe:",k),alert("Failed to create recipe. Please try again.")}},u=t.filter(y=>y.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>l(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",u.length,")"]}),u.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:u.map(y=>{const v=y.recipe.reduce((k,I)=>{if(I.productId){const P=t.find(_=>_.id===I.productId);if(P){const _=P.cost/P.quantity;return k+_*I.quantity}}else if(I.name){const P=t.find(_=>_.name.toLowerCase()===I.name.toLowerCase());if(P){const _=P.cost/P.quantity;return k+_*I.quantity}}return k},0),w=((y.price-v)/y.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:y.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",y.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",v.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${w>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",w,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(me,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:y.recipe.map((k,I)=>{let P="",_=k.unit||"pcs";if(k.productId){const b=t.find($=>$.id===k.productId);b&&(P=b.name,_=b.unit)}else k.name&&(P=k.name,_=k.unit||"pcs");return P?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:P}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[k.quantity," ",_]})]},I):null})})]})]},y.id)})})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:r.name,onChange:y=>h({...r,name:y.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:r.price,onChange:y=>h({...r,price:y.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:r.image,onChange:y=>h({...r,image:y.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.visibleToCashier,onChange:y=>h({...r,visibleToCashier:y.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:i,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:r.ingredients.map((y,v)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:y.name,onChange:w=>p(v,"name",w.target.value),required:!0,list:`ingredients-list-${v}`}),e.jsx("datalist",{id:`ingredients-list-${v}`,children:g.map(w=>e.jsxs("option",{value:w.name,children:[w.name," (",w.quantity," ",w.unit," available)"]},w.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:y.quantity,onChange:w=>p(v,"quantity",w.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:y.unit,onChange:w=>p(v,"unit",w.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>j(v),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(me,{className:"w-4 h-4"})})]},v))}),r.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),r.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",o().toFixed(2)]})]}),r.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(r.price)-o())/parseFloat(r.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(Vt,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{l(!1),h({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function ks(){const[t,c]=a.useState([]),[g,f]=a.useState("all");a.useEffect(()=>{n()},[]);const n=async()=>{const i=await Oe.getAll();c(i.reverse())},l=t.filter(i=>{if(g==="today")return new Date(i.createdAt).toDateString()===new Date().toDateString();if(g==="week"){const p=new Date;return p.setDate(p.getDate()-7),new Date(i.createdAt)>=p}return!0}),r=l.reduce((i,p)=>i+p.total,0),h=l.reduce((i,p)=>i+(p.cogs||0),0),x=r-h;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("select",{value:g,onChange:i=>f(i.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]})}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(Yt,{className:"w-4 h-4"}),"Export"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",r.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",h.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",x.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:l.map(i=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",i.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(i.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[i.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:i.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",i.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",i.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",i.profit?.toLocaleString()||0]})]},i.id))})]})})]})]})}function Cs(){const[t,c]=a.useState([]),[g,f]=a.useState(!1),[n,l]=a.useState({description:"",amount:"",category:"general"});a.useEffect(()=>{r()},[]);const r=async()=>{const j=await Ge.getAll();c(j.reverse())},h=async j=>{j.preventDefault(),await Ge.create({...n,amount:parseFloat(n.amount)}),l({description:"",amount:"",category:"general"}),f(!1),r()},x=t.reduce((j,o)=>j+o.amount,0),i=t.filter(j=>!j.automatic),p=t.filter(j=>j.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("button",{onClick:()=>f(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",x.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",i.reduce((j,o)=>j+o.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",p.reduce((j,o)=>j+o.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.map(j=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(j.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:j.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:j.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${j.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:j.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",j.amount?.toLocaleString()]})]},j.id))})]})})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:n.description,onChange:j=>l({...n,description:j.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:n.amount,onChange:j=>l({...n,amount:j.target.value}),required:!0}),e.jsxs("select",{className:"input",value:n.category,onChange:j=>l({...n,category:j.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>f(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ps(){const{isCashierUserManagementEnabled:t,isCashier:c}=pe(),[g,f]=a.useState([]),[n,l]=a.useState(!0),[r,h]=a.useState(!1),[x,i]=a.useState(null),[p,j]=a.useState(null),[o,U]=a.useState(null),[u,y]=a.useState(0),[v,w]=a.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),[k,I]=a.useState(!1),[P,_]=a.useState(null),[b,$]=a.useState("");a.useEffect(()=>{s()},[]),a.useEffect(()=>()=>{o?.intervalId&&clearInterval(o.intervalId)},[o]);const s=async()=>{try{l(!0);const S=await ve.getAll();f(Array.isArray(S)?S:[])}catch(S){console.error("Error loading users:",S),f([])}finally{l(!1)}},N=()=>Math.floor(1e3+Math.random()*9e3).toString(),C=async S=>{if(S.preventDefault(),console.log("Form submitted with data:",v),!v.name?.trim()||!v.email?.trim()||!v.password?.trim()){alert("Please fill in all required fields");return}if(v.password.length<6){alert("Password must be at least 6 characters long");return}try{l(!0);const R=N(),M={name:v.name.trim(),email:v.email.trim().toLowerCase(),password:v.password.trim(),pin:R};console.log("Sending user data:",M);const X=await ve.create(M);console.log("User creation result:",X),await s();const Q=`âœ… Cashier added successfully!

ðŸ“§ Email: ${M.email}
ðŸ”‘ Password: ${M.password}
ðŸ”¢ PIN: ${R}

ðŸ’¡ LOGIN OPTIONS:
1. Email + Password: Use email and password above
2. PIN Login: Use email + ${R}

Please share these credentials securely with the new cashier.`;alert(Q),w({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),h(!1)}catch(R){console.error("Error creating cashier:",R);let M="Failed to add cashier";R.message.includes("Current user not found")?M="Authentication error. Please refresh the page and try again.":R.message.includes("email")?M="Email already exists. Please use a different email.":R.message.includes("network")||R.message.includes("fetch")?M="Network error. Please check your connection and try again.":R.message&&(M=`Failed to add cashier: ${R.message}`),alert(M)}finally{l(!1)}},T=async(S,R)=>{try{l(!0),await ve.update(S,{permissions:R}),await s(),i(null)}catch(M){console.error("Error updating permissions:",M),alert("Failed to update permissions: "+M.message)}finally{l(!1)}},B=async(S,R)=>{try{l(!0);const M=!R,X=await fetch(`${Y}/users/${S}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({active:M})});if(!X.ok){const Q=await X.json().catch(()=>({error:"Network error"}));throw new Error(Q.error||`HTTP ${X.status}: ${X.statusText}`)}await s()}catch(M){console.error("Error updating user status:",M),alert("Failed to update user status: "+M.message)}finally{l(!1)}},te=async(S,R)=>{try{l(!0);const M=!R,X=await fetch(`${Y}/users/${S}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({locked:M})});if(!X.ok){const Q=await X.json().catch(()=>({error:"Network error"}));throw new Error(Q.error||`HTTP ${X.status}: ${X.statusText}`)}await s()}catch(M){console.error("Error updating user lock status:",M),alert("Failed to update user lock status: "+M.message)}finally{l(!1)}},re=async S=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{l(!0),await ve.delete(S),await s()}catch(R){console.error("Error deleting user:",R),alert("Failed to delete user: "+R.message)}finally{l(!1)}},z=S=>{_(S),$(N()),I(!0)},se=async()=>{try{l(!0),await ve.update(P.id,{cashierPIN:b}),await s(),I(!1),_(null),$(""),alert(`âœ… PIN reset successfully!

ðŸ”¢ New PIN for ${P.name}: ${b}

Please share this PIN securely with the cashier.`)}catch(S){console.error("Error resetting PIN:",S),alert("Failed to reset PIN: "+S.message)}finally{l(!1)}},Z=S=>{j(S),U({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const R=setInterval(()=>{F(S)},3e3);U(M=>({...M,intervalId:R})),F(S)},q=()=>{o?.intervalId&&clearInterval(o.intervalId),j(null),U(null)},F=async S=>{try{const R=await Oe.getAll(),X=(Array.isArray(R)?R:[]).filter(de=>de.cashierId===S.id).sort((de,xe)=>new Date(xe.createdAt)-new Date(de.createdAt)).slice(0,10),Q={isActive:Math.random()>.3,currentCart:X.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:X.reduce((de,xe)=>de+xe.total,0),salesCount:X.length,lastActivity:X.length>0?new Date(X[0].createdAt).toLocaleTimeString():"No recent activity"};U(Q)}catch(R){console.error("Error loading live view data:",R)}},V=(g||[]).filter(S=>S.role==="cashier");return n&&g.length===0?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),t()&&e.jsxs("button",{onClick:()=>h(!0),className:"btn-primary flex items-center gap-2",disabled:n,children:[e.jsx(ce,{className:"w-4 h-4"}),"Add Cashier"]})]}),c()&&!t()&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(ie,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"User Management Restricted"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The admin has disabled cashier user management. You cannot add, edit, or remove users at this time."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:g.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:V.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:g.filter(S=>S.active).length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(g||[]).map(S=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:S.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:S.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${S.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:S.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:S.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:S.role==="cashier"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:S.pin||S.cashierPIN||"----"}),e.jsx("button",{onClick:()=>z(S),className:"p-1 hover:bg-yellow-50 rounded text-yellow-600",title:"Reset PIN",disabled:n,children:e.jsx(Te,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${S.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:S.active?e.jsxs(e.Fragment,{children:[e.jsx(nt,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"w-3 h-3"}),"Inactive"]})}),S.locked&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:[e.jsx(ke,{className:"w-3 h-3"}),"Locked"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>B(S.id,S.active),className:`p-2 rounded-lg transition ${S.active?"hover:bg-red-50 text-red-600":"hover:bg-green-50 text-green-600"}`,title:S.active?"Deactivate User":"Activate User",disabled:n,children:S.active?e.jsx(bt,{className:"w-4 h-4"}):e.jsx(nt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>te(S.id,S.locked||!1),className:`p-2 rounded-lg transition ${S.locked?"hover:bg-green-50 text-green-600":"hover:bg-red-50 text-red-600"}`,title:S.locked?"Unlock User":"Lock User",disabled:n,children:e.jsx(ke,{className:"w-4 h-4"})})]}),S.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",S.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(mt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Z(S),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(ft,{className:"w-4 h-4"})})]}),t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>i(S),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600",title:"Edit Permissions",children:e.jsx(Te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>re(S.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",title:"Delete User",disabled:n,children:e.jsx(me,{className:"w-4 h-4"})})]})]})})]},S.id))})]}),g.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first cashier to get started"})]})]})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:v.name||"",onChange:S=>{console.log("Name input changed:",S.target.value),w({...v,name:S.target.value})},required:!0,disabled:n}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:v.email||"",onChange:S=>{console.log("Email input changed:",S.target.value),w({...v,email:S.target.value})},required:!0,disabled:n}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:v.password||"",onChange:S=>{console.log("Password input changed:",S.target.value),w({...v,password:S.target.value})},required:!0,minLength:6,disabled:n}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(v.permissions).map(([S,R])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:M=>w({...v,permissions:{...v.permissions,[S]:M.target.checked}}),disabled:n}),e.jsx("span",{className:"text-sm capitalize",children:S.replace(/([A-Z])/g," $1").trim()})]},S))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:n,children:n?"Adding...":"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"btn-secondary",disabled:n,children:"Cancel"})]})]})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",x.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(x.permissions||{}).map(([S,R])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:M=>i({...x,permissions:{...x.permissions,[S]:M.target.checked}}),disabled:n}),e.jsx("span",{className:"text-sm capitalize",children:S.replace(/([A-Z])/g," $1").trim()})]},S))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>T(x.id,x.permissions),className:"btn-primary flex-1",disabled:n,children:n?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>i(null),className:"btn-secondary",disabled:n,children:"Cancel"})]})]})}),p&&o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(ft,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",p.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:q,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx($e,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${o.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:o.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ye,{className:"w-4 h-4"}),"Last Activity: ",o.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_e,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(o.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(o.currentCart||[]).map((S,R)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[S.name," x",S.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",S.price.toLocaleString()]})]},R)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(o.currentCart||[]).reduce((S,R)=>S+R.price*R.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:o.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",o.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",o.salesCount>0?Math.round(o.totalSalesToday/o.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})}),k&&P&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Reset PIN for ",P.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate a new 4-digit PIN for this cashier. The old PIN will be invalid."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"New PIN:"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-mono text-3xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:b})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>$(N()),className:"btn-secondary flex-1",disabled:n,children:"Generate New PIN"}),e.jsx("button",{onClick:se,className:"btn-primary flex-1",disabled:n,children:n?"Updating...":"Confirm & Update"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>{I(!1),_(null),$("")},className:"btn-secondary w-full",disabled:n,children:"Cancel"})})]})})]})}function As(){const[t,c]=a.useState([]),[g,f]=a.useState("all");a.useEffect(()=>{n()},[]);const n=()=>{const x=JSON.parse(localStorage.getItem("clockRecords")||"[]");c(x.reverse())},l=g==="all"?t:t.filter(x=>x.date===new Date().toDateString()),r=l.filter(x=>x.date===new Date().toDateString()).reduce((x,i)=>x+i.duration,0)/60,h=x=>{const i=Math.floor(x/60),p=x%60;return`${i}h ${p}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(ye,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[r.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(ht,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(l.filter(x=>x.date===new Date().toDateString()).map(x=>x.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(we,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:t.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${g==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>f("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${g==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"})]})}),e.jsx("tbody",{children:l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-gray-500",children:"No records found"})}):l.map((x,i)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:x.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.clockIn).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.clockIn).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.clockOut).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:h(x.duration)})})]},i))})]})})]})]})}function Ts(){const{user:t,updateUser:c}=pe();Ne();const[g,f]=a.useState(!1),[n,l]=a.useState(t?.plan||"ultra"),[r,h]=a.useState({}),[x,i]=a.useState(null),[p,j]=a.useState(t?.profilePicture||null),[o,U]=a.useState(!0),[u,y]=a.useState(!0);a.useEffect(()=>{v()},[]);const v=async()=>{try{const s=await Le.get();h(s),s.logo&&i(s.logo),U(s.cashierUserManagement!==!1),y(s.realTimeProductSync!==!1)}catch(s){console.error("Failed to load settings:",s)}},w=async s=>{try{const N={...r,...s};return await Le.update(N),h(N),!0}catch(N){return console.error("Failed to save settings:",N),!1}},k=async()=>{const s=!o;U(s),await w({cashierUserManagement:s})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{cashierUserManagement:s}})),alert(`âœ… Cashier User Management ${s?"ENABLED":"DISABLED"}`)):(U(!s),alert("âŒ Failed to save setting. Please try again."))},I=async()=>{const s=!u;y(s),await w({realTimeProductSync:s})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{realTimeProductSync:s}})),alert(`âœ… Real-time Product Sync ${s?"ENABLED":"DISABLED"}`)):(y(!s),alert("âŒ Failed to save setting. Please try again."))},P=async s=>{const N=s.target.files[0];if(N){const C=new FileReader;C.onloadend=async()=>{const T=C.result;i(T);try{await Le.update({...r,logo:T}),h({...r,logo:T})}catch(B){console.error("Failed to save logo:",B)}},C.readAsDataURL(N)}},_=async s=>{const N=s.target.files[0];if(N){const C=new FileReader;C.onloadend=async()=>{const T=C.result;j(T);try{await c({...t,profilePicture:T})}catch(B){console.error("Failed to save profile picture:",B)}},C.readAsDataURL(N)}},b=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],$=async()=>{const s=b.find(C=>C.id===n),N=n==="ultra"?"admin":"cashier";await c({...t,role:N,plan:n,price:s.price}),f(!1),setTimeout(()=>window.location.href=N==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(ht,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[p?e.jsx("img",{src:p,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:t?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(jt,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:_})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Je,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>f(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(ut,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cashier User Management"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Cashier User Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow cashiers to add and remove users"})]}),e.jsx("button",{onClick:k,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${o?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${o?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${o?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:o?"âœ… Cashiers can add and remove users when enabled":"âŒ Cashiers cannot add or remove users when disabled"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(At,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Real-time Product Sync"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Real-time Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync products between admin and cashier dashboards"})]}),e.jsx("button",{onClick:I,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${u?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${u?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${u?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:u?"âœ… Products will sync in real-time across all dashboards":"âŒ Products will not sync automatically across dashboards"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(ke,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Qt,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[x&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:x,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(jt,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:P})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:b.map(s=>e.jsxs("div",{onClick:()=>l(s.id),className:`card cursor-pointer transition-all ${n===s.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:s.name}),n===s.id&&e.jsx(We,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",s.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:s.features.map((N,C)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(We,{className:"w-4 h-4 text-green-600"}),N]},C))})]},s.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:$,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>f(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function Is(){const[t,c]=a.useState([]),[g,f]=a.useState(!1),[n,l]=a.useState(null),[r,h]=a.useState({name:"",amount:"",description:"",active:!0});a.useEffect(()=>{x()},[]);const x=()=>{const o=JSON.parse(localStorage.getItem("serviceFees")||"[]");c(o)},i=o=>{localStorage.setItem("serviceFees",JSON.stringify(o)),c(o)},p=o=>{if(o.preventDefault(),n){const U=t.map(u=>u.id===n.id?{...r,id:u.id}:u);i(U)}else{const U={...r,id:Date.now(),createdAt:new Date().toISOString()};i([...t,U])}f(!1),l(null),h({name:"",amount:"",description:"",active:!0})},j=o=>{confirm("Delete this service fee?")&&i(t.filter(U=>U.id!==o))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{f(!0),l(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(o=>e.jsxs("div",{className:`card ${o.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(je,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:o.name}),e.jsx("p",{className:"text-xs text-gray-500",children:o.description})]})]}),e.jsx("span",{className:`badge ${o.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:o.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",o.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{l(o),h(o),f(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(Te,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>j(o.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(me,{className:"w-4 h-4 text-red-600"})})]})]})]},o.id))}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:r.name,onChange:o=>h({...r,name:o.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:r.amount,onChange:o=>h({...r,amount:o.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:r.description,onChange:o=>h({...r,description:o.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.active,onChange:o=>h({...r,active:o.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>f(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ds(){const[t,c]=a.useState([]),[g,f]=a.useState([]),[n,l]=a.useState(!1),[r,h]=a.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});a.useEffect(()=>{x(),i()},[]);const x=async()=>{try{const u=localStorage.getItem("token"),y=await fetch(`${Y}/reminders`,{headers:{Authorization:`Bearer ${u}`}});if(!y.ok){console.error("API Error:",y.status,y.statusText),c([]);return}const v=await y.json();Array.isArray(v)?c(v):(console.error("Expected array but got:",typeof v,v),c([]))}catch(u){console.error("Failed to fetch reminders:",u),c([])}},i=async()=>{try{const u=localStorage.getItem("token"),y=await fetch(`${Y}/products`,{headers:{Authorization:`Bearer ${u}`}});if(!y.ok){console.error("API Error:",y.status,y.statusText),f([]);return}const v=await y.json();Array.isArray(v)?f(v):(console.error("Expected array but got:",typeof v,v),f([]))}catch(u){console.error("Failed to fetch products:",u),f([])}},p=async u=>{u.preventDefault();try{const y=localStorage.getItem("token"),v=await fetch(`${Y}/reminders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`},body:JSON.stringify(r)});if(!v.ok){const k=await v.json();console.error("Failed to create reminder:",k),alert(`Failed to create reminder: ${k.error||"Unknown error"}`);return}const w=await v.json();h({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),l(!1),x(),alert("Reminder created successfully!")}catch(y){console.error("Failed to create reminder:",y),alert("Failed to create reminder. Please try again.")}},j=async u=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const v=localStorage.getItem("token"),w=await fetch(`${Y}/reminders/${u}`,{method:"DELETE",headers:{Authorization:`Bearer ${v}`}});if(!w.ok){const k=await w.json();console.error("Failed to delete reminder:",k),alert(`Failed to delete reminder: ${k.error||"Unknown error"}`);return}x(),alert("Reminder deleted successfully!")}catch(y){console.error("Failed to delete reminder:",y),alert("Failed to delete reminder. Please try again.")}},o=u=>{r.days.includes(u)?h({...r,days:r.days.filter(y=>y!==u)}):h({...r,days:[...r.days,u]})},U=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(ut,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("button",{onClick:()=>l(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(ce,{size:20}),"New Reminder"]})]}),e.jsx("div",{className:"grid gap-4",children:t.map(u=>{const y=g.find(v=>v.id===u.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${u.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:u.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",y?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",u.frequency]}),u.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",u.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(we,{size:16}),"Next: ",new Date(u.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${u.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:u.status}),e.jsx("button",{onClick:()=>j(u.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(me,{size:20})})]})]})},u.id)})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:p,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:r.customerName,onChange:u=>h({...r,customerName:u.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:r.productId,onChange:u=>h({...r,productId:parseInt(u.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),g.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:r.frequency,onChange:u=>h({...r,frequency:u.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),r.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:U.map(u=>e.jsx("button",{type:"button",onClick:()=>o(u),className:`px-4 py-2 rounded-lg font-medium transition ${r.days.includes(u)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:u},u))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:r.nextDate,onChange:u=>h({...r,nextDate:u.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>l(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})}function Es(){const[t,c]=a.useState([]),[g,f]=a.useState(!1),[n,l]=a.useState(null),[r,h]=a.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});a.useEffect(()=>{x()},[]);const x=async()=>{try{const o=await Be.getAll();c(o)}catch(o){console.error("Failed to load discounts:",o)}},i=async o=>{o.preventDefault();try{n?await Be.update(n.id,r):await Be.create(r),f(!1),l(null),h({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),x()}catch(U){console.error("Failed to save discount:",U)}},p=async o=>{if(confirm("Delete this discount?"))try{await Be.delete(o),x()}catch(U){console.error("Failed to delete discount:",U)}},j=o=>{const U=new Date,u=new Date(o.validFrom),y=new Date(o.validTo);return o.active&&u<=U&&y>=U};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{f(!0),l(null),h({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(o=>e.jsxs("div",{className:`card ${j(o)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${j(o)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(it,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:o.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[o.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${j(o)?"badge-success":"bg-gray-200 text-gray-600"}`,children:j(o)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(o.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(o.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{l(o),h(o),f(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(Te,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>p(o.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(me,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},o.id)),t.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(it,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:r.name,onChange:o=>h({...r,name:o.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:r.percentage,onChange:o=>h({...r,percentage:parseFloat(o.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:r.validFrom,onChange:o=>h({...r,validFrom:o.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:r.validTo,onChange:o=>h({...r,validTo:o.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.active,onChange:o=>h({...r,active:o.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>f(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ls(){const[t,c]=a.useState([]),[g,f]=a.useState([]),[n,l]=a.useState("all");a.useEffect(()=>{r(),h()},[]);const r=async()=>{try{const u=await lt.getAll();c(u)}catch(u){console.error("Failed to load credit requests:",u)}},h=async()=>{try{const u=await oe.getAll();f(u)}catch(u){console.error("Failed to load products:",u)}},x=async u=>{try{await lt.approve(u),r()}catch(y){console.error("Failed to approve request:",y)}},i=async u=>{try{await lt.reject(u),r()}catch(y){console.error("Failed to reject request:",y)}},p=u=>{const y=g.find(v=>v.id===u);return y?y.name:"Unknown Product"},j=t.filter(u=>n==="all"?!0:u.status===n),o=u=>{switch(u){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},U=u=>{switch(u){case"pending":return e.jsx(ye,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(Se,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(ct,{className:"w-6 h-6 text-red-600"});default:return e.jsx(Je,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(u=>e.jsx("button",{onClick:()=>l(u),className:`px-4 py-2 rounded-lg font-medium transition ${n===u?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:u.charAt(0).toUpperCase()+u.slice(1)},u))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[j.map(u=>e.jsx("div",{className:`card border-l-4 ${o(u.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${u.status==="pending"?"bg-orange-600":u.status==="approved"?"bg-green-600":"bg-red-600"}`,children:U(u.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:u.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:p(u.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:u.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",u.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(u.createdAt).toLocaleString()]}),u.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(u.approvedAt).toLocaleString()]})]})]}),u.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>x(u.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Se,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>i(u.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(ct,{size:16}),"Reject"]})]}),u.status!=="pending"&&e.jsx("span",{className:`badge ${u.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:u.status.toUpperCase()})]})},u.id)),j.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(Je,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",n!=="all"?n:""," credit requests found."]})]})]})]})}function Mt({onClose:t}){const[c,g]=a.useState([]),[f,n]=a.useState(!0);a.useEffect(()=>{l()},[]);const l=async()=>{try{const h=localStorage.getItem("token"),x=await fetch(`${Y}/reminders/today`,{headers:{Authorization:`Bearer ${h}`}});if(!x.ok){console.error("API Error:",x.status,x.statusText),g([]);return}const i=await x.json();Array.isArray(i)?g(i):(console.error("Expected array but got:",typeof i,i),g([]))}catch(h){console.error("Failed to fetch reminders:",h),g([])}finally{n(!1)}},r=async h=>{try{const x=localStorage.getItem("token");await fetch(`${Y}/reminders/${h}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify({status:"fulfilled"})}),l()}catch(x){console.error("Failed to update reminder:",x)}};return f?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:t,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx($e,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ze,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):c.map(h=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:h.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",h.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:h.frequency})]}),e.jsxs("button",{onClick:()=>r(h.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Se,{size:18}),"Mark Done"]})]},h.id))})]})})}function qt({onUnlock:t,userType:c="user"}){const[g,f]=a.useState(""),[n,l]=a.useState(""),[r,h]=a.useState("password"),[x,i]=a.useState(!1),[p,j]=a.useState(""),[o,U]=a.useState(!1),[u,y]=a.useState("2005"),v=JSON.parse(localStorage.getItem("user")||"{}");a.useEffect(()=>{(async()=>{try{const P=await Le.get();P?.screenLockPassword&&y(P.screenLockPassword)}catch(P){console.warn("Failed to load settings, using default password:",P)}})()},[]),a.useEffect(()=>{const I=document.getElementById(r==="password"?"unlock-password":"unlock-pin");I&&I.focus()},[r]);const w=async I=>{I.preventDefault(),I.stopPropagation(),U(!0),j("");try{if(r==="password")if(g===u)t();else throw new Error("Incorrect password");else if(r==="pin"&&v.pin)if(n===v.pin)t();else throw new Error("Incorrect PIN");else throw new Error(`Please enter a valid ${r}`)}catch(P){j(P.message||"Unlock failed")}finally{U(!1)}},k=I=>{const P=I.replace(/\D/g,"").slice(0,4);l(P)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:I=>I.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8",onClick:I=>I.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${c==="main_admin"?"bg-gradient-to-br from-red-600 to-orange-600":"bg-gradient-to-br from-blue-600 to-purple-600"}`,children:e.jsx(ie,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-gray-600",children:c==="main_admin"?"Main Admin":v.name||"User"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Enter your ",r," to continue"]})]}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[c!=="main_admin"&&v.pin&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unlock Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{h("password"),j("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${r==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ”‘ Password"}),e.jsx("button",{type:"button",onClick:()=>{h("pin"),j("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${r==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ“± PIN"})]})]}),(r==="password"||c==="main_admin")&&e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-password",type:x?"text":"password",placeholder:"Enter your password",className:"w-full pl-10 pr-12 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",value:g,onChange:I=>f(I.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>i(!x),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:x?e.jsx(Tt,{className:"w-5 h-5"}):e.jsx(mt,{className:"w-5 h-5"})})]}),r==="pin"&&c!=="main_admin"&&e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-pin",type:"text",placeholder:"Enter 4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-center text-2xl tracking-widest",value:n,onChange:I=>k(I.target.value),maxLength:4,required:!0})]}),p&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg border border-red-200",children:p}),e.jsx("button",{type:"submit",disabled:o||r==="pin"&&n.length!==4,className:`w-full py-3 rounded-lg font-bold transition-all disabled:opacity-50 disabled:cursor-not-allowed ${c==="main_admin"?"bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white":"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white"}`,children:o?"Unlocking...":"Unlock Screen"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Screen locked due to inactivity for security"})})]})})}function Bt(t=6e4){const[c,g]=a.useState(!1),[f,n]=a.useState(Date.now()),l=a.useCallback(()=>{n(Date.now()),c&&g(!1)},[c]),r=a.useCallback(()=>{g(!1),l()},[l]);return a.useEffect(()=>{const h=["mousedown","mousemove","keypress","scroll","touchstart","click"],x=()=>{l()};h.forEach(p=>{document.addEventListener(p,x,!0)});const i=setInterval(()=>{Date.now()-f>t&&!c&&g(!0)},1e3);return()=>{h.forEach(p=>{document.removeEventListener(p,x,!0)}),clearInterval(i)}},[f,t,c,l]),[c,r,l]}function Us(){const{user:t,logout:c,isCashierUserManagementEnabled:g}=pe(),f=Ne(),n=xt(),[l,r]=a.useState(!0),[h,x]=a.useState(!1),[i,p]=a.useState({}),[j,o]=Bt(45e3);a.useEffect(()=>{const w=()=>{const I=localStorage.getItem("user");if(I){const P=JSON.parse(I);let _=!1;(P.plan==="ultra"||P.role==="admin")&&(P.active||(P.active=!0,_=!0),P.plan==="ultra"&&P.role!=="admin"&&(P.role="admin",_=!0),P.plan==="ultra"&&(!P.price||P.price!==1600)&&(P.price=1600,_=!0),_&&(localStorage.setItem("user",JSON.stringify(P)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};w(),setTimeout(w,100);const k=setTimeout(()=>{x(!0)},1e3);return U(),()=>clearTimeout(k)},[]);const U=async()=>{try{const w=await Le.get();p(w)}catch(w){console.error("Failed to load settings:",w)}},u=async()=>{if(window.confirm("Are you sure you want to clear all sales and data? This action cannot be undone."))try{const w=localStorage.getItem("token");await fetch(`${Y}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${w}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})}),alert("Data cleared successfully!"),window.location.reload()}catch(w){console.error("Failed to clear data:",w),alert("Failed to clear data")}},y=[{id:"overview",label:"Dashboard",icon:Zt,path:"/admin"},{id:"sales",label:"Sales",icon:kt,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:Ue,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:It,path:"/admin/recipes"},{id:"expenses",label:"Expenses",icon:Ke,path:"/admin/expenses"},...g()?[{id:"users",label:"Users",icon:fe,path:"/admin/users"}]:[],{id:"time",label:"Time Tracking",icon:ye,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:ut,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:je,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:it,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:Je,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:ot,path:"/admin/settings"}],v=w=>w==="/admin"?n.pathname==="/admin":n.pathname.startsWith(w);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${l?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[l&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>r(!l),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:l?e.jsx($e,{className:"w-5 h-5"}):e.jsx(Xt,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:y.map(w=>{const k=w.icon;return e.jsxs("button",{onClick:()=>f(w.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${v(w.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(k,{className:"w-5 h-5 flex-shrink-0"}),l&&e.jsx("span",{className:"font-medium",children:w.label})]},w.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(es,{className:"w-5 h-5 flex-shrink-0"}),l&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:c,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(Qe,{className:"w-5 h-5 flex-shrink-0"}),l&&e.jsx("span",{className:"font-medium",children:"Logout"})]}),e.jsxs("button",{onClick:u,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors",children:[e.jsx($e,{className:"w-5 h-5 flex-shrink-0"}),l&&e.jsx("span",{className:"font-medium",children:"Clear Data"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:y.find(w=>v(w.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:t?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(St,{children:[e.jsx(G,{path:"/",element:e.jsx(ys,{})}),e.jsx(G,{path:"/sales",element:e.jsx(ks,{})}),e.jsx(G,{path:"/inventory",element:e.jsx(ws,{})}),e.jsx(G,{path:"/recipes",element:e.jsx(Ss,{})}),e.jsx(G,{path:"/expenses",element:e.jsx(Cs,{})}),e.jsx(G,{path:"/reminders",element:e.jsx(Ds,{})}),e.jsx(G,{path:"/service-fees",element:e.jsx(Is,{})}),e.jsx(G,{path:"/discounts",element:e.jsx(Es,{})}),e.jsx(G,{path:"/credit-requests",element:e.jsx(Ls,{})}),e.jsx(G,{path:"/users",element:e.jsx(Ps,{})}),e.jsx(G,{path:"/time",element:e.jsx(As,{})}),e.jsx(G,{path:"/settings",element:e.jsx(Ts,{})})]})})]}),h&&e.jsx(Mt,{onClose:()=>x(!1)}),j&&e.jsx(qt,{onUnlock:o,logo:i.logo})]})}function $s(){const t=Ne(),[c,g]=a.useState(!1),[f,n]=a.useState(0),l=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 900) or Ultra (KSH 1,600) package",image:"ðŸ“",details:"First user becomes Admin automatically. Choose Ultra for full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],r=[{icon:Ue,title:"Smart Inventory",desc:"Track raw materials & composite products with automatic stock deduction"},{icon:It,title:"Recipe Builder",desc:"Create bundled products with BOM and auto-calculate COGS"},{icon:Ee,title:"Real-time Analytics",desc:"Monitor sales, profit margins, and expenses in real-time"},{icon:fe,title:"User Management",desc:"Add cashiers with custom permissions and role-based access"},{icon:ke,title:"Secure & Reliable",desc:"JWT authentication with role-based security"},{icon:dt,title:"Advanced Reports",desc:"Daily, weekly summaries with profit/loss tracking"}],h=[{name:"Basic",price:900,icon:pt,popular:!1,features:["Cashier Dashboard","Basic Inventory","Sales Tracking","Daily/Weekly Reports","Single User","Email Support"]},{name:"Ultra",price:1600,icon:gt,popular:!0,features:["Admin + Cashier Dashboard","Full Inventory Management","Recipe/BOM Builder","Auto Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Unlimited Users","Priority Support"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/auth/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(ts,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(Me,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>g(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(Dt,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 30-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(dt,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:r.map((x,i)=>{const p=x.icon;return e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(p,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:x.title}),e.jsx("p",{className:"text-gray-600",children:x.desc})]},i)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:h.map((x,i)=>{const p=x.icon;return e.jsxs("div",{className:`relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${x.popular?"ring-4 ring-blue-600":""}`,children:[x.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${x.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(p,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:x.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",x.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:x.features.map((j,o)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:j})]},o))}),e.jsx("button",{onClick:()=>t("/plans"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${x.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},i)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(Me,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{g(!1),n(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx($e,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",f+1," of ",l.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((f+1)/l.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(f+1)/l.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:l[f].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:l[f].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:l[f].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:l[f].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>n(Math.max(0,f-1)),disabled:f===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),f<l.length-1?e.jsxs("button",{onClick:()=>n(f+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(Me,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{g(!1),n(0),t("/plans")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(Me,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:l.map((x,i)=>e.jsx("button",{onClick:()=>n(i),className:`w-2 h-2 rounded-full transition-all ${i===f?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},i))})]})]})})]})}function wt(){const t=xt(),[c,g]=a.useState(t.pathname==="/auth/login"),[f,n]=a.useState("password"),[l,r]=a.useState({email:"",password:"",pin:"",name:"",newPassword:"",confirmPassword:""}),[h,x]=a.useState(""),[i,p]=a.useState(!1),[j,o]=a.useState(!1),U=Ne(),{login:u}=pe(),y=()=>{try{return JSON.parse(localStorage.getItem("selectedPlan")||"null")}catch(w){return console.warn("Invalid selectedPlan in localStorage:",w),null}},v=async w=>{w.preventDefault(),x(""),p(!0);try{if(j){if(l.newPassword!==l.confirmPassword){x("Passwords do not match"),p(!1);return}if(l.newPassword.length<6){x("Password must be at least 6 characters"),p(!1);return}const b=await Pe.login({email:l.email,newPassword:l.newPassword});b.token&&b.user&&(await u(b),U("/dashboard"));return}if(c){if(f==="pin"){if(!l.pin||l.pin.length!==4){x("Please enter a valid 4-digit PIN"),p(!1);return}}else if(!l.password){x("Please enter your password"),p(!1);return}}let k;if(c)if(f==="pin")try{k=await Pe.pinLogin({email:l.email,pin:l.pin})}catch(b){if(b.message.includes("PIN not set"))x("PIN not set for this user. Please use password login.");else if(b.message.includes("Invalid PIN"))x("Invalid PIN. Please try again.");else throw b;p(!1);return}else k=await Pe.login({email:l.email,password:l.password});else{const b=y();k=await Pe.signup({...l,plan:b?.id||"basic"})}if(k.needsPasswordSetup){o(!0),r({...l,email:k.email}),x(""),p(!1);return}if(!k||!k.user||!k.token)throw new Error("Authentication failed. Please try again.");const I={id:Date.now(),type:c?"login":"signup",user:{id:k.user.id,name:k.user.name,email:k.user.email,role:k.user.role,plan:k.user.plan},timestamp:new Date().toISOString(),ip:"Unknown",userAgent:navigator.userAgent},P=JSON.parse(localStorage.getItem("authActivities")||"[]");P.unshift(I),P.splice(50),localStorage.setItem("authActivities",JSON.stringify(P)),await u(k);const _=c?"logged in":"signed up";console.log(`âœ… User ${k.user.name} ${_} successfully`),k.user.role==="admin"?U("/admin"):k.user.role==="cashier"||k.user.plan==="basic"?U("/dashboard/cashier"):U("/admin")}catch(k){console.error("Authentication error:",k);let I=k.message||"Authentication failed. Please try again.";k.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),I="Invalid credentials. Please try again."),x(I)}finally{p(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:c?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600",children:c?"Login to your account":"Create your account"})]}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[j?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.newPassword,onChange:w=>r({...l,newPassword:w.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.confirmPassword,onChange:w=>r({...l,confirmPassword:w.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!c&&e.jsxs("div",{className:"relative",children:[e.jsx(ht,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.name,onChange:w=>r({...l,name:w.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Et,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.email,onChange:w=>r({...l,email:w.target.value}),required:!0})]}),c&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Login Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n("password"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${f==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Password"}),e.jsx("button",{type:"button",onClick:()=>n("pin"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${f==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"pin"})]})]}),c&&f==="password"&&e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.password,onChange:w=>r({...l,password:w.target.value}),required:!0})]}),c&&f==="pin"&&e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.pin,onChange:w=>r({...l,pin:w.target.value.replace(/\D/g,"").slice(0,4)}),maxLength:4,required:!0})]}),!c&&e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.password,onChange:w=>r({...l,password:w.target.value}),required:!0})]})]}),h&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:h}),e.jsx("button",{type:"submit",disabled:i,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50",children:i?"Please wait...":j?"Set Password":c?"Login":"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{g(!c),x(""),o(!1)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:c?"Don't have an account? Sign up":"Already have an account? Login"})})]})})}function Os(){const[t,c]=a.useState("ultra"),[g,f]=a.useState(!1),[n,l]=a.useState({name:"",email:"",company:""}),r=Ne(),h=[{id:"basic",name:"Basic Package",price:1e3,icon:pt,color:"from-green-500 to-teal-600",features:["Cashier Dashboard Only","Basic Inventory Management","Sales Tracking","Daily/Weekly Sales Summaries","Basic Profit/Loss View","Limited Email Notifications","Record Products Sold","Single User Access"]},{id:"ultra",name:"Ultra Package (Admin + Cashier)",price:2400,icon:gt,color:"from-blue-600 to-purple-600",popular:!0,features:["Admin Dashboard + Cashier POS","Full Inventory Management","Recipe/BOM Builder","Composite Products Support","Automatic Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Advanced Analytics","Unlimited Users"]}],x=async i=>{i.preventDefault();try{await fetch(`${Y}/demo-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),alert("Demo request submitted! Admin will review and contact you."),f(!1),l({name:"",email:"",company:""})}catch(p){console.error("Demo request failed:",p),alert("Failed to submit demo request. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:()=>r("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition",children:[e.jsx(ss,{size:20}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mb-8 md:mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Select the perfect plan for your business needs"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6 md:mb-8",children:h.map(i=>{const p=i.icon;return e.jsxs("div",{onClick:()=>c(i.id),className:`card cursor-pointer transition-all transform hover:scale-105 relative ${t===i.id?"ring-4 ring-blue-600 shadow-2xl bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-xl"}`,children:[i.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 md:mb-4",children:[e.jsx("div",{className:`w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br ${i.color} flex items-center justify-center`,children:e.jsx(p,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:i.name})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("span",{className:"text-3xl md:text-4xl font-bold",children:["KSH ",i.price]}),e.jsx("span",{className:"text-gray-600 text-sm md:text-base",children:"/month"})]}),e.jsx("ul",{className:"space-y-2 md:space-y-3",children:i.features.map((j,o)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(We,{className:"w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs md:text-sm",children:j})]},o))})]},i.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center animate-fade-in",children:[e.jsx("button",{onClick:()=>{console.log("Get Started clicked with plan:",t);const i=h.find(p=>p.id===t);console.log("Selected plan:",i),localStorage.setItem("selectedPlan",JSON.stringify(i)),r("/auth/signup")},className:"btn-primary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all",children:"Get Started"}),e.jsx("button",{onClick:()=>f(!0),className:"btn-secondary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg border-2 border-gray-300 hover:border-gray-400 transition-all",children:"Request Free Demo"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-3 md:mt-4 text-center",children:"Secure payment â€¢ Cancel anytime"}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Free Demo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"We'll contact you to schedule a demo"})]}),e.jsxs("form",{onSubmit:x,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:n.name,onChange:i=>l({...n,name:i.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:n.email,onChange:i=>l({...n,email:i.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:n.company,onChange:i=>l({...n,company:i.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition",children:"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>f(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})})}function Fs(){const{user:t,logout:c}=pe(),[g,f]=a.useState([]),[n,l]=a.useState([]),[r,h]=a.useState([]),[x,i]=a.useState("cash"),[p,j]=a.useState("pos"),[o,U]=a.useState({sales:[],expenses:[],stats:{}}),[u,y]=a.useState(""),[v,w]=a.useState(!1),[k,I]=a.useState(!1),[P,_]=a.useState(null),[b,$]=a.useState({name:"",price:"",cost:"",category:"finished",image:""}),[s,N]=a.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[C,T]=a.useState(!1),[B,te]=a.useState({description:"",amount:"",category:""}),[re,z]=a.useState(""),[se,Z]=a.useState([]),[q,F]=a.useState(null),[V,S]=a.useState("exclusive"),[R,M]=a.useState(!1),[X,Q]=a.useState(null),[de,xe]=a.useState(null);a.useEffect(()=>{he();const d=localStorage.getItem(`cart_${t?.id}`),L=localStorage.getItem(`paymentMethod_${t?.id}`),E=localStorage.getItem(`selectedDiscount_${t?.id}`),O=localStorage.getItem(`taxType_${t?.id}`),J=localStorage.getItem(`clockStatus_${t?.id}`),le=localStorage.getItem(`clockInTime_${t?.id}`);if(d)try{h(JSON.parse(d))}catch(Re){console.warn("Failed to restore cart:",Re)}if(L&&i(L),O&&S(O),E)try{F(JSON.parse(E))}catch{}J==="clocked_in"&&(M(!0),le&&xe(new Date(le))),et()},[t?.id]),a.useEffect(()=>{const d=localStorage.getItem("token");d&&Ye.connect(d,E=>{if(E&&E.allProducts){const O=E.allProducts.filter(J=>J.visibleToCashier!==!1&&!J.expenseOnly);f(O)}E&&E.discounts&&Z(E.discounts),E&&E.sale&&he()}).catch(E=>{console.warn("WebSocket connection failed:",E)});const L=gs(E=>{try{if(!E)return;(E.type==="initial"||E.type==="products_snapshot"||E.type==="product_created"||E.type==="product_updated"||E.type==="product_deleted")&&oe.getAll().then(O=>f(O.filter(J=>J.visibleToCashier!==!1&&!J.expenseOnly))).catch(()=>{})}catch(O){console.error("Product subscription handler error",O)}});return()=>{try{L()}catch{}Ye.disconnect()}},[]),a.useEffect(()=>{(r.length>0||x||V)&&Fe()},[r,x,V,q,t?.id]);const Fe=()=>{localStorage.setItem(`cart_${t?.id}`,JSON.stringify(r)),localStorage.setItem(`paymentMethod_${t?.id}`,x),localStorage.setItem(`taxType_${t?.id}`,V),q&&localStorage.setItem(`selectedDiscount_${t?.id}`,JSON.stringify(q))},Ze=async()=>{try{const d=await fetch(`${Y}/time-entries`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({action:"clock_in"})});if(d.ok){const L=await d.json();Q(L),M(!0);const E=new Date;xe(E),localStorage.setItem(`clockStatus_${t?.id}`,"clocked_in"),localStorage.setItem(`clockInTime_${t?.id}`,E.toISOString()),alert("Clocked in successfully!")}}catch(d){console.error("Clock in failed:",d),alert("Failed to clock in")}},Xe=async()=>{try{const d=await fetch(`${Y}/time-entries`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({action:"clock_out"})});if(d.ok){const L=await d.json();Q(L),M(!1),xe(null),localStorage.removeItem(`clockStatus_${t?.id}`),localStorage.removeItem(`clockInTime_${t?.id}`);const E=Math.floor(L.duration/60),O=L.duration%60;alert(`Clocked out successfully! Total time: ${E}h ${O}m`)}}catch(d){console.error("Clock out failed:",d),alert("Failed to clock out")}},et=async()=>{try{const d=await fetch(`${Y}/time-entries/today`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(d.ok){const E=(await d.json()).find(O=>O.cashierId===t?.id&&O.status==="clocked_in");E&&(Q(E),M(!0),xe(new Date(E.clockInTime)))}}catch(d){console.warn("Failed to check clock status:",d)}},he=async()=>{try{const[d,L,E,O,J]=await Promise.all([oe.getAll(),Oe.getAll(),Ge.getAll(),Ot.get(),Ve.getAll()]);f(d.filter(le=>le.visibleToCashier!==!1&&!le.expenseOnly)),U({sales:L,expenses:E,stats:O}),l(J);try{const le=await fetch(`${Y}/discounts`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(Re=>Re.json());Z(le||[])}catch(le){console.warn("Failed to load discounts:",le)}}catch(d){console.error("Failed to load data:",d)}},tt=(d,L=!0)=>{const E=d.target.files[0];if(E){const O=new FileReader;O.onload=J=>{const le=J.target.result;z(le),L&&$({...b,image:le})},O.readAsDataURL(E)}},Ce=d=>n.filter(E=>E.productId===d&&E.quantity>0).reduce((E,O)=>E+O.quantity,0),st=d=>{const L=Ce(d.id);if(L<=0){alert("Product is out of stock!");return}const E=r.find(J=>J.id===d.id);if((E?E.quantity:0)>=L){alert(`Only ${L} units available in stock!`);return}h(E?r.map(J=>J.id===d.id?{...J,quantity:J.quantity+1}:J):[...r,{...d,quantity:1}])},m=(d,L)=>{g.find(O=>O.id===d);const E=Ce(d);h(r.map(O=>{if(O.id===d){const J=O.quantity+L;return J>E?(alert(`Only ${E} units available!`),O):{...O,quantity:Math.max(1,J)}}return O}).filter(O=>O.quantity>0))},A=d=>{h(r.filter(L=>L.id!==d))},D=r.reduce((d,L)=>d+L.price*L.quantity,0),W=async()=>{if(r.length!==0)try{const d=q?q.type==="percentage"?D*q.value/100:q.value:0,L=D*.16,E=V==="inclusive"?D-d:D-d+L;await Oe.create({items:r.map(O=>({productId:O.id,quantity:O.quantity,price:O.price})),total:E,discount:d,tax:L,taxType:V,paymentMethod:x}),h([]),F(null),S("exclusive"),await he(),alert("Sale completed successfully!")}catch(d){console.error("Checkout failed:",d),alert("Sale failed. Please try again.")}},K=async d=>{d.preventDefault();try{await oe.create({...b,price:parseFloat(b.price),cost:parseFloat(b.cost||0),quantity:0}),$({name:"",price:"",cost:"",category:"finished",image:""}),z(""),w(!1),await he(),alert("Product added successfully!")}catch(L){console.error("Failed to add product:",L),alert("Failed to add product")}},ee=async d=>{d.preventDefault();try{const L=Array.isArray(n)?n:[],O={id:L.length>0?Math.max(...L.map(J=>J.id||0))+1:1,productId:P.id,quantity:parseInt(s.quantity),expiryDate:s.expiryDate,batchNumber:s.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(s.cost||P.cost||0)};l(J=>[...J,O]),await Ve.create({productId:P.id,quantity:parseInt(s.quantity),expiryDate:s.expiryDate,batchNumber:s.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(s.cost||P.cost||0)}),N({quantity:"",expiryDate:"",batchNumber:"",cost:""}),I(!1),_(null),await he(),alert("Stock added successfully!")}catch(L){console.error("Failed to add stock:",L),alert("Failed to add stock")}},ge=async d=>{d.preventDefault();try{await Ge.create({...B,amount:parseFloat(B.amount)}),te({description:"",amount:"",category:""}),T(!1),await he()}catch(L){console.error("Failed to add expense:",L),alert("Failed to add expense")}},ue=async()=>{if(window.confirm("Are you sure you want to clear all sales and data? This action cannot be undone."))try{const d=localStorage.getItem("token");await fetch(`${Y}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})}).catch(()=>{}),U({sales:[],expenses:[],stats:{totalSales:0,totalExpenses:0,profit:0}}),h([]),alert("Data cleared successfully!"),await he()}catch(d){console.error("Failed to clear data:",d),alert("Failed to clear data")}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Cashier Dashboard"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cashier Plan - KSH 900/month"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),R&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-green-600 font-semibold",children:"ðŸŸ¢ Clocked In"}),e.jsxs("button",{onClick:Xe,className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-600 hover:bg-red-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(as,{className:"w-4 h-4"}),"Clock Out"]})]}),!R&&e.jsxs("button",{onClick:Ze,className:"px-4 py-2 rounded-lg font-medium transition-all bg-green-600 hover:bg-green-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(Dt,{className:"w-4 h-4"}),"Clock In"]}),e.jsxs("button",{onClick:()=>{Fe(),c()},className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-100 hover:bg-red-200 text-red-600 border border-red-300 flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Logout"]}),e.jsxs("button",{onClick:ue,className:"px-4 py-2 rounded-lg font-medium transition-all bg-orange-100 hover:bg-orange-200 text-orange-600 border border-orange-300 flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),"Clear"]}),R&&de&&e.jsx("div",{className:"ml-auto text-right text-xs",children:e.jsxs("p",{className:"text-green-600 font-semibold flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),"Clocked In: ",de.toLocaleTimeString()]})})]})]})}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>j("pos"),className:`px-6 py-2 rounded-lg font-medium transition-all ${p==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(_e,{className:"w-4 h-4 inline mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>j("monitor"),className:`px-6 py-2 rounded-lg font-medium transition-all ${p==="monitor"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(dt,{className:"w-4 h-4 inline mr-2"}),"Monitor"]}),e.jsxs("button",{onClick:()=>j("products"),className:`px-6 py-2 rounded-lg font-medium transition-all ${p==="products"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ue,{className:"w-4 h-4 inline mr-2"}),"Products"]}),e.jsxs("button",{onClick:()=>j("expenses"),className:`px-6 py-2 rounded-lg font-medium transition-all ${p==="expenses"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ke,{className:"w-4 h-4 inline mr-2"}),"Expenses"]})]}),p==="pos"&&e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(Ct,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:u,onChange:d=>y(d.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:g.filter(d=>d.name?.toLowerCase().includes(u.toLowerCase())).map(d=>{const L=Ce(d.id),E=L<10,O=L<=0;return e.jsxs("button",{onClick:()=>st(d),disabled:O,className:`card text-left hover:shadow-xl transition-all transform hover:scale-105 relative ${O?"opacity-50 cursor-not-allowed bg-gray-100":"bg-gradient-to-br from-white to-gray-50"}`,children:[d.image&&e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:d.image,alt:d.name,className:"w-full h-full object-cover"})}),E&&!O&&e.jsx("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white p-1 rounded-full",children:e.jsx(Ae,{className:"w-4 h-4"})}),O&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"OUT"}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-900",children:d.name}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["KSH ",d.price?.toLocaleString()]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:`text-xs font-medium ${O?"text-red-600":E?"text-yellow-600":"text-gray-500"}`,children:["Stock: ",L]}),E&&!O&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium",children:"Low Stock"})]})]},d.id)})})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-gray-200 p-6 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(_e,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[r.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:r.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(_e,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:r.map(d=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:d.name}),e.jsx("button",{onClick:()=>A(d.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(me,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>m(d.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(rs,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-semibold",children:d.quantity}),e.jsx("button",{onClick:()=>m(d.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(ce,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(d.price*d.quantity).toLocaleString()]})]})]},d.id))})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"text-gray-700",children:["KSH ",D.toLocaleString()]})]}),q&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-KSH ",(q.type==="percentage"?D*q.value/100:q.value).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-orange-600",children:[e.jsxs("span",{children:["Tax (",V==="exclusive"?"Added":"Included","):"]}),e.jsxs("span",{children:[V==="exclusive"?"+":"","KSH ",((D-(q?q.type==="percentage"?D*q.value/100:q.value:0))*.16).toLocaleString()]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Final Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(V==="exclusive"?D-(q?q.type==="percentage"?D*q.value/100:q.value:0)+(D-(q?q.type==="percentage"?D*q.value/100:q.value:0))*.16:D-(q?q.type==="percentage"?D*q.value/100:q.value:0)).toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Discount (Optional)"}),e.jsxs("select",{value:q?.id||"",onChange:d=>{d.target.value?F(se.find(L=>L.id===parseInt(d.target.value))):F(null)},className:"input",children:[e.jsx("option",{value:"",children:"No Discount"}),se.filter(d=>d.active).map(d=>e.jsxs("option",{value:d.id,children:[d.name," - ",d.type==="percentage"?`${d.value}%`:`KSH ${d.value}`]},d.id))]}),q&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Discount: KSH ",(q.type==="percentage"?D*q.value/100:q.value).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tax Type"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"exclusive",checked:V==="exclusive",onChange:d=>S(d.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Exclusive (16% added)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"inclusive",checked:V==="inclusive",onChange:d=>S(d.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Inclusive"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:x,onChange:d=>i(d.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:W,disabled:r.length===0,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg",children:"Complete Sale"})]})]})]}),p==="monitor"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",o.stats.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(je,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",o.stats.totalExpenses?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Ke,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",o.stats.profit?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(je,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Sales"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"})]})}),e.jsx("tbody",{children:o.sales.slice(-15).reverse().map((d,L)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(d.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[d.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:d.paymentMethod||"cash"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",d.total?.toLocaleString()]})]},L))})]})})]})]}),p==="products"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Manage Products & Stock"}),e.jsxs("button",{onClick:()=>w(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700",children:[e.jsx(ce,{className:"w-4 h-4"}),"Add Product"]})]}),v&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl border-2 border-green-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Product"}),e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:b.name,onChange:d=>$({...b,name:d.target.value}),required:!0}),e.jsxs("select",{className:"input",value:b.category,onChange:d=>$({...b,category:d.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsx("input",{type:"number",placeholder:"Selling Price",className:"input",value:b.price,onChange:d=>$({...b,price:d.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Cost Price (Optional)",className:"input",value:b.cost,onChange:d=>$({...b,cost:d.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:d=>tt(d,!0),className:"input"}),e.jsx(Pt,{className:"w-5 h-5 text-gray-400"})]}),re&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:re,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{w(!1),z(""),$({name:"",price:"",cost:"",category:"finished",image:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),k&&P&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"font-semibold mb-4 text-lg",children:["Add Stock for ",P.name]}),e.jsxs("form",{onSubmit:ee,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:s.quantity,onChange:d=>N({...s,quantity:d.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:s.expiryDate,onChange:d=>N({...s,expiryDate:d.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:s.batchNumber,onChange:d=>N({...s,batchNumber:d.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per Unit",className:"input",value:s.cost,onChange:d=>N({...s,cost:d.target.value})}),e.jsxs("div",{className:"flex gap-2 md:col-span-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{I(!1),_(null),N({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:g.map(d=>{const L=Ce(d.id),E=n.filter(J=>J.productId===d.id&&J.quantity>0),O=L<10;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[d.image&&e.jsx("img",{src:d.image,alt:d.name,className:"w-10 h-10 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:d.name}),e.jsx("div",{className:"text-xs text-gray-500",children:d.category})]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",d.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium ${L===0?"text-red-600":O?"text-yellow-600":"text-gray-900"}`,children:L}),O&&L>0&&e.jsx(Ae,{className:"w-4 h-4 text-yellow-500"}),L===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"text-gray-600",children:[E.length," active"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{_(d),I(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-green-50 rounded-lg text-green-600 transition-colors",title:"Edit Product",children:e.jsx(Te,{className:"w-4 h-4"})})]})})]},d.id)})})]})})]})}),p==="expenses"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Track Expenses"}),e.jsxs("button",{onClick:()=>T(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700",children:[e.jsx(ce,{className:"w-4 h-4"}),"Add Expense"]})]}),C&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border-2 border-red-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Expense"}),e.jsxs("form",{onSubmit:ge,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:B.description,onChange:d=>te({...B,description:d.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Amount",className:"input",value:B.amount,onChange:d=>te({...B,amount:d.target.value}),required:!0}),e.jsx("input",{type:"text",placeholder:"Category",className:"input",value:B.category,onChange:d=>te({...B,category:d.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>T(!1),className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:o.expenses.slice().reverse().map((d,L)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(d.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:d.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:d.category||"General"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",d.amount?.toLocaleString()]})]},L))})]})})]})})]})}function Rs(){const[t,c]=a.useState({email:"",password:""}),[g,f]=a.useState(!1),[n,l]=a.useState(""),[r,h]=a.useState(!1),x=Ne();xt(),a.useEffect(()=>{const p=localStorage.getItem("ownerToken"),j=localStorage.getItem("ownerUser");if(p&&j)try{const o=JSON.parse(j);if(o.type==="main_admin"||o.type==="owner"){x("/main.admin/dashboard");return}}catch{localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser")}},[x]);const i=async p=>{p.preventDefault(),f(!0),l("");try{const j=await be.login(t);if(j.token&&j.user&&j.user.role==="owner")localStorage.setItem("ownerToken",j.token),localStorage.setItem("ownerUser",JSON.stringify(j.user)),x("/main.admin/dashboard");else throw new Error("Invalid response from server or insufficient permissions")}catch(j){console.error("Owner login error:",j),l(j.message||"Access denied. Owner access only.")}finally{f(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-black/50 backdrop-blur-lg rounded-2xl shadow-2xl max-w-md w-full p-8 border border-red-500/30",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-red-600 to-black rounded-2xl mx-auto mb-4 flex items-center justify-center border border-red-500/50",children:e.jsx(ke,{className:"w-8 h-8 text-red-400"})}),e.jsx("h1",{className:"text-3xl font-bold text-red-400 mb-2",children:"MAIN.ADMIN"}),e.jsx("p",{className:"text-gray-400",children:"System Owner Access"}),e.jsx("div",{className:"mt-2 text-xs text-red-500 bg-red-500/10 px-3 py-1 rounded border border-red-500/30",children:"ðŸ”’ ianmabruk3@gmail.com only"})]}),e.jsxs("form",{onSubmit:i,className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Et,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),e.jsx("input",{type:"email",placeholder:"Owner Email",className:"w-full pl-10 pr-4 py-3 bg-black/30 border border-red-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",value:t.email,onChange:p=>c({...t,email:p.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),e.jsx("input",{type:r?"text":"password",placeholder:"Owner Password",className:"w-full pl-10 pr-12 py-3 bg-black/30 border border-red-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",value:t.password,onChange:p=>c({...t,password:p.target.value}),required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!r),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-400",children:r?e.jsx(Tt,{className:"w-5 h-5"}):e.jsx(mt,{className:"w-5 h-5"})})]}),n&&e.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm bg-red-500/10 p-3 rounded-lg border border-red-500/30",children:[e.jsx(ze,{className:"w-4 h-4"}),n]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full bg-gradient-to-r from-red-600 to-red-800 text-white py-3 rounded-lg font-bold hover:from-red-700 hover:to-red-900 transition-all disabled:opacity-50 disabled:cursor-not-allowed border border-red-500/50",children:g?"Authenticating...":"ACCESS SYSTEM"})]}),e.jsx("div",{className:"mt-8 p-4 bg-red-500/10 border border-red-500/30 rounded-lg",children:e.jsx("p",{className:"text-red-300 text-xs text-center",children:"âš ï¸ Restricted to system owner only"})})]})})}function Ms(){const[t,c]=a.useState([]),[g,f]=a.useState([]),[n,l]=a.useState({}),[r,h]=a.useState(!0),[x,i]=a.useState("overview"),[p,j]=a.useState(null),[o,U]=a.useState(null),[u,y]=a.useState(!1),[v,w]=a.useState([]),k=Ne();a.useEffect(()=>{const s=localStorage.getItem("ownerToken"),N=localStorage.getItem("ownerUser");if(!s||!N){k("/main.admin");return}try{const C=JSON.parse(N);if(C.type!=="main_admin"&&C.type!=="owner"||C.email!=="ianmabruk3@gmail.com"){k("/main.admin");return}}catch{k("/main.admin");return}I()},[k]);const I=async()=>{try{h(!0);const[s,N,C]=await Promise.all([be.getUsers(),be.getStats(),be.getActivities()]);c(s),l(N),f(C);try{const T=localStorage.getItem("ownerToken"),B=await fetch(`${Y}/time-entries/today`,{headers:{Authorization:`Bearer ${T}`}});if(B.ok){const te=await B.json();w(te)}}catch(T){console.warn("Failed to load time entries:",T)}}catch(s){console.error("Failed to load data:",s)}finally{h(!1)}},P=async(s,N)=>{try{j(`lock-${s}`);const C=!N;await be.lockUser(s,C),c(t.map(T=>T.id===s?{...T,locked:C,active:!C}:T)),setTimeout(I,1e3)}catch(C){console.error("Failed to toggle lock:",C),alert("Failed to update user status")}finally{j(null)}},_=async(s,N)=>{try{j(`plan-${s}`),await be.changePlan(s,N),c(t.map(C=>C.id===s?{...C,plan:N,price:N==="ultra"?2400:N==="basic"?1e3:0}:C)),y(!1),U(null),setTimeout(I,1e3)}catch(C){console.error("Failed to change plan:",C),alert("Failed to change user plan")}finally{j(null)}},b=async s=>{const N=s==="all"?"Are you sure you want to clear ALL system data? This will remove all sales, expenses, and products from ALL users. This cannot be undone.":`Are you sure you want to clear ${s} data from ALL users? This cannot be undone.`;if(confirm(N))try{j(`clear-${s}`),await be.clearData(s),alert(`${s.charAt(0).toUpperCase()+s.slice(1)} data cleared successfully`),I()}catch(C){console.error("Clear data failed:",C),alert("Failed to clear data")}finally{j(null)}},$=()=>{localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser"),k("/main.admin")};return r?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-red-400 text-xl",children:"Loading System Control..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black",children:[e.jsx("header",{className:"bg-black/50 backdrop-blur-lg border-b border-red-500/30 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ke,{className:"w-8 h-8 text-red-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-red-400",children:"MAIN.ADMIN"}),e.jsx("p",{className:"text-gray-400",children:"Ian Mabruk - System Owner"})]})]}),e.jsxs("button",{onClick:$,className:"flex items-center gap-2 bg-red-600/20 hover:bg-red-600/30 text-red-300 px-4 py-2 rounded-lg transition-colors border border-red-500/30",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Logout"]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(fe,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:n.totalUsers||0})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Users"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Se,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:n.activeUsers||0})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Active Users"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(we,{className:"w-8 h-8 text-yellow-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:n.trialUsers||0})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Free Trials"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(je,{className:"w-8 h-8 text-green-400"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:["KSH ",(n.mrr||0).toLocaleString()]})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Monthly Revenue"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(at,{className:"w-8 h-8 text-purple-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:(n.totalSignups||0)+(n.totalLogins||0)})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Activities"})]})]}),e.jsx("div",{className:"flex gap-4 mb-6 overflow-x-auto",children:[{id:"overview",label:"Overview",icon:Ee},{id:"users",label:`Users (${t.length})`,icon:fe},{id:"activities",label:`Activities (${g.length})`,icon:at},{id:"time-entries",label:`Time Tracking (${v.length})`,icon:ye},{id:"system",label:"System Control",icon:ot}].map(s=>{const N=s.icon;return e.jsxs("button",{onClick:()=>i(s.id),className:`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all whitespace-nowrap ${x===s.id?"bg-red-600 text-white":"bg-black/30 text-gray-300 hover:bg-black/50"}`,children:[e.jsx(N,{className:"w-4 h-4"}),s.label]},s.id)})}),x==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Plan Distribution"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-300 font-semibold",children:"Free Trial"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:n.planDistribution?.trial||0})]}),e.jsx(we,{className:"w-8 h-8 text-yellow-400"})]})}),e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-300 font-semibold",children:"Basic Plan"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:n.planDistribution?.basic||0})]}),e.jsx(nt,{className:"w-8 h-8 text-blue-400"})]})}),e.jsx("div",{className:"bg-purple-500/10 border border-purple-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-300 font-semibold",children:"Ultra Plan"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:n.planDistribution?.ultra||0})]}),e.jsx(gt,{className:"w-8 h-8 text-purple-400"})]})})]})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Recent Activity Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"User Activity"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Signups:"}),e.jsx("span",{className:"text-green-400",children:n.totalSignups||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Logins:"}),e.jsx("span",{className:"text-blue-400",children:n.totalLogins||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Recent Signups (7d):"}),e.jsx("span",{className:"text-yellow-400",children:n.recentSignups||0})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"System Health"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Active Users:"}),e.jsx("span",{className:"text-green-400",children:n.activeUsers||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Locked Users:"}),e.jsx("span",{className:"text-red-400",children:n.lockedUsers||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Revenue:"}),e.jsxs("span",{className:"text-green-400",children:["KSH ",(n.totalRevenue||0).toLocaleString()]})]})]})]})]})]})]}),x==="users"&&e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl border border-red-500/30 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"User Management"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Manage all system users, plans, and access control"})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User Details"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan & Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Trial Info"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Account Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Actions"})]})}),e.jsx("tbody",{children:t.map(s=>{const N=s.isFreeTrial,C=s.createdAt?new Date(s.createdAt).toLocaleDateString():"Unknown";return e.jsxs("tr",{className:"border-t border-red-500/20 hover:bg-black/20 transition",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:s.name}),e.jsx("p",{className:"text-sm text-gray-400",children:s.email}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",s.id," | Role: ",s.role]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Created: ",C]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-1",children:[N?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-yellow-500/20 text-yellow-300 flex items-center gap-1 w-fit",children:[e.jsx(we,{className:"w-3 h-3"}),"FREE TRIAL"]}):e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${s.plan==="ultra"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"}`,children:s.plan?.toUpperCase()}),s.price&&e.jsxs("p",{className:"text-xs text-gray-400",children:["KSH ",s.price,"/month"]})]})}),e.jsx("td",{className:"px-4 py-4",children:N?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("span",{className:"px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-300",children:[s.trialDaysLeft||0," days left"]}),s.trialDaysLeft<=7&&e.jsx("p",{className:"text-xs text-red-400",children:"âš ï¸ Expiring soon"})]}):e.jsx("span",{className:"text-xs text-gray-500",children:"Paid Plan"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-1",children:[s.locked?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-300 flex items-center gap-1 w-fit",children:[e.jsx(ie,{className:"w-3 h-3"}),"Locked"]}):s.active?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-300 flex items-center gap-1 w-fit",children:[e.jsx(Se,{className:"w-3 h-3"}),"Active"]}):e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-500/20 text-gray-300 w-fit",children:"Inactive"}),s.pin&&e.jsx("p",{className:"text-xs text-blue-400",children:"PIN Set"})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>P(s.id,s.locked),disabled:p===`lock-${s.id}`,className:`p-2 rounded-lg transition ${s.locked?"bg-green-500/20 hover:bg-green-500/30 text-green-300":"bg-red-500/20 hover:bg-red-500/30 text-red-300"} ${p===`lock-${s.id}`?"opacity-50 cursor-not-allowed":""}`,title:s.locked?"Unlock User":"Lock User",children:p===`lock-${s.id}`?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):s.locked?e.jsx(Lt,{className:"w-4 h-4"}):e.jsx(ie,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{U(s),y(!0)},disabled:p===`plan-${s.id}`,className:"p-2 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 transition",title:"Change Plan",children:p===`plan-${s.id}`?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(ls,{className:"w-4 h-4"})})]})})]},s.id)})})]}),t.length===0&&e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx(fe,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No users registered yet"})]})]})]}),x==="activities"&&e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl border border-red-500/30 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"System Activity Log"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"All user activities and admin actions"})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Activity Type"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User Details"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan/Action"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Time"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"IP Address"})]})}),e.jsx("tbody",{children:g.slice(0,100).map(s=>{const N=s.timestamp?new Date(s.timestamp).toLocaleString():"Unknown",C=s.type==="signup",T=s.type==="admin_action";return e.jsxs("tr",{className:"border-t border-red-500/20 hover:bg-black/20 transition",children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${C?"bg-green-500/20 text-green-300":T?"bg-red-500/20 text-red-300":"bg-blue-500/20 text-blue-300"}`,children:C?"SIGNUP":T?"ADMIN":"LOGIN"}),T&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s.action})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:s.name||s.targetUserEmail}),e.jsx("p",{className:"text-sm text-gray-400",children:s.email||s.targetUserEmail}),T&&e.jsxs("p",{className:"text-xs text-red-400",children:["By: ",s.adminEmail]})]})}),e.jsx("td",{className:"px-4 py-4",children:T?e.jsxs("div",{className:"text-xs",children:[s.oldPlan&&s.newPlan&&e.jsxs("span",{className:"text-yellow-400",children:[s.oldPlan," â†’ ",s.newPlan]}),s.action==="user_locked"&&e.jsx("span",{className:"text-red-400",children:"User Locked"}),s.action==="user_unlocked"&&e.jsx("span",{className:"text-green-400",children:"User Unlocked"})]}):e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${s.plan==="ultra"?"bg-purple-500/20 text-purple-300":s.plan==="basic"?"bg-blue-500/20 text-blue-300":"bg-yellow-500/20 text-yellow-300"}`,children:s.plan?.toUpperCase()||"TRIAL"})}),e.jsx("td",{className:"px-4 py-4 text-gray-300 text-sm",children:N}),e.jsx("td",{className:"px-4 py-4 text-gray-400 text-sm",children:s.ipAddress||"Unknown"})]},s.id)})})]}),g.length===0&&e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx(at,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No activity recorded yet"})]})]})]}),x==="time-entries"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(ye,{className:"w-6 h-6 text-yellow-400"}),"Cashier Time Tracking"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-black/50 border-b border-red-500/30",children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Clock In Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Clock Out Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Duration"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-300",children:"Status"})]})}),e.jsx("tbody",{children:v.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-gray-400",children:"No time entries today"})}):v.map((s,N)=>{const C=new Date(s.clockInTime),T=s.clockOutTime?new Date(s.clockOutTime):null,B=s.duration?`${Math.floor(s.duration/60)}h ${s.duration%60}m`:"In Progress";return e.jsxs("tr",{className:"border-b border-red-500/20 hover:bg-red-500/10 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:s.cashierName}),e.jsx("p",{className:"text-gray-400 text-xs",children:s.cashierEmail})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-300",children:C.toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-300",children:T?T.toLocaleString():"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-300",children:B}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="clocked_in"?"bg-green-500/30 text-green-300":"bg-blue-500/30 text-blue-300"}`,children:s.status==="clocked_in"?"Clocked In":"Clocked Out"})})]},N)})})]})}),e.jsxs("div",{className:"mt-6 p-4 bg-red-500/20 rounded-lg border border-red-500/30",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-300 mb-2",children:"Today's Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Total Cashiers"}),e.jsx("p",{className:"text-lg font-bold text-white",children:new Set(v.map(s=>s.cashierId)).size})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Clocked In"}),e.jsx("p",{className:"text-lg font-bold text-green-400",children:v.filter(s=>s.status==="clocked_in").length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Clocked Out"}),e.jsx("p",{className:"text-lg font-bold text-blue-400",children:v.filter(s=>s.status==="clocked_out").length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Total Hours"}),e.jsxs("p",{className:"text-lg font-bold text-yellow-400",children:[Math.floor(v.filter(s=>s.duration).reduce((s,N)=>s+N.duration,0)/60),"h"]})]})]})]})]})}),x==="system"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(ns,{className:"w-6 h-6"}),"System Data Management"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("button",{onClick:()=>b("sales"),disabled:p==="clear-sales",className:"p-4 bg-orange-500/20 hover:bg-orange-500/30 border border-orange-500/30 rounded-lg text-orange-300 transition-colors disabled:opacity-50",children:[p==="clear-sales"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(me,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear Sales"}),e.jsx("p",{className:"text-xs opacity-75",children:"All user sales data"})]}),e.jsxs("button",{onClick:()=>b("expenses"),disabled:p==="clear-expenses",className:"p-4 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded-lg text-red-300 transition-colors disabled:opacity-50",children:[p==="clear-expenses"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(je,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear Expenses"}),e.jsx("p",{className:"text-xs opacity-75",children:"All user expense data"})]}),e.jsxs("button",{onClick:()=>b("products"),disabled:p==="clear-products",className:"p-4 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-500/30 rounded-lg text-blue-300 transition-colors disabled:opacity-50",children:[p==="clear-products"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(At,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear Inventory"}),e.jsx("p",{className:"text-xs opacity-75",children:"All products & batches"})]}),e.jsxs("button",{onClick:()=>b("all"),disabled:p==="clear-all",className:"p-4 bg-red-600/20 hover:bg-red-600/30 border border-red-600/30 rounded-lg text-red-300 transition-colors disabled:opacity-50",children:[p==="clear-all"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(Ae,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear All Data"}),e.jsx("p",{className:"text-xs opacity-75",children:"âš ï¸ Everything except users"})]})]})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(ot,{className:"w-6 h-6"}),"System Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"User Statistics"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Users:"}),e.jsx("span",{className:"text-white",children:t.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Active Users:"}),e.jsx("span",{className:"text-green-400",children:t.filter(s=>s.active&&!s.locked).length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Locked Users:"}),e.jsx("span",{className:"text-red-400",children:t.filter(s=>s.locked).length})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"Plan Distribution"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Basic Plans:"}),e.jsx("span",{className:"text-blue-400",children:t.filter(s=>s.plan==="basic").length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Ultra Plans:"}),e.jsx("span",{className:"text-purple-400",children:t.filter(s=>s.plan==="ultra").length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Free Trials:"}),e.jsx("span",{className:"text-yellow-400",children:t.filter(s=>!s.plan||s.plan==="trial").length})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"Revenue"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Monthly Revenue:"}),e.jsxs("span",{className:"text-green-400",children:["KSH ",(n.mrr||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Revenue:"}),e.jsxs("span",{className:"text-green-400",children:["KSH ",(n.totalRevenue||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Activities:"}),e.jsx("span",{className:"text-blue-400",children:g.length})]})]})]})]})]})]})]}),u&&o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-black/80 backdrop-blur-lg rounded-xl p-6 border border-red-500/30 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Change User Plan"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-gray-300",children:["User: ",e.jsx("span",{className:"text-white font-semibold",children:o.name})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:o.email}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Current Plan: ",e.jsx("span",{className:"text-yellow-400",children:o.plan||"trial"})]})]}),e.jsx("div",{className:"space-y-3 mb-6",children:["trial","basic","ultra"].map(s=>e.jsx("button",{onClick:()=>_(o.id,s),disabled:p===`plan-${o.id}`||o.plan===s,className:`w-full p-3 rounded-lg border transition ${o.plan===s?"bg-gray-500/20 border-gray-500/30 text-gray-400 cursor-not-allowed":s==="trial"?"bg-yellow-500/20 border-yellow-500/30 text-yellow-300 hover:bg-yellow-500/30":s==="basic"?"bg-blue-500/20 border-blue-500/30 text-blue-300 hover:bg-blue-500/30":"bg-purple-500/20 border-purple-500/30 text-purple-300 hover:bg-purple-500/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-semibold",children:[s.charAt(0).toUpperCase()+s.slice(1)," Plan"]}),e.jsx("p",{className:"text-xs opacity-75",children:s==="trial"?"Free - 30 days":s==="basic"?"KSH 1,000/month":"KSH 2,400/month"})]}),o.plan===s&&e.jsx(Se,{className:"w-5 h-5"})]})},s))}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>{y(!1),U(null)},className:"flex-1 px-4 py-2 bg-gray-500/20 border border-gray-500/30 text-gray-300 rounded-lg hover:bg-gray-500/30 transition",children:"Cancel"})})]})})]})}function qs(){const[t,c]=a.useState([]),[g,f]=a.useState("all"),[n,l]=a.useState(""),[r,h]=a.useState(!0),[x,i]=a.useState(null),p=Ne(),[j,o]=a.useState({totalUsers:0,activeUsers:0,freeTrialUsers:0,upgradeExpiredUsers:0,reaching30Days:0,totalRevenue:0});a.useEffect(()=>{const b=localStorage.getItem("mainAdminToken"),$=localStorage.getItem("mainAdminUser");if(!b||!$){p("/main-admin/login");return}U().finally(()=>h(!1))},[p]);const U=async()=>{try{let b=[];try{const $=localStorage.getItem("mainAdminToken"),s=await fetch(`${Y}/api/main-admin/users-with-subscriptions`,{headers:{Authorization:`Bearer ${$}`}});if(s.ok)b=await s.json();else throw new Error("Failed to fetch subscription data")}catch($){console.warn("Subscription API failed, using fallback:",$.message);try{b=await be.getUsers()}catch{b=await ve.getAll()}b=b.map(s=>{const N=new Date(s.createdAt||Date.now()),T=Math.floor((new Date-N)/(1e3*60*60*24)),B=s.plan==="free"||!s.plan,te=T>=30&&B,re=Math.max(0,30-T);return{...s,createdAt:N.toISOString(),daysActive:T,isFreeTrial:B,hasReachedTrialLimit:te,daysUntilExpiry:re,subscriptionStatus:B?te?"trial_expired":"free_trial":"paid",planPrice:s.plan==="ultra"?1600:s.plan==="basic"?900:0,trialExpireDate:new Date(N.getTime()+720*60*60*1e3).toISOString()}})}if(b.length>0&&b[0].daysActive!==void 0)c(b),u(b);else{const $=b.map(s=>{const N=new Date(s.createdAt||Date.now()),T=Math.floor((new Date-N)/(1e3*60*60*24)),B=s.plan==="free"||!s.plan,te=T>=30&&B,re=Math.max(0,30-T);return{...s,createdAt:N.toISOString(),daysActive:T,isFreeTrial:B,hasReachedTrialLimit:te,daysUntilExpiry:re,subscriptionStatus:B?te?"trial_expired":"free_trial":"paid",planPrice:s.plan==="ultra"?1600:s.plan==="basic"?900:0,trialExpireDate:new Date(N.getTime()+2592e6).toISOString()}});c($),u($)}}catch(b){console.error("Failed to load data:",b)}},u=b=>{const $=b.filter(T=>T.isFreeTrial).length,s=b.filter(T=>T.hasReachedTrialLimit).length,N=b.filter(T=>T.daysActive>=25&&T.daysActive<30&&T.isFreeTrial).length,C=b.filter(T=>!T.isFreeTrial&&!T.hasReachedTrialLimit).reduce((T,B)=>T+(B.planPrice||0),0);o({totalUsers:b.length,activeUsers:b.filter(T=>T.active!==!1).length,freeTrialUsers:$,upgradeExpiredUsers:s,reaching30Days:N,totalRevenue:C})},y=b=>b.hasReachedTrialLimit?"bg-red-100 border-red-300":b.daysUntilExpiry<=5&&b.isFreeTrial?"bg-yellow-100 border-yellow-300":b.isFreeTrial?"bg-blue-100 border-blue-300":"bg-green-100 border-green-300",v=b=>b.hasReachedTrialLimit?e.jsx("span",{className:"text-xs bg-red-600 text-white px-2 py-1 rounded-full",children:"Trial Expired"}):b.isFreeTrial?e.jsxs("span",{className:"text-xs bg-blue-600 text-white px-2 py-1 rounded-full",children:["Free Trial - ",b.daysUntilExpiry,"d left"]}):e.jsx("span",{className:"text-xs bg-green-600 text-white px-2 py-1 rounded-full",children:"Active"}),w=async b=>{const $=t.find(s=>s.id===b);if($)try{const s=localStorage.getItem("mainAdminToken");if((await fetch(`${Y}/api/main-admin/send-email`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({userId:b,type:"upgrade"})})).ok)alert(`Upgrade reminder sent to ${$.email}`);else throw new Error("Failed to send email")}catch(s){console.error("Failed to send email:",s),alert("Failed to send email")}},k=async(b,$)=>{try{i(b);const s=localStorage.getItem("mainAdminToken");if((await fetch(`${Y}/api/main-admin/users/${b}/lock`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({locked:!$})})).ok)c(T=>T.map(B=>B.id===b?{...B,locked:!$,active:$}:B)),alert(`User ${$?"unlocked":"locked"} successfully`);else throw new Error("Failed to update user lock status")}catch(s){console.error("Failed to update user lock status:",s),alert("Failed to update user")}finally{i(null)}},I=async b=>{const $=t.find(s=>s.id===b);if($)try{const s=localStorage.getItem("mainAdminToken");if((await fetch(`${Y}/api/main-admin/send-email`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({userId:b,type:"upgrade"})})).ok)alert(`Redirect email sent to ${$.email}`);else throw new Error("Failed to send email")}catch(s){console.error("Failed to send redirect email:",s),alert("Failed to send email")}},P=t.filter(b=>{const $=b.name?.toLowerCase().includes(n.toLowerCase())||b.email?.toLowerCase().includes(n.toLowerCase()),s=g==="all"||g==="free_trial"&&b.isFreeTrial&&!b.hasReachedTrialLimit||g==="trial_expired"&&b.hasReachedTrialLimit||g==="paid"&&!b.isFreeTrial||g==="expiring_soon"&&b.daysUntilExpiry<=5&&b.isFreeTrial;return $&&s}),_=()=>{localStorage.removeItem("mainAdminToken"),localStorage.removeItem("mainAdminUser"),p("/main-admin/login")};return r?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading admin dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Admin Dashboard"}),e.jsx("p",{className:"text-blue-100 mt-1",children:"User Management & Subscription Tracking"})]}),e.jsxs("button",{onClick:_,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Logout"]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:j.totalUsers})]}),e.jsx(fe,{className:"w-8 h-8 text-blue-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Free Trial"}),e.jsx("p",{className:"text-3xl font-bold text-blue-400",children:j.freeTrialUsers})]}),e.jsx(ye,{className:"w-8 h-8 text-blue-400 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Expiring Soon"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:j.reaching30Days})]}),e.jsx(Ae,{className:"w-8 h-8 text-yellow-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Expired"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:j.upgradeExpiredUsers})]}),e.jsx(ct,{className:"w-8 h-8 text-red-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Active"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:j.activeUsers})]}),e.jsx(Se,{className:"w-8 h-8 text-green-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Monthly Revenue"}),e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:["$",(j.totalRevenue/1e3).toFixed(1),"K"]})]}),e.jsx(je,{className:"w-8 h-8 text-green-600 opacity-20"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"border-b p-6 flex gap-4 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx("input",{type:"text",placeholder:"Search users by name or email...",value:n,onChange:b=>l(b.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})}),e.jsxs("select",{value:g,onChange:b=>f(b.target.value),className:"px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"free_trial",children:"Free Trial"}),e.jsx("option",{value:"expiring_soon",children:"Expiring Soon"}),e.jsx("option",{value:"trial_expired",children:"Trial Expired"}),e.jsx("option",{value:"paid",children:"Paid Users"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Days Active"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Trial Expires"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:P.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-8 text-center text-gray-500",children:"No users found matching your criteria"})}):P.map(b=>e.jsxs("tr",{className:`border-b hover:bg-gray-50 transition ${y(b)}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:b.name}),e.jsx("p",{className:"text-xs text-gray-500",children:b.email})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-3 py-1 bg-gray-200 text-gray-800 rounded-full text-xs font-semibold",children:b.plan||"free"})}),e.jsx("td",{className:"px-6 py-4",children:v(b)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`font-semibold ${b.daysActive>=25?"text-red-600":"text-gray-900"}`,children:[b.daysActive," days"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-xs text-gray-600",children:new Date(b.trialExpireDate).toLocaleDateString()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[b.hasReachedTrialLimit&&e.jsxs("button",{onClick:()=>I(b.id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs font-semibold transition flex items-center gap-1",title:"Send upgrade prompt",children:[e.jsx(pt,{className:"w-3 h-3"}),"Upgrade"]}),b.daysUntilExpiry<=5&&b.isFreeTrial&&!b.hasReachedTrialLimit&&e.jsxs("button",{onClick:()=>w(b.id),className:"bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-xs font-semibold transition flex items-center gap-1",title:"Send trial expiry reminder",children:[e.jsx(is,{className:"w-3 h-3"}),"Remind"]}),e.jsx("button",{onClick:()=>k(b.id,b.locked),disabled:x===b.id,className:`${b.locked?"bg-green-600 hover:bg-green-700":"bg-orange-600 hover:bg-orange-700"} text-white px-3 py-1 rounded text-xs font-semibold transition disabled:opacity-50 flex items-center gap-1`,children:b.locked?e.jsxs(e.Fragment,{children:[e.jsx(Lt,{className:"w-3 h-3"}),"Unlock"]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-3 h-3"}),"Lock"]})})]})})]},b.id))})]})})]})]})]})}function De({children:t,adminOnly:c=!1,ultraOnly:g=!1,ownerOnly:f=!1}){const{user:n,loading:l}=pe(),[r,h]=a.useState(!1),x=Bt(6e4),i=x?.[0]||!1,p=x?.[1]||(()=>{}),[j,o]=a.useState({});if(a.useEffect(()=>{n&&!f&&((async()=>{try{const y=localStorage.getItem("token"),w=await fetch(`${Y}/settings`,{headers:{Authorization:`Bearer ${y}`}});if(w.ok){const k=await w.json();o(k)}}catch(y){console.error("Failed to load settings:",y)}})(),h(!0))},[n,f]),l&&!f)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(f){const u=localStorage.getItem("ownerToken"),y=localStorage.getItem("ownerUser");if(!u||!y)return e.jsx(ae,{to:"/main.admin"});try{if(JSON.parse(y).type!=="main_admin")return e.jsx(ae,{to:"/main.admin"})}catch{return e.jsx(ae,{to:"/main.admin"})}}else{if(!n)return e.jsx(ae,{to:"/auth/login"});if(!n.active)return e.jsx(ae,{to:"/plans"});if(c&&n.role!=="admin")return e.jsx(ae,{to:"/dashboard"});if(g&&(n.role!=="admin"||n.plan!=="ultra"))return e.jsx(ae,{to:"/dashboard"})}const U=f?"owner":"user";return e.jsxs(e.Fragment,{children:[i&&e.jsx(qt,{onUnlock:p,userType:U}),r&&e.jsx(Mt,{onClose:()=>h(!1)}),t]})}function Bs(){const{user:t}=pe();return!t||!t.active?e.jsx(ae,{to:"/plans"}):t.role==="admin"?e.jsx(ae,{to:"/admin"}):e.jsx(ae,{to:"/dashboard/cashier"})}function _s(){return e.jsx(bs,{children:e.jsx(js,{children:e.jsx(Kt,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(St,{children:[e.jsx(G,{path:"/",element:e.jsx($s,{})}),e.jsx(G,{path:"/auth/login",element:e.jsx(wt,{})}),e.jsx(G,{path:"/auth/signup",element:e.jsx(wt,{})}),e.jsx(G,{path:"/plans",element:e.jsx(Os,{})}),e.jsx(G,{path:"/main.admin",element:e.jsx(Rs,{})}),e.jsx(G,{path:"/main.admin/dashboard",element:e.jsx(De,{ownerOnly:!0,children:e.jsx(qs,{})})}),e.jsx(G,{path:"/main.admin/dashboard-legacy",element:e.jsx(De,{ownerOnly:!0,children:e.jsx(Ms,{})})}),e.jsx(G,{path:"/dashboard",element:e.jsx(De,{children:e.jsx(Bs,{})})}),e.jsx(G,{path:"/dashboard/cashier",element:e.jsx(De,{children:e.jsx(Fs,{})})}),e.jsx(G,{path:"/admin/*",element:e.jsx(De,{adminOnly:!0,children:e.jsx(Us,{})})}),e.jsx(G,{path:"/login",element:e.jsx(ae,{to:"/auth/login"})}),e.jsx(G,{path:"/signup",element:e.jsx(ae,{to:"/auth/signup"})}),e.jsx(G,{path:"/subscription",element:e.jsx(ae,{to:"/plans"})}),e.jsx(G,{path:"/payment",element:e.jsx(ae,{to:"/plans"})}),e.jsx(G,{path:"/cashier",element:e.jsx(ae,{to:"/dashboard/cashier"})})]})})})})}ms.createRoot(document.getElementById("root")).render(e.jsx(Jt.StrictMode,{children:e.jsx(_s,{})}));
