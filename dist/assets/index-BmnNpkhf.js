import{a as Ft,b as Ut,g as Rt,r as a,u as ve,c as jt,R as yt,d as W,B as qt,N as se,e as Mt}from"./vendor-Ct1st1Nj.js";import{C as _e,D as Ce,T as Se,P as Pe,S as Nt,a as He,b as nt,c as le,d as Bt,e as _t,f as ze,g as ye,h as ue,i as vt,j as Ht,k as zt,L as ne,U as dt,l as mt,m as Ae,E as wt,M as xt,n as Ne,X as Ie,o as Le,p as Me,q as it,r as Je,s as ut,t as Ke,B as ct,R as Jt,I as Kt,u as We,v as lt,w as De,x as ht,y as Wt,z as Gt,A as St,F as Vt,G as Qt,H as Yt,J as ot,K as Zt,N as Fe,O as kt,Q as Ee,Z as Ct,V as Pt,W as Xt,Y as es,_ as ts,$ as ss,a0 as as,a1 as rs}from"./icons-BgmngliZ.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))h(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&h(s)}).observe(document,{childList:!0,subtree:!0});function p(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function h(c){if(c.ep)return;c.ep=!0;const r=p(c);fetch(c.href,r)}})();var st={exports:{}},we={};var pt;function ls(){if(pt)return we;pt=1;var t=Ft(),n=Symbol.for("react.element"),p=Symbol.for("react.fragment"),h=Object.prototype.hasOwnProperty,c=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function s(i,x,l){var g,j={},d=null,T=null;l!==void 0&&(d=""+l),x.key!==void 0&&(d=""+x.key),x.ref!==void 0&&(T=x.ref);for(g in x)h.call(x,g)&&!r.hasOwnProperty(g)&&(j[g]=x[g]);if(i&&i.defaultProps)for(g in x=i.defaultProps,x)j[g]===void 0&&(j[g]=x[g]);return{$$typeof:n,type:i,key:d,ref:T,props:j,_owner:c.current}}return we.Fragment=p,we.jsx=s,we.jsxs=s,we}var gt;function ns(){return gt||(gt=1,st.exports=ls()),st.exports}var e=ns(),Ue={},ft;function is(){if(ft)return Ue;ft=1;var t=Ut();return Ue.createRoot=t.createRoot,Ue.hydrateRoot=t.hydrateRoot,Ue}var cs=is();const os=Rt(cs),ds=()=>"https://posifine22.onrender.com/api",X=ds(),At=()=>localStorage.getItem("token"),It=async(t,n={},p=0,h=3)=>{const c=At(),r=t.startsWith("/")?t:`/${t}`,s={...n,headers:{"Content-Type":"application/json",...c&&!(r.startsWith("/auth")&&r!=="/auth/me")&&!r.includes("/main-admin/auth/login")&&{Authorization:`Bearer ${c}`},...n.headers}};try{const i=await fetch(`${X}${r}`,s);if(i.status===401){localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser");const l=window.location.pathname||"";if(!l.includes("/login")&&!l.includes("/signup")&&!l.includes("/auth")&&!l.includes("/main.admin"))try{window.location.href="/login"}catch{}const g=new Error("Unauthorized");throw g.status=401,g}if(i.status===500)throw new Error("Server error 500 - Backend unavailable");if(i.ok)return i.status===204?{success:!0}:await i.json();const x=await i.json().catch(()=>({error:"Network error"}));throw new Error(x.error||`HTTP ${i.status}: ${i.statusText}`)}catch(i){if(i.name==="TypeError"&&i.message.includes("fetch")){if(console.error(`API Fetch Error (attempt ${p+1}/${h+1}):`,i),console.error("Attempted URL:",`${X}${r}`),p<h){const x=Math.min(1e3*Math.pow(2,p),1e4);return console.log(`Retrying in ${x}ms...`),await new Promise(l=>setTimeout(l,x)),It(t,n,p+1,h)}throw new Error("Cannot connect to server. The server may be waking up. Please try again in a moment.")}throw i}},M=(t,n={})=>It(t,n,0,3),je={login:t=>M("/auth/login",{method:"POST",body:JSON.stringify(t)}),pinLogin:t=>M("/auth/pin-login",{method:"POST",body:JSON.stringify(t)}),signup:t=>M("/auth/signup",{method:"POST",body:JSON.stringify(t)}),signupWithPayment:t=>M("/signup-with-payment",{method:"POST",body:JSON.stringify(t)}),me:()=>M("/auth/me")},be={getAll:()=>M("/users"),create:t=>M("/users",{method:"POST",body:JSON.stringify(t)}),update:(t,n)=>M(`/users/${t}`,{method:"PUT",body:JSON.stringify(n)}),delete:t=>M(`/users/${t}`,{method:"DELETE"}),setPin:(t,n)=>M(`/users/${t}/set-pin`,{method:"POST",body:JSON.stringify({pin:n})}),lock:(t,n)=>M(`/users/${t}/lock`,{method:"POST",body:JSON.stringify({locked:n})})},ie={getAll:()=>M("/products"),create:t=>M("/products",{method:"POST",body:JSON.stringify(t)}),update:(t,n)=>M(`/products/${t}`,{method:"PUT",body:JSON.stringify(n)}),delete:t=>M(`/products/${t}`,{method:"DELETE"}),updateStock:(t,n)=>M(`/products/${t}/stock`,{method:"PUT",body:JSON.stringify(n)}),getMaxProducible:t=>M(`/products/${t}/max-producible`)},Te={getAll:async()=>[{id:1,total:450,items:[{name:"Coffee",quantity:2}],createdAt:new Date().toISOString()}],create:async t=>({id:Date.now(),...t,createdAt:new Date().toISOString()})},Ge={getAll:async()=>[{id:1,description:"Office supplies",amount:150,createdAt:new Date().toISOString()}],create:async t=>({id:Date.now(),...t,createdAt:new Date().toISOString()})},Dt={get:async()=>({totalSales:1500,totalExpenses:300,profit:1200,productCount:5})},Re={getAll:()=>M("/discounts"),create:t=>M("/discounts",{method:"POST",body:JSON.stringify(t)}),update:(t,n)=>M(`/discounts/${t}`,{method:"PUT",body:JSON.stringify(n)}),delete:t=>M(`/discounts/${t}`,{method:"DELETE"})},at={getAll:()=>M("/credit-requests"),create:t=>M("/credit-requests",{method:"POST",body:JSON.stringify(t)}),approve:t=>M(`/credit-requests/${t}/approve`,{method:"POST"}),reject:t=>M(`/credit-requests/${t}/reject`,{method:"POST"})},ke={get:async()=>({screenLockPassword:"2005",businessName:"My Business"}),update:async t=>t},Ve={getAll:t=>{const n=t?`/batches?productId=${t}`:"/batches";return M(n)},create:t=>M("/batches",{method:"POST",body:JSON.stringify(t)})},qe={login:t=>M("/main-admin/auth/login",{method:"POST",body:JSON.stringify(t)}),getUsers:()=>{const t=localStorage.getItem("ownerToken");return M("/main-admin/users",{headers:{Authorization:`Bearer ${t}`}})},getStats:()=>{const t=localStorage.getItem("ownerToken");return M("/main-admin/stats",{headers:{Authorization:`Bearer ${t}`}})},getActivities:()=>{const t=localStorage.getItem("ownerToken");return M("/main-admin/activities",{headers:{Authorization:`Bearer ${t}`}})},getSalesAll:()=>{const t=localStorage.getItem("ownerToken");return M("/main-admin/sales-all",{headers:{Authorization:`Bearer ${t}`}})},getTimeEntriesAll:()=>{const t=localStorage.getItem("ownerToken");return M("/main-admin/time-entries-all",{headers:{Authorization:`Bearer ${t}`}})},lockUser:(t,n)=>{const p=localStorage.getItem("ownerToken");return M(`/main-admin/users/${t}/lock`,{method:"POST",headers:{Authorization:`Bearer ${p}`},body:JSON.stringify({locked:n})})},changePlan:(t,n)=>{const p=localStorage.getItem("ownerToken");return M(`/main-admin/users/${t}/plan`,{method:"POST",headers:{Authorization:`Bearer ${p}`},body:JSON.stringify({plan:n})})},clearData:t=>{const n=localStorage.getItem("ownerToken");return M("/main-admin/system/clear-data",{method:"POST",headers:{Authorization:`Bearer ${n}`},body:JSON.stringify({type:t})})}};let re=null,Be=new Set;function ms(){const t=X.replace(/\/api$/,"");return`${t.startsWith("https")?"wss":"ws"}://${t.replace(/^https?:\/\//,"")}/api/ws/products`}function xs(){if(re&&(re.readyState===WebSocket.OPEN||re.readyState===WebSocket.CONNECTING))return;const t=At(),n=ms()+(t?`?token=${encodeURIComponent(t)}`:"");re=new WebSocket(n),re.onopen=()=>{console.debug("Products WS connected")},re.onmessage=p=>{let h=null;try{h=JSON.parse(p.data)}catch{return}Be.forEach(c=>{try{c(h)}catch(r){console.error("ws callback error",r)}})},re.onclose=()=>{console.debug("Products WS closed"),re=null},re.onerror=p=>{console.error("Products WS error",p)}}function us(t){if(typeof t!="function")throw new Error("subscribeProducts requires a callback");return Be.add(t),xs(),()=>{if(Be.delete(t),re&&Be.size===0){try{re.close()}catch{}re=null}}}const Et=a.createContext(),he=()=>a.useContext(Et),hs=({children:t})=>{const[n,p]=a.useState(null),[h,c]=a.useState(!0),[r,s]=a.useState(!1),[i,x]=a.useState({});a.useEffect(()=>{l()},[]),a.useEffect(()=>{const k=()=>{const L=localStorage.getItem("user");if(L)try{const V=JSON.parse(L);p(V)}catch(V){console.warn("Failed to parse user from localStorage",V)}else p(null)};return window.addEventListener("storage",k),window.addEventListener("localStorageUpdated",k),()=>{window.removeEventListener("storage",k),window.removeEventListener("localStorageUpdated",k)}},[]);const l=async()=>{try{const k=localStorage.getItem("token"),L=localStorage.getItem("user");if(k)try{const V=await fetch(`${X}/auth/me`,{headers:{Authorization:`Bearer ${k}`,"Content-Type":"application/json"}});if(V.ok){const Y=await V.json();p(Y),localStorage.setItem("user",JSON.stringify(Y))}else throw new Error("Invalid token")}catch(V){console.warn("Auth check failed:",V),localStorage.removeItem("token"),localStorage.removeItem("user")}}catch(k){console.error("Error initializing auth:",k),localStorage.removeItem("token"),localStorage.removeItem("user"),p(null)}finally{c(!1),s(!0)}},g=async k=>{try{if(k&&k.token&&k.user)return localStorage.setItem("token",k.token),localStorage.setItem("user",JSON.stringify(k.user)),p(k.user),k;const L=await je.login(k);if(L.token&&L.user)return localStorage.setItem("token",L.token),localStorage.setItem("user",JSON.stringify(L.user)),p(L.user),L;throw new Error("Invalid response from server")}catch(L){throw console.error("Login failed:",L),L}},j=async k=>{try{const L=await je.signup(k);if(L.token&&L.user)return localStorage.setItem("token",L.token),localStorage.setItem("user",JSON.stringify(L.user)),p(L.user),L;throw new Error("Invalid response from server")}catch(L){throw console.error("Signup failed:",L),L}},d=async k=>{try{if(localStorage.setItem("user",JSON.stringify(k)),p(k),window.dispatchEvent(new Event("localStorageUpdated")),k&&k.id)try{await be.update(k.id,k)}catch(L){console.warn("Failed to persist updated user to backend",L)}return k}catch(L){throw console.error("updateUser failed:",L),L}},T=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),p(null),window.location.href="/login"},u=()=>!!n&&!!localStorage.getItem("token"),f=k=>n&&n.role===k,N=()=>n&&(n.role==="admin"||n.role==="main-admin"),b=()=>n&&n.role==="cashier",w=()=>n&&n.plan==="ultra",D=()=>n&&n.plan==="basic",P=()=>n&&(n.role==="admin"||n.role==="cashier"),B=()=>n&&n.role==="admin"&&n.plan==="ultra",q=()=>n&&n.role==="admin",S=()=>!0,v=()=>!0;return n?.locked?e.jsx(LockedAccount,{}):e.jsx(Et.Provider,{value:{user:n,loading:h,isInitialized:r,appSettings:i,login:g,signup:j,updateUser:d,logout:T,isAuthenticated:u,hasRole:f,isAdmin:N,isCashier:b,isUltraPackage:w,isBasicPackage:D,canEditStock:P,canManageUsers:B,canViewAnalytics:q,isRealTimeProductSyncEnabled:S,isCashierUserManagementEnabled:v},children:t})};new Date().toISOString();const Tt=a.createContext(),ps=()=>a.useContext(Tt),gs=({children:t})=>{const{user:n}=he(),[p,h]=a.useState([]),[c,r]=a.useState(!0),[s,i]=a.useState(null),[x,l]=a.useState(Date.now()),g=a.useCallback(async()=>{if(!localStorage.getItem("token")){r(!1);return}try{const d=await ie.getAll(),u=(Array.isArray(d)?d:[]).filter(f=>n?.role==="admin"?!0:!f.expenseOnly&&!f.pendingDelete&&f.visibleToCashier!==!1);h(u),i(null),window.dispatchEvent(new CustomEvent("productsSync",{detail:{products:u,timestamp:Date.now()}}))}catch(d){console.error("Failed to fetch products:",d),i(`Failed to load products: ${d.message}`),h([])}finally{r(!1),l(Date.now())}},[n]);a.useEffect(()=>{g()},[g,n]),a.useEffect(()=>{const d=setInterval(()=>{g()},2e3);return()=>clearInterval(d)},[g]);const j=async()=>{r(!0),await g()};return e.jsx(Tt.Provider,{value:{products:p,loading:c,error:s,lastUpdated:x,refreshProducts:j},children:t})};function fs(){const[t,n]=a.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[p,h]=a.useState(!0),[c,r]=a.useState(null);a.useEffect(()=>{s()},[]);const s=async()=>{try{r(null);const[l,g]=await Promise.all([Dt.get(),Te.getAll()]),j={totalSales:l?.totalSales||0,totalExpenses:l?.totalExpenses||0,profit:l?.profit||0,grossProfit:l?.grossProfit||0,netProfit:l?.netProfit||0,totalCOGS:l?.totalCOGS||0,dailySales:l?.dailySales||0,weeklySales:l?.weeklySales||0,productCount:l?.productCount||0},d=Array.isArray(g)?g:[];n({stats:j,recentSales:d.slice(-10).reverse()})}catch(l){console.error("Failed to load data:",l),r(l.message),n({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{h(!1)}};if(p)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(c&&t.stats.totalSales===0&&t.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(_e,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:c}),e.jsx("button",{onClick:s,className:"btn-primary",children:"Retry"})]})});const i=[{label:"Total Sales",value:`KSH ${t.stats.totalSales?.toLocaleString()||0}`,icon:Ce,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${t.stats.grossProfit?.toLocaleString()||0}`,icon:Se,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${t.stats.totalCOGS?.toLocaleString()||0}`,icon:Pe,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${t.stats.netProfit?.toLocaleString()||0}`,icon:Se,color:"from-purple-500 to-pink-600",change:"+15.3%"}],x=[{label:"Daily Sales",value:`KSH ${t.stats.dailySales?.toLocaleString()||0}`,icon:Nt,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${t.stats.weeklySales?.toLocaleString()||0}`,icon:Se,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${t.stats.totalExpenses?.toLocaleString()||0}`,icon:He,color:"bg-red-50 text-red-600"},{label:"Products",value:t.stats.productCount||0,icon:Pe,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(i||[]).map((l,g)=>{const j=l?.icon;return j?e.jsxs("div",{className:`card bg-gradient-to-br ${l.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(j,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:l.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:l.label}),e.jsx("p",{className:"text-2xl font-bold",children:l.value})]},g):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(x||[]).map((l,g)=>{const j=l?.icon;return j?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${l.color} flex items-center justify-center`,children:e.jsx(j,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:l.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:l.value})]})]})},g):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!t.recentSales||t.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_e,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(t.recentSales||[]).map(l=>l?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:l.createdAt?new Date(l.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(l.items)?l.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:l.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",l.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",l.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",l.profit?.toLocaleString()||0]})]},l.id||Math.random()):null)})]})})]})]})}const bs=()=>"https://posifine22.onrender.com/api".replace("https://","wss://").replace("http://","ws://");class js{constructor(){this.ws=null,this.listeners={stock_updated:[],heartbeat:[],initial:[],error:[],sale_deleted:[],product_deleted:[],user_deleted:[],data_cleared:[]},this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.isManualClose=!1}connect(n,p){return new Promise((h,c)=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){h();return}if(!n){c(new Error("No token provided for WebSocket connection"));return}const r=`${bs()}/ws/products?token=${encodeURIComponent(n)}`;try{this.ws=new WebSocket(r),this.ws.onopen=()=>{console.log("âœ… WebSocket connected for real-time updates"),this.reconnectAttempts=0,h()},this.ws.onmessage=s=>{try{const i=JSON.parse(s.data);i.type==="stock_updated"?(console.log("ðŸ“¦ Stock update received:",i.data),p&&p(i.data),this.emit("stock_updated",i.data)):i.type==="initial"?(console.log("ðŸ“¦ Initial products loaded via WebSocket"),this.emit("initial",i.products)):i.type==="heartbeat"?this.emit("heartbeat",i):i.type==="sale_deleted"?(console.log("ðŸ—‘ï¸ Sale deleted:",i.data),this.emit("sale_deleted",i.data),window.dispatchEvent(new Event("saleDeleted"))):i.type==="product_deleted"?(console.log("ðŸ—‘ï¸ Product deleted:",i.data),this.emit("product_deleted",i.data),window.dispatchEvent(new Event("dataUpdated"))):i.type==="user_deleted"?(console.log("ðŸ—‘ï¸ User deleted:",i.data),this.emit("user_deleted",i.data),window.dispatchEvent(new Event("userDeleted"))):i.type==="data_cleared"&&(console.log("ðŸ—‘ï¸ Data cleared:",i.data),this.emit("data_cleared",i.data),window.dispatchEvent(new Event("dataUpdated")))}catch(i){console.error("Error parsing WebSocket message:",i)}},this.ws.onerror=s=>{console.error("âŒ WebSocket error:",s),this.emit("error",s),c(s)},this.ws.onclose=()=>{console.log("ðŸ”Œ WebSocket disconnected"),this.isManualClose||this.attemptReconnect(n,p)}}catch(s){console.error("Failed to create WebSocket:",s),c(s)}})}attemptReconnect(n,p){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Max reconnection attempts reached");return}this.reconnectAttempts++;const h=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`ðŸ”„ Reconnecting in ${h}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect(n,p).catch(c=>{console.error("Reconnection failed:",c)})},h)}on(n,p){this.listeners[n]||(this.listeners[n]=[]),this.listeners[n].push(p)}emit(n,p){this.listeners[n]&&this.listeners[n].forEach(h=>{try{h(p)}catch(c){console.error(`Error in ${n} listener:`,c)}})}disconnect(){this.isManualClose=!0,this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}}const Qe=new js;function ys(){const{user:t,isUltraPackage:n,isRealTimeProductSyncEnabled:p}=he(),{products:h,refreshProducts:c}=ps(),[r,s]=a.useState([]),[i,x]=a.useState([]),[l,g]=a.useState("all"),[j,d]=a.useState(""),[T,u]=a.useState(!1),[f,N]=a.useState(!1),[b,w]=a.useState(!1),[D,P]=a.useState(null),[B,q]=a.useState(null),[S,v]=a.useState(null),[k,L]=a.useState(!1),[V,Y]=a.useState(null),[de,pe]=a.useState(""),[_,te]=a.useState({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),[Q,R]=a.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[O,K]=a.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0});a.useEffect(()=>{y();const m=localStorage.getItem("token");return m&&Qe.connect(m,C=>{C&&C.allProducts&&s(C.allProducts)}).catch(C=>{console.warn("WebSocket connection failed:",C)}),()=>{Qe.disconnect()}},[]);const y=async()=>{try{await c();const m=await Ve.getAll();x(m)}catch(m){console.error("Failed to load data:",m)}};a.useEffect(()=>{h&&s(h)},[h]);const F=(m,C=!0)=>{const A=m.target.files[0];if(A){if(A.size>2*1024*1024){G("Image must be smaller than 2MB","error");return}const J=new FileReader;J.onload=H=>{const ee=H.target.result;pe(ee),C?te({..._,image:ee}):(K({...O,image:ee}),O.id&&setTimeout(async()=>{try{await ie.update(O.id,{image:ee}),G("âœ… Image saved","success")}catch(ge){console.error("Failed to save image:",ge)}},500))},J.readAsDataURL(A)}},U=m=>i.filter(A=>A.productId===m&&A.quantity>0).reduce((A,J)=>A+J.quantity,0),Z=m=>i.filter(C=>C.productId===m&&C.quantity>0),G=(m,C="success")=>{v({message:m,type:C}),setTimeout(()=>v(null),5e3)},ce=async m=>{m.preventDefault();try{const C={..._,price:parseFloat(_.price),cost:parseFloat(_.cost||0),quantity:0,visibleToCashier:!_.expenseOnly&&_.visibleToCashier!==!1},A=await ie.create(C);te({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),pe(""),u(!1),await y(),G(`âœ… Product "${A.name}" added successfully! ${A.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success")}catch(C){console.error("Failed to create product:",C),alert(`Failed to create product: ${C.message||"Unknown error"}`)}},oe=async m=>{m.preventDefault();try{const C={id:`batch-${Date.now()}`,productId:D.id,quantity:parseInt(Q.quantity),expiryDate:Q.expiryDate,batchNumber:Q.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(Q.cost||D.cost||0)};x(A=>[...A,C]),G("âš¡ Adding stock...","info");try{await Ve.create({productId:D.id,quantity:parseInt(Q.quantity),expiryDate:Q.expiryDate,batchNumber:Q.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(Q.cost||D.cost||0)}),R({quantity:"",expiryDate:"",batchNumber:"",cost:""}),w(!1),P(null),await y(),G(`âœ… Stock added successfully for ${D.name}!`,"success")}catch(A){throw x(J=>J.filter(H=>H.id!==C.id)),A}}catch(C){console.error("Failed to add stock:",C),G(`âŒ Failed to add stock: ${C.message||"Unknown error"}`,"error")}},$e=async m=>{m.preventDefault();try{const C=r.find(H=>H.id===O.id);if(parseFloat(O.price)<C.price){alert("You cannot lower prices, only increase.");return}const A={...O,price:parseFloat(O.price),cost:parseFloat(O.cost),quantity:parseFloat(O.quantity)},J={...C,...A};s(H=>H.map(ee=>ee.id===O.id?J:ee)),L(!0),G("âš¡ Updating product...","info");try{const H=await ie.update(O.id,A);N(!1),p()?(window.dispatchEvent(new CustomEvent("productUpdated",{detail:{product:H,originalProduct:C,timestamp:new Date().toISOString(),type:"update"}})),G("âœ… Product updated and synced!","success")):G("âœ… Product updated successfully!","success"),Y(new Date)}catch(H){throw s(ee=>ee.map(ge=>ge.id===O.id?C:ge)),H}finally{L(!1)}}catch(C){console.error("Failed to update product:",C),G(`âŒ Update failed: ${C.message||"Unknown error"}`,"error")}},Ye=async m=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const C=r.find(J=>J.id===m),A=await ie.delete(m);if(s(J=>J.filter(H=>H.id!==m)),p()&&C)L(!0),window.dispatchEvent(new CustomEvent("productDeleted",{detail:{product:C,timestamp:new Date().toISOString(),type:"delete"}})),G(`ðŸ“¡ Product "${C.name}" deleted and synced to all dashboards!`,"success"),Y(new Date),setTimeout(()=>{L(!1)},3e3);else{const J=A?.message||"Product deleted successfully!";alert(J)}await c()}catch(C){console.error("Failed to delete product:",C);let A="Failed to delete product";C.message.includes("Failed to execute")||C.message.includes("JSON")?A="Network error. Please check your connection and try again.":C.message.includes("401")||C.message.includes("unauthorized")?A="You are not authorized to delete this product.":C.message.includes("404")||C.message.includes("not found")?A="Product not found. It may have been deleted already.":C.message&&(A=`Failed to delete product: ${C.message}`),alert(A)}},Ze=(r||[]).filter(m=>{if(!m)return!1;const C=m.name?.toLowerCase().includes(j.toLowerCase()),A=l==="all"||l==="raw"&&!m.recipe||l==="composite"&&m.recipe||l==="expense"&&m.expenseOnly||l==="low-stock"&&m.quantity<10;return C&&A}),Xe=(r||[]).filter(m=>m&&!m.recipe&&!m.expenseOnly),me=(r||[]).filter(m=>m&&m.recipe),et=(r||[]).filter(m=>m&&m.expenseOnly),fe=m=>{if(!m||!m.recipe)return 0;let C=1/0;return(m.recipe||[]).forEach(A=>{if(!A)return;const J=(r||[]).find(H=>H&&H.id===A.productId);if(J&&J.quantity>0&&A.quantity>0){const H=Math.floor(J.quantity/A.quantity);C=Math.min(C,H)}}),C===1/0?0:C},tt=m=>{if(!m)return 0;if(!m.recipe)return m.cost||0;let C=0;return(m.recipe||[]).forEach(A=>{if(!A)return;const J=(r||[]).find(H=>H&&H.id===A.productId);if(J&&J.quantity>0){const H=(J.cost||0)/J.quantity;C+=H*(A.quantity||0)}}),C};return e.jsxs("div",{className:"p-6 space-y-6",children:[S&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${S.type==="success"?"bg-green-50 border border-green-200 text-green-800":S.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:S.message}),e.jsx("button",{onClick:()=>v(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(nt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:j,onChange:m=>d(m.target.value)})]}),e.jsxs("select",{value:l,onChange:m=>g(m.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>u(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:Xe.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:me.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:et.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(Ze||[]).map(m=>{if(!m)return null;const C=tt(m),A=m.price?((m.price-C)/m.price*100).toFixed(1):0,J=fe(m),H=B===m.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[m.image?e.jsx("img",{src:m.image,alt:m.name,className:"w-12 h-12 object-cover rounded-lg",onError:ee=>{ee.target.style.display="none",ee.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:m.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[m.recipe&&e.jsx("button",{onClick:()=>q(H?null:m.id),className:"p-1 hover:bg-gray-200 rounded",children:H?e.jsx(Bt,{className:"w-4 h-4"}):e.jsx(_t,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:m.name}),m.quantity<10&&!m.recipe&&e.jsx(ze,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${m.expenseOnly?"badge-warning":m.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:m.expenseOnly?"Expense":m.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",m.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",C.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${U(m.id)===0?"text-red-600":U(m.id)<10?"text-yellow-600":"text-gray-900"}`,children:[U(m.id)," ",m.unit]}),U(m.id)<10&&U(m.id)>0&&e.jsx(ze,{className:"w-4 h-4 text-yellow-500"}),U(m.id)===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600",children:[Z(m.id).length," active"]}),e.jsx("button",{onClick:()=>{P(m),w(!0)},className:"p-1 hover:bg-blue-50 rounded text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(le,{className:"w-3 h-3"})})]})}),e.jsx("td",{className:"px-4 py-3",children:m.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[J," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${A>30?"text-green-600":A>15?"text-yellow-600":"text-red-600"}`,children:[A,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{K(m),N(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ye(m.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(ue,{className:"w-4 h-4"})})]})})]},m.id),H&&m.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(m.recipe||[]).map((ee,ge)=>{if(!ee)return null;const xe=(r||[]).find(I=>I&&I.id===ee.productId);if(!xe)return null;const o=(xe.cost||0)/(xe.quantity||1),E=o*(ee.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:xe.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[ee.quantity||0," ",xe.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[xe.quantity||0," ",xe.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",o.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",E.toFixed(2)]})]},ge)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",C.toFixed(2)]})]})})]})]})})})]})})})]})})}),b&&D&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Add Stock for ",D.name]}),e.jsxs("form",{onSubmit:oe,className:"space-y-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:Q.quantity,onChange:m=>R({...Q,quantity:m.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:Q.expiryDate,onChange:m=>R({...Q,expiryDate:m.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:Q.batchNumber,onChange:m=>R({...Q,batchNumber:m.target.value})}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost per Unit",className:"input",value:Q.cost,onChange:m=>R({...Q,cost:m.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{w(!1),P(null),R({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]})}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:_.name,onChange:m=>te({..._,name:m.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:m=>F(m,!0),className:"input"}),e.jsx(vt,{className:"w-5 h-5 text-gray-400"})]}),(de||_.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:de||_.image,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:_.price,onChange:m=>te({..._,price:m.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:_.cost,onChange:m=>te({..._,cost:m.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:_.category,onChange:m=>te({..._,category:m.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsxs("select",{className:"input",value:_.unit,onChange:m=>te({..._,unit:m.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:_.expenseOnly,onChange:m=>te({..._,expenseOnly:m.target.checked,visibleToCashier:!m.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!_.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:_.visibleToCashier,onChange:m=>te({..._,visibleToCashier:m.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{u(!1),pe(""),te({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0})},className:"btn-secondary",children:"Cancel"})]})]})]})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:$e,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:O.name,onChange:m=>K({...O,name:m.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:O.image||"",onChange:m=>K({...O,image:m.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:m=>{const C=m.target.files[0];if(C){const A=new FileReader;A.onloadend=()=>{K({...O,image:A.result})},A.readAsDataURL(C)}}})]}),O.image&&e.jsx("img",{src:O.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:O.price||"",onChange:m=>K({...O,price:m.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:O.cost||"",onChange:m=>K({...O,cost:m.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:O.quantity||"",onChange:m=>K({...O,quantity:m.target.value}),required:!0}),e.jsxs("select",{className:"input",value:O.unit||"pcs",onChange:m=>K({...O,unit:m.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:O.category||"raw",onChange:m=>K({...O,category:m.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:O.expenseOnly||!1,onChange:m=>K({...O,expenseOnly:m.target.checked,visibleToCashier:!m.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!O.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:O.visibleToCashier!==!1,onChange:m=>K({...O,visibleToCashier:m.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>N(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ns(){const[t,n]=a.useState([]),[p,h]=a.useState([]),[c,r]=a.useState(!1),[s,i]=a.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});a.useEffect(()=>{x()},[]);const x=async()=>{const f=await ie.getAll();n(f),h(f.filter(N=>!N.recipe))},l=()=>{i({...s,ingredients:[...s.ingredients,{name:"",quantity:"",unit:"pcs"}]})},g=(f,N,b)=>{const w=[...s.ingredients];w[f][N]=b,i({...s,ingredients:w})},j=f=>{i({...s,ingredients:s.ingredients.filter((N,b)=>b!==f)})},d=()=>s.ingredients.reduce((f,N)=>{const b=p.find(w=>w.name.toLowerCase()===N.name.toLowerCase());if(b&&N.quantity){const w=b.cost/b.quantity;return f+w*parseFloat(N.quantity)}return f},0),T=async f=>{f.preventDefault();const N=[];for(const w of s.ingredients){if(!w.name||!w.quantity)continue;const D=p.find(P=>P.name.toLowerCase()===w.name.toLowerCase());D?N.push({productId:D.id,quantity:parseFloat(w.quantity),unit:w.unit||"pcs"}):N.push({name:w.name,quantity:parseFloat(w.quantity),unit:w.unit||"pcs"})}if(N.length===0){alert("Please add at least one ingredient");return}const b=d();try{await ie.create({name:s.name,price:parseFloat(s.price),cost:b,quantity:0,unit:"pcs",category:"composite",recipe:N,image:s.image||"",visibleToCashier:s.visibleToCashier,expenseOnly:!1}),i({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),r(!1),x(),alert("Recipe created successfully!")}catch(w){console.error("Error creating recipe:",w),alert("Failed to create recipe. Please try again.")}},u=t.filter(f=>f.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>r(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",u.length,")"]}),u.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:u.map(f=>{const N=f.recipe.reduce((w,D)=>{if(D.productId){const P=t.find(B=>B.id===D.productId);if(P){const B=P.cost/P.quantity;return w+B*D.quantity}}else if(D.name){const P=t.find(B=>B.name.toLowerCase()===D.name.toLowerCase());if(P){const B=P.cost/P.quantity;return w+B*D.quantity}}return w},0),b=((f.price-N)/f.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:f.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",f.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",N.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${b>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",b,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(ue,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:f.recipe.map((w,D)=>{let P="",B=w.unit||"pcs";if(w.productId){const q=t.find(S=>S.id===w.productId);q&&(P=q.name,B=q.unit)}else w.name&&(P=w.name,B=w.unit||"pcs");return P?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:P}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[w.quantity," ",B]})]},D):null})})]})]},f.id)})})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:s.name,onChange:f=>i({...s,name:f.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:s.price,onChange:f=>i({...s,price:f.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:s.image,onChange:f=>i({...s,image:f.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.visibleToCashier,onChange:f=>i({...s,visibleToCashier:f.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:l,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:s.ingredients.map((f,N)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:f.name,onChange:b=>g(N,"name",b.target.value),required:!0,list:`ingredients-list-${N}`}),e.jsx("datalist",{id:`ingredients-list-${N}`,children:p.map(b=>e.jsxs("option",{value:b.name,children:[b.name," (",b.quantity," ",b.unit," available)"]},b.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:f.quantity,onChange:b=>g(N,"quantity",b.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:f.unit,onChange:b=>g(N,"unit",b.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>j(N),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(ue,{className:"w-4 h-4"})})]},N))}),s.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),s.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",d().toFixed(2)]})]}),s.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(s.price)-d())/parseFloat(s.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(Ht,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{r(!1),i({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function vs(){const[t,n]=a.useState([]),[p,h]=a.useState("all");a.useEffect(()=>{c()},[]);const c=async()=>{const l=await Te.getAll();n(l.reverse())},r=t.filter(l=>{if(p==="today")return new Date(l.createdAt).toDateString()===new Date().toDateString();if(p==="week"){const g=new Date;return g.setDate(g.getDate()-7),new Date(l.createdAt)>=g}return!0}),s=r.reduce((l,g)=>l+g.total,0),i=r.reduce((l,g)=>l+(g.cogs||0),0),x=s-i;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("select",{value:p,onChange:l=>h(l.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]})}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(zt,{className:"w-4 h-4"}),"Export"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",s.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",i.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",x.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:r.map(l=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",l.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(l.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[l.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:l.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",l.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",l.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",l.profit?.toLocaleString()||0]})]},l.id))})]})})]})]})}function ws(){const[t,n]=a.useState([]),[p,h]=a.useState(!1),[c,r]=a.useState({description:"",amount:"",category:"general"});a.useEffect(()=>{s()},[]);const s=async()=>{const j=await Ge.getAll();n(j.reverse())},i=async j=>{j.preventDefault(),await Ge.create({...c,amount:parseFloat(c.amount)}),r({description:"",amount:"",category:"general"}),h(!1),s()},x=t.reduce((j,d)=>j+d.amount,0),l=t.filter(j=>!j.automatic),g=t.filter(j=>j.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",x.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",l.reduce((j,d)=>j+d.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",g.reduce((j,d)=>j+d.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.map(j=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(j.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:j.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:j.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${j.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:j.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",j.amount?.toLocaleString()]})]},j.id))})]})})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:c.description,onChange:j=>r({...c,description:j.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:c.amount,onChange:j=>r({...c,amount:j.target.value}),required:!0}),e.jsxs("select",{className:"input",value:c.category,onChange:j=>r({...c,category:j.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ss(){const{isCashierUserManagementEnabled:t,isCashier:n}=he(),[p,h]=a.useState([]),[c,r]=a.useState(!0),[s,i]=a.useState(!1),[x,l]=a.useState(null),[g,j]=a.useState(null),[d,T]=a.useState(null),[u,f]=a.useState(0),[N,b]=a.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),[w,D]=a.useState(!1),[P,B]=a.useState(null),[q,S]=a.useState("");a.useEffect(()=>{v()},[]),a.useEffect(()=>()=>{d?.intervalId&&clearInterval(d.intervalId)},[d]);const v=async()=>{try{r(!0);const y=await be.getAll();h(Array.isArray(y)?y:[])}catch(y){console.error("Error loading users:",y),h([])}finally{r(!1)}},k=()=>Math.floor(1e3+Math.random()*9e3).toString(),L=async y=>{if(y.preventDefault(),console.log("Form submitted with data:",N),!N.name?.trim()||!N.email?.trim()||!N.password?.trim()){alert("Please fill in all required fields");return}if(N.password.length<6){alert("Password must be at least 6 characters long");return}try{r(!0);const F=k(),U={name:N.name.trim(),email:N.email.trim().toLowerCase(),password:N.password.trim(),pin:F};console.log("Sending user data:",U);const Z=await be.create(U);console.log("User creation result:",Z),await v();const G=`âœ… Cashier added successfully!

ðŸ“§ Email: ${U.email}
ðŸ”‘ Password: ${U.password}
ðŸ”¢ PIN: ${F}

ðŸ’¡ LOGIN OPTIONS:
1. Email + Password: Use email and password above
2. PIN Login: Use email + ${F}

Please share these credentials securely with the new cashier.`;alert(G),b({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),i(!1)}catch(F){console.error("Error creating cashier:",F);let U="Failed to add cashier";F.message.includes("Current user not found")?U="Authentication error. Please refresh the page and try again.":F.message.includes("email")?U="Email already exists. Please use a different email.":F.message.includes("network")||F.message.includes("fetch")?U="Network error. Please check your connection and try again.":F.message&&(U=`Failed to add cashier: ${F.message}`),alert(U)}finally{r(!1)}},V=async(y,F)=>{try{r(!0),await be.update(y,{permissions:F}),await v(),l(null)}catch(U){console.error("Error updating permissions:",U),alert("Failed to update permissions: "+U.message)}finally{r(!1)}},Y=async(y,F)=>{try{r(!0);const U=!F,Z=await fetch(`${X}/users/${y}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({active:U})});if(!Z.ok){const G=await Z.json().catch(()=>({error:"Network error"}));throw new Error(G.error||`HTTP ${Z.status}: ${Z.statusText}`)}await v()}catch(U){console.error("Error updating user status:",U),alert("Failed to update user status: "+U.message)}finally{r(!1)}},de=async(y,F)=>{try{r(!0);const U=!F,Z=await fetch(`${X}/users/${y}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({locked:U})});if(!Z.ok){const G=await Z.json().catch(()=>({error:"Network error"}));throw new Error(G.error||`HTTP ${Z.status}: ${Z.statusText}`)}await v()}catch(U){console.error("Error updating user lock status:",U),alert("Failed to update user lock status: "+U.message)}finally{r(!1)}},pe=async y=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{r(!0),await be.delete(y),await v()}catch(F){console.error("Error deleting user:",F),alert("Failed to delete user: "+F.message)}finally{r(!1)}},_=y=>{B(y),S(k()),D(!0)},te=async()=>{try{r(!0),await be.update(P.id,{cashierPIN:q}),await v(),D(!1),B(null),S(""),alert(`âœ… PIN reset successfully!

ðŸ”¢ New PIN for ${P.name}: ${q}

Please share this PIN securely with the cashier.`)}catch(y){console.error("Error resetting PIN:",y),alert("Failed to reset PIN: "+y.message)}finally{r(!1)}},Q=y=>{j(y),T({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const F=setInterval(()=>{O(y)},3e3);T(U=>({...U,intervalId:F})),O(y)},R=()=>{d?.intervalId&&clearInterval(d.intervalId),j(null),T(null)},O=async y=>{try{const F=await Te.getAll(),Z=(Array.isArray(F)?F:[]).filter(ce=>ce.cashierId===y.id).sort((ce,oe)=>new Date(oe.createdAt)-new Date(ce.createdAt)).slice(0,10),G={isActive:Math.random()>.3,currentCart:Z.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:Z.reduce((ce,oe)=>ce+oe.total,0),salesCount:Z.length,lastActivity:Z.length>0?new Date(Z[0].createdAt).toLocaleTimeString():"No recent activity"};T(G)}catch(F){console.error("Error loading live view data:",F)}},K=(p||[]).filter(y=>y.role==="cashier");return c&&p.length===0?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),t()&&e.jsxs("button",{onClick:()=>i(!0),className:"btn-primary flex items-center gap-2",disabled:c,children:[e.jsx(le,{className:"w-4 h-4"}),"Add Cashier"]})]}),n()&&!t()&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(ne,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"User Management Restricted"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The admin has disabled cashier user management. You cannot add, edit, or remove users at this time."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:p.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:K.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:p.filter(y=>y.active).length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(p||[]).map(y=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:y.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:y.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${y.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:y.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:y.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:y.role==="cashier"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:y.pin||y.cashierPIN||"----"}),e.jsx("button",{onClick:()=>_(y),className:"p-1 hover:bg-yellow-50 rounded text-yellow-600",title:"Reset PIN",disabled:c,children:e.jsx(ye,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${y.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:y.active?e.jsxs(e.Fragment,{children:[e.jsx(dt,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(mt,{className:"w-3 h-3"}),"Inactive"]})}),y.locked&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:[e.jsx(Ae,{className:"w-3 h-3"}),"Locked"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Y(y.id,y.active),className:`p-2 rounded-lg transition ${y.active?"hover:bg-red-50 text-red-600":"hover:bg-green-50 text-green-600"}`,title:y.active?"Deactivate User":"Activate User",disabled:c,children:y.active?e.jsx(mt,{className:"w-4 h-4"}):e.jsx(dt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>de(y.id,y.locked||!1),className:`p-2 rounded-lg transition ${y.locked?"hover:bg-green-50 text-green-600":"hover:bg-red-50 text-red-600"}`,title:y.locked?"Unlock User":"Lock User",disabled:c,children:e.jsx(Ae,{className:"w-4 h-4"})})]}),y.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",y.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(wt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Q(y),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(xt,{className:"w-4 h-4"})})]}),t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>l(y),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600",title:"Edit Permissions",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>pe(y.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",title:"Delete User",disabled:c,children:e.jsx(ue,{className:"w-4 h-4"})})]})]})})]},y.id))})]}),p.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ne,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first cashier to get started"})]})]})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:N.name||"",onChange:y=>{console.log("Name input changed:",y.target.value),b({...N,name:y.target.value})},required:!0,disabled:c}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:N.email||"",onChange:y=>{console.log("Email input changed:",y.target.value),b({...N,email:y.target.value})},required:!0,disabled:c}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:N.password||"",onChange:y=>{console.log("Password input changed:",y.target.value),b({...N,password:y.target.value})},required:!0,minLength:6,disabled:c}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(N.permissions).map(([y,F])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:U=>b({...N,permissions:{...N.permissions,[y]:U.target.checked}}),disabled:c}),e.jsx("span",{className:"text-sm capitalize",children:y.replace(/([A-Z])/g," $1").trim()})]},y))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:c,children:c?"Adding...":"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>i(!1),className:"btn-secondary",disabled:c,children:"Cancel"})]})]})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",x.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(x.permissions||{}).map(([y,F])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:U=>l({...x,permissions:{...x.permissions,[y]:U.target.checked}}),disabled:c}),e.jsx("span",{className:"text-sm capitalize",children:y.replace(/([A-Z])/g," $1").trim()})]},y))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>V(x.id,x.permissions),className:"btn-primary flex-1",disabled:c,children:c?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>l(null),className:"btn-secondary",disabled:c,children:"Cancel"})]})]})}),g&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(xt,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",g.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:R,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(Ie,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${d.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:d.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Le,{className:"w-4 h-4"}),"Last Activity: ",d.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Me,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(d.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(d.currentCart||[]).map((y,F)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[y.name," x",y.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",y.price.toLocaleString()]})]},F)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(d.currentCart||[]).reduce((y,F)=>y+F.price*F.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:d.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",d.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",d.salesCount>0?Math.round(d.totalSalesToday/d.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})}),w&&P&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Reset PIN for ",P.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate a new 4-digit PIN for this cashier. The old PIN will be invalid."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"New PIN:"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-mono text-3xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:q})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>S(k()),className:"btn-secondary flex-1",disabled:c,children:"Generate New PIN"}),e.jsx("button",{onClick:te,className:"btn-primary flex-1",disabled:c,children:c?"Updating...":"Confirm & Update"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>{D(!1),B(null),S("")},className:"btn-secondary w-full",disabled:c,children:"Cancel"})})]})})]})}function ks(){const[t,n]=a.useState([]),[p,h]=a.useState("all");a.useEffect(()=>{c()},[]);const c=()=>{const x=JSON.parse(localStorage.getItem("clockRecords")||"[]");n(x.reverse())},r=p==="all"?t:t.filter(x=>x.date===new Date().toDateString()),s=r.filter(x=>x.date===new Date().toDateString()).reduce((x,l)=>x+l.duration,0)/60,i=x=>{const l=Math.floor(x/60),g=x%60;return`${l}h ${g}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(Le,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[s.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(it,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(r.filter(x=>x.date===new Date().toDateString()).map(x=>x.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(Je,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:t.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${p==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>h("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${p==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"})]})}),e.jsx("tbody",{children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-gray-500",children:"No records found"})}):r.map((x,l)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:x.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.clockIn).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.clockIn).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.clockOut).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:i(x.duration)})})]},l))})]})})]})]})}function Cs(){const{user:t,updateUser:n}=he();ve();const[p,h]=a.useState(!1),[c,r]=a.useState(t?.plan||"ultra"),[s,i]=a.useState({}),[x,l]=a.useState(null),[g,j]=a.useState(t?.profilePicture||null),[d,T]=a.useState(!0),[u,f]=a.useState(!0);a.useEffect(()=>{N()},[]);const N=async()=>{try{const v=await ke.get();i(v),v.logo&&l(v.logo),T(v.cashierUserManagement!==!1),f(v.realTimeProductSync!==!1)}catch(v){console.error("Failed to load settings:",v)}},b=async v=>{try{const k={...s,...v};return await ke.update(k),i(k),!0}catch(k){return console.error("Failed to save settings:",k),!1}},w=async()=>{const v=!d;T(v),await b({cashierUserManagement:v})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{cashierUserManagement:v}})),alert(`âœ… Cashier User Management ${v?"ENABLED":"DISABLED"}`)):(T(!v),alert("âŒ Failed to save setting. Please try again."))},D=async()=>{const v=!u;f(v),await b({realTimeProductSync:v})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{realTimeProductSync:v}})),alert(`âœ… Real-time Product Sync ${v?"ENABLED":"DISABLED"}`)):(f(!v),alert("âŒ Failed to save setting. Please try again."))},P=async v=>{const k=v.target.files[0];if(k){const L=new FileReader;L.onloadend=async()=>{const V=L.result;l(V);try{await ke.update({...s,logo:V}),i({...s,logo:V})}catch(Y){console.error("Failed to save logo:",Y)}},L.readAsDataURL(k)}},B=async v=>{const k=v.target.files[0];if(k){const L=new FileReader;L.onloadend=async()=>{const V=L.result;j(V);try{await n({...t,profilePicture:V})}catch(Y){console.error("Failed to save profile picture:",Y)}},L.readAsDataURL(k)}},q=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],S=async()=>{const v=q.find(L=>L.id===c),k=c==="ultra"?"admin":"cashier";await n({...t,role:k,plan:c,price:v.price}),h(!1),setTimeout(()=>window.location.href=k==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(it,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[g?e.jsx("img",{src:g,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:t?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(ut,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:B})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Ke,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>h(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(ct,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cashier User Management"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Cashier User Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow cashiers to add and remove users"})]}),e.jsx("button",{onClick:w,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${d?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${d?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${d?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:d?"âœ… Cashiers can add and remove users when enabled":"âŒ Cashiers cannot add or remove users when disabled"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Jt,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Real-time Product Sync"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Real-time Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync products between admin and cashier dashboards"})]}),e.jsx("button",{onClick:D,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${u?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${u?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${u?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:u?"âœ… Products will sync in real-time across all dashboards":"âŒ Products will not sync automatically across dashboards"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(Ae,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Kt,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[x&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:x,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(ut,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:P})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:q.map(v=>e.jsxs("div",{onClick:()=>r(v.id),className:`card cursor-pointer transition-all ${c===v.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:v.name}),c===v.id&&e.jsx(We,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",v.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:v.features.map((k,L)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(We,{className:"w-4 h-4 text-green-600"}),k]},L))})]},v.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:S,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>h(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function Ps(){const[t,n]=a.useState([]),[p,h]=a.useState(!1),[c,r]=a.useState(null),[s,i]=a.useState({name:"",amount:"",description:"",active:!0});a.useEffect(()=>{x()},[]);const x=()=>{const d=JSON.parse(localStorage.getItem("serviceFees")||"[]");n(d)},l=d=>{localStorage.setItem("serviceFees",JSON.stringify(d)),n(d)},g=d=>{if(d.preventDefault(),c){const T=t.map(u=>u.id===c.id?{...s,id:u.id}:u);l(T)}else{const T={...s,id:Date.now(),createdAt:new Date().toISOString()};l([...t,T])}h(!1),r(null),i({name:"",amount:"",description:"",active:!0})},j=d=>{confirm("Delete this service fee?")&&l(t.filter(T=>T.id!==d))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{h(!0),r(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(d=>e.jsxs("div",{className:`card ${d.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Ce,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:d.name}),e.jsx("p",{className:"text-xs text-gray-500",children:d.description})]})]}),e.jsx("span",{className:`badge ${d.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:d.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",d.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{r(d),i(d),h(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(ye,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>j(d.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(ue,{className:"w-4 h-4 text-red-600"})})]})]})]},d.id))}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[c?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:s.name,onChange:d=>i({...s,name:d.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:s.amount,onChange:d=>i({...s,amount:d.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:s.description,onChange:d=>i({...s,description:d.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.active,onChange:d=>i({...s,active:d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function As(){const[t,n]=a.useState([]),[p,h]=a.useState([]),[c,r]=a.useState(!1),[s,i]=a.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});a.useEffect(()=>{x(),l()},[]);const x=async()=>{try{const u=localStorage.getItem("token"),f=await fetch(`${X}/reminders`,{headers:{Authorization:`Bearer ${u}`}});if(!f.ok){console.error("API Error:",f.status,f.statusText),n([]);return}const N=await f.json();Array.isArray(N)?n(N):(console.error("Expected array but got:",typeof N,N),n([]))}catch(u){console.error("Failed to fetch reminders:",u),n([])}},l=async()=>{try{const u=localStorage.getItem("token"),f=await fetch(`${X}/products`,{headers:{Authorization:`Bearer ${u}`}});if(!f.ok){console.error("API Error:",f.status,f.statusText),h([]);return}const N=await f.json();Array.isArray(N)?h(N):(console.error("Expected array but got:",typeof N,N),h([]))}catch(u){console.error("Failed to fetch products:",u),h([])}},g=async u=>{u.preventDefault();try{const f=localStorage.getItem("token"),N=await fetch(`${X}/reminders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`},body:JSON.stringify(s)});if(!N.ok){const w=await N.json();console.error("Failed to create reminder:",w),alert(`Failed to create reminder: ${w.error||"Unknown error"}`);return}const b=await N.json();i({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),r(!1),x(),alert("Reminder created successfully!")}catch(f){console.error("Failed to create reminder:",f),alert("Failed to create reminder. Please try again.")}},j=async u=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const N=localStorage.getItem("token"),b=await fetch(`${X}/reminders/${u}`,{method:"DELETE",headers:{Authorization:`Bearer ${N}`}});if(!b.ok){const w=await b.json();console.error("Failed to delete reminder:",w),alert(`Failed to delete reminder: ${w.error||"Unknown error"}`);return}x(),alert("Reminder deleted successfully!")}catch(f){console.error("Failed to delete reminder:",f),alert("Failed to delete reminder. Please try again.")}},d=u=>{s.days.includes(u)?i({...s,days:s.days.filter(f=>f!==u)}):i({...s,days:[...s.days,u]})},T=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(ct,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("button",{onClick:()=>r(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(le,{size:20}),"New Reminder"]})]}),e.jsx("div",{className:"grid gap-4",children:t.map(u=>{const f=p.find(N=>N.id===u.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${u.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:u.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",f?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",u.frequency]}),u.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",u.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(Je,{size:16}),"Next: ",new Date(u.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${u.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:u.status}),e.jsx("button",{onClick:()=>j(u.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(ue,{size:20})})]})]})},u.id)})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:g,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:s.customerName,onChange:u=>i({...s,customerName:u.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:s.productId,onChange:u=>i({...s,productId:parseInt(u.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),p.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:s.frequency,onChange:u=>i({...s,frequency:u.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),s.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:T.map(u=>e.jsx("button",{type:"button",onClick:()=>d(u),className:`px-4 py-2 rounded-lg font-medium transition ${s.days.includes(u)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:u},u))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:s.nextDate,onChange:u=>i({...s,nextDate:u.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>r(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})}function Is(){const[t,n]=a.useState([]),[p,h]=a.useState(!1),[c,r]=a.useState(null),[s,i]=a.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});a.useEffect(()=>{x()},[]);const x=async()=>{try{const d=await Re.getAll();n(d)}catch(d){console.error("Failed to load discounts:",d)}},l=async d=>{d.preventDefault();try{c?await Re.update(c.id,s):await Re.create(s),h(!1),r(null),i({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),x()}catch(T){console.error("Failed to save discount:",T)}},g=async d=>{if(confirm("Delete this discount?"))try{await Re.delete(d),x()}catch(T){console.error("Failed to delete discount:",T)}},j=d=>{const T=new Date,u=new Date(d.validFrom),f=new Date(d.validTo);return d.active&&u<=T&&f>=T};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{h(!0),r(null),i({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(d=>e.jsxs("div",{className:`card ${j(d)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${j(d)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(lt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:d.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[d.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${j(d)?"badge-success":"bg-gray-200 text-gray-600"}`,children:j(d)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(d.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(d.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{r(d),i(d),h(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(ye,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>g(d.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(ue,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},d.id)),t.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(lt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[c?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:s.name,onChange:d=>i({...s,name:d.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:s.percentage,onChange:d=>i({...s,percentage:parseFloat(d.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:s.validFrom,onChange:d=>i({...s,validFrom:d.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:s.validTo,onChange:d=>i({...s,validTo:d.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.active,onChange:d=>i({...s,active:d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Ds(){const[t,n]=a.useState([]),[p,h]=a.useState([]),[c,r]=a.useState("all");a.useEffect(()=>{s(),i()},[]);const s=async()=>{try{const u=await at.getAll();n(u)}catch(u){console.error("Failed to load credit requests:",u)}},i=async()=>{try{const u=await ie.getAll();h(u)}catch(u){console.error("Failed to load products:",u)}},x=async u=>{try{await at.approve(u),s()}catch(f){console.error("Failed to approve request:",f)}},l=async u=>{try{await at.reject(u),s()}catch(f){console.error("Failed to reject request:",f)}},g=u=>{const f=p.find(N=>N.id===u);return f?f.name:"Unknown Product"},j=t.filter(u=>c==="all"?!0:u.status===c),d=u=>{switch(u){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},T=u=>{switch(u){case"pending":return e.jsx(Le,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(De,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(ht,{className:"w-6 h-6 text-red-600"});default:return e.jsx(Ke,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(u=>e.jsx("button",{onClick:()=>r(u),className:`px-4 py-2 rounded-lg font-medium transition ${c===u?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:u.charAt(0).toUpperCase()+u.slice(1)},u))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[j.map(u=>e.jsx("div",{className:`card border-l-4 ${d(u.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${u.status==="pending"?"bg-orange-600":u.status==="approved"?"bg-green-600":"bg-red-600"}`,children:T(u.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:u.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:g(u.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:u.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",u.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(u.createdAt).toLocaleString()]}),u.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(u.approvedAt).toLocaleString()]})]})]}),u.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>x(u.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(De,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>l(u.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(ht,{size:16}),"Reject"]})]}),u.status!=="pending"&&e.jsx("span",{className:`badge ${u.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:u.status.toUpperCase()})]})},u.id)),j.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(Ke,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",c!=="all"?c:""," credit requests found."]})]})]})]})}function Lt({onClose:t}){const[n,p]=a.useState([]),[h,c]=a.useState(!0);a.useEffect(()=>{r()},[]);const r=async()=>{try{const i=localStorage.getItem("token"),x=await fetch(`${X}/reminders/today`,{headers:{Authorization:`Bearer ${i}`}});if(!x.ok){console.error("API Error:",x.status,x.statusText),p([]);return}const l=await x.json();Array.isArray(l)?p(l):(console.error("Expected array but got:",typeof l,l),p([]))}catch(i){console.error("Failed to fetch reminders:",i),p([])}finally{c(!1)}},s=async i=>{try{const x=localStorage.getItem("token");await fetch(`${X}/reminders/${i}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify({status:"fulfilled"})}),r()}catch(x){console.error("Failed to update reminder:",x)}};return h?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:t,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(Ie,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_e,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):n.map(i=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:i.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",i.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:i.frequency})]}),e.jsxs("button",{onClick:()=>s(i.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(De,{size:18}),"Mark Done"]})]},i.id))})]})})}function $t({onUnlock:t,userType:n="user"}){const[p,h]=a.useState(""),[c,r]=a.useState(""),[s,i]=a.useState("password"),[x,l]=a.useState(!1),[g,j]=a.useState(""),[d,T]=a.useState(!1),[u,f]=a.useState("2005"),N=JSON.parse(localStorage.getItem("user")||"{}");a.useEffect(()=>{(async()=>{try{const P=await ke.get();P?.screenLockPassword&&f(P.screenLockPassword)}catch(P){console.warn("Failed to load settings, using default password:",P)}})()},[]),a.useEffect(()=>{const D=document.getElementById(s==="password"?"unlock-password":"unlock-pin");D&&D.focus()},[s]);const b=async D=>{D.preventDefault(),D.stopPropagation(),T(!0),j("");try{if(s==="password")if(p===u)t();else throw new Error("Incorrect password");else if(s==="pin"&&N.pin)if(c===N.pin)t();else throw new Error("Incorrect PIN");else throw new Error(`Please enter a valid ${s}`)}catch(P){j(P.message||"Unlock failed")}finally{T(!1)}},w=D=>{const P=D.replace(/\D/g,"").slice(0,4);r(P)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:D=>D.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8",onClick:D=>D.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${n==="main_admin"?"bg-gradient-to-br from-red-600 to-orange-600":"bg-gradient-to-br from-blue-600 to-purple-600"}`,children:e.jsx(ne,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-gray-600",children:n==="main_admin"?"Main Admin":N.name||"User"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Enter your ",s," to continue"]})]}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[n!=="main_admin"&&N.pin&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unlock Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{i("password"),j("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${s==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ”‘ Password"}),e.jsx("button",{type:"button",onClick:()=>{i("pin"),j("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${s==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ“± PIN"})]})]}),(s==="password"||n==="main_admin")&&e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-password",type:x?"text":"password",placeholder:"Enter your password",className:"w-full pl-10 pr-12 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",value:p,onChange:D=>h(D.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>l(!x),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:x?e.jsx(Wt,{className:"w-5 h-5"}):e.jsx(wt,{className:"w-5 h-5"})})]}),s==="pin"&&n!=="main_admin"&&e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-pin",type:"text",placeholder:"Enter 4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-center text-2xl tracking-widest",value:c,onChange:D=>w(D.target.value),maxLength:4,required:!0})]}),g&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg border border-red-200",children:g}),e.jsx("button",{type:"submit",disabled:d||s==="pin"&&c.length!==4,className:`w-full py-3 rounded-lg font-bold transition-all disabled:opacity-50 disabled:cursor-not-allowed ${n==="main_admin"?"bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white":"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white"}`,children:d?"Unlocking...":"Unlock Screen"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Screen locked due to inactivity for security"})})]})})}function Ot(t=6e4){const[n,p]=a.useState(!1),[h,c]=a.useState(Date.now()),r=a.useCallback(()=>{c(Date.now()),n&&p(!1)},[n]),s=a.useCallback(()=>{p(!1),r()},[r]);return a.useEffect(()=>{const i=["mousedown","mousemove","keypress","scroll","touchstart","click"],x=()=>{r()};i.forEach(g=>{document.addEventListener(g,x,!0)});const l=setInterval(()=>{Date.now()-h>t&&!n&&p(!0)},1e3);return()=>{i.forEach(g=>{document.removeEventListener(g,x,!0)}),clearInterval(l)}},[h,t,n,r]),[n,s,r]}function Es(){const{user:t,logout:n,isCashierUserManagementEnabled:p}=he(),h=ve(),c=jt(),[r,s]=a.useState(!0),[i,x]=a.useState(!1),[l,g]=a.useState({}),[j,d]=Ot(45e3);a.useEffect(()=>{const b=()=>{const D=localStorage.getItem("user");if(D){const P=JSON.parse(D);let B=!1;(P.plan==="ultra"||P.role==="admin")&&(P.active||(P.active=!0,B=!0),P.plan==="ultra"&&P.role!=="admin"&&(P.role="admin",B=!0),P.plan==="ultra"&&(!P.price||P.price!==1600)&&(P.price=1600,B=!0),B&&(localStorage.setItem("user",JSON.stringify(P)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};b(),setTimeout(b,100);const w=setTimeout(()=>{x(!0)},1e3);return T(),()=>clearTimeout(w)},[]);const T=async()=>{try{const b=await ke.get();g(b)}catch(b){console.error("Failed to load settings:",b)}},u=async()=>{if(window.confirm("Are you sure you want to clear all sales and data? This action cannot be undone."))try{const b=localStorage.getItem("token");await fetch(`${X}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})}),alert("Data cleared successfully!"),window.location.reload()}catch(b){console.error("Failed to clear data:",b),alert("Failed to clear data")}},f=[{id:"overview",label:"Dashboard",icon:Gt,path:"/admin"},{id:"sales",label:"Sales",icon:Nt,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:Pe,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:St,path:"/admin/recipes"},{id:"expenses",label:"Expenses",icon:He,path:"/admin/expenses"},...p()?[{id:"users",label:"Users",icon:Ne,path:"/admin/users"}]:[],{id:"time",label:"Time Tracking",icon:Le,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:ct,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:Ce,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:lt,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:Ke,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:Vt,path:"/admin/settings"}],N=b=>b==="/admin"?c.pathname==="/admin":c.pathname.startsWith(b);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${r?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[r&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>s(!r),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r?e.jsx(Ie,{className:"w-5 h-5"}):e.jsx(Qt,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:f.map(b=>{const w=b.icon;return e.jsxs("button",{onClick:()=>h(b.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${N(b.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(w,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:b.label})]},b.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(Yt,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:n,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(ot,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Logout"})]}),e.jsxs("button",{onClick:u,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors",children:[e.jsx(Ie,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Clear Data"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:f.find(b=>N(b.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:t?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(yt,{children:[e.jsx(W,{path:"/",element:e.jsx(fs,{})}),e.jsx(W,{path:"/sales",element:e.jsx(vs,{})}),e.jsx(W,{path:"/inventory",element:e.jsx(ys,{})}),e.jsx(W,{path:"/recipes",element:e.jsx(Ns,{})}),e.jsx(W,{path:"/expenses",element:e.jsx(ws,{})}),e.jsx(W,{path:"/reminders",element:e.jsx(As,{})}),e.jsx(W,{path:"/service-fees",element:e.jsx(Ps,{})}),e.jsx(W,{path:"/discounts",element:e.jsx(Is,{})}),e.jsx(W,{path:"/credit-requests",element:e.jsx(Ds,{})}),e.jsx(W,{path:"/users",element:e.jsx(Ss,{})}),e.jsx(W,{path:"/time",element:e.jsx(ks,{})}),e.jsx(W,{path:"/settings",element:e.jsx(Cs,{})})]})})]}),i&&e.jsx(Lt,{onClose:()=>x(!1)}),j&&e.jsx($t,{onUnlock:d,logo:l.logo})]})}function Ts(){const t=ve(),[n,p]=a.useState(!1),[h,c]=a.useState(0),r=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 900) or Ultra (KSH 1,600) package",image:"ðŸ“",details:"First user becomes Admin automatically. Choose Ultra for full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],s=[{icon:Pe,title:"Smart Inventory",desc:"Track raw materials & composite products with automatic stock deduction"},{icon:St,title:"Recipe Builder",desc:"Create bundled products with BOM and auto-calculate COGS"},{icon:Se,title:"Real-time Analytics",desc:"Monitor sales, profit margins, and expenses in real-time"},{icon:Ne,title:"User Management",desc:"Add cashiers with custom permissions and role-based access"},{icon:Ae,title:"Secure & Reliable",desc:"JWT authentication with role-based security"},{icon:Ee,title:"Advanced Reports",desc:"Daily, weekly summaries with profit/loss tracking"}],i=[{name:"Basic",price:900,icon:Ct,popular:!1,features:["Cashier Dashboard","Basic Inventory","Sales Tracking","Daily/Weekly Reports","Single User","Email Support"]},{name:"Ultra",price:1600,icon:Pt,popular:!0,features:["Admin + Cashier Dashboard","Full Inventory Management","Recipe/BOM Builder","Auto Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Unlimited Users","Priority Support"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/auth/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(Zt,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(Fe,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>p(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(kt,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 30-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ee,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:s.map((x,l)=>{const g=x.icon;return e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(g,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:x.title}),e.jsx("p",{className:"text-gray-600",children:x.desc})]},l)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:i.map((x,l)=>{const g=x.icon;return e.jsxs("div",{className:`relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${x.popular?"ring-4 ring-blue-600":""}`,children:[x.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${x.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(g,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:x.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",x.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:x.features.map((j,d)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:j})]},d))}),e.jsx("button",{onClick:()=>t("/plans"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${x.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},l)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>t("/plans"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(Fe,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{p(!1),c(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Ie,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",h+1," of ",r.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((h+1)/r.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(h+1)/r.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:r[h].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:r[h].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:r[h].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:r[h].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>c(Math.max(0,h-1)),disabled:h===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),h<r.length-1?e.jsxs("button",{onClick:()=>c(h+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(Fe,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{p(!1),c(0),t("/plans")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(Fe,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:r.map((x,l)=>e.jsx("button",{onClick:()=>c(l),className:`w-2 h-2 rounded-full transition-all ${l===h?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},l))})]})]})})]})}function bt(){const t=jt(),[n,p]=a.useState(t.pathname==="/auth/login"),[h,c]=a.useState("password"),[r,s]=a.useState({email:"",password:"",pin:"",name:"",newPassword:"",confirmPassword:""}),[i,x]=a.useState(""),[l,g]=a.useState(!1),[j,d]=a.useState(!1),T=ve(),{login:u}=he(),f=()=>{try{return JSON.parse(localStorage.getItem("selectedPlan")||"null")}catch(b){return console.warn("Invalid selectedPlan in localStorage:",b),null}},N=async b=>{b.preventDefault(),x(""),g(!0);try{if(j){if(r.newPassword!==r.confirmPassword){x("Passwords do not match"),g(!1);return}if(r.newPassword.length<6){x("Password must be at least 6 characters"),g(!1);return}const q=await je.login({email:r.email,newPassword:r.newPassword});q.token&&q.user&&(await u(q),T("/dashboard"));return}if(n){if(h==="pin"){if(!r.pin||r.pin.length!==4){x("Please enter a valid 4-digit PIN"),g(!1);return}}else if(!r.password){x("Please enter your password"),g(!1);return}}let w;if(n)if(h==="pin")try{w=await je.pinLogin({email:r.email,pin:r.pin})}catch(q){if(q.message.includes("PIN not set"))x("PIN not set for this user. Please use password login.");else if(q.message.includes("Invalid PIN"))x("Invalid PIN. Please try again.");else throw q;g(!1);return}else w=await je.login({email:r.email,password:r.password});else{const q=f();w=await je.signup({...r,plan:q?.id||"basic"})}if(w.needsPasswordSetup){d(!0),s({...r,email:w.email}),x(""),g(!1);return}if(!w||!w.user||!w.token)throw new Error("Authentication failed. Please try again.");const D={id:Date.now(),type:n?"login":"signup",user:{id:w.user.id,name:w.user.name,email:w.user.email,role:w.user.role,plan:w.user.plan},timestamp:new Date().toISOString(),ip:"Unknown",userAgent:navigator.userAgent},P=JSON.parse(localStorage.getItem("authActivities")||"[]");P.unshift(D),P.splice(50),localStorage.setItem("authActivities",JSON.stringify(P)),await u(w);const B=n?"logged in":"signed up";console.log(`âœ… User ${w.user.name} ${B} successfully`),w.user.role==="admin"?T("/admin"):w.user.role==="cashier"||w.user.plan==="basic"?T("/dashboard/cashier"):T("/admin")}catch(w){console.error("Authentication error:",w);let D=w.message||"Authentication failed. Please try again.";w.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),D="Invalid credentials. Please try again."),x(D)}finally{g(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:n?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600",children:n?"Login to your account":"Create your account"})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[j?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.newPassword,onChange:b=>s({...r,newPassword:b.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.confirmPassword,onChange:b=>s({...r,confirmPassword:b.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!n&&e.jsxs("div",{className:"relative",children:[e.jsx(it,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.name,onChange:b=>s({...r,name:b.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.email,onChange:b=>s({...r,email:b.target.value}),required:!0})]}),n&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Login Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>c("password"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${h==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Password"}),e.jsx("button",{type:"button",onClick:()=>c("pin"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${h==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"pin"})]})]}),n&&h==="password"&&e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.password,onChange:b=>s({...r,password:b.target.value}),required:!0})]}),n&&h==="pin"&&e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.pin,onChange:b=>s({...r,pin:b.target.value.replace(/\D/g,"").slice(0,4)}),maxLength:4,required:!0})]}),!n&&e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.password,onChange:b=>s({...r,password:b.target.value}),required:!0})]})]}),i&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:i}),e.jsx("button",{type:"submit",disabled:l,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50",children:l?"Please wait...":j?"Set Password":n?"Login":"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{p(!n),x(""),d(!1)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:n?"Don't have an account? Sign up":"Already have an account? Login"})})]})})}function Ls(){const[t,n]=a.useState("ultra"),[p,h]=a.useState(!1),[c,r]=a.useState({name:"",email:"",company:""}),s=ve(),i=[{id:"basic",name:"Basic Package",price:1e3,icon:Ct,color:"from-green-500 to-teal-600",features:["Cashier Dashboard Only","Basic Inventory Management","Sales Tracking","Daily/Weekly Sales Summaries","Basic Profit/Loss View","Limited Email Notifications","Record Products Sold","Single User Access"]},{id:"ultra",name:"Ultra Package (Admin + Cashier)",price:2400,icon:Pt,color:"from-blue-600 to-purple-600",popular:!0,features:["Admin Dashboard + Cashier POS","Full Inventory Management","Recipe/BOM Builder","Composite Products Support","Automatic Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Advanced Analytics","Unlimited Users"]}],x=async l=>{l.preventDefault();try{await fetch(`${X}/demo-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),alert("Demo request submitted! Admin will review and contact you."),h(!1),r({name:"",email:"",company:""})}catch(g){console.error("Demo request failed:",g),alert("Failed to submit demo request. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:()=>s("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition",children:[e.jsx(es,{size:20}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mb-8 md:mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Select the perfect plan for your business needs"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6 md:mb-8",children:i.map(l=>{const g=l.icon;return e.jsxs("div",{onClick:()=>n(l.id),className:`card cursor-pointer transition-all transform hover:scale-105 relative ${t===l.id?"ring-4 ring-blue-600 shadow-2xl bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-xl"}`,children:[l.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 md:mb-4",children:[e.jsx("div",{className:`w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br ${l.color} flex items-center justify-center`,children:e.jsx(g,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:l.name})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("span",{className:"text-3xl md:text-4xl font-bold",children:["KSH ",l.price]}),e.jsx("span",{className:"text-gray-600 text-sm md:text-base",children:"/month"})]}),e.jsx("ul",{className:"space-y-2 md:space-y-3",children:l.features.map((j,d)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(We,{className:"w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs md:text-sm",children:j})]},d))})]},l.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center animate-fade-in",children:[e.jsx("button",{onClick:()=>{console.log("Get Started clicked with plan:",t);const l=i.find(g=>g.id===t);console.log("Selected plan:",l),localStorage.setItem("selectedPlan",JSON.stringify(l)),s("/auth/signup")},className:"btn-primary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all",children:"Get Started"}),e.jsx("button",{onClick:()=>h(!0),className:"btn-secondary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg border-2 border-gray-300 hover:border-gray-400 transition-all",children:"Request Free Demo"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-3 md:mt-4 text-center",children:"Secure payment â€¢ Cancel anytime"}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Free Demo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"We'll contact you to schedule a demo"})]}),e.jsxs("form",{onSubmit:x,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:c.name,onChange:l=>r({...c,name:l.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:c.email,onChange:l=>r({...c,email:l.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:c.company,onChange:l=>r({...c,company:l.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition",children:"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})})}function $s(){const{user:t,logout:n}=he(),[p,h]=a.useState([]),[c,r]=a.useState([]),[s,i]=a.useState([]),[x,l]=a.useState("cash"),[g,j]=a.useState("pos"),[d,T]=a.useState({sales:[],expenses:[],stats:{}}),[u,f]=a.useState(""),[N,b]=a.useState(!1),[w,D]=a.useState(!1),[P,B]=a.useState(null),[q,S]=a.useState({name:"",price:"",cost:"",category:"finished",image:""}),[v,k]=a.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[L,V]=a.useState(!1),[Y,de]=a.useState({description:"",amount:"",category:""}),[pe,_]=a.useState(""),[te,Q]=a.useState([]),[R,O]=a.useState(null),[K,y]=a.useState("exclusive"),[F,U]=a.useState(!1),[Z,G]=a.useState(null),[ce,oe]=a.useState(null);a.useEffect(()=>{me();const o=localStorage.getItem(`cart_${t?.id}`),E=localStorage.getItem(`paymentMethod_${t?.id}`),I=localStorage.getItem(`selectedDiscount_${t?.id}`),$=localStorage.getItem(`taxType_${t?.id}`),z=localStorage.getItem(`clockStatus_${t?.id}`),ae=localStorage.getItem(`clockInTime_${t?.id}`);if(o)try{i(JSON.parse(o))}catch(Oe){console.warn("Failed to restore cart:",Oe)}if(E&&l(E),$&&y($),I)try{O(JSON.parse(I))}catch{}z==="clocked_in"&&(U(!0),ae&&oe(new Date(ae))),Xe()},[t?.id]),a.useEffect(()=>{const o=localStorage.getItem("token");o&&Qe.connect(o,I=>{if(I&&I.allProducts){const $=I.allProducts.filter(z=>z.visibleToCashier!==!1&&!z.expenseOnly);h($)}I&&I.discounts&&Q(I.discounts),I&&I.sale&&me()}).catch(I=>{console.warn("WebSocket connection failed:",I)});const E=us(I=>{try{if(!I)return;(I.type==="initial"||I.type==="products_snapshot"||I.type==="product_created"||I.type==="product_updated"||I.type==="product_deleted")&&ie.getAll().then($=>h($.filter(z=>z.visibleToCashier!==!1&&!z.expenseOnly))).catch(()=>{})}catch($){console.error("Product subscription handler error",$)}});return()=>{try{E()}catch{}Qe.disconnect()}},[]),a.useEffect(()=>{(s.length>0||x||K)&&$e()},[s,x,K,R,t?.id]);const $e=()=>{localStorage.setItem(`cart_${t?.id}`,JSON.stringify(s)),localStorage.setItem(`paymentMethod_${t?.id}`,x),localStorage.setItem(`taxType_${t?.id}`,K),R&&localStorage.setItem(`selectedDiscount_${t?.id}`,JSON.stringify(R))},Ye=async()=>{try{const o=await fetch(`${X}/time-entries`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({action:"clock_in"})});if(o.ok){const E=await o.json();G(E),U(!0);const I=new Date;oe(I),localStorage.setItem(`clockStatus_${t?.id}`,"clocked_in"),localStorage.setItem(`clockInTime_${t?.id}`,I.toISOString()),alert("Clocked in successfully!")}}catch(o){console.error("Clock in failed:",o),alert("Failed to clock in")}},Ze=async()=>{try{const o=await fetch(`${X}/time-entries`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({action:"clock_out"})});if(o.ok){const E=await o.json();G(E),U(!1),oe(null),localStorage.removeItem(`clockStatus_${t?.id}`),localStorage.removeItem(`clockInTime_${t?.id}`);const I=Math.floor(E.duration/60),$=E.duration%60;alert(`Clocked out successfully! Total time: ${I}h ${$}m`)}}catch(o){console.error("Clock out failed:",o),alert("Failed to clock out")}},Xe=async()=>{try{const o=await fetch(`${X}/time-entries/today`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(o.ok){const I=(await o.json()).find($=>$.cashierId===t?.id&&$.status==="clocked_in");I&&(G(I),U(!0),oe(new Date(I.clockInTime)))}}catch(o){console.warn("Failed to check clock status:",o)}},me=async()=>{try{const[o,E,I,$,z]=await Promise.all([ie.getAll(),Te.getAll(),Ge.getAll(),Dt.get(),Ve.getAll()]);h(o.filter(ae=>ae.visibleToCashier!==!1&&!ae.expenseOnly)),T({sales:E,expenses:I,stats:$}),r(z);try{const ae=await fetch(`${X}/discounts`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(Oe=>Oe.json());Q(ae||[])}catch(ae){console.warn("Failed to load discounts:",ae)}}catch(o){console.error("Failed to load data:",o)}},et=(o,E=!0)=>{const I=o.target.files[0];if(I){const $=new FileReader;$.onload=z=>{const ae=z.target.result;_(ae),E&&S({...q,image:ae})},$.readAsDataURL(I)}},fe=o=>c.filter(I=>I.productId===o&&I.quantity>0).reduce((I,$)=>I+$.quantity,0),tt=o=>{const E=fe(o.id);if(E<=0){alert("Product is out of stock!");return}const I=s.find(z=>z.id===o.id);if((I?I.quantity:0)>=E){alert(`Only ${E} units available in stock!`);return}i(I?s.map(z=>z.id===o.id?{...z,quantity:z.quantity+1}:z):[...s,{...o,quantity:1}])},m=(o,E)=>{p.find($=>$.id===o);const I=fe(o);i(s.map($=>{if($.id===o){const z=$.quantity+E;return z>I?(alert(`Only ${I} units available!`),$):{...$,quantity:Math.max(1,z)}}return $}).filter($=>$.quantity>0))},C=o=>{i(s.filter(E=>E.id!==o))},A=s.reduce((o,E)=>o+E.price*E.quantity,0),J=async()=>{if(s.length!==0)try{const o=R?R.type==="percentage"?A*R.value/100:R.value:0,E=A*.16,I=K==="inclusive"?A-o:A-o+E;await Te.create({items:s.map($=>({productId:$.id,quantity:$.quantity,price:$.price})),total:I,discount:o,tax:E,taxType:K,paymentMethod:x}),i([]),O(null),y("exclusive"),await me(),alert("Sale completed successfully!")}catch(o){console.error("Checkout failed:",o),alert("Sale failed. Please try again.")}},H=async o=>{o.preventDefault();try{await ie.create({...q,price:parseFloat(q.price),cost:parseFloat(q.cost||0),quantity:0}),S({name:"",price:"",cost:"",category:"finished",image:""}),_(""),b(!1),await me(),alert("Product added successfully!")}catch(E){console.error("Failed to add product:",E),alert("Failed to add product")}},ee=async o=>{o.preventDefault();try{const E=Array.isArray(c)?c:[],$={id:E.length>0?Math.max(...E.map(z=>z.id||0))+1:1,productId:P.id,quantity:parseInt(v.quantity),expiryDate:v.expiryDate,batchNumber:v.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(v.cost||P.cost||0)};r(z=>[...z,$]),await Ve.create({productId:P.id,quantity:parseInt(v.quantity),expiryDate:v.expiryDate,batchNumber:v.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(v.cost||P.cost||0)}),k({quantity:"",expiryDate:"",batchNumber:"",cost:""}),D(!1),B(null),await me(),alert("Stock added successfully!")}catch(E){console.error("Failed to add stock:",E),alert("Failed to add stock")}},ge=async o=>{o.preventDefault();try{await Ge.create({...Y,amount:parseFloat(Y.amount)}),de({description:"",amount:"",category:""}),V(!1),await me()}catch(E){console.error("Failed to add expense:",E),alert("Failed to add expense")}},xe=async()=>{if(window.confirm("Are you sure you want to clear all sales and data? This action cannot be undone."))try{const o=localStorage.getItem("token");await fetch(`${X}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})}).catch(()=>{}),T({sales:[],expenses:[],stats:{totalSales:0,totalExpenses:0,profit:0}}),i([]),alert("Data cleared successfully!"),await me()}catch(o){console.error("Failed to clear data:",o),alert("Failed to clear data")}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Cashier Dashboard"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cashier Plan - KSH 900/month"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),F&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-green-600 font-semibold",children:"ðŸŸ¢ Clocked In"}),e.jsxs("button",{onClick:Ze,className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-600 hover:bg-red-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(ts,{className:"w-4 h-4"}),"Clock Out"]})]}),!F&&e.jsxs("button",{onClick:Ye,className:"px-4 py-2 rounded-lg font-medium transition-all bg-green-600 hover:bg-green-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(kt,{className:"w-4 h-4"}),"Clock In"]}),e.jsxs("button",{onClick:()=>{$e(),n()},className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-100 hover:bg-red-200 text-red-600 border border-red-300 flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4"}),"Logout"]}),e.jsxs("button",{onClick:xe,className:"px-4 py-2 rounded-lg font-medium transition-all bg-orange-100 hover:bg-orange-200 text-orange-600 border border-orange-300 flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Clear"]}),F&&ce&&e.jsx("div",{className:"ml-auto text-right text-xs",children:e.jsxs("p",{className:"text-green-600 font-semibold flex items-center gap-1",children:[e.jsx(Le,{className:"w-4 h-4"}),"Clocked In: ",ce.toLocaleTimeString()]})})]})]})}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>j("pos"),className:`px-6 py-2 rounded-lg font-medium transition-all ${g==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Me,{className:"w-4 h-4 inline mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>j("monitor"),className:`px-6 py-2 rounded-lg font-medium transition-all ${g==="monitor"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ee,{className:"w-4 h-4 inline mr-2"}),"Monitor"]}),e.jsxs("button",{onClick:()=>j("products"),className:`px-6 py-2 rounded-lg font-medium transition-all ${g==="products"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Pe,{className:"w-4 h-4 inline mr-2"}),"Products"]}),e.jsxs("button",{onClick:()=>j("expenses"),className:`px-6 py-2 rounded-lg font-medium transition-all ${g==="expenses"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(He,{className:"w-4 h-4 inline mr-2"}),"Expenses"]})]}),g==="pos"&&e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(nt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:u,onChange:o=>f(o.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:p.filter(o=>o.name?.toLowerCase().includes(u.toLowerCase())).map(o=>{const E=fe(o.id),I=E<10,$=E<=0;return e.jsxs("button",{onClick:()=>tt(o),disabled:$,className:`card text-left hover:shadow-xl transition-all transform hover:scale-105 relative ${$?"opacity-50 cursor-not-allowed bg-gray-100":"bg-gradient-to-br from-white to-gray-50"}`,children:[o.image&&e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:o.image,alt:o.name,className:"w-full h-full object-cover"})}),I&&!$&&e.jsx("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white p-1 rounded-full",children:e.jsx(ze,{className:"w-4 h-4"})}),$&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"OUT"}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-900",children:o.name}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["KSH ",o.price?.toLocaleString()]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:`text-xs font-medium ${$?"text-red-600":I?"text-yellow-600":"text-gray-500"}`,children:["Stock: ",E]}),I&&!$&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium",children:"Low Stock"})]})]},o.id)})})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-gray-200 p-6 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(Me,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[s.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:s.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(Me,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:s.map(o=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:o.name}),e.jsx("button",{onClick:()=>C(o.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(ue,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>m(o.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(ss,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-semibold",children:o.quantity}),e.jsx("button",{onClick:()=>m(o.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(le,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(o.price*o.quantity).toLocaleString()]})]})]},o.id))})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"text-gray-700",children:["KSH ",A.toLocaleString()]})]}),R&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-KSH ",(R.type==="percentage"?A*R.value/100:R.value).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-orange-600",children:[e.jsxs("span",{children:["Tax (",K==="exclusive"?"Added":"Included","):"]}),e.jsxs("span",{children:[K==="exclusive"?"+":"","KSH ",((A-(R?R.type==="percentage"?A*R.value/100:R.value:0))*.16).toLocaleString()]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Final Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(K==="exclusive"?A-(R?R.type==="percentage"?A*R.value/100:R.value:0)+(A-(R?R.type==="percentage"?A*R.value/100:R.value:0))*.16:A-(R?R.type==="percentage"?A*R.value/100:R.value:0)).toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Discount (Optional)"}),e.jsxs("select",{value:R?.id||"",onChange:o=>{o.target.value?O(te.find(E=>E.id===parseInt(o.target.value))):O(null)},className:"input",children:[e.jsx("option",{value:"",children:"No Discount"}),te.filter(o=>o.active).map(o=>e.jsxs("option",{value:o.id,children:[o.name," - ",o.type==="percentage"?`${o.value}%`:`KSH ${o.value}`]},o.id))]}),R&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Discount: KSH ",(R.type==="percentage"?A*R.value/100:R.value).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tax Type"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"exclusive",checked:K==="exclusive",onChange:o=>y(o.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Exclusive (16% added)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"inclusive",checked:K==="inclusive",onChange:o=>y(o.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Inclusive"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:x,onChange:o=>l(o.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:J,disabled:s.length===0,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg",children:"Complete Sale"})]})]})]}),g==="monitor"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",d.stats.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Ce,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",d.stats.totalExpenses?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(He,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",d.stats.profit?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Ce,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Sales"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"})]})}),e.jsx("tbody",{children:d.sales.slice(-15).reverse().map((o,E)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(o.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[o.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:o.paymentMethod||"cash"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",o.total?.toLocaleString()]})]},E))})]})})]})]}),g==="products"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Manage Products & Stock"}),e.jsxs("button",{onClick:()=>b(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Product"]})]}),N&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl border-2 border-green-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Product"}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:q.name,onChange:o=>S({...q,name:o.target.value}),required:!0}),e.jsxs("select",{className:"input",value:q.category,onChange:o=>S({...q,category:o.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsx("input",{type:"number",placeholder:"Selling Price",className:"input",value:q.price,onChange:o=>S({...q,price:o.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Cost Price (Optional)",className:"input",value:q.cost,onChange:o=>S({...q,cost:o.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:o=>et(o,!0),className:"input"}),e.jsx(vt,{className:"w-5 h-5 text-gray-400"})]}),pe&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:pe,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{b(!1),_(""),S({name:"",price:"",cost:"",category:"finished",image:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),w&&P&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"font-semibold mb-4 text-lg",children:["Add Stock for ",P.name]}),e.jsxs("form",{onSubmit:ee,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:v.quantity,onChange:o=>k({...v,quantity:o.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:v.expiryDate,onChange:o=>k({...v,expiryDate:o.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:v.batchNumber,onChange:o=>k({...v,batchNumber:o.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per Unit",className:"input",value:v.cost,onChange:o=>k({...v,cost:o.target.value})}),e.jsxs("div",{className:"flex gap-2 md:col-span-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{D(!1),B(null),k({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:p.map(o=>{const E=fe(o.id),I=c.filter(z=>z.productId===o.id&&z.quantity>0),$=E<10;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[o.image&&e.jsx("img",{src:o.image,alt:o.name,className:"w-10 h-10 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:o.name}),e.jsx("div",{className:"text-xs text-gray-500",children:o.category})]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",o.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium ${E===0?"text-red-600":$?"text-yellow-600":"text-gray-900"}`,children:E}),$&&E>0&&e.jsx(ze,{className:"w-4 h-4 text-yellow-500"}),E===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"text-gray-600",children:[I.length," active"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{B(o),D(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-green-50 rounded-lg text-green-600 transition-colors",title:"Edit Product",children:e.jsx(ye,{className:"w-4 h-4"})})]})})]},o.id)})})]})})]})}),g==="expenses"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Track Expenses"}),e.jsxs("button",{onClick:()=>V(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700",children:[e.jsx(le,{className:"w-4 h-4"}),"Add Expense"]})]}),L&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border-2 border-red-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Expense"}),e.jsxs("form",{onSubmit:ge,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:Y.description,onChange:o=>de({...Y,description:o.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Amount",className:"input",value:Y.amount,onChange:o=>de({...Y,amount:o.target.value}),required:!0}),e.jsx("input",{type:"text",placeholder:"Category",className:"input",value:Y.category,onChange:o=>de({...Y,category:o.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>V(!1),className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:d.expenses.slice().reverse().map((o,E)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(o.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:o.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:o.category||"General"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",o.amount?.toLocaleString()]})]},E))})]})})]})})]})}function Os(){const[t,n]=a.useState("login"),[p,h]=a.useState({email:"",password:""}),[c,r]=a.useState(!1),[s,i]=a.useState(""),[x,l]=a.useState([]),[g,j]=a.useState({}),[d,T]=a.useState(""),[u,f]=a.useState("all"),[N,b]=a.useState(null);ve(),a.useEffect(()=>{const S=localStorage.getItem("ownerToken"),v=localStorage.getItem("ownerUser");if(S&&v)try{JSON.parse(v).role==="owner"&&(n("dashboard"),w())}catch{localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser")}},[]),a.useEffect(()=>{const S=()=>{w()};return window.addEventListener("dataUpdated",S),window.addEventListener("userDeleted",S),window.addEventListener("saleDeleted",S),()=>{window.removeEventListener("dataUpdated",S),window.removeEventListener("userDeleted",S),window.removeEventListener("saleDeleted",S)}},[]);const w=async()=>{try{const[S,v]=await Promise.all([qe.getUsers(),qe.getStats()]);l(S||[]),j(v||{})}catch(S){console.error("Failed to load data:",S),i("Failed to load dashboard data")}},D=async S=>{S.preventDefault(),r(!0),i("");try{if(!p.email||!p.password)throw new Error("Email and password required");const v=await qe.login(p);if(v.token&&v.user&&v.user.role==="owner")localStorage.setItem("ownerToken",v.token),localStorage.setItem("ownerUser",JSON.stringify(v.user)),n("dashboard"),await w();else throw new Error("Invalid credentials")}catch(v){console.error("Login error:",v),i(v.message||"Login failed")}finally{r(!1)}},P=()=>{localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser"),h({email:"",password:""}),i(""),n("login")},B=async S=>{try{b(S);const v=x.find(k=>k.id===S);if(!v)return;await qe.lockUser(S,!v.locked),await w()}catch{i("Failed to lock/unlock user")}finally{b(null)}},q=x.filter(S=>{const v=S.name?.toLowerCase().includes(d.toLowerCase())||S.email?.toLowerCase().includes(d.toLowerCase()),k=u==="all"||u==="active"&&S.active&&!S.locked||u==="locked"&&S.locked||u==="inactive"&&!S.active;return v&&k});return t==="login"?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg mx-auto mb-4 flex items-center justify-center",children:e.jsx(Ee,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"MTC Admin"}),e.jsx("p",{className:"text-purple-300",children:"System Owner Portal"})]}),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-xl border border-purple-500/20 rounded-2xl p-8 shadow-2xl",children:[e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[s&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:[e.jsx(_e,{className:"w-5 h-5 text-red-400"}),e.jsx("p",{className:"text-red-300 text-sm",children:s})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email"}),e.jsx("input",{type:"email",placeholder:"ianmabruk3@gmail.com",className:"w-full px-4 py-3 bg-slate-700/50 border border-purple-500/20 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 transition",value:p.email,onChange:S=>h({...p,email:S.target.value}),disabled:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Enter password",className:"w-full px-4 py-3 bg-slate-700/50 border border-purple-500/20 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 transition",value:p.password,onChange:S=>h({...p,password:S.target.value}),disabled:c})]}),e.jsx("button",{type:"submit",disabled:c,className:"w-full py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold rounded-lg hover:from-purple-700 hover:to-pink-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Logging in...":"Access Dashboard"})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-purple-500/20",children:e.jsx("p",{className:"text-gray-400 text-xs text-center",children:"ðŸ”’ Owner access only â€¢ Limited to ianmabruk3@gmail.com"})})]})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900/50 to-slate-900",children:[e.jsx("div",{className:"sticky top-0 z-40 bg-slate-800/80 backdrop-blur-xl border-b border-purple-500/10",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(Ee,{className:"w-6 h-6 text-purple-400"}),"MTC Admin Dashboard"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"System owner portal"})]}),e.jsxs("button",{onClick:P,className:"px-4 py-2 flex items-center gap-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 rounded-lg transition border border-red-500/30",children:[e.jsx(ot,{className:"w-4 h-4"}),"Logout"]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/5 border border-blue-500/20 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:x.length})]}),e.jsx(Ne,{className:"w-10 h-10 text-blue-400 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-green-500/10 to-green-600/5 border border-green-500/20 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:x.filter(S=>S.active&&!S.locked).length})]}),e.jsx(De,{className:"w-10 h-10 text-green-400 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-orange-500/10 to-orange-600/5 border border-orange-500/20 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Locked Users"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:x.filter(S=>S.locked).length})]}),e.jsx(ne,{className:"w-10 h-10 text-orange-400 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-purple-500/10 to-pink-600/5 border border-purple-500/20 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold text-white mt-2",children:["KSH ",((g?.totalSales??0)||0).toLocaleString()]})]}),e.jsx(Se,{className:"w-10 h-10 text-purple-400 opacity-50"})]})})]}),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-xl border border-purple-500/10 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-purple-400"}),"User Management"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:u,onChange:S=>f(S.target.value),className:"px-3 py-2 bg-slate-700/50 border border-purple-500/20 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"locked",children:"Locked"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(nt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Search users...",className:"pl-10 pr-4 py-2 bg-slate-700/50 border border-purple-500/20 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-purple-500",value:d,onChange:S=>T(S.target.value)})]})]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b border-purple-500/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-gray-400 font-semibold",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-400 font-semibold",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-400 font-semibold",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-400 font-semibold",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-400 font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-400 font-semibold",children:"Days Used"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-400 font-semibold",children:"Actions"})]})}),e.jsx("tbody",{children:q.map(S=>e.jsxs("tr",{className:"border-b border-purple-500/5 hover:bg-slate-700/30 transition",children:[e.jsx("td",{className:"px-4 py-3 text-white font-medium",children:S.name||"N/A"}),e.jsx("td",{className:"px-4 py-3 text-gray-300",children:S.email}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${S.planType==="paid"?"bg-green-500/30 text-green-300":S.planType==="trial"?"bg-yellow-500/30 text-yellow-300":"bg-gray-500/30 text-gray-300"}`,children:(S.plan||S.planType||"free_demo").toUpperCase()})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${S.role==="owner"?"bg-purple-500/30 text-purple-300":S.role==="admin"?"bg-blue-500/30 text-blue-300":"bg-gray-500/30 text-gray-300"}`,children:S.role||"user"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center gap-2",children:S.locked?e.jsxs("span",{className:"flex items-center gap-1 text-orange-300 text-xs",children:[e.jsx(ne,{className:"w-3 h-3"})," Locked"]}):S.active?e.jsxs("span",{className:"flex items-center gap-1 text-green-300 text-xs",children:[e.jsx(De,{className:"w-3 h-3"})," Active"]}):e.jsxs("span",{className:"flex items-center gap-1 text-gray-400 text-xs",children:[e.jsx(as,{className:"w-3 h-3"})," Inactive"]})})}),e.jsxs("td",{className:"px-4 py-3 text-gray-300",children:[S.daysUsed||0," days"]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>B(S.id),disabled:N===S.id||S.role==="owner",className:"p-2 hover:bg-purple-500/20 rounded-lg text-purple-300 transition disabled:opacity-50 disabled:cursor-not-allowed",title:S.role==="owner"?"Cannot lock owner":S.locked?"Unlock user":"Lock user",children:S.locked?e.jsx(rs,{className:"w-4 h-4"}):e.jsx(ne,{className:"w-4 h-4"})})})]},S.id))})]}),q.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("p",{children:"No users found"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-8",children:[e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-xl border border-purple-500/10 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"System Statistics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Total Expenses"}),e.jsxs("span",{className:"text-white font-semibold",children:["KSH ",(g.totalExpenses||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Net Profit"}),e.jsxs("span",{className:"text-green-400 font-semibold",children:["KSH ",(g.profit||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Products Count"}),e.jsx("span",{className:"text-white font-semibold",children:g.productsCount||0})]})]})]}),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-xl border border-purple-500/10 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{className:"w-full px-4 py-2 bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 rounded-lg transition border border-purple-500/30 text-sm font-medium",children:"ðŸ“Š View Analytics"}),e.jsx("button",{className:"w-full px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 rounded-lg transition border border-blue-500/30 text-sm font-medium",children:"ðŸ“¥ Export Data"}),e.jsx("button",{className:"w-full px-4 py-2 bg-orange-500/20 hover:bg-orange-500/30 text-orange-300 rounded-lg transition border border-orange-500/30 text-sm font-medium",children:"âš™ï¸ System Settings"})]})]})]})]})]})}function rt({children:t,adminOnly:n=!1,ultraOnly:p=!1,ownerOnly:h=!1}){const{user:c,loading:r}=he(),[s,i]=a.useState(!1),x=Ot(6e4),l=x?.[0]||!1,g=x?.[1]||(()=>{}),[j,d]=a.useState({});if(a.useEffect(()=>{c&&!h&&((async()=>{try{const f=localStorage.getItem("token"),b=await fetch(`${X}/settings`,{headers:{Authorization:`Bearer ${f}`}});if(b.ok){const w=await b.json();d(w)}}catch(f){console.error("Failed to load settings:",f)}})(),i(!0))},[c,h]),r&&!h)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(h){const u=localStorage.getItem("ownerToken"),f=localStorage.getItem("ownerUser");if(!u||!f)return e.jsx(se,{to:"/main.admin"});try{if(JSON.parse(f).type!=="main_admin")return e.jsx(se,{to:"/main.admin"})}catch{return e.jsx(se,{to:"/main.admin"})}}else{if(!c)return e.jsx(se,{to:"/auth/login"});if(!c.active)return e.jsx(se,{to:"/plans"});if(n&&c.role!=="admin")return e.jsx(se,{to:"/dashboard"});if(p&&(c.role!=="admin"||c.plan!=="ultra"))return e.jsx(se,{to:"/dashboard"})}const T=h?"owner":"user";return e.jsxs(e.Fragment,{children:[l&&e.jsx($t,{onUnlock:g,userType:T}),s&&e.jsx(Lt,{onClose:()=>i(!1)}),t]})}function Fs(){const{user:t}=he();return!t||!t.active?e.jsx(se,{to:"/plans"}):t.role==="admin"?e.jsx(se,{to:"/admin"}):e.jsx(se,{to:"/dashboard/cashier"})}function Us(){return e.jsx(hs,{children:e.jsx(gs,{children:e.jsx(qt,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(yt,{children:[e.jsx(W,{path:"/",element:e.jsx(Ts,{})}),e.jsx(W,{path:"/auth/login",element:e.jsx(bt,{})}),e.jsx(W,{path:"/auth/signup",element:e.jsx(bt,{})}),e.jsx(W,{path:"/plans",element:e.jsx(Ls,{})}),e.jsx(W,{path:"/main.admin/*",element:e.jsx(Os,{})}),e.jsx(W,{path:"/dashboard",element:e.jsx(rt,{children:e.jsx(Fs,{})})}),e.jsx(W,{path:"/dashboard/cashier",element:e.jsx(rt,{children:e.jsx($s,{})})}),e.jsx(W,{path:"/admin/*",element:e.jsx(rt,{adminOnly:!0,children:e.jsx(Es,{})})}),e.jsx(W,{path:"/login",element:e.jsx(se,{to:"/auth/login"})}),e.jsx(W,{path:"/signup",element:e.jsx(se,{to:"/auth/signup"})}),e.jsx(W,{path:"/subscription",element:e.jsx(se,{to:"/plans"})}),e.jsx(W,{path:"/payment",element:e.jsx(se,{to:"/plans"})}),e.jsx(W,{path:"/cashier",element:e.jsx(se,{to:"/dashboard/cashier"})})]})})})})}os.createRoot(document.getElementById("root")).render(e.jsx(Mt.StrictMode,{children:e.jsx(Us,{})}));
