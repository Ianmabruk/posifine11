import{a as Ot,b as $t,g as Rt,r as a,u as pe,c as tt,R as gt,d as K,B as qt,N as se,e as Mt}from"./vendor-Ct1st1Nj.js";import{C as Me,D as ue,T as De,P as Ie,S as bt,a as Be,b as ft,c as ie,d as Bt,e as Ht,f as ke,g as Ce,h as oe,i as jt,j as _t,k as zt,L as ne,U as Ye,l as ot,m as ve,E as st,M as dt,n as he,X as Ee,o as Ue,p as Re,q as at,r as ye,s as xt,t as He,B as rt,R as yt,I as Kt,u as _e,v as Qe,w as Ne,x as Ze,y as Nt,z as Jt,A as vt,F as Xe,G as Gt,H as Vt,J as Je,K as Wt,N as Fe,O as Yt,Q as et,Z as lt,V as nt,W as wt,Y as Qt,_ as Zt,$ as Ge,a0 as St,a1 as Xt,a2 as es,a3 as ts}from"./icons-DuD7C0_g.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))j(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&j(l)}).observe(document,{childList:!0,subtree:!0});function f(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function j(i){if(i.ep)return;i.ep=!0;const r=f(i);fetch(i.href,r)}})();var Ve={exports:{}},Pe={};var mt;function ss(){if(mt)return Pe;mt=1;var s=Ot(),o=Symbol.for("react.element"),f=Symbol.for("react.fragment"),j=Object.prototype.hasOwnProperty,i=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function l(p,d,n){var h,g={},c=null,D=null;n!==void 0&&(c=""+n),d.key!==void 0&&(c=""+d.key),d.ref!==void 0&&(D=d.ref);for(h in d)j.call(d,h)&&!r.hasOwnProperty(h)&&(g[h]=d[h]);if(p&&p.defaultProps)for(h in d=p.defaultProps,d)g[h]===void 0&&(g[h]=d[h]);return{$$typeof:o,type:p,key:c,ref:D,props:g,_owner:i.current}}return Pe.Fragment=f,Pe.jsx=l,Pe.jsxs=l,Pe}var ht;function as(){return ht||(ht=1,Ve.exports=ss()),Ve.exports}var e=as(),Oe={},ut;function rs(){if(ut)return Oe;ut=1;var s=$t();return Oe.createRoot=s.createRoot,Oe.hydrateRoot=s.hydrateRoot,Oe}var ls=rs();const ns=Rt(ls),is=()=>"https://posifine22.onrender.com/api",Y=is(),kt=()=>localStorage.getItem("token"),Ct=async(s,o={},f=0,j=3)=>{const i=kt(),r=s.startsWith("/")?s:`/${s}`,l={...o,headers:{"Content-Type":"application/json",...i&&!(r.startsWith("/auth")&&r!=="/auth/me")&&!r.includes("/main-admin/auth/login")&&{Authorization:`Bearer ${i}`},...o.headers}};try{const p=await fetch(`${Y}${r}`,l);if(p.status===401){localStorage.removeItem("token"),localStorage.removeItem("user");const n=window.location.pathname||"";if(!n.includes("/login")&&!n.includes("/signup")&&!n.includes("/auth")&&!n.includes("/main.admin"))try{window.location.href="/login"}catch{}const h=new Error("Unauthorized");throw h.status=401,h}if(p.status===500)throw new Error("Server error 500 - Backend unavailable");if(p.ok)return p.status===204?{success:!0}:await p.json();const d=await p.json().catch(()=>({error:"Network error"}));throw new Error(d.error||`HTTP ${p.status}: ${p.statusText}`)}catch(p){if(p.name==="TypeError"&&p.message.includes("fetch")){if(console.error(`API Fetch Error (attempt ${f+1}/${j+1}):`,p),console.error("Attempted URL:",`${Y}${r}`),f<j){const d=Math.min(1e3*Math.pow(2,f),1e4);return console.log(`Retrying in ${d}ms...`),await new Promise(n=>setTimeout(n,d)),Ct(s,o,f+1,j)}throw new Error("Cannot connect to server. The server may be waking up. Please try again in a moment.")}throw p}},M=(s,o={})=>Ct(s,o,0,3),Se={login:s=>M("/auth/login",{method:"POST",body:JSON.stringify(s)}),pinLogin:s=>M("/auth/pin-login",{method:"POST",body:JSON.stringify(s)}),signup:s=>M("/auth/signup",{method:"POST",body:JSON.stringify(s)}),signupWithPayment:s=>M("/signup-with-payment",{method:"POST",body:JSON.stringify(s)}),me:()=>M("/auth/me")},je={getAll:()=>M("/users"),create:s=>M("/users",{method:"POST",body:JSON.stringify(s)}),update:(s,o)=>M(`/users/${s}`,{method:"PUT",body:JSON.stringify(o)}),delete:s=>M(`/users/${s}`,{method:"DELETE"}),setPin:(s,o)=>M(`/users/${s}/set-pin`,{method:"POST",body:JSON.stringify({pin:o})}),lock:(s,o)=>M(`/users/${s}/lock`,{method:"POST",body:JSON.stringify({locked:o})})},ce={getAll:()=>M("/products"),create:s=>M("/products",{method:"POST",body:JSON.stringify(s)}),update:(s,o)=>M(`/products/${s}`,{method:"PUT",body:JSON.stringify(o)}),delete:s=>M(`/products/${s}`,{method:"DELETE"}),updateStock:(s,o)=>M(`/products/${s}/stock`,{method:"PUT",body:JSON.stringify(o)}),getMaxProducible:s=>M(`/products/${s}/max-producible`)},Le={getAll:async()=>[{id:1,total:450,items:[{name:"Coffee",quantity:2}],createdAt:new Date().toISOString()}],create:async s=>({id:Date.now(),...s,createdAt:new Date().toISOString()})},ze={getAll:async()=>[{id:1,description:"Office supplies",amount:150,createdAt:new Date().toISOString()}],create:async s=>({id:Date.now(),...s,createdAt:new Date().toISOString()})},Pt={get:async()=>({totalSales:1500,totalExpenses:300,profit:1200,productCount:5})},$e={getAll:()=>M("/discounts"),create:s=>M("/discounts",{method:"POST",body:JSON.stringify(s)}),update:(s,o)=>M(`/discounts/${s}`,{method:"PUT",body:JSON.stringify(o)}),delete:s=>M(`/discounts/${s}`,{method:"DELETE"})},We={getAll:()=>M("/credit-requests"),create:s=>M("/credit-requests",{method:"POST",body:JSON.stringify(s)}),approve:s=>M(`/credit-requests/${s}/approve`,{method:"POST"}),reject:s=>M(`/credit-requests/${s}/reject`,{method:"POST"})},Te={get:async()=>({screenLockPassword:"2005",businessName:"My Business"}),update:async s=>s},Ke={getAll:s=>{const o=s?`/batches?productId=${s}`:"/batches";return M(o)},create:s=>M("/batches",{method:"POST",body:JSON.stringify(s)})},me={login:s=>M("/main-admin/auth/login",{method:"POST",body:JSON.stringify(s)}),getUsers:()=>{const s=localStorage.getItem("ownerToken");return M("/main-admin/users",{headers:{Authorization:`Bearer ${s}`}})},getStats:()=>{const s=localStorage.getItem("ownerToken");return M("/main-admin/stats",{headers:{Authorization:`Bearer ${s}`}})},getActivities:()=>{const s=localStorage.getItem("ownerToken");return M("/main-admin/activities",{headers:{Authorization:`Bearer ${s}`}})},lockUser:(s,o)=>{const f=localStorage.getItem("ownerToken");return M(`/main-admin/users/${s}/lock`,{method:"POST",headers:{Authorization:`Bearer ${f}`},body:JSON.stringify({locked:o})})},changePlan:(s,o)=>{const f=localStorage.getItem("ownerToken");return M(`/main-admin/users/${s}/plan`,{method:"POST",headers:{Authorization:`Bearer ${f}`},body:JSON.stringify({plan:o})})},clearData:s=>{const o=localStorage.getItem("ownerToken");return M("/main-admin/system/clear-data",{method:"POST",headers:{Authorization:`Bearer ${o}`},body:JSON.stringify({type:s})})}};let le=null,qe=new Set;function cs(){const s=Y.replace(/\/api$/,"");return`${s.startsWith("https")?"wss":"ws"}://${s.replace(/^https?:\/\//,"")}/api/ws/products`}function os(){if(le&&(le.readyState===WebSocket.OPEN||le.readyState===WebSocket.CONNECTING))return;const s=kt(),o=cs()+(s?`?token=${encodeURIComponent(s)}`:"");le=new WebSocket(o),le.onopen=()=>{console.debug("Products WS connected")},le.onmessage=f=>{let j=null;try{j=JSON.parse(f.data)}catch{return}qe.forEach(i=>{try{i(j)}catch(r){console.error("ws callback error",r)}})},le.onclose=()=>{console.debug("Products WS closed"),le=null},le.onerror=f=>{console.error("Products WS error",f)}}function ds(s){if(typeof s!="function")throw new Error("subscribeProducts requires a callback");return qe.add(s),os(),()=>{if(qe.delete(s),le&&qe.size===0){try{le.close()}catch{}le=null}}}const At=a.createContext(),xe=()=>a.useContext(At),xs=({children:s})=>{const[o,f]=a.useState(null),[j,i]=a.useState(!0),[r,l]=a.useState(!1),[p,d]=a.useState({});a.useEffect(()=>{n()},[]),a.useEffect(()=>{const k=()=>{const I=localStorage.getItem("user");if(I)try{const E=JSON.parse(I);f(E)}catch(E){console.warn("Failed to parse user from localStorage",E)}else f(null)};return window.addEventListener("storage",k),window.addEventListener("localStorageUpdated",k),()=>{window.removeEventListener("storage",k),window.removeEventListener("localStorageUpdated",k)}},[]);const n=async()=>{try{const k=localStorage.getItem("token"),I=localStorage.getItem("user");if(k)try{const E=await fetch(`${Y}/auth/me`,{headers:{Authorization:`Bearer ${k}`,"Content-Type":"application/json"}});if(E.ok){const q=await E.json();f(q),localStorage.setItem("user",JSON.stringify(q))}else throw new Error("Invalid token")}catch(E){console.warn("Auth check failed:",E),localStorage.removeItem("token"),localStorage.removeItem("user")}}catch(k){console.error("Error initializing auth:",k),localStorage.removeItem("token"),localStorage.removeItem("user"),f(null)}finally{i(!1),l(!0)}},h=async k=>{try{if(k&&k.token&&k.user)return localStorage.setItem("token",k.token),localStorage.setItem("user",JSON.stringify(k.user)),f(k.user),k;const I=await Se.login(k);if(I.token&&I.user)return localStorage.setItem("token",I.token),localStorage.setItem("user",JSON.stringify(I.user)),f(I.user),I;throw new Error("Invalid response from server")}catch(I){throw console.error("Login failed:",I),I}},g=async k=>{try{const I=await Se.signup(k);if(I.token&&I.user)return localStorage.setItem("token",I.token),localStorage.setItem("user",JSON.stringify(I.user)),f(I.user),I;throw new Error("Invalid response from server")}catch(I){throw console.error("Signup failed:",I),I}},c=async k=>{try{if(localStorage.setItem("user",JSON.stringify(k)),f(k),window.dispatchEvent(new Event("localStorageUpdated")),k&&k.id)try{await je.update(k.id,k)}catch(I){console.warn("Failed to persist updated user to backend",I)}return k}catch(I){throw console.error("updateUser failed:",I),I}},D=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),f(null),window.location.href="/login"},m=()=>!!o&&!!localStorage.getItem("token"),y=k=>o&&o.role===k,v=()=>o&&(o.role==="admin"||o.role==="main-admin"),N=()=>o&&o.role==="cashier",S=()=>o&&o.plan==="ultra",A=()=>o&&o.plan==="basic",P=()=>o&&(o.role==="admin"||o.role==="cashier"),R=()=>o&&o.role==="admin"&&o.plan==="ultra",t=()=>o&&o.role==="admin",C=()=>!0,u=()=>!0;return o?.locked?e.jsx(LockedAccount,{}):e.jsx(At.Provider,{value:{user:o,loading:j,isInitialized:r,appSettings:p,login:h,signup:g,updateUser:c,logout:D,isAuthenticated:m,hasRole:y,isAdmin:v,isCashier:N,isUltraPackage:S,isBasicPackage:A,canEditStock:P,canManageUsers:R,canViewAnalytics:t,isRealTimeProductSyncEnabled:C,isCashierUserManagementEnabled:u},children:s})};new Date().toISOString();const Dt=a.createContext(),ms=()=>a.useContext(Dt),hs=({children:s})=>{const{user:o}=xe(),[f,j]=a.useState([]),[i,r]=a.useState(!0),[l,p]=a.useState(null),[d,n]=a.useState(Date.now()),h=a.useCallback(async()=>{if(!localStorage.getItem("token")){r(!1);return}try{const c=await ce.getAll(),m=(Array.isArray(c)?c:[]).filter(y=>o?.role==="admin"?!0:!y.expenseOnly&&!y.pendingDelete&&y.visibleToCashier!==!1);j(m),p(null),window.dispatchEvent(new CustomEvent("productsSync",{detail:{products:m,timestamp:Date.now()}}))}catch(c){console.error("Failed to fetch products:",c),p(`Failed to load products: ${c.message}`),j([])}finally{r(!1),n(Date.now())}},[o]);a.useEffect(()=>{h()},[h,o]),a.useEffect(()=>{const c=setInterval(()=>{h()},2e3);return()=>clearInterval(c)},[h]);const g=async()=>{r(!0),await h()};return e.jsx(Dt.Provider,{value:{products:f,loading:i,error:l,lastUpdated:d,refreshProducts:g},children:s})};function us(){const[s,o]=a.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[f,j]=a.useState(!0),[i,r]=a.useState(null);a.useEffect(()=>{l()},[]);const l=async()=>{try{r(null);const[n,h]=await Promise.all([Pt.get(),Le.getAll()]),g={totalSales:n?.totalSales||0,totalExpenses:n?.totalExpenses||0,profit:n?.profit||0,grossProfit:n?.grossProfit||0,netProfit:n?.netProfit||0,totalCOGS:n?.totalCOGS||0,dailySales:n?.dailySales||0,weeklySales:n?.weeklySales||0,productCount:n?.productCount||0},c=Array.isArray(h)?h:[];o({stats:g,recentSales:c.slice(-10).reverse()})}catch(n){console.error("Failed to load data:",n),r(n.message),o({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{j(!1)}};if(f)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(i&&s.stats.totalSales===0&&s.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Me,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:i}),e.jsx("button",{onClick:l,className:"btn-primary",children:"Retry"})]})});const p=[{label:"Total Sales",value:`KSH ${s.stats.totalSales?.toLocaleString()||0}`,icon:ue,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${s.stats.grossProfit?.toLocaleString()||0}`,icon:De,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${s.stats.totalCOGS?.toLocaleString()||0}`,icon:Ie,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${s.stats.netProfit?.toLocaleString()||0}`,icon:De,color:"from-purple-500 to-pink-600",change:"+15.3%"}],d=[{label:"Daily Sales",value:`KSH ${s.stats.dailySales?.toLocaleString()||0}`,icon:bt,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${s.stats.weeklySales?.toLocaleString()||0}`,icon:De,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${s.stats.totalExpenses?.toLocaleString()||0}`,icon:Be,color:"bg-red-50 text-red-600"},{label:"Products",value:s.stats.productCount||0,icon:Ie,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(p||[]).map((n,h)=>{const g=n?.icon;return g?e.jsxs("div",{className:`card bg-gradient-to-br ${n.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(g,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:n.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:n.label}),e.jsx("p",{className:"text-2xl font-bold",children:n.value})]},h):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(d||[]).map((n,h)=>{const g=n?.icon;return g?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${n.color} flex items-center justify-center`,children:e.jsx(g,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:n.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:n.value})]})]})},h):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!s.recentSales||s.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Me,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(s.recentSales||[]).map(n=>n?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:n.createdAt?new Date(n.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(n.items)?n.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:n.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",n.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",n.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",n.profit?.toLocaleString()||0]})]},n.id||Math.random()):null)})]})})]})]})}function ps(){const{user:s,isUltraPackage:o,isRealTimeProductSyncEnabled:f}=xe(),{products:j,refreshProducts:i}=ms(),[r,l]=a.useState([]),[p,d]=a.useState([]),[n,h]=a.useState("all"),[g,c]=a.useState(""),[D,m]=a.useState(!1),[y,v]=a.useState(!1),[N,S]=a.useState(!1),[A,P]=a.useState(null),[R,t]=a.useState(null),[C,u]=a.useState(null),[k,I]=a.useState(!1),[E,q]=a.useState(null),[te,re]=a.useState(""),[H,Q]=a.useState({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),[W,ae]=a.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[O,X]=a.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0});a.useEffect(()=>{w()},[]);const w=async()=>{try{await i();const x=await Ke.getAll();d(x)}catch(x){console.error("Failed to load data:",x)}};a.useEffect(()=>{j&&l(j)},[j]);const F=(x,T=!0)=>{const U=x.target.files[0];if(U){if(U.size>2*1024*1024){V("Image must be smaller than 2MB","error");return}const J=new FileReader;J.onload=z=>{const ee=z.target.result;re(ee),T?Q({...H,image:ee}):(X({...O,image:ee}),O.id&&setTimeout(async()=>{try{await ce.update(O.id,{image:ee}),V("âœ… Image saved","success")}catch(we){console.error("Failed to save image:",we)}},500))},J.readAsDataURL(U)}},$=x=>p.filter(U=>U.productId===x&&U.quantity>0).reduce((U,J)=>U+J.quantity,0),G=x=>p.filter(T=>T.productId===x&&T.quantity>0),V=(x,T="success")=>{u({message:x,type:T}),setTimeout(()=>u(null),5e3)},de=async x=>{x.preventDefault();try{const T={...H,price:parseFloat(H.price),cost:parseFloat(H.cost||0),quantity:0,visibleToCashier:!H.expenseOnly&&H.visibleToCashier!==!1},U=await ce.create(T);Q({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),re(""),m(!1),await w(),V(`âœ… Product "${U.name}" added successfully! ${U.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success")}catch(T){console.error("Failed to create product:",T),alert(`Failed to create product: ${T.message||"Unknown error"}`)}},ge=async x=>{x.preventDefault();try{const T={id:`batch-${Date.now()}`,productId:A.id,quantity:parseInt(W.quantity),expiryDate:W.expiryDate,batchNumber:W.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(W.cost||A.cost||0)};d(U=>[...U,T]),V("âš¡ Adding stock...","info");try{await Ke.create({productId:A.id,quantity:parseInt(W.quantity),expiryDate:W.expiryDate,batchNumber:W.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(W.cost||A.cost||0)}),ae({quantity:"",expiryDate:"",batchNumber:"",cost:""}),S(!1),P(null),await w(),V(`âœ… Stock added successfully for ${A.name}!`,"success")}catch(U){throw d(J=>J.filter(z=>z.id!==T.id)),U}}catch(T){console.error("Failed to add stock:",T),V(`âŒ Failed to add stock: ${T.message||"Unknown error"}`,"error")}},b=async x=>{x.preventDefault();try{const T=r.find(z=>z.id===O.id);if(parseFloat(O.price)<T.price){alert("You cannot lower prices, only increase.");return}const U={...O,price:parseFloat(O.price),cost:parseFloat(O.cost),quantity:parseFloat(O.quantity)},J={...T,...U};l(z=>z.map(ee=>ee.id===O.id?J:ee)),I(!0),V("âš¡ Updating product...","info");try{const z=await ce.update(O.id,U);v(!1),f()?(window.dispatchEvent(new CustomEvent("productUpdated",{detail:{product:z,originalProduct:T,timestamp:new Date().toISOString(),type:"update"}})),V("âœ… Product updated and synced!","success")):V("âœ… Product updated successfully!","success"),q(new Date)}catch(z){throw l(ee=>ee.map(we=>we.id===O.id?T:we)),z}finally{I(!1)}}catch(T){console.error("Failed to update product:",T),V(`âŒ Update failed: ${T.message||"Unknown error"}`,"error")}},L=async x=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const T=r.find(J=>J.id===x),U=await ce.delete(x);if(l(J=>J.filter(z=>z.id!==x)),f()&&T)I(!0),window.dispatchEvent(new CustomEvent("productDeleted",{detail:{product:T,timestamp:new Date().toISOString(),type:"delete"}})),V(`ðŸ“¡ Product "${T.name}" deleted and synced to all dashboards!`,"success"),q(new Date),setTimeout(()=>{I(!1)},3e3);else{const J=U?.message||"Product deleted successfully!";alert(J)}await i()}catch(T){console.error("Failed to delete product:",T);let U="Failed to delete product";T.message.includes("Failed to execute")||T.message.includes("JSON")?U="Network error. Please check your connection and try again.":T.message.includes("401")||T.message.includes("unauthorized")?U="You are not authorized to delete this product.":T.message.includes("404")||T.message.includes("not found")?U="Product not found. It may have been deleted already.":T.message&&(U=`Failed to delete product: ${T.message}`),alert(U)}},_=(r||[]).filter(x=>{if(!x)return!1;const T=x.name?.toLowerCase().includes(g.toLowerCase()),U=n==="all"||n==="raw"&&!x.recipe||n==="composite"&&x.recipe||n==="expense"&&x.expenseOnly||n==="low-stock"&&x.quantity<10;return T&&U}),B=(r||[]).filter(x=>x&&!x.recipe&&!x.expenseOnly),Z=(r||[]).filter(x=>x&&x.recipe),be=(r||[]).filter(x=>x&&x.expenseOnly),Lt=x=>{if(!x||!x.recipe)return 0;let T=1/0;return(x.recipe||[]).forEach(U=>{if(!U)return;const J=(r||[]).find(z=>z&&z.id===U.productId);if(J&&J.quantity>0&&U.quantity>0){const z=Math.floor(J.quantity/U.quantity);T=Math.min(T,z)}}),T===1/0?0:T},Ut=x=>{if(!x)return 0;if(!x.recipe)return x.cost||0;let T=0;return(x.recipe||[]).forEach(U=>{if(!U)return;const J=(r||[]).find(z=>z&&z.id===U.productId);if(J&&J.quantity>0){const z=(J.cost||0)/J.quantity;T+=z*(U.quantity||0)}}),T};return e.jsxs("div",{className:"p-6 space-y-6",children:[C&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${C.type==="success"?"bg-green-50 border border-green-200 text-green-800":C.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:C.message}),e.jsx("button",{onClick:()=>u(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:g,onChange:x=>c(x.target.value)})]}),e.jsxs("select",{value:n,onChange:x=>h(x.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>m(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:B.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:Z.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:be.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(_||[]).map(x=>{if(!x)return null;const T=Ut(x),U=x.price?((x.price-T)/x.price*100).toFixed(1):0,J=Lt(x),z=R===x.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[x.image?e.jsx("img",{src:x.image,alt:x.name,className:"w-12 h-12 object-cover rounded-lg",onError:ee=>{ee.target.style.display="none",ee.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:x.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[x.recipe&&e.jsx("button",{onClick:()=>t(z?null:x.id),className:"p-1 hover:bg-gray-200 rounded",children:z?e.jsx(Bt,{className:"w-4 h-4"}):e.jsx(Ht,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:x.name}),x.quantity<10&&!x.recipe&&e.jsx(ke,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${x.expenseOnly?"badge-warning":x.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:x.expenseOnly?"Expense":x.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",x.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",T.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${$(x.id)===0?"text-red-600":$(x.id)<10?"text-yellow-600":"text-gray-900"}`,children:[$(x.id)," ",x.unit]}),$(x.id)<10&&$(x.id)>0&&e.jsx(ke,{className:"w-4 h-4 text-yellow-500"}),$(x.id)===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600",children:[G(x.id).length," active"]}),e.jsx("button",{onClick:()=>{P(x),S(!0)},className:"p-1 hover:bg-blue-50 rounded text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(ie,{className:"w-3 h-3"})})]})}),e.jsx("td",{className:"px-4 py-3",children:x.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[J," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${U>30?"text-green-600":U>15?"text-yellow-600":"text-red-600"}`,children:[U,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{X(x),v(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>L(x.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})})]},x.id),z&&x.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(x.recipe||[]).map((ee,we)=>{if(!ee)return null;const fe=(r||[]).find(ct=>ct&&ct.id===ee.productId);if(!fe)return null;const it=(fe.cost||0)/(fe.quantity||1),Ft=it*(ee.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:fe.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[ee.quantity||0," ",fe.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[fe.quantity||0," ",fe.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",it.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",Ft.toFixed(2)]})]},we)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",T.toFixed(2)]})]})})]})]})})})]})})})]})})}),N&&A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Add Stock for ",A.name]}),e.jsxs("form",{onSubmit:ge,className:"space-y-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:W.quantity,onChange:x=>ae({...W,quantity:x.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:W.expiryDate,onChange:x=>ae({...W,expiryDate:x.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:W.batchNumber,onChange:x=>ae({...W,batchNumber:x.target.value})}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost per Unit",className:"input",value:W.cost,onChange:x=>ae({...W,cost:x.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{S(!1),P(null),ae({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]})}),D&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:de,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:H.name,onChange:x=>Q({...H,name:x.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:x=>F(x,!0),className:"input"}),e.jsx(jt,{className:"w-5 h-5 text-gray-400"})]}),(te||H.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:te||H.image,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:H.price,onChange:x=>Q({...H,price:x.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:H.cost,onChange:x=>Q({...H,cost:x.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:H.category,onChange:x=>Q({...H,category:x.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsxs("select",{className:"input",value:H.unit,onChange:x=>Q({...H,unit:x.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:H.expenseOnly,onChange:x=>Q({...H,expenseOnly:x.target.checked,visibleToCashier:!x.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!H.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:H.visibleToCashier,onChange:x=>Q({...H,visibleToCashier:x.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{m(!1),re(""),Q({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0})},className:"btn-secondary",children:"Cancel"})]})]})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:O.name,onChange:x=>X({...O,name:x.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:O.image||"",onChange:x=>X({...O,image:x.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:x=>{const T=x.target.files[0];if(T){const U=new FileReader;U.onloadend=()=>{X({...O,image:U.result})},U.readAsDataURL(T)}}})]}),O.image&&e.jsx("img",{src:O.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:O.price||"",onChange:x=>X({...O,price:x.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:O.cost||"",onChange:x=>X({...O,cost:x.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:O.quantity||"",onChange:x=>X({...O,quantity:x.target.value}),required:!0}),e.jsxs("select",{className:"input",value:O.unit||"pcs",onChange:x=>X({...O,unit:x.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:O.category||"raw",onChange:x=>X({...O,category:x.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:O.expenseOnly||!1,onChange:x=>X({...O,expenseOnly:x.target.checked,visibleToCashier:!x.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!O.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:O.visibleToCashier!==!1,onChange:x=>X({...O,visibleToCashier:x.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>v(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function gs(){const[s,o]=a.useState([]),[f,j]=a.useState([]),[i,r]=a.useState(!1),[l,p]=a.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});a.useEffect(()=>{d()},[]);const d=async()=>{const y=await ce.getAll();o(y),j(y.filter(v=>!v.recipe))},n=()=>{p({...l,ingredients:[...l.ingredients,{name:"",quantity:"",unit:"pcs"}]})},h=(y,v,N)=>{const S=[...l.ingredients];S[y][v]=N,p({...l,ingredients:S})},g=y=>{p({...l,ingredients:l.ingredients.filter((v,N)=>N!==y)})},c=()=>l.ingredients.reduce((y,v)=>{const N=f.find(S=>S.name.toLowerCase()===v.name.toLowerCase());if(N&&v.quantity){const S=N.cost/N.quantity;return y+S*parseFloat(v.quantity)}return y},0),D=async y=>{y.preventDefault();const v=[];for(const S of l.ingredients){if(!S.name||!S.quantity)continue;const A=f.find(P=>P.name.toLowerCase()===S.name.toLowerCase());A?v.push({productId:A.id,quantity:parseFloat(S.quantity),unit:S.unit||"pcs"}):v.push({name:S.name,quantity:parseFloat(S.quantity),unit:S.unit||"pcs"})}if(v.length===0){alert("Please add at least one ingredient");return}const N=c();try{await ce.create({name:l.name,price:parseFloat(l.price),cost:N,quantity:0,unit:"pcs",category:"composite",recipe:v,image:l.image||"",visibleToCashier:l.visibleToCashier,expenseOnly:!1}),p({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),r(!1),d(),alert("Recipe created successfully!")}catch(S){console.error("Error creating recipe:",S),alert("Failed to create recipe. Please try again.")}},m=s.filter(y=>y.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>r(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",m.length,")"]}),m.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:m.map(y=>{const v=y.recipe.reduce((S,A)=>{if(A.productId){const P=s.find(R=>R.id===A.productId);if(P){const R=P.cost/P.quantity;return S+R*A.quantity}}else if(A.name){const P=s.find(R=>R.name.toLowerCase()===A.name.toLowerCase());if(P){const R=P.cost/P.quantity;return S+R*A.quantity}}return S},0),N=((y.price-v)/y.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:y.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",y.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",v.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${N>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",N,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(oe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:y.recipe.map((S,A)=>{let P="",R=S.unit||"pcs";if(S.productId){const t=s.find(C=>C.id===S.productId);t&&(P=t.name,R=t.unit)}else S.name&&(P=S.name,R=S.unit||"pcs");return P?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:P}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[S.quantity," ",R]})]},A):null})})]})]},y.id)})})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:l.name,onChange:y=>p({...l,name:y.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:l.price,onChange:y=>p({...l,price:y.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:l.image,onChange:y=>p({...l,image:y.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.visibleToCashier,onChange:y=>p({...l,visibleToCashier:y.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:n,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:l.ingredients.map((y,v)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:y.name,onChange:N=>h(v,"name",N.target.value),required:!0,list:`ingredients-list-${v}`}),e.jsx("datalist",{id:`ingredients-list-${v}`,children:f.map(N=>e.jsxs("option",{value:N.name,children:[N.name," (",N.quantity," ",N.unit," available)"]},N.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:y.quantity,onChange:N=>h(v,"quantity",N.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:y.unit,onChange:N=>h(v,"unit",N.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>g(v),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(oe,{className:"w-4 h-4"})})]},v))}),l.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),l.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",c().toFixed(2)]})]}),l.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(l.price)-c())/parseFloat(l.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(_t,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{r(!1),p({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function bs(){const[s,o]=a.useState([]),[f,j]=a.useState("all");a.useEffect(()=>{i()},[]);const i=async()=>{const n=await Le.getAll();o(n.reverse())},r=s.filter(n=>{if(f==="today")return new Date(n.createdAt).toDateString()===new Date().toDateString();if(f==="week"){const h=new Date;return h.setDate(h.getDate()-7),new Date(n.createdAt)>=h}return!0}),l=r.reduce((n,h)=>n+h.total,0),p=r.reduce((n,h)=>n+(h.cogs||0),0),d=l-p;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("select",{value:f,onChange:n=>j(n.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]})}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(zt,{className:"w-4 h-4"}),"Export"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",l.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",p.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",d.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:r.map(n=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",n.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(n.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[n.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:n.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",n.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",n.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",n.profit?.toLocaleString()||0]})]},n.id))})]})})]})]})}function fs(){const[s,o]=a.useState([]),[f,j]=a.useState(!1),[i,r]=a.useState({description:"",amount:"",category:"general"});a.useEffect(()=>{l()},[]);const l=async()=>{const g=await ze.getAll();o(g.reverse())},p=async g=>{g.preventDefault(),await ze.create({...i,amount:parseFloat(i.amount)}),r({description:"",amount:"",category:"general"}),j(!1),l()},d=s.reduce((g,c)=>g+c.amount,0),n=s.filter(g=>!g.automatic),h=s.filter(g=>g.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("button",{onClick:()=>j(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",d.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",n.reduce((g,c)=>g+c.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",h.reduce((g,c)=>g+c.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:s.map(g=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(g.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:g.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:g.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${g.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:g.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",g.amount?.toLocaleString()]})]},g.id))})]})})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:i.description,onChange:g=>r({...i,description:g.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:i.amount,onChange:g=>r({...i,amount:g.target.value}),required:!0}),e.jsxs("select",{className:"input",value:i.category,onChange:g=>r({...i,category:g.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>j(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function js(){const{isCashierUserManagementEnabled:s,isCashier:o}=xe(),[f,j]=a.useState([]),[i,r]=a.useState(!0),[l,p]=a.useState(!1),[d,n]=a.useState(null),[h,g]=a.useState(null),[c,D]=a.useState(null),[m,y]=a.useState(0),[v,N]=a.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),[S,A]=a.useState(!1),[P,R]=a.useState(null),[t,C]=a.useState("");a.useEffect(()=>{u()},[]),a.useEffect(()=>()=>{c?.intervalId&&clearInterval(c.intervalId)},[c]);const u=async()=>{try{r(!0);const w=await je.getAll();j(Array.isArray(w)?w:[])}catch(w){console.error("Error loading users:",w),j([])}finally{r(!1)}},k=()=>Math.floor(1e3+Math.random()*9e3).toString(),I=async w=>{if(w.preventDefault(),console.log("Form submitted with data:",v),!v.name?.trim()||!v.email?.trim()||!v.password?.trim()){alert("Please fill in all required fields");return}if(v.password.length<6){alert("Password must be at least 6 characters long");return}try{r(!0);const F=k(),$={name:v.name.trim(),email:v.email.trim().toLowerCase(),password:v.password.trim(),pin:F};console.log("Sending user data:",$);const G=await je.create($);console.log("User creation result:",G),await u();const V=`âœ… Cashier added successfully!

ðŸ“§ Email: ${$.email}
ðŸ”‘ Password: ${$.password}
ðŸ”¢ PIN: ${F}

ðŸ’¡ LOGIN OPTIONS:
1. Email + Password: Use email and password above
2. PIN Login: Use email + ${F}

Please share these credentials securely with the new cashier.`;alert(V),N({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),p(!1)}catch(F){console.error("Error creating cashier:",F);let $="Failed to add cashier";F.message.includes("Current user not found")?$="Authentication error. Please refresh the page and try again.":F.message.includes("email")?$="Email already exists. Please use a different email.":F.message.includes("network")||F.message.includes("fetch")?$="Network error. Please check your connection and try again.":F.message&&($=`Failed to add cashier: ${F.message}`),alert($)}finally{r(!1)}},E=async(w,F)=>{try{r(!0),await je.update(w,{permissions:F}),await u(),n(null)}catch($){console.error("Error updating permissions:",$),alert("Failed to update permissions: "+$.message)}finally{r(!1)}},q=async(w,F)=>{try{r(!0);const $=!F,G=await fetch(`${Y}/users/${w}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({active:$})});if(!G.ok){const V=await G.json().catch(()=>({error:"Network error"}));throw new Error(V.error||`HTTP ${G.status}: ${G.statusText}`)}await u()}catch($){console.error("Error updating user status:",$),alert("Failed to update user status: "+$.message)}finally{r(!1)}},te=async(w,F)=>{try{r(!0);const $=!F,G=await fetch(`${Y}/users/${w}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({locked:$})});if(!G.ok){const V=await G.json().catch(()=>({error:"Network error"}));throw new Error(V.error||`HTTP ${G.status}: ${G.statusText}`)}await u()}catch($){console.error("Error updating user lock status:",$),alert("Failed to update user lock status: "+$.message)}finally{r(!1)}},re=async w=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{r(!0),await je.delete(w),await u()}catch(F){console.error("Error deleting user:",F),alert("Failed to delete user: "+F.message)}finally{r(!1)}},H=w=>{R(w),C(k()),A(!0)},Q=async()=>{try{r(!0),await je.update(P.id,{cashierPIN:t}),await u(),A(!1),R(null),C(""),alert(`âœ… PIN reset successfully!

ðŸ”¢ New PIN for ${P.name}: ${t}

Please share this PIN securely with the cashier.`)}catch(w){console.error("Error resetting PIN:",w),alert("Failed to reset PIN: "+w.message)}finally{r(!1)}},W=w=>{g(w),D({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const F=setInterval(()=>{O(w)},3e3);D($=>({...$,intervalId:F})),O(w)},ae=()=>{c?.intervalId&&clearInterval(c.intervalId),g(null),D(null)},O=async w=>{try{const F=await Le.getAll(),G=(Array.isArray(F)?F:[]).filter(de=>de.cashierId===w.id).sort((de,ge)=>new Date(ge.createdAt)-new Date(de.createdAt)).slice(0,10),V={isActive:Math.random()>.3,currentCart:G.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:G.reduce((de,ge)=>de+ge.total,0),salesCount:G.length,lastActivity:G.length>0?new Date(G[0].createdAt).toLocaleTimeString():"No recent activity"};D(V)}catch(F){console.error("Error loading live view data:",F)}},X=(f||[]).filter(w=>w.role==="cashier");return i&&f.length===0?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),s()&&e.jsxs("button",{onClick:()=>p(!0),className:"btn-primary flex items-center gap-2",disabled:i,children:[e.jsx(ie,{className:"w-4 h-4"}),"Add Cashier"]})]}),o()&&!s()&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(ne,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"User Management Restricted"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The admin has disabled cashier user management. You cannot add, edit, or remove users at this time."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:f.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:X.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:f.filter(w=>w.active).length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(f||[]).map(w=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:w.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:w.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${w.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:w.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:w.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:w.role==="cashier"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:w.pin||w.cashierPIN||"----"}),e.jsx("button",{onClick:()=>H(w),className:"p-1 hover:bg-yellow-50 rounded text-yellow-600",title:"Reset PIN",disabled:i,children:e.jsx(Ce,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${w.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:w.active?e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{className:"w-3 h-3"}),"Inactive"]})}),w.locked&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:[e.jsx(ve,{className:"w-3 h-3"}),"Locked"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[s()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>q(w.id,w.active),className:`p-2 rounded-lg transition ${w.active?"hover:bg-red-50 text-red-600":"hover:bg-green-50 text-green-600"}`,title:w.active?"Deactivate User":"Activate User",disabled:i,children:w.active?e.jsx(ot,{className:"w-4 h-4"}):e.jsx(Ye,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>te(w.id,w.locked||!1),className:`p-2 rounded-lg transition ${w.locked?"hover:bg-green-50 text-green-600":"hover:bg-red-50 text-red-600"}`,title:w.locked?"Unlock User":"Lock User",disabled:i,children:e.jsx(ve,{className:"w-4 h-4"})})]}),w.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",w.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(st,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>W(w),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(dt,{className:"w-4 h-4"})})]}),s()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>n(w),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600",title:"Edit Permissions",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>re(w.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",title:"Delete User",disabled:i,children:e.jsx(oe,{className:"w-4 h-4"})})]})]})})]},w.id))})]}),f.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(he,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first cashier to get started"})]})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:v.name||"",onChange:w=>{console.log("Name input changed:",w.target.value),N({...v,name:w.target.value})},required:!0,disabled:i}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:v.email||"",onChange:w=>{console.log("Email input changed:",w.target.value),N({...v,email:w.target.value})},required:!0,disabled:i}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:v.password||"",onChange:w=>{console.log("Password input changed:",w.target.value),N({...v,password:w.target.value})},required:!0,minLength:6,disabled:i}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(v.permissions).map(([w,F])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:$=>N({...v,permissions:{...v.permissions,[w]:$.target.checked}}),disabled:i}),e.jsx("span",{className:"text-sm capitalize",children:w.replace(/([A-Z])/g," $1").trim()})]},w))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:i,children:i?"Adding...":"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>p(!1),className:"btn-secondary",disabled:i,children:"Cancel"})]})]})]})}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",d.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(d.permissions||{}).map(([w,F])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:$=>n({...d,permissions:{...d.permissions,[w]:$.target.checked}}),disabled:i}),e.jsx("span",{className:"text-sm capitalize",children:w.replace(/([A-Z])/g," $1").trim()})]},w))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>E(d.id,d.permissions),className:"btn-primary flex-1",disabled:i,children:i?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>n(null),className:"btn-secondary",disabled:i,children:"Cancel"})]})]})}),h&&c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(dt,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",h.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:ae,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(Ee,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${c.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:c.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Last Activity: ",c.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Re,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(c.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(c.currentCart||[]).map((w,F)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[w.name," x",w.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",w.price.toLocaleString()]})]},F)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(c.currentCart||[]).reduce((w,F)=>w+F.price*F.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:c.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",c.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",c.salesCount>0?Math.round(c.totalSalesToday/c.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})}),S&&P&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Reset PIN for ",P.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate a new 4-digit PIN for this cashier. The old PIN will be invalid."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"New PIN:"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-mono text-3xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:t})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C(k()),className:"btn-secondary flex-1",disabled:i,children:"Generate New PIN"}),e.jsx("button",{onClick:Q,className:"btn-primary flex-1",disabled:i,children:i?"Updating...":"Confirm & Update"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>{A(!1),R(null),C("")},className:"btn-secondary w-full",disabled:i,children:"Cancel"})})]})})]})}function ys(){const[s,o]=a.useState([]),[f,j]=a.useState("all");a.useEffect(()=>{i()},[]);const i=()=>{const d=JSON.parse(localStorage.getItem("clockRecords")||"[]");o(d.reverse())},r=f==="all"?s:s.filter(d=>d.date===new Date().toDateString()),l=r.filter(d=>d.date===new Date().toDateString()).reduce((d,n)=>d+n.duration,0)/60,p=d=>{const n=Math.floor(d/60),h=d%60;return`${n}h ${h}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(Ue,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[l.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(at,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(r.filter(d=>d.date===new Date().toDateString()).map(d=>d.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(ye,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:s.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>j("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${f==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>j("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${f==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"})]})}),e.jsx("tbody",{children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-gray-500",children:"No records found"})}):r.map((d,n)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:d.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(d.clockIn).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(d.clockIn).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(d.clockOut).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:p(d.duration)})})]},n))})]})})]})]})}function Ns(){const{user:s,updateUser:o}=xe();pe();const[f,j]=a.useState(!1),[i,r]=a.useState(s?.plan||"ultra"),[l,p]=a.useState({}),[d,n]=a.useState(null),[h,g]=a.useState(s?.profilePicture||null),[c,D]=a.useState(!0),[m,y]=a.useState(!0);a.useEffect(()=>{v()},[]);const v=async()=>{try{const u=await Te.get();p(u),u.logo&&n(u.logo),D(u.cashierUserManagement!==!1),y(u.realTimeProductSync!==!1)}catch(u){console.error("Failed to load settings:",u)}},N=async u=>{try{const k={...l,...u};return await Te.update(k),p(k),!0}catch(k){return console.error("Failed to save settings:",k),!1}},S=async()=>{const u=!c;D(u),await N({cashierUserManagement:u})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{cashierUserManagement:u}})),alert(`âœ… Cashier User Management ${u?"ENABLED":"DISABLED"}`)):(D(!u),alert("âŒ Failed to save setting. Please try again."))},A=async()=>{const u=!m;y(u),await N({realTimeProductSync:u})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{realTimeProductSync:u}})),alert(`âœ… Real-time Product Sync ${u?"ENABLED":"DISABLED"}`)):(y(!u),alert("âŒ Failed to save setting. Please try again."))},P=async u=>{const k=u.target.files[0];if(k){const I=new FileReader;I.onloadend=async()=>{const E=I.result;n(E);try{await Te.update({...l,logo:E}),p({...l,logo:E})}catch(q){console.error("Failed to save logo:",q)}},I.readAsDataURL(k)}},R=async u=>{const k=u.target.files[0];if(k){const I=new FileReader;I.onloadend=async()=>{const E=I.result;g(E);try{await o({...s,profilePicture:E})}catch(q){console.error("Failed to save profile picture:",q)}},I.readAsDataURL(k)}},t=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],C=async()=>{const u=t.find(I=>I.id===i),k=i==="ultra"?"admin":"cashier";await o({...s,role:k,plan:i,price:u.price}),j(!1),setTimeout(()=>window.location.href=k==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(at,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[h?e.jsx("img",{src:h,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:s?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(xt,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:R})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:s?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:s?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:s?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(He,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[s?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",s?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>j(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(rt,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(he,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cashier User Management"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Cashier User Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow cashiers to add and remove users"})]}),e.jsx("button",{onClick:S,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${c?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${c?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${c?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:c?"âœ… Cashiers can add and remove users when enabled":"âŒ Cashiers cannot add or remove users when disabled"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(yt,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Real-time Product Sync"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Real-time Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync products between admin and cashier dashboards"})]}),e.jsx("button",{onClick:A,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${m?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${m?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${m?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:m?"âœ… Products will sync in real-time across all dashboards":"âŒ Products will not sync automatically across dashboards"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Kt,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[d&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:d,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(xt,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:P})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:t.map(u=>e.jsxs("div",{onClick:()=>r(u.id),className:`card cursor-pointer transition-all ${i===u.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:u.name}),i===u.id&&e.jsx(_e,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",u.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:u.features.map((k,I)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(_e,{className:"w-4 h-4 text-green-600"}),k]},I))})]},u.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:C,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>j(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function vs(){const[s,o]=a.useState([]),[f,j]=a.useState(!1),[i,r]=a.useState(null),[l,p]=a.useState({name:"",amount:"",description:"",active:!0});a.useEffect(()=>{d()},[]);const d=()=>{const c=JSON.parse(localStorage.getItem("serviceFees")||"[]");o(c)},n=c=>{localStorage.setItem("serviceFees",JSON.stringify(c)),o(c)},h=c=>{if(c.preventDefault(),i){const D=s.map(m=>m.id===i.id?{...l,id:m.id}:m);n(D)}else{const D={...l,id:Date.now(),createdAt:new Date().toISOString()};n([...s,D])}j(!1),r(null),p({name:"",amount:"",description:"",active:!0})},g=c=>{confirm("Delete this service fee?")&&n(s.filter(D=>D.id!==c))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{j(!0),r(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:s.map(c=>e.jsxs("div",{className:`card ${c.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:c.name}),e.jsx("p",{className:"text-xs text-gray-500",children:c.description})]})]}),e.jsx("span",{className:`badge ${c.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:c.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",c.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{r(c),p(c),j(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(Ce,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>g(c.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(oe,{className:"w-4 h-4 text-red-600"})})]})]})]},c.id))}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[i?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:l.name,onChange:c=>p({...l,name:c.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:l.amount,onChange:c=>p({...l,amount:c.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:l.description,onChange:c=>p({...l,description:c.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.active,onChange:c=>p({...l,active:c.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>j(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function ws(){const[s,o]=a.useState([]),[f,j]=a.useState([]),[i,r]=a.useState(!1),[l,p]=a.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});a.useEffect(()=>{d(),n()},[]);const d=async()=>{try{const m=localStorage.getItem("token"),y=await fetch(`${Y}/reminders`,{headers:{Authorization:`Bearer ${m}`}});if(!y.ok){console.error("API Error:",y.status,y.statusText),o([]);return}const v=await y.json();Array.isArray(v)?o(v):(console.error("Expected array but got:",typeof v,v),o([]))}catch(m){console.error("Failed to fetch reminders:",m),o([])}},n=async()=>{try{const m=localStorage.getItem("token"),y=await fetch(`${Y}/products`,{headers:{Authorization:`Bearer ${m}`}});if(!y.ok){console.error("API Error:",y.status,y.statusText),j([]);return}const v=await y.json();Array.isArray(v)?j(v):(console.error("Expected array but got:",typeof v,v),j([]))}catch(m){console.error("Failed to fetch products:",m),j([])}},h=async m=>{m.preventDefault();try{const y=localStorage.getItem("token"),v=await fetch(`${Y}/reminders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`},body:JSON.stringify(l)});if(!v.ok){const S=await v.json();console.error("Failed to create reminder:",S),alert(`Failed to create reminder: ${S.error||"Unknown error"}`);return}const N=await v.json();p({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),r(!1),d(),alert("Reminder created successfully!")}catch(y){console.error("Failed to create reminder:",y),alert("Failed to create reminder. Please try again.")}},g=async m=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const v=localStorage.getItem("token"),N=await fetch(`${Y}/reminders/${m}`,{method:"DELETE",headers:{Authorization:`Bearer ${v}`}});if(!N.ok){const S=await N.json();console.error("Failed to delete reminder:",S),alert(`Failed to delete reminder: ${S.error||"Unknown error"}`);return}d(),alert("Reminder deleted successfully!")}catch(y){console.error("Failed to delete reminder:",y),alert("Failed to delete reminder. Please try again.")}},c=m=>{l.days.includes(m)?p({...l,days:l.days.filter(y=>y!==m)}):p({...l,days:[...l.days,m]})},D=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(rt,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("button",{onClick:()=>r(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(ie,{size:20}),"New Reminder"]})]}),e.jsx("div",{className:"grid gap-4",children:s.map(m=>{const y=f.find(v=>v.id===m.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${m.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:m.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",y?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",m.frequency]}),m.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",m.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(ye,{size:16}),"Next: ",new Date(m.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${m.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:m.status}),e.jsx("button",{onClick:()=>g(m.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(oe,{size:20})})]})]})},m.id)})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:l.customerName,onChange:m=>p({...l,customerName:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:l.productId,onChange:m=>p({...l,productId:parseInt(m.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),f.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:l.frequency,onChange:m=>p({...l,frequency:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),l.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:D.map(m=>e.jsx("button",{type:"button",onClick:()=>c(m),className:`px-4 py-2 rounded-lg font-medium transition ${l.days.includes(m)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:m},m))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:l.nextDate,onChange:m=>p({...l,nextDate:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>r(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})}function Ss(){const[s,o]=a.useState([]),[f,j]=a.useState(!1),[i,r]=a.useState(null),[l,p]=a.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});a.useEffect(()=>{d()},[]);const d=async()=>{try{const c=await $e.getAll();o(c)}catch(c){console.error("Failed to load discounts:",c)}},n=async c=>{c.preventDefault();try{i?await $e.update(i.id,l):await $e.create(l),j(!1),r(null),p({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),d()}catch(D){console.error("Failed to save discount:",D)}},h=async c=>{if(confirm("Delete this discount?"))try{await $e.delete(c),d()}catch(D){console.error("Failed to delete discount:",D)}},g=c=>{const D=new Date,m=new Date(c.validFrom),y=new Date(c.validTo);return c.active&&m<=D&&y>=D};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{j(!0),r(null),p({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.map(c=>e.jsxs("div",{className:`card ${g(c)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${g(c)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(Qe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:c.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[c.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${g(c)?"badge-success":"bg-gray-200 text-gray-600"}`,children:g(c)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(c.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(c.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{r(c),p(c),j(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(Ce,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>h(c.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(oe,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},c.id)),s.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(Qe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[i?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:n,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:l.name,onChange:c=>p({...l,name:c.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:l.percentage,onChange:c=>p({...l,percentage:parseFloat(c.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:l.validFrom,onChange:c=>p({...l,validFrom:c.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:l.validTo,onChange:c=>p({...l,validTo:c.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.active,onChange:c=>p({...l,active:c.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>j(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function ks(){const[s,o]=a.useState([]),[f,j]=a.useState([]),[i,r]=a.useState("all");a.useEffect(()=>{l(),p()},[]);const l=async()=>{try{const m=await We.getAll();o(m)}catch(m){console.error("Failed to load credit requests:",m)}},p=async()=>{try{const m=await ce.getAll();j(m)}catch(m){console.error("Failed to load products:",m)}},d=async m=>{try{await We.approve(m),l()}catch(y){console.error("Failed to approve request:",y)}},n=async m=>{try{await We.reject(m),l()}catch(y){console.error("Failed to reject request:",y)}},h=m=>{const y=f.find(v=>v.id===m);return y?y.name:"Unknown Product"},g=s.filter(m=>i==="all"?!0:m.status===i),c=m=>{switch(m){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},D=m=>{switch(m){case"pending":return e.jsx(Ue,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(Ne,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(Ze,{className:"w-6 h-6 text-red-600"});default:return e.jsx(He,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(m=>e.jsx("button",{onClick:()=>r(m),className:`px-4 py-2 rounded-lg font-medium transition ${i===m?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:m.charAt(0).toUpperCase()+m.slice(1)},m))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[g.map(m=>e.jsx("div",{className:`card border-l-4 ${c(m.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${m.status==="pending"?"bg-orange-600":m.status==="approved"?"bg-green-600":"bg-red-600"}`,children:D(m.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:m.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:h(m.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:m.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",m.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(m.createdAt).toLocaleString()]}),m.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(m.approvedAt).toLocaleString()]})]})]}),m.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>d(m.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Ne,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>n(m.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Ze,{size:16}),"Reject"]})]}),m.status!=="pending"&&e.jsx("span",{className:`badge ${m.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:m.status.toUpperCase()})]})},m.id)),g.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(He,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",i!=="all"?i:""," credit requests found."]})]})]})]})}function Tt({onClose:s}){const[o,f]=a.useState([]),[j,i]=a.useState(!0);a.useEffect(()=>{r()},[]);const r=async()=>{try{const p=localStorage.getItem("token"),d=await fetch(`${Y}/reminders/today`,{headers:{Authorization:`Bearer ${p}`}});if(!d.ok){console.error("API Error:",d.status,d.statusText),f([]);return}const n=await d.json();Array.isArray(n)?f(n):(console.error("Expected array but got:",typeof n,n),f([]))}catch(p){console.error("Failed to fetch reminders:",p),f([])}finally{i(!1)}},l=async p=>{try{const d=localStorage.getItem("token");await fetch(`${Y}/reminders/${p}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({status:"fulfilled"})}),r()}catch(d){console.error("Failed to update reminder:",d)}};return j?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:s,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(Ee,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Me,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):o.map(p=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:p.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",p.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:p.frequency})]}),e.jsxs("button",{onClick:()=>l(p.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Ne,{size:18}),"Mark Done"]})]},p.id))})]})})}function It({onUnlock:s,userType:o="user"}){const[f,j]=a.useState(""),[i,r]=a.useState(""),[l,p]=a.useState("password"),[d,n]=a.useState(!1),[h,g]=a.useState(""),[c,D]=a.useState(!1),[m,y]=a.useState("2005"),v=JSON.parse(localStorage.getItem("user")||"{}");a.useEffect(()=>{(async()=>{try{const P=await Te.get();P?.screenLockPassword&&y(P.screenLockPassword)}catch(P){console.warn("Failed to load settings, using default password:",P)}})()},[]),a.useEffect(()=>{const A=document.getElementById(l==="password"?"unlock-password":"unlock-pin");A&&A.focus()},[l]);const N=async A=>{A.preventDefault(),A.stopPropagation(),D(!0),g("");try{if(l==="password")if(f===m)s();else throw new Error("Incorrect password");else if(l==="pin"&&v.pin)if(i===v.pin)s();else throw new Error("Incorrect PIN");else throw new Error(`Please enter a valid ${l}`)}catch(P){g(P.message||"Unlock failed")}finally{D(!1)}},S=A=>{const P=A.replace(/\D/g,"").slice(0,4);r(P)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:A=>A.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8",onClick:A=>A.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${o==="main_admin"?"bg-gradient-to-br from-red-600 to-orange-600":"bg-gradient-to-br from-blue-600 to-purple-600"}`,children:e.jsx(ne,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-gray-600",children:o==="main_admin"?"Main Admin":v.name||"User"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Enter your ",l," to continue"]})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[o!=="main_admin"&&v.pin&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unlock Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{p("password"),g("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${l==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ”‘ Password"}),e.jsx("button",{type:"button",onClick:()=>{p("pin"),g("")},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${l==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ“± PIN"})]})]}),(l==="password"||o==="main_admin")&&e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-password",type:d?"text":"password",placeholder:"Enter your password",className:"w-full pl-10 pr-12 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",value:f,onChange:A=>j(A.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>n(!d),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:d?e.jsx(Nt,{className:"w-5 h-5"}):e.jsx(st,{className:"w-5 h-5"})})]}),l==="pin"&&o!=="main_admin"&&e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"unlock-pin",type:"text",placeholder:"Enter 4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-center text-2xl tracking-widest",value:i,onChange:A=>S(A.target.value),maxLength:4,required:!0})]}),h&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg border border-red-200",children:h}),e.jsx("button",{type:"submit",disabled:c||l==="pin"&&i.length!==4,className:`w-full py-3 rounded-lg font-bold transition-all disabled:opacity-50 disabled:cursor-not-allowed ${o==="main_admin"?"bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white":"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white"}`,children:c?"Unlocking...":"Unlock Screen"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Screen locked due to inactivity for security"})})]})})}function Et(s=6e4){const[o,f]=a.useState(!1),[j,i]=a.useState(Date.now()),r=a.useCallback(()=>{i(Date.now()),o&&f(!1)},[o]),l=a.useCallback(()=>{f(!1),r()},[r]);return a.useEffect(()=>{const p=["mousedown","mousemove","keypress","scroll","touchstart","click"],d=()=>{r()};p.forEach(h=>{document.addEventListener(h,d,!0)});const n=setInterval(()=>{Date.now()-j>s&&!o&&f(!0)},1e3);return()=>{p.forEach(h=>{document.removeEventListener(h,d,!0)}),clearInterval(n)}},[j,s,o,r]),[o,l,r]}function Cs(){const{user:s,logout:o,isCashierUserManagementEnabled:f}=xe(),j=pe(),i=tt(),[r,l]=a.useState(!0),[p,d]=a.useState(!1),[n,h]=a.useState({}),[g,c]=Et(45e3);a.useEffect(()=>{const N=()=>{const A=localStorage.getItem("user");if(A){const P=JSON.parse(A);let R=!1;(P.plan==="ultra"||P.role==="admin")&&(P.active||(P.active=!0,R=!0),P.plan==="ultra"&&P.role!=="admin"&&(P.role="admin",R=!0),P.plan==="ultra"&&(!P.price||P.price!==1600)&&(P.price=1600,R=!0),R&&(localStorage.setItem("user",JSON.stringify(P)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};N(),setTimeout(N,100);const S=setTimeout(()=>{d(!0)},1e3);return D(),()=>clearTimeout(S)},[]);const D=async()=>{try{const N=await Te.get();h(N)}catch(N){console.error("Failed to load settings:",N)}},m=async()=>{if(window.confirm("Are you sure you want to clear all sales and data? This action cannot be undone."))try{const N=localStorage.getItem("token");await fetch(`${Y}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})}),alert("Data cleared successfully!"),window.location.reload()}catch(N){console.error("Failed to clear data:",N),alert("Failed to clear data")}},y=[{id:"overview",label:"Dashboard",icon:Jt,path:"/admin"},{id:"sales",label:"Sales",icon:bt,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:Ie,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:vt,path:"/admin/recipes"},{id:"expenses",label:"Expenses",icon:Be,path:"/admin/expenses"},...f()?[{id:"users",label:"Users",icon:he,path:"/admin/users"}]:[],{id:"time",label:"Time Tracking",icon:Ue,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:rt,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:ue,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:Qe,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:He,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:Xe,path:"/admin/settings"}],v=N=>N==="/admin"?i.pathname==="/admin":i.pathname.startsWith(N);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${r?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[r&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>l(!r),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r?e.jsx(Ee,{className:"w-5 h-5"}):e.jsx(Gt,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:y.map(N=>{const S=N.icon;return e.jsxs("button",{onClick:()=>j(N.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${v(N.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(S,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:N.label})]},N.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(Vt,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:o,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(Je,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Logout"})]}),e.jsxs("button",{onClick:m,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors",children:[e.jsx(Ee,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Clear Data"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:y.find(N=>v(N.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:s?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(gt,{children:[e.jsx(K,{path:"/",element:e.jsx(us,{})}),e.jsx(K,{path:"/sales",element:e.jsx(bs,{})}),e.jsx(K,{path:"/inventory",element:e.jsx(ps,{})}),e.jsx(K,{path:"/recipes",element:e.jsx(gs,{})}),e.jsx(K,{path:"/expenses",element:e.jsx(fs,{})}),e.jsx(K,{path:"/reminders",element:e.jsx(ws,{})}),e.jsx(K,{path:"/service-fees",element:e.jsx(vs,{})}),e.jsx(K,{path:"/discounts",element:e.jsx(Ss,{})}),e.jsx(K,{path:"/credit-requests",element:e.jsx(ks,{})}),e.jsx(K,{path:"/users",element:e.jsx(js,{})}),e.jsx(K,{path:"/time",element:e.jsx(ys,{})}),e.jsx(K,{path:"/settings",element:e.jsx(Ns,{})})]})})]}),p&&e.jsx(Tt,{onClose:()=>d(!1)}),g&&e.jsx(It,{onUnlock:c,logo:n.logo})]})}function Ps(){const s=pe(),[o,f]=a.useState(!1),[j,i]=a.useState(0),r=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 900) or Ultra (KSH 1,600) package",image:"ðŸ“",details:"First user becomes Admin automatically. Choose Ultra for full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],l=[{icon:Ie,title:"Smart Inventory",desc:"Track raw materials & composite products with automatic stock deduction"},{icon:vt,title:"Recipe Builder",desc:"Create bundled products with BOM and auto-calculate COGS"},{icon:De,title:"Real-time Analytics",desc:"Monitor sales, profit margins, and expenses in real-time"},{icon:he,title:"User Management",desc:"Add cashiers with custom permissions and role-based access"},{icon:ve,title:"Secure & Reliable",desc:"JWT authentication with role-based security"},{icon:et,title:"Advanced Reports",desc:"Daily, weekly summaries with profit/loss tracking"}],p=[{name:"Basic",price:900,icon:lt,popular:!1,features:["Cashier Dashboard","Basic Inventory","Sales Tracking","Daily/Weekly Reports","Single User","Email Support"]},{name:"Ultra",price:1600,icon:nt,popular:!0,features:["Admin + Cashier Dashboard","Full Inventory Management","Recipe/BOM Builder","Auto Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Unlimited Users","Priority Support"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s("/auth/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>s("/plans"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(Wt,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>s("/plans"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(Fe,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>f(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(Yt,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 30-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(et,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:l.map((d,n)=>{const h=d.icon;return e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(h,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:d.title}),e.jsx("p",{className:"text-gray-600",children:d.desc})]},n)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:p.map((d,n)=>{const h=d.icon;return e.jsxs("div",{className:`relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${d.popular?"ring-4 ring-blue-600":""}`,children:[d.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${d.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(h,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:d.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",d.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:d.features.map((g,c)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(_e,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:g})]},c))}),e.jsx("button",{onClick:()=>s("/plans"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${d.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},n)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>s("/plans"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(Fe,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{f(!1),i(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Ee,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",j+1," of ",r.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((j+1)/r.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(j+1)/r.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:r[j].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:r[j].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:r[j].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:r[j].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>i(Math.max(0,j-1)),disabled:j===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),j<r.length-1?e.jsxs("button",{onClick:()=>i(j+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(Fe,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{f(!1),i(0),s("/plans")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(Fe,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:r.map((d,n)=>e.jsx("button",{onClick:()=>i(n),className:`w-2 h-2 rounded-full transition-all ${n===j?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},n))})]})]})})]})}function pt(){const s=tt(),[o,f]=a.useState(s.pathname==="/auth/login"),[j,i]=a.useState("password"),[r,l]=a.useState({email:"",password:"",pin:"",name:"",newPassword:"",confirmPassword:""}),[p,d]=a.useState(""),[n,h]=a.useState(!1),[g,c]=a.useState(!1),D=pe(),{login:m}=xe(),y=()=>{try{return JSON.parse(localStorage.getItem("selectedPlan")||"null")}catch(N){return console.warn("Invalid selectedPlan in localStorage:",N),null}},v=async N=>{N.preventDefault(),d(""),h(!0);try{if(g){if(r.newPassword!==r.confirmPassword){d("Passwords do not match"),h(!1);return}if(r.newPassword.length<6){d("Password must be at least 6 characters"),h(!1);return}const t=await Se.login({email:r.email,newPassword:r.newPassword});t.token&&t.user&&(await m(t),D("/dashboard"));return}if(o){if(j==="pin"){if(!r.pin||r.pin.length!==4){d("Please enter a valid 4-digit PIN"),h(!1);return}}else if(!r.password){d("Please enter your password"),h(!1);return}}let S;if(o)if(j==="pin")try{S=await Se.pinLogin({email:r.email,pin:r.pin})}catch(t){if(t.message.includes("PIN not set"))d("PIN not set for this user. Please use password login.");else if(t.message.includes("Invalid PIN"))d("Invalid PIN. Please try again.");else throw t;h(!1);return}else S=await Se.login({email:r.email,password:r.password});else{const t=y();S=await Se.signup({...r,plan:t?.id||"basic"})}if(S.needsPasswordSetup){c(!0),l({...r,email:S.email}),d(""),h(!1);return}if(!S||!S.user||!S.token)throw new Error("Authentication failed. Please try again.");const A={id:Date.now(),type:o?"login":"signup",user:{id:S.user.id,name:S.user.name,email:S.user.email,role:S.user.role,plan:S.user.plan},timestamp:new Date().toISOString(),ip:"Unknown",userAgent:navigator.userAgent},P=JSON.parse(localStorage.getItem("authActivities")||"[]");P.unshift(A),P.splice(50),localStorage.setItem("authActivities",JSON.stringify(P)),await m(S);const R=o?"logged in":"signed up";console.log(`âœ… User ${S.user.name} ${R} successfully`),S.user.role==="admin"?D("/admin"):S.user.role==="cashier"||S.user.plan==="basic"?D("/dashboard/cashier"):D("/admin")}catch(S){console.error("Authentication error:",S);let A=S.message||"Authentication failed. Please try again.";S.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),A="Invalid credentials. Please try again."),d(A)}finally{h(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:o?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600",children:o?"Login to your account":"Create your account"})]}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[g?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.newPassword,onChange:N=>l({...r,newPassword:N.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.confirmPassword,onChange:N=>l({...r,confirmPassword:N.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!o&&e.jsxs("div",{className:"relative",children:[e.jsx(at,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.name,onChange:N=>l({...r,name:N.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(wt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.email,onChange:N=>l({...r,email:N.target.value}),required:!0})]}),o&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Login Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>i("password"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${j==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Password"}),e.jsx("button",{type:"button",onClick:()=>i("pin"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${j==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"pin"})]})]}),o&&j==="password"&&e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.password,onChange:N=>l({...r,password:N.target.value}),required:!0})]}),o&&j==="pin"&&e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.pin,onChange:N=>l({...r,pin:N.target.value.replace(/\D/g,"").slice(0,4)}),maxLength:4,required:!0})]}),!o&&e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:r.password,onChange:N=>l({...r,password:N.target.value}),required:!0})]})]}),p&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:p}),e.jsx("button",{type:"submit",disabled:n,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50",children:n?"Please wait...":g?"Set Password":o?"Login":"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{f(!o),d(""),c(!1)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:o?"Don't have an account? Sign up":"Already have an account? Login"})})]})})}function As(){const[s,o]=a.useState("ultra"),[f,j]=a.useState(!1),[i,r]=a.useState({name:"",email:"",company:""}),l=pe(),p=[{id:"basic",name:"Basic Package",price:1e3,icon:lt,color:"from-green-500 to-teal-600",features:["Cashier Dashboard Only","Basic Inventory Management","Sales Tracking","Daily/Weekly Sales Summaries","Basic Profit/Loss View","Limited Email Notifications","Record Products Sold","Single User Access"]},{id:"ultra",name:"Ultra Package (Admin + Cashier)",price:2400,icon:nt,color:"from-blue-600 to-purple-600",popular:!0,features:["Admin Dashboard + Cashier POS","Full Inventory Management","Recipe/BOM Builder","Composite Products Support","Automatic Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Advanced Analytics","Unlimited Users"]}],d=async n=>{n.preventDefault();try{await fetch(`${Y}/demo-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),alert("Demo request submitted! Admin will review and contact you."),j(!1),r({name:"",email:"",company:""})}catch(h){console.error("Demo request failed:",h),alert("Failed to submit demo request. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:()=>l("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition",children:[e.jsx(Qt,{size:20}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mb-8 md:mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Select the perfect plan for your business needs"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6 md:mb-8",children:p.map(n=>{const h=n.icon;return e.jsxs("div",{onClick:()=>o(n.id),className:`card cursor-pointer transition-all transform hover:scale-105 relative ${s===n.id?"ring-4 ring-blue-600 shadow-2xl bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-xl"}`,children:[n.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 md:mb-4",children:[e.jsx("div",{className:`w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br ${n.color} flex items-center justify-center`,children:e.jsx(h,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:n.name})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("span",{className:"text-3xl md:text-4xl font-bold",children:["KSH ",n.price]}),e.jsx("span",{className:"text-gray-600 text-sm md:text-base",children:"/month"})]}),e.jsx("ul",{className:"space-y-2 md:space-y-3",children:n.features.map((g,c)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(_e,{className:"w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs md:text-sm",children:g})]},c))})]},n.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center animate-fade-in",children:[e.jsx("button",{onClick:()=>{console.log("Get Started clicked with plan:",s);const n=p.find(h=>h.id===s);console.log("Selected plan:",n),localStorage.setItem("selectedPlan",JSON.stringify(n)),l("/auth/signup")},className:"btn-primary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all",children:"Get Started"}),e.jsx("button",{onClick:()=>j(!0),className:"btn-secondary px-8 md:px-12 py-3 md:py-4 text-base md:text-lg border-2 border-gray-300 hover:border-gray-400 transition-all",children:"Request Free Demo"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-3 md:mt-4 text-center",children:"Secure payment â€¢ Cancel anytime"}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Free Demo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"We'll contact you to schedule a demo"})]}),e.jsxs("form",{onSubmit:d,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:i.name,onChange:n=>r({...i,name:n.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:i.email,onChange:n=>r({...i,email:n.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:i.company,onChange:n=>r({...i,company:n.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition",children:"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>j(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})})}function Ds(){const{user:s,logout:o}=xe(),[f,j]=a.useState([]),[i,r]=a.useState([]),[l,p]=a.useState([]),[d,n]=a.useState("cash"),[h,g]=a.useState("pos"),[c,D]=a.useState({sales:[],expenses:[],stats:{}}),[m,y]=a.useState(""),[v,N]=a.useState(!1),[S,A]=a.useState(!1),[P,R]=a.useState(null),[t,C]=a.useState({name:"",price:"",cost:"",category:"finished",image:""}),[u,k]=a.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[I,E]=a.useState(!1),[q,te]=a.useState({description:"",amount:"",category:""}),[re,H]=a.useState("");a.useEffect(()=>{Q()},[]),a.useEffect(()=>{const b=ds(L=>{try{if(!L)return;(L.type==="initial"||L.type==="products_snapshot"||L.type==="product_created"||L.type==="product_updated"||L.type==="product_deleted")&&ce.getAll().then(_=>j(_.filter(B=>B.visibleToCashier!==!1&&!B.expenseOnly))).catch(()=>{})}catch(_){console.error("Product subscription handler error",_)}});return()=>{try{b()}catch{}}},[]);const Q=async()=>{try{const[b,L,_,B,Z]=await Promise.all([ce.getAll(),Le.getAll(),ze.getAll(),Pt.get(),Ke.getAll()]);j(b.filter(be=>be.visibleToCashier!==!1&&!be.expenseOnly)),D({sales:L,expenses:_,stats:B}),r(Z)}catch(b){console.error("Failed to load data:",b)}},W=(b,L=!0)=>{const _=b.target.files[0];if(_){const B=new FileReader;B.onload=Z=>{const be=Z.target.result;H(be),L&&C({...t,image:be})},B.readAsDataURL(_)}},ae=b=>i.filter(_=>_.productId===b&&_.quantity>0).reduce((_,B)=>_+B.quantity,0),O=b=>{const L=ae(b.id);if(L<=0){alert("Product is out of stock!");return}const _=l.find(Z=>Z.id===b.id);if((_?_.quantity:0)>=L){alert(`Only ${L} units available in stock!`);return}p(_?l.map(Z=>Z.id===b.id?{...Z,quantity:Z.quantity+1}:Z):[...l,{...b,quantity:1}])},X=(b,L)=>{f.find(B=>B.id===b);const _=ae(b);p(l.map(B=>{if(B.id===b){const Z=B.quantity+L;return Z>_?(alert(`Only ${_} units available!`),B):{...B,quantity:Math.max(1,Z)}}return B}).filter(B=>B.quantity>0))},w=b=>{p(l.filter(L=>L.id!==b))},F=l.reduce((b,L)=>b+L.price*L.quantity,0),$=async()=>{if(l.length!==0)try{await Le.create({items:l.map(b=>({productId:b.id,quantity:b.quantity,price:b.price})),total:F,paymentMethod:d}),p([]),await Q(),alert("Sale completed successfully!")}catch(b){console.error("Checkout failed:",b),alert("Sale failed. Please try again.")}},G=async b=>{b.preventDefault();try{await ce.create({...t,price:parseFloat(t.price),cost:parseFloat(t.cost||0),quantity:0}),C({name:"",price:"",cost:"",category:"finished",image:""}),H(""),N(!1),await Q(),alert("Product added successfully!")}catch(L){console.error("Failed to add product:",L),alert("Failed to add product")}},V=async b=>{b.preventDefault();try{await Ke.create({productId:P.id,quantity:parseInt(u.quantity),expiryDate:u.expiryDate,batchNumber:u.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(u.cost||P.cost||0)}),k({quantity:"",expiryDate:"",batchNumber:"",cost:""}),A(!1),R(null),await Q(),alert("Stock added successfully!")}catch(L){console.error("Failed to add stock:",L),alert("Failed to add stock")}},de=async b=>{b.preventDefault();try{await ze.create({...q,amount:parseFloat(q.amount)}),te({description:"",amount:"",category:""}),E(!1),await Q()}catch(L){console.error("Failed to add expense:",L),alert("Failed to add expense")}},ge=async()=>{if(window.confirm("Are you sure you want to clear all sales and data? This action cannot be undone."))try{const b=localStorage.getItem("token");await fetch(`${Y}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})}).catch(()=>{}),D({sales:[],expenses:[],stats:{totalSales:0,totalExpenses:0,profit:0}}),p([]),alert("Data cleared successfully!"),await Q()}catch(b){console.error("Failed to clear data:",b),alert("Failed to clear data")}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Cashier Dashboard"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cashier Plan - KSH 900/month"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s?.email})]}),e.jsxs("button",{onClick:o,className:"btn-secondary flex items-center gap-2 hover:bg-red-50 hover:text-red-600 hover:border-red-200",children:[e.jsx(Je,{className:"w-4 h-4"}),"Logout"]}),e.jsxs("button",{onClick:ge,className:"btn-secondary flex items-center gap-2 hover:bg-orange-50 hover:text-orange-600 hover:border-orange-200",children:[e.jsx(oe,{className:"w-4 h-4"}),"Clear Data"]})]})]})}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>g("pos"),className:`px-6 py-2 rounded-lg font-medium transition-all ${h==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Re,{className:"w-4 h-4 inline mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>g("monitor"),className:`px-6 py-2 rounded-lg font-medium transition-all ${h==="monitor"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(et,{className:"w-4 h-4 inline mr-2"}),"Monitor"]}),e.jsxs("button",{onClick:()=>g("products"),className:`px-6 py-2 rounded-lg font-medium transition-all ${h==="products"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ie,{className:"w-4 h-4 inline mr-2"}),"Products"]}),e.jsxs("button",{onClick:()=>g("expenses"),className:`px-6 py-2 rounded-lg font-medium transition-all ${h==="expenses"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Be,{className:"w-4 h-4 inline mr-2"}),"Expenses"]})]}),h==="pos"&&e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:m,onChange:b=>y(b.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:f.filter(b=>b.name?.toLowerCase().includes(m.toLowerCase())).map(b=>{const L=ae(b.id),_=L<10,B=L<=0;return e.jsxs("button",{onClick:()=>O(b),disabled:B,className:`card text-left hover:shadow-xl transition-all transform hover:scale-105 relative ${B?"opacity-50 cursor-not-allowed bg-gray-100":"bg-gradient-to-br from-white to-gray-50"}`,children:[b.image&&e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:b.image,alt:b.name,className:"w-full h-full object-cover"})}),_&&!B&&e.jsx("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white p-1 rounded-full",children:e.jsx(ke,{className:"w-4 h-4"})}),B&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"OUT"}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-900",children:b.name}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["KSH ",b.price?.toLocaleString()]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:`text-xs font-medium ${B?"text-red-600":_?"text-yellow-600":"text-gray-500"}`,children:["Stock: ",L]}),_&&!B&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium",children:"Low Stock"})]})]},b.id)})})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-gray-200 p-6 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(Re,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[l.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:l.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(Re,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:l.map(b=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:b.name}),e.jsx("button",{onClick:()=>w(b.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(oe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>X(b.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(Zt,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-semibold",children:b.quantity}),e.jsx("button",{onClick:()=>X(b.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(ie,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(b.price*b.quantity).toLocaleString()]})]})]},b.id))})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between text-xl font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",F.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:d,onChange:b=>n(b.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:$,disabled:l.length===0,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg",children:"Complete Sale"})]})]})]}),h==="monitor"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",c.stats.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(ue,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",c.stats.totalExpenses?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Be,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",c.stats.profit?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(ue,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Sales"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"})]})}),e.jsx("tbody",{children:c.sales.slice(-15).reverse().map((b,L)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(b.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[b.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:b.paymentMethod||"cash"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",b.total?.toLocaleString()]})]},L))})]})})]})]}),h==="products"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Manage Products & Stock"}),e.jsxs("button",{onClick:()=>N(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700",children:[e.jsx(ie,{className:"w-4 h-4"}),"Add Product"]})]}),v&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl border-2 border-green-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Product"}),e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:t.name,onChange:b=>C({...t,name:b.target.value}),required:!0}),e.jsxs("select",{className:"input",value:t.category,onChange:b=>C({...t,category:b.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsx("input",{type:"number",placeholder:"Selling Price",className:"input",value:t.price,onChange:b=>C({...t,price:b.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Cost Price (Optional)",className:"input",value:t.cost,onChange:b=>C({...t,cost:b.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:b=>W(b,!0),className:"input"}),e.jsx(jt,{className:"w-5 h-5 text-gray-400"})]}),re&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:re,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{N(!1),H(""),C({name:"",price:"",cost:"",category:"finished",image:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),S&&P&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"font-semibold mb-4 text-lg",children:["Add Stock for ",P.name]}),e.jsxs("form",{onSubmit:V,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:u.quantity,onChange:b=>k({...u,quantity:b.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:u.expiryDate,onChange:b=>k({...u,expiryDate:b.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:u.batchNumber,onChange:b=>k({...u,batchNumber:b.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per Unit",className:"input",value:u.cost,onChange:b=>k({...u,cost:b.target.value})}),e.jsxs("div",{className:"flex gap-2 md:col-span-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{A(!1),R(null),k({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:f.map(b=>{const L=ae(b.id),_=i.filter(Z=>Z.productId===b.id&&Z.quantity>0),B=L<10;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[b.image&&e.jsx("img",{src:b.image,alt:b.name,className:"w-10 h-10 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:b.name}),e.jsx("div",{className:"text-xs text-gray-500",children:b.category})]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",b.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium ${L===0?"text-red-600":B?"text-yellow-600":"text-gray-900"}`,children:L}),B&&L>0&&e.jsx(ke,{className:"w-4 h-4 text-yellow-500"}),L===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"text-gray-600",children:[_.length," active"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{R(b),A(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-green-50 rounded-lg text-green-600 transition-colors",title:"Edit Product",children:e.jsx(Ce,{className:"w-4 h-4"})})]})})]},b.id)})})]})})]})}),h==="expenses"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Track Expenses"}),e.jsxs("button",{onClick:()=>E(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700",children:[e.jsx(ie,{className:"w-4 h-4"}),"Add Expense"]})]}),I&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border-2 border-red-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Expense"}),e.jsxs("form",{onSubmit:de,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:q.description,onChange:b=>te({...q,description:b.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Amount",className:"input",value:q.amount,onChange:b=>te({...q,amount:b.target.value}),required:!0}),e.jsx("input",{type:"text",placeholder:"Category",className:"input",value:q.category,onChange:b=>te({...q,category:b.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>E(!1),className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:c.expenses.slice().reverse().map((b,L)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(b.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:b.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:b.category||"General"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",b.amount?.toLocaleString()]})]},L))})]})})]})})]})}function Ts(){const[s,o]=a.useState({email:"",password:""}),[f,j]=a.useState(!1),[i,r]=a.useState(""),[l,p]=a.useState(!1),d=pe();tt(),a.useEffect(()=>{const h=localStorage.getItem("ownerToken"),g=localStorage.getItem("ownerUser");if(h&&g)try{const c=JSON.parse(g);if(c.type==="main_admin"||c.type==="owner"){d("/main.admin/dashboard");return}}catch{localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser")}},[d]);const n=async h=>{h.preventDefault(),j(!0),r("");try{const g=await me.login(s);if(g.token&&g.user&&(g.user.type==="main_admin"||g.user.type==="owner"))localStorage.setItem("ownerToken",g.token),localStorage.setItem("ownerUser",JSON.stringify(g.user)),d("/main.admin/dashboard");else throw new Error("Invalid response from server")}catch(g){console.error("Owner login error:",g),r(g.message||"Access denied. Owner access only.")}finally{j(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-black/50 backdrop-blur-lg rounded-2xl shadow-2xl max-w-md w-full p-8 border border-red-500/30",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-red-600 to-black rounded-2xl mx-auto mb-4 flex items-center justify-center border border-red-500/50",children:e.jsx(ve,{className:"w-8 h-8 text-red-400"})}),e.jsx("h1",{className:"text-3xl font-bold text-red-400 mb-2",children:"MAIN.ADMIN"}),e.jsx("p",{className:"text-gray-400",children:"System Owner Access"}),e.jsx("div",{className:"mt-2 text-xs text-red-500 bg-red-500/10 px-3 py-1 rounded border border-red-500/30",children:"ðŸ”’ ianmabruk3@gmail.com only"})]}),e.jsxs("form",{onSubmit:n,className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(wt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),e.jsx("input",{type:"email",placeholder:"Owner Email",className:"w-full pl-10 pr-4 py-3 bg-black/30 border border-red-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",value:s.email,onChange:h=>o({...s,email:h.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),e.jsx("input",{type:l?"text":"password",placeholder:"Owner Password",className:"w-full pl-10 pr-12 py-3 bg-black/30 border border-red-500/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",value:s.password,onChange:h=>o({...s,password:h.target.value}),required:!0}),e.jsx("button",{type:"button",onClick:()=>p(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-400",children:l?e.jsx(Nt,{className:"w-5 h-5"}):e.jsx(st,{className:"w-5 h-5"})})]}),i&&e.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm bg-red-500/10 p-3 rounded-lg border border-red-500/30",children:[e.jsx(Me,{className:"w-4 h-4"}),i]}),e.jsx("button",{type:"submit",disabled:f,className:"w-full bg-gradient-to-r from-red-600 to-red-800 text-white py-3 rounded-lg font-bold hover:from-red-700 hover:to-red-900 transition-all disabled:opacity-50 disabled:cursor-not-allowed border border-red-500/50",children:f?"Authenticating...":"ACCESS SYSTEM"})]}),e.jsx("div",{className:"mt-8 p-4 bg-red-500/10 border border-red-500/30 rounded-lg",children:e.jsx("p",{className:"text-red-300 text-xs text-center",children:"âš ï¸ Restricted to system owner only"})})]})})}function Is(){const[s,o]=a.useState([]),[f,j]=a.useState([]),[i,r]=a.useState({}),[l,p]=a.useState(!0),[d,n]=a.useState("overview"),[h,g]=a.useState(null),[c,D]=a.useState(null),[m,y]=a.useState(!1),v=pe();a.useEffect(()=>{const t=localStorage.getItem("ownerToken"),C=localStorage.getItem("ownerUser");if(!t||!C){v("/main.admin");return}try{const u=JSON.parse(C);if(u.type!=="main_admin"&&u.type!=="owner"||u.email!=="ianmabruk3@gmail.com"){v("/main.admin");return}}catch{v("/main.admin");return}N()},[v]);const N=async()=>{try{p(!0);const[t,C,u]=await Promise.all([me.getUsers(),me.getStats(),me.getActivities()]);o(t),r(C),j(u)}catch(t){console.error("Failed to load data:",t)}finally{p(!1)}},S=async(t,C)=>{try{g(`lock-${t}`);const u=!C;await me.lockUser(t,u),o(s.map(k=>k.id===t?{...k,locked:u,active:!u}:k)),setTimeout(N,1e3)}catch(u){console.error("Failed to toggle lock:",u),alert("Failed to update user status")}finally{g(null)}},A=async(t,C)=>{try{g(`plan-${t}`),await me.changePlan(t,C),o(s.map(u=>u.id===t?{...u,plan:C,price:C==="ultra"?2400:C==="basic"?1e3:0}:u)),y(!1),D(null),setTimeout(N,1e3)}catch(u){console.error("Failed to change plan:",u),alert("Failed to change user plan")}finally{g(null)}},P=async t=>{const C=t==="all"?"Are you sure you want to clear ALL system data? This will remove all sales, expenses, and products from ALL users. This cannot be undone.":`Are you sure you want to clear ${t} data from ALL users? This cannot be undone.`;if(confirm(C))try{g(`clear-${t}`),await me.clearData(t),alert(`${t.charAt(0).toUpperCase()+t.slice(1)} data cleared successfully`),N()}catch(u){console.error("Clear data failed:",u),alert("Failed to clear data")}finally{g(null)}},R=()=>{localStorage.removeItem("ownerToken"),localStorage.removeItem("ownerUser"),v("/main.admin")};return l?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-red-400 text-xl",children:"Loading System Control..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black",children:[e.jsx("header",{className:"bg-black/50 backdrop-blur-lg border-b border-red-500/30 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ve,{className:"w-8 h-8 text-red-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-red-400",children:"MAIN.ADMIN"}),e.jsx("p",{className:"text-gray-400",children:"Ian Mabruk - System Owner"})]})]}),e.jsxs("button",{onClick:R,className:"flex items-center gap-2 bg-red-600/20 hover:bg-red-600/30 text-red-300 px-4 py-2 rounded-lg transition-colors border border-red-500/30",children:[e.jsx(Je,{className:"w-4 h-4"}),"Logout"]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(he,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:i.totalUsers||0})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Users"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ne,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:i.activeUsers||0})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Active Users"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ye,{className:"w-8 h-8 text-yellow-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:i.trialUsers||0})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Free Trials"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ue,{className:"w-8 h-8 text-green-400"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:["KSH ",(i.mrr||0).toLocaleString()]})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Monthly Revenue"})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ge,{className:"w-8 h-8 text-purple-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:(i.totalSignups||0)+(i.totalLogins||0)})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Activities"})]})]}),e.jsx("div",{className:"flex gap-4 mb-6 overflow-x-auto",children:[{id:"overview",label:"Overview",icon:De},{id:"users",label:`Users (${s.length})`,icon:he},{id:"activities",label:`Activities (${f.length})`,icon:Ge},{id:"system",label:"System Control",icon:Xe}].map(t=>{const C=t.icon;return e.jsxs("button",{onClick:()=>n(t.id),className:`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all whitespace-nowrap ${d===t.id?"bg-red-600 text-white":"bg-black/30 text-gray-300 hover:bg-black/50"}`,children:[e.jsx(C,{className:"w-4 h-4"}),t.label]},t.id)})}),d==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Plan Distribution"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-300 font-semibold",children:"Free Trial"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:i.planDistribution?.trial||0})]}),e.jsx(ye,{className:"w-8 h-8 text-yellow-400"})]})}),e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-300 font-semibold",children:"Basic Plan"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:i.planDistribution?.basic||0})]}),e.jsx(Ye,{className:"w-8 h-8 text-blue-400"})]})}),e.jsx("div",{className:"bg-purple-500/10 border border-purple-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-300 font-semibold",children:"Ultra Plan"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:i.planDistribution?.ultra||0})]}),e.jsx(nt,{className:"w-8 h-8 text-purple-400"})]})})]})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Recent Activity Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"User Activity"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Signups:"}),e.jsx("span",{className:"text-green-400",children:i.totalSignups||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Logins:"}),e.jsx("span",{className:"text-blue-400",children:i.totalLogins||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Recent Signups (7d):"}),e.jsx("span",{className:"text-yellow-400",children:i.recentSignups||0})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"System Health"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Active Users:"}),e.jsx("span",{className:"text-green-400",children:i.activeUsers||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Locked Users:"}),e.jsx("span",{className:"text-red-400",children:i.lockedUsers||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Revenue:"}),e.jsxs("span",{className:"text-green-400",children:["KSH ",(i.totalRevenue||0).toLocaleString()]})]})]})]})]})]})]}),d==="users"&&e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl border border-red-500/30 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"User Management"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Manage all system users, plans, and access control"})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User Details"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan & Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Trial Info"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Account Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Actions"})]})}),e.jsx("tbody",{children:s.map(t=>{const C=t.isFreeTrial,u=t.createdAt?new Date(t.createdAt).toLocaleDateString():"Unknown";return e.jsxs("tr",{className:"border-t border-red-500/20 hover:bg-black/20 transition",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:t.name}),e.jsx("p",{className:"text-sm text-gray-400",children:t.email}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",t.id," | Role: ",t.role]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Created: ",u]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-1",children:[C?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-yellow-500/20 text-yellow-300 flex items-center gap-1 w-fit",children:[e.jsx(ye,{className:"w-3 h-3"}),"FREE TRIAL"]}):e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${t.plan==="ultra"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"}`,children:t.plan?.toUpperCase()}),t.price&&e.jsxs("p",{className:"text-xs text-gray-400",children:["KSH ",t.price,"/month"]})]})}),e.jsx("td",{className:"px-4 py-4",children:C?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("span",{className:"px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-300",children:[t.trialDaysLeft||0," days left"]}),t.trialDaysLeft<=7&&e.jsx("p",{className:"text-xs text-red-400",children:"âš ï¸ Expiring soon"})]}):e.jsx("span",{className:"text-xs text-gray-500",children:"Paid Plan"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-1",children:[t.locked?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-300 flex items-center gap-1 w-fit",children:[e.jsx(ne,{className:"w-3 h-3"}),"Locked"]}):t.active?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-300 flex items-center gap-1 w-fit",children:[e.jsx(Ne,{className:"w-3 h-3"}),"Active"]}):e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-500/20 text-gray-300 w-fit",children:"Inactive"}),t.pin&&e.jsx("p",{className:"text-xs text-blue-400",children:"PIN Set"})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>S(t.id,t.locked),disabled:h===`lock-${t.id}`,className:`p-2 rounded-lg transition ${t.locked?"bg-green-500/20 hover:bg-green-500/30 text-green-300":"bg-red-500/20 hover:bg-red-500/30 text-red-300"} ${h===`lock-${t.id}`?"opacity-50 cursor-not-allowed":""}`,title:t.locked?"Unlock User":"Lock User",children:h===`lock-${t.id}`?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):t.locked?e.jsx(St,{className:"w-4 h-4"}):e.jsx(ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{D(t),y(!0)},disabled:h===`plan-${t.id}`,className:"p-2 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 transition",title:"Change Plan",children:h===`plan-${t.id}`?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(Xt,{className:"w-4 h-4"})})]})})]},t.id)})})]}),s.length===0&&e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx(he,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No users registered yet"})]})]})]}),d==="activities"&&e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl border border-red-500/30 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-red-500/30",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"System Activity Log"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"All user activities and admin actions"})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Activity Type"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User Details"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan/Action"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Time"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"IP Address"})]})}),e.jsx("tbody",{children:f.slice(0,100).map(t=>{const C=t.timestamp?new Date(t.timestamp).toLocaleString():"Unknown",u=t.type==="signup",k=t.type==="admin_action";return e.jsxs("tr",{className:"border-t border-red-500/20 hover:bg-black/20 transition",children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${u?"bg-green-500/20 text-green-300":k?"bg-red-500/20 text-red-300":"bg-blue-500/20 text-blue-300"}`,children:u?"SIGNUP":k?"ADMIN":"LOGIN"}),k&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:t.action})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:t.name||t.targetUserEmail}),e.jsx("p",{className:"text-sm text-gray-400",children:t.email||t.targetUserEmail}),k&&e.jsxs("p",{className:"text-xs text-red-400",children:["By: ",t.adminEmail]})]})}),e.jsx("td",{className:"px-4 py-4",children:k?e.jsxs("div",{className:"text-xs",children:[t.oldPlan&&t.newPlan&&e.jsxs("span",{className:"text-yellow-400",children:[t.oldPlan," â†’ ",t.newPlan]}),t.action==="user_locked"&&e.jsx("span",{className:"text-red-400",children:"User Locked"}),t.action==="user_unlocked"&&e.jsx("span",{className:"text-green-400",children:"User Unlocked"})]}):e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${t.plan==="ultra"?"bg-purple-500/20 text-purple-300":t.plan==="basic"?"bg-blue-500/20 text-blue-300":"bg-yellow-500/20 text-yellow-300"}`,children:t.plan?.toUpperCase()||"TRIAL"})}),e.jsx("td",{className:"px-4 py-4 text-gray-300 text-sm",children:C}),e.jsx("td",{className:"px-4 py-4 text-gray-400 text-sm",children:t.ipAddress||"Unknown"})]},t.id)})})]}),f.length===0&&e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx(Ge,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No activity recorded yet"})]})]})]}),d==="system"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(es,{className:"w-6 h-6"}),"System Data Management"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("button",{onClick:()=>P("sales"),disabled:h==="clear-sales",className:"p-4 bg-orange-500/20 hover:bg-orange-500/30 border border-orange-500/30 rounded-lg text-orange-300 transition-colors disabled:opacity-50",children:[h==="clear-sales"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(oe,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear Sales"}),e.jsx("p",{className:"text-xs opacity-75",children:"All user sales data"})]}),e.jsxs("button",{onClick:()=>P("expenses"),disabled:h==="clear-expenses",className:"p-4 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded-lg text-red-300 transition-colors disabled:opacity-50",children:[h==="clear-expenses"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(ue,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear Expenses"}),e.jsx("p",{className:"text-xs opacity-75",children:"All user expense data"})]}),e.jsxs("button",{onClick:()=>P("products"),disabled:h==="clear-products",className:"p-4 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-500/30 rounded-lg text-blue-300 transition-colors disabled:opacity-50",children:[h==="clear-products"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(yt,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear Inventory"}),e.jsx("p",{className:"text-xs opacity-75",children:"All products & batches"})]}),e.jsxs("button",{onClick:()=>P("all"),disabled:h==="clear-all",className:"p-4 bg-red-600/20 hover:bg-red-600/30 border border-red-600/30 rounded-lg text-red-300 transition-colors disabled:opacity-50",children:[h==="clear-all"?e.jsx("div",{className:"w-6 h-6 mx-auto mb-2 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(ke,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"Clear All Data"}),e.jsx("p",{className:"text-xs opacity-75",children:"âš ï¸ Everything except users"})]})]})]}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-lg rounded-xl p-6 border border-red-500/30",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(Xe,{className:"w-6 h-6"}),"System Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"User Statistics"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Users:"}),e.jsx("span",{className:"text-white",children:s.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Active Users:"}),e.jsx("span",{className:"text-green-400",children:s.filter(t=>t.active&&!t.locked).length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Locked Users:"}),e.jsx("span",{className:"text-red-400",children:s.filter(t=>t.locked).length})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"Plan Distribution"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Basic Plans:"}),e.jsx("span",{className:"text-blue-400",children:s.filter(t=>t.plan==="basic").length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Ultra Plans:"}),e.jsx("span",{className:"text-purple-400",children:s.filter(t=>t.plan==="ultra").length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Free Trials:"}),e.jsx("span",{className:"text-yellow-400",children:s.filter(t=>!t.plan||t.plan==="trial").length})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"Revenue"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Monthly Revenue:"}),e.jsxs("span",{className:"text-green-400",children:["KSH ",(i.mrr||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Revenue:"}),e.jsxs("span",{className:"text-green-400",children:["KSH ",(i.totalRevenue||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Activities:"}),e.jsx("span",{className:"text-blue-400",children:f.length})]})]})]})]})]})]})]}),m&&c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-black/80 backdrop-blur-lg rounded-xl p-6 border border-red-500/30 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Change User Plan"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-gray-300",children:["User: ",e.jsx("span",{className:"text-white font-semibold",children:c.name})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:c.email}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Current Plan: ",e.jsx("span",{className:"text-yellow-400",children:c.plan||"trial"})]})]}),e.jsx("div",{className:"space-y-3 mb-6",children:["trial","basic","ultra"].map(t=>e.jsx("button",{onClick:()=>A(c.id,t),disabled:h===`plan-${c.id}`||c.plan===t,className:`w-full p-3 rounded-lg border transition ${c.plan===t?"bg-gray-500/20 border-gray-500/30 text-gray-400 cursor-not-allowed":t==="trial"?"bg-yellow-500/20 border-yellow-500/30 text-yellow-300 hover:bg-yellow-500/30":t==="basic"?"bg-blue-500/20 border-blue-500/30 text-blue-300 hover:bg-blue-500/30":"bg-purple-500/20 border-purple-500/30 text-purple-300 hover:bg-purple-500/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-semibold",children:[t.charAt(0).toUpperCase()+t.slice(1)," Plan"]}),e.jsx("p",{className:"text-xs opacity-75",children:t==="trial"?"Free - 30 days":t==="basic"?"KSH 1,000/month":"KSH 2,400/month"})]}),c.plan===t&&e.jsx(Ne,{className:"w-5 h-5"})]})},t))}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>{y(!1),D(null)},className:"flex-1 px-4 py-2 bg-gray-500/20 border border-gray-500/30 text-gray-300 rounded-lg hover:bg-gray-500/30 transition",children:"Cancel"})})]})})]})}function Es(){const[s,o]=a.useState([]),[f,j]=a.useState("all"),[i,r]=a.useState(""),[l,p]=a.useState(!0),[d,n]=a.useState(null),h=pe(),[g,c]=a.useState({totalUsers:0,activeUsers:0,freeTrialUsers:0,upgradeExpiredUsers:0,reaching30Days:0,totalRevenue:0});a.useEffect(()=>{const t=localStorage.getItem("mainAdminToken"),C=localStorage.getItem("mainAdminUser");if(!t||!C){h("/main-admin/login");return}D().finally(()=>p(!1))},[h]);const D=async()=>{try{let t=[];try{const C=localStorage.getItem("mainAdminToken"),u=await fetch(`${Y}/api/main-admin/users-with-subscriptions`,{headers:{Authorization:`Bearer ${C}`}});if(u.ok)t=await u.json();else throw new Error("Failed to fetch subscription data")}catch(C){console.warn("Subscription API failed, using fallback:",C.message);try{t=await me.getUsers()}catch{t=await je.getAll()}t=t.map(u=>{const k=new Date(u.createdAt||Date.now()),E=Math.floor((new Date-k)/(1e3*60*60*24)),q=u.plan==="free"||!u.plan,te=E>=30&&q,re=Math.max(0,30-E);return{...u,createdAt:k.toISOString(),daysActive:E,isFreeTrial:q,hasReachedTrialLimit:te,daysUntilExpiry:re,subscriptionStatus:q?te?"trial_expired":"free_trial":"paid",planPrice:u.plan==="ultra"?1600:u.plan==="basic"?900:0,trialExpireDate:new Date(k.getTime()+720*60*60*1e3).toISOString()}})}if(t.length>0&&t[0].daysActive!==void 0)o(t),m(t);else{const C=t.map(u=>{const k=new Date(u.createdAt||Date.now()),E=Math.floor((new Date-k)/(1e3*60*60*24)),q=u.plan==="free"||!u.plan,te=E>=30&&q,re=Math.max(0,30-E);return{...u,createdAt:k.toISOString(),daysActive:E,isFreeTrial:q,hasReachedTrialLimit:te,daysUntilExpiry:re,subscriptionStatus:q?te?"trial_expired":"free_trial":"paid",planPrice:u.plan==="ultra"?1600:u.plan==="basic"?900:0,trialExpireDate:new Date(k.getTime()+2592e6).toISOString()}});o(C),m(C)}}catch(t){console.error("Failed to load data:",t)}},m=t=>{const C=t.filter(E=>E.isFreeTrial).length,u=t.filter(E=>E.hasReachedTrialLimit).length,k=t.filter(E=>E.daysActive>=25&&E.daysActive<30&&E.isFreeTrial).length,I=t.filter(E=>!E.isFreeTrial&&!E.hasReachedTrialLimit).reduce((E,q)=>E+(q.planPrice||0),0);c({totalUsers:t.length,activeUsers:t.filter(E=>E.active!==!1).length,freeTrialUsers:C,upgradeExpiredUsers:u,reaching30Days:k,totalRevenue:I})},y=t=>t.hasReachedTrialLimit?"bg-red-100 border-red-300":t.daysUntilExpiry<=5&&t.isFreeTrial?"bg-yellow-100 border-yellow-300":t.isFreeTrial?"bg-blue-100 border-blue-300":"bg-green-100 border-green-300",v=t=>t.hasReachedTrialLimit?e.jsx("span",{className:"text-xs bg-red-600 text-white px-2 py-1 rounded-full",children:"Trial Expired"}):t.isFreeTrial?e.jsxs("span",{className:"text-xs bg-blue-600 text-white px-2 py-1 rounded-full",children:["Free Trial - ",t.daysUntilExpiry,"d left"]}):e.jsx("span",{className:"text-xs bg-green-600 text-white px-2 py-1 rounded-full",children:"Active"}),N=async t=>{const C=s.find(u=>u.id===t);if(C)try{const u=localStorage.getItem("mainAdminToken");if((await fetch(`${Y}/api/main-admin/send-email`,{method:"POST",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},body:JSON.stringify({userId:t,type:"upgrade"})})).ok)alert(`Upgrade reminder sent to ${C.email}`);else throw new Error("Failed to send email")}catch(u){console.error("Failed to send email:",u),alert("Failed to send email")}},S=async(t,C)=>{try{n(t);const u=localStorage.getItem("mainAdminToken");if((await fetch(`${Y}/api/main-admin/users/${t}/lock`,{method:"POST",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},body:JSON.stringify({locked:!C})})).ok)o(E=>E.map(q=>q.id===t?{...q,locked:!C,active:C}:q)),alert(`User ${C?"unlocked":"locked"} successfully`);else throw new Error("Failed to update user lock status")}catch(u){console.error("Failed to update user lock status:",u),alert("Failed to update user")}finally{n(null)}},A=async t=>{const C=s.find(u=>u.id===t);if(C)try{const u=localStorage.getItem("mainAdminToken");if((await fetch(`${Y}/api/main-admin/send-email`,{method:"POST",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},body:JSON.stringify({userId:t,type:"upgrade"})})).ok)alert(`Redirect email sent to ${C.email}`);else throw new Error("Failed to send email")}catch(u){console.error("Failed to send redirect email:",u),alert("Failed to send email")}},P=s.filter(t=>{const C=t.name?.toLowerCase().includes(i.toLowerCase())||t.email?.toLowerCase().includes(i.toLowerCase()),u=f==="all"||f==="free_trial"&&t.isFreeTrial&&!t.hasReachedTrialLimit||f==="trial_expired"&&t.hasReachedTrialLimit||f==="paid"&&!t.isFreeTrial||f==="expiring_soon"&&t.daysUntilExpiry<=5&&t.isFreeTrial;return C&&u}),R=()=>{localStorage.removeItem("mainAdminToken"),localStorage.removeItem("mainAdminUser"),h("/main-admin/login")};return l?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading admin dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Admin Dashboard"}),e.jsx("p",{className:"text-blue-100 mt-1",children:"User Management & Subscription Tracking"})]}),e.jsxs("button",{onClick:R,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition",children:[e.jsx(Je,{className:"w-4 h-4"}),"Logout"]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:g.totalUsers})]}),e.jsx(he,{className:"w-8 h-8 text-blue-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Free Trial"}),e.jsx("p",{className:"text-3xl font-bold text-blue-400",children:g.freeTrialUsers})]}),e.jsx(Ue,{className:"w-8 h-8 text-blue-400 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Expiring Soon"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:g.reaching30Days})]}),e.jsx(ke,{className:"w-8 h-8 text-yellow-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Expired"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:g.upgradeExpiredUsers})]}),e.jsx(Ze,{className:"w-8 h-8 text-red-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Active"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:g.activeUsers})]}),e.jsx(Ne,{className:"w-8 h-8 text-green-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Monthly Revenue"}),e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:["$",(g.totalRevenue/1e3).toFixed(1),"K"]})]}),e.jsx(ue,{className:"w-8 h-8 text-green-600 opacity-20"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"border-b p-6 flex gap-4 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx("input",{type:"text",placeholder:"Search users by name or email...",value:i,onChange:t=>r(t.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})}),e.jsxs("select",{value:f,onChange:t=>j(t.target.value),className:"px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"free_trial",children:"Free Trial"}),e.jsx("option",{value:"expiring_soon",children:"Expiring Soon"}),e.jsx("option",{value:"trial_expired",children:"Trial Expired"}),e.jsx("option",{value:"paid",children:"Paid Users"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Days Active"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Trial Expires"}),e.jsx("th",{className:"px-6 py-3 text-left font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:P.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-8 text-center text-gray-500",children:"No users found matching your criteria"})}):P.map(t=>e.jsxs("tr",{className:`border-b hover:bg-gray-50 transition ${y(t)}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t.email})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-3 py-1 bg-gray-200 text-gray-800 rounded-full text-xs font-semibold",children:t.plan||"free"})}),e.jsx("td",{className:"px-6 py-4",children:v(t)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`font-semibold ${t.daysActive>=25?"text-red-600":"text-gray-900"}`,children:[t.daysActive," days"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-xs text-gray-600",children:new Date(t.trialExpireDate).toLocaleDateString()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[t.hasReachedTrialLimit&&e.jsxs("button",{onClick:()=>A(t.id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs font-semibold transition flex items-center gap-1",title:"Send upgrade prompt",children:[e.jsx(lt,{className:"w-3 h-3"}),"Upgrade"]}),t.daysUntilExpiry<=5&&t.isFreeTrial&&!t.hasReachedTrialLimit&&e.jsxs("button",{onClick:()=>N(t.id),className:"bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-xs font-semibold transition flex items-center gap-1",title:"Send trial expiry reminder",children:[e.jsx(ts,{className:"w-3 h-3"}),"Remind"]}),e.jsx("button",{onClick:()=>S(t.id,t.locked),disabled:d===t.id,className:`${t.locked?"bg-green-600 hover:bg-green-700":"bg-orange-600 hover:bg-orange-700"} text-white px-3 py-1 rounded text-xs font-semibold transition disabled:opacity-50 flex items-center gap-1`,children:t.locked?e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"w-3 h-3"}),"Unlock"]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-3 h-3"}),"Lock"]})})]})})]},t.id))})]})})]})]})]})}function Ae({children:s,adminOnly:o=!1,ultraOnly:f=!1,ownerOnly:j=!1}){const{user:i,loading:r}=xe(),[l,p]=a.useState(!1),d=Et(6e4),n=d?.[0]||!1,h=d?.[1]||(()=>{}),[g,c]=a.useState({});if(a.useEffect(()=>{i&&!j&&((async()=>{try{const y=localStorage.getItem("token"),N=await fetch(`${Y}/settings`,{headers:{Authorization:`Bearer ${y}`}});if(N.ok){const S=await N.json();c(S)}}catch(y){console.error("Failed to load settings:",y)}})(),p(!0))},[i,j]),r&&!j)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(j){const m=localStorage.getItem("ownerToken"),y=localStorage.getItem("ownerUser");if(!m||!y)return e.jsx(se,{to:"/main.admin"});try{if(JSON.parse(y).type!=="main_admin")return e.jsx(se,{to:"/main.admin"})}catch{return e.jsx(se,{to:"/main.admin"})}}else{if(!i)return e.jsx(se,{to:"/auth/login"});if(!i.active)return e.jsx(se,{to:"/plans"});if(o&&i.role!=="admin")return e.jsx(se,{to:"/dashboard"});if(f&&(i.role!=="admin"||i.plan!=="ultra"))return e.jsx(se,{to:"/dashboard"})}const D=j?"owner":"user";return e.jsxs(e.Fragment,{children:[n&&e.jsx(It,{onUnlock:h,userType:D}),l&&e.jsx(Tt,{onClose:()=>p(!1)}),s]})}function Ls(){const{user:s}=xe();return!s||!s.active?e.jsx(se,{to:"/plans"}):s.role==="admin"?e.jsx(se,{to:"/admin"}):e.jsx(se,{to:"/dashboard/cashier"})}function Us(){return e.jsx(xs,{children:e.jsx(hs,{children:e.jsx(qt,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(gt,{children:[e.jsx(K,{path:"/",element:e.jsx(Ps,{})}),e.jsx(K,{path:"/auth/login",element:e.jsx(pt,{})}),e.jsx(K,{path:"/auth/signup",element:e.jsx(pt,{})}),e.jsx(K,{path:"/plans",element:e.jsx(As,{})}),e.jsx(K,{path:"/main.admin",element:e.jsx(Ts,{})}),e.jsx(K,{path:"/main.admin/dashboard",element:e.jsx(Ae,{ownerOnly:!0,children:e.jsx(Es,{})})}),e.jsx(K,{path:"/main.admin/dashboard-legacy",element:e.jsx(Ae,{ownerOnly:!0,children:e.jsx(Is,{})})}),e.jsx(K,{path:"/dashboard",element:e.jsx(Ae,{children:e.jsx(Ls,{})})}),e.jsx(K,{path:"/dashboard/cashier",element:e.jsx(Ae,{children:e.jsx(Ds,{})})}),e.jsx(K,{path:"/admin/*",element:e.jsx(Ae,{adminOnly:!0,children:e.jsx(Cs,{})})}),e.jsx(K,{path:"/login",element:e.jsx(se,{to:"/auth/login"})}),e.jsx(K,{path:"/signup",element:e.jsx(se,{to:"/auth/signup"})}),e.jsx(K,{path:"/subscription",element:e.jsx(se,{to:"/plans"})}),e.jsx(K,{path:"/payment",element:e.jsx(se,{to:"/plans"})}),e.jsx(K,{path:"/cashier",element:e.jsx(se,{to:"/dashboard/cashier"})})]})})})})}ns.createRoot(document.getElementById("root")).render(e.jsx(Mt.StrictMode,{children:e.jsx(Us,{})}));
