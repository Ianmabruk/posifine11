import{a as vs,b as ws,g as Ss,r as s,u as ue,c as Yt,R as Qt,d as G,B as ks,N as de,e as Cs}from"./vendor-Ct1st1Nj.js";import{C as Fe,D as Qe,T as Te,P as Ue,S as Xt,a as ot,b as ct,c as be,d as Ps,e as Is,f as Xe,g as Je,h as Ne,i as Zt,j as As,k as es,l as Ts,L as fe,U as Mt,m as qt,n as jt,E as ts,M as Bt,o as Ze,X as Ce,p as De,q as nt,r as Lt,s as yt,t as zt,u as _e,B as $t,R as Ds,I as Es,v as et,w as Tt,x as Ye,y as pt,z as Nt,A as Ls,F as $s,G as Os,H as Fs,J as Us,K as Rs,N as Ms,O as qs,Q as Pe,V as Bs,W as rt,Y as ss,Z as Dt,_ as Oe,$ as Et,a0 as as,a1 as zs,a2 as _s,a3 as Js,a4 as Ws,a5 as Hs,a6 as Ks,a7 as Vs,a8 as Gs,a9 as Ys,aa as Qs,ab as Xs,ac as Zs}from"./icons-I09nBQzQ.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))x(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&x(r)}).observe(document,{childList:!0,subtree:!0});function d(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function x(n){if(n.ep)return;n.ep=!0;const l=d(n);fetch(n.href,l)}})();var Pt={exports:{}},at={};var _t;function ea(){if(_t)return at;_t=1;var t=vs(),i=Symbol.for("react.element"),d=Symbol.for("react.fragment"),x=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function r(o,p,u){var m,j={},a=null,P=null;u!==void 0&&(a=""+u),p.key!==void 0&&(a=""+p.key),p.ref!==void 0&&(P=p.ref);for(m in p)x.call(p,m)&&!l.hasOwnProperty(m)&&(j[m]=p[m]);if(o&&o.defaultProps)for(m in p=o.defaultProps,p)j[m]===void 0&&(j[m]=p[m]);return{$$typeof:i,type:o,key:a,ref:P,props:j,_owner:n.current}}return at.Fragment=d,at.jsx=r,at.jsxs=r,at}var Jt;function ta(){return Jt||(Jt=1,Pt.exports=ea()),Pt.exports}var e=ta(),ht={},Wt;function sa(){if(Wt)return ht;Wt=1;var t=ws();return ht.createRoot=t.createRoot,ht.hydrateRoot=t.hydrateRoot,ht}var aa=sa();const ra=Ss(aa),la=()=>"https://universal-backend-w0x1.onrender.com/api",se=la(),rs=()=>localStorage.getItem("token"),ls=async(t,i={},d=0,x=3)=>{const n=rs(),l=t.startsWith("/")?t:`/${t}`,r={...i,headers:{"Content-Type":"application/json",...n&&!(l.startsWith("/auth")&&l!=="/auth/me")&&!l.includes("/main-admin/auth/login")&&{Authorization:`Bearer ${n}`},...i.headers}};try{const o=await fetch(`${se}${l}`,r);if(o.status===401){if(l.includes("/auth/login")||l.includes("/main-admin/auth/login")){const j=await o.json().catch(()=>({error:"Unauthorized"}));throw new Error(j.error||"Invalid credentials")}localStorage.removeItem("token"),localStorage.removeItem("user");const u=window.location.pathname||"";if(!u.includes("/login")&&!u.includes("/signup")&&!u.includes("/auth")&&!u.includes("/main.admin"))try{window.location.href="/login"}catch{}const m=new Error("Unauthorized");throw m.status=401,m}if(o.status===500)throw new Error("Server error 500 - Backend unavailable");if(o.ok)return o.status===204?{success:!0}:await o.json();const p=await o.json().catch(()=>({error:"Network error"}));throw new Error(p.error||`HTTP ${o.status}: ${o.statusText}`)}catch(o){if(o.name==="TypeError"&&o.message.includes("fetch")){if(console.error(`API Fetch Error (attempt ${d+1}/${x+1}):`,o),console.error("Attempted URL:",`${se}${l}`),d<x){const p=Math.min(1e3*Math.pow(2,d),1e4);return console.log(`Retrying in ${p}ms...`),await new Promise(u=>setTimeout(u,p)),ls(t,i,d+1,x)}throw new Error("Cannot connect to server. The server may be waking up. Please try again in a moment.")}throw o}},O=(t,i={})=>ls(t,i,0,3),Ge={login:t=>O("/auth/login",{method:"POST",body:JSON.stringify(t)}),pinLogin:t=>O("/auth/pin-login",{method:"POST",body:JSON.stringify(t)}),signup:t=>O("/auth/signup",{method:"POST",body:JSON.stringify(t)}),signupWithPayment:t=>O("/signup-with-payment",{method:"POST",body:JSON.stringify(t)}),me:()=>O("/auth/me"),updatePin:t=>O("/auth/update-pin",{method:"POST",body:JSON.stringify({pin:t})})},Be={getAll:()=>O("/users"),create:t=>O("/users",{method:"POST",body:JSON.stringify(t)}),update:(t,i)=>O(`/users/${t}`,{method:"PUT",body:JSON.stringify(i)}),delete:t=>O(`/users/${t}`,{method:"DELETE"}),setPin:(t,i)=>O(`/users/${t}/set-pin`,{method:"POST",body:JSON.stringify({pin:i})}),lock:(t,i)=>O(`/users/${t}/lock`,{method:"POST",body:JSON.stringify({locked:i})})},xe={getAll:()=>O("/products"),create:t=>O("/products",{method:"POST",body:JSON.stringify(t)}),update:(t,i)=>O(`/products/${t}`,{method:"PUT",body:JSON.stringify(i)}),delete:t=>O(`/products/${t}`,{method:"DELETE"}),getLowStockWarnings:()=>O("/products/low-stock-warnings"),updateStock:(t,i)=>O(`/products/${t}/stock`,{method:"PUT",body:JSON.stringify(i)}),getMaxProducible:t=>O(`/products/${t}/max-producible`),getWeightPricing:t=>O(`/products/${t}/weight-pricing`),addWeightPrice:(t,i,d)=>O(`/products/${t}/weight-pricing`,{method:"POST",body:JSON.stringify({weight:i,price:d})}),updateWeightPrice:(t,i,d)=>O(`/products/${t}/weight-pricing`,{method:"PUT",body:JSON.stringify({weight:i,price:d})}),deleteWeightPrice:(t,i)=>O(`/products/${t}/weight-pricing`,{method:"DELETE",body:JSON.stringify({weight:i})})},ze={getAll:()=>O("/sales"),create:t=>O("/sales",{method:"POST",body:JSON.stringify(t)}),delete:t=>O(`/sales/${t}`,{method:"DELETE"}),adminComplete:t=>O("/admin-complete-sale",{method:"POST",body:JSON.stringify(t)})},vt={getAll:()=>O("/expenses"),create:t=>O("/expenses",{method:"POST",body:JSON.stringify(t)}),update:(t,i)=>O(`/expenses/${t}`,{method:"PUT",body:JSON.stringify(i)}),delete:t=>O(`/expenses/${t}`,{method:"DELETE"})},ns={get:()=>O("/stats")},lt={getAll:()=>O("/discounts"),create:t=>O("/discounts",{method:"POST",body:JSON.stringify(t)}),update:(t,i)=>O(`/discounts/${t}`,{method:"PUT",body:JSON.stringify(i)}),delete:t=>O(`/discounts/${t}`,{method:"DELETE"})},gt={getAll:()=>O("/credit-requests"),create:t=>O("/credit-requests",{method:"POST",body:JSON.stringify(t)}),update:(t,i)=>O(`/credit-requests/${t}`,{method:"PUT",body:JSON.stringify(i)}),approve:t=>O(`/credit-requests/${t}/approve`,{method:"POST"}),reject:t=>O(`/credit-requests/${t}/reject`,{method:"POST"})},it={get:()=>O("/settings"),update:t=>O("/settings",{method:"PUT",body:JSON.stringify(t)})},ft={getAll:()=>O("/time-entries"),getStatus:()=>O("/clock-status"),create:t=>O("/time-entries",{method:"POST",body:JSON.stringify({action:t})}),update:(t,i)=>O(`/time-entries/${t}`,{method:"PUT",body:JSON.stringify(i)}),delete:t=>O(`/time-entries/${t}`,{method:"DELETE"})},wt={getAll:t=>{const i=t?`/batches?productId=${t}`:"/batches";return O(i)},create:t=>O("/batches",{method:"POST",body:JSON.stringify(t)})},It={login:t=>O("/main-admin/auth/login",{method:"POST",body:JSON.stringify(t)}),getUsers:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/users",{headers:{Authorization:`Bearer ${t}`}})},getStats:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/stats",{headers:{Authorization:`Bearer ${t}`}})},getActivities:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/activities",{headers:{Authorization:`Bearer ${t}`}})},getSalesAll:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/sales-all",{headers:{Authorization:`Bearer ${t}`}})},getTimeEntriesAll:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/time-entries-all",{headers:{Authorization:`Bearer ${t}`}})},lockUser:(t,i)=>{const d=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O(`/main-admin/users/${t}/lock`,{method:"POST",headers:{Authorization:`Bearer ${d}`},body:JSON.stringify({locked:i})})},changePlan:(t,i)=>{const d=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O(`/main-admin/users/${t}/plan`,{method:"POST",headers:{Authorization:`Bearer ${d}`},body:JSON.stringify({plan:i})})},clearData:t=>{const i=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/system/clear-data",{method:"POST",headers:{Authorization:`Bearer ${i}`},body:JSON.stringify({type:t})})},getSubscribers:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/subscribers",{headers:{Authorization:`Bearer ${t}`}})},getSubscribersAnalytics:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/subscribers/analytics",{headers:{Authorization:`Bearer ${t}`}})},getUsersWithSubscriptions:()=>{const t=localStorage.getItem("token")||localStorage.getItem("ownerToken")||localStorage.getItem("mainAdminToken");return O("/main-admin/users-with-subscriptions",{headers:{Authorization:`Bearer ${t}`}})}};let ye=null,bt=new Set;function na(){const t=se.replace(/\/api$/,"");return`${t.startsWith("https")?"wss":"ws"}://${t.replace(/^https?:\/\//,"")}/api/ws/products`}function ia(){if(ye&&(ye.readyState===WebSocket.OPEN||ye.readyState===WebSocket.CONNECTING))return;const t=rs(),i=na()+(t?`?token=${encodeURIComponent(t)}`:"");ye=new WebSocket(i),ye.onopen=()=>{console.debug("Products WS connected")},ye.onmessage=d=>{let x=null;try{x=JSON.parse(d.data)}catch{return}bt.forEach(n=>{try{n(x)}catch(l){console.error("ws callback error",l)}})},ye.onclose=()=>{console.debug("Products WS closed"),ye=null},ye.onerror=d=>{console.error("Products WS error",d)}}function Ht(t){if(typeof t!="function")throw new Error("subscribeProducts requires a callback");return bt.add(t),ia(),()=>{if(bt.delete(t),ye&&bt.size===0){try{ye.close()}catch{}ye=null}}}const is=s.createContext(),oe=()=>s.useContext(is),oa=({children:t})=>{const[i,d]=s.useState(null),[x,n]=s.useState(!0),[l,r]=s.useState(!1),[o,p]=s.useState({});s.useEffect(()=>{u()},[]),s.useEffect(()=>{const D=()=>{const F=localStorage.getItem("user");if(F)try{const H=JSON.parse(F);d(H)}catch(H){console.warn("Failed to parse user from localStorage",H)}else d(null)};return window.addEventListener("storage",D),window.addEventListener("localStorageUpdated",D),()=>{window.removeEventListener("storage",D),window.removeEventListener("localStorageUpdated",D)}},[]);const u=async()=>{try{const D=localStorage.getItem("token"),F=localStorage.getItem("user");if(D)try{const H=await fetch(`${se}/auth/me`,{headers:{Authorization:`Bearer ${D}`,"Content-Type":"application/json"}});if(H.ok){const L=await H.json();d(L),localStorage.setItem("user",JSON.stringify(L))}else throw new Error("Invalid token")}catch(H){console.warn("Auth check failed:",H),localStorage.removeItem("token"),localStorage.removeItem("user")}}catch(D){console.error("Error initializing auth:",D),localStorage.removeItem("token"),localStorage.removeItem("user"),d(null)}finally{n(!1),r(!0)}},m=async D=>{try{if(D&&D.token&&D.user)return localStorage.setItem("token",D.token),localStorage.setItem("user",JSON.stringify(D.user)),d(D.user),D;const F=await Ge.login(D);if(F.token&&F.user)return localStorage.setItem("token",F.token),localStorage.setItem("user",JSON.stringify(F.user)),d(F.user),F;throw new Error("Invalid response from server")}catch(F){throw console.error("Login failed:",F),F}},j=async D=>{try{const F=await Ge.signup(D);if(F.token&&F.user)return localStorage.setItem("token",F.token),localStorage.setItem("user",JSON.stringify(F.user)),d(F.user),F;throw new Error("Invalid response from server")}catch(F){throw console.error("Signup failed:",F),F}},a=async D=>{try{if(localStorage.setItem("user",JSON.stringify(D)),d(D),window.dispatchEvent(new Event("localStorageUpdated")),D&&D.id)try{await Be.update(D.id,D)}catch(F){console.warn("Failed to persist updated user to backend",F)}return D}catch(F){throw console.error("updateUser failed:",F),F}},P=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),d(null),window.location.href="/auth/login"},y=()=>!!i&&!!localStorage.getItem("token"),w=D=>i&&i.role===D,N=()=>i&&(i.role==="admin"||i.role==="main-admin"),v=()=>i&&i.role==="cashier",g=()=>i&&i.plan==="ultra",f=()=>i&&i.plan==="basic",A=()=>i&&(i.role==="admin"||i.role==="cashier"),_=()=>i&&i.role==="admin"&&i.plan==="ultra",J=()=>i&&i.role==="admin",W=()=>!0,$=()=>!0;return i?.locked?e.jsx(LockedAccount,{}):e.jsx(is.Provider,{value:{user:i,loading:x,isInitialized:l,appSettings:o,login:m,signup:j,updateUser:a,logout:P,isAuthenticated:y,hasRole:w,isAdmin:N,isCashier:v,isUltraPackage:g,isBasicPackage:f,canEditStock:A,canManageUsers:_,canViewAnalytics:J,isRealTimeProductSyncEnabled:W,isCashierUserManagementEnabled:$},children:t})};new Date().toISOString();const os=s.createContext(),Ot=()=>s.useContext(os),ca=({children:t})=>{const{user:i}=oe(),[d,x]=s.useState([]),[n,l]=s.useState(!0),[r,o]=s.useState(null),[p,u]=s.useState(Date.now()),m=s.useCallback(async()=>{if(!localStorage.getItem("token"))return l(!1),[];try{const a=await xe.getAll(),y=(Array.isArray(a)?a:[]).filter(w=>!w.pendingDelete);return x(y),o(null),window.dispatchEvent(new CustomEvent("productsSync",{detail:{products:y,timestamp:Date.now()}})),y}catch(a){return console.error("Failed to fetch products:",a),o(`Failed to load products: ${a.message}`),x([]),[]}finally{l(!1),u(Date.now())}},[]);s.useEffect(()=>{m()},[]),s.useEffect(()=>{const a=()=>{console.log("ðŸ”„ Data cleared event received - forcing products refresh"),x([]),o(null),m()};return window.addEventListener("dataCleared",a),window.addEventListener("productsCleared",a),()=>{window.removeEventListener("dataCleared",a),window.removeEventListener("productsCleared",a)}},[]);const j=async()=>(l(!0),await m());return e.jsx(os.Provider,{value:{products:d,loading:n,error:r,lastUpdated:p,refreshProducts:j},children:t})},cs=s.createContext(),ds=()=>s.useContext(cs),da=900*1e3,ma=({children:t})=>{const{user:i}=oe(),[d,x]=s.useState(!1),n=s.useRef(null),l=s.useRef(Date.now()),r=s.useCallback(()=>{l.current=Date.now(),n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{x(!0),console.log("ðŸ”’ Screen locked due to inactivity")},da)},[]);s.useEffect(()=>{const m=["mousedown","keydown","click","touchstart"];return m.forEach(j=>{document.addEventListener(j,r)}),r(),()=>{m.forEach(j=>{document.removeEventListener(j,r)}),n.current&&clearTimeout(n.current)}},[r]);const o=s.useCallback(()=>{x(!0),console.log("ðŸ”’ Screen manually locked")},[]),p=s.useCallback(()=>{x(!1),r(),console.log("ðŸ”“ Screen unlocked")},[r]),u={isLocked:d,lock:o,unlock:p};return e.jsx(cs.Provider,{value:u,children:t})};function xa(){const[t,i]=s.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[d,x]=s.useState(!0),[n,l]=s.useState(null);s.useEffect(()=>{r()},[]);const r=async()=>{try{l(null);const[u,m]=await Promise.all([ns.get(),ze.getAll()]),j={totalSales:u?.totalSales||0,totalExpenses:u?.totalExpenses||0,profit:u?.profit||0,grossProfit:u?.grossProfit||0,netProfit:u?.netProfit||0,totalCOGS:u?.totalCOGS||0,dailySales:u?.dailySales||0,weeklySales:u?.weeklySales||0,productCount:u?.productCount||0},a=Array.isArray(m)?m:[];i({stats:j,recentSales:a.slice(-10).reverse()})}catch(u){console.error("Failed to load data:",u),l(u.message),i({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{x(!1)}};if(d)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(n&&t.stats.totalSales===0&&t.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Fe,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:n}),e.jsx("button",{onClick:r,className:"btn-primary",children:"Retry"})]})});const o=[{label:"Total Sales",value:`KSH ${t.stats.totalSales?.toLocaleString()||0}`,icon:Qe,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${t.stats.grossProfit?.toLocaleString()||0}`,icon:Te,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${t.stats.totalCOGS?.toLocaleString()||0}`,icon:Ue,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${t.stats.netProfit?.toLocaleString()||0}`,icon:Te,color:"from-purple-500 to-pink-600",change:"+15.3%"}],p=[{label:"Daily Sales",value:`KSH ${t.stats.dailySales?.toLocaleString()||0}`,icon:Xt,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${t.stats.weeklySales?.toLocaleString()||0}`,icon:Te,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${t.stats.totalExpenses?.toLocaleString()||0}`,icon:ot,color:"bg-red-50 text-red-600"},{label:"Products",value:t.stats.productCount||0,icon:Ue,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(o||[]).map((u,m)=>{const j=u?.icon;return j?e.jsxs("div",{className:`card bg-gradient-to-br ${u.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(j,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:u.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:u.label}),e.jsx("p",{className:"text-2xl font-bold",children:u.value})]},m):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(p||[]).map((u,m)=>{const j=u?.icon;return j?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${u.color} flex items-center justify-center`,children:e.jsx(j,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:u.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:u.value})]})]})},m):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!t.recentSales||t.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Fe,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(t.recentSales||[]).map(u=>u?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:u.createdAt?new Date(u.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(u.items)?u.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:u.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",u.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",u.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",u.profit?.toLocaleString()||0]})]},u.id||Math.random()):null)})]})})]})]})}const ua=()=>"https://universal-backend-w0x1.onrender.com/api".replace("https://","wss://").replace("http://","ws://");class ha{constructor(){this.ws=null,this.listeners={stock_updated:[],sale_completed:[],admin_sale_completed:[],product_created:[],product_updated:[],product_deleted:[],heartbeat:[],initial:[],error:[]},this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.isManualClose=!1}connect(i,d){return new Promise((x,n)=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){x();return}if(!i){n(new Error("No token provided for WebSocket connection"));return}const l=`${ua()}/ws/products?token=${encodeURIComponent(i)}`;try{this.ws=new WebSocket(l),this.ws.onopen=()=>{console.log("âœ… WebSocket connected for real-time updates"),this.reconnectAttempts=0,x()},this.ws.onmessage=r=>{try{const o=JSON.parse(r.data),p=o.type?o.type.toLowerCase():"unknown";p==="stock_updated"?(console.log("ðŸ“¦ Stock update received:",o.data),d&&d(o.data),this.emit("stock_updated",o.data)):p==="sale_completed"?(console.log("ðŸ’° Sale completed - stock deducted:",o.data),this.emit("sale_completed",o.data),d&&o.data.updatedProducts&&d({allProducts:o.data.updatedProducts})):p==="admin_sale_completed"?(console.log("ðŸ‘¨â€ðŸ’¼ Admin sale completed:",o.data),this.emit("admin_sale_completed",o.data),this.emit("sale_completed",o.data),d&&o.data.updatedProducts&&d({allProducts:o.data.updatedProducts})):p==="product_created"?(console.log("âœ¨ Product created:",o.data),this.emit("product_created",o.data)):p==="product_updated"?(console.log("ðŸ“ Product updated:",o.data),this.emit("product_updated",o.data),d&&o.data.allProducts&&d({allProducts:o.data.allProducts})):p==="product_deleted"?(console.log("ðŸ—‘ï¸ Product deleted:",o.data),this.emit("product_deleted",o.data),d&&o.data.allProducts&&d({allProducts:o.data.allProducts})):p==="initial"?(console.log("ðŸ“¦ Initial products loaded via WebSocket"),this.emit("initial",o.products)):p==="heartbeat"?this.emit("heartbeat",o):(console.log(`ðŸ“¨ Message received (${p}):`,o.data),p!=="unknown"&&this.emit(p,o.data))}catch(o){console.error("Error parsing WebSocket message:",o)}},this.ws.onerror=r=>{console.error("âŒ WebSocket error:",r),this.emit("error",r),n(r)},this.ws.onclose=()=>{console.log("ðŸ”Œ WebSocket disconnected"),this.isManualClose||this.attemptReconnect(i,d)}}catch(r){console.error("Failed to create WebSocket:",r),n(r)}})}attemptReconnect(i,d){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Max reconnection attempts reached");return}this.reconnectAttempts++;const x=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`ðŸ”„ Reconnecting in ${x}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect(i,d).catch(n=>{console.error("Reconnection failed:",n)})},x)}on(i,d){this.listeners[i]||(this.listeners[i]=[]),this.listeners[i].push(d)}emit(i,d){this.listeners[i]&&this.listeners[i].forEach(x=>{try{x(d)}catch(n){console.error(`Error in ${i} listener:`,n)}})}disconnect(){this.isManualClose=!0,this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}}const ke=new ha;function pa(){const{user:t,isUltraPackage:i,isRealTimeProductSyncEnabled:d}=oe(),{products:x,refreshProducts:n}=Ot(),[l,r]=s.useState([]),[o,p]=s.useState([]),[u,m]=s.useState(!1),[j,a]=s.useState("all"),[P,y]=s.useState(""),[w,N]=s.useState(!1),[v,g]=s.useState(!1),[f,A]=s.useState(!1),[_,J]=s.useState(!1),[W,$]=s.useState(null),[D,F]=s.useState({}),[H,L]=s.useState({weight:"",price:""}),[V,le]=s.useState(null),[re,he]=s.useState(null),[we,pe]=s.useState(!1),[ae,ge]=s.useState(null),[S,b]=s.useState(""),[k,T]=s.useState({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),[U,K]=s.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[R,Z]=s.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0}),z=async()=>{try{console.log("ðŸ“¦ Loading inventory data..."),await n();const h=await wt.getAll();p(h),console.log("âœ… Inventory data loaded")}catch(h){console.error("âŒ Failed to load data:",h),te("Failed to load inventory data","error")}};s.useEffect(()=>{u||(z(),m(!0));const h=localStorage.getItem("token");return h&&(ke.connect(h,C=>{C&&C.allProducts&&C.allProducts.length>0&&(console.log("ðŸ“¦ WebSocket stock update received:",C.allProducts.length,"products"),r(C.allProducts))}).catch(C=>{console.warn("WebSocket connection failed:",C)}),ke.on("sale_completed",C=>{if(console.log("ðŸ”„ Sale completed - updating inventory display:",C),C.updatedProducts&&C.updatedProducts.length>0&&(console.log(`âœ… Updating ${C.updatedProducts.length} products from sale`),r(C.updatedProducts),te(`âœ… Stock updated! Sale #${C.saleId} deducted inventory`,"success")),C.lowStockWarnings&&C.lowStockWarnings.length>0){const M=C.lowStockWarnings.map(Q=>`${Q.name}: ${Q.current} left`).join(", ");te(`âš ï¸ Low stock alert: ${M}`,"warning")}})),()=>{ke.disconnect()}},[u]),s.useEffect(()=>{x&&x.length>0&&l.length===0&&(console.log("ðŸ“¦ Initial sync from global context:",x.length,"products"),r(x))},[x.length]);const Ee=(h,C=!0)=>{const M=h.target.files[0];if(M){if(M.size>2*1024*1024){te("Image must be smaller than 2MB","error");return}const Q=new FileReader;Q.onload=X=>{const ie=X.target.result;b(ie),C?T({...k,image:ie}):(Z({...R,image:ie}),R.id&&setTimeout(async()=>{try{await xe.update(R.id,{image:ie}),te("âœ… Image saved","success")}catch($e){console.error("Failed to save image:",$e)}},500))},Q.readAsDataURL(M)}},ne=h=>o.filter(M=>M.productId===h&&M.quantity>0).reduce((M,Q)=>M+Q.quantity,0),We=h=>o.filter(C=>C.productId===h&&C.quantity>0),te=(h,C="success")=>{he({message:h,type:C}),setTimeout(()=>he(null),5e3)},Re=async h=>{h.preventDefault();try{const C={...k,price:parseFloat(k.price),cost:parseFloat(k.cost||0),quantity:0,visibleToCashier:!k.expenseOnly&&k.visibleToCashier!==!1},M=await xe.create(C);T({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0}),b(""),N(!1),te(`âœ… Product "${M.name}" added successfully! ${M.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success"),z().catch(Q=>console.warn("Background refresh failed:",Q))}catch(C){console.error("Failed to create product:",C),alert(`Failed to create product: ${C.message||"Unknown error"}`)}},Ft=async h=>{h.preventDefault();try{const C={id:`batch-${Date.now()}`,productId:W.id,quantity:parseInt(U.quantity),expiryDate:U.expiryDate,batchNumber:U.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(U.cost||W.cost||0)};p(M=>[...M,C]),te("âš¡ Adding stock...","info");try{await wt.create({productId:W.id,quantity:parseInt(U.quantity),expiryDate:U.expiryDate,batchNumber:U.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(U.cost||W.cost||0)}),K({quantity:"",expiryDate:"",batchNumber:"",cost:""}),A(!1),$(null),te(`âœ… Stock added successfully for ${W.name}!`,"success"),z().catch(M=>console.warn("Background refresh failed:",M))}catch(M){throw p(Q=>Q.filter(X=>X.id!==C.id)),M}}catch(C){console.error("Failed to add stock:",C),te(`âŒ Failed to add stock: ${C.message||"Unknown error"}`,"error")}},He=async h=>{h.preventDefault();try{const C=l.find(X=>X.id===R.id);if(parseFloat(R.price)<C.price){alert("You cannot lower prices, only increase.");return}const M={...R,price:parseFloat(R.price),cost:parseFloat(R.cost),quantity:parseFloat(R.quantity)},Q={...C,...M};r(X=>X.map(ie=>ie.id===R.id?Q:ie)),pe(!0),te("âš¡ Updating product...","info");try{const X=await xe.update(R.id,M);g(!1),d()?(window.dispatchEvent(new CustomEvent("productUpdated",{detail:{product:X,originalProduct:C,timestamp:new Date().toISOString(),type:"update"}})),te("âœ… Product updated and synced!","success")):te("âœ… Product updated successfully!","success"),ge(new Date)}catch(X){throw r(ie=>ie.map($e=>$e.id===R.id?C:$e)),X}finally{pe(!1)}}catch(C){console.error("Failed to update product:",C),te(`âŒ Update failed: ${C.message||"Unknown error"}`,"error")}},dt=async h=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const C=l.find(Q=>Q.id===h),M=await xe.delete(h);if(r(Q=>Q.filter(X=>X.id!==h)),d()&&C)pe(!0),window.dispatchEvent(new CustomEvent("productDeleted",{detail:{product:C,timestamp:new Date().toISOString(),type:"delete"}})),te(`ðŸ“¡ Product "${C.name}" deleted and synced to all dashboards!`,"success"),ge(new Date),setTimeout(()=>{pe(!1)},3e3);else{const Q=M?.message||"Product deleted successfully!";alert(Q)}await n()}catch(C){console.error("Failed to delete product:",C);let M="Failed to delete product";C.message.includes("Failed to execute")||C.message.includes("JSON")?M="Network error. Please check your connection and try again.":C.message.includes("401")||C.message.includes("unauthorized")?M="You are not authorized to delete this product.":C.message.includes("404")||C.message.includes("not found")?M="Product not found. It may have been deleted already.":C.message&&(M=`Failed to delete product: ${C.message}`),alert(M)}},Me=(l||[]).filter(h=>{if(!h)return!1;const C=h.name?.toLowerCase().includes(P.toLowerCase()),M=j==="all"||j==="raw"&&!h.recipe||j==="composite"&&h.recipe||j==="expense"&&h.expenseOnly||j==="low-stock"&&h.quantity<10;return C&&M}),st=(l||[]).filter(h=>h&&!h.recipe&&!h.expenseOnly),mt=(l||[]).filter(h=>h&&h.recipe),Ke=(l||[]).filter(h=>h&&h.expenseOnly),xt=h=>{if(!h||!h.recipe)return 0;let C=1/0;return(h.recipe||[]).forEach(M=>{if(!M)return;const Q=(l||[]).find(X=>X&&X.id===M.productId);if(Q&&Q.quantity>0&&M.quantity>0){const X=Math.floor(Q.quantity/M.quantity);C=Math.min(C,X)}}),C===1/0?0:C},Ut=h=>{if(!h)return 0;if(!h.recipe)return h.cost||0;let C=0;return(h.recipe||[]).forEach(M=>{if(!M)return;const Q=(l||[]).find(X=>X&&X.id===M.productId);if(Q&&Q.quantity>0){const X=(Q.cost||0)/Q.quantity;C+=X*(M.quantity||0)}}),C},ut=async h=>{$(h);try{const C=await xe.getWeightPricing(h.id);F(C.weightPricing||{})}catch(C){console.error("Failed to load weight pricing:",C),F({})}J(!0)},Rt=async h=>{if(h.preventDefault(),!H.weight||!H.price){te("âŒ Please enter both weight and price","error");return}try{const C=parseFloat(H.weight),M=parseFloat(H.price);if(C*10%1!==0){te("âŒ Weight must be in 0.1kg increments (0.1, 0.2, 0.3, etc)","error");return}await xe.addWeightPrice(W.id,C,M),F({...D,[String(C)]:M}),L({weight:"",price:""}),te(`âœ… Weight price added for ${C}kg`,"success")}catch(C){te(`âŒ Failed to add weight price: ${C.message}`,"error")}},Le=async h=>{if(confirm(`Delete pricing for ${h}kg?`))try{await xe.deleteWeightPrice(W.id,h);const C={...D};delete C[String(h)],F(C),te(`âœ… Weight price for ${h}kg deleted`,"success")}catch(C){te(`âŒ Failed to delete weight price: ${C.message}`,"error")}};return e.jsxs("div",{className:"p-6 space-y-6",children:[re&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${re.type==="success"?"bg-green-50 border border-green-200 text-green-800":re.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:re.message}),e.jsx("button",{onClick:()=>he(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ct,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:P,onChange:h=>y(h.target.value)})]}),e.jsxs("select",{value:j,onChange:h=>a(h.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>N(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:st.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:mt.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:Ke.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(Me||[]).map(h=>{if(!h)return null;const C=Ut(h),M=h.price?((h.price-C)/h.price*100).toFixed(1):0,Q=xt(h),X=V===h.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[h.image?e.jsx("img",{src:h.image,alt:h.name,className:"w-12 h-12 object-cover rounded-lg",onError:ie=>{ie.target.style.display="none",ie.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:h.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[h.recipe&&e.jsx("button",{onClick:()=>le(X?null:h.id),className:"p-1 hover:bg-gray-200 rounded",children:X?e.jsx(Ps,{className:"w-4 h-4"}):e.jsx(Is,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:h.name}),h.quantity<10&&!h.recipe&&e.jsx(Xe,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${h.expenseOnly?"badge-warning":h.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:h.expenseOnly?"Expense":h.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",h.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",C.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${ne(h.id)===0?"text-red-600":ne(h.id)<10?"text-yellow-600":"text-gray-900"}`,children:[ne(h.id)," ",h.unit]}),ne(h.id)<10&&ne(h.id)>0&&e.jsx(Xe,{className:"w-4 h-4 text-yellow-500"}),ne(h.id)===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600",children:[We(h.id).length," active"]}),e.jsx("button",{onClick:()=>{$(h),A(!0)},className:"p-1 hover:bg-blue-50 rounded text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(be,{className:"w-3 h-3"})})]})}),e.jsx("td",{className:"px-4 py-3",children:h.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[Q," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${M>30?"text-green-600":M>15?"text-yellow-600":"text-red-600"}`,children:[M,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ut(h),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600 transition-colors",title:"Edit weight-based pricing",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{Z(h),g(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(Je,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>dt(h.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(Ne,{className:"w-4 h-4"})})]})})]},h.id),X&&h.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(h.recipe||[]).map((ie,$e)=>{if(!ie)return null;const Ie=(l||[]).find(qe=>qe&&qe.id===ie.productId);if(!Ie)return null;const Se=(Ie.cost||0)/(Ie.quantity||1),St=Se*(ie.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:Ie.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[ie.quantity||0," ",Ie.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[Ie.quantity||0," ",Ie.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",Se.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",St.toFixed(2)]})]},$e)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",C.toFixed(2)]})]})})]})]})})})]})})})]})})}),f&&W&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Add Stock for ",W.name]}),e.jsxs("form",{onSubmit:Ft,className:"space-y-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:U.quantity,onChange:h=>K({...U,quantity:h.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:U.expiryDate,onChange:h=>K({...U,expiryDate:h.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:U.batchNumber,onChange:h=>K({...U,batchNumber:h.target.value})}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost per Unit",className:"input",value:U.cost,onChange:h=>K({...U,cost:h.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{A(!1),$(null),K({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]})}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:Re,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:k.name,onChange:h=>T({...k,name:h.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:h=>Ee(h,!0),className:"input"}),e.jsx(Zt,{className:"w-5 h-5 text-gray-400"})]}),(S||k.image)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:S||k.image,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:k.price,onChange:h=>T({...k,price:h.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:k.cost,onChange:h=>T({...k,cost:h.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{className:"input",value:k.category,onChange:h=>T({...k,category:h.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsxs("select",{className:"input",value:k.unit,onChange:h=>T({...k,unit:h.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k.expenseOnly,onChange:h=>T({...k,expenseOnly:h.target.checked,visibleToCashier:!h.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!k.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k.visibleToCashier,onChange:h=>T({...k,visibleToCashier:h.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{N(!1),b(""),T({name:"",price:"",cost:"",category:"finished",unit:"pcs",expenseOnly:!1,image:"",visibleToCashier:!0})},className:"btn-secondary",children:"Cancel"})]})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:He,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:R.name,onChange:h=>Z({...R,name:h.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:R.image||"",onChange:h=>Z({...R,image:h.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:h=>{const C=h.target.files[0];if(C){const M=new FileReader;M.onloadend=()=>{Z({...R,image:M.result})},M.readAsDataURL(C)}}})]}),R.image&&e.jsx("img",{src:R.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:R.price||"",onChange:h=>Z({...R,price:h.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:R.cost||"",onChange:h=>Z({...R,cost:h.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:R.quantity||"",onChange:h=>Z({...R,quantity:h.target.value}),required:!0}),e.jsxs("select",{className:"input",value:R.unit||"pcs",onChange:h=>Z({...R,unit:h.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:R.category||"raw",onChange:h=>Z({...R,category:h.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:R.expenseOnly||!1,onChange:h=>Z({...R,expenseOnly:h.target.checked,visibleToCashier:!h.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!R.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:R.visibleToCashier!==!1,onChange:h=>Z({...R,visibleToCashier:h.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]})]})]})}),_&&W&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-96 overflow-y-auto",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Weight-Based Pricing - ",W.name]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Set different prices for different weights (in 0.1kg increments)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700",children:"Add New Weight Price"}),e.jsxs("form",{onSubmit:Rt,className:"flex gap-3",children:[e.jsx("input",{type:"number",step:"0.1",min:"0.1",placeholder:"Weight (kg) - e.g., 0.1, 0.5, 1.0",className:"input flex-1",value:H.weight,onChange:h=>L({...H,weight:h.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Price (KSH)",className:"input flex-1",value:H.price,onChange:h=>L({...H,price:h.target.value}),required:!0}),e.jsx("button",{type:"submit",className:"btn-primary whitespace-nowrap",children:"Add Price"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Current Prices"}),Object.keys(D).length>0?e.jsx("div",{className:"space-y-2",children:Object.entries(D).sort(([h],[C])=>parseFloat(h)-parseFloat(C)).map(([h,C])=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-medium",children:[h," kg"]}),e.jsxs("span",{className:"text-gray-600 ml-4",children:["KSH ",parseFloat(C).toLocaleString()]})]}),e.jsx("button",{onClick:()=>Le(h),className:"text-red-600 hover:bg-red-50 px-3 py-1 rounded text-sm font-medium transition-colors",children:"Delete"})]},h))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No weight-based pricing set. Add one above."})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Base price:"})," KSH ",W.price?.toLocaleString()]})})]}),e.jsx("div",{className:"flex gap-2 mt-6",children:e.jsx("button",{onClick:()=>{J(!1),$(null),F({}),L({weight:"",price:""})},className:"btn-secondary flex-1",children:"Done"})})]})})]})}function ga(){const[t,i]=s.useState([]),[d,x]=s.useState([]),[n,l]=s.useState(!1),[r,o]=s.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});s.useEffect(()=>{p()},[]);const p=async()=>{const w=await xe.getAll();i(w),x(w.filter(N=>!N.recipe))},u=()=>{o({...r,ingredients:[...r.ingredients,{name:"",quantity:"",unit:"pcs"}]})},m=(w,N,v)=>{const g=[...r.ingredients];g[w][N]=v,o({...r,ingredients:g})},j=w=>{o({...r,ingredients:r.ingredients.filter((N,v)=>v!==w)})},a=()=>r.ingredients.reduce((w,N)=>{const v=d.find(g=>g.name.toLowerCase()===N.name.toLowerCase());if(v&&N.quantity){const g=v.cost/v.quantity;return w+g*parseFloat(N.quantity)}return w},0),P=async w=>{w.preventDefault();const N=[];for(const g of r.ingredients){if(!g.name||!g.quantity)continue;const f=d.find(A=>A.name.toLowerCase()===g.name.toLowerCase());f?N.push({productId:f.id,quantity:parseFloat(g.quantity),unit:g.unit||"pcs"}):N.push({name:g.name,quantity:parseFloat(g.quantity),unit:g.unit||"pcs"})}if(N.length===0){alert("Please add at least one ingredient");return}const v=a();try{await xe.create({name:r.name,price:parseFloat(r.price),cost:v,quantity:0,unit:"pcs",category:"composite",recipe:N,image:r.image||"",visibleToCashier:r.visibleToCashier,expenseOnly:!1}),o({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),l(!1),p(),alert("Recipe created successfully!")}catch(g){console.error("Error creating recipe:",g),alert("Failed to create recipe. Please try again.")}},y=t.filter(w=>w.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>l(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",y.length,")"]}),y.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:y.map(w=>{const N=w.recipe.reduce((g,f)=>{if(f.productId){const A=t.find(_=>_.id===f.productId);if(A){const _=A.cost/A.quantity;return g+_*f.quantity}}else if(f.name){const A=t.find(_=>_.name.toLowerCase()===f.name.toLowerCase());if(A){const _=A.cost/A.quantity;return g+_*f.quantity}}return g},0),v=((w.price-N)/w.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:w.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",w.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",N.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${v>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",v,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(Ne,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:w.recipe.map((g,f)=>{let A="",_=g.unit||"pcs";if(g.productId){const J=t.find(W=>W.id===g.productId);J&&(A=J.name,_=J.unit)}else g.name&&(A=g.name,_=g.unit||"pcs");return A?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:A}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[g.quantity," ",_]})]},f):null})})]})]},w.id)})})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:r.name,onChange:w=>o({...r,name:w.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:r.price,onChange:w=>o({...r,price:w.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:r.image,onChange:w=>o({...r,image:w.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.visibleToCashier,onChange:w=>o({...r,visibleToCashier:w.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:u,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:r.ingredients.map((w,N)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:w.name,onChange:v=>m(N,"name",v.target.value),required:!0,list:`ingredients-list-${N}`}),e.jsx("datalist",{id:`ingredients-list-${N}`,children:d.map(v=>e.jsxs("option",{value:v.name,children:[v.name," (",v.quantity," ",v.unit," available)"]},v.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:w.quantity,onChange:v=>m(N,"quantity",v.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:w.unit,onChange:v=>m(N,"unit",v.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>j(N),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(Ne,{className:"w-4 h-4"})})]},N))}),r.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),r.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",a().toFixed(2)]})]}),r.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(r.price)-a())/parseFloat(r.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(As,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{l(!1),o({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function fa(){const[t,i]=s.useState([]),[d,x]=s.useState("all"),[n,l]=s.useState([]),[r,o]=s.useState(!1);s.useEffect(()=>{p()},[]);const p=async()=>{const N=await ze.getAll();i(N.reverse())},u=async N=>{if(window.confirm("Delete this sale? This action cannot be undone."))try{o(!0);const v=localStorage.getItem("token");if(!(await fetch(`${se}/sales/${N}`,{method:"DELETE",headers:{Authorization:`Bearer ${v}`}})).ok)throw new Error("Failed to delete sale");i(t.filter(f=>f.id!==N)),alert("Sale deleted successfully")}catch(v){alert("Failed to delete sale: "+v.message)}finally{o(!1)}},m=async()=>{if(n.length===0){alert("No sales selected");return}if(window.confirm(`Delete ${n.length} sales? This action cannot be undone.`))try{o(!0);const N=localStorage.getItem("token");if(!(await fetch(`${se}/sales/bulk-delete`,{method:"POST",headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"},body:JSON.stringify({saleIds:n})})).ok)throw new Error("Failed to delete sales");i(t.filter(g=>!n.includes(g.id))),l([]),alert("Sales deleted successfully")}catch(N){alert("Failed to delete sales: "+N.message)}finally{o(!1)}},j=async()=>{if(window.confirm("Clear ALL sales data? This will delete everything and cannot be undone."))try{o(!0);const N=localStorage.getItem("token");if(!(await fetch(`${se}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"},body:JSON.stringify({type:"sales"})})).ok)throw new Error("Failed to clear sales");i([]),l([]),alert("All sales data cleared")}catch(N){alert("Failed to clear sales: "+N.message)}finally{o(!1)}},a=t.filter(N=>{if(d==="today")return new Date(N.createdAt).toDateString()===new Date().toDateString();if(d==="week"){const v=new Date;return v.setDate(v.getDate()-7),new Date(N.createdAt)>=v}return!0}),P=a.reduce((N,v)=>N+v.total,0),y=a.reduce((N,v)=>N+(v.cogs||0),0),w=P-y;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:d,onChange:N=>x(N.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]}),n.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[n.length," selected"]}),e.jsxs("button",{onClick:m,disabled:r,className:"px-3 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Delete Selected"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:j,disabled:r||t.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4"}),"Clear All Sales"]}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(Ts,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",P.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",y.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",w.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:n.length===a.length&&a.length>0,onChange:N=>{N.target.checked?l(a.map(v=>v.id)):l([])},className:"rounded"})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Action"})]})}),e.jsx("tbody",{children:a.map(N=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:n.includes(N.id),onChange:v=>{v.target.checked?l([...n,N.id]):l(n.filter(g=>g!==N.id))},className:"rounded"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",N.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(N.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[N.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:N.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",N.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",N.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",N.profit?.toLocaleString()||0]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("button",{onClick:()=>u(N.id),disabled:r,className:"px-3 py-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white rounded text-sm font-medium flex items-center gap-1",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Delete"]})})]},N.id))})]})})]})]})}function ba(){const[t,i]=s.useState([]),[d,x]=s.useState(!1),[n,l]=s.useState({description:"",amount:"",category:"general"}),[r,o]=s.useState(null);s.useEffect(()=>{u();const y=localStorage.getItem("token");return y&&(ke.connect(y).catch(w=>{console.warn("WebSocket connection failed:",w)}),ke.on("sale_completed",w=>{console.log("ðŸ’° Sale completed - updating expenses:",w),u(),w.saleId&&p(`âœ… Expenses updated from Sale #${w.saleId}`,"success")})),()=>{ke.disconnect()}},[]);const p=(y,w)=>{o({message:y,type:w}),setTimeout(()=>o(null),3e3)},u=async()=>{const y=await vt.getAll();i(y.reverse())},m=async y=>{y.preventDefault(),await vt.create({...n,amount:parseFloat(n.amount)}),l({description:"",amount:"",category:"general"}),x(!1),u()},j=t.reduce((y,w)=>y+w.amount,0),a=t.filter(y=>!y.automatic),P=t.filter(y=>y.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[r&&e.jsx("div",{className:`fixed top-4 right-4 p-4 rounded-lg text-white font-medium z-50 ${r.type==="success"?"bg-green-600":"bg-blue-600"}`,children:r.message}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("button",{onClick:()=>x(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",j.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",a.reduce((y,w)=>y+w.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",P.reduce((y,w)=>y+w.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.map(y=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(y.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:y.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:y.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${y.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:y.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",y.amount?.toLocaleString()]})]},y.id))})]})})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:n.description,onChange:y=>l({...n,description:y.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:n.amount,onChange:y=>l({...n,amount:y.target.value}),required:!0}),e.jsxs("select",{className:"input",value:n.category,onChange:y=>l({...n,category:y.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>x(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function ja(){const{isCashierUserManagementEnabled:t,isCashier:i}=oe(),[d,x]=s.useState([]),[n,l]=s.useState(!0),[r,o]=s.useState(!1),[p,u]=s.useState(null),[m,j]=s.useState(null),[a,P]=s.useState(null),[y,w]=s.useState(0),[N,v]=s.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),[g,f]=s.useState(!1),[A,_]=s.useState(null),[J,W]=s.useState("");s.useEffect(()=>{$()},[]),s.useEffect(()=>()=>{a?.intervalId&&clearInterval(a.intervalId)},[a]);const $=async()=>{try{l(!0);const b=await Be.getAll();x(Array.isArray(b)?b:[])}catch(b){console.error("Error loading users:",b),x([])}finally{l(!1)}},D=()=>Math.floor(1e3+Math.random()*9e3).toString(),F=async b=>{if(b.preventDefault(),console.log("Form submitted with data:",N),!N.name?.trim()||!N.email?.trim()||!N.password?.trim()){alert("Please fill in all required fields");return}if(N.password.length<6){alert("Password must be at least 6 characters long");return}try{l(!0);const k=D(),T={name:N.name.trim(),email:N.email.trim().toLowerCase(),password:N.password.trim(),pin:k};console.log("Sending user data:",T);const U=await Be.create(T);console.log("User creation result:",U),await $();const K=`âœ… Cashier added successfully!

ðŸ“§ Email: ${T.email}
ðŸ”‘ Password: ${T.password}
ðŸ”¢ PIN: ${k}

ðŸ’¡ LOGIN OPTIONS:
1. Email + Password: Use email and password above
2. PIN Login: Use email + ${k}

Please share these credentials securely with the new cashier.`;alert(K),v({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),o(!1)}catch(k){console.error("Error creating cashier:",k);let T="Failed to add cashier";k.message.includes("Current user not found")?T="Authentication error. Please refresh the page and try again.":k.message.includes("email")?T="Email already exists. Please use a different email.":k.message.includes("network")||k.message.includes("fetch")?T="Network error. Please check your connection and try again.":k.message&&(T=`Failed to add cashier: ${k.message}`),alert(T)}finally{l(!1)}},H=async(b,k)=>{try{l(!0),await Be.update(b,{permissions:k}),await $(),u(null)}catch(T){console.error("Error updating permissions:",T),alert("Failed to update permissions: "+T.message)}finally{l(!1)}},L=async(b,k)=>{try{l(!0);const T=!k,U=await fetch(`${se}/users/${b}/activate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({active:T})});if(!U.ok){const K=await U.json().catch(()=>({error:"Network error"}));throw new Error(K.error||`HTTP ${U.status}: ${U.statusText}`)}await $()}catch(T){console.error("Error updating user status:",T),alert("Failed to update user status: "+T.message)}finally{l(!1)}},V=async(b,k)=>{try{l(!0);const T=!k,U=await fetch(`${se}/users/${b}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({locked:T})});if(!U.ok){const K=await U.json().catch(()=>({error:"Network error"}));throw new Error(K.error||`HTTP ${U.status}: ${U.statusText}`)}await $()}catch(T){console.error("Error updating user lock status:",T),alert("Failed to update user lock status: "+T.message)}finally{l(!1)}},le=async b=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{l(!0),await Be.delete(b),await $()}catch(k){console.error("Error deleting user:",k),alert("Failed to delete user: "+k.message)}finally{l(!1)}},re=async()=>{if(window.confirm("Clear ALL users data? This will delete all users and cannot be undone."))try{l(!0);const b=localStorage.getItem("token");if(!(await fetch(`${se}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"},body:JSON.stringify({type:"users"})})).ok)throw new Error("Failed to clear users");x([]),alert("All users data cleared")}catch(b){alert("Failed to clear users: "+b.message)}finally{l(!1)}},he=b=>{_(b),W(D()),f(!0)},we=async()=>{try{l(!0),await Be.update(A.id,{cashierPIN:J}),await $(),f(!1),_(null),W(""),alert(`âœ… PIN reset successfully!

ðŸ”¢ New PIN for ${A.name}: ${J}

Please share this PIN securely with the cashier.`)}catch(b){console.error("Error resetting PIN:",b),alert("Failed to reset PIN: "+b.message)}finally{l(!1)}},pe=b=>{j(b),P({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const k=setInterval(()=>{ge(b)},3e3);P(T=>({...T,intervalId:k})),ge(b)},ae=()=>{a?.intervalId&&clearInterval(a.intervalId),j(null),P(null)},ge=async b=>{try{const k=await ze.getAll(),U=(Array.isArray(k)?k:[]).filter(R=>R.cashierId===b.id).sort((R,Z)=>new Date(Z.createdAt)-new Date(R.createdAt)).slice(0,10),K={isActive:Math.random()>.3,currentCart:U.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:U.reduce((R,Z)=>R+Z.total,0),salesCount:U.length,lastActivity:U.length>0?new Date(U[0].createdAt).toLocaleTimeString():"No recent activity"};P(K)}catch(k){console.error("Error loading live view data:",k)}},S=(d||[]).filter(b=>b.role==="cashier");return n&&d.length===0?e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),e.jsx("div",{className:"flex items-center gap-2",children:t()&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:re,disabled:n||d.length===0,className:"px-4 py-2 bg-red-700 hover:bg-red-800 disabled:bg-gray-400 text-white rounded font-medium flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4"}),"Clear All Users"]}),e.jsxs("button",{onClick:()=>o(!0),className:"btn-primary flex items-center gap-2",disabled:n,children:[e.jsx(be,{className:"w-4 h-4"}),"Add Cashier"]})]})})]}),i()&&!t()&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(fe,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:"User Management Restricted"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The admin has disabled cashier user management. You cannot add, edit, or remove users at this time."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:d.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:S.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:d.filter(b=>b.active).length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"PIN"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(d||[]).map(b=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:b.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:b.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${b.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:b.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:b.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:b.role==="cashier"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:b.pin||b.cashierPIN||"----"}),e.jsx("button",{onClick:()=>he(b),className:"p-1 hover:bg-yellow-50 rounded text-yellow-600",title:"Reset PIN",disabled:n,children:e.jsx(Je,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${b.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:b.active?e.jsxs(e.Fragment,{children:[e.jsx(Mt,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(qt,{className:"w-3 h-3"}),"Inactive"]})}),b.locked&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:[e.jsx(jt,{className:"w-3 h-3"}),"Locked"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>L(b.id,b.active),className:`p-2 rounded-lg transition ${b.active?"hover:bg-red-50 text-red-600":"hover:bg-green-50 text-green-600"}`,title:b.active?"Deactivate User":"Activate User",disabled:n,children:b.active?e.jsx(qt,{className:"w-4 h-4"}):e.jsx(Mt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>V(b.id,b.locked||!1),className:`p-2 rounded-lg transition ${b.locked?"hover:bg-green-50 text-green-600":"hover:bg-red-50 text-red-600"}`,title:b.locked?"Unlock User":"Lock User",disabled:n,children:e.jsx(jt,{className:"w-4 h-4"})})]}),b.role==="cashier"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",b.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(ts,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>pe(b),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(Bt,{className:"w-4 h-4"})})]}),t()&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u(b),className:"p-2 hover:bg-purple-50 rounded-lg text-purple-600",title:"Edit Permissions",children:e.jsx(Je,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>le(b.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",title:"Delete User",disabled:n,children:e.jsx(Ne,{className:"w-4 h-4"})})]})]})})]},b.id))})]}),d.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ze,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Add your first cashier to get started"})]})]})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:N.name||"",onChange:b=>{console.log("Name input changed:",b.target.value),v({...N,name:b.target.value})},required:!0,disabled:n}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:N.email||"",onChange:b=>{console.log("Email input changed:",b.target.value),v({...N,email:b.target.value})},required:!0,disabled:n}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:N.password||"",onChange:b=>{console.log("Password input changed:",b.target.value),v({...N,password:b.target.value})},required:!0,minLength:6,disabled:n}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(N.permissions).map(([b,k])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:T=>v({...N,permissions:{...N.permissions,[b]:T.target.checked}}),disabled:n}),e.jsx("span",{className:"text-sm capitalize",children:b.replace(/([A-Z])/g," $1").trim()})]},b))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:n,children:n?"Adding...":"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>o(!1),className:"btn-secondary",disabled:n,children:"Cancel"})]})]})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",p.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(p.permissions||{}).map(([b,k])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:T=>u({...p,permissions:{...p.permissions,[b]:T.target.checked}}),disabled:n}),e.jsx("span",{className:"text-sm capitalize",children:b.replace(/([A-Z])/g," $1").trim()})]},b))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>H(p.id,p.permissions),className:"btn-primary flex-1",disabled:n,children:n?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>u(null),className:"btn-secondary",disabled:n,children:"Cancel"})]})]})}),m&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(Bt,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",m.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:ae,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(Ce,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${a.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:a.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(De,{className:"w-4 h-4"}),"Last Activity: ",a.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(nt,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(a.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(a.currentCart||[]).map((b,k)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[b.name," x",b.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",b.price.toLocaleString()]})]},k)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(a.currentCart||[]).reduce((b,k)=>b+k.price*k.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:a.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",a.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",a.salesCount>0?Math.round(a.totalSalesToday/a.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})}),g&&A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Reset PIN for ",A.name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate a new 4-digit PIN for this cashier. The old PIN will be invalid."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"New PIN:"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"font-mono text-3xl font-bold text-blue-600 bg-white px-4 py-2 rounded border",children:J})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>W(D()),className:"btn-secondary flex-1",disabled:n,children:"Generate New PIN"}),e.jsx("button",{onClick:we,className:"btn-primary flex-1",disabled:n,children:n?"Updating...":"Confirm & Update"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>{f(!1),_(null),W("")},className:"btn-secondary w-full",disabled:n,children:"Cancel"})})]})})]})}function ya(){const{user:t}=oe(),[i,d]=s.useState([]),[x,n]=s.useState("all"),[l,r]=s.useState(!0);s.useEffect(()=>{o();const a=setInterval(o,3e4);return()=>clearInterval(a)},[]);const o=async()=>{try{r(!0);const a=await ft.getAll();Array.isArray(a)&&(d(a.reverse()),console.log(`âœ… Loaded ${a.length} clock records from backend`))}catch(a){console.error("Failed to load clock records:",a),d([])}finally{r(!1)}},p=new Date().toDateString(),u=x==="all"?i:i.filter(a=>{try{return new Date(a.date||a.clockInTime).toDateString()===p}catch{return!1}}),m=i.filter(a=>{try{return new Date(a.date||a.clockInTime).toDateString()===p&&a.duration}catch{return!1}}).reduce((a,P)=>a+(P.duration||0),0)/60,j=a=>{let P=typeof a=="number"?a<120?a:Math.floor(a/60):0;const y=Math.floor(P/60),w=P%60;return`${y}h ${w}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(De,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[m.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(Lt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers Today"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(i.filter(a=>{try{return new Date(a.date||a.clockInTime).toDateString()===new Date().toDateString()}catch{return!1}}).map(a=>a.cashierId||a.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(yt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:i.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>n("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${x==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>n("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${x==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"}),e.jsx("button",{onClick:o,disabled:l,className:"px-4 py-2 rounded-lg text-sm font-medium bg-green-100 text-green-600 hover:bg-green-200 disabled:opacity-50",children:l?"Loading...":"Refresh"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"})]})}),e.jsx("tbody",{children:u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:l?"Loading records...":"No records found"})}):u.map((a,P)=>{const y=new Date(a.clockInTime),w=a.clockOutTime?new Date(a.clockOutTime):null;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:a.cashierName||a.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:y.toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:y.toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:w?w.toLocaleTimeString():"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:a.duration?j(a.duration):"-"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${a.status==="clocked_in"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a.status==="clocked_in"?"ðŸŸ¢ Clocked In":"âœ“ Clocked Out"})})]},P)})})]})})]})]})}function Na(){const{user:t,updateUser:i}=oe();ue();const[d,x]=s.useState(!1),[n,l]=s.useState(t?.plan||"ultra"),[r,o]=s.useState({}),[p,u]=s.useState(null),[m,j]=s.useState(t?.profilePicture||null),[a,P]=s.useState(!0),[y,w]=s.useState(!0);s.useEffect(()=>{N()},[]);const N=async()=>{try{const $=await it.get();o($),$.logo&&u($.logo),P($.cashierUserManagement!==!1),w($.realTimeProductSync!==!1)}catch($){console.error("Failed to load settings:",$)}},v=async $=>{try{const D={...r,...$};return await it.update(D),o(D),!0}catch(D){return console.error("Failed to save settings:",D),!1}},g=async()=>{const $=!a;P($),await v({cashierUserManagement:$})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{cashierUserManagement:$}})),alert(`âœ… Cashier User Management ${$?"ENABLED":"DISABLED"}`)):(P(!$),alert("âŒ Failed to save setting. Please try again."))},f=async()=>{const $=!y;w($),await v({realTimeProductSync:$})?(window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{realTimeProductSync:$}})),alert(`âœ… Real-time Product Sync ${$?"ENABLED":"DISABLED"}`)):(w(!$),alert("âŒ Failed to save setting. Please try again."))},A=async $=>{const D=$.target.files[0];if(D){const F=new FileReader;F.onloadend=async()=>{const H=F.result;u(H);try{await it.update({...r,logo:H}),o({...r,logo:H})}catch(L){console.error("Failed to save logo:",L)}},F.readAsDataURL(D)}},_=async $=>{const D=$.target.files[0];if(D){const F=new FileReader;F.onloadend=async()=>{const H=F.result;j(H);try{await i({...t,profilePicture:H})}catch(L){console.error("Failed to save profile picture:",L)}},F.readAsDataURL(D)}},J=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],W=async()=>{const $=J.find(F=>F.id===n),D=n==="ultra"?"admin":"cashier";await i({...t,role:D,plan:n,price:$.price}),x(!1),setTimeout(()=>window.location.href=D==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Lt,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[m?e.jsx("img",{src:m,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:t?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(zt,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:_})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(_e,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>x(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx($t,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Ze,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cashier User Management"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Cashier User Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow cashiers to add and remove users"})]}),e.jsx("button",{onClick:g,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${a?"bg-blue-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${a?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${a?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:a?"âœ… Cashiers can add and remove users when enabled":"âŒ Cashiers cannot add or remove users when disabled"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Ds,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Real-time Product Sync"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Enable Real-time Sync"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Automatically sync products between admin and cashier dashboards"})]}),e.jsx("button",{onClick:f,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${y?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${y?"translate-x-6":"translate-x-1"}`})})]}),e.jsx("div",{className:`p-3 rounded-lg border ${y?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:e.jsx("p",{className:"text-xs",children:y?"âœ… Products will sync in real-time across all dashboards":"âŒ Products will not sync automatically across dashboards"})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(jt,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Es,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[p&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:p,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(zt,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:A})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:J.map($=>e.jsxs("div",{onClick:()=>l($.id),className:`card cursor-pointer transition-all ${n===$.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:$.name}),n===$.id&&e.jsx(et,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",$.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:$.features.map((D,F)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(et,{className:"w-4 h-4 text-green-600"}),D]},F))})]},$.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:W,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>x(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function va(){const[t,i]=s.useState([]),[d,x]=s.useState(!1),[n,l]=s.useState(null),[r,o]=s.useState({name:"",amount:"",description:"",active:!0});s.useEffect(()=>{p()},[]);const p=()=>{const a=JSON.parse(localStorage.getItem("serviceFees")||"[]");i(a)},u=a=>{localStorage.setItem("serviceFees",JSON.stringify(a)),i(a)},m=a=>{if(a.preventDefault(),n){const P=t.map(y=>y.id===n.id?{...r,id:y.id}:y);u(P)}else{const P={...r,id:Date.now(),createdAt:new Date().toISOString()};u([...t,P])}x(!1),l(null),o({name:"",amount:"",description:"",active:!0})},j=a=>{confirm("Delete this service fee?")&&u(t.filter(P=>P.id!==a))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{x(!0),l(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(a=>e.jsxs("div",{className:`card ${a.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Qe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500",children:a.description})]})]}),e.jsx("span",{className:`badge ${a.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:a.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",a.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{l(a),o(a),x(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(Je,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>j(a.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(Ne,{className:"w-4 h-4 text-red-600"})})]})]})]},a.id))}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:r.name,onChange:a=>o({...r,name:a.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:r.amount,onChange:a=>o({...r,amount:a.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:r.description,onChange:a=>o({...r,description:a.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.active,onChange:a=>o({...r,active:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>x(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function wa(){const[t,i]=s.useState([]),[d,x]=s.useState([]),[n,l]=s.useState(!1),[r,o]=s.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});s.useEffect(()=>{p(),u()},[]);const p=async()=>{try{const y=localStorage.getItem("token"),w=await fetch(`${se}/reminders`,{headers:{Authorization:`Bearer ${y}`}});if(!w.ok){console.error("API Error:",w.status,w.statusText),i([]);return}const N=await w.json();Array.isArray(N)?i(N):(console.error("Expected array but got:",typeof N,N),i([]))}catch(y){console.error("Failed to fetch reminders:",y),i([])}},u=async()=>{try{const y=localStorage.getItem("token"),w=await fetch(`${se}/products`,{headers:{Authorization:`Bearer ${y}`}});if(!w.ok){console.error("API Error:",w.status,w.statusText),x([]);return}const N=await w.json();Array.isArray(N)?x(N):(console.error("Expected array but got:",typeof N,N),x([]))}catch(y){console.error("Failed to fetch products:",y),x([])}},m=async y=>{y.preventDefault();try{const w=localStorage.getItem("token"),N=await fetch(`${se}/reminders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`},body:JSON.stringify(r)});if(!N.ok){const g=await N.json();console.error("Failed to create reminder:",g),alert(`Failed to create reminder: ${g.error||"Unknown error"}`);return}const v=await N.json();o({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),l(!1),p(),alert("Reminder created successfully!")}catch(w){console.error("Failed to create reminder:",w),alert("Failed to create reminder. Please try again.")}},j=async y=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const N=localStorage.getItem("token"),v=await fetch(`${se}/reminders/${y}`,{method:"DELETE",headers:{Authorization:`Bearer ${N}`}});if(!v.ok){const g=await v.json();console.error("Failed to delete reminder:",g),alert(`Failed to delete reminder: ${g.error||"Unknown error"}`);return}p(),alert("Reminder deleted successfully!")}catch(w){console.error("Failed to delete reminder:",w),alert("Failed to delete reminder. Please try again.")}},a=y=>{r.days.includes(y)?o({...r,days:r.days.filter(w=>w!==y)}):o({...r,days:[...r.days,y]})},P=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx($t,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("button",{onClick:()=>l(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(be,{size:20}),"New Reminder"]})]}),e.jsx("div",{className:"grid gap-4",children:t.map(y=>{const w=d.find(N=>N.id===y.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${y.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:y.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",w?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",y.frequency]}),y.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",y.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(yt,{size:16}),"Next: ",new Date(y.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${y.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:y.status}),e.jsx("button",{onClick:()=>j(y.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(Ne,{size:20})})]})]})},y.id)})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:m,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:r.customerName,onChange:y=>o({...r,customerName:y.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:r.productId,onChange:y=>o({...r,productId:parseInt(y.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),d.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:r.frequency,onChange:y=>o({...r,frequency:y.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),r.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:P.map(y=>e.jsx("button",{type:"button",onClick:()=>a(y),className:`px-4 py-2 rounded-lg font-medium transition ${r.days.includes(y)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:y},y))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:r.nextDate,onChange:y=>o({...r,nextDate:y.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>l(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})}function Sa(){const[t,i]=s.useState([]),[d,x]=s.useState(!1),[n,l]=s.useState(null),[r,o]=s.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});s.useEffect(()=>{p()},[]);const p=async()=>{try{const a=await lt.getAll();i(a)}catch(a){console.error("Failed to load discounts:",a)}},u=async a=>{a.preventDefault();try{n?await lt.update(n.id,r):await lt.create(r),x(!1),l(null),o({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),p()}catch(P){console.error("Failed to save discount:",P)}},m=async a=>{if(confirm("Delete this discount?"))try{await lt.delete(a),p()}catch(P){console.error("Failed to delete discount:",P)}},j=a=>{const P=new Date,y=new Date(a.validFrom),w=new Date(a.validTo);return a.active&&y<=P&&w>=P};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{x(!0),l(null),o({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(a=>e.jsxs("div",{className:`card ${j(a)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${j(a)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(Tt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[a.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${j(a)?"badge-success":"bg-gray-200 text-gray-600"}`,children:j(a)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yt,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(a.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yt,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(a.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{l(a),o(a),x(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(Je,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>m(a.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(Ne,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},a.id)),t.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(Tt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:r.name,onChange:a=>o({...r,name:a.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:r.percentage,onChange:a=>o({...r,percentage:parseFloat(a.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:r.validFrom,onChange:a=>o({...r,validFrom:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:r.validTo,onChange:a=>o({...r,validTo:a.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.active,onChange:a=>o({...r,active:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>x(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function ka(){const[t,i]=s.useState([]),[d,x]=s.useState("all"),[n,l]=s.useState(null),[r,o]=s.useState(""),[p,u]=s.useState(!1),[m,j]=s.useState(null);s.useEffect(()=>{a();const f=setInterval(a,1e4);return()=>clearInterval(f)},[]);const a=async()=>{try{const f=await gt.getAll();i(f||[])}catch(f){console.error("Failed to load credit requests:",f)}},P=async f=>{l(f);try{await gt.update(f,{status:"approved"}),console.log("âœ… Credit request approved"),a()}catch(A){console.error("Failed to approve request:",A),alert("Failed to approve request: "+(A.message||"Unknown error"))}finally{l(null)}},y=f=>{j(f),u(!0)},w=async()=>{if(m){l(m.id);try{await gt.update(m.id,{status:"rejected",rejectionReason:r}),console.log("âœ… Credit request rejected"),u(!1),o(""),j(null),a()}catch(f){console.error("Failed to reject request:",f),alert("Failed to reject request: "+(f.message||"Unknown error"))}finally{l(null)}}},N=t.filter(f=>d==="all"?!0:f.status===d),v=f=>{switch(f){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},g=f=>{switch(f){case"pending":return e.jsx(De,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(Ye,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(pt,{className:"w-6 h-6 text-red-600"});default:return e.jsx(_e,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(f=>e.jsxs("button",{onClick:()=>x(f),className:`px-4 py-2 rounded-lg font-medium transition ${d===f?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[f.charAt(0).toUpperCase()+f.slice(1),f==="pending"&&t.filter(A=>A.status==="pending").length>0&&e.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1",children:t.filter(A=>A.status==="pending").length})]},f))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[N.map(f=>e.jsx("div",{className:`card border-l-4 ${v(f.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${f.status==="pending"?"bg-orange-600":f.status==="approved"?"bg-green-600":"bg-red-600"}`,children:g(f.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:f.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Requested by: ",f.cashierName]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",f.amount?.toLocaleString()]})]}),f.reason&&e.jsxs("span",{children:["Reason: ",e.jsx("strong",{children:f.reason.replace(/_/g," ")})]})]}),f.notes&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Notes: ",f.notes]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(f.createdAt).toLocaleString()]}),f.approvalDate&&e.jsxs("p",{className:"text-xs text-gray-500",children:[f.status==="approved"?"Approved":"Processed",": ",new Date(f.approvalDate).toLocaleString(),f.approvedBy&&` by ${f.approvedBy}`]}),f.rejectionReason&&e.jsxs("p",{className:"text-xs text-red-600 mt-2",children:["Rejection reason: ",f.rejectionReason]})]})]}),f.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>P(f.id),disabled:n===f.id,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition disabled:opacity-50",children:[e.jsx(Ye,{size:16}),n===f.id?"Approving...":"Approve"]}),e.jsxs("button",{onClick:()=>y(f),disabled:n===f.id,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition disabled:opacity-50",children:[e.jsx(pt,{size:16}),n===f.id?"Rejecting...":"Reject"]})]}),f.status!=="pending"&&e.jsx("span",{className:`badge ${f.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:f.status.toUpperCase()})]})},f.id)),N.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(_e,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",d!=="all"?d:""," credit requests found."]})]})]}),p&&m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-red-500 to-red-600 p-6 text-white flex items-center gap-3",children:[e.jsx(Fe,{className:"w-6 h-6"}),e.jsx("h3",{className:"text-xl font-bold",children:"Reject Credit Request"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Are you sure you want to reject this credit request from ",e.jsx("strong",{children:m.customerName})," for ",e.jsxs("strong",{children:["KSH ",m.amount?.toLocaleString()]}),"?"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Rejection Reason"}),e.jsx("textarea",{placeholder:"Enter reason for rejection...",value:r,onChange:f=>o(f.target.value),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-red-500",rows:"4"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:w,disabled:n!==null,className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-bold transition disabled:opacity-50",children:n?"Rejecting...":"Confirm Rejection"}),e.jsx("button",{onClick:()=>{u(!1),o(""),j(null)},disabled:n!==null,className:"flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400 transition disabled:opacity-50",children:"Cancel"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[N.map(f=>e.jsx("div",{className:`card border-l-4 ${v(f.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${f.status==="pending"?"bg-orange-600":f.status==="approved"?"bg-green-600":"bg-red-600"}`,children:g(f.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:f.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:getProductName(f.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:f.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",f.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(f.createdAt).toLocaleString()]}),f.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(f.approvedAt).toLocaleString()]})]})]}),f.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>P(f.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Ye,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>handleReject(f.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(pt,{size:16}),"Reject"]})]}),f.status!=="pending"&&e.jsx("span",{className:`badge ${f.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:f.status.toUpperCase()})]})},f.id)),N.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(_e,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",d!=="all"?d:""," credit requests found."]})]})]})]})}function Ca(){const[t,i]=s.useState([]),[d,x]=s.useState(!0),[n,l]=s.useState(!1),[r,o]=s.useState(null),[p,u]=s.useState(""),[m,j]=s.useState({name:"",email:"",phone:"",address:"",city:"",country:"",products:""});s.useEffect(()=>{a()},[]);const a=async()=>{try{x(!0);const g=localStorage.getItem("token"),f=await fetch(`${se}/vendors`,{headers:{Authorization:`Bearer ${g}`}});if(f.ok){const A=await f.json();i(Array.isArray(A)?A:[])}}catch(g){console.error("Failed to load vendors:",g),i([])}finally{x(!1)}},P=()=>{o(null),j({name:"",email:"",phone:"",address:"",city:"",country:"",products:""}),l(!0)},y=g=>{o(g),j(g),l(!0)},w=async g=>{if(window.confirm("Are you sure you want to delete this vendor?"))try{const f=localStorage.getItem("token");(await fetch(`${se}/vendors/${g}`,{method:"DELETE",headers:{Authorization:`Bearer ${f}`}})).ok?(i(t.filter(_=>_.id!==g)),alert("Vendor deleted successfully")):alert("Failed to delete vendor")}catch(f){console.error("Failed to delete vendor:",f),alert("Failed to delete vendor")}},N=async g=>{g.preventDefault();try{const f=localStorage.getItem("token"),A=r?"PUT":"POST",_=r?`${se}/vendors/${r.id}`:`${se}/vendors`,J=await fetch(_,{method:A,headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(J.ok){const W=await J.json();i(r?t.map($=>$.id===W.id?W:$):[...t,W]),l(!1),alert(r?"Vendor updated":"Vendor added")}else alert("Failed to save vendor")}catch(f){console.error("Failed to save vendor:",f),alert("Failed to save vendor")}},v=t.filter(g=>g.name?.toLowerCase().includes(p.toLowerCase())||g.email?.toLowerCase().includes(p.toLowerCase()));return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Vendors"}),e.jsxs("button",{onClick:P,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(be,{className:"w-5 h-5"}),"Add Vendor"]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(ct,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search vendors...",value:p,onChange:g=>u(g.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"})]})}),d?e.jsx("div",{className:"text-center py-8",children:"Loading vendors..."}):v.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["No vendors found. ",t.length===0&&"Add your first vendor to get started."]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map(g=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:g.name}),e.jsx("p",{className:"text-sm text-gray-500",children:g.products})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(g),className:"p-2 text-blue-600 hover:bg-blue-50 rounded",children:e.jsx(Je,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>w(g.id),className:"p-2 text-red-600 hover:bg-red-50 rounded",children:e.jsx(Ne,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[g.email&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Nt,{className:"w-4 h-4"}),e.jsx("a",{href:`mailto:${g.email}`,children:g.email})]}),g.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Ls,{className:"w-4 h-4"}),e.jsx("a",{href:`tel:${g.phone}`,children:g.phone})]}),g.address&&e.jsxs("div",{className:"flex items-start gap-2 text-gray-600",children:[e.jsx($s,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[g.address,g.city&&`, ${g.city}`,g.country&&`, ${g.country}`]})]})]})]},g.id))}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:r?"Edit Vendor":"Add Vendor"}),e.jsx("button",{onClick:()=>l(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(Ce,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vendor Name *"}),e.jsx("input",{type:"text",required:!0,value:m.name,onChange:g=>j({...m,name:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g., ABC Supplies"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Products/Services"}),e.jsx("input",{type:"text",value:m.products,onChange:g=>j({...m,products:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g., Vegetables, Fruits"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:m.email,onChange:g=>j({...m,email:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"vendor@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:m.phone,onChange:g=>j({...m,phone:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"+1 (555) 000-0000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("input",{type:"text",value:m.address,onChange:g=>j({...m,address:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Street address"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",value:m.city,onChange:g=>j({...m,city:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"City"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Country"}),e.jsx("input",{type:"text",value:m.country,onChange:g=>j({...m,country:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Country"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>l(!1),className:"flex-1 px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"flex-1 px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700",children:[r?"Update":"Add"," Vendor"]})]})]})]})})]})}function ms({onClose:t}){const[i,d]=s.useState([]),[x,n]=s.useState(!0),l=s.useRef({data:null,timestamp:null}),r=3e4;s.useEffect(()=>{o()},[]);const o=async()=>{try{const u=Date.now();if(l.current.data&&l.current.timestamp&&u-l.current.timestamp<r){console.log("ðŸ“¦ Using cached reminders"),d(l.current.data),n(!1);return}const m=localStorage.getItem("token"),j=await fetch(`${se}/reminders/today`,{headers:{Authorization:`Bearer ${m}`}});if(!j.ok){console.error("API Error:",j.status,j.statusText),d([]),n(!1);return}const a=await j.json();Array.isArray(a)?(l.current.data=a,l.current.timestamp=Date.now(),d(a)):(console.error("Expected array but got:",typeof a,a),d([]))}catch(u){console.error("Failed to fetch reminders:",u),d([])}finally{n(!1)}},p=async u=>{try{const m=localStorage.getItem("token");await fetch(`${se}/reminders/${u}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({status:"fulfilled"})}),l.current={data:null,timestamp:null},o()}catch(m){console.error("Failed to update reminder:",m)}};return x?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:t,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(Ce,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Fe,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):i.map(u=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:u.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",u.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:u.frequency})]}),e.jsxs("button",{onClick:()=>p(u.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Ye,{size:18}),"Mark Done"]})]},u.id))})]})})}function xs({onUnlock:t,userType:i="user"}){const[d,x]=s.useState(""),[n,l]=s.useState(""),[r,o]=s.useState("password"),[p,u]=s.useState(!1),[m,j]=s.useState(""),[a,P]=s.useState(!1),[y,w]=s.useState("2005"),N=JSON.parse(localStorage.getItem("user")||"{}");s.useEffect(()=>{(async()=>{try{const A=await it.get();A?.screenLockPassword&&w(A.screenLockPassword)}catch(A){console.warn("Failed to load settings, using default password:",A)}})()},[]),s.useEffect(()=>{const f=document.getElementById(r==="password"?"unlock-password":"unlock-pin");f&&f.focus()},[r]);const v=async f=>{f.preventDefault(),f.stopPropagation(),P(!0),j("");try{const A=localStorage.getItem("token");if(!A)throw new Error("No authentication token found");const _=await fetch("https://universal-backend-w0x1.onrender.com/api/auth/unlock-screen",{method:"POST",headers:{Authorization:`Bearer ${A}`,"Content-Type":"application/json"},body:JSON.stringify({pin:n})});if(!_.ok){const W=await _.json();throw _.status===429?new Error(W.message||"Too many failed attempts. Try again later."):_.status===401?new Error(W.message||"Incorrect PIN"):new Error(W.message||"Unlock failed")}const J=await _.json();J.token&&localStorage.setItem("token",J.token),l(""),x(""),t(J)}catch(A){j(A.message||"Unlock failed")}finally{P(!1)}},g=f=>{const A=f.replace(/\D/g,"").slice(0,4);l(A)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:f=>f.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${i==="main_admin"?"bg-gradient-to-br from-red-600 to-orange-600":"bg-gradient-to-br from-blue-600 to-purple-600"}`,children:e.jsx(fe,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-gray-600",children:i==="main_admin"?"Main Admin":N.name||"User"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Enter your ",r," to continue"]})]}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter PIN to unlock"}),e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",id:"unlock-pin",value:n,onChange:f=>g(f.target.value),placeholder:"0000",maxLength:"4",className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-center tracking-widest text-2xl",disabled:a})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"ðŸ”’ PIN validated securely on server"})]}),m&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-red-700 text-sm font-medium",children:[m.includes("Too many")?"âŒ ":"âš ï¸ ",m]})}),e.jsx("button",{type:"submit",disabled:a||n.length<4,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 rounded-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"}),"Verifying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-5 h-5"}),"Unlock Screen"]})})]})]})})}function us(t=6e4){const[i,d]=s.useState(!1),x=s.useRef(Date.now()),n=s.useCallback(()=>{x.current=Date.now(),d(!1)},[]),l=s.useCallback(()=>{d(!1),x.current=Date.now()},[]);return s.useEffect(()=>{const r=["mousedown","mousemove","keypress","scroll","touchstart","click"],o=()=>{x.current=Date.now(),i&&d(!1)};r.forEach(u=>{document.addEventListener(u,o,!0)});const p=setInterval(()=>{Date.now()-x.current>t&&!i&&d(!0)},5e3);return()=>{r.forEach(u=>{document.removeEventListener(u,o,!0)}),clearInterval(p)}},[t,i]),[i,l,n]}function Kt(){const{user:t,logout:i,isCashierUserManagementEnabled:d}=oe(),x=ue(),n=Yt(),[l,r]=s.useState(!0),[o,p]=s.useState(!1),[u,m]=s.useState({}),[j,a]=us(45e3);s.useEffect(()=>{const v=()=>{const f=localStorage.getItem("user");if(f){const A=JSON.parse(f);let _=!1;(A.plan==="ultra"||A.role==="admin")&&(A.active||(A.active=!0,_=!0),A.plan==="ultra"&&A.role!=="admin"&&(A.role="admin",_=!0),A.plan==="ultra"&&(!A.price||A.price!==1600)&&(A.price=1600,_=!0),_&&(localStorage.setItem("user",JSON.stringify(A)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};v(),setTimeout(v,100);const g=setTimeout(()=>{p(!0)},1e3);return P(),()=>clearTimeout(g)},[]);const P=async()=>{try{const v=await it.get();m(v)}catch(v){console.error("Failed to load settings:",v)}},y=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses data? This action cannot be undone."))try{const v=localStorage.getItem("token"),f=await fetch(`${se}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!f.ok){const A=await f.json();throw new Error(A.message||"Failed to clear data")}alert("Data cleared successfully!"),window.location.reload()}catch(v){console.error("Failed to clear data:",v),alert("Failed to clear data: "+v.message)}},w=[{id:"overview",label:"Dashboard",icon:Os,path:"/admin"},{id:"sales",label:"Sales",icon:Xt,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:Ue,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:Fs,path:"/admin/recipes"},{id:"expenses",label:"Expenses",icon:ot,path:"/admin/expenses"},{id:"vendors",label:"Vendors",icon:Us,path:"/admin/vendors"},...d()?[{id:"users",label:"Users",icon:Ze,path:"/admin/users"}]:[],{id:"time",label:"Time Tracking",icon:De,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:$t,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:Qe,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:Tt,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:_e,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:Rs,path:"/admin/settings"}],N=v=>v==="/admin"?n.pathname==="/admin":n.pathname.startsWith(v);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${l?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[l&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>r(!l),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:l?e.jsx(Ce,{className:"w-5 h-5"}):e.jsx(Ms,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:w.map(v=>{const g=v.icon;return e.jsxs("button",{onClick:()=>x(v.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${N(v.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(g,{className:"w-5 h-5 flex-shrink-0"}),l&&e.jsx("span",{className:"font-medium",children:v.label})]},v.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(qs,{className:"w-5 h-5 flex-shrink-0"}),l&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:i,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(Pe,{className:"w-5 h-5 flex-shrink-0"}),l&&e.jsx("span",{className:"font-medium",children:"Logout"})]}),e.jsxs("button",{onClick:y,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-orange-600 hover:bg-orange-50 transition-colors",children:[e.jsx(Ce,{className:"w-5 h-5 flex-shrink-0"}),l&&e.jsx("span",{className:"font-medium",children:"Clear Data"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:w.find(v=>N(v.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:t?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(Qt,{children:[e.jsx(G,{path:"/",element:e.jsx(xa,{})}),e.jsx(G,{path:"/sales",element:e.jsx(fa,{})}),e.jsx(G,{path:"/inventory",element:e.jsx(pa,{})}),e.jsx(G,{path:"/recipes",element:e.jsx(ga,{})}),e.jsx(G,{path:"/expenses",element:e.jsx(ba,{})}),e.jsx(G,{path:"/vendors",element:e.jsx(Ca,{})}),e.jsx(G,{path:"/reminders",element:e.jsx(wa,{})}),e.jsx(G,{path:"/service-fees",element:e.jsx(va,{})}),e.jsx(G,{path:"/discounts",element:e.jsx(Sa,{})}),e.jsx(G,{path:"/credit-requests",element:e.jsx(ka,{})}),e.jsx(G,{path:"/users",element:e.jsx(ja,{})}),e.jsx(G,{path:"/time",element:e.jsx(ya,{})}),e.jsx(G,{path:"/settings",element:e.jsx(Na,{})})]})})]}),o&&e.jsx(ms,{onClose:()=>p(!1)}),j&&e.jsx(xs,{onUnlock:a,logo:u.logo})]})}const Pa=`
  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideInDown {
    from {
      opacity: 0;
      transform: translateY(-30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeInScale {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes pulse-glow {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
    }
    50% {
      box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
    }
  }

  @keyframes float {
    0%, 100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-20px);
    }
  }

  @keyframes shimmer {
    0% {
      background-position: -1000px 0;
    }
    100% {
      background-position: 1000px 0;
    }
  }

  @keyframes bounce-in {
    0% {
      opacity: 0;
      transform: scale(0.8);
    }
    50% {
      opacity: 1;
    }
    100% {
      transform: scale(1);
    }
  }

  @keyframes word-slide {
    0% {
      opacity: 0;
      transform: translateX(-30px);
    }
    100% {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .animate-slide-up {
    animation: slideInUp 0.8s ease-out forwards;
  }

  .animate-slide-down {
    animation: slideInDown 0.8s ease-out forwards;
  }

  .animate-fade-scale {
    animation: fadeInScale 0.6s ease-out forwards;
  }

  .animate-pulse-glow {
    animation: pulse-glow 2s infinite;
  }

  .animate-float {
    animation: float 3s ease-in-out infinite;
  }

  .animate-bounce-in {
    animation: bounce-in 0.6s ease-out forwards;
  }

  .feature-card {
    animation: slideInUp 0.8s ease-out forwards;
  }

  .feature-card:nth-child(1) { animation-delay: 0.1s; }
  .feature-card:nth-child(2) { animation-delay: 0.2s; }
  .feature-card:nth-child(3) { animation-delay: 0.3s; }
  .feature-card:nth-child(4) { animation-delay: 0.4s; }
  .feature-card:nth-child(5) { animation-delay: 0.5s; }
  .feature-card:nth-child(6) { animation-delay: 0.6s; }

  .plan-card {
    animation: fadeInScale 0.7s ease-out forwards;
  }

  .plan-card:nth-child(1) { animation-delay: 0.2s; }
  .plan-card:nth-child(2) { animation-delay: 0.4s; }

  .stat-item {
    animation: slideInUp 0.8s ease-out forwards;
  }

  .stat-item:nth-child(1) { animation-delay: 0.1s; }
  .stat-item:nth-child(2) { animation-delay: 0.2s; }
  .stat-item:nth-child(3) { animation-delay: 0.3s; }
  .stat-item:nth-child(4) { animation-delay: 0.4s; }

  .hero-text {
    opacity: 0;
  }

  .hero-text-1 { animation: word-slide 0.6s ease-out 0.2s forwards; }
  .hero-text-2 { animation: word-slide 0.6s ease-out 0.4s forwards; }
  .hero-text-3 { animation: word-slide 0.6s ease-out 0.6s forwards; }

  .btn-animate {
    animation: slideInUp 0.8s ease-out 0.8s forwards;
    opacity: 0;
  }

  .glow-border {
    animation: pulse-glow 2s infinite;
  }
`;function Ia(){const t=ue(),[i,d]=s.useState(!1),[x,n]=s.useState(0);s.useEffect(()=>{const p=document.createElement("style");return p.textContent=Pa,document.head.appendChild(p),()=>document.head.removeChild(p)},[]);const l=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 1,600 - 1 Cashier) or Ultra (KSH 3,000 - Unlimited) package",image:"ðŸ“",details:"First user becomes Admin automatically. Basic supports 1 cashier. Ultra supports unlimited cashiers with full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],r=[{icon:Oe,title:"âš¡ Atomic Sales",desc:"Complete sales instantly (3-4ms) - never hanging, always consistent stock"},{icon:Te,title:"ðŸ“Š Live Analytics",desc:"Real-time dashboard updates every 5 seconds with instant totals"},{icon:Oe,title:"ðŸ”’ Zero Race Conditions",desc:"File-based locking prevents stock conflicts even with simultaneous sales"},{icon:Ue,title:"âš ï¸ Low-Stock Alerts",desc:"Automatic warnings when inventory drops below threshold"},{icon:jt,title:"ðŸ’¯ 99.99% Reliability",desc:"Atomic transactions guarantee data integrity, never lost sales"},{icon:Dt,title:"ðŸš€ Performance+",desc:"Sales 50x faster, Analytics 140x faster than legacy systems"}],o=[{name:"Basic",price:1e3,icon:Oe,popular:!1,features:["âœ“ Admin + Cashier Dashboard","âœ“ Basic Inventory","âœ“ Sales Tracking","âœ“ Daily/Weekly Reports","âœ“ Basic Profit/Loss View","âœ“ Email Support","âœ“ 1 Cashier Only"]},{name:"Ultra",price:2500,icon:Et,popular:!0,features:["âœ“ Admin + Cashier Dashboard","âœ“ Full Inventory Management","âœ“ Automatic Stock Deduction","âœ“ User Management (Unlimited)","âœ“ Permission Controls","âœ“ Expense Tracking","âœ“ Advanced Analytics","âœ“ Priority Support"]},{name:"Pro",price:3400,icon:Et,popular:!1,features:["âœ“ All Ultra Features","âœ“ Recipe/BOM Builder","âœ“ COGS Calculation","âœ“ Composite Products","âœ“ Advanced Reporting","âœ“ Multi-location Support","âœ“ API Access","âœ“ Dedicated Support"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/auth/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>t("/choose-subscription"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(Bs,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>t("/choose-subscription"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(rt,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(ss,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 30-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Dt,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:r.map((p,u)=>{const m=p.icon;return e.jsxs("div",{className:"feature-card bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(m,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:p.title}),e.jsx("p",{className:"text-gray-600",children:p.desc})]},u)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:o.map((p,u)=>{const m=p.icon;return e.jsxs("div",{className:`plan-card relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${p.popular?"ring-4 ring-blue-600":""}`,children:[p.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${p.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(m,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:p.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",p.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:p.features.map((j,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(et,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:j})]},a))}),e.jsx("button",{onClick:()=>t("/choose-subscription"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${p.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},u)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>t("/choose-subscription"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(rt,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{d(!1),n(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Ce,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",x+1," of ",l.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((x+1)/l.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(x+1)/l.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:l[x].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:l[x].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:l[x].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:l[x].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>n(Math.max(0,x-1)),disabled:x===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),x<l.length-1?e.jsxs("button",{onClick:()=>n(x+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(rt,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{d(!1),n(0),t("/choose-subscription")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(rt,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:l.map((p,u)=>e.jsx("button",{onClick:()=>n(u),className:`w-2 h-2 rounded-full transition-all ${u===x?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},u))})]})]})})]})}function Vt(){const t=Yt(),[i,d]=s.useState(t.pathname==="/auth/login"),[x,n]=s.useState("password"),[l,r]=s.useState({email:"",password:"",pin:"",name:"",newPassword:"",confirmPassword:""}),[o,p]=s.useState(""),[u,m]=s.useState(!1),[j,a]=s.useState(!1),P=ue(),{login:y}=oe(),w=()=>{try{return JSON.parse(localStorage.getItem("selectedPlan")||"null")}catch(v){return console.warn("Invalid selectedPlan in localStorage:",v),null}},N=async v=>{v.preventDefault(),p(""),m(!0);try{if(j){if(l.newPassword!==l.confirmPassword){p("Passwords do not match"),m(!1);return}if(l.newPassword.length<6){p("Password must be at least 6 characters"),m(!1);return}const J=await Ge.login({email:l.email,newPassword:l.newPassword});J.token&&J.user&&(await y(J),P("/dashboard"));return}if(i){if(x==="pin"){if(!l.pin||l.pin.length!==4){p("Please enter a valid 4-digit PIN"),m(!1);return}}else if(!l.password){p("Please enter your password"),m(!1);return}}let g;if(i)if(x==="pin")try{g=await Ge.pinLogin({email:l.email,pin:l.pin})}catch(J){if(J.message.includes("PIN not set"))p("PIN not set for this user. Please use password login.");else if(J.message.includes("Invalid PIN"))p("Invalid PIN. Please try again.");else throw J;m(!1);return}else g=await Ge.login({email:l.email,password:l.password});else{const J=w(),W=localStorage.getItem("planId")||J?.id||"basic",$=localStorage.getItem("selectedBusinessType"),D=localStorage.getItem("selectedFeatures");g=await Ge.signup({...l,planId:W,businessType:$,selectedFeatures:D?JSON.parse(D):[]})}if(g.needsPasswordSetup){a(!0),r({...l,email:g.email}),p(""),m(!1);return}if(!g||!g.user||!g.token)throw new Error("Authentication failed. Please try again.");const f={id:Date.now(),type:i?"login":"signup",user:{id:g.user.id,name:g.user.name,email:g.user.email,role:g.user.role,plan:g.user.plan},timestamp:new Date().toISOString(),ip:"Unknown",userAgent:navigator.userAgent},A=JSON.parse(localStorage.getItem("authActivities")||"[]");A.unshift(f),A.splice(50),localStorage.setItem("authActivities",JSON.stringify(A)),await y(g);const _=i?"logged in":"signed up";console.log(`âœ… User ${g.user.name} ${_} successfully`),g.user.role==="owner"?P("/main-admin"):g.user.role==="admin"?P("/admin"):g.user.role==="cashier"?P("/cashier"):P("/dashboard")}catch(g){console.error("Authentication error:",g);let f=g.message||"Authentication failed. Please try again.";g.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),f="Invalid credentials. Please try again."),p(f)}finally{m(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:i?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600",children:i?"Login to your account":"Create your account"})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[j?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.newPassword,onChange:v=>r({...l,newPassword:v.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.confirmPassword,onChange:v=>r({...l,confirmPassword:v.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!i&&e.jsxs("div",{className:"relative",children:[e.jsx(Lt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.name,onChange:v=>r({...l,name:v.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Nt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.email,onChange:v=>r({...l,email:v.target.value}),required:!0})]}),i&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Login Method"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n("password"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${x==="password"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Password"}),e.jsx("button",{type:"button",onClick:()=>n("pin"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${x==="pin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"pin"})]})]}),i&&x==="password"&&e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.password,onChange:v=>r({...l,password:v.target.value}),required:!0})]}),i&&x==="pin"&&e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"4-digit PIN",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.pin,onChange:v=>r({...l,pin:v.target.value.replace(/\D/g,"").slice(0,4)}),maxLength:4,required:!0})]}),!i&&e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",value:l.password,onChange:v=>r({...l,password:v.target.value}),required:!0})]})]}),o&&e.jsx("div",{className:"text-red-600 text-sm text-center bg-red-50 p-3 rounded-lg",children:o}),e.jsx("button",{type:"submit",disabled:u,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50",children:u?"Please wait...":j?"Set Password":i?"Login":"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{d(!i),p(""),a(!1)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:i?"Don't have an account? Sign up":"Already have an account? Login"})})]})})}function Aa(){const[t,i]=s.useState("ultra"),[d,x]=s.useState(!1),[n,l]=s.useState({name:"",email:"",company:""}),r=ue();console.log("âœ… Subscription component mounted, navigate available:",typeof r);const o=[{id:"basic",name:"Basic",price:1e3,icon:Oe,color:"from-green-500 to-teal-600",popular:!1,features:["âœ“ Admin Dashboard + Cashier POS","âœ“ Basic Inventory Management","âœ“ Sales Tracking","âœ“ Daily/Weekly Reports","âœ“ Basic Profit/Loss View","âœ“ Email Support","âœ“ 1 Cashier Only"]},{id:"ultra",name:"Ultra",price:2500,icon:Et,color:"from-blue-600 to-purple-600",popular:!0,features:["âœ“ Admin Dashboard + Cashier POS","âœ“ Full Inventory Management","âœ“ Automatic Stock Deduction","âœ“ User Management (Unlimited)","âœ“ Permission Controls","âœ“ Expense Tracking","âœ“ Advanced Analytics","âœ“ Priority Support"]}],p=m=>{m?.preventDefault?.(),console.log("[BUTTON] Get Started clicked, selected plan:",t),console.log("[BUTTON] Available plans:",o.map(a=>a.id));const j=o.find(a=>a.id===t);if(console.log("[BUTTON] Found plan:",j),!j){console.error("[BUTTON] Plan not found!"),alert("Please select a plan first");return}try{const a={id:j.id,name:j.name,price:j.price};localStorage.setItem("selectedPlan",JSON.stringify(a)),localStorage.setItem("planId",t),console.log("[BUTTON] Stored to localStorage, navigating..."),console.log("[BUTTON] Going to /auth/signup"),r("/auth/signup")}catch(a){console.error("[BUTTON] Error:",a),alert("Error: "+a.message)}},u=async m=>{m.preventDefault();try{await fetch(`${se}/demo-requests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),alert("Demo request submitted! Admin will review and contact you."),x(!1),l({name:"",email:"",company:""})}catch(j){console.error("Demo request failed:",j),alert("Failed to submit demo request. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:()=>r("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition",children:[e.jsx(as,{size:20}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mb-12 md:mb-16",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Pick the perfect plan and unlock your POS potential"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8 mb-8 md:mb-12 max-w-5xl mx-auto",children:o.map(m=>{const j=m.icon;return e.jsxs("div",{onClick:()=>i(m.id),className:`card cursor-pointer transition-all transform ${t===m.id?"ring-4 ring-blue-600 shadow-2xl scale-105 bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-lg hover:scale-102"} relative`,children:[m.popular&&e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl bg-gradient-to-br ${m.color} flex items-center justify-center`,children:e.jsx(j,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"text-lg md:text-xl font-bold",children:m.name})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("span",{className:"text-2xl md:text-3xl font-bold",children:["KSH ",m.price]}),e.jsx("span",{className:"text-gray-600 text-xs md:text-sm",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:m.features.map((a,P)=>e.jsxs("li",{className:"flex items-start gap-2 text-xs md:text-sm",children:[e.jsx(et,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:a})]},P))})]},m.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center mt-8",children:[e.jsx("button",{type:"button",onClick:p,className:"cursor-pointer px-8 md:px-12 py-3 md:py-4 text-base md:text-lg font-bold bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all active:scale-95",children:"Get Started"}),e.jsx("button",{type:"button",onClick:()=>x(!0),className:"cursor-pointer px-8 md:px-12 py-3 md:py-4 text-base md:text-lg font-bold border-2 border-gray-300 bg-white text-gray-700 rounded-lg hover:border-gray-400 transition-all",children:"Request Free Demo"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-4 text-center",children:"Secure payment â€¢ Cancel anytime"}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Request Free Demo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"We'll contact you to schedule a demo"})]}),e.jsxs("form",{onSubmit:u,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:n.name,onChange:m=>l({...n,name:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:n.email,onChange:m=>l({...n,email:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Company Name"}),e.jsx("input",{type:"text",value:n.company,onChange:m=>l({...n,company:m.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-green-500",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition",children:"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>x(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})})}const At={bar:{id:"bar",name:"Bar / Alcohol Business",description:"Drinks, happy hour pricing, brand tracking, staff shifts",icon:"Wine",color:"amber",features:["Bottle size + brand management","Happy hour pricing rules","Staff shift tracking","Profit by brand","Low stock alerts","Age-check functionality"],productFields:["name","brand","size","category","price","cost","stock"],categories:["Beer","Wine","Spirits","Beverages","Mixers"],adminModules:["inventory","staff","shifts","pricing","reports"],cashierModules:["categories","quick-tap","age-check","shift-view"]},hospital:{id:"hospital",name:"Hospital / Clinic",description:"Patient billing, services, medicines, doctor commission",icon:"Heart",color:"red",features:["Services + medicines separation","Patient search + billing","Doctor commission tracking","Batch + expiry tracking","Medicine inventory","Invoice printing"],productFields:["name","type","category","price","batchNo","expiryDate","stock"],categories:["Services","Medicines","Lab Tests","Equipment"],adminModules:["patients","services","medicines","doctors","inventory"],cashierModules:["patient-search","add-services","add-medicines","print"]},school:{id:"school",name:"School",description:"Student billing, term fees, canteen, uniform/books",icon:"BookOpen",color:"blue",features:["Student management","Term fees tracking","Canteen inventory","Uniform + books stock","Fee payment receipts","Student balance"],productFields:["name","type","category","price","stock","description"],categories:["Fees","Canteen","Uniforms","Books","Supplies"],adminModules:["students","fees","canteen","inventory","reports"],cashierModules:["student-lookup","fee-payment","canteen-sales","receipts"]},kiosk:{id:"kiosk",name:"Kiosk / Small Shop",description:"Simple inventory, supplier tracking, fast POS",icon:"Store",color:"green",features:["Simple inventory management","Supplier tracking","Price rules","Profit reports","Low stock alerts","Fast checkout"],productFields:["name","category","price","cost","stock","supplier"],categories:["General","Electronics","Food","Drinks","Supplies"],adminModules:["inventory","suppliers","pricing","reports"],cashierModules:["search","quick-scan","low-stock-alerts"]},petrol:{id:"petrol",name:"Petrol / Gas Station",description:"Fuel types, pump tracking, tank stock, shift reconciliation",icon:"Fuel",color:"yellow",features:["Fuel type management","Pump tracking","Tank stock management","Shift reconciliation","Pump totals","Attendant management"],productFields:["name","fuelType","pricePerLiter","tankCapacity","pumpId","stock"],categories:["Petrol","Diesel","Premium","LPG"],adminModules:["fuel-types","pumps","tanks","staff","reconciliation"],cashierModules:["pump-selector","fuel-buttons","shift-totals","attendant-view"]},shoes:{id:"shoes",name:"Shoe / Clothing Store",description:"Size & color variants, margin tracking, returns/refunds",icon:"Shirt",color:"pink",features:["Size + color variants","Margin per product","Returns + refunds","Variant inventory","Barcode + search POS","Stock by variant"],productFields:["name","category","price","cost","size","color","stock","margin"],categories:["Shoes","Shirts","Pants","Dresses","Accessories"],adminModules:["variants","inventory","returns","pricing","reports"],cashierModules:["variant-selector","search","barcode","returns"]}};function Ta(){const t=ue(),[i,d]=s.useState(null),[x,n]=s.useState(1),l=m=>{d(m),n(2)},r=()=>{if(!i){alert("Please select a business type");return}const m=At[i];localStorage.setItem("selectedBusinessType",i),localStorage.setItem("businessMetadata",JSON.stringify(m)),console.log("[BUILD POS] Selected business:",i),t("/auth/signup")},o=()=>{x===2?(n(1),d(null)):t("/plans")},p=i?At[i]:null,u=Object.entries(At).map(([m,j])=>({id:m,...j}));return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 py-8 px-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs("button",{onClick:o,className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition p-2 rounded-lg hover:bg-white",children:[e.jsx(as,{size:20}),"Back"]})}),x===1&&e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Business Type"}),e.jsx("p",{className:"text-gray-600 mb-12 text-lg",children:"Select the type that best matches your operation. We'll customize your dashboard accordingly."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(m=>e.jsxs("button",{onClick:()=>l(m.id),className:`text-left p-6 rounded-xl border-2 transition-all transform hover:scale-105 ${i===m.id?"border-blue-600 bg-blue-50 ring-2 ring-blue-400 shadow-lg":"border-gray-200 bg-white hover:border-gray-300 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:m.name}),e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${i===m.id?"bg-blue-600 border-blue-600":"border-gray-300"}`,children:i===m.id&&e.jsx(et,{size:16,className:"text-white"})})]}),e.jsx("p",{className:"text-gray-600 mb-4 text-sm",children:m.description}),e.jsx("ul",{className:"space-y-2",children:m.features.slice(0,3).map((j,a)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[e.jsx("span",{className:"text-green-600 font-bold mt-0.5",children:"â€¢"}),e.jsx("span",{children:j})]},a))})]},m.id))})]}),x===2&&p&&e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-4xl font-bold mb-8 text-center",children:"Confirm Your Selection"}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 border-2 border-blue-600",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4 text-blue-600",children:p.name}),e.jsx("p",{className:"text-gray-600 mb-8 text-lg",children:p.description}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Your Dashboard Includes:"}),e.jsx("ul",{className:"space-y-3",children:p.features.map((m,j)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-green-600 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx(et,{size:16,className:"text-white"})}),e.jsx("span",{className:"text-gray-700",children:m})]},j))})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-8",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-bold",children:"Custom Price:"})," 3,500 KES/month"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Your admin will be customized for ",p.name.toLowerCase(),". You can modify your selection later."]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>{n(1),d(null)},className:"flex-1 px-6 py-3 rounded-lg border-2 border-gray-300 font-bold text-gray-700 hover:bg-gray-50 transition",children:"Choose Different"}),e.jsxs("button",{onClick:r,className:"flex-1 px-6 py-3 rounded-lg bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold hover:shadow-lg transition flex items-center justify-center gap-2",children:["Continue to Sign Up",e.jsx(rt,{size:20})]})]})]})]})]})})}function Da({isLocked:t,onUnlock:i,userPin:d,userName:x="Cashier"}){const[n,l]=s.useState(""),[r,o]=s.useState(""),[p,u]=s.useState(0),[m,j]=s.useState(!1);s.useEffect(()=>{t&&(o(""),l(""),u(0),j(!1))},[t]),s.useEffect(()=>{p>=3&&(j(!0),setTimeout(()=>{j(!1),u(0)},3e4))},[p]);const a=w=>{m||n.length<4&&(l(N=>N+w),o(""))},P=()=>{m||(l(w=>w.slice(0,-1)),o(""))},y=()=>{if(m){o("Too many attempts. Please wait.");return}if(n.length!==4){o("PIN must be 4 digits");return}String(n)===String(d)?(l(""),o(""),i()):(o("Incorrect PIN"),u(w=>w+1),l(""))};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[9999] backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-96 max-w-full mx-4",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"bg-red-100 p-4 rounded-full",children:e.jsx(fe,{className:"w-12 h-12 text-red-600"})})}),e.jsx("h1",{className:"text-2xl font-bold text-center text-gray-800 mb-2",children:"Screen Locked"}),e.jsxs("p",{className:"text-center text-gray-600 mb-6",children:[x,", enter your PIN to continue"]}),e.jsx("div",{className:"bg-gray-100 rounded-lg p-4 mb-6 flex justify-center gap-2",children:[0,1,2,3].map(w=>e.jsx("div",{className:"w-12 h-12 bg-white border-2 border-gray-300 rounded-lg flex items-center justify-center font-bold text-xl text-gray-800",children:n[w]?"â—":""},w))}),r&&e.jsxs("div",{className:`text-center text-sm font-medium mb-4 p-2 rounded ${r.includes("Incorrect")?"bg-red-100 text-red-700":r.includes("must be")?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[r,p>0&&p<3&&e.jsxs("p",{className:"text-xs mt-1",children:[3-p," attempt",3-p!==1?"s":""," remaining"]}),m&&e.jsx("p",{className:"text-xs mt-1",children:"Locked. Try again in 30 seconds."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[[1,2,3,4,5,6,7,8,9].map(w=>e.jsx("button",{onClick:()=>a(String(w)),disabled:m||n.length>=4,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors text-lg",children:w},w)),e.jsx("button",{onClick:()=>a("0"),disabled:m||n.length>=4,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors col-span-1 text-lg",children:"0"}),e.jsxs("button",{onClick:P,disabled:m||n.length===0,className:"bg-red-500 hover:bg-red-600 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors col-span-2 flex items-center justify-center gap-2",children:[e.jsx(Ce,{size:16}),"Back"]})]}),e.jsx("button",{onClick:y,disabled:m||n.length!==4,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-300 text-white font-bold py-3 rounded-lg transition-colors mb-3",children:m?"Locked":"Unlock"}),e.jsx("p",{className:"text-center text-xs text-gray-500 mt-4",children:"Enter your 4-digit PIN"})]})}):null}function Ea(){const[t,i]=s.useState([]),[d,x]=s.useState([]);s.useEffect(()=>{const r=async()=>{try{const p=await xe.getLowStockWarnings?.();p?.warnings&&i(p.warnings)}catch(p){console.warn("Failed to fetch low-stock warnings:",p)}};r();const o=setInterval(r,1e4);return()=>clearInterval(o)},[]);const n=t.filter(r=>!d.includes(r.id));if(n.length===0)return null;const l=r=>{x([...d,r])};return e.jsx("div",{className:"fixed top-24 right-6 max-w-md space-y-2 z-40",children:n.map(r=>e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded shadow-lg animate-pulse",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Xe,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-900",children:"âš ï¸ Stock Warning"}),e.jsxs("p",{className:"text-sm text-red-800 mt-1",children:[e.jsx("strong",{children:r.name}),": ",r.quantity,r.unit," remaining"]}),e.jsxs("p",{className:"text-xs text-red-700 mt-0.5",children:["Threshold: ",r.threshold,r.unit]})]})]}),e.jsx("button",{onClick:()=>l(r.id),className:"text-red-600 hover:text-red-900 flex-shrink-0",children:e.jsx(Ce,{className:"w-4 h-4"})})]})},r.id))})}function La(){const{user:t,logout:i}=oe(),{products:d,refreshProducts:x}=Ot(),{isLocked:n,lock:l,unlock:r}=ds(),[o,p]=s.useState([]),[u,m]=s.useState([]),[j,a]=s.useState([]),[P,y]=s.useState("cash"),[w,N]=s.useState("pos"),[v,g]=s.useState({sales:[],expenses:[],stats:{}}),[f,A]=s.useState(""),[_,J]=s.useState(!1),[W,$]=s.useState(!1),[D,F]=s.useState(null),[H,L]=s.useState({name:"",price:"",cost:"",category:"finished",image:""}),[V,le]=s.useState({quantity:"",expiryDate:"",batchNumber:"",cost:""}),[re,he]=s.useState(!1),[we,pe]=s.useState(!1),[ae,ge]=s.useState({customerName:"",amount:"",reason:"",notes:""}),[S,b]=s.useState(!1),[k,T]=s.useState({description:"",amount:"",category:""}),[U,K]=s.useState(""),[R,Z]=s.useState([]),[z,Ee]=s.useState(null),[ne,We]=s.useState("exclusive"),[te,Re]=s.useState(!1),[Ft,He]=s.useState(null),[dt,Me]=s.useState(null),[st,mt]=s.useState({}),[Ke,xt]=s.useState(!1),[Ut,ut]=s.useState(!1),[Rt,Le]=s.useState(!1),[h,C]=s.useState(Date.now()),[M,Q]=s.useState(0);s.useEffect(()=>{Se(),x();const c=localStorage.getItem(`cart_${t?.id}`),I=localStorage.getItem(`paymentMethod_${t?.id}`),E=localStorage.getItem(`selectedDiscount_${t?.id}`),q=localStorage.getItem(`taxType_${t?.id}`);if(c)try{a(JSON.parse(c))}catch(Y){console.warn("Failed to restore cart:",Y)}if(I&&y(I),q&&We(q),E)try{Ee(JSON.parse(E))}catch{}Ie();const B=localStorage.getItem("token");B&&ke.connect(B,Y=>{if(console.log("ðŸ“¡ WebSocket callback received:",Y),Y&&Y.allProducts){console.log(`ðŸ“¦ Merging ${Y.allProducts.length} products from WebSocket`);const ee=Y.allProducts.filter(Ae=>Ae.visibleToCashier!==!1&&!Ae.expenseOnly);p(ee)}Y&&Y.productId!==void 0&&Y.newQuantity!==void 0&&(console.log(`ðŸ“¦ Stock update for product ${Y.productId}: ${Y.newQuantity}${Y.unit||""}`),p(ee=>ee.map(ve=>ve.id===Y.productId?{...ve,quantity:Y.newQuantity}:ve))),Y&&Y.discounts&&(console.log("ðŸ“Š Discount list updated"),Z(Y.discounts)),Y&&Y.sale&&(console.log("ðŸ’° Sale detected, reloading stats"),Se())}).catch(Y=>{console.warn("âš ï¸ WebSocket connection failed:",Y)});const ce=Ht(Y=>{try{if(!Y)return;console.log("ðŸ“¨ Product subscription message:",Y.type),(Y.type==="initial"||Y.type==="products_snapshot"||Y.type==="product_created"||Y.type==="product_updated"||Y.type==="product_deleted")&&xe.getAll().then(ee=>{const Ae=ee.filter(ve=>ve.visibleToCashier!==!1&&!ve.expenseOnly);console.log(`âœ… Subscription update: ${Ae.length} products`),p(Ae)}).catch(ee=>{console.error("Failed to fetch products from subscription:",ee)})}catch(ee){console.error("âŒ Product subscription handler error",ee)}}),Ve=setInterval(()=>{console.log("ðŸ”„ Auto-refreshing products..."),ut(!0),x().finally(()=>ut(!1))},3e4);return()=>{clearInterval(Ve);try{ce()}catch{}ke.disconnect()}},[t?.id]),s.useEffect(()=>{if(d){const c=d.filter(I=>I.visibleToCashier!==!1&&!I.expenseOnly&&!I.pendingDelete);p(c),C(Date.now()),Q(I=>I+1)}},[d]),s.useEffect(()=>{const c=localStorage.getItem("token");c&&ke.connect(c,E=>{if(console.log("ðŸ“¡ WebSocket callback received:",E),E&&E.allProducts){console.log(`ðŸ“¦ Merging ${E.allProducts.length} products from WebSocket`);const q=E.allProducts.filter(B=>B.visibleToCashier!==!1&&!B.expenseOnly);p(q)}E&&E.productId!==void 0&&E.newQuantity!==void 0&&(console.log(`ðŸ“¦ Stock update for product ${E.productId}: ${E.newQuantity}${E.unit||""}`),p(q=>q.map(ce=>ce.id===E.productId?{...ce,quantity:E.newQuantity}:ce))),E&&E.discounts&&(console.log("ðŸ“Š Discount list updated"),Z(E.discounts)),E&&E.sale&&(console.log("ðŸ’° Sale detected, reloading stats"),Se())}).catch(E=>{console.warn("âš ï¸ WebSocket connection failed:",E)});const I=Ht(E=>{try{if(!E)return;console.log("ðŸ“¨ Product subscription message:",E.type),(E.type==="initial"||E.type==="products_snapshot"||E.type==="product_created"||E.type==="product_updated"||E.type==="product_deleted")&&xe.getAll().then(q=>{const B=q.filter(ce=>ce.visibleToCashier!==!1&&!ce.expenseOnly);console.log(`âœ… Subscription update: ${B.length} products`),p(B)}).catch(q=>{console.error("Failed to fetch products from subscription:",q)})}catch(q){console.error("âŒ Product subscription handler error",q)}});return()=>{try{I()}catch{}ke.disconnect()}},[]),s.useEffect(()=>{(j.length>0||P||ne)&&X()},[j,P,ne,z,t?.id]);const X=()=>{localStorage.setItem(`cart_${t?.id}`,JSON.stringify(j)),localStorage.setItem(`paymentMethod_${t?.id}`,P),localStorage.setItem(`taxType_${t?.id}`,ne),z&&localStorage.setItem(`selectedDiscount_${t?.id}`,JSON.stringify(z))},ie=async()=>{try{Le(!0);const c=await ft.create("clock_in");He(c),Re(!0);const I=new Date(c.clockInTime);Me(I),localStorage.setItem(`clockIn_${t?.id}_${new Date().toDateString()}`,I.toISOString()),console.log("âœ… Clocked in successfully"),alert("âœ… Clocked in successfully at "+I.toLocaleTimeString())}catch(c){console.error("Clock in failed:",c),alert("âŒ Clock in failed: "+(c.message||"Unknown error"))}finally{Le(!1)}},$e=async()=>{try{Le(!0);const c=await ft.create("clock_out");He(c),Re(!1),Me(null),localStorage.removeItem(`clockIn_${t?.id}_${new Date().toDateString()}`),console.log("âœ… Clocked out successfully");const I=c.duration?`${c.duration} minutes`:"unknown duration";alert("âœ… Clocked out successfully. Duration: "+I)}catch(c){console.error("Clock out failed:",c),alert("âŒ Clock out failed: "+(c.message||"Unknown error"))}finally{Le(!1)}},Ie=async()=>{try{const c=await ft.getStatus();c.isClockedIn?(Re(!0),Me(new Date(c.clockInTime)),He(c),console.log("âœ… User is clocked in since:",c.clockInTime)):(Re(!1),Me(null),He(null),console.log("User is not clocked in"))}catch(c){console.warn("Failed to check clock status:",c),Re(!1),Me(null)}},Se=async()=>{try{const[c,I,E,q,B,ce]=await Promise.all([xe.getAll(),ze.getAll(),vt.getAll(),ns.get(),wt.getAll(),lt.getAll().catch(()=>[])]);p(c.filter(Ve=>Ve.visibleToCashier!==!1&&!Ve.expenseOnly)),g({sales:I,expenses:E,stats:q}),m(B),Z(ce||[])}catch(c){console.error("Failed to load data:",c)}},St=(c,I=!0)=>{const E=c.target.files[0];if(E){const q=new FileReader;q.onload=B=>{const ce=B.target.result;K(ce),I&&L({...H,image:ce})},q.readAsDataURL(E)}},qe=c=>u.filter(E=>E.productId===c&&E.quantity>0).reduce((E,q)=>E+q.quantity,0),hs=c=>{const I=qe(c.id);if(I<=0){alert("Product is out of stock!");return}const E=j.find(B=>B.id===c.id);if((E?E.quantity:0)>=I){alert(`Only ${I} units available in stock!`);return}a(E?j.map(B=>B.id===c.id?{...B,quantity:B.quantity+1}:B):[...j,{...c,quantity:1}])},kt=(c,I)=>{o.find(q=>q.id===c);const E=qe(c);a(j.map(q=>{if(q.id===c){const B=q.quantity+I;return B>E?(alert(`Only ${E} units available!`),q):{...q,quantity:Math.max(1,B)}}return q}).filter(q=>q.quantity>0))},ps=c=>{a(j.filter(I=>I.id!==c))},me=j.reduce((c,I)=>c+I.price*I.quantity,0),gs=async()=>{if(console.log("ðŸ›’ handleCheckout called, cart:",j,"checkoutLoading:",Ke),j.length===0||Ke){console.log("âš ï¸ Checkout blocked: cart empty or already processing");return}xt(!0),Le(!0);try{console.log("ðŸ’³ Processing checkout...");const c=z?z.type==="percentage"?me*z.value/100:z.value:0;let I=0,E=0;ne==="inclusive"?(I=me/1.16*.16,E=me-c):(I=(me-c)*.16,E=me-c+I);const q=j.map(ee=>({productId:ee.id,quantity:ee.quantity,unit:st[ee.id]||ee.unit||"piece",price:ee.price}));if(console.log("ðŸ“¤ Creating ATOMIC sale with items:",q),console.log("ðŸ’° Total:",E,"Discount:",c,"Tax:",I,"Tax Type:",ne),!ze||typeof ze.create!="function")throw new Error("Sales API not properly loaded");const B=await ze.create({items:q,total:E,discount:c,tax:I,taxType:ne,paymentMethod:P});if(console.log("âœ… ATOMIC Sale completed successfully:",B),!B)throw new Error("No response from server");if(!B.success)throw new Error(B.error||"Sale creation failed");if(!B.saleId)throw console.error("âŒ Invalid response structure:",B),new Error("Invalid sale response - no saleId returned");const ce=B.saleId;console.log(`âœ… Sale ID: ${ce}, Processing Time: ${B.processingTime}, Stock deductions:`,B.stockDeductions);const Ve={id:ce,items:q,total:E,discount:c,tax:I,taxType:ne,paymentMethod:P,accountId:t?.accountId,cashierId:t?.id,cashierName:t?.name||"Cashier",stockDeductions:B.stockDeductions||{products:[],expenses:[]},createdAt:new Date().toISOString()};B.updatedProducts&&(p(B.updatedProducts),console.log("âœ… Product quantities updated with atomic deductions")),g(ee=>({...ee,sales:[Ve,...ee.sales]})),console.log("âœ… Sale added to UI immediately"),a([]),mt({}),Ee(null),We("exclusive");const Y=B.stockDeductions?.map?.(ee=>`${ee.name||ee.productName}: -${ee.quantity}${ee.unit}`).join(`
`)||"None";console.log("âœ… Sale completed successfully!"),console.log("ðŸ”” Low-stock warnings:",B.lowStockWarnings),alert(`âœ… SALE COMPLETE!
Sale ID: #${ce}
Amount: KSH ${E.toLocaleString()}
Time: ${B.processingTime}

Stock Deducted:
${Y}`),console.log("ðŸ”„ Refreshing product inventory and checking warnings in background..."),(async()=>{try{const ee=await xe.getAll();console.log(`ðŸ“¦ Received ${ee.length} products from server`);const Ae=ee.filter(ve=>ve.visibleToCashier!==!1&&!ve.expenseOnly);if(console.log(`âœ… Filtered to ${Ae.length} visible products`),p(Ae),B.lowStockWarnings&&B.lowStockWarnings.length>0){const ve=B.lowStockWarnings.map(Ct=>`${Ct.name}: ${Ct.quantity}${Ct.unit} (âš ï¸ Low!)`).join(`
`);console.warn(`âš ï¸ Low-stock warning:
`+ve)}}catch(ee){console.warn("Background product refresh failed:",ee)}})()}catch(c){console.error("âŒ Checkout failed:",c.message,c),alert(`âŒ Sale failed: ${c.message||"Unknown error occurred"}`)}finally{xt(!1),Le(!1)}},fs=async c=>{c.preventDefault();try{console.log("âž• Creating new product:",H.name);const I=await xe.create({...H,price:parseFloat(H.price),cost:parseFloat(H.cost||0),quantity:0});console.log("âœ… Product created:",I),L({name:"",price:"",cost:"",category:"finished",image:""}),K(""),J(!1),console.log("ðŸ”„ Reloading data..."),await Se(),console.log("âœ… Product added successfully!"),alert("âœ… Product added successfully!")}catch(I){console.error("âŒ Failed to add product:",I.message,I),alert(`âŒ Failed to add product: ${I.message||"Unknown error"}`)}},bs=async c=>{c.preventDefault();try{const I=Array.isArray(u)?u:[],q={id:I.length>0?Math.max(...I.map(B=>B.id||0))+1:1,productId:D.id,quantity:parseInt(V.quantity),expiryDate:V.expiryDate,batchNumber:V.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(V.cost||D.cost||0)};m(B=>[...B,q]),await wt.create({productId:D.id,quantity:parseInt(V.quantity),expiryDate:V.expiryDate,batchNumber:V.batchNumber||`BATCH-${Date.now()}`,cost:parseFloat(V.cost||D.cost||0)}),le({quantity:"",expiryDate:"",batchNumber:"",cost:""}),$(!1),F(null),await Se(),alert("Stock added successfully!")}catch(I){console.error("Failed to add stock:",I),alert("Failed to add stock")}},js=async c=>{c.preventDefault();try{await vt.create({...k,amount:parseFloat(k.amount)}),T({description:"",amount:"",category:""}),he(!1),await Se()}catch(I){console.error("Failed to add expense:",I),alert("Failed to add expense")}},ys=async c=>{if(c.preventDefault(),!ae.customerName||!ae.amount){alert("Please fill in all required fields");return}b(!0);try{const I=await gt.create({customerName:ae.customerName,amount:parseFloat(ae.amount),reason:ae.reason,notes:ae.notes});console.log("âœ… Credit request submitted:",I),ge({customerName:"",amount:"",reason:"",notes:""}),pe(!1),alert("âœ… Credit request submitted successfully!")}catch(I){console.error("Failed to submit credit request:",I),alert("âŒ Failed to submit credit request: "+(I.message||"Unknown error"))}finally{b(!1)}},Ns=async()=>{if(window.confirm("Are you sure you want to clear all sales and expenses? This action cannot be undone."))try{const c=localStorage.getItem("token"),E=await fetch(`${se}/clear-data`,{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify({type:"all"})});if(!E.ok){const q=await E.json();throw new Error(q.message||"Failed to clear data")}g({sales:[],expenses:[],stats:{totalSales:0,totalExpenses:0,profit:0}}),a([]),alert("Data cleared successfully!"),await Se()}catch(c){console.error("Failed to clear data:",c),alert("Failed to clear data: "+c.message)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[e.jsx(Ea,{}),e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:"Cashier Dashboard"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cashier Plan - KSH 900/month"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),te&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-green-600 font-semibold",children:"ðŸŸ¢ Clocked In"}),e.jsxs("button",{onClick:$e,className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-600 hover:bg-red-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(zs,{className:"w-4 h-4"}),"Clock Out"]})]}),!te&&e.jsxs("button",{onClick:ie,className:"px-4 py-2 rounded-lg font-medium transition-all bg-green-600 hover:bg-green-700 text-white flex items-center gap-2 shadow-md",children:[e.jsx(ss,{className:"w-4 h-4"}),"Clock In"]}),e.jsxs("button",{onClick:()=>{X(),i()},className:"px-4 py-2 rounded-lg font-medium transition-all bg-red-100 hover:bg-red-200 text-red-600 border border-red-300 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Logout"]}),e.jsxs("button",{onClick:Ns,className:"px-4 py-2 rounded-lg font-medium transition-all bg-orange-100 hover:bg-orange-200 text-orange-600 border border-orange-300 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Clear"]}),e.jsxs("button",{onClick:()=>pe(!0),className:"px-4 py-2 rounded-lg font-medium transition-all bg-blue-100 hover:bg-blue-200 text-blue-600 border border-blue-300 flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),"Request Credit"]}),te&&dt&&e.jsx("div",{className:"ml-auto text-right text-xs",children:e.jsxs("p",{className:"text-green-600 font-semibold flex items-center gap-1",children:[e.jsx(De,{className:"w-4 h-4"}),"Clocked In: ",dt.toLocaleTimeString()]})})]})]})}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>N("pos"),className:`px-6 py-2 rounded-lg font-medium transition-all ${w==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(nt,{className:"w-4 h-4 inline mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>N("monitor"),className:`px-6 py-2 rounded-lg font-medium transition-all ${w==="monitor"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Dt,{className:"w-4 h-4 inline mr-2"}),"Monitor"]}),e.jsxs("button",{onClick:()=>N("products"),className:`px-6 py-2 rounded-lg font-medium transition-all ${w==="products"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ue,{className:"w-4 h-4 inline mr-2"}),"Products"]}),e.jsxs("button",{onClick:()=>N("expenses"),className:`px-6 py-2 rounded-lg font-medium transition-all ${w==="expenses"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(ot,{className:"w-4 h-4 inline mr-2"}),"Expenses"]})]}),w==="pos"&&e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(ct,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:f,onChange:c=>A(c.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:o.filter(c=>c.name?.toLowerCase().includes(f.toLowerCase())).map(c=>{const I=qe(c.id),E=I<10,q=I<=0;return e.jsxs("button",{onClick:()=>hs(c),disabled:q,className:`card text-left hover:shadow-xl transition-all transform hover:scale-105 relative ${q?"opacity-50 cursor-not-allowed bg-gray-100":"bg-gradient-to-br from-white to-gray-50"}`,children:[c.image&&e.jsx("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:c.image,alt:c.name,className:"w-full h-full object-cover"})}),E&&!q&&e.jsx("div",{className:"absolute top-2 right-2 bg-yellow-500 text-white p-1 rounded-full",children:e.jsx(Xe,{className:"w-4 h-4"})}),q&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"OUT"}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-900",children:c.name}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["KSH ",c.price?.toLocaleString()]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:`text-xs font-medium ${q?"text-red-600":E?"text-yellow-600":"text-gray-500"}`,children:["Stock: ",I]}),E&&!q&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium",children:"Low Stock"})]})]},c.id)})})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-gray-200 p-6 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(nt,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[j.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:j.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(nt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:j.map(c=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:c.name}),e.jsx("button",{onClick:()=>ps(c.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(Ne,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>kt(c.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(_s,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-semibold",children:c.quantity}),e.jsx("button",{onClick:()=>kt(c.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100 transition-colors",children:e.jsx(be,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(c.price*c.quantity).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2 items-center mt-2",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-600",children:"Unit:"}),e.jsxs("select",{value:st[c.id]||c.unit||"piece",onChange:I=>{mt({...st,[c.id]:I.target.value})},className:"text-xs px-2 py-1 border border-gray-300 rounded bg-white",children:[e.jsx("option",{value:"piece",children:"Piece"}),e.jsx("option",{value:"kg",children:"Kilogram (kg)"}),e.jsx("option",{value:"g",children:"Grams (g)"}),e.jsx("option",{value:"l",children:"Liters (L)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",max:"999",placeholder:"qty",defaultValue:c.quantity,className:"text-xs px-2 py-1 border border-gray-300 rounded w-16",onChange:I=>{const E=parseFloat(I.target.value);!isNaN(E)&&E>0&&kt(c.id,E-c.quantity)}})]})]},c.id))})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"text-gray-700",children:["KSH ",me.toLocaleString()]})]}),z&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-KSH ",(z.type==="percentage"?me*z.value/100:z.value).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-orange-600",children:[e.jsxs("span",{children:["Tax (",ne==="exclusive"?"Added":"Included","):"]}),e.jsxs("span",{children:[ne==="exclusive"?"+":"","KSH ",((me-(z?z.type==="percentage"?me*z.value/100:z.value:0))*.16).toLocaleString()]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Final Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(ne==="exclusive"?me-(z?z.type==="percentage"?me*z.value/100:z.value:0)+(me-(z?z.type==="percentage"?me*z.value/100:z.value:0))*.16:me-(z?z.type==="percentage"?me*z.value/100:z.value:0)).toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Discount (Optional)"}),e.jsxs("select",{value:z?.id||"",onChange:c=>{c.target.value?Ee(R.find(I=>I.id===parseInt(c.target.value))):Ee(null)},className:"input",children:[e.jsx("option",{value:"",children:"No Discount"}),R.filter(c=>c.active).map(c=>e.jsxs("option",{value:c.id,children:[c.name," - ",c.type==="percentage"?`${c.value}%`:`KSH ${c.value}`]},c.id))]}),z&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Discount: KSH ",(z.type==="percentage"?me*z.value/100:z.value).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tax Type"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"exclusive",checked:ne==="exclusive",onChange:c=>We(c.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Exclusive (16% added)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"inclusive",checked:ne==="inclusive",onChange:c=>We(c.target.value)}),e.jsx("span",{className:"text-sm",children:"Tax Inclusive"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:P,onChange:c=>y(c.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:()=>{try{console.log("ðŸ›’ Complete Sale button clicked"),gs()}catch(c){console.error("âŒ Button handler error:",c),alert(`Error: ${c.message}`)}},disabled:j.length===0||Ke,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:Ke?"â³ Processing Sale...":"Complete Sale"})]})]})]}),w==="monitor"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",v.stats.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Qe,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",v.stats.totalExpenses?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(ot,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",v.stats.profit?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(Qe,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Sales"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock Deducted"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"})]})}),e.jsx("tbody",{children:v.sales&&v.sales.slice(-15).reverse().map((c,I)=>{const E=c.stockDeductions?.products?.slice(0,2).map(q=>`${q.name}: -${q.deducted}${q.unit}`).join(", ")+(c.stockDeductions?.products?.length>2?"...":"")||"None";return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:new Date(c.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[c.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:c.paymentMethod||"cash"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-orange-600 font-semibold",children:E}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",c.total?.toLocaleString()]})]},I)})})]})})]}),e.jsxs("div",{className:"card shadow-lg mt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-orange-600"}),"Stock Deductions Log"]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-orange-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Sale ID"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Before"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Deducted"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"After"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Unit"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Time"})]})}),e.jsx("tbody",{children:v.sales&&v.sales.slice(-20).reverse().map(c=>c.stockDeductions?.products?.map((I,E)=>e.jsxs("tr",{className:"border-t border-orange-100 hover:bg-orange-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 font-medium text-blue-600",children:["#",c.id]}),e.jsx("td",{className:"px-4 py-3",children:I.name}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:I.before}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-red-600",children:["-",I.deducted]}),e.jsx("td",{className:"px-4 py-3 font-semibold text-green-600",children:I.after}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:I.unit}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-500",children:new Date(c.createdAt).toLocaleTimeString()})]},`${c.id}-${E}`)))})]}),(!v.sales||v.sales.length===0||!v.sales.some(c=>c.stockDeductions?.products?.length>0))&&e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No stock deductions yet"})]})]})]}),e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Manage Products & Stock"}),e.jsxs("button",{onClick:()=>J(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700",children:[e.jsx(be,{className:"w-4 h-4"}),"Add Product"]})]}),_&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl border-2 border-green-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Product"}),e.jsxs("form",{onSubmit:fs,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:H.name,onChange:c=>L({...H,name:c.target.value}),required:!0}),e.jsxs("select",{className:"input",value:H.category,onChange:c=>L({...H,category:c.target.value}),children:[e.jsx("option",{value:"finished",children:"Finished Product"}),e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"service",children:"Service"})]}),e.jsx("input",{type:"number",placeholder:"Selling Price",className:"input",value:H.price,onChange:c=>L({...H,price:c.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Cost Price (Optional)",className:"input",value:H.cost,onChange:c=>L({...H,cost:c.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:c=>St(c,!0),className:"input"}),e.jsx(Zt,{className:"w-5 h-5 text-gray-400"})]}),U&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:U,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>{J(!1),K(""),L({name:"",price:"",cost:"",category:"finished",image:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),W&&D&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"font-semibold mb-4 text-lg",children:["Add Stock for ",D.name]}),e.jsxs("form",{onSubmit:bs,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"number",placeholder:"Quantity",className:"input",value:V.quantity,onChange:c=>le({...V,quantity:c.target.value}),required:!0}),e.jsx("input",{type:"date",placeholder:"Expiry Date (Optional)",className:"input",value:V.expiryDate,onChange:c=>le({...V,expiryDate:c.target.value})}),e.jsx("input",{type:"text",placeholder:"Batch Number (Optional)",className:"input",value:V.batchNumber,onChange:c=>le({...V,batchNumber:c.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per Unit",className:"input",value:V.cost,onChange:c=>le({...V,cost:c.target.value})}),e.jsxs("div",{className:"flex gap-2 md:col-span-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Stock"}),e.jsx("button",{type:"button",onClick:()=>{$(!1),F(null),le({quantity:"",expiryDate:"",batchNumber:"",cost:""})},className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Batches"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:o.map(c=>{const I=qe(c.id),E=u.filter(B=>B.productId===c.id&&B.quantity>0),q=I<10;return e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[c.image&&e.jsx("img",{src:c.image,alt:c.name,className:"w-10 h-10 object-cover rounded-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:c.name}),e.jsx("div",{className:"text-xs text-gray-500",children:c.category})]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",c.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium ${I===0?"text-red-600":q?"text-yellow-600":"text-gray-900"}`,children:I}),q&&I>0&&e.jsx(Xe,{className:"w-4 h-4 text-yellow-500"}),I===0&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium",children:"Out of Stock"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:"text-gray-600",children:[E.length," active"]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{F(c),$(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",title:"Add Stock",children:e.jsx(be,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 hover:bg-green-50 rounded-lg text-green-600 transition-colors",title:"Edit Product",children:e.jsx(Je,{className:"w-4 h-4"})})]})})]},c.id)})})]})})]})}),")}",w==="expenses"&&e.jsx("div",{className:"p-6 max-w-7xl mx-auto w-full",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Track Expenses"}),e.jsxs("button",{onClick:()=>he(!0),className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700",children:[e.jsx(be,{className:"w-4 h-4"}),"Add Expense"]})]}),re&&e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border-2 border-red-200",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Add New Expense"}),e.jsxs("form",{onSubmit:js,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:k.description,onChange:c=>T({...k,description:c.target.value}),required:!0}),e.jsx("input",{type:"number",placeholder:"Amount",className:"input",value:k.amount,onChange:c=>T({...k,amount:c.target.value}),required:!0}),e.jsx("input",{type:"text",placeholder:"Category",className:"input",value:k.category,onChange:c=>T({...k,category:c.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>he(!1),className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:v.expenses.slice().reverse().map((c,I)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(c.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:c.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:c.category||"General"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",c.amount?.toLocaleString()]})]},I))})]})})]})}),we&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 p-6 text-white flex justify-between items-center sticky top-0",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(_e,{}),"Request Credit"]}),e.jsx("button",{onClick:()=>pe(!1),className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(Ce,{size:24})})]}),e.jsxs("form",{onSubmit:ys,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name *"}),e.jsx("input",{type:"text",placeholder:"Enter customer name",value:ae.customerName,onChange:c=>ge({...ae,customerName:c.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:S})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Amount (KES) *"}),e.jsx("input",{type:"number",placeholder:"0.00",value:ae.amount,onChange:c=>ge({...ae,amount:c.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"0",step:"0.01",required:!0,disabled:S})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Reason"}),e.jsxs("select",{value:ae.reason,onChange:c=>ge({...ae,reason:c.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:S,children:[e.jsx("option",{value:"",children:"Select reason..."}),e.jsx("option",{value:"regular_customer",children:"Regular Customer"}),e.jsx("option",{value:"emergency",children:"Emergency"}),e.jsx("option",{value:"bulk_order",children:"Bulk Order"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),e.jsx("textarea",{placeholder:"Add any additional notes...",value:ae.notes,onChange:c=>ge({...ae,notes:c.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"3",disabled:S})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"submit",disabled:S,className:"flex-1 bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 rounded-lg font-bold hover:shadow-lg transition disabled:opacity-50 disabled:cursor-not-allowed",children:S?"Submitting...":"Submit Request"}),e.jsx("button",{type:"button",onClick:()=>pe(!1),disabled:S,className:"flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition disabled:opacity-50",children:"Cancel"})]})]})]})}),e.jsx(Da,{isLocked:n,onUnlock:r,userPin:t?.pin||"1234",userName:t?.name})]})}function $a(){const[t,i]=s.useState({totalSales:0,totalExpenses:0,netProfit:0,transactionCount:0}),[d,x]=s.useState(!0);return s.useEffect(()=>{const n=async()=>{try{const r=localStorage.getItem("token"),p=await(await fetch("http://localhost:5000/api/v2/monitor/stats",{headers:{Authorization:`Bearer ${r}`}})).json();i(p),x(!1)}catch(r){console.error("Failed to fetch stats:",r),x(!1)}};n();const l=setInterval(n,2e3);return()=>clearInterval(l)},[]),d?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin",children:e.jsx(Oe,{size:48,className:"text-blue-600"})}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading statistics..."})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-6 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Sales"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-2",children:t.totalSales.toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:[t.transactionCount," transactions"]})]}),e.jsx(Te,{size:48,className:"text-green-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-red-50 to-red-100 rounded-lg p-6 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Expenses"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 mt-2",children:t.totalExpenses.toLocaleString()}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"Today's costs"})]}),e.jsx(ot,{size:48,className:"text-red-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Net Profit"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 mt-2",children:t.netProfit.toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:[t.totalSales>0?`${(t.netProfit/t.totalSales*100).toFixed(1)}%`:"0%"," margin"]})]}),e.jsx(Oe,{size:48,className:"text-blue-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-6 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Profit %"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-600 mt-2",children:[t.totalSales>0?(t.netProfit/t.totalSales*100).toFixed(1):"0","%"]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"Profitability"})]}),e.jsx(Te,{size:48,className:"text-purple-600 opacity-50"})]})})]})}function Oa({shiftId:t,onClockOut:i}){const[d,x]=s.useState(null),[n,l]=s.useState(!0),[r,o]=s.useState("00:00:00");s.useEffect(()=>{if(!t)return;(async()=>{try{const m=localStorage.getItem("token"),a=await(await fetch("http://localhost:5000/api/v2/shifts/current",{headers:{Authorization:`Bearer ${m}`}})).json();a.shift&&x(a.shift),l(!1)}catch(m){console.error("Failed to fetch shift:",m),l(!1)}})()},[t]),s.useEffect(()=>{if(!d||!d.clockInTime)return;const u=setInterval(()=>{const m=new Date(d.clockInTime),a=Math.floor((new Date-m)/1e3),P=Math.floor(a/3600),y=Math.floor(a%3600/60),w=a%60;o(`${String(P).padStart(2,"0")}:${String(y).padStart(2,"0")}:${String(w).padStart(2,"0")}`)},1e3);return()=>clearInterval(u)},[d]);const p=async()=>{if(t)try{const u=localStorage.getItem("token"),j=await(await fetch("http://localhost:5000/api/v2/shifts/clock-out",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({shiftId:t})})).json();j.success?(alert(`âœ… Clock Out Successful!

Total Sales: ${j.totalSales.toLocaleString()}
Total Expenses: ${j.totalExpenses.toLocaleString()}`),i()):alert(`âŒ Error: ${j.error}`)}catch(u){console.error("Clock out failed:",u),alert("Clock out failed")}};return n?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin",children:e.jsx(De,{size:48,className:"text-blue-600"})}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading shift information..."})]}):d?e.jsx("div",{className:"bg-white rounded-lg shadow-md p-8 max-w-md mx-auto",children:e.jsxs("div",{className:"text-center",children:[e.jsx(De,{size:64,className:"mx-auto text-blue-600 mb-6"}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-6 mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Shift Duration"}),e.jsx("p",{className:"text-5xl font-bold text-blue-600 font-mono",children:r}),e.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:["Started: ",new Date(d.clockInTime).toLocaleTimeString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Sales"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:d.totalSales.toLocaleString()})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Expenses"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:d.totalExpenses.toLocaleString()})]})]}),e.jsxs("button",{onClick:p,className:"w-full bg-red-600 text-white py-3 rounded-lg font-bold hover:bg-red-700 flex items-center justify-center gap-2 transition-colors",children:[e.jsx(Pe,{size:20}),"Clock Out"]})]})}):e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[e.jsx(Fe,{size:48,className:"mx-auto text-yellow-600 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"No Active Shift"}),e.jsx("p",{className:"text-gray-600",children:"Please return to POS to start a new shift."})]})}function tt(){const{user:t}=oe(),i=ue(),[d,x]=s.useState("pos"),[n,l]=s.useState(null),[r,o]=s.useState([]),[p,u]=s.useState([]),[m,j]=s.useState(""),[a,P]=s.useState(0),[y,w]=s.useState(0),[N,v]=s.useState(!1);s.useEffect(()=>{g()},[]);const g=async()=>{try{const L=localStorage.getItem("token"),le=await(await fetch("http://localhost:5000/api/v2/shifts/clock-in",{method:"POST",headers:{Authorization:`Bearer ${L}`}})).json();le.shiftId&&l(le.shiftId)}catch(L){console.error("Clock in failed:",L)}};s.useEffect(()=>{(async()=>{try{const V=localStorage.getItem("token"),re=await(await fetch("http://localhost:5000/api/products",{headers:{Authorization:`Bearer ${V}`}})).json();u(re||[])}catch(V){console.error("Failed to fetch products:",V)}})()},[]);const f=p.filter(L=>L.name.toLowerCase().includes(m.toLowerCase())),A=L=>{const V=r.find(le=>le.productId===L.id);V?(V.quantity+=1,o([...r])):o([...r,{productId:L.id,name:L.name,price:L.price,quantity:1}])},_=L=>{o(r.filter(V=>V.productId!==L))},J=()=>{let L=r.reduce((le,re)=>le+re.price*re.quantity,0),V=L*y/100;return L+V-a},W=async()=>{if(r.length===0){alert("Please add items to the sale");return}v(!0);try{const L=localStorage.getItem("token"),V=J(),re=await(await fetch("http://localhost:5000/api/v2/sales/complete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${L}`},body:JSON.stringify({items:r,total:V,discount:a,tax:r.reduce((he,we)=>he+we.price*we.quantity,0)*y/100,paymentMethod:"cash",shiftId:n})})).json();re.success?(alert(`âœ… Sale completed! ID: ${re.saleId}`),o([]),P(0),w(0)):alert(`âŒ Error: ${re.error}`)}catch(L){console.error("Sale failed:",L),alert("Sale failed. Check console for details.")}finally{v(!1)}};if(!t)return i("/auth/login"),null;const $=[{id:"pos",label:"POS",icon:nt},{id:"monitor",label:"Monitor",icon:Te},{id:"shift",label:"Shift",icon:De}],D=r.reduce((L,V)=>L+V.price*V.quantity,0),F=D*y/100,H=D+F-a;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Cashier POS"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Welcome, ",t.name]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Shift ID: ",n||"Not Started"]})})]})})}),e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4",children:e.jsx("div",{className:"flex gap-4",children:$.map(L=>{const V=L.icon;return e.jsxs("button",{onClick:()=>x(L.id),className:`flex items-center gap-2 px-4 py-3 font-medium transition-colors ${d===L.id?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(V,{size:18}),L.label]},L.id)})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[d==="pos"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsx("input",{type:"text",placeholder:"Search products...",value:m,onChange:L=>j(L.target.value),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:f.map(L=>e.jsxs("button",{onClick:()=>A(L),className:"p-4 border rounded-lg hover:bg-blue-50 transition-colors text-left",children:[e.jsx("p",{className:"font-semibold text-sm",children:L.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Stock: ",L.quantity||0]}),e.jsx("p",{className:"text-lg font-bold text-blue-600 mt-2",children:L.price})]},L.id))}),f.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Fe,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No products found"})]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 sticky top-24",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Cart"}),e.jsx("div",{className:"space-y-3 mb-6 max-h-96 overflow-y-auto",children:r.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No items selected"}):r.map(L=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm",children:L.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:[L.quantity," Ã— ",L.price]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-bold text-sm",children:(L.price*L.quantity).toLocaleString()}),e.jsx("button",{onClick:()=>_(L.productId),className:"text-red-600 hover:text-red-700",children:"âœ•"})]})]},L.productId))}),e.jsxs("div",{className:"space-y-2 border-t pt-4 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{className:"font-semibold",children:D.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Discount:"}),e.jsx("input",{type:"number",value:a,onChange:L=>P(parseFloat(L.target.value)||0),className:"w-24 px-2 py-1 border rounded"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Tax (%):"}),e.jsx("input",{type:"number",value:y,onChange:L=>w(parseFloat(L.target.value)||0),className:"w-24 px-2 py-1 border rounded"})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[e.jsx("span",{children:"TOTAL:"}),e.jsx("span",{className:"text-green-600",children:H.toLocaleString()})]})]}),e.jsx("button",{onClick:W,disabled:N||r.length===0,className:"w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 disabled:bg-gray-400 transition-colors",children:N?"Processing...":"âœ“ Complete Sale"})]})})]}),d==="monitor"&&e.jsx($a,{}),d==="shift"&&e.jsx(Oa,{shiftId:n,onClockOut:()=>i("/auth/login")})]})]})}function Fa(){const{user:t,logout:i}=oe(),d=ue(),[x,n]=s.useState({sales:0,count:0});return s.useEffect(()=>{const l=JSON.parse(localStorage.getItem("dayStats")||'{"sales": 0, "count": 0}');n(l)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-900 to-amber-700",children:[e.jsx("div",{className:"bg-amber-900 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Js,{size:32,className:"text-amber-300"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Bar POS"}),e.jsx("p",{className:"text-amber-200 text-sm",children:"Drinks & Beverages"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-amber-200 text-sm",children:"Today's Sales"}),e.jsxs("p",{className:"text-2xl font-bold text-green-400",children:[x.sales.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-amber-300 text-xs",children:[x.count," transactions"]})]}),e.jsxs("button",{onClick:()=>{i(),d("/auth/login")},className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition",children:[e.jsx(Pe,{size:20}),"Logout"]})]})]})})}),e.jsx("div",{className:"bg-amber-800 text-white border-b border-amber-700",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-amber-600 rounded-lg font-semibold",children:"ðŸº Beer"}),e.jsx("div",{className:"px-4 py-2 hover:bg-amber-700 rounded-lg cursor-pointer transition",children:"ðŸ· Wine"}),e.jsx("div",{className:"px-4 py-2 hover:bg-amber-700 rounded-lg cursor-pointer transition",children:"ðŸ¥ƒ Spirits"}),e.jsx("div",{className:"px-4 py-2 hover:bg-amber-700 rounded-lg cursor-pointer transition",children:"ðŸ§Š Mixers"}),e.jsx("div",{className:"px-4 py-2 hover:bg-amber-700 rounded-lg cursor-pointer transition",children:"ðŸ¸ Cocktails"})]})}),e.jsx("div",{className:"bg-amber-50",children:e.jsx(tt,{businessType:"bar"})}),e.jsx("div",{className:"bg-amber-900 text-white py-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Oe,{size:16,className:"text-yellow-400"}),e.jsx("p",{className:"text-sm",children:"Fast checkout â€¢ Age verification on premium items â€¢ Real-time inventory"})]})})]})}function Ua(){const{user:t,logout:i}=oe(),d=ue(),[x,n]=s.useState(""),[l,r]=s.useState({revenue:0,patients:0});return s.useEffect(()=>{const o=JSON.parse(localStorage.getItem("dayStats")||'{"revenue": 0, "patients": 0}');r(o)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100",children:[e.jsx("div",{className:"bg-red-700 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ws,{size:32,className:"text-red-200"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Hospital POS"}),e.jsx("p",{className:"text-red-200 text-sm",children:"Patient Billing System"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-red-200 text-sm",children:"Daily Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-green-300",children:[l.revenue.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-red-200 text-xs",children:[l.patients," patients served"]})]}),e.jsxs("button",{onClick:()=>{i(),d("/auth/login")},className:"flex items-center gap-2 bg-red-900 hover:bg-red-950 px-4 py-2 rounded-lg transition",children:[e.jsx(Pe,{size:20}),"Logout"]})]})]})})}),e.jsx("div",{className:"bg-white border-b shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ct,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search patient by ID or name...",value:x,onChange:o=>n(o.target.value),className:"w-full pl-10 pr-4 py-2 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"})]}),e.jsxs("button",{className:"bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg transition flex items-center gap-2",children:[e.jsx(De,{size:18}),"Recent Patients"]})]})})}),e.jsx("div",{className:"bg-gray-100 border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-red-600 text-white rounded-lg font-semibold",children:"ðŸ¥ Services"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ’Š Medicines"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ§ª Lab Tests"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ“‹ Procedures"})]})}),e.jsx("div",{className:"bg-white",children:e.jsx(tt,{businessType:"hospital"})}),e.jsx("div",{className:"bg-red-700 text-white py-4 text-center",children:e.jsx("p",{className:"text-sm",children:"Patient records integrated â€¢ Invoice generation â€¢ Real-time inventory tracking"})})]})}function Ra(){const{user:t,logout:i}=oe(),d=ue(),[x,n]=s.useState(""),[l,r]=s.useState({feesCollected:0,transactions:0});return s.useEffect(()=>{const o=JSON.parse(localStorage.getItem("dayStats")||'{"feesCollected": 0, "transactions": 0}');r(o)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-blue-100",children:[e.jsx("div",{className:"bg-blue-700 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Hs,{size:32,className:"text-blue-200"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"School POS"}),e.jsx("p",{className:"text-blue-200 text-sm",children:"Student & Fee Management"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-blue-200 text-sm",children:"Fees Collected Today"}),e.jsxs("p",{className:"text-2xl font-bold text-green-300",children:[l.feesCollected.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-blue-200 text-xs",children:[l.transactions," transactions"]})]}),e.jsxs("button",{onClick:()=>{i(),d("/auth/login")},className:"flex items-center gap-2 bg-blue-900 hover:bg-blue-950 px-4 py-2 rounded-lg transition",children:[e.jsx(Pe,{size:20}),"Logout"]})]})]})})}),e.jsx("div",{className:"bg-white border-b shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ze,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search student by name, admission number, or class...",value:x,onChange:o=>n(o.target.value),className:"w-full pl-10 pr-4 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition flex items-center gap-2",children:[e.jsx(Ks,{size:18}),"Fee Slip"]})]})})}),e.jsx("div",{className:"bg-gray-100 border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold",children:"ðŸ’° Term Fees"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ½ï¸ Canteen"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ‘• Uniforms"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ“š Books"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"âœï¸ Supplies"})]})}),e.jsx("div",{className:"bg-white",children:e.jsx(tt,{businessType:"school"})}),e.jsx("div",{className:"bg-blue-700 text-white py-4 text-center",children:e.jsx("p",{className:"text-sm",children:"Student records linked â€¢ Receipt generation â€¢ Year-end reports"})})]})}function Ma(){const{user:t,logout:i}=oe(),d=ue(),[x,n]=s.useState({sales:0,itemsSold:0,lowStockItems:0});return s.useEffect(()=>{const l=JSON.parse(localStorage.getItem("dayStats")||'{"sales": 0, "itemsSold": 0, "lowStockItems": 0}');n(l)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-green-100",children:[e.jsx("div",{className:"bg-green-700 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Vs,{size:32,className:"text-green-200"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Kiosk POS"}),e.jsx("p",{className:"text-green-200 text-sm",children:"Fast & Simple Checkout"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-green-200 text-sm",children:"Today's Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-300",children:[x.sales.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-green-200 text-xs",children:[x.itemsSold," items sold"]})]}),e.jsxs("button",{onClick:()=>{i(),d("/auth/login")},className:"flex items-center gap-2 bg-green-900 hover:bg-green-950 px-4 py-2 rounded-lg transition",children:[e.jsx(Pe,{size:20}),"Logout"]})]})]})})}),x.lowStockItems>0&&e.jsx("div",{className:"bg-yellow-50 border-b border-yellow-200",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex items-center gap-2 text-yellow-800",children:[e.jsx(Fe,{size:20}),e.jsxs("span",{className:"font-semibold",children:[x.lowStockItems," items running low on stock"]})]})}),e.jsx("div",{className:"bg-gray-100 border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-green-600 text-white rounded-lg font-semibold",children:"ðŸª All Items"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ”Œ Electronics"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸª Food"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ¥¤ Drinks"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ›’ Supplies"})]})}),e.jsx("div",{className:"bg-white",children:e.jsx(tt,{businessType:"kiosk"})}),e.jsxs("div",{className:"bg-green-700 text-white py-4 text-center flex items-center justify-center gap-2",children:[e.jsx(Oe,{size:18,className:"text-yellow-300"}),e.jsx("p",{className:"text-sm",children:"Lightning-fast checkout â€¢ Low stock alerts â€¢ Real-time updates"})]})]})}function qa(){const{user:t,logout:i}=oe(),d=ue(),[x,n]=s.useState("1"),[l,r]=s.useState({revenue:0,liters:0,pumpTotal:0});return s.useEffect(()=>{const o=JSON.parse(localStorage.getItem("dayStats")||'{"revenue": 0, "liters": 0, "pumpTotal": 0}');r(o)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-yellow-50 to-yellow-100",children:[e.jsx("div",{className:"bg-gradient-to-r from-yellow-600 to-yellow-700 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Gs,{size:32,className:"text-yellow-200"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Petrol POS"}),e.jsx("p",{className:"text-yellow-200 text-sm",children:"Fuel & Tank Management"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-yellow-200 text-sm",children:"Daily Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-green-300",children:[l.revenue.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-yellow-200 text-xs",children:[l.liters.toLocaleString()," liters sold"]})]}),e.jsxs("button",{onClick:()=>{i(),d("/auth/login")},className:"flex items-center gap-2 bg-yellow-900 hover:bg-yellow-950 px-4 py-2 rounded-lg transition",children:[e.jsx(Pe,{size:20}),"Logout"]})]})]})})}),e.jsx("div",{className:"bg-white border-b shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Select Pump:"}),e.jsx("div",{className:"flex gap-3",children:[1,2,3,4,5,6].map(o=>e.jsxs("button",{onClick:()=>n(o.toString()),className:`px-6 py-2 rounded-lg font-bold transition ${x===o.toString()?"bg-yellow-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(Ys,{size:18,className:"inline mr-2"}),"Pump ",o]},o))}),e.jsxs("div",{className:"ml-auto text-right",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Pump ",x," Total"]}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600",children:[l.pumpTotal.toLocaleString()," KES"]})]})]})})}),e.jsx("div",{className:"bg-gray-100 border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-yellow-600 text-white rounded-lg font-semibold",children:"â›½ Super"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"â›½ Regular"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"â›½ Diesel"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ›¢ï¸ LPG"})]})}),e.jsx("div",{className:"bg-white",children:e.jsx(tt,{businessType:"petrol",pumpNumber:x})}),e.jsxs("div",{className:"bg-yellow-700 text-white py-4 text-center flex items-center justify-center gap-2",children:[e.jsx(Te,{size:18}),e.jsx("p",{className:"text-sm",children:"Pump tracking â€¢ Tank management â€¢ Shift reconciliation â€¢ Real-time readings"})]})]})}function Ba(){const{user:t,logout:i}=oe(),d=ue(),[x,n]=s.useState({size:"",color:""}),[l,r]=s.useState({sales:0,pairs:0,topSize:""});s.useEffect(()=>{const u=JSON.parse(localStorage.getItem("dayStats")||'{"sales": 0, "pairs": 0, "topSize": ""}');r(u)},[]);const o=["5","6","7","8","9","10","11","12","13"],p=["Black","White","Brown","Blue","Red","Green","Pink","Gray"];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-purple-100",children:[e.jsx("div",{className:"bg-purple-700 text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 text-purple-200",children:"ðŸ‘Ÿ"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Shoes POS"}),e.jsx("p",{className:"text-purple-200 text-sm",children:"Footwear & Variants"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-purple-200 text-sm",children:"Daily Sales"}),e.jsxs("p",{className:"text-2xl font-bold text-green-300",children:[l.sales.toLocaleString()," KES"]}),e.jsxs("p",{className:"text-purple-200 text-xs",children:[l.pairs," pairs sold â€¢ Top: Size ",l.topSize]})]}),e.jsxs("button",{onClick:()=>{i(),d("/auth/login")},className:"flex items-center gap-2 bg-purple-900 hover:bg-purple-950 px-4 py-2 rounded-lg transition",children:[e.jsx(Pe,{size:20}),"Logout"]})]})]})})}),e.jsx("div",{className:"bg-white border-b shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx(Qs,{size:18,className:"inline mr-2"}),"Filter by Size"]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:o.map(u=>e.jsx("button",{onClick:()=>n({...x,size:u===x.size?"":u}),className:`w-10 h-10 rounded-lg font-bold transition ${x.size===u?"bg-purple-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:u},u))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx(Ue,{size:18,className:"inline mr-2"}),"Filter by Color"]}),e.jsxs("select",{value:x.color,onChange:u=>n({...x,color:u.target.value}),className:"px-4 py-2 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Colors"}),p.map(u=>e.jsx("option",{value:u,children:u},u))]})]})]})})}),e.jsx("div",{className:"bg-gray-100 border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex gap-4 overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold",children:"ðŸ‘Ÿ All Shoes"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸƒ Sports"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ‘ž Formal"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ‘  Casual"}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg cursor-pointer hover:bg-gray-200 transition",children:"ðŸ‘¢ Boots"})]})}),e.jsx("div",{className:"bg-white",children:e.jsx(tt,{businessType:"shoes",filters:x})}),e.jsx("div",{className:"bg-purple-700 text-white py-4 text-center",children:e.jsx("p",{className:"text-sm",children:"Variant management â€¢ Size & color tracking â€¢ Stock by variant â€¢ Real-time availability"})})]})}function Gt(){const[t,i]=s.useState([]),[d,x]=s.useState([]),[n,l]=s.useState("all"),[r,o]=s.useState(""),[p,u]=s.useState(!1),[m,j]=s.useState([]),[a,P]=s.useState({subject:"",message:""}),[y,w]=s.useState(!0),[N,v]=s.useState(null),[g,f]=s.useState(!0),[A,_]=s.useState(null),J=ue(),[W,$]=s.useState({totalUsers:0,activeUsers:0,lockedUsers:0,totalRevenue:0,pendingPayments:0,overduePayments:0}),[D,F]=s.useState([]);s.useEffect(()=>{const S=localStorage.getItem("token")||localStorage.getItem("mainAdminToken"),b=localStorage.getItem("user")||localStorage.getItem("mainAdminUser");if(!S||!b){J("/main-admin/login");return}try{if(JSON.parse(b).role!=="owner"){J("/main-admin/login");return}}catch{J("/main-admin/login");return}H().finally(()=>w(!1));const k=JSON.parse(localStorage.getItem("authActivities")||"[]");F(k.slice(0,10));const T=setInterval(()=>{const U=JSON.parse(localStorage.getItem("authActivities")||"[]");F(U.slice(0,10))},5e3);return()=>clearInterval(T)},[J]);const H=async()=>{try{v(null);let S=[],b=!0;try{S=await It.getUsers()}catch(k){console.warn("MainAdmin API not available, falling back to regular users API:",k.message);try{S=await Be.getAll()}catch(T){console.warn("Users API also failed:",T.message),b=!1}}S.length===0&&!b&&(S=V()),i(S),f(b),re(S,[])}catch(S){console.error("Failed to load data:",S),v("Failed to load dashboard data");const b=V();i(b),x(le(b)),f(!1),re(b,[])}},L=()=>{localStorage.removeItem("mainAdminToken"),localStorage.removeItem("mainAdminUser"),J("/main-admin/login")},V=()=>{const S=localStorage.getItem("user"),b=[];if(S){const T=JSON.parse(S);b.push({...T,id:T.id||"real-user"})}return[{name:"John Doe",email:"john@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Jane Smith",email:"jane@example.com",plan:"basic",price:900,active:!0,locked:!1,role:"cashier"},{name:"Bob Wilson",email:"bob@example.com",plan:"ultra",price:1600,active:!1,locked:!1,role:"admin"},{name:"Alice Brown",email:"alice@example.com",plan:"basic",price:900,active:!0,locked:!0,role:"cashier"},{name:"Mike Johnson",email:"mike@example.com",plan:"ultra",price:1600,active:!0,locked:!1,role:"admin"},{name:"Sarah Davis",email:"sarah@example.com",plan:"basic",price:900,active:!1,locked:!1,role:"cashier"}].forEach((T,U)=>{b.push({id:`demo-${U+1}`,...T,createdAt:new Date(Date.now()-U*864e5).toISOString(),lastLogin:new Date(Date.now()-Math.random()*864e5).toISOString()})}),b},le=S=>S.flatMap(b=>[{id:`payment-${b.id}-1`,userId:b.id,amount:b.plan==="ultra"?1600:900,status:Math.random()>.3?"paid":"pending",createdAt:new Date(Date.now()-30*864e5).toISOString(),dueDate:new Date(Date.now()+5*864e5).toISOString()},{id:`payment-${b.id}-2`,userId:b.id,amount:b.plan==="ultra"?1600:900,status:Math.random()>.7?"paid":Math.random()>.5?"pending":"overdue",createdAt:new Date(Date.now()-60*864e5).toISOString(),dueDate:new Date(Date.now()-5*864e5).toISOString()}]),re=(S,b)=>{const k=S.length,T=S.filter(z=>z.active).length,U=S.filter(z=>z.locked).length,K=b.filter(z=>z.status==="paid").reduce((z,Ee)=>z+Ee.amount,0),R=b.filter(z=>z.status==="pending").length,Z=b.filter(z=>z.status==="overdue").length;$({totalUsers:k,activeUsers:T,lockedUsers:U,totalRevenue:K,pendingPayments:R,overduePayments:Z})},he=async(S,b)=>{try{_(S);const k=!b;try{await It.lockUser(S,k);const T=t.map(R=>R.id===S?{...R,locked:k,active:!k}:R);i(T),re(T,d);const U=t.find(R=>R.id===S),K=k?"locked":"unlocked";alert(`âœ… ${U?.name||`User ${S}`} has been ${K} successfully!`)}catch(T){console.error("API lock failed:",T);const U=t.map(Z=>Z.id===S?{...Z,locked:k,active:!k}:Z);i(U),re(U,d);const K=t.find(Z=>Z.id===S),R=k?"locked":"unlocked";alert(`âš ï¸ Backend not available. ${K?.name||`User ${S}`} ${R} locally. Changes will sync when backend is available.`)}}catch(k){console.error("Failed to toggle lock:",k),alert(`âŒ Failed to update user status: ${k.message}`)}finally{_(null)}},we=async(S,b,k)=>{try{w(!0);try{await It.sendEmail({userIds:S,subject:b,message:k}),alert("Emails sent successfully!"),u(!1),j([]),P({subject:"",message:""});return}catch(K){console.warn("Backend email operation failed, simulating email send:",K.message)}const T=t.filter(K=>S.includes(K.id)),U=JSON.parse(localStorage.getItem("emailLogs")||"[]");U.push({timestamp:new Date().toISOString(),recipients:T.map(K=>({id:K.id,name:K.name,email:K.email})),subject:b,message:k,status:"simulated"}),localStorage.setItem("emailLogs",JSON.stringify(U)),alert(`âœ… Email simulation successful!

ðŸ“§ Sent to ${T.length} user(s):
${T.map(K=>`${K.name} (${K.email})`).join(`
`)}

${g?"":`ðŸ“Œ Backend not deployed - this was a simulation.
`}ðŸ’¡ Deploy backend to send real emails.`),u(!1),j([]),P({subject:"",message:""})}catch(T){console.error("Failed to send email:",T),alert("Failed to process email request.")}finally{w(!1)}},pe=async S=>{const b=t.find(k=>k.id===S);b&&await we([S],"Payment Reminder - Subscription",`Dear ${b.name},

This is a friendly reminder about your pending subscription payment for ${b.plan?.toUpperCase()} plan (KSH ${b.price}).

Please complete your payment to continue enjoying our services.

Thank you!`)},ae=t.filter(S=>{const b=S.name?.toLowerCase().includes(r.toLowerCase())||S.email?.toLowerCase().includes(r.toLowerCase());if(n==="all")return b;if(n==="active")return b&&S.active&&!S.locked;if(n==="locked")return b&&S.locked;if(n==="trial")return b&&(!S.active||!S.plan);if(n==="pending-payment"){const k=d.filter(T=>T.userId===S.id&&T.status==="pending");return b&&k.length>0}if(n==="overdue"){const k=d.filter(T=>T.userId===S.id&&T.status==="overdue");return b&&k.length>0}return b}),ge=S=>{const b=d.filter(K=>K.userId===S),k=b.filter(K=>K.status==="pending").length,T=b.filter(K=>K.status==="overdue").length,U=b.filter(K=>K.status==="paid").length;return{pending:k,overdue:T,paid:U,total:b.length}};return y&&t.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-white mx-auto mb-4"}),e.jsx("p",{className:"text-white text-xl",children:"Loading Main Admin Dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900",children:[!g&&e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm md:text-base font-semibold",children:["âš ï¸ Demo Mode: Backend not available. Actions are simulated locally.",e.jsx("a",{href:"/BACKEND_NOT_DEPLOYED.md",className:"underline ml-2",children:"Deploy Backend â†’"})]})}),N&&e.jsx("div",{className:"bg-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm font-semibold",children:["âš ï¸ ",N]})}),e.jsx("header",{className:"bg-black/30 backdrop-blur-lg border-b border-white/10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Main Admin Dashboard"}),e.jsx("p",{className:"text-gray-300",children:"Monitor all users, payments, and system activity"})]}),e.jsxs("button",{onClick:L,className:"flex items-center gap-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 px-4 py-2 rounded-lg transition-colors",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Logout"]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ze,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:W.totalUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ye,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:W.activeUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Active Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(fe,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:W.lockedUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Locked Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Qe,{className:"w-8 h-8 text-yellow-400"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:["KSH ",W.totalRevenue.toLocaleString()]})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Xe,{className:"w-8 h-8 text-orange-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:W.pendingPayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Pending Payments"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(pt,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:W.overduePayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Overdue Payments"})]})]}),e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 flex-1 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-80",children:[e.jsx(ct,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",value:r,onChange:S=>o(S.target.value)})]}),e.jsxs("select",{value:n,onChange:S=>l(S.target.value),className:"px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"locked",children:"Locked"}),e.jsx("option",{value:"trial",children:"Free Trial"}),e.jsx("option",{value:"pending-payment",children:"Pending Payment"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsxs("button",{onClick:()=>u(!0),disabled:m.length===0||y,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-3 rounded-lg font-bold flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Nt,{className:"w-5 h-5"}),"Send Email to Selected (",m.length,")"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"xl:col-span-2 bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"All Users"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left",children:e.jsx("input",{type:"checkbox",checked:m.length===ae.length&&ae.length>0,onChange:S=>{S.target.checked?j(ae.map(b=>b.id)):j([])},className:"w-5 h-5 rounded"})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Actions"})]})}),e.jsxs("tbody",{children:[ae.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:"5",className:"px-4 py-12 text-center",children:[e.jsx(Ze,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:r||n!=="all"?"Try adjusting your filters":"Users will appear here once they sign up"})]})}),ae.map(S=>(ge(S.id),e.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:m.includes(S.id),onChange:b=>{b.target.checked?j([...m,S.id]):j(m.filter(k=>k!==S.id))},className:"w-5 h-5 rounded"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[S.profilePicture?e.jsx("img",{src:S.profilePicture,alt:S.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:S.name?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:S.name}),e.jsx("p",{className:"text-sm text-gray-400",children:S.email})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${S.plan==="ultra"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"}`,children:[S.plan?.toUpperCase()," - KSH ",S.price]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"flex items-center gap-2",children:S.locked?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-300 flex items-center gap-1",children:[e.jsx(fe,{className:"w-3 h-3"}),"Locked"]}):S.active?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-300 flex items-center gap-1",children:[e.jsx(Ye,{className:"w-3 h-3"}),"Active"]}):e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-500/20 text-gray-300",children:"Inactive"})})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>he(S.id,S.locked),disabled:A===S.id,className:`p-2 rounded-lg transition ${S.locked?"bg-green-500/20 hover:bg-green-500/30 text-green-300":"bg-red-500/20 hover:bg-red-500/30 text-red-300"} ${A===S.id?"opacity-50 cursor-not-allowed":""}`,title:S.locked?"Unlock User":"Lock User",children:A===S.id?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):S.locked?e.jsx(Xs,{className:"w-4 h-4"}):e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>pe(S.id),disabled:y,className:"p-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 transition",title:"Send Payment Reminder",children:e.jsx(Zs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{S.role==="cashier"?window.open("/dashboard/cashier","_blank"):window.open("/admin","_blank")},className:"p-2 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 transition",title:"View User Dashboard",children:e.jsx(ts,{className:"w-4 h-4"})})]})})]},S.id)))]})]})})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl border border-white/20",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5"}),"Recent Activity"]})}),e.jsx("div",{className:"p-4 space-y-3 max-h-96 overflow-y-auto",children:D.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"No recent activity"}):D.map(S=>e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${S.type==="login"?"bg-green-400":"bg-blue-400"}`}),e.jsx("span",{className:"text-white font-medium",children:S.user.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${S.type==="login"?"bg-green-500/20 text-green-300":"bg-blue-500/20 text-blue-300"}`,children:S.type})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:S.user.email}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:new Date(S.timestamp).toLocaleString()})]},S.id))})]})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-purple-900 rounded-2xl shadow-2xl max-w-2xl w-full border border-white/20",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Nt,{}),"Send Email to ",m.length," User(s)"]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Subject"}),e.jsx("input",{type:"text",value:a.subject,onChange:S=>P({...a,subject:S.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email subject..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Message"}),e.jsx("textarea",{value:a.message,onChange:S=>P({...a,message:S.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 h-40",placeholder:"Email message..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>we(m,a.subject,a.message),disabled:y,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white py-3 rounded-lg font-bold transition disabled:opacity-50",children:y?"Sending...":"Send Email"}),e.jsx("button",{onClick:()=>u(!1),className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-lg font-bold transition",children:"Cancel"})]})]})]})})]})}function za({user:t}){const[i,d]=s.useState(!1);if(i||!t)return null;const x=t?.serviceStartDate?new Date(t.serviceStartDate):null,n=t?.daysUsed||0,l=t?.plan||"",o=Math.max(0,30-n);return o>7?null:e.jsxs("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-3 md:p-4 flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(Fe,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-amber-900",children:o===0?`Your ${l} plan has expired. Please renew to continue.`:`Your ${l} plan expires in ${o} day${o!==1?"s":""}. Consider upgrading.`}),e.jsxs("p",{className:"text-xs text-amber-700 mt-1",children:["Service started: ",x?.toLocaleDateString()||"Unknown"]})]})]}),e.jsx("button",{onClick:()=>d(!0),className:"flex-shrink-0 text-amber-600 hover:text-amber-900",children:e.jsx(Ce,{className:"w-5 h-5"})})]})}function _a(){const{refreshProducts:t}=Ot();return s.useEffect(()=>{const i=n=>{console.log(" Stock update received:",n.detail),t()},d=n=>{console.log(" Sale completed, refreshing stock:",n.detail),t()},x=n=>{console.log(" Products sync event:",n.detail)};return window.addEventListener("stockUpdate",i),window.addEventListener("saleComplete",d),window.addEventListener("productsSync",x),()=>{window.removeEventListener("stockUpdate",i),window.removeEventListener("saleComplete",d),window.removeEventListener("productsSync",x)}},[t]),null}function je({children:t,adminOnly:i=!1,ultraOnly:d=!1,ownerOnly:x=!1}){const{user:n,loading:l}=oe(),{isLocked:r,lock:o,unlock:p}=ds(),[u,m]=s.useState(!1),j=us(6e4),a=j?.[0]||r||!1,P=s.useCallback(()=>{j?.[1]?.(),p()},[j,p]),[y,w]=s.useState({});if(s.useEffect(()=>{n&&!x&&((async()=>{try{const g=localStorage.getItem("token"),A=await fetch(`${se}/settings`,{headers:{Authorization:`Bearer ${g}`}});if(A.ok){const _=await A.json();w(_)}}catch(g){console.error("Failed to load settings:",g)}})(),sessionStorage.getItem("reminderShown")||(m(!0),sessionStorage.setItem("reminderShown","true")))},[n,x]),s.useEffect(()=>{const v=g=>{console.log("ðŸ”’ Admin locked screen:",g.detail),o("admin")};return window.addEventListener("admin_locked_user_screen",v),()=>window.removeEventListener("admin_locked_user_screen",v)},[o]),l&&!x)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(x){const v=localStorage.getItem("ownerToken"),g=localStorage.getItem("ownerUser");if(!v||!g)return e.jsx(de,{to:"/main.admin"});try{if(JSON.parse(g).type!=="main_admin")return e.jsx(de,{to:"/main.admin"})}catch{return e.jsx(de,{to:"/main.admin"})}}else{if(!n)return e.jsx(de,{to:"/auth/login"});if(!n.active)return e.jsx(de,{to:"/choose-subscription"});if(i&&n.role!=="admin")return e.jsx(de,{to:"/dashboard"});if(d&&(n.role!=="admin"||n.plan!=="ultra"))return e.jsx(de,{to:"/dashboard"})}const N=x?"owner":"user";return e.jsxs(e.Fragment,{children:[e.jsx(za,{}),e.jsx(_a,{}),a&&e.jsx(xs,{onUnlock:P,userType:N}),u&&e.jsx(ms,{onClose:()=>m(!1)}),t]})}function Ja(){const{user:t}=oe();return!t||!t.active?e.jsx(de,{to:"/choose-subscription"}):t.role==="admin"?e.jsx(de,{to:"/admin"}):e.jsx(de,{to:"/dashboard/cashier"})}function Wa(){return e.jsx(oa,{children:e.jsx(ca,{children:e.jsx(ma,{children:e.jsx(ks,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(Qt,{children:[e.jsx(G,{path:"/",element:e.jsx(de,{to:"/get-started"})}),e.jsx(G,{path:"/get-started",element:e.jsx(Ia,{})}),e.jsx(G,{path:"/choose-subscription",element:e.jsx(Aa,{})}),e.jsx(G,{path:"/auth/login",element:e.jsx(Vt,{})}),e.jsx(G,{path:"/auth/signup",element:e.jsx(Vt,{})}),e.jsx(G,{path:"/plans",element:e.jsx(de,{to:"/choose-subscription"})}),e.jsx(G,{path:"/build-pos",element:e.jsx(Ta,{})}),e.jsx(G,{path:"/main.admin/*",element:e.jsx(Gt,{})}),e.jsx(G,{path:"/main-admin",element:e.jsx(je,{ownerOnly:!0,children:e.jsx(Gt,{})})}),e.jsx(G,{path:"/dashboard",element:e.jsx(je,{children:e.jsx(Ja,{})})}),e.jsx(G,{path:"/dashboard/cashier",element:e.jsx(je,{children:e.jsx(La,{})})}),e.jsx(G,{path:"/cashier/bar",element:e.jsx(je,{children:e.jsx(Fa,{})})}),e.jsx(G,{path:"/cashier/hospital",element:e.jsx(je,{children:e.jsx(Ua,{})})}),e.jsx(G,{path:"/cashier/school",element:e.jsx(je,{children:e.jsx(Ra,{})})}),e.jsx(G,{path:"/cashier/kiosk",element:e.jsx(je,{children:e.jsx(Ma,{})})}),e.jsx(G,{path:"/cashier/petrol",element:e.jsx(je,{children:e.jsx(qa,{})})}),e.jsx(G,{path:"/cashier/shoes",element:e.jsx(je,{children:e.jsx(Ba,{})})}),e.jsx(G,{path:"/admin/*",element:e.jsx(je,{adminOnly:!0,children:e.jsx(Kt,{})})}),e.jsx(G,{path:"/admin",element:e.jsx(je,{adminOnly:!0,children:e.jsx(Kt,{})})}),e.jsx(G,{path:"/login",element:e.jsx(de,{to:"/auth/login"})}),e.jsx(G,{path:"/signup",element:e.jsx(de,{to:"/auth/signup"})}),e.jsx(G,{path:"/subscription",element:e.jsx(de,{to:"/choose-subscription"})}),e.jsx(G,{path:"/payment",element:e.jsx(de,{to:"/choose-subscription"})}),e.jsx(G,{path:"/cashier",element:e.jsx(je,{children:e.jsx(de,{to:"/dashboard/cashier"})})})]})})})})})}ra.createRoot(document.getElementById("root")).render(e.jsx(Cs.StrictMode,{children:e.jsx(Wa,{})}));
